<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unable to attach action to button push (barrier breaker, asus rt-n16)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p209302">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">subassy</div>
					<div class="post-datetime">
						9 Aug 2013, 00:13					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m relatively new to OpenWRT but I&#039;d like to believe I&#039;m &quot;getting there&quot; with Linux. What I&#039;ve beent rying to do for the last week+ is attach a script to a WPS button push to mount and/or unmount the USB device.</p><p>Everything else works perfectly well, I can manually mount the USB storage device I&#039;m using (various thumb drives as sda1). Just can&#039;t make the button do what I want.</p><p>I know the button is working on some level: logread | tail shows it sees the button press with the name &quot;reset&quot; and that it was pushed and released. </p><p>I did find the /etc/rc.button directory that contained the three scripts failsafe, reset and rfkill. When the three scripts are in the rc.button directory pushing the button does reboot the router. If I move any one of them out of that directory the button doesn&#039;t do anything. </p><p>I also noted the directory <br />/rom/etc/rc.button/<br />with the same three scripts. I&#039;m guess this has something to do with variations of the three scripts and entirely new scripts not working. </p><p>I&#039;ve spent hour and hours reading the wiki (especially <a href="http://wiki.openwrt.org/doc/howto/hardware.button)">http://wiki.openwrt.org/doc/howto/hardware.button)</a> and can&#039;t figure this out. </p><p>I would be grateful for any assistance. Let me know if you need any additional information</p><p>Here&#039;s some info that may be relevant:</p><div class="quotebox"><blockquote><p>BARRIER BREAKER (Bleeding Edge, r37620)</p></blockquote></div><div class="quotebox"><blockquote><p>uname -r 3.8.13</p></blockquote></div><div class="quotebox"><blockquote><p>root@OpenWrt:/rom/etc/rc.button# opkg list-installed<br />6relayd - 2013-07-26-2ed520c500b0fbb484cfad5687eb39a0da43dcf7<br />base-files - 144-r37620<br />block-mount - 2013-07-26-75b17dab43c511d1cecc70c370e9f8283dfbf547<br />busybox - 1.19.4-7<br />cfdisk - 2.21.2-2<br />curl - 7.29.0-1<br />dnsmasq - 2.66-3<br />dropbear - 2012.55-2<br />e2fsprogs - 1.42.8-1<br />fdisk - 2.21.2-2<br />firewall - 2013-07-16<br />ip6tables - 1.4.19.1-2<br />iptables - 1.4.19.1-2<br />iw - 3.10-1<br />jshn - 2013-07-29-ef9b6b92df223e783a365f34998bc0f299b977f2<br />kernel - 3.8.13-1-83f9d1ba115ccf300173e20538e0a85c<br />kmod-b43 - 3.8.13+2013-06-27-1<br />kmod-b43legacy - 3.8.13+2013-06-27-1<br />kmod-b44 - 3.8.13-1<br />kmod-bgmac - 3.8.13-1<br />kmod-cfg80211 - 3.8.13+2013-06-27-1<br />kmod-crypto-aes - 3.8.13-1<br />kmod-crypto-arc4 - 3.8.13-1<br />kmod-crypto-core - 3.8.13-1<br />kmod-crypto-hash - 3.8.13-1<br />kmod-crypto-manager - 3.8.13-1<br />kmod-diag - 3.8.13-10<br />kmod-fs-autofs4 - 3.10.4-1<br />kmod-fs-ext4 - 3.8.13-1<br />kmod-fs-msdos - 3.8.13-1<br />kmod-fs-vfat - 3.8.13-1<br />kmod-hwmon-core - 3.8.13-1<br />kmod-ip6tables - 3.8.13-1<br />kmod-ipt-conntrack - 3.8.13-1<br />kmod-ipt-core - 3.8.13-1<br />kmod-ipt-nat - 3.8.13-1<br />kmod-ipt-nathelper - 3.8.13-1<br />kmod-ipv6 - 3.8.13-1<br />kmod-lib-crc-ccitt - 3.8.13-1<br />kmod-lib-crc16 - 3.8.13-1<br />kmod-mac80211 - 3.8.13+2013-06-27-1<br />kmod-nls-base - 3.8.13-1<br />kmod-nls-cp437 - 3.8.13-1<br />kmod-nls-iso8859-1 - 3.8.13-1<br />kmod-ppp - 3.8.13-1<br />kmod-pppoe - 3.8.13-1<br />kmod-pppox - 3.8.13-1<br />kmod-pps - 3.8.13-1<br />kmod-ptp - 3.8.13-1<br />kmod-scsi-core - 3.8.13-1<br />kmod-scsi-generic - 3.8.13-1<br />kmod-slhc - 3.8.13-1<br />kmod-switch - 3.8.13-6<br />kmod-tg3 - 3.8.13-1<br />kmod-usb-brcm47xx - 3.8.13-1<br />kmod-usb-core - 3.8.13-1<br />kmod-usb-ohci - 3.8.13-1<br />kmod-usb-storage - 3.8.13-1<br />kmod-usb-storage-extras - 3.8.13-1<br />kmod-usb2 - 3.8.13-1<br />libblkid - 2.21.2-2<br />libblobmsg-json - 2013-07-29-ef9b6b92df223e783a365f34998bc0f299b977f2<br />libc - 0.9.33.2-1<br />libcurl - 7.29.0-1<br />libevent2 - 2.0.21-1<br />libext2fs - 1.42.8-1<br />libgcc - 4.6-linaro-1<br />libip4tc - 1.4.19.1-2<br />libip6tc - 1.4.19.1-2<br />libiwinfo - 46<br />libiwinfo-lua - 46<br />libjson-c - 0.11-2<br />libjson-script - 2013-07-29-ef9b6b92df223e783a365f34998bc0f299b977f2<br />liblua - 5.1.5-1<br />libmount - 2.21.2-2<br />libncurses - 5.9-1<br />libnl-tiny - 0.1-3<br />libopenssl - 1.0.1e-2<br />libpcre - 8.11-2<br />libpthread - 0.9.33.2-1<br />libreadline - 6.2-1<br />librt - 0.9.33.2-1<br />libubox - 2013-07-29-ef9b6b92df223e783a365f34998bc0f299b977f2<br />libubus - 2013-05-30-f72dca720bb50d45b1b01bab5b01cb80c78c5230<br />libubus-lua - 2013-05-30-f72dca720bb50d45b1b01bab5b01cb80c78c5230<br />libuci - 2013-06-11.1-1<br />libuci-lua - 2013-06-11.1-1<br />libuuid - 2.21.2-2<br />libxtables - 1.4.19.1-2<br />lua - 5.1.5-1<br />luci - svn-r9873-1<br />luci-app-firewall - svn-r9873-1<br />luci-i18n-english - svn-r9873-1<br />luci-lib-core - svn-r9873-1<br />luci-lib-ipkg - svn-r9873-1<br />luci-lib-nixio - svn-r9873-1<br />luci-lib-sys - svn-r9873-1<br />luci-lib-web - svn-r9873-1<br />luci-mod-admin-core - svn-r9873-1<br />luci-mod-admin-full - svn-r9873-1<br />luci-proto-core - svn-r9873-1<br />luci-proto-ppp - svn-r9873-1<br />luci-sgi-cgi - svn-r9873-1<br />luci-theme-base - svn-r9873-1<br />luci-theme-bootstrap - svn-r9873-1<br />mount-utils - 2.21.2-2<br />mountd - 0.1-6<br />mtd - 20<br />nano - 2.2.6-1<br />netcat - 0.7.1-2<br />netifd - 2013-07-16-2674941b06c1ec67f1aff1bff9212e1372106641<br />nvram - 9<br />odhcp6c - 2013-07-03-007ae1a6ae8092878adccde1f610ea9dd86e5aad<br />opkg - 618-3<br />ppp - 2.4.5-10<br />ppp-mod-pppoe - 2.4.5-10<br />procd - 2013-07-23-ba0cb9c1ecc72e6b726deaf91193d24b2a85814a-1<br />socat - 1.7.2.1-1<br />terminfo - 5.9-1<br />tftp-hpa - 0.48-3<br />tftpd-hpa - 0.48-3<br />tmux - 1.6-2<br />ubox - 2013-07-26-75b17dab43c511d1cecc70c370e9f8283dfbf547<br />ubus - 2013-05-30-f72dca720bb50d45b1b01bab5b01cb80c78c5230<br />ubusd - 2013-05-30-f72dca720bb50d45b1b01bab5b01cb80c78c5230<br />uci - 2013-06-11.1-1<br />uhttpd - 2013-07-26-135afd6343e524cb4fb0e6579cc3447531a401fa<br />uhttpd-mod-ubus - 2013-07-26-135afd6343e524cb4fb0e6579cc3447531a401fa<br />unzip - 5.52-1<br />vim - 7.3-1<br />wget - 1.14-1<br />wpad-mini - 20130630-2<br />zlib - 1.2.8-1</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210966">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">sash-kan</div>
					<div class="post-datetime">
						27 Aug 2013, 18:20					</div>
				</div>
				<div class="post-content content">
					<p>try:<br /># echo -e &#039;#!/bin/sh\nlogger -t &quot;hotplug test&quot; &quot;button:$BUTTON&quot; action:$ACTION&#039; &gt; /etc/hotplug.d/button/00-test<br /># chmod +x /etc/hotplug.d/button/00-test<br /># logread -f</p><p>then press button and see output of last command.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225128">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">bluepuma</div>
					<div class="post-datetime">
						12 Feb 2014, 11:30					</div>
				</div>
				<div class="post-content content">
					<p>In current Barrier Breaker just check the files like /etc/rc.button/reset</p><div class="codebox"><pre><code>#!/bin/sh

[ &quot;${ACTION}&quot; = &quot;released&quot; ] || exit 0

. /lib/functions.sh

logger &quot;$BUTTON pressed for $SEEN seconds&quot;

if [ &quot;$SEEN&quot; -lt 1 ]
then
    echo &quot;REBOOT&quot; &gt; /dev/console
    sync
    reboot
elif [ &quot;$SEEN&quot; -gt 5 ]
then
    echo &quot;FACTORY RESET&quot; &gt; /dev/console
    jffs2reset -y &amp;&amp; reboot &amp;
fi</code></pre></div><p>I think it&#039;s easy to understand and modify.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258358">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">al9</div>
					<div class="post-datetime">
						21 Dec 2014, 22:28					</div>
				</div>
				<div class="post-content content">
					<p>Hi.<br />On my device:<br /></p><div class="codebox"><pre><code>  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (Bleeding Edge, r39180)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir.
  * 2 tsp. Creme de Cacao
 -----------------------------------------------------</code></pre></div><p>there are 4 files in /etc/rc.buttons</p><div class="codebox"><pre><code>root@OpenWrt:/etc/rc.button# ls -l
-rwxrwxr-x    1 root     root            77 Nov 25  2013 failsafe
-rwxrwxr-x    1 root     root           281 Aug  9  2013 reset
-rwxrwxr-x    1 root     root           522 Nov 25  2013 rfkill
-rwxrwxr-x    1 root     root           108 Dec 21 20:55 wps
root@OpenWrt:/etc/rc.button#</code></pre></div><p>But the available buttons are:</p><div class="codebox"><pre><code>root@OpenWrt:/etc/rc.button# cat /sys/kernel/debug/gpio
GPIOs 0-39, bcm63xx-gpio:
 gpio-0   (HW556:red:message   ) out hi
 gpio-1   (HW556:red:hspa      ) out hi
 gpio-2   (HW556:red:dsl       ) out hi
 gpio-3   (HW556:red:power     ) out hi
 gpio-6   (HW556:red:all       ) out lo
 gpio-8   (help                ) in  hi
 gpio-9   (wlan                ) in  hi
 gpio-10  (restart             ) in  hi
 gpio-11  (reset               ) in  hi
 gpio-12  (HW556:green:lan1    ) out hi
 gpio-13  (HW556:red:lan1      ) out hi
 gpio-15  (HW556:green:lan2    ) out hi
 gpio-22  (HW556:red:lan2      ) out hi
 gpio-23  (HW556:green:lan3    ) out hi
 gpio-26  (HW556:red:lan3      ) out hi
 gpio-27  (HW556:green:lan4    ) out hi
 gpio-28  (HW556:red:lan4      ) out hi</code></pre></div><br /><p>I tried to create a &quot;wlan&quot;script here but didn&#039;t work.<br />How I can do a script that works with &quot;wlan&quot;button??</p><p>Tnks.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>