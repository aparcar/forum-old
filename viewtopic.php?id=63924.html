<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> USB support for Opewrt as dumb access point</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p318065">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">meazz1</div>
					<div class="post-datetime">
						4 Apr 2016, 05:13					</div>
				</div>
				<div class="post-content content">
					<p>Does Openwrt support USB storage if it&#039;s used as a dumb access point?<br />I have a TP WR1043 v3.0 running DD firmware setup as a dumb access point. When I connect a USB storage to it, I don&#039;t see any mount point or it shows up in /dev as sda or sdb.<br />I know this is a working USB hdd which I took out of a router running tomato just now.</p><p>I checked and all the necessary USB driver &amp; apps are installed.<br />Any suggestion?</p>											<p class="post-edited">(Last edited by <strong>meazz1</strong> on 4 Apr 2016, 05:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318066">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						4 Apr 2016, 05:15					</div>
				</div>
				<div class="post-content content">
					<p>What type of filesystem, i.e. ext4, etc., is formatted on the HDD? Also, make sure your device has a support for such a filesystem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318075">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">npkamen</div>
					<div class="post-datetime">
						4 Apr 2016, 07:38					</div>
				</div>
				<div class="post-content content">
					<p>What the router is doing on the network side is independent of what it is doing elsewhere.</p><p>Go through the wiki entries on usb storage and it should set you up fine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318155">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">meazz1</div>
					<div class="post-datetime">
						4 Apr 2016, 21:34					</div>
				</div>
				<div class="post-content content">
					<p>it looks like if I the router is setup as a dumb access point, &quot;opkg update&quot; or any &quot;opkg install&quot; work. From this I get that USB support does not work also if it&#039;s setup as just an access point.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318181">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">npkamen</div>
					<div class="post-datetime">
						5 Apr 2016, 01:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>meazz1 wrote:</cite><blockquote><p>it looks like if I the router is setup as a dumb access point, &quot;opkg update&quot; or any &quot;opkg install&quot; work. From this I get that USB support does not work also if it&#039;s setup as just an access point.</p></blockquote></div><p>Set up the network interface correctly (use DHCP client or set the gateway and DNS settings manually) and it will work fine.</p><p>OpenWRT doesn&#039;t have a &quot;dumb access point&quot; mode.&nbsp; Only an incorrectly configured system will stop package installation working.</p><p>OpenWRT doesn&#039;t really have modes like you suggest.&nbsp; It is basically a lightweight linux system which you can configure to do various routing (and other) functions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318186">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						5 Apr 2016, 02:09					</div>
				</div>
				<div class="post-content content">
					<p>In general, USB operation is independent of router or dumb AP.&nbsp; Your premise is not correct.</p><p>Start by listing your installed USB packages.&nbsp; I will not assume you have them correct.&nbsp; Did you create an FSTAB file?&nbsp; What file system is your USB device?&nbsp; NTFS is know to have issues.&nbsp; Eliminate this issue.&nbsp; Set if up and get it working on either EXT or FAT32.&nbsp; What is your primary router and it&#039;s OS?</p><p>There actually is a &quot;Dumb AP&quot; configuration, but it&#039;s pretty basic.&nbsp; Set an IP for the device and disable DHCP, connect to the LAN port as opposed to the WAN port.&nbsp; I ignore the firewall rules, as they substantially impact the WAN (and it works for me).&nbsp; That said there are some firewall rules that are needed for running USB, and I am not sure where these need to be set, on the AP or the router.&nbsp; Don&#039;t worry about that yet.&nbsp; If you do not see mount points (under System) and Network Shares (under Services =&gt; Do you have a Services tab?), you have a more basic issue.</p><p>I actually think that for a dumb AP that packages and diagnostics may stop working.&nbsp; I will have to look into my notes if this is an issue, for you but I think there was a setting (DNS?) that I need to change.&nbsp; You can probably find it by searching the Dump AP threads with my name on it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318199">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">meazz1</div>
					<div class="post-datetime">
						5 Apr 2016, 04:29					</div>
				</div>
				<div class="post-content content">
					<p>The usb hdd is ext4 formatted. When I hook up the drive nothing shows up in system or service tab.<br />there&#039;s no sda, sdb ete in /dev folder. I did set an IP for the device and disabled DHCP, connected to the LAN and also disabled firewall as suggested in wiki.</p><p>There&#039;s wiki for setting up as &quot;dumb access point&quot;. <br /><a href="https://wiki.openwrt.org/doc/recipes/dumbap">https://wiki.openwrt.org/doc/recipes/dumbap</a></p><p>Screenshots of installed USB apps and system and service tab<br /><a href="http://postimg.org/image/tmqen5h4v/"><span class="postimg"><img src="http://s19.postimg.org/tmqen5h4v/Screenshot_from_2016_04_04_21_19_20.png" alt="http://s19.postimg.org/tmqen5h4v/Screenshot_from_2016_04_04_21_19_20.png" /></span></a></p><p><a href="http://postimg.org/image/qh5swxyin/"><span class="postimg"><img src="http://s19.postimg.org/qh5swxyin/Screenshot_from_2016_04_04_21_19_48.png" alt="http://s19.postimg.org/qh5swxyin/Screenshot_from_2016_04_04_21_19_48.png" /></span></a></p>											<p class="post-edited">(Last edited by <strong>meazz1</strong> on 5 Apr 2016, 04:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318200">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">npkamen</div>
					<div class="post-datetime">
						5 Apr 2016, 04:36					</div>
				</div>
				<div class="post-content content">
					<p>If you followed that dumb AP recipe then all you need to do to allow packages to be installed is to give the LAN interface a gateway and dns address.&nbsp; Also make sure that your AP is on the same network subnet as your main network (preferably assign an IP that is outside of the DHCP pool of your main router too).</p><p>What filesystem and mounting tools have you installed?&nbsp; Might be best to just give us a complete list of packages.</p><p>Use <br /></p><div class="codebox"><pre><code>opkg list-installed</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318203">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">meazz1</div>
					<div class="post-datetime">
						5 Apr 2016, 04:45					</div>
				</div>
				<div class="post-content content">
					<p>The router as access point is working but &quot;opkg update&quot; fails. This leads me to believe that if nothing is connected to wan port, an update does not work.</p><p>opkg list-installed.</p><div class="codebox"><pre><code>Package name    Version
Remove    adblock    1.0.2-1
Remove    base-files    168-r49114
Remove    busybox    1.24.1-2
Remove    dnsmasq    2.75-6
Remove    dropbear    2015.71-2
Remove    firewall    2016-01-29
Remove    fstools    2016-01-10-96415afece..d21
Remove    hostapd-common    2016-01-15-2
Remove    ip6tables    1.4.21-2
Remove    iptables    1.4.21-2
Remove    iw    4.3-1
Remove    iwinfo    2016-01-25-e4aca3910d..9bf
Remove    jshn    2016-02-26-5326ce1046..083
Remove    jsonfilter    2014-06-19-cdc760c580..9a9
Remove    kernel    4.1.20-1-ad09f1e84cc2..0e0
Remove    kmod-ath    4.1.20+2016-01-10-1
Remove    kmod-ath9k    4.1.20+2016-01-10-1
Remove    kmod-ath9k-common    4.1.20+2016-01-10-1
Remove    kmod-cfg80211    4.1.20+2016-01-10-1
Remove    kmod-gpio-button-hotplug    4.1.20-2
Remove    kmod-ip6tables    4.1.20-1
Remove    kmod-ipt-conntrack    4.1.20-1
Remove    kmod-ipt-core    4.1.20-1
Remove    kmod-ipt-nat    4.1.20-1
Remove    kmod-ledtrig-usbdev    4.1.20-1
Remove    kmod-lib-crc-ccitt    4.1.20-1
Remove    kmod-mac80211    4.1.20+2016-01-10-1
Remove    kmod-nf-conntrack    4.1.20-1
Remove    kmod-nf-conntrack6    4.1.20-1
Remove    kmod-nf-ipt    4.1.20-1
Remove    kmod-nf-ipt6    4.1.20-1
Remove    kmod-nf-nat    4.1.20-1
Remove    kmod-nls-base    4.1.20-1
Remove    kmod-ppp    4.1.20-1
Remove    kmod-pppoe    4.1.20-1
Remove    kmod-pppox    4.1.20-1
Remove    kmod-slhc    4.1.20-1
Remove    kmod-usb-core    4.1.20-1
Remove    kmod-usb-ohci    4.1.20-1
Remove    kmod-usb2    4.1.20-1
Remove    libblobmsg-json    2016-02-26-5326ce1046..083
Remove    libc    1.1.14-1
Remove    libexpat    2.1.0-3
Remove    libgcc    5.3.0-1
Remove    libip4tc    1.4.21-2
Remove    libip6tc    1.4.21-2
Remove    libiwinfo    2016-01-25-e4aca3910d..9bf
Remove    libiwinfo-lua    2016-01-25-e4aca3910d..9bf
Remove    libjson-c    0.12-1
Remove    libjson-script    2016-02-26-5326ce1046..083
Remove    liblua    5.1.5-1
Remove    libnl-tiny    0.1-5
Remove    libopenssl    1.0.2g-1
Remove    libpcre    8.38-2
Remove    libpthread    1.1.14-1
Remove    librt    1.1.14-1
Remove    libubox    2016-02-26-5326ce1046..083
Remove    libubus    2016-01-26-619f3a160d..11c
Remove    libubus-lua    2016-01-26-619f3a160d..11c
Remove    libuci    2016-02-02.1-1
Remove    libuci-lua    2016-02-02.1-1
Remove    libuclient    2016-01-28-2e0918c7e0..5f3
Remove    libxtables    1.4.21-2
Remove    lua    5.1.5-1
Remove    luci    git-16.092.45070-c5c199b-1
Remove    luci-app-adblock    git-16.092.45070-c5c199b-1
Remove    luci-app-firewall    git-16.092.45070-c5c199b-1
Remove    luci-base    git-16.092.45070-c5c199b-1
Remove    luci-lib-ip    git-16.092.45070-c5c199b-1
Remove    luci-lib-jsonc    git-16.092.45070-c5c199b-1
Remove    luci-lib-nixio    git-16.092.45070-c5c199b-1
Remove    luci-mod-admin-full    git-16.092.45070-c5c199b-1
Remove    luci-proto-ipv6    git-16.092.45070-c5c199b-1
Remove    luci-proto-ppp    git-16.092.45070-c5c199b-1
Remove    luci-theme-bootstrap    git-16.092.45070-c5c199b-1
Remove    mtd    21
Remove    netifd    2016-03-04-da687c2689..554
Remove    odhcp6c    2015-09-04-dc186d6d2b..6d9
Remove    odhcpd    2015-11-19-01d3f9d644..762
Remove    opkg    9c97d5ecd795709c8584e..-12
Remove    ppp    2.4.7-8
Remove    ppp-mod-pppoe    2.4.7-8
Remove    procd    2016-03-09-b12bb150ed..860
Remove    rpcd    2015-01-10-f00890cd6e..7c5
Remove    swconfig    10
Remove    uboot-envtools    2015.10-1
Remove    ubox    2016-03-07-fd4bb41ee7..23b
Remove    ubus    2016-01-26-619f3a160d..11c
Remove    ubusd    2016-01-26-619f3a160d..11c
Remove    uci    2016-02-02.1-1
Remove    uclient-fetch    2016-01-28-2e0918c7e0..5f3
Remove    uhttpd    2015-11-08-fe01ef3f52..6b7
Remove    uhttpd-mod-ubus    2015-11-08-fe01ef3f52..6b7
Remove    usign    2015-05-08-cf8dcdb8a4..131
Remove    wget    1.17.1-1
Remove    wpad-mini    2016-01-15-2
Remove    zlib    1.2.8-1</code></pre></div>											<p class="post-edited">(Last edited by <strong>meazz1</strong> on 5 Apr 2016, 04:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318204">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">npkamen</div>
					<div class="post-datetime">
						5 Apr 2016, 05:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>The router as access point is working but &quot;opkg update&quot; fails. This leads me to believe that if nothing is connected to wan port, an update does not work.</p></blockquote></div><p>Which is why I said you need to configure your LAN to have gateway/DNS settings.&nbsp; What does your /etc/config/network file look like?</p><div class="quotebox"><blockquote><p>opkg list-installed.</p></blockquote></div><p>Looks like you don&#039;t have anything other than basic USB support installed.&nbsp; Get your gateway/DNS in order and then follow this guide to install the rest of the packages required.</p><p><a href="https://wiki.openwrt.org/doc/howto/usb.storage">https://wiki.openwrt.org/doc/howto/usb.storage</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318207">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						5 Apr 2016, 05:26					</div>
				</div>
				<div class="post-content content">
					<p>You may also want to read:</p><p>Samba (3)<br /><a href="http://wiki.openwrt.org/doc/howto/cifs.server">http://wiki.openwrt.org/doc/howto/cifs.server</a><br />Share USB Hard-drive with Samba (4)<br /><a href="http://wiki.openwrt.org/doc/recipes/usb-storage-samba-webinterface">http://wiki.openwrt.org/doc/recipes/usb … binterface</a><br />Samba (smb) (6)<br /><a href="http://wiki.openwrt.org/doc/uci/samba">http://wiki.openwrt.org/doc/uci/samba</a><br />Linux Permissons on files and folders (7)<br /><a href="http://www.grymoire.com/Unix/Permissions.html">http://www.grymoire.com/Unix/Permissions.html</a><br />Block Mount (8)<br /><a href="http://wiki.openwrt.org/doc/techref/block_mount">http://wiki.openwrt.org/doc/techref/block_mount</a> <br />Partitioning, Formatting and Mounting Storage Devices<br /><a href="http://wiki.openwrt.org/doc/howto/storage">http://wiki.openwrt.org/doc/howto/storage</a> (9)<br />Fstab Configuration (10)<br /><a href="http://wiki.openwrt.org/doc/uci/fstab?s">http://wiki.openwrt.org/doc/uci/fstab?s</a>[]=enabled&amp;s[]=fsck</p><p>Ignore the numbers in parens, they are for my reference.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318208">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">meazz1</div>
					<div class="post-datetime">
						5 Apr 2016, 05:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>npkamen wrote:</cite><blockquote><div class="quotebox"><blockquote><p>The router as access point is working but &quot;opkg update&quot; fails. This leads me to believe that if nothing is connected to wan port, an update does not work.</p></blockquote></div><p>Which is why I said you need to configure your LAN to have gateway/DNS settings.&nbsp; What does your /etc/config/network file look like?</p><div class="quotebox"><blockquote><p>opkg list-installed.</p></blockquote></div><p>Looks like you don&#039;t have anything other than basic USB support installed.&nbsp; Get your gateway/DNS in order and then follow this guide to install the rest of the packages required.</p><p><a href="https://wiki.openwrt.org/doc/howto/usb.storage">https://wiki.openwrt.org/doc/howto/usb.storage</a></p></blockquote></div><p>Can you tell me how do i setup getway/dns?</p><br /><div class="codebox"><pre><code>root@amgg2:~# cat /etc/config/network 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fda3:be93:6e51::/48&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option ifname &#039;eth1&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;192.168.1.5&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcp&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcpv6&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;1 2 3 4 0&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;5 6&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318209">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">npkamen</div>
					<div class="post-datetime">
						5 Apr 2016, 05:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Can you tell me how do i setup getway/dns?</p></blockquote></div><p>Edit the LAN interface in the web interface (Luci) and configure the gateway and &quot;Use Custom DNS&quot; fields with the correct information (usually both will be set to the address of your router, my wild guess is that yours is 192.168.1.1).</p><p>Your network configuration is definitely incomplete if you&#039;d like to access the internet from your router (which is needed to install extra packages).&nbsp; Setting the gateway and DNS will fix this.</p>											<p class="post-edited">(Last edited by <strong>npkamen</strong> on 5 Apr 2016, 05:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318210">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">meazz1</div>
					<div class="post-datetime">
						5 Apr 2016, 05:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>npkamen wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Can you tell me how do i setup getway/dns?</p></blockquote></div><p>Edit the LAN interface in the web interface (Luci) and configure the gateway and &quot;Use Custom DNS&quot; fields with the correct information (usually both will be set to the address of your router, my wild guess is that yours is 192.168.1.1).</p><p>Your network configuration is definitely incomplete if you&#039;d like to access the internet from your router (which is needed to install extra packages).&nbsp; Setting the gateway and DNS will fix this.</p></blockquote></div><p>Your wild guess is spot on, lol, and thanks.<br />Ok, after installing &quot;kmod-usb-storage block-mount kmod-fs-ext4&quot;, I see mount point in system tab and able to mount my usb hdd.</p><p>I really appreciate the help.</p>											<p class="post-edited">(Last edited by <strong>meazz1</strong> on 5 Apr 2016, 06:00)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>