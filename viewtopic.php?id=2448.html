<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Blacklisting certain sites? (pornography etc)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p11394">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">netblade</div>
					<div class="post-datetime">
						27 Aug 2005, 20:20					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I am using a wrt54g v2.2 router with openwrt experimental installed on it.&nbsp; Everything is working fine.</p><br /><p>I am using it in a public location where there children around and therefore would like to restrict access to safe websites only.&nbsp; &nbsp;Is there any way to do this?</p><p>I know that Net Nanny, Cyber Sitter, etc, offer services for this, but I think that all of those require you to download their software.&nbsp; That is not gonna work with a wireless environment as the user can choose to simply not download.&nbsp; I need a way to restrict access either on the router, itself or on another computer off-location.&nbsp; &nbsp;</p><p>Is here any parental control software, or gateway software for linux that would run on the wrt54g? Is there a way to use the RADIUS server to control this? </p><p>Anyone have any ideas?</p><p>Much appreciated!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11397">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">macsat</div>
					<div class="post-datetime">
						27 Aug 2005, 20:37					</div>
				</div>
				<div class="post-content content">
					<p>What about setting up a proxy (like sqid), and then deny access to certain sites?</p><p>I believe that a proxy can even block certain words, like &quot;F***, S**&quot; and so on...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11398">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">netblade</div>
					<div class="post-datetime">
						27 Aug 2005, 21:49					</div>
				</div>
				<div class="post-content content">
					<p>an internet proxy?</p><p>But wouldn&#039;t that require the user to enter the proxy information into the web browser?<br />Couldn&#039;t the user just choose not to enter that information, and browse whatever sites he chooses?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11399">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Grimson</div>
					<div class="post-datetime">
						27 Aug 2005, 21:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>netblade wrote:</cite><blockquote><p>But wouldn&#039;t that require the user to enter the proxy information into the web browser?<br />Couldn&#039;t the user just choose not to enter that information, and browse whatever sites he chooses?</p></blockquote></div><p>Then disable NAT and allow internet access via the proxy only.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11401">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">netblade</div>
					<div class="post-datetime">
						27 Aug 2005, 22:37					</div>
				</div>
				<div class="post-content content">
					<p>ok..</p><p>this is starting to make sense now.&nbsp; OK I&#039;m going to need a bit more help on setting this up.</p><p>So I have my openwrt box right now.. I would need a computer sitting between this and the internet connection to act as the proxy right?</p><p>How do I setup the wireless router to go through the proxy?<br />What proxy should I use on the computer? macsat you mentioned squid.. squid allows transparent proxying right?<br />And then I should use something like squidguard (http://www.squidguard.org/) which would take care of the content filtering.</p><br /><p>Ok now I need help on getting the wireless router to go through the proxy.. The proxy needs to be totally transparent (no client-side configuration needed).</p><p>Any ideas on how to do this?</p><p>Thanks a lot macsat and grimson! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11402">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ragzilla</div>
					<div class="post-datetime">
						27 Aug 2005, 22:43					</div>
				</div>
				<div class="post-content content">
					<p>you can run squid on the openwrt, and use iptables to do transparent proxy<br /><a href="http://www.squid-cache.org/Doc/FAQ/FAQ-17.html#ss17.4">http://www.squid-cache.org/Doc/FAQ/FAQ-17.html#ss17.4</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11404">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">netblade</div>
					<div class="post-datetime">
						27 Aug 2005, 23:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ragzilla wrote:</cite><blockquote><p>you can run squid on the openwrt, and use iptables to do transparent proxy<br /><a href="http://www.squid-cache.org/Doc/FAQ/FAQ-17.html#ss17.4">http://www.squid-cache.org/Doc/FAQ/FAQ-17.html#ss17.4</a></p></blockquote></div><p>Ok.. but I need to blacklist those porn/bomb making sites too..</p><p>I have a blacklist and it&#039;s over 10mb, no way it&#039;s gonna fit on the openwrt<br />So I need to put squid and the blacklist on a seperate computer..</p><p>How do I setup openwrt to go through that computer?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11406">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ragzilla</div>
					<div class="post-datetime">
						28 Aug 2005, 00:19					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://en.tldp.org/HOWTO/TransparentProxy-6.html">http://en.tldp.org/HOWTO/TransparentProxy-6.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11430">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">netblade</div>
					<div class="post-datetime">
						28 Aug 2005, 10:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ragzilla wrote:</cite><blockquote><p><a href="http://en.tldp.org/HOWTO/TransparentProxy-6.html">http://en.tldp.org/HOWTO/TransparentProxy-6.html</a></p></blockquote></div><p>Yeah I think i&#039;ll do it that way..</p><p>Question is, since my blacklist is on a seperate computer, do I need to install squid on both the openwrt AND the other computer as well? (E.g squid on openwrt is set to redirect all proxy requests to the other box)</p><p>Or can I just use iptables on the openwrt to redirect all requests directly to the other box WITHOUT having to install squid?</p><p>I don&#039;t really understand iptables that well, so I&#039;m sorry if this is a noobish question.</p><p>I appreciate all your help so far guys.. Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11436">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">goose54</div>
					<div class="post-datetime">
						28 Aug 2005, 13:36					</div>
				</div>
				<div class="post-content content">
					<p>I tried it out on my net which looks like this:</p><p>192.168.1.0 -&gt; wrt54gs(lan=192.168.1.1/wan=192.168.9.98) -&gt; squid/centos4.1(lan=192.168.9.10/wan=192.168.0.10) -&gt; firewall/router(lan=192.168.0.2/wan=dhcp) -&gt; adsl/router -&gt; internet</p><p>The wrt54gs is doing iptable redirection to the squid box running on the centos4.1 box (<a href="http://www.centos.org">www.centos.org</a>) with minor config changes.</p><p>Edited file://192.168.9.10/etc/squid/squid.conf<br /></p><div class="codebox"><pre><code>root@squid# diff /etc/squid/squid.conf /etc/squid/squid.conf.default
1860,1861c1860
&lt; acl our_networks src 192.168.9.0/24
&lt; http_access allow our_networks
---
&gt; #http_access allow our_networks
2092d2090
&lt; visible_hostname squid.dyndns.org
2180,2181c2178
&lt; httpd_accel_host virtual
&lt; httpd_accel_port 80
---
&gt; # httpd_accel_port 80
2210c2207
&lt; httpd_accel_with_proxy on
---
&gt; # httpd_accel_with_proxy off
2230c2227
&lt; httpd_accel_uses_host_header on
---
&gt; # httpd_accel_uses_host_header off</code></pre></div><p>Started up squid:<br /></p><div class="codebox"><pre><code>root@squid# service squid start
init_cache_dir /var/spool/squid... Starting squid: .       [  OK  ]</code></pre></div><p>Then did this to the wrt54gs box:<br /></p><div class="codebox"><pre><code>root@goose:/# iptables -t nat -A PREROUTING -i br0 -s ! 192.168.9.10 -p tcp --dport 80 -j DNAT --to 192.168.9.10:3128
root@goose:/# iptables -t nat -A POSTROUTING -o vlan1 -s 192.168.1.0 -d 192.168.9.10 -j SNAT --to 192.168.1.1
root@goose:/# iptables -A FORWARD -s 192.168.1.0 -d 192.168.9.10 -i br0 -o vlan1 -p tcp --dport 3128 -j ACCEPT</code></pre></div><p>Finally, did some browsing on the 192.168.1.10 to test.&nbsp; I didn&#039;t try to add a wireless network into the mix, just the lan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p22937">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hohlecow</div>
					<div class="post-datetime">
						16 Mar 2006, 02:22					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve been trying to set up a transparent proxy as well, and I have the proxy server set up, but can&#039;t seem to get routing working properly.</p><p>I have everything behind the router (the proxy, and the computers I want proxied).</p><p>My network is like this:</p><p>(local lan)&lt;--(192.168.11.0)--&gt;[router (lan=192.168.11.1,wan=DHCP from ISP)]&lt;---&gt;{INTARWEB}</p><p>The proxy server is a computer in the local lan with an ip address of 192.168.11.40.</p><p>The other computers in the lan should be sent to the proxy server to get out over port 80.</p><p>From reading the site linked and the previous example, these were the iptables rules I came up with:</p><div class="codebox"><pre><code>iptables -t nat -A PREROUTING -i br0 -s ! 192.168.11.40 -p tcp --dport 80 -j DNAT --to 192.168.11.40:8888
iptables -t nat -A POSTROUTING -o br0 -s 192.168.11.0 -d 192.168.11.40 -j SNAT --to 192.168.11.1
iptables -A FORWARD -s 192.168.11.0 -d 192.168.11.40 -i br0 -o br0 -p tcp --dport 8888 -j ACCEPT</code></pre></div><p>I would imagine the chain of events should be<br />- Make a request from 192.168.11.2 on port 80<br />- Request gets to the 192.168.11.1, which sends the request to 192.168.11.40:8888<br />- 192.168.11.40 takes the request, does its proxy thing, and then sends a request to 192.168.11.1 on port 80<br />- 192.168.11.1 lets the request through and returns the data to 192.168.11.40<br />- 192.168.11.40 returns the data to 192.168.11.2</p><p>Does that sound about right? what are my iptables rules missing?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p22950">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Kevin</div>
					<div class="post-datetime">
						16 Mar 2006, 07:37					</div>
				</div>
				<div class="post-content content">
					<p>I recommend you set up a seperate vlan and ip range for the proxy box.. it will make the routing and nat a lot cleaner and easier</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>