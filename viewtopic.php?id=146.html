<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> De-bricking after nvram clear</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p632">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">trooper</div>
					<div class="post-datetime">
						12 Jun 2004, 20:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>I have a wrt54g v2 box which looks like dead, firmware loading does not start.<br />This happened after manual clearing all variables from nvram.<br />I made a serial console adapter, plugged it in, but wrt54g doesn&#039;t output any signal to console.<br />Console adapter works fine with another wrt54g box.<br />It is unable to ping or arping the device.<br />Power led is blinking,&nbsp; wired interface led shows some activity (i.e. when packets are being sent from NIC to wrt54g device).</p><p>Can anyone suggest how to revive this box?<br />Is it able to access PMON in this case?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p633">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						12 Jun 2004, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>Should I assume that you already tried this?</p><p><a href="http://voidmain.is-a-geek.net/redhat/wrt54g_revival.html">http://voidmain.is-a-geek.net/redhat/wr … vival.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p634">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">trooper</div>
					<div class="post-datetime">
						12 Jun 2004, 21:15					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;re absolutelly right&nbsp; <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> <br />Shorting of pins 15-16 doesn&#039;t change behavior.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p635">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						12 Jun 2004, 21:16					</div>
				</div>
				<div class="post-content content">
					<p>Wow, maybe it&#039;s really bricked? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p636">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">trooper</div>
					<div class="post-datetime">
						13 Jun 2004, 12:13					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t beleive there is no way to recover it.<br />If I have flash programming device which understands this chip (Intel Flash TE28F320) I can pull out it from bricked unit and alive unit and just copy content from one flash to another. I beleive it will help. But I don&#039;t have such device. Maybe there are other ways to recover wrt54g box.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p637">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">trooper</div>
					<div class="post-datetime">
						13 Jun 2004, 12:19					</div>
				</div>
				<div class="post-content content">
					<p>I found this at seattlewireless site:<br />--------------<br />(3) the NVRAM *IS* needed for proper operation of the PMON; if you trash that into worthless garbage .. well you need a serial port to access the &#039;user&#039; interface of PMON to update the required parameters back to sane values<br />--------------<br />Does anybody know how can I access PMON in this case?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p651">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						14 Jun 2004, 05:55					</div>
				</div>
				<div class="post-content content">
					<p><strong>DO NOT DELETE ANY NVRAM VARIABLES</strong></p><p>The nvram area is a fixed size, deleting an nvram variable will free a few bytes of nvram storage but the savings are insignifigant -- the nvram area can only be used to store nvram data and most people already have a few k of nvram free. OpenWRT does not require any modifications to nvram and will not create any new variables; packages and modified files are stored on a jffs2 filesystem which is compressed and separate from nvram. </p><p>The bootloader (pmon for 1.x and cfe for 2.x/gs) will require a handful of variables to even boot -- deleting these variables will break your unit.</p><p><strong>DO NOT DELETE ANY NVRAM VARIABLES</strong></p><p>The pin 15/16 trick ties two address bits together which essentially redirects the read from one address to another address which differs by one bit. This rearranegment of data will be detected when the bootloader performs a CRC check just prior to booting, triggering a state similar to that of boot_wait.</p><p>The key thing here is that pins 15 and 16 are specific to the v2 and will only cause corruption of the firmware; this works great for recovering from bad firmware but if nvram is broken the bootloader may not even get to the point of trying to the firmware.</p><p>Here are some notes which may help:<br />* The power led of any v1.1 or later can be set to blink, the blinking is done in hardware and the led will continue to blink until set otherwise, even if the software crashes.</p><p>* The lan ports will all flash briefly when the admtek chip controlling the switch is reset; this happens once at powerup and again when the ethernet drivers are loaded. (OpenWRT will stop the power/diag flashes and turn on the DMZ led at bootup&nbsp; &nbsp;prior to loading the ethernet driver)</p><p>* Holding down the reset button while powering on a v2 will cause the nvram to be reset to defaults stored in cfe, but not until after cfe tries initialize itself using a few variables from nvram.</p><p>* Shorting a different set of address pins may hide the starting signature of nvram forcing cfe to boot entirely from the copy of nvram embedded in cfe.</p><p>...</p><p>Given that nothing happens on the serial I&#039;d be concerned if the bootloader was even working.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p654">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">trooper</div>
					<div class="post-datetime">
						14 Jun 2004, 13:53					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for tips.</p><p>1 and 2 - clear.<br />3 - does not help. reset button has no effect.<br />4 - where can I find details which exactly pins I need to short?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p657">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						14 Jun 2004, 16:36					</div>
				</div>
				<div class="post-content content">
					<p>pinouts for the intel flash chips can be found at developer.intel.com</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p664">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						15 Jun 2004, 07:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>The key thing here is that pins 15 and 16 are specific to the v2 and will only cause corruption of the firmware; this works great for recovering from bad firmware but if nvram is broken the bootloader may not even get to the point of trying to the firmware.</p></blockquote></div><p>I believe I must be misunderstanding what you are saying above. The way I read the above you are saying that shorting pins 15 and 16 will only work on the v2 routers. I do know that this also works on the v1.1 routers because that&#039;s what I used in my revival HOWTO. Can you clarify your quote so I understand it clearly? Do you see any problems with my document (other than it will not recover deleted NVRAM variables)? Here&#039;s the one I am referring to:</p><p><a href="http://voidmain.is-a-geek.net/redhat/wrt54g_revival.html">http://voidmain.is-a-geek.net/redhat/wr … vival.html</a></p><p>You seem very knowledgeable on the subject and I would like to be as accurate as possible. The above document receives quite a number of hits (relative to the rest of my shabby site) and I believe it has helped some people.</p><p>Sorry if this is off topic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2276">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">bitkocher</div>
					<div class="post-datetime">
						26 Sep 2004, 10:56					</div>
				</div>
				<div class="post-content content">
					<p>It works with board 1.1</p><p>It works not, if nvram contains garbage.</p><p>Is there a way to reanimate nvram for 1.1 (flash is ok) ?</p><p>What has happened:</p><p>1. Update to OpenWRT CVS version 2004-09-26</p><p>2. Change of wan ip address in nvram</p><p>3. nvram commit</p><p>4. after return of &quot;nvram commit&quot; powercycle</p><p>Now red led is on (not flashing). Pin 15/16 shortcircuit does no longer work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2305">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Jaap</div>
					<div class="post-datetime">
						28 Sep 2004, 22:31					</div>
				</div>
				<div class="post-content content">
					<p>I have a Linksys v.1, also changed the wan address and the thing shows a steady red diag light after reboot.</p><p>When you turn it on now, both diag and power burn continuesly.</p><p>and no, also for me the pin shortcut trick does not seem to work... </p><p>Using todays cvs code, maybe this is a new &quot;feature&quot; ?</p><p>I found out that my Linksys does not have the Intel Flash, but an AMD version (AM29LV320DB). AMD has a pdf with the layout online. I tried connecting pin 12 to both Vss(27) and Vcc (37) but no luck...</p><p>See <a href="http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/23579c5.pdf">http://www.amd.com/us-en/assets/content … 3579c5.pdf</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2349">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">dev</div>
					<div class="post-datetime">
						1 Oct 2004, 00:05					</div>
				</div>
				<div class="post-content content">
					<p>My Wrt54g v1.0 the same</p><p>have commit an lan_ipaddr change,</p><p>reboot</p><p>and now: DIAG = RED permanent</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2351">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">dev|ant</div>
					<div class="post-datetime">
						1 Oct 2004, 01:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>My Wrt54g v1.0 the same<br />have commit an lan_ipaddr change,<br />reboot<br />and now: DIAG = RED permanent</p></blockquote></div><p>I had this happen to my v1.0 yesterday, and was a bit dissapointed because til that point, OpenWRT had been an absolute blast. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>I&#039;ve got a serial port on it, and pmon just keeps looping this about once every second:</p><div class="quotebox"><blockquote><p>PMON version 5.3.22 [EL], LSI LOGIC Corp. and Broadcom Corp. <br /> Compiled on Tue Mar 4 17:32:29 2003 <br />CPU type 4710.CPU clock frequency 125 MHz. <br />mac_init(): Find mac [00:06:25:C5:XX:XX] in location 0 <br />Nothing...</p></blockquote></div><p>I tried the pin 15-16 trick, no change. So I tried further on... 16-17, no change. 17-18, no change. Now at some point things DID change, but I&#039;m not sure if it was 17-18 or 18-19. Now this is a fairly dangerous thing to do, but I figured the unit was dead anyway, no point holding back!</p><p>What happened when the last pair of pins was shorted was pmon rewrote the NVRAM from it&#039;s internal copy, then rebooted and loaded up normally.</p><p>I don&#039;t know if my results are reproducable.</p><p>I hadn&#039;t heard of the problem before, but it looks like it&#039;s fairly common. And from something as simple as changing an IP address. :cry:</p><p>I&#039;ll see if I can find out exactly what&#039;s going on...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2352">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">dev|ant</div>
					<div class="post-datetime">
						1 Oct 2004, 01:46					</div>
				</div>
				<div class="post-content content">
					<p>Just tested something: Telnet in, nvram commit (no other changes made), reboot... dead router. :cry:</p><p>Where is the nvram utility from (I don&#039;t have time to look now)? GS sources? Looks like it doesn&#039;t like the AMD flash chips on the v1.0 units.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2359">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">dev</div>
					<div class="post-datetime">
						1 Oct 2004, 11:18					</div>
				</div>
				<div class="post-content content">
					<p>I download this: <a href="http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/23579c5.pdf">http://www.amd.com/us-en/assets/content … 3579c5.pdf</a></p><p>What do you mean whit 17-18 or 18-19 Pin?</p><p>The CONNECTION DIAGRAMS in this pdf files says e.g.</p><p>pin 11 = WE#<br />pin 12 = RESET<br />pin 13 = NC<br />pin 14 = WP#/ACC<br />pin 15 = RY/BY#<br />pin 16 = A18<br />pin 17 = A17<br />pin 18 = A7<br />pin 19 = A6</p><p>I want to repair my baby, please give me a hint!&nbsp; :?:</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2384">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">dev|ant</div>
					<div class="post-datetime">
						2 Oct 2004, 07:49					</div>
				</div>
				<div class="post-content content">
					<p>To tell you the truth I&#039;m not really sure. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> It might be as far up as 18-19. It seems the worst you can do though is lock the unit up, which can be fixed by a power cycle.</p><p>pmon seems to reboot about twice a second so all you need to do is quickly join the pins and let go again, if the DMZ light doesn&#039;t come on in a few seconds power cycle and try again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2385">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						2 Oct 2004, 08:40					</div>
				</div>
				<div class="post-content content">
					<p>v1.0 issues:</p><p>I was looking into the &#039;nvram commit broke it&#039; issues earlier today and confirmed the issue exists on the v1.0 (and hence the sticky post at the top of this forum). The fact that it actually broke took me a bit by surprise, but the device was easily recovered.</p><p>It runs in my mind that I used pins 15-16 (I didn&#039;t have the AMD datasheet handy) but I haven&#039;t gone back to confirm this.</p><p>steps taken<br />1. unplug</p><p>2. open<br />(on v1.0&#039;s you don&#039;t need to remove the antennas)</p><p>3. short pins of the flash (15-16?)</p><p>4. carefully plug in<br />(while still shorting the pins -- easier said than done)</p><p>5. watch bootup<br />When the switch powers up it will flash all the switch leds breifly</p><p>-- If the switch leds don&#039;t light: You&#039;ve shorted more than just the flash, immediately stop shorting the pins. The switch leds should light as soon as you stop shorting the pins; if they don&#039;t flash the next time you power on, check to see that none of the pins are bent.</p><p>-- After they switch leds flash, watch the diag and dmz leds. If there&#039;s any change in the dmz led you should stop shorting the pins and wait for bootup. The diag led will go off and the dmz led should come on; the dmz led signals openwrt booting and running the preinit script. When openwrt is fully booted the dmz led will go off and the wireless led will be on.</p><p>-- If openwrt is booting but you still can&#039;t get in, use openwrt&#039;s failsafe mode: reboot by unplugging and wait for the dmz led (you don&#039;t need to short pins, nvram was already reset) press and hold the reset button for 1-2 seconds as soon as you see the dmz led, telnet to 192.168.1.1</p><p>-- Switching firmwares: Since the nvram command can&#039;t be used for setting boot_wait, the recommended solution is to use the mtd write command. This will require a trx file; see the following example:<br /></p><div class="codebox"><pre><code>cd /tmp
wget http://openwrt.org/downloads/openwrt-v1-recovery.trx
mtd write openwrt-v1-recovery.trx linux
reboot</code></pre></div><p>(the above trx is just the normal snapshot from 20040918, confirmed to work on the v1.0)</p><p>...</p><p>If all else fails let us know, but at the very least the v1.0 has a minipci wireless card that you can use yourself or sell on ebay.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2390">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">mino</div>
					<div class="post-datetime">
						2 Oct 2004, 16:11					</div>
				</div>
				<div class="post-content content">
					<p>Okay Thx for that Instruction Sheet <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> but i still have a problem where are the Pin 15 and 16? On my Wrt54g v1.0 i found no AMD Chip or something like that. I google for it but i only found images of the version 1.1&lt;=. It would be really nice if someone can take a shot of his Wrt54g and mark the 2 Pins I need to reset <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2466">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						7 Oct 2004, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>I think the 1.0 board is similar to the 1.1 board but doesn&#039;t have the riser board. You should find an Intel Flash chip (should be written right on the chip). I have pictures in my howto that should give you a hint. The board is marked with the first and last pin numbers in the row of pins and there should be a white mark every 5 pins. Here are some pictures:</p><p><a href="http://voidmain.is-a-geek.net/redhat/wrt54g_revival.html">http://voidmain.is-a-geek.net/redhat/wr … vival.html</a></p><p>Click on the pictures to enlarge.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2468">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">Angel</div>
					<div class="post-datetime">
						7 Oct 2004, 17:04					</div>
				</div>
				<div class="post-content content">
					<p>AMD flash Recovery:</p><p>- Put pin 14 to ground and power on the AP.<br />- Use TFTP to upgrade firmware (use original linksys firmware).<br />- Wait boot.<br />- http://&quot;ip-ap&quot;<br />- Restore default configuration.<br />- Reboot<br />- Upgrade AP firmware if you want.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30393">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">bloobooger</div>
					<div class="post-datetime">
						13 Jul 2006, 08:25					</div>
				</div>
				<div class="post-content content">
					<p>It seems that I have the same problem as MBM. A FW upgrade to 3.04 for the WAP54G(v1) didn’t seem to take, now I cannot access the ap at neither its previous settings nor the factory defaults (after resetting, etc). Mine also uses AMD’s flash chip; shorting pin 16 to 17 and grounding 14 have no effect. The diag light does not stay on, and it seems that the unit successfully boots. When it’s hooked up to a lan (accommodating the factory default) or directly up to my laptop (which is MDIX enabled) the link/act led flickers. Angel (or anybody!), is there anything else I should try before salvaging the wireless mini pci and burning the rest?</p><p>This probably goes without saying, but the wifi link led is on yet netstumbler reports no activity in the air.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30992">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">deadwap54g</div>
					<div class="post-datetime">
						24 Jul 2006, 09:46					</div>
				</div>
				<div class="post-content content">
					<p>I have, (or perhaps should I say I had), a WAP54G v.1.0 with an AMD flash chip,<br />until I tried to upgrade the firmware to version 3.0x.&nbsp; </p><p>Now the situation seems to be exactly what bloobooger and mbm describe above,<br />namely:</p><p> a. the WAP appears to boot without problems, the diagnosis red led<br />&nbsp; &nbsp; does not remain on.</p><p> b. the WLAN led stays is on, however there is no detectable WLAN <br />&nbsp; &nbsp; &nbsp;connectivity</p><p> c. when connected directly to a computer the three LAN leds <br />&nbsp; &nbsp; &nbsp;are on, and at the top the activity led&nbsp; flickers when I try <br />&nbsp; &nbsp; &nbsp;to ping or to ftp to 192.168.1.1</p><p> d. I ping, or ftp to 192.168.1.1 or to 192.168.1.245 goes unanswered.</p><p> e. the reset button does not seem to anything at all, no matter how long <br />&nbsp; &nbsp; &nbsp;one holds it.</p><p>I have tried shorting pins 16 and 17, as well as grounding a few others.<br />I have also made a clumsy attempt to use a serial cable which came<br />with a cisco catalyst switch.&nbsp; &nbsp;I would also like to know whether there<br />is anything else which one can still try to load new firmware.</p><p>Also since I have only used linksys firmware I wonder whether somebody <br />might have tried to get help from them.</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51752">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">cdukes</div>
					<div class="post-datetime">
						3 Jul 2007, 20:15					</div>
				</div>
				<div class="post-content content">
					<p>Yeah, I have the same problem as these guys. I installed the latest openwrt on my WRT54G v1.0, wrote an ip address change to the device and it friggin bricked...that sucks :-(<br />I can&#039;t recover it using any of the methods described (pin shorting, grounding 14, etc).<br />The green power and red diag lights are the only things that work when I plug it in - and they stay on, no blinking.<br />Anyone have any ideas or is it time to buy a new one?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>