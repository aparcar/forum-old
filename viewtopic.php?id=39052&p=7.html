<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 7 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p198798">
				<div class="post-metadata">
					<div class="post-num">Post #151</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						18 Apr 2013, 15:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>headless.cross wrote:</cite><blockquote><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>There any changelog somewhere? I&#039;m testing your builds now.</p></blockquote></div><p>No changelog at all from my side, these are the binaries from the latest sources. All credits to Adze/arfett.<br />Thus, this changelog applies: <a href="https://github.com/Adze1502/mwan/commits/master">https://github.com/Adze1502/mwan/commits/master</a></p></blockquote></div><p>default config:</p><p>is this normal?</p><p><span class="postimg"><img src="http://i.imgur.com/2LWe2cH.jpg" alt="http://i.imgur.com/2LWe2cH.jpg" /></span></p><p>are the &quot;cfg0d92bd&quot; normal/intended?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198806">
				<div class="post-metadata">
					<div class="post-num">Post #152</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						18 Apr 2013, 16:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>are the &quot;cfg0d92bd&quot; normal/intended?</p></blockquote></div><p>This happens because the config sections are unnamed. Try to add a name after a rule (download the mwan3 config, using WinSCP, if you&#039;re a windows user or vi/nano it, if you&#039;re a linux user) and do something like this:</p><p>config rule &#039;name_of_rule&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp;blah blah<br />&nbsp; &nbsp; &nbsp; &nbsp;blah blah<br />&nbsp; &nbsp; &nbsp; &nbsp;blah blah</p><p>About detailed configuration you should read the starter post (if you haven&#039;t).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198810">
				<div class="post-metadata">
					<div class="post-num">Post #153</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						18 Apr 2013, 17:43					</div>
				</div>
				<div class="post-content content">
					<p><strong>#Question 7#</strong></p><div class="codebox"><pre><code> 
4x Track ips
   option &#039;reliability&#039; &#039;3&#039;
    option &#039;count&#039; &#039;1&#039;
    option &#039;timeout&#039; &#039;2&#039;
    option &#039;interval&#039; &#039;5&#039;
    option &#039;down&#039; &#039;3&#039;
    option &#039;up&#039; &#039;8&#039;</code></pre></div><p>I need better understanding of this.<br />Does this mean each test round is every 5 seconds? Within this 5 seconds it pings once only and if it timesout (2 sec) it will attempt to ping again?<br />Each 5 second interval is considered UP so long as 3 of 4 track ips reply.<br />It goes down only if 3 consecutive intervals of 5 seconds are considered down (that means less than 3 track ips reply) thus requiring 15 seconds in total?<br />It goes up only if 8 consecutive intervals of 5 seconds are considered up (3 or more track ips reply normally) thus requiring 40 seconds in total?</p><p>Have i gotten this wrong?</p><p><strong>#Question 8#</strong></p><div class="quotebox"><blockquote><p>Members within one policy with a lower metric have precedence over higher metric members. Members with the same metric will load-balance. Load balancing members (with same metric) will distribute load based on those weights values.</p></blockquote></div><p>Does this mean that rules that fall under the following policy..</p><div class="codebox"><pre><code>config &#039;policy&#039; &#039;wan2_pri_wan1_sec&#039;
    list &#039;use_member&#039; &#039;wan1_m2_w3&#039;
    list &#039;use_member&#039; &#039;wan2_m1_w2&#039;</code></pre></div><p>Does it mean that traffic under this policy will fall under wan2 (thus not load balanced) and if wan2 goes down, that&#039;s only when traffic under this policy will fail back to wan1?</p><p>-I do not want it to be load balancing- Just want to route all traffic of certain ports to WAN2 which has failover protection.</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 18 Apr 2013, 19:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198836">
				<div class="post-metadata">
					<div class="post-num">Post #154</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						18 Apr 2013, 21:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p><strong>#Question 7#</strong></p><div class="codebox"><pre><code> 
4x Track ips
   option &#039;reliability&#039; &#039;3&#039;
    option &#039;count&#039; &#039;1&#039;
    option &#039;timeout&#039; &#039;2&#039;
    option &#039;interval&#039; &#039;5&#039;
    option &#039;down&#039; &#039;3&#039;
    option &#039;up&#039; &#039;8&#039;</code></pre></div><p>I need better understanding of this.</p></blockquote></div><p>This is mentioned earlier in this thread, but here goes:</p><p>reliability = how many track_ip hosts at minimum should respond to echo requests, before assuming the test successful.<br />count = how many echo requests should be sent to each track_ip host. At least one reply is needed for the hosts to be considered reachable<br />timeout = time in seconds to wait for an echo response, after an echo request has been sent.<br />interval = time in seconds to wait between tests<br />down = when interface is UP: the number of failed tests in a row, to consider this interface DOWN<br />up = when interface is DOWN: the number of successful tests in a row, to consider this interface UP</p><p>By one test i mean all the track_ip hosts are tested. A test result is either a succes or a fail. </p><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p><strong>#Question 8#</strong></p><div class="quotebox"><blockquote><p>Members within one policy with a lower metric have precedence over higher metric members. Members with the same metric will load-balance. Load balancing members (with same metric) will distribute load based on those weights values.</p></blockquote></div><p>Does this mean that rules that fall under the following policy..</p><div class="codebox"><pre><code>config &#039;policy&#039; &#039;wan2_pri_wan1_sec&#039;
    list &#039;use_member&#039; &#039;wan1_m2_w3&#039;
    list &#039;use_member&#039; &#039;wan2_m1_w2&#039;</code></pre></div><p>..will fall under wan2 (thus not load balanced) and if wan2 goes down, that&#039;s only when traffic under this policy will fail back to wan1?</p></blockquote></div><p>Yes</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198847">
				<div class="post-metadata">
					<div class="post-num">Post #155</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						18 Apr 2013, 23:19					</div>
				</div>
				<div class="post-content content">
					<p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198884">
				<div class="post-metadata">
					<div class="post-num">Post #156</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						19 Apr 2013, 10:03					</div>
				</div>
				<div class="post-content content">
					<p>Still no time to test the binaries. I hope there will be a &quot;time hole&quot; this weekend to play with multiwan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198886">
				<div class="post-metadata">
					<div class="post-num">Post #157</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						19 Apr 2013, 10:09					</div>
				</div>
				<div class="post-content content">
					<p>Adze,</p><p>Just to avoid confusion maybe the default rules in /etc/config/mwan3 should be named so it doesn&#039;t show up as &quot;cfg######&quot; on the GUI?</p><p>Even just &quot;rule 1&quot; &quot;rule 2&quot; or whatever you please.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198988">
				<div class="post-metadata">
					<div class="post-num">Post #158</div>
					<div class="post-author">gendouhydeist</div>
					<div class="post-datetime">
						20 Apr 2013, 10:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi did you close your SVN?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199004">
				<div class="post-metadata">
					<div class="post-num">Post #159</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Apr 2013, 13:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gendouhydeist wrote:</cite><blockquote><p>Hi did you close your SVN?</p></blockquote></div><p>Yes. I have opened a github project: <a href="https://github.com/Adze1502/mwan">https://github.com/Adze1502/mwan</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199026">
				<div class="post-metadata">
					<div class="post-num">Post #160</div>
					<div class="post-author">gendouhydeist</div>
					<div class="post-datetime">
						20 Apr 2013, 16:30					</div>
				</div>
				<div class="post-content content">
					<p>Just a theory, is it possible to use mwan on multiple wifi sources? like relayd? if not what are the options?</p>											<p class="post-edited">(Last edited by <strong>gendouhydeist</strong> on 20 Apr 2013, 16:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199027">
				<div class="post-metadata">
					<div class="post-num">Post #161</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Apr 2013, 16:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gendouhydeist wrote:</cite><blockquote><p>Just a theory, is it possible to use mwan on multiple wifi sources?</p></blockquote></div><p>That should work. If each wifi &quot;source&quot; has it&#039;s own network interface in /etc/config/network and a default route.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199030">
				<div class="post-metadata">
					<div class="post-num">Post #162</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						20 Apr 2013, 17:11					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve named my wan&#039;s abc1 and abc2 for personal reasons.</p><div class="codebox"><pre><code>ping -c 1 -I eth0.3 google.com == timeout
ping -c 1 -I eth0.4 google.com == OK
ping -c 1 -I pppoe-abc1 google.com == OK</code></pre></div><p>abc1 = pppoe-abc1 (which is pppoe off vlan3 = eth0.3)<br />abc2 = eth0.4</p><p>ip route show<br /></p><div class="codebox"><pre><code>default via 110.159.xx.xxx dev pppoe-abc1  proto static  metric 10 
default via 192.168.202.1 dev eth0.4  proto static  metric 20 
110.159.xx.xxx dev pppoe-abc1  proto kernel  scope link  src 110.159.yy.yyy 
192.168.0.0/24 dev br-lan  proto kernel  scope link  src 192.168.0.254 
192.168.21.0/24 dev wlan0-1  proto kernel  scope link  src 192.168.21.254 
192.168.202.0/24 dev eth0.4  proto static  scope link  metric 20 </code></pre></div><p>ip rule show<br /></p><div class="codebox"><pre><code>0:    from all lookup local 
1001:    from all fwmark 0x100/0xff00 lookup 1001 
1002:    from all fwmark 0x200/0xff00 lookup 1002 
1016:    from all fwmark 0x1000/0xff00 lookup 1016 
1017:    from all fwmark 0x1100/0xff00 lookup 1017 
1018:    from all fwmark 0x1200/0xff00 lookup 1018 
1019:    from all fwmark 0x1300/0xff00 lookup 1019 
1020:    from all fwmark 0x1400/0xff00 lookup 1020 
32766:    from all lookup main 
32767:    from all lookup default </code></pre></div><p>ip rule list table #above#</p><div class="codebox"><pre><code>1001:
default via 110.159.xx.xxx dev pppoe-abc1 
1002:
default via 192.168.202.1 dev eth0.4 
1016:
default via 110.159.xx.xxx dev pppoe-abc1  metric 1 
blackhole default  metric 1000 
1017:
default via 192.168.202.1 dev eth0.4  metric 1 
blackhole default  metric 1000 
1018:
default  metric 1 
    nexthop via 192.168.202.1  dev eth0.4 weight 2
    nexthop via 110.159.xx.xxx  dev pppoe-abc1 weight 3
blackhole default  metric 1000 
1019:
default via 110.159.xx.xxx dev pppoe-abc1  metric 1 
default via 192.168.202.1 dev eth0.4  metric 2 
blackhole default  metric 1000 
1020:
default via 192.168.202.1 dev eth0.4  metric 1 
default via 110.159.xx.xxx dev pppoe-abc1  metric 2 
blackhole default  metric 1000 </code></pre></div><p>iptables -L mwan3_* -t mangle -v -n<br /></p><div class="codebox"><pre><code>Chain mwan3_pre (2 references)
 pkts bytes target     prot opt in     out     source               destination         
39644 5359K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff00 
22909 2745K mwan3_track_eth0.4  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 
 7616 1689K MARK       all  --  eth0.4 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8200/0xff00 
16215 1173K mwan3_track_pppoe-abc1  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 
  276 21518 MARK       all  --  pppoe-abc1 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8100/0xff00 
26109 1962K mwan3_default  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 
 1894 89325 mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 </code></pre></div><div class="codebox"><pre><code>Chain mwan3_post (2 references)
 pkts bytes target     prot opt in     out     source               destination         
10784  445K MARK       all  --  *      eth0.4  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x200/0xff00 
   49  3627 MARK       all  --  *      pppoe-abc1  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x100/0xff00 
21629 4635K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x8000/0x8000 MARK and 0xffff7fff 
38694 5367K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff00 </code></pre></div><div class="codebox"><pre><code>Chain mwan3_default (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    3    96 MARK       all  --  *      *       0.0.0.0/0            224.0.0.0/3         mark match !0x8000/0x8000 MARK or 0x8000 
    0     0 MARK       all  --  *      *       0.0.0.0/0            110.159.xx.xxx      mark match !0x8000/0x8000 MARK or 0x8000 
 4385  615K MARK       all  --  *      *       0.0.0.0/0            192.168.0.0/24      mark match !0x8000/0x8000 MARK or 0x8000 
    0     0 MARK       all  --  *      *       0.0.0.0/0            192.168.21.0/24     mark match !0x8000/0x8000 MARK or 0x8000 
    0     0 MARK       all  --  *      *       0.0.0.0/0            192.168.202.0/24    mark match !0x8000/0x8000 MARK or 0x8000 </code></pre></div><div class="codebox"><pre><code>Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  235 12924 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x1400/0xff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x1400/0xff00 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 10101 mark match 0x0/0xff00 MARK xset 0x1400/0xff00 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 12000 mark match 0x0/0xff00 MARK xset 0x1400/0xff00 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 19000 mark match 0x0/0xff00 MARK xset 0x1400/0xff00 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 30001 mark match 0x0/0xff00 MARK xset 0x1400/0xff00 
    0     0 MARK       udp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 12000 mark match 0x0/0xff00 MARK xset 0x1400/0xff00 
    0     0 MARK       udp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 10002:10005 mark match 0x0/0xff00 MARK xset 0x1400/0xff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x1300/0xff00 </code></pre></div><p>ifconfig<br /></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr F8:D1:11
          inet addr:192.168.0.254  Bcast:192.168.0.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:31244 errors:0 dropped:11 overruns:0 frame:0
          TX packets:20580 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1654173 (1.5 MiB)  TX bytes:5399295 (5.1 MiB)

eth0      Link encap:Ethernet  HWaddr F8:D1:11
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:48201 errors:0 dropped:0 overruns:59805 frame:0
          TX packets:43197 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:6757305 (6.4 MiB)  TX bytes:6892406 (6.5 MiB)
          Interrupt:4 

eth0.1    Link encap:Ethernet  HWaddr F8:D1:11
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:31256 errors:0 dropped:0 overruns:0 frame:0
          TX packets:20587 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1664808 (1.5 MiB)  TX bytes:5399617 (5.1 MiB)

eth0.3    Link encap:Ethernet  HWaddr F8:D1:11
          UP BROADCAST RUNNING MULTICAST  MTU:1492  Metric:1
          RX packets:1387 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1415 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:101922 (99.5 KiB)  TX bytes:95408 (93.1 KiB)

eth0.4    Link encap:Ethernet  HWaddr F8:D1:1
          inet addr:192.168.202.254  Bcast:192.168.202.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1492  Metric:1
          RX packets:15401 errors:0 dropped:0 overruns:0 frame:0
          TX packets:21194 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:4115857 (3.9 MiB)  TX bytes:1223554 (1.1 MiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:144 errors:0 dropped:0 overruns:0 frame:0
          TX packets:144 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:11625 (11.3 KiB)  TX bytes:11625 (11.3 KiB)

pppoe-abc1 Link encap:Point-to-Point Protocol  
          inet addr:110.159.yy.yyy  P-t-P:110.159.xx.xxx  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:665 errors:0 dropped:0 overruns:0 frame:0
          TX packets:688 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:60424 (59.0 KiB)  TX bytes:58347 (56.9 KiB)

wlan0     Link encap:Ethernet  HWaddr F8:D1:11:7
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3907 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32 
          RX bytes:0 (0.0 B)  TX bytes:310562 (303.2 KiB)

wlan0-1   Link encap:Ethernet  HWaddr FA:D1:11:7
          inet addr:192.168.21.254  Bcast:192.168.21.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1492  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32 
          RX bytes:0 (0.0 B)  TX bytes:420 (420.0 B)</code></pre></div><div class="codebox"><pre><code>config interface &#039;abc1&#039;
    option enabled &#039;1&#039;
#    list track_ip &#039;a.a.a.a&#039;
#    list track_ip &#039;b.b.b.b&#039;
    list track_ip &#039;208.67.222.222&#039;
    list track_ip &#039;8.8.8.8&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option down &#039;3&#039;
    option up &#039;3&#039;
    option reliability &#039;2&#039;
    option interval &#039;5&#039;

config interface &#039;abc2&#039;
    option enabled &#039;1&#039;
#    list track_ip &#039;a.a.a.a&#039;
#    list track_ip &#039;b.b.b.b&#039;
    list track_ip &#039;208.67.222.222&#039;
    list track_ip &#039;8.8.8.8&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option down &#039;3&#039;
    option up &#039;3&#039;
    option reliability &#039;2&#039;
    option interval &#039;5&#039;

config member &#039;abc1_m1_w3&#039;
    option interface &#039;abc1&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;abc1_m2_w3&#039;
    option interface &#039;abc1&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;abc2_m1_w2&#039;
    option interface &#039;abc2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;abc2_m2_w2&#039;
    option interface &#039;abc2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;abc1_only&#039;
    list use_member &#039;abc1_m1_w3&#039;

config policy &#039;abc2_only&#039;
    list use_member &#039;abc2_m1_w2&#039;

config policy &#039;abc1_abc2_loadbalanced&#039;
    list use_member &#039;abc1_m1_w3&#039;
    list use_member &#039;abc2_m1_w2&#039;

config policy &#039;abc1_pri_abc2_sec&#039;
    list use_member &#039;abc1_m1_w3&#039;
    list use_member &#039;abc2_m2_w2&#039;

config policy &#039;abc2_pri_abc1_sec&#039;
    list use_member &#039;abc1_m2_w3&#039;
    list use_member &#039;abc2_m1_w2&#039;

config rule &#039;aaa1&#039;
    option dest_port &#039;11031&#039;
    option use_policy &#039;abc2_pri_abc1_sec&#039;
    option proto &#039;all&#039;

config rule &#039;bbb2&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;12000&#039;
    option use_policy &#039;abc2_pri_abc1_sec&#039;

config rule &#039;ccc3&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;10002:10005&#039;
    option use_policy &#039;abc2_pri_abc1_sec&#039;

config rule &#039;allelse&#039;
    option use_policy &#039;abc1_pri_abc2_sec&#039;</code></pre></div><p>What am I doing&nbsp; wrong? ALL traffic goes to my 2nd wan : abc2</p><br /><p>I need traffic_of_specific_destination_ports on wan2_failover_to_wan1 (so these specified traffic are always on wan2 only unless wan2 is down)<br />and all_other_unspecified_traffic on wan1_failover_to_wan2 (so these all_else traffic are always on wan1 only unless wan1 goes down)</p><p>nothing else. do the rules read top to bottom or bottom to top?</p><p>~~~~~~~</p><p>Is there a way to check if a WAN is tagged up or down? will help a lot in diagnosis</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 20 Apr 2013, 20:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199047">
				<div class="post-metadata">
					<div class="post-num">Post #163</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Apr 2013, 20:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi Biatche,</p><br /><p>The first rule in your config:</p><div class="codebox"><pre><code>config rule &#039;aaa1&#039;
    option dest_port &#039;11031&#039;
    option use_policy &#039;abc2_pri_abc1_sec&#039;
    option proto &#039;all&#039;</code></pre></div><p>contains protocol options all. Unfortunately you cant use dest_port option with all. So dest_port 11031 makes no sense, as it does not know for what protocol. As a result your first rule always hits as it becomes an &quot;always match&quot; rule. Look at the counters of the mwan3_rules iptable you posted:</p><div class="codebox"><pre><code>Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  235 12924 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match           MARK xset 0x1400/0xff00</code></pre></div><p>As the rules are read from top to bottom, all other rules are never hit. So mwan3 does exactly what you told it to do.&nbsp; <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 20 Apr 2013, 20:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199065">
				<div class="post-metadata">
					<div class="post-num">Post #164</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						20 Apr 2013, 22:41					</div>
				</div>
				<div class="post-content content">
					<p>Oh, I was thinking.. ok let&#039;s make life easy. Instead of specifying tcp+udp, I&#039;ll just put all. Also, do I need to specify ips? such as 0.0.0.0/0 for ALL ips... or just leave that blank?</p><p>Also, in your example, you specified:</p><div class="codebox"><pre><code>config &#039;rule&#039;
    option &#039;dest_ip&#039; &#039;192.168.0.0/16&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;use_policy&#039; &#039;default&#039;</code></pre></div><p>Is this necessary? I&#039;m not very smart in networking, so please explain if you can!</p><p>Update: OK, I read your thread on page 3 regarding this, so it&#039;s in a way specifying a static route. BUT... what if I have a modem on 192.168.202.1 which dmz&#039;s to openwrt at 192.168.202.254. How will the above rule affect traffic in this case? Will it actually hit? </p><p>I&#039;m thinking to have a rule 192.168.201.0/24 to use_policy wan1_only and 192.168.202.0/24 to use_policy wan2_only and 192.168.0.0/24 to &#039;default&#039;.</p><p>Is this sensible? Or would you suggest something else?</p><p>Lastly:<br />Is there a way to check if a WAN is tagged up or down? will help a lot in diagnosis</p><p>Thank you so far for mwan3 and your kind replies!</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 20 Apr 2013, 22:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199066">
				<div class="post-metadata">
					<div class="post-num">Post #165</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Apr 2013, 22:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Do I need to specify ips? such as 0.0.0.0/0 for ALL ips... or just leave that blank?</p></blockquote></div><p>Omitting src_ip or dest_ip options assumes 0.0.0.0/0. You can leave it out.</p><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Also, in your example, you specified:</p><div class="codebox"><pre><code>config &#039;rule&#039;
    option &#039;dest_ip&#039; &#039;192.168.0.0/16&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;use_policy&#039; &#039;default&#039;</code></pre></div><p>Is this necessary? I&#039;m not very smart in networking, so please explain if you can!</p></blockquote></div><p>A rule that refers to the &quot;default&quot; policy is used for routing traffic based on the default routing table. This comes handy with eg. vpn-tunnels or other static routes. This rule is not necessary, but since 192.168.0.0/16 is not routed on the internet, i decided to put that in as an example. None of the example rules are necessary, but you need at least one rule to make mwan3 work.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 20 Apr 2013, 22:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199067">
				<div class="post-metadata">
					<div class="post-num">Post #166</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						20 Apr 2013, 23:05					</div>
				</div>
				<div class="post-content content">
					<p>While you were replying to my post, I edited it a bit, please suggest how I can go about things there!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199068">
				<div class="post-metadata">
					<div class="post-num">Post #167</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Apr 2013, 23:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>What if I have a modem on 192.168.202.1 which dmz&#039;s to openwrt at 192.168.202.254. How will the above rule affect traffic in this case? Will it actually hit? </p><p>I&#039;m thinking to have a rule 192.168.201.0/24 to use_policy wan1_only and 192.168.202.0/24 to use_policy wan2_only and 192.168.0.0/24 to &#039;default&#039;.</p><p>Is this sensible? Or would you suggest something else?</p></blockquote></div><p>All locally connected networks are marked to use the default routing table. So no need to make rules for that. Rules for locally connected networks are never hit, because they are already marked in the mwan3_default table.</p><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Is there a way to check if a WAN is tagged up or down? will help a lot in diagnosis</p></blockquote></div><p>In the latest 1.1-10 version the ip rules 1001 till 1015 (which corresponds to interfaces 1 till 15) are deleted when an interface goes down. So if no rule present, interface is down.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 20 Apr 2013, 23:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199070">
				<div class="post-metadata">
					<div class="post-num">Post #168</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						21 Apr 2013, 00:09					</div>
				</div>
				<div class="post-content content">
					<p>My LAN is 192.168.0.0/24, 192.168.201.0/24 is between openwrt and modem1, and 192.168.202.0/24 is between openwrt and modem2. does this mean to say 201 and 202 subnet are considered &quot;locally connected networks&quot;? hope you dont get frustrated with my inexperience. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>if 2 interfaces (wan1, wan2) exist, how do i distinguish when whichever is down? aka wan1 and wan2. i&#039;ve been accustomed to pfsense ui, so when a link goes down, it shows so on the webui.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199071">
				<div class="post-metadata">
					<div class="post-num">Post #169</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						21 Apr 2013, 00:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>My LAN is 192.168.0.0/24, 192.168.201.0/24 is between openwrt and modem1, and 192.168.202.0/24 is between openwrt and modem2. does this mean to say 201 and 202 subnet are considered &quot;locally connected networks&quot;?</p></blockquote></div><p>Yes, All three subnets are locally connected networks. Your router has an interface directly connected in that subnet (has an ip address of this subnet configured).</p><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>if 2 interfaces (wan1, wan2) exist, how do i distinguish when whichever is down? aka wan1 and wan2. i&#039;ve been accustomed to pfsense ui, so when a link goes down, it shows so on the webui.</p></blockquote></div><p>The interfaces are (same as the rules) read from top to bottom. The first interface definition in your mwan3 config corresponds to rule number 1001, second interface to rule 1002 and so on.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199073">
				<div class="post-metadata">
					<div class="post-num">Post #170</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						21 Apr 2013, 00:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Lastly:<br />Is there a way to check if a WAN is tagged up or down? will help a lot in diagnosis</p></blockquote></div><p>I&#039;m in the process of today/tomorrow creating an overview page on the mwan-luci package that will have a live up/down display.</p><br /><p>Adze,</p><p>What other helpful commands do you think I should add to the troubleshooting page showing the output? It will allow the less experienced users to get all the information needed/requested for troubleshooting without actually running any commands.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 21 Apr 2013, 00:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199075">
				<div class="post-metadata">
					<div class="post-num">Post #171</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						21 Apr 2013, 01:37					</div>
				</div>
				<div class="post-content content">
					<p>-By the way, is there a possibility that if mwan3 switches to a fail-over connection (and later fail-back) to send me an email?</p><p>-Is there a possibility (i have a static ip for my main adsl line and an umts backup) to trigger a dyndns-client update once the connection is failed-over to umts?</p><p>Both solutions would be very great.</p><p>Cheers</p><p>Thomy</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199077">
				<div class="post-metadata">
					<div class="post-num">Post #172</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						21 Apr 2013, 02:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>-By the way, is there a possibility that if mwan3 switches to a fail-over connection (and later fail-back) to send me an email?</p><p>-Is there a possibility (i have a static ip for my main adsl line and an umts backup) to trigger a dyndns-client update once the connection is failed-over to umts?</p><p>Both solutions would be very great.</p><p>Cheers</p><p>Thomy</p></blockquote></div><p>A quick fix: make a script in /etc/hotplug.d/iface to call your email/ddns app on certain interface up/down events.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 21 Apr 2013, 03:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199091">
				<div class="post-metadata">
					<div class="post-num">Post #173</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						21 Apr 2013, 10:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>What if I have a modem on 192.168.202.1 which dmz&#039;s to openwrt at 192.168.202.254. How will the above rule affect traffic in this case? Will it actually hit? </p><p>I&#039;m thinking to have a rule 192.168.201.0/24 to use_policy wan1_only and 192.168.202.0/24 to use_policy wan2_only and 192.168.0.0/24 to &#039;default&#039;.</p><p>Is this sensible? Or would you suggest something else?</p></blockquote></div><p>All locally connected networks are marked to use the default routing table. So no need to make rules for that. Rules for locally connected networks are never hit, because they are already marked in the mwan3_default table.</p><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Is there a way to check if a WAN is tagged up or down? will help a lot in diagnosis</p></blockquote></div><p>In the latest 1.1-10 version the ip rules 1001 till 1015 (which corresponds to interfaces 1 till 15) are deleted when an interface goes down. So if no rule present, interface is down.</p></blockquote></div><p>I don&#039;t have 1.1-10 nor know where the link is so I presume it hasn&#039;t been compiled.</p><p>I&#039;m using 1.1-9 as of now compiled by headless.. so what happens when a wan interface goes up or down? will it automatically run the mwan3 script which recreate the rules and routes?</p><div class="quotebox"><blockquote><p>Mwan3 is triggered by hotplug-events. When an interface comes up it creates new routing tables and new iptables rules. A new routing table is created for each interface and for each policy. It then sets up iptables rules and uses iptables MARK to mark certain traffic. Based on ip rules the kernel determines which routing table to use. When an interface goes down, mwan3 deletes all the rules and routes to that interface in all created routing tables.</p><p>Mwan3 is not a daemon that runs in the background. Ones all the routes and rules are in place, it exits. The kernel takes care of all the routing decisions. If you want to apply a change you have made to mwan3 configuration, you have to trigger a hotplug event (replace eth0.1 and wan1 with your values):</p></blockquote></div><p>Please bear with noob-me, so the first paragraph says &#039;it creates/deletes rules/routes when if goes up/down&#039; and the second paragraph says &#039;not daemon, hotplug trigger is necessary&#039;</p><p>So in case of pppoe, is this a hotplug event thus everything is automated?<br />and if in the case of static ip (dmz).. say i turn off the modem router... will a hotplug event be triggered?</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 21 Apr 2013, 11:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199092">
				<div class="post-metadata">
					<div class="post-num">Post #174</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						21 Apr 2013, 11:42					</div>
				</div>
				<div class="post-content content">
					<p>mwan3track takes care of issuing hotplug events. If you have one or more track_ip configured, you don&#039;t have to do anything.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199174">
				<div class="post-metadata">
					<div class="post-num">Post #175</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						22 Apr 2013, 04:25					</div>
				</div>
				<div class="post-content content">
					<p>I have a preliminary interface status page completed. It shows &quot;ONLINE&quot; &quot;OFFLINE&quot; &quot;not tracked&quot; and &quot;not enabled&quot; for the interface status.</p><p>Going to pretty it up so it resembles the stock multiwan package look and post on github soon.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 7 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>