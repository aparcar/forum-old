<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Serial console hangs when trying to  erase the previous memory</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p257049">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">carrand</div>
					<div class="post-datetime">
						9 Dec 2014, 07:29					</div>
				</div>
				<div class="post-content content">
					<p>Using the serial console I successfully flashed the TP-Link english language firmware for TP-Link WR703N (modified MR3020 english firmware) Did not like it so I tried flashing the factory firmware also using the serial console to then install OpenWRT but the erasing of the memory just hangs so I can&#039;t finish flashing</p><p>I can successfully run the command to get any .bin file from the TFTP server, for example:<br />hornet&gt; tftpboot 0x81000000 wr703eng.bin</p><p>but when I try to erase the previous memory with: <br />hornet&gt; erase 0x9f020000 +0x3c0000</p><p>the erasing hangs at sector 39 every time. <br />First 0x2 last 0x3d sector size 0x10000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;39</p><p>How can I erase all sectors (60 I think) so I can continue with the normal flashing?</p><p>Here is the log:</p><p>U-Boot 1.1.4 (Mar 21 2013 - 10:09:10)</p><p>AP121 (ar9330) U-boot</p><p>DRAM:&nbsp; 32 MB<br />led turning on for 1s...</p><p>id read 0x100000ff<br />flash size 4194304, sector count = 64<br />Flash:&nbsp; 4 MB<br />Using default environment</p><p>In:&nbsp; &nbsp; serial<br />Out:&nbsp; &nbsp;serial<br />Err:&nbsp; &nbsp;serial<br />Net:&nbsp; &nbsp;ag7240_enet_initialize...<br />No valid address in Flash. Using fixed address<br />No valid address in Flash. Using fixed address<br />: cfg1 0x5 cfg2 0x7114<br />eth0: 00:03:7f:09:0b:ad<br />ag7240_phy_setup<br />eth0 up<br />: cfg1 0xf cfg2 0x7214<br />eth1: 00:03:7f:09:0b:ad<br />athrs26_reg_init_lan<br />ATHRS26: resetting s26<br />ATHRS26: s26 reset done<br />ag7240_phy_setup<br />eth1 up<br />eth0, eth1<br />Autobooting in 1 seconds<br />hornet&gt; printenv<br />printenv<br />bootargs=console=ttyS0,115200 root=31:02 rootfstype=squashfs init=/sbin/init mtdparts=ar7240-nor0:256k(u-boot),64k(u-boot-env),2752k(rootfs),896k(uImage),64k(NVRAM),64k(ART)<br />bootcmd=bootm 0x9f020000<br />bootdelay=1<br />baudrate=115200<br />ethaddr=0xba:0xbe:0xfa:0xce:0x07:0x41<br />ipaddr=192.168.1.111<br />serverip=192.168.1.100<br />stdin=serial<br />stdout=serial<br />stderr=serial<br />ethact=eth0</p><p>Environment size: 362/65532 bytes<br />hornet&gt; tftpboot 0x81000000 wr703eng.bin<br />tftpboot 0x81000000 wr703eng.bin<br />dup 1 speed 1000<br />Using eth1 device<br />TFTP from server 192.168.1.100; our IP address is 192.168.1.111<br />Filename &#039;wr703eng.bin&#039;.<br />Load address: 0x81000000<br />Loading: #################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#################################################################<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;######################################################<br />done<br />Bytes transferred = 3932160 (3c0000 hex)<br />hornet&gt; erase 0x9f020000 +0x3c0000<br />erase 0x9f020000 +0x3c0000</p><p>First 0x2 last 0x3d sector size 0x10000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;39</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257051">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						9 Dec 2014, 08:30					</div>
				</div>
				<div class="post-content content">
					<p>A long shot: try &#039;protect off bank 39&#039;<br />It is likely that the flash chip is defective.&nbsp; Use md.b 0xbf270000 and look at all 64 kbytes, if it is all FF except for one zero bit somewhere, that&#039;s a hardware failure.&nbsp; (hex 27 is decimal 39).</p><p>You can also try running an initrd-uImage of OpenWRT from RAM.&nbsp; tftp it to 81000000 and then bootm 81000000 to boot it.&nbsp; Once booted up, mtd should be available to write the flash.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 9 Dec 2014, 19:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257156">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">carrand</div>
					<div class="post-datetime">
						10 Dec 2014, 02:24					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the suggestions. <br /><em>protect</em> is not available (returns Unknown command)</p><div class="codebox"><pre><code>md.b 0xbf270000</code></pre></div><p>shows all&nbsp; 64 kbytes are fine.</p><p>Where can I get a initrd-uImage of OpenWRT?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257219">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						10 Dec 2014, 17:15					</div>
				</div>
				<div class="post-content content">
					<p>I think you have to build those yourself.</p><p>Try issuing erase commands for one block at a time in the bootloader.&nbsp; If the flash is actually being erased, you can then go ahead and use the cp.b command to flash from the bootloader.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>