<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Access home server from the Internet</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p362225">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">amuza</div>
					<div class="post-datetime">
						18 Jul 2017, 18:21					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I am trying to install a server at home to be accessible from the Internet and from a second LAN I have (configured with VLANs). Long ago I managed to have the firewall rules working ok so users in the second VLAN cannot enter into the first one. That is ok.</p><p>Now the problem is that I do not know how to make the server on the LAN visible from the Internet. The server has its DDNS configured, and I have configured redirects and rules. But I can only access the server from the local LAN using its local IP address or its local hostname. I cannot access it through the Internet with its DDNS name.</p><p>I do not properly understand priorities on zones, redirects and rules. Once redirects are matched, are they immediately connected or do they have to go through every firewall rule too?</p><p>When configuring redirects, do I always need to specify the LAN port and the WAN port?</p><p>Are zones just a default rule that can be overrided by rules?</p><p>Anyway, I think I have opened everything I had to open but the server is not accessible from the Internet.</p><p>In order to check if the problem was the firewall, I disabled it, but then I completely lost Internet connectivity. Why?</p><p>I think I need a plan to troubleshoot all this.</p><p>How would you proceed (tests, commands to get info, how and where to check logs, how to debug...)?</p><p>Thank you!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362228">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						18 Jul 2017, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>If you have everything else working, just go to the firewall section in LuCI and add a &quot;port forward&quot;, and fill in the form.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362274">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">amuza</div>
					<div class="post-datetime">
						19 Jul 2017, 12:11					</div>
				</div>
				<div class="post-content content">
					<p>I did so. Those are the &#039;redirects&#039; I meant.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362284">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						19 Jul 2017, 14:21					</div>
				</div>
				<div class="post-content content">
					<p>Post your config files here, please.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362291">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						19 Jul 2017, 15:32					</div>
				</div>
				<div class="post-content content">
					<p>To see a connection coming in, your router has to be connected to the Internet in a way that its WAN interface has a public IP.&nbsp; If your cable or DSL modem is also acting as a router, it will block incoming traffic.&nbsp; This situation can be recognized by the OpenWrt router&#039;s WAN having obtained a private IP such as 192.168.x.x from the modem/router.&nbsp; You need to either put the modem/router box into a bridge mode, or open the port on it to forward from the Internet to your router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371377">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">amuza</div>
					<div class="post-datetime">
						29 Jan 2018, 11:42					</div>
				</div>
				<div class="post-content content">
					<p>Hey, I&#039;m back. Sorry, I disappeared for some months.</p><p>I keep having the problem, and I keep having the doubts explained in the original post : (</p><p>I can access my home server from the LAN, but not from the Internet. It is not a DNS problem.</p><p>As asked by @eduperez:</p><p>network file:<br /><a href="https://share.riseup.net/#cavc8QDy9F08ihGZ4V1tWg">https://share.riseup.net/#cavc8QDy9F08ihGZ4V1tWg</a><br />firewall file:<br /><a href="https://share.riseup.net/#PuB_iWoKwu509TjLfewZ1w">https://share.riseup.net/#PuB_iWoKwu509TjLfewZ1w</a></p><p>Please let me know if you would need any other file or data.</p><p>Thank you very much!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371378">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						29 Jan 2018, 12:22					</div>
				</div>
				<div class="post-content content">
					<p>I think you should start debugging this issue using a packet sniffer... do you receive the traffic on the WAN interface of the router? does it leave the LAN interface? does it reach the server? ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371381">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">amuza</div>
					<div class="post-datetime">
						29 Jan 2018, 13:06					</div>
				</div>
				<div class="post-content content">
					<p>Hey thanks!</p><p>Does that mean you think the configuration is ok?</p><p>How do I do that packet sniffing thing?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371386">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						29 Jan 2018, 14:51					</div>
				</div>
				<div class="post-content content">
					<p>And your server is what? Linux (which one - ubuntu server has no firewall by default, but centos has very tough one) or windows? Have you allowed all zones on the server, not only lan? Since port forwarding is very easy, I&#039;d be looking there. Have you tried to disable firewall on the server? You cannot disable firewall on the router, because it is responsible for doing NAT.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371392">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">amuza</div>
					<div class="post-datetime">
						29 Jan 2018, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>Thanks nozombian.</p><p>The server is ok, it comes with the ports opened by default.</p><p>What else should I look on port forwarding? Did you see my config files?</p><p>By the way I use 2 different user VLANs (home network and community network). It works ok, just mentioning to clarify my config.</p><p>Thank you for the firewall explanation on OpenWRT, did not know that!</p><p>But, how is the filtering done?<br />I don&#039;t understand everything in the firewall file; there are rules, redirects, defaults, zones, forwarding...</p><p>Is there an order to apply those different things?</p><p>Or are things applied as soon as there is a match reading from the top to the bottom of the file?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371396">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">joefisher695</div>
					<div class="post-datetime">
						29 Jan 2018, 17:34					</div>
				</div>
				<div class="post-content content">
					<p>Do you have fix IP?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371398">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">amuza</div>
					<div class="post-datetime">
						29 Jan 2018, 18:00					</div>
				</div>
				<div class="post-content content">
					<p>The public IP address of the WAN interface of my home router is dynamically assigned by the ISP.<br />The private IP address of my server is reserved to its mac address (configured in the DHCP server of my home router).<br />The server uses DDNS to be reached from the Internet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371399">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						29 Jan 2018, 18:19					</div>
				</div>
				<div class="post-content content">
					<p>You have to test using a different Internet connection such as a hotspotted smartphone, so you truly are coming in to the network from the Internet.&nbsp; &nbsp;Trying to access your public IP from inside your LAN usually does not work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371414">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">amuza</div>
					<div class="post-datetime">
						30 Jan 2018, 00:04					</div>
				</div>
				<div class="post-content content">
					<p>I think my tests were ok. They were done from the Internet, out of my LAN. I did some tests from Tor and some others with remote online tools from the clear web: port checkers, ping, etc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373596">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">amuza</div>
					<div class="post-datetime">
						10 Mar 2018, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>Problem solved.</p><p>By chance I discovered my ISP was implementing Carrier-Grade NAT [0]. That&#039;s why port forwarding was not working. I asked to disable it for me, they did it, I was assigned a normal dynamic address and everything works now!</p><p>Thank you very much to everyone for your help!</p><p>[0] <a href="https://en.wikipedia.org/wiki/Carrier-grade_NAT">https://en.wikipedia.org/wiki/Carrier-grade_NAT</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>