<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Split lan into two segments</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p363334">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">yogaraj</div>
					<div class="post-datetime">
						8 Aug 2017, 00:26					</div>
				</div>
				<div class="post-content content">
					<p>I am trying setup my TP-LINK TL-WR841N installed with openwrt to provide two lan segments.</p><p>External segment port 1 that has interface IP configured and respond to DHCP request received on the port.</p><p>Internal segment port 2, 3 and 4 to act just like normal switch to forward all the traffic among these port.</p><p>The idea is connect a DPI box to port 1 and 2 such that it sits between external and internal segments.</p><p>I see the following problems.<br />1. Mon Aug&nbsp; 7 21:24:53 2017 kern.warn kernel: [50529.850000] br-internal: received packet on eth0.2 with own address as source address<br />When forwarding packets between segment mac spoof check shows errors.<br />2. Since the internel segment has no interface IP configured and dhcp is disable it shows the following.<br />Mon Aug&nbsp; 7 21:23:58 2017 daemon.warn dnsmasq-dhcp[10662]: DHCP packet received on br-internal which has no address</p><p>Any suggestions on how to fix this problems would be really helpful.</p><p>Thanks in advance!</p><p>/Yogaraj</p>											<p class="post-edited">(Last edited by <strong>yogaraj</strong> on 8 Aug 2017, 00:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363358">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mikma</div>
					<div class="post-datetime">
						8 Aug 2017, 15:17					</div>
				</div>
				<div class="post-content content">
					<p>Do the internal and external interfaces have the same MAC address? Try changing one if this is the case. It may solve the first problem. The second may be solved by only listening on the external interface in dnsmasq.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363367">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						8 Aug 2017, 16:40					</div>
				</div>
				<div class="post-content content">
					<p>If you want ports 2,3,4 to only switch among themselves, don&#039;t connect their VLAN to the CPU at all.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363400">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">yogaraj</div>
					<div class="post-datetime">
						9 Aug 2017, 11:45					</div>
				</div>
				<div class="post-content content">
					<p>@mikma @mk24</p><p>I configured different mac addresses on the interfaces and first issue was fixed. Then I configured dnsmasq not to listed on internal lan, so second issue is gone. But there is a new issue now.</p><p>When I loop internal and external segment. dhcp discover and request from internal are forwarded to external port. Dhcp offer/response is sent from external but for some reason internal segment does not forward the dhcp offer/request back to host. Could it be switch configuration issue or firewall ?</p><p>btw, I need to connect internal segment to cpu as well since I want internal segment to be bridged along with wlan.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>