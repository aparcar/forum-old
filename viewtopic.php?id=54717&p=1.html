<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Nexx WT3020: upgrading flash storage, with pictures</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 6 Apr 2018 and 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 4</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=54717&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=54717&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=54717&amp;p=4.html">4</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p258547">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						24 Dec 2014, 02:30					</div>
				</div>
				<div class="post-content content">
					<p>I decided that I wanted to upgrade this router&#039;s onboard flash from 8M to 16M (and possibly beyond if possible) because:<br />1. I like the small form factor<br />2. it&#039;s a great value at ~$17 from aliexpress<br />3. I hit the built-in storage limit pretty quickly and still wasn&#039;t able to add all the modules I wanted. Yes I know about extroot, but the point about this small router is that... it&#039;s small, and portable, and pocketable. With extroot it wouldn&#039;t be anymore.</p><p>So I studied the boot log (<a href="https://dl.dropboxusercontent.com/u/107843342/wt3020/putty.log.2">https://dl.dropboxusercontent.com/u/107 … utty.log.2</a>) and this version uses an Eon EN25Q64 64Mbit chip (datasheet: <a href="http://www.eonssi.com/upfile/p2009111114954.pdf">http://www.eonssi.com/upfile/p2009111114954.pdf</a>) instead of the W25Q64BV referenced on <a href="http://wiki.openwrt.org/toh/nexx/wt3020">http://wiki.openwrt.org/toh/nexx/wt3020</a>. No problem, they are compatible. The next chip up from Winbond is a 128Mbit SPI W25Q128FV <a href="http://www.nexflash.com/NR/rdonlyres/A5B6C30B-C174-43CF-867E-E1A2F371A07C/0/W25Q128FV.pdf">http://www.nexflash.com/NR/rdonlyres/A5 … Q128FV.pdf</a> which I was able to find at Digi-Key (<a href="http://www.digikey.com/product-detail/en/W25Q128FVSIG/W25Q128FVSIG-ND/3008697">http://www.digikey.com/product-detail/e … ND/3008697</a>) for $25 for 10 pieces including shipping. </p><p>I got the package in the mail today and got to hacking.</p><p>1: the original board showing the SPI EEPROM with markings scratched off from factory (heh). The green wires are for the serial console.<br /><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/107843342/wt3020/1.jpg" alt="https://dl.dropboxusercontent.com/u/107843342/wt3020/1.jpg" /></span></p><p>2: required for hacking <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br /><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/107843342/wt3020/2.jpg" alt="https://dl.dropboxusercontent.com/u/107843342/wt3020/2.jpg" /></span></p><p>3: chip unsoldered.<br /><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/107843342/wt3020/3.jpg" alt="https://dl.dropboxusercontent.com/u/107843342/wt3020/3.jpg" /></span></p><p>4. original chip in carrier ready to be read. I used a TL866A USB EEPROM reader to make a copy of the original firmware for safekeeping (if you need it you can download it here: <a href="https://dl.dropboxusercontent.com/u/107843342/wt3020/wt3020originalfirmware237.7z)">https://dl.dropboxusercontent.com/u/107 … are237.7z)</a><br /><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/107843342/wt3020/4.jpg" alt="https://dl.dropboxusercontent.com/u/107843342/wt3020/4.jpg" /></span></p><p>5. replacement chips<br /><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/107843342/wt3020/5.jpg" alt="https://dl.dropboxusercontent.com/u/107843342/wt3020/5.jpg" /></span></p><p>6. New larger 16MB chip soldered in; old chip below. Before soldering it I flashed it with the original firmware.<br /><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/107843342/wt3020/6.jpg" alt="https://dl.dropboxusercontent.com/u/107843342/wt3020/6.jpg" /></span></p><p>And serial console log showing that the bootloader complains about not knowing what the new chip is, but keeps booting anyway. <a href="https://dl.dropboxusercontent.com/u/107843342/wt3020/putty.log.3">https://dl.dropboxusercontent.com/u/107 … utty.log.3</a></p><p>Now onto making openwrt use all that extra flash. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>stamasd</strong> on 24 Dec 2014, 02:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258582">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						24 Dec 2014, 15:30					</div>
				</div>
				<div class="post-content content">
					<p>Grr, been trying to build an openwrt image for 16M from the current sources, but it appears that the git tree is broken right now.&nbsp; It gives me broken dependencies not finding libbfd-2.24.so, libopcodes-2.24.so and libz.so.1 (which BTW I do have on my build system)</p><div class="codebox"><pre><code>Package objdump is missing dependencies for the following libraries:
libbfd-2.24.so
libopcodes-2.24.so
libz.so.1</code></pre></div>											<p class="post-edited">(Last edited by <strong>stamasd</strong> on 24 Dec 2014, 15:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258686">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						25 Dec 2014, 20:15					</div>
				</div>
				<div class="post-content content">
					<p>Success! I managed to compile an image from git r43771 and flashed it over the original firmware. All of the 16MB flash are usable, with ~12MB available on / with no packages installed except Luci.</p><div class="codebox"><pre><code>Filesystem           1K-blocks      Used Available Use% Mounted on
rootfs                   12608       472     12136   4% /
/dev/root                 2304      2304         0 100% /rom
tmpfs                    30752       516     30236   2% /tmp
tmpfs                    30752        56     30696   0% /tmp/root
tmpfs                      512         0       512   0% /dev
/dev/mtdblock5           12608       472     12136   4% /overlay
overlayfs:/overlay       12608       472     12136   4% /</code></pre></div><p>If anyone wants to try this mod, here are the compiled images (with Luci built-in):<br /><a href="https://dl.dropboxusercontent.com/u/107843342/wt3020/openwrt-ramips-mt7620-wt3020-16M-squashfs-factory.bin">https://dl.dropboxusercontent.com/u/107 … actory.bin</a><br /><a href="https://dl.dropboxusercontent.com/u/107843342/wt3020/openwrt-ramips-mt7620-wt3020-16M-squashfs-sysupgrade.bin">https://dl.dropboxusercontent.com/u/107 … pgrade.bin</a></p><p>And the .dts that I used to compile this:</p><div class="codebox"><pre><code>/dts-v1/;

/include/ &quot;mt7620n.dtsi&quot;

/ {
    compatible = &quot;wt3020&quot;, &quot;ralink,mt7620n-soc&quot;;
    model = &quot;Nexx WT3020&quot;;

    palmbus@10000000 {
                gpio2: gpio@660 {
                        status = &quot;okay&quot;;
                };

                gpio3: gpio@688 {
                        status = &quot;okay&quot;;
                };

        spi@b00 {
            status = &quot;okay&quot;;

            m25p160@0 {
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;1&gt;;
                compatible = &quot;w25q128&quot;;
                reg = &lt;0 0&gt;;
                linux,modalias = &quot;m25p160&quot;, &quot;w25q128&quot;;
                spi-max-frequency = &lt;10000000&gt;;

                partition@0 {
                    label = &quot;u-boot&quot;;
                    reg = &lt;0x0 0x30000&gt;;
                    read-only;
                };

                partition@30000 {
                    label = &quot;u-boot-env&quot;;
                    reg = &lt;0x30000 0x10000&gt;;
                    read-only;
                };

                factory: partition@40000 {
                    label = &quot;factory&quot;;
                    reg = &lt;0x40000 0x10000&gt;;
                    read-only;
                };

                partition@50000 {
                    label = &quot;firmware&quot;;
                    reg = &lt;0x50000 0xfb0000&gt;;
                };
            };
        };
    };

    ehci@101c0000 {
        status = &quot;okay&quot;;
    };

    ohci@101c1000 {
        status = &quot;okay&quot;;
    };

    ethernet@10100000 {
        mtd-mac-address = &lt;&amp;factory 0x4&gt;;
        ralink,port-map = &quot;wllll&quot;;
    };

    wmac@10180000 {
        ralink,mtd-eeprom = &lt;&amp;factory 0&gt;;
    };

    pinctrl {
        state_default: pinctrl0 {
            default {
                ralink,group = &quot;ephy&quot;, &quot;wled&quot;, &quot;pa&quot;, &quot;i2c&quot;, &quot;wdt&quot;, &quot;uartf&quot;;
                ralink,function = &quot;gpio&quot;;
            };
        };
    };

    gpio-keys-polled {
        compatible = &quot;gpio-keys-polled&quot;;
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;0&gt;;
        poll-interval = &lt;20&gt;;
        reset {
            label = &quot;reset&quot;;
            gpios = &lt;&amp;gpio0 1 1&gt;;
            linux,code = &lt;0x198&gt;;
        };
    };

        gpio-leds {
                compatible = &quot;gpio-leds&quot;;
                power {
                        label = &quot;nexx:blue:power&quot;;
                        gpios = &lt;&amp;gpio3 0 0&gt;;
                };
        };
};</code></pre></div><p>I would like to attempt next to upgrade the flash even further, to 32MB or even 64MB. The problem with that is that nobody seems to manufacture 32MB or 64MB flash chips in SOIC-8 package - they are all in SOIC-16 or DFN/BGA, even though only 8 pins are used. It&#039;s not impossible but it&#039;s not a simple desolder/resolder project as it will require building an adapter</p>											<p class="post-edited">(Last edited by <strong>stamasd</strong> on 25 Dec 2014, 22:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259313">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">probono</div>
					<div class="post-datetime">
						31 Dec 2014, 14:03					</div>
				</div>
				<div class="post-content content">
					<p>Is there any calibration data and/or MAC address on the chip that needs to be preserved when flashing the new chip? On Atheros-based systems, there is an &quot;ART partition&quot; for that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259340">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						31 Dec 2014, 19:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>probono wrote:</cite><blockquote><p>Is there any calibration data and/or MAC address on the chip that needs to be preserved when flashing the new chip? On Atheros-based systems, there is an &quot;ART partition&quot; for that.</p></blockquote></div><br /><p>Well if you look through the boot log it has the following snippet:</p><div class="codebox"><pre><code>Creating 4 MTD partitions on &quot;raspi&quot;:
0x000000000000-0x000000030000 : &quot;Bootloader&quot;
0x000000030000-0x000000040000 : &quot;Config&quot;
0x000000040000-0x000000050000 : &quot;Factory&quot;
0x000000050000-0x000000800000 : &quot;Kernel&quot;</code></pre></div><p>I assume that the factory partition contains calibration data. That partition is preserved when flashing, and it is also defined in the .dts that I posted. Of course, the factory partition being at the beginning of the chip makes it easy to expand to larger chips.</p><p>I have ordered and am currently awaiting delivery of some 256Mbit and 512Mbit SPI flash chips; like I said, there aren&#039;t any in 8-SOIC package, but I found some in WSON (8x6mm) package which should be solderable with a bit of luck onto a 8-SOIC pad pattern. Flashing them in my programmer is another matter though, I don&#039;t have an appropriate carrier and that may be a problem.</p><p>Also while I&#039;m waiting for the chips I have built images with 64MB flash chip support, download below. Also with built-in Luci.<br /><a href="https://dl.dropboxusercontent.com/u/107843342/wt3020/openwrt-ramips-mt7620-wt3020-64M-squashfs-factory.bin">https://dl.dropboxusercontent.com/u/107 … actory.bin</a><br /><a href="https://dl.dropboxusercontent.com/u/107843342/wt3020/openwrt-ramips-mt7620-wt3020-64M-squashfs-sysupgrade.bin">https://dl.dropboxusercontent.com/u/107 … pgrade.bin</a></p>											<p class="post-edited">(Last edited by <strong>stamasd</strong> on 2 Jan 2015, 19:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259597">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jamdat</div>
					<div class="post-datetime">
						2 Jan 2015, 21:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stamasd wrote:</cite><blockquote><p>4. original chip in carrier ready to be read. I used a TL866A USB EEPROM reader to make a copy of the original firmware for safekeeping (if you need it you can download it here: <a href="https://dl.dropboxusercontent.com/u/107843342/wt3020/wt3020originalfirmware237.7z)">https://dl.dropboxusercontent.com/u/107 … are237.7z)</a><br /><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/107843342/wt3020/4.jpg" alt="https://dl.dropboxusercontent.com/u/107843342/wt3020/4.jpg" /></span></p><p>6. New larger 16MB chip soldered in; old chip below. Before soldering it I flashed it with the original firmware.<br /><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/107843342/wt3020/6.jpg" alt="https://dl.dropboxusercontent.com/u/107843342/wt3020/6.jpg" /></span></p></blockquote></div><p>Hello stamasd,<br />can I ask what SPI programmer and what software program you used to program your chips? I am new at this but would like to follow your mod.<br />I can get a CH341A based SPI programmer (<a href="http://www.aliexpress.com/item/Free-shipping-Bios-Board-MX25L6405-W25Q64-USB-Programmer-LCD-Burner-CH341A-Progammer-for-24-25/1825621684.html">this one</a>) but don&#039;t know if it will work. Also, what software to use to flash the chip? Ponyprog? Other?</p><p>Thank you very much!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259603">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">probono</div>
					<div class="post-datetime">
						2 Jan 2015, 22:20					</div>
				</div>
				<div class="post-content content">
					<p>Possibly if you have an Arduino you could use that to flash a SPI flash?<br /><a href="http://flashrom.org/Serprog/Arduino_flasher">http://flashrom.org/Serprog/Arduino_flasher</a><br />(I have not tested it yet)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259604">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						2 Jan 2015, 22:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jamdat wrote:</cite><blockquote><p>Hello stamasd,<br />can I ask what SPI programmer and what software program you used to program your chips? I am new at this but would like to follow your mod.<br />I can get a CH341A based SPI programmer (<a href="http://www.aliexpress.com/item/Free-shipping-Bios-Board-MX25L6405-W25Q64-USB-Programmer-LCD-Burner-CH341A-Progammer-for-24-25/1825621684.html">this one</a>) but don&#039;t know if it will work. Also, what software to use to flash the chip? Ponyprog? Other?</p><p>Thank you very much!</p></blockquote></div><p>It&#039;s in my top post somewhere. I use a TL866A and its own software (from <a href="http://www.autoelectric.cn/minipro/">http://www.autoelectric.cn/minipro/</a> ) I got it off ebay for about $50.</p><p>The programmer you linked to may or not work, but it doesn&#039;t come with the right adapter. The SOIC-8 adapter they include with that one requires that the chip be soldered to it for programming. I use a ZIF-type adapter, see my picture above (or like this one: <a href="http://www.aliexpress.com/item/New-Universal-SOIC-SO8-SOP8-to-DIP8-EZ-Programmer-Adapter-Socket-Converter-Module/1767872257.html">http://www.aliexpress.com/item/New-Univ … 72257.html</a> ). You do not want to solder/unsolder those chips too many times.</p><p>There are also clamp-style adapters like this: <a href="http://www.aliexpress.com/item/IC-clamp-SOIC8-con-SOP8-IC-Clip-adapter-For-24C-93C-25-series-SOIC-SOP-Chip/2055623061.html">http://www.aliexpress.com/item/IC-clamp … 23061.html</a> which supposedly can be used to program a chip without desoldering, but I haven&#039;t used one and don&#039;t know how well would work.</p><div class="quotebox"><cite>probono wrote:</cite><blockquote><p>Possibly if you have an Arduino you could use that to flash a SPI flash?<br /><a href="http://flashrom.org/Serprog/Arduino_flasher">http://flashrom.org/Serprog/Arduino_flasher</a><br />(I have not tested it yet)</p></blockquote></div><p>Sure, it should work. It doesn&#039;t take much to program a SPI device.</p>											<p class="post-edited">(Last edited by <strong>stamasd</strong> on 2 Jan 2015, 22:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259715">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						3 Jan 2015, 21:43					</div>
				</div>
				<div class="post-content content">
					<p>Well I received some N25Q512 devices in the mail... bad news, I wasn&#039;t able to use them. </p><p>1. they wouldn&#039;t fit in my SOIC-8 programming adapter. The WSON package is compatible with the SOIC-8 pad pattern, but the device is physically larger and doesn&#039;t fit. Strike one.</p><p>2. I soldered it to a SOIC-8 pad adapter and plugged it into my programmer. It&#039;s not supported. The programmer can read the device ID (and complain that it doesn&#039;t know what it is), read, and write the first 128 bytes... once. It can&#039;t erase the device. Strike two.</p><p>3. I attempted to use an <a href="http://flashrom.org/Serprog/Arduino_flasher">Arduino-based programmer for SPI</a>, despite it reportedly only supporting chips up to 16MB/128Mb only. All I wanted to do is flash the 64MB chip with the 8MB of the original firmware, so it should work, right? Well I get this<br /></p><div class="codebox"><pre><code>./flashrom  -V -p serprog:dev=/dev/ttyUSB0:115200
flashrom v0.9.7-r1860 on Linux 3.8.0-44-generic (x86_64)
flashrom is free software, get the source code at http://www.flashrom.org

flashrom was built with libpci 3.1.8, GCC 4.6.3, little endian
Command line (3 args): ./flashrom -V -p serprog:dev=/dev/ttyUSB0:115200
Calibrating delay loop... OS timer resolution is 1 usecs, 2973M loops per second, 10 myus = 10 us, 100 myus = 108 us, 1000 myus = 1002 us, 10000 myus = 10145 us, 4 myus = 6 us, OK.
Initializing serprog programmer
Baud rate is 115200 now.
serprog: connected - attempting to synchronize
........Error: cannot synchronize protocol - check communications and reset device?
Error: Programmer initialization failed.</code></pre></div><p>I was half-expecting that, since in the meantime I had read the N25Q512 datasheet, and it appears that it uses a special protocol for programming.<br />Last strike. I&#039;m out.</p><p>Well for now at least. I have 2 more things planned:</p><p>A. Getting a programmer that supports 512Mbit chips. One such is in the mail, a Blackcat USB which per the description specifically supports the N25Q512 chip. <a href="http://www.ebay.com/itm/Blackcat-USB-SPI-Flash-Programmer-ST-SPANSION-MXIC-AMD-/290505181360?pt=LH_DefaultDomain_0&amp;hash=item43a37548b0">http://www.ebay.com/itm/Blackcat-USB-SP … 43a37548b0</a> We shall see.</p><p>B. a few W25Q256 chips (256Mbit/32Mbyte) flash chips are on a slowboat from China. If all else fails I hope those will work. I&#039;ll know in a month or so.</p><p>However... I have very little hope to actually make the N25Q512 chips useful. The bootloader would have to support their special adressing mode, and chances are slim that it does. <br />The bootloader is reportedly U-boot v.1.1.3 from January 2013. Does anyone know if it supports 512Mbit flash chips, specifically the stacked devices from Micron?<br />If not, it looks like I may have to replace the original u-boot with something else, either a newer U-boot or another bootloader. This is turning into a fairly big project. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><br /><p>(edit) according to the Ralink SDK manual which I found at <a href="http://wendang.baidu.com/view/553c114af01dc281e43af004.html">http://wendang.baidu.com/view/553c114af … af004.html</a> the MT7620 chip itself does support 512Mbit flash devices, which is good news. There is hope yet. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>stamasd</strong> on 3 Jan 2015, 22:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259716">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						3 Jan 2015, 21:59					</div>
				</div>
				<div class="post-content content">
					<p>The 256 has a compatibility mode where the first 16 MB can be accessed with the old commands (24 bit address, which can only access a 16 MB space), as if it were a 16 MB chip.&nbsp; I don&#039;t know about the 512.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259718">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						3 Jan 2015, 22:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>The 256 has a compatibility mode where the first 16 MB can be accessed with the old commands (24 bit address, which can only access a 16 MB space), as if it were a 16 MB chip.&nbsp; I don&#039;t know about the 512.</p></blockquote></div><p>That is interesting, The 512Mb chip should support that also, given that in fact it&#039;s comprised of 2x256Mbit chips stacked. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260558">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">saturn-b</div>
					<div class="post-datetime">
						8 Jan 2015, 14:47					</div>
				</div>
				<div class="post-content content">
					<p>This is my first boot log after flashing uboot image compiled from MTK_Ralink_ApSoC_SDK_4110.</p><p>Router booting without any problem but this uboot code need some&nbsp; modification to work well with wt3020. I don&#039;t know anything about coding, anyone interested ?&nbsp; <br />&nbsp; &nbsp;</p><div class="codebox"><pre><code>U-Boot 1.1.3 (Jan  8 2015 - 18:44:26)

Board: Ralink APSoC DRAM:  64 MB
relocate_code Pointer at: 83fb4000
enable ephy clock...done. rf reg 29 = 5
SSC disabled.
spi_wait_nsec: 29
spi device id: ef 40 18 0 0 (40180000)
Warning: un-recognized chip ID, please update bootloader!
raspi_read: from:30000 len:1000
raspi_read: from:30000 len:1000
============================================
Ralink UBoot Version: 4.1.1.0
--------------------------------------------
ASIC 7620_MP (Port5&lt;-&gt;None)
DRAM component: 512 Mbits DDR, width 16
DRAM bus: 16 bit
Total memory: 64 MBytes
Flash component: 16 MBytes NOR Flash
Date:Jan  8 2015  Time:18:44:26
============================================
icache: sets:512, ways:4, linesz:32 ,total:65536
dcache: sets:256, ways:4, linesz:32 ,total:32768

 ##### The CPU freq = 580 MHZ ####
 estimate memory size =64 Mbytes
raspi_read: from:50000 len:40
raspi_read: from:850000 len:40

=================================================
Check image validation:
Image1 Header Magic Number --&gt; OK
Image2 Header Magic Number --&gt; Failed
Image1 Header Checksum --&gt; OK
Image1 Data Checksum --&gt; raspi_read: from:50040 len:11c4b9
OK
Image1 Stable Flag --&gt; Not stable
Image1 Try Counter --&gt; 9

Image1 is not stable and try counter &gt; 3. Take it as a broken image.
Image1: Broken Image2: Broken
Upgrade Mode~~

=================================================

Please choose the operation:
   1: Load system code to SDRAM via TFTP.
   2: Load system code then write to Flash via TFTP.
   3: Boot system code via Flash (default).
   4: Entr boot command line interface.
   7: Load Boot Loader code then write to Flash via Serial.
   9: Load Boot Loader code then write to Flash via TFTP.                     0

3: System Boot system code via Flash.
## Booting image at bc050000 ...
raspi_read: from:30000 len:10000
Erasing SPI Flash...
raspi_erase: offs:30000 len:10000
.
Writing to SPI Flash...
raspi_write: to:30000 len:10000
.
done
raspi_read: from:50000 len:40
   Image Name:   MIPS OpenWrt Linux-3.14.26
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1164473 Bytes =  1.1 MB
   Load Address: 80000000
   Entry Point:  80000000
raspi_read: from:50040 len:11c4b9
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80000000) ...
## Giving linux memsize in MB, 64

Starting kernel ...

[    0.000000] Linux version 3.14.26 (silviu@Monster) (gcc version 4.8.3 (OpenWr                                                     t/Linaro GCC 4.8-2014.04 r43771) ) #1 Thu Dec 25 12:11:49 EST 2014
[    0.000000] Board has DDR1
[    0.000000] Analog PMU set to hw control
[    0.000000] Digital PMU set to hw control
[    0.000000] SoC Type: Ralink MT7620N ver:2 eco:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019650 (MIPS 24KEc)
[    0.000000] MIPS: machine is Nexx WT3020
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
.
.
.
.</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260633">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						9 Jan 2015, 01:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>saturn-b wrote:</cite><blockquote><p>This is my first boot log after flashing uboot image compiled from MTK_Ralink_ApSoC_SDK_4110.</p><p>Router booting without any problem but this uboot code need some&nbsp; modification to work well with wt3020. I don&#039;t know anything about coding, anyone interested ?</p></blockquote></div><br /><p>Do you have the SDK? I&#039;ve been looking for it but was unable to find it so far. Actually I think a newer revision exists too, 4.2.0.0</p>											<p class="post-edited">(Last edited by <strong>stamasd</strong> on 9 Jan 2015, 01:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260651">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">saturn-b</div>
					<div class="post-datetime">
						9 Jan 2015, 05:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stamasd wrote:</cite><blockquote><br /><p>Do you have the SDK? I&#039;ve been looking for it but was unable to find it so far. Actually I think a newer revision exists too, 4.2.0.0</p></blockquote></div><p>I found it on chinese site , there is plenty of MT7620 data files if you interested, plese visit <a href="http://pan.baidu.com/wap/link?shareid=2563696338&amp;uk=3911291424&amp;third=0&amp;dir=%2FMT7620&amp;page=1">Here</a> or just google it &quot;MTK_Ralink_ApSoC_SDK_4110_20121102.tar&quot;</p>											<p class="post-edited">(Last edited by <strong>saturn-b</strong> on 9 Jan 2015, 05:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260667">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						9 Jan 2015, 09:58					</div>
				</div>
				<div class="post-content content">
					<p>Hm, if &quot;2012110&quot; is the date of release then this SDK is older than the firmware in the WT3020... any leads on a newer SDK?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260827">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">saturn-b</div>
					<div class="post-datetime">
						10 Jan 2015, 13:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stamasd wrote:</cite><blockquote><p>Hm, if &quot;2012110&quot; is the date of release then this SDK is older than the firmware in the WT3020... any leads on a newer SDK?</p></blockquote></div><p>You can find at <a href="http://pan.baidu.com/wap/link?uk=956495754&amp;shareid=4158042641&amp;third=0">panbaidu</a> for MTK_Ralink_ApSoC_SDK_4200_20131106.tar.bz2</p><p>Trying to download but ftp server prevent me to download after some times.</p><p>After adding spi flash id to uboot sc , flash ic became recognize by uboot.</p><div class="codebox"><pre><code>U-Boot 1.1.3 (Jan 10 2015 - 18:10:31)

Board: Ralink APSoC DRAM:  64 MB
relocate_code Pointer at: 83fb4000
enable ephy clock...done. rf reg 29 = 5
SSC disabled.
spi_wait_nsec: 29
spi device id: ef 40 18 0 0 (40180000)
find flash: W25Q128FV
raspi_read: from:30000 len:1000
raspi_read: from:30000 len:1000
============================================
Ralink UBoot Version: 4.1.1.0
--------------------------------------------
ASIC 7620_MP (Port5&lt;-&gt;None)
DRAM component: 512 Mbits DDR, width 16
DRAM bus: 16 bit
Total memory: 64 MBytes
Flash component: SPI Flash
Date:Jan 10 2015  Time:18:10:31
============================================
icache: sets:512, ways:4, linesz:32 ,total:65536
dcache: sets:256, ways:4, linesz:32 ,total:32768

 ##### The CPU freq = 580 MHZ ####
 estimate memory size =64 Mbytes

Please choose the operation:
   1: Load system code to SDRAM via TFTP.
   2: Load system code then write to Flash via TFTP.
   3: Boot system code via Flash (default).
   4: Entr boot command line interface.
   7: Load Boot Loader code then write to Flash via Serial.
   9: Load Boot Loader code then write to Flash via TFTP.                     0

3: System Boot system code via Flash.
## Booting image at bc050000 ...
raspi_read: from:50000 len:40
   Image Name:   MIPS OpenWrt Linux-3.14.26
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1164473 Bytes =  1.1 MB
   Load Address: 80000000
   Entry Point:  80000000</code></pre></div><p>My problem when using your firmware always produce &quot;jffs2: Newly-erased block contained word....&quot; , are you facing the same problem ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260848">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						10 Jan 2015, 18:51					</div>
				</div>
				<div class="post-content content">
					<p>Nope, I haven&#039;t seen that message at all.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262075">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">probono</div>
					<div class="post-datetime">
						19 Jan 2015, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>Semi-OT:</p><p>Nexx WT3020 Failsafe does not work.</p><p>Please see <a href="https://dev.openwrt.org/ticket/18768">https://dev.openwrt.org/ticket/18768</a><br />Anyone: Do you have ideas how to fix this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262448">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">cave</div>
					<div class="post-datetime">
						22 Jan 2015, 14:45					</div>
				</div>
				<div class="post-content content">
					<p>Failsafe<br />if the 192.168.1.1 interface does not respond, the only chances to debrick are serial or tftp firmware uploads. Both need soldering the serial cables ...</p><p>without failsafe the only chance to debrick is with serial cables attached and <a href="http://wiki.openwrt.org/doc/howto/generic.flashing.serial">http://wiki.openwrt.org/doc/howto/gener … ing.serial</a> </p><p>or tftp method <a href="http://wiki.openwrt.org/doc/howto/generic.flashing.tftp">http://wiki.openwrt.org/doc/howto/generic.flashing.tftp</a><br /> like with WR703n <a href="http://forums.openpilot.org/blog/52/entry-92-unbrick-wr703n-wifi-router/">http://forums.openpilot.org/blog/52/ent … fi-router/</a></p>											<p class="post-edited">(Last edited by <strong>cave</strong> on 22 Jan 2015, 14:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262455">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">hackru</div>
					<div class="post-datetime">
						22 Jan 2015, 15:14					</div>
				</div>
				<div class="post-content content">
					<p>just use any of bootloaders with tftp/web recovery.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262503">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">saturn-b</div>
					<div class="post-datetime">
						22 Jan 2015, 22:39					</div>
				</div>
				<div class="post-content content">
					<p>Failsafe mode works by applying dirty hacks :</p><div class="codebox"><pre><code>Index: target/linux/ramips/base-files/lib/preinit/07_set_preinit_iface_ramips
===================================================================
--- target/linux/ramips/base-files/lib/preinit/07_set_preinit_iface_ramips    (revision 44078)
+++ target/linux/ramips/base-files/lib/preinit/07_set_preinit_iface_ramips    (working copy)
@@ -6,12 +6,12 @@
 . /lib/ramips.sh
 
 ramips_set_preinit_iface() {
-    RT3X5X=`cat /proc/cpuinfo | egrep &quot;(RT3.5|RT5350|MT7628)&quot;`
+    RT3X5X=`cat /proc/cpuinfo | egrep &quot;(RT3.5|RT5350|MT7628|MT7620)&quot;`
     if [ -n &quot;${RT3X5X}&quot; ]; then
         swconfig dev rt305x set reset 1
     fi
 
-    if echo $RT3X5X | egrep -q &quot;(RT5350|MT7628)&quot;; then
+    if echo $RT3X5X | egrep -q &quot;(RT5350|MT7628|MT7620)&quot;; then
         # This is a dirty hack to get by while the switch
         # problem is investigated. When VLAN is disabled, ICMP
         # pings work as expected, but TCP connections time</code></pre></div><br /><div class="codebox"><pre><code>- failsafe -


BusyBox v1.22.1 (2015-01-22 22:35:02 WIB) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

ash: can&#039;t access tty; job control turned off
  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 CHAOS CALMER (Bleeding Edge, r44078)
 -----------------------------------------------------
  * 1 1/2 oz Gin            Shake with a glassful
  * 1/4 oz Triple Sec       of broken ice and pour
  * 3/4 oz Lime Juice       unstrained into a goblet.
  * 1 1/2 oz Orange Juice
  * 1 tsp. Grenadine Syrup
 -----------------------------------------------------
================= FAILSAFE MODE active ================
special commands:
* firstboot         reset settings to factory defaults
* mount_root     mount root-partition with config files

after mount_root:
* passwd             change root&#039;s password
* /etc/config            directory with config files

for more help see:
http://wiki.openwrt.org/doc/howto/generic.failsafe
=======================================================

root@(none):/# [   42.290000] random: nonblocking pool is initialized

root@(none):/# ping -c 3 192.168.1.20
PING 192.168.1.20 (192.168.1.20): 56 data bytes
64 bytes from 192.168.1.20: seq=0 ttl=64 time=0.280 ms
64 bytes from 192.168.1.20: seq=1 ttl=64 time=0.220 ms
64 bytes from 192.168.1.20: seq=2 ttl=64 time=0.200 ms

--- 192.168.1.20 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.200/0.233/0.280 ms
root@(none):/# </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262504">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">hackru</div>
					<div class="post-datetime">
						22 Jan 2015, 22:41					</div>
				</div>
				<div class="post-content content">
					<p>thank, saturn-b. so, what&#039;s about your uboot? i&#039;m really interested in it and want to try.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262508">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">saturn-b</div>
					<div class="post-datetime">
						22 Jan 2015, 22:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hackru wrote:</cite><blockquote><p>thank, saturn-b. so, what&#039;s about your uboot? i&#039;m really interested in it and want to try.</p></blockquote></div><p>It&#039;s not mine , I just made minor mod. from CleanWRT uboot github based on pepe2k uboot work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262509">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">hackru</div>
					<div class="post-datetime">
						22 Jan 2015, 22:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>saturn-b wrote:</cite><blockquote><div class="quotebox"><cite>hackru wrote:</cite><blockquote><p>thank, saturn-b. so, what&#039;s about your uboot? i&#039;m really interested in it and want to try.</p></blockquote></div><p>It&#039;s not mine , I just made minor mod. from CleanWRT uboot github based on pepe2k uboot work.</p></blockquote></div><p>Anyway, can you provide binary to test?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262512">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">saturn-b</div>
					<div class="post-datetime">
						22 Jan 2015, 23:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hackru wrote:</cite><blockquote><div class="quotebox"><cite>saturn-b wrote:</cite><blockquote><div class="quotebox"><cite>hackru wrote:</cite><blockquote><p>thank, saturn-b. so, what&#039;s about your uboot? i&#039;m really interested in it and want to try.</p></blockquote></div><p>It&#039;s not mine , I just made minor mod. from CleanWRT uboot github based on pepe2k uboot work.</p></blockquote></div><p>Anyway, can you provide binary to test?</p></blockquote></div><p>Sure <a href="https://app.box.com/s/56r84jn7slzmz7i0j531zuaig1pk2gdx">https://app.box.com/s/56r84jn7slzmz7i0j531zuaig1pk2gdx</a></p><div class="codebox"><pre><code>U-Boot 1.1.3 (Jan 19 2015 - 00:59:23)

Board: Ralink APSoC DRAM:  64 MB
GPIO#44 updated GPIOMODE register: 001a311c -&gt; 001ab11c
NEXX WT-3020 gpio init : WPS / RESET pin
GPIO#1 updated GPIOMODE register: 001ab11c -&gt; 001ab11d
relocate_code Pointer at: 83fac000
enable ephy clock...done. rf reg 29 = 5
SSC disabled.
spi_wait_nsec: 29 
spi device id: ef 40 18 0 0 (40180000)
find flash: W25Q128FV
raspi_read: from:30000 len:1000 
raspi_read: from:30000 len:1000 
============================================ 
CleanWRT u-boot_mt7620 Version: 0.0.0.3
-------------------------------------------- 
ASIC 7620_MP (Port5&lt;-&gt;None)
DRAM component: 512 Mbits DDR, width 16
DRAM bus: 16 bit
Total memory: 64 MBytes
Flash component: SPI Flash
Date:Jan 19 2015  Time:00:59:23
============================================ 
icache: sets:512, ways:4, linesz:32 ,total:65536
dcache: sets:256, ways:4, linesz:32 ,total:32768 

 ##### The CPU freq = 580 MHZ #### 
 estimate memory size =64 Mbytes

Press press RESET button for more than 2 seconds to run web failsafe mode

RESET button is pressed for:  0 second(s)reset button pressed!
 1 second(s)reset button pressed!
reset button pressed!
 2 second(s)

RESET button was pressed for 2 seconds
HTTP server is starting for firmware update...

raspi_read: from:40028 len:6 


 NetTxPacket = 0x83FE3580 

 NetRxPackets[0] = 0x83FE3B80

 NetRxPackets[1] = 0x83FE4180

 NetRxPackets[2] = 0x83FE4780

 NetRxPackets[3] = 0x83FE4D80

 NetRxPackets[4] = 0x83FE5380

 NetRxPackets[5] = 0x83FE5980

 NetRxPackets[6] = 0x83FE5F80

 NetRxPackets[7] = 0x83FE6580

 NetRxPackets[8] = 0x83FE6B80

 NetRxPackets[9] = 0x83FE7180

 NetRxPackets[10] = 0x83FE7780

 NetRxPackets[11] = 0x83FE7D80

 NetRxPackets[12] = 0x83FE8380

 NetRxPackets[13] = 0x83FE8980

 NetRxPackets[14] = 0x83FE8F80

 NetRxPackets[15] = 0x83FE9580

 NetRxPackets[16] = 0x83FE9B80

 NetRxPackets[17] = 0x83FEA180

 NetRxPackets[18] = 0x83FEA780

 NetRxPackets[19] = 0x83FEAD80

 NetRxPackets[20] = 0x83FEB380

 NetRxPackets[21] = 0x83FEB980

 NetRxPackets[22] = 0x83FEBF80

 NetRxPackets[23] = 0x83FEC580

 KSEG1ADDR(NetTxPacket) = 0xA3FE3580 

 NetLoopHttpd,call eth_halt ! 
Trying Eth0 (10/100-M)

 Waitting for RX_DMA_BUSY status Start... done


 ETH_STATE_ACTIVE!! 
HTTP server is starting at IP: 192.168.0.111
HTTP server is ready!</code></pre></div>											<p class="post-edited">(Last edited by <strong>saturn-b</strong> on 22 Jan 2015, 23:33)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 4</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=54717&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=54717&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=54717&amp;p=4.html">4</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>