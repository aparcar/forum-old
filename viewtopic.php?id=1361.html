<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WDS with WRT54GS-DE</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Feb 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p6490">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						26 Apr 2005, 19:03					</div>
				</div>
				<div class="post-content content">
					<p>I have 2 WRT54GS-DE Version 1.1 and installed the latest experimental OpenWRT on both of them. I want them to bridge the local wired attached LAN&#039;s over the WLAN connection - and thought, WDS would be the easyest. No WLAN clients are involved so far - to throughput shouldn&#039;t be a problem.</p><p>I have set 1 box to wl0_lazywds=1 - and the other one to wl0_wds=XX:XX:XX:XX:XX:XX - rebooted both, but nothing happens - no additional devices or anything.</p><p>Here is the nvram config of the first box:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# nvram show
os_ram_addr=80001000
wl0_net_mode=mixed
wl0_frameburst=off
il0macaddr=00:13:10:15:23:d2
boardrev=0x10
et0macaddr=00:13:10:15:23:D0
bootnv_ver=2
watchdog=5000
boot_wait=on
wl0_infra=1
et0mdcport=0
wl0_country_code=DE
pmon_ver=CFE 3.61.13.0
lan_gateway=
wl0_ifname=eth1
vlan0ports=1 2 3 4 5*
gpio5=robo_reset
wl0_mode=ap
wl0_ap_isolate=0
os_flash_addr=bfc40000
sromrev=2
wl0_gmode=1
boardtype=0x0708
lan_netmask=255.255.0.0
wl0_ssid=OpenWrt
wl0_dtim=1
wl0id=0x4320
wl0_key1=
wl0_key2=
wl0_key3=
wl0_key4=
ag0=255
wl0_closed=0
wl0_rate=0
wl0_plcphdr=long
wl0_macmode=disabled
wl0_radioids=BCM2050
wl0gpio2=0
wl0_phytype=g
wl0gpio3=0
wl0_lazywds=1
boardflags2=0
wl0_afterburner=auto
wl0_antdiv=-1
wl0_wpa_psk=
wan_proto=none
wl0_unit=0
wl_country_code=AU
pa0itssit=62
wl0_wds=
cctl=0
lan_ifnames=vlan0 eth1
lan_dns=
wl0_auth=0
wl0_radius_port=1812
wl0_radius_ipaddr=
pa0maxpwr=0x4e
lan_ipaddr=172.23.129.11
clkfreq=200
lan_proto=static
aa0=3
vlan1hwname=et0
wl0_phytypes=g
wl0_wep=disabled
wl0_frag=2346
sdram_config=0x0062
wl0_country=
vlan1ports=0 5
eou_private_key=1b1863b45a926af91f02ee3da2f081f746df5485bf68e1d6c2b6a7203f7b1108befd45da74b4653799ab42a88edbb0bea0562d6599efc38cbadf64438761abe78436331da4d3acd4594e6ea6a51a912ccc266105551aab388bb09ec433940fa6880119f35ba66254277b74f68532cf298c87dd51a721a6fd0a2a3d1f8aa9f431
scratch=a0180000
ccode=0
wl0_rateset=default
eou_device_id=V59X4V5R
lan_ifname=br0
boardflags=0x0318
sdram_refresh=0x0000
sdram_ncdl=0xfdfe09
wl0_rts=2347
wl0_wpa_gtk_rekey=3600
wl0_key=1
et0phyaddr=30
wl0_radio=1
wl0_bcn=100
wl0_hwaddr=00:13:10:15:23:D2
pa0b0=0x15eb
wl0_gmode_protection=auto
pa0b1=0xfa82
wl0_maclist=
pa0b2=0xfe66
sdram_init=0x000b
vlan0hwname=et0
dl_ram_addr=a0001000
wl0_radius_key=
wl0_corerev=7
wl0_channel=11
wl0_auth_mode=open
boot_ver=v3.4
boardnum=42
wl0_crypto=tkip
eou_public_key=998a34fe013db383afbb4607f0a835ce919c344b3ca7aa6ba4b5b30c12640b318f9b3680955392e5bc1fcf107edce98d8c93013fbda3fec822f1e2d3ff2978cc247abf9c52d010e4657e9f800450562097cfcda10f95ea6a3132dadd00f3f70c4399d8b1b88c0ad19340d4f3489bca716072c00c3220533cb92ab5761247bc8711</code></pre></div><p>And here the nvram of the second one:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# nvram show
os_ram_addr=80001000
wl0_net_mode=mixed
wl0_frameburst=off
il0macaddr=00:13:10:15:23:cf
boardrev=0x10
et0macaddr=00:13:10:15:23:CD
bootnv_ver=2
watchdog=5000
boot_wait=on
wl0_infra=1
et0mdcport=0
wl0_country_code=DE
pmon_ver=CFE 3.61.13.0
lan_gateway=
wl0_ifname=eth1
vlan0ports=1 2 3 4 5*
gpio5=robo_reset
wl0_mode=ap
wl0_ap_isolate=0
os_flash_addr=bfc40000
sromrev=2
wl0_gmode=1
boardtype=0x0708
lan_netmask=255.255.0.0
wl0_ssid=OpenWrt
wl0_dtim=1
wl0id=0x4320
wl0_key1=
wl0_key2=
wl0_key3=
wl0_key4=
ag0=255
wl0_closed=0
wl0_rate=0
wl0_plcphdr=long
wl0_macmode=disabled
wl0_radioids=BCM2050
wl0gpio2=0
wl0_phytype=g
wl0gpio3=0
wl0_lazywds=0
boardflags2=0
wl0_afterburner=auto
wl0_antdiv=-1
wl0_wpa_psk=
wan_proto=none
wl0_unit=0
wl_country_code=AU
pa0itssit=62
wl0_wds=00:13:10:15:23:D2
cctl=0
lan_ifnames=vlan0 eth1
lan_dns=
wl0_auth=0
wl0_radius_port=1812
wl0_radius_ipaddr=
pa0maxpwr=0x4e
lan_ipaddr=172.23.129.22
clkfreq=200
lan_proto=static
aa0=3
vlan1hwname=et0
wl0_phytypes=g
wl0_wep=disabled
wl0_frag=2346
sdram_config=0x0062
wl0_country=
vlan1ports=0 5
eou_private_key=14981b6e4f9478f3a32425efed446e636e91c82a4b109e0c7d6dd90b17b96bec92e19cb29dbc2635dc85852cd9396e0e4c193aed415828fd7bbf09df78252888eedf93cba5abd0addd0b237d9565d1bfa6bcf2cf82b68740d8379331f815988e3d8fb29136a07b77d7354c3772a6eb5a466781a5f0e70156ef8496d44c29faf1
scratch=a0180000
ccode=0
wl0_rateset=default
eou_device_id=EB2ZJC5H
lan_ifname=br0
boardflags=0x0318
sdram_refresh=0x0000
sdram_ncdl=0xfd0008
wl0_rts=2347
wl0_wpa_gtk_rekey=3600
wl0_key=1
et0phyaddr=30
wl0_radio=1
wl0_bcn=100
wl0_hwaddr=00:13:10:15:23:CF
pa0b0=0x15eb
wl0_gmode_protection=auto
pa0b1=0xfa82
wl0_maclist=
pa0b2=0xfe66
sdram_init=0x000b
vlan0hwname=et0
dl_ram_addr=a0001000
wl0_radius_key=
wl0_corerev=7
wl0_channel=11
wl0_auth_mode=open
boot_ver=v3.4
boardnum=42
wl0_crypto=tkip
eou_public_key=af0ce929a46e0416eab3427760c5aa4d2bd725677e0d3f6a2a25b4de49a8155ae07db3ee3cbf44c9d26eebfd3668277986d674e0ab6d5c6a9bd7d3eb7d3bd88d96f456548c4dd8a1fa9b58837c523dcefa9258759ba9611d27ca7f86a6877e7744c42249fba1d52e317fa01f47b112f731a4f7cce3acaa549db7e3b5fd26cbcd11</code></pre></div><p>I don&#039;t know, what I have done wrong - the ifconfig on both boxes looks like that:</p><p>1st box<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ifconfig
br0       Link encap:Ethernet  HWaddr 00:13:10:15:23:D0
          inet addr:172.23.129.11  Bcast:172.23.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:17437 errors:0 dropped:0 overruns:0 frame:0
          TX packets:767 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1357560 (1.2 MiB)  TX bytes:63764 (62.2 KiB)

eth0      Link encap:Ethernet  HWaddr 00:13:10:15:23:D0
          UP BROADCAST RUNNING PROMISC MULTICAST  MTU:1500  Metric:1
          RX packets:19154 errors:0 dropped:0 overruns:0 frame:0
          TX packets:956 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1852708 (1.7 MiB)  TX bytes:179098 (174.9 KiB)
          Interrupt:5 Base address:0x2000

eth1      Link encap:Ethernet  HWaddr 00:13:10:15:23:D2
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:260
          TX packets:16901 errors:138 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:1620312 (1.5 MiB)
          Interrupt:4 Base address:0x1000

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

vlan0     Link encap:Ethernet  HWaddr 00:13:10:15:23:D0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:17557 errors:0 dropped:0 overruns:0 frame:0
          TX packets:767 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1434474 (1.3 MiB)  TX bytes:66832 (65.2 KiB)

vlan1     Link encap:Ethernet  HWaddr 00:13:10:15:23:D0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:189 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:112266 (109.6 KiB)</code></pre></div><p>2nd box:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ifconfig
br0       Link encap:Ethernet  HWaddr 00:13:10:15:23:CD
          inet addr:172.23.129.22  Bcast:172.23.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:18349 errors:0 dropped:0 overruns:0 frame:0
          TX packets:389 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1426511 (1.3 MiB)  TX bytes:39872 (38.9 KiB)

eth0      Link encap:Ethernet  HWaddr 00:13:10:15:23:CD
          UP BROADCAST RUNNING PROMISC MULTICAST  MTU:1500  Metric:1
          RX packets:20179 errors:0 dropped:0 overruns:0 frame:0
          TX packets:587 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1949073 (1.8 MiB)  TX bytes:159040 (155.3 KiB)
          Interrupt:5 Base address:0x2000

eth1      Link encap:Ethernet  HWaddr 00:13:10:15:23:CF
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:136
          TX packets:18080 errors:123 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:1735259 (1.6 MiB)
          Interrupt:4 Base address:0x1000

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

vlan0     Link encap:Ethernet  HWaddr 00:13:10:15:23:CD
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:18478 errors:0 dropped:0 overruns:0 frame:0
          TX packets:389 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1507605 (1.4 MiB)  TX bytes:41428 (40.4 KiB)

vlan1     Link encap:Ethernet  HWaddr 00:13:10:15:23:CD
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:198 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:117612 (114.8 KiB)</code></pre></div><p>Can someone please tell me, what I&#039;m missing?</p><p>TIA</p><p>Daniel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6495">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						26 Apr 2005, 23:31					</div>
				</div>
				<div class="post-content content">
					<p>The afterburner/speedbooster causes problems with wds.</p><p>To disable it, change boardflags variable and reboot.</p><p>0x318 --&gt; 0x118 (gs v1.1 or above)<br />0x388 --&gt; 0x188 (gs v1.0)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6513">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						27 Apr 2005, 15:46					</div>
				</div>
				<div class="post-content content">
					<p>Thanks mbm - after that, the wds0.2 if comes up, and I was able to ping from one WRT to the other - but that&#039;s it - no wired LAN bridging, no pinging from wired LAN to WRT on both sides.</p><p>Because of this, and because I have read, that WDS does not support WPA, I decided, to dump WDS, and set up an AP/Client (WET) bridge - re-configured the one WRT back to simple AP, and configured the other as an WET client ethernet bridge ... simple - and seems to work.</p><p>Right now, I have only one problem, but I think I will post this in a new thread, because it has nothing to do with WDS.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6713">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						3 May 2005, 00:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>I wrote:</cite><blockquote><p>Thanks mbm - after that, the wds0.2 if comes up, and I was able to ping from one WRT to the other - but that&#039;s it - no wired LAN bridging, no pinging from wired LAN to WRT on both sides.</p></blockquote></div><p>OK - after trying around with WET, and having some strange problems with traffic from one bridged wired network to the other - I switched back to WDS. And I was really surprised, that this time everything was fine.</p><p>I haven&#039;t set the &quot;boardflags&quot; - instead I have done:</p><div class="codebox"><pre><code>nvram set wl0_afterburner=off
nvram set wl0_gmode=2
nvram set wl0_mode=ap
nvram set wl0_netmode=g-only
nvram set wl0_closed=1
nvram set wl0_wds=xx:xx:xx:xx:xx:xx
nvram set wl0_maclist=xx:xx:xx:xx:xx:xx
nvram set wl0_macmode=allow</code></pre></div><p>(where xx:xx:xx:xx:xx:xx is the MAC address of the eth1 interface of the other AP)</p><p>After doing this, everything was fine after a reboot - and right now, i have several flood pings ($ ping -f aaa.aaa.aaa.aaa) and some really heavy traffic (infinite loop with wget of a 10 MB file across the bridge) - and no packets are lost so far. And I get about 2 MByte/s - parallel to the flood pings, and the broadcasts of our whole network (with about 80 PC&#039;s).</p><p>My only &quot;problem&quot; now is - while WDS does not support WPA - will this be secure enough for a wireless bridge across the street? I think WEP will be useless because it&#039;s too easy to crack. The distance is about 300m - 250 on our own &quot;property&quot;, and about 50 crossing a street. We will use special directed antennas (AFAIK 30Â° Yagi) on both sides about 6m above the ground. So I think anyone in a Car on the street will be able to get into the network, once he knows, that it&#039;s there - or not?</p><p>TIA for some thoughts about that &quot;problem&quot; - maybe someone has a good idea.</p><p>Bye<br />Daniel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6716">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						3 May 2005, 00:42					</div>
				</div>
				<div class="post-content content">
					<p>Actually wds can support wpa, just that we haven&#039;t fully investigated &amp; documented it yet.</p><p>Install &amp; configure nas. Create a symlink from nas to /usr/sbin/nas4not. Hotplug will now attempt to run nas4not to notify nas of each new wds connection.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6723">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">disq</div>
					<div class="post-datetime">
						3 May 2005, 03:57					</div>
				</div>
				<div class="post-content content">
					<p>i had the same concerns as you do, and just two AP&#039;s, and i went with WDS+WEP for a week. </p><p>then i finally had some time, disabled WDS, set up WPA in one and clientmode+wpa (with wpa_supplicant) on the other, and set up a static route on the ap, (like this: &quot;route add -net 192.168.11.0 netmask 255.255.255.0 gw 192.168.12.2&quot; 12.2 is client, 11.0 is the network on the client-side, 12.1 is the ap) and some iptables/DNAT port forwarding. (you might also need a static route pointing towards the AP on clientside, i didn&#039;t, as it&#039;s already on defaultroute)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6730">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						3 May 2005, 07:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>disq wrote:</cite><blockquote><p>i had the same concerns as you do, and just two AP&#039;s, and i went with WDS+WEP for a week. </p><p>then i finally had some time, disabled WDS, set up WPA in one and clientmode+wpa (with wpa_supplicant) on the other, and set up a static route on the ap, (like this: &quot;route add -net 192.168.11.0 netmask 255.255.255.0 gw 192.168.12.2&quot; 12.2 is client, 11.0 is the network on the client-side, 12.1 is the ap) and some iptables/DNAT port forwarding. (you might also need a static route pointing towards the AP on clientside, i didn&#039;t, as it&#039;s already on defaultroute)</p></blockquote></div><p>Thanks, but this wouldn&#039;t work for me - we just try to replace/extend a wired 2 MBit/s ethernet bridge - and it would be too difficult, to switch from the bridge configuration to a routed network, because we use the same network address (192.168.1.0/24) on both sides of the bridge.</p><div class="quotebox"><cite>mbm wrote:</cite><blockquote><p>Actually wds can support wpa, just that we haven&#039;t fully investigated &amp; documented it yet.</p><p>Install &amp; configure nas. Create a symlink from nas to /usr/sbin/nas4not. Hotplug will now attempt to run nas4not to notify nas of each new wds connection.</p></blockquote></div><p>That sounds good - I will give it a try, as soon as a come to my office today. Any other &quot;special configuration hints&quot; for /etc/nas.conf? Do I have to configure one &quot;node&quot; as supplicant and the other as authenticator? I ask, because I allready tried to run nas manually from the command line on both nodes - and as soon, as I started nas, no packets were bridged anymore.</p><p>But on <a href="http://forum.chupa.nl/printthread.php?t=967">http://forum.chupa.nl/printthread.php?t=967</a> is mentioned, that you have to start nas as nas4not (or maybe nas4wds?) and it will then behave different. May I should say, that I use the binary nas from the package <a href="http://nthill.free.fr/openwrt/ipkg/stable/20041003/nas_0.1-2_mipsel.ipk">http://nthill.free.fr/openwrt/ipkg/stab … mipsel.ipk</a> - I hope this is the right one?</p><p>So thank you - at least I know, that it is possible - and all I have to do, is try.</p><p>Bye<br />Daniel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6756">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">tosuja</div>
					<div class="post-datetime">
						4 May 2005, 11:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mbm wrote:</cite><blockquote><p>The afterburner/speedbooster causes problems with wds.</p><p>To disable it, change boardflags variable and reboot.</p><p>0x318 --&gt; 0x118 (gs v1.1 or above)<br />0x388 --&gt; 0x188 (gs v1.0)</p></blockquote></div><p>Hm, are you sure that for GS 1.1 it&#039;s correct to set 0x188? I have set it, rebooted and since that time I&#039;m unable to access the WRT. I am running latest experimental (jffs2, 2005-04-23), default configuration - no manual changes made. Network configuration is quite normal with exception of removed br0 interface - eth1 (wifi, static IP), vlan1 (WAN, DHCP), vlan0 (LAN, static IP). I have tried to erase NVRAM (holding RESET while powering WRT up) but it did not help. Any idea how to bring it back to life?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6759">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						4 May 2005, 11:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tosuja wrote:</cite><blockquote><div class="quotebox"><cite>mbm wrote:</cite><blockquote><p>0x318 --&gt; 0x118 (gs v1.1 or above)<br />0x388 --&gt; 0x188 (gs v1.0)</p></blockquote></div><p>Hm, are you sure that for GS 1.1 it&#039;s correct to set 0x188?</p></blockquote></div><p>If mbm is not sure - I am. I have done it with 2 GSv1.1, and both came back to life without a problem.</p><p>But afterburner was still on with these boardflags - I have tested<br /></p><div class="codebox"><pre><code>nvram set boardflags=0x0318
nvram set wl0_afterburner=off
nvram set wl0_gmode=2
nvram set wl0_net_mode=g-only
nvram commit</code></pre></div><p>is working with my two GSv1.1 and WDS.</p><p>HTH and bye<br />Daniel<br />(edited by mbm - correct boardflags - sorry.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6761">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">tosuja</div>
					<div class="post-datetime">
						4 May 2005, 12:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nieslpriem wrote:</cite><blockquote><div class="quotebox"><cite>tosuja wrote:</cite><blockquote><div class="quotebox"><cite>mbm wrote:</cite><blockquote><p>0x318 --&gt; 0x118 (gs v1.1 or above)<br />0x388 --&gt; 0x188 (gs v1.0)</p></blockquote></div><p>Hm, are you sure that for GS 1.1 it&#039;s correct to set 0x188?</p></blockquote></div><p>If mbm is not sure - I am. I have done it with 2 GSv1.1, and both came back to life without a problem.</p></blockquote></div><p>I found (too late..) that in other post mbm wrote that for GS 1.1 one should set boardflags to 0x118 which makes more sense.<br />But the question is - how to revive WRT?</p><p>EDIT: Finally, several pin shortcuts &amp; firmware flashes brought WRT back to life.<br />(edited by mbm - correct boardflags - sorry.)</p>											<p class="post-edited">(Last edited by <strong>tosuja</strong> on 4 May 2005, 13:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6997">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">cajoline</div>
					<div class="post-datetime">
						10 May 2005, 05:27					</div>
				</div>
				<div class="post-content content">
					<p>Mbm, could you elaborate somewhat on the nas4not part?</p><p>I am running experimental 2005.03.29 build on 2 WRT54GS boxes: a v1.0 and a v1.1. WDS without WPA works fine. I have installed /usr/sbin/nas that I got from a linksys-utils.tar.gz package. Someone from #wrt54g pointed me to this one about 5 weeks ago, while I was searching for a suitable nas binary for the experimental build. I quickly tried WPA-PSK/TKIP on a single AP and by itself it seemed to work fine as well.</p><p>Now I have set on both WRTs:</p><p>wl0_mode=ap<br />wl0_ssid=&lt;ssid&gt;<br />wl0_lazywds=0<br />wl0_wds=&lt;other wrt eth1 mac addr&gt;</p><p>wl0_auth_mode=psk<br />wl0_wpa_psk=AABBCCDDEE<br />wl0_wpa_gtk_rekey=3600<br />wl0_crypto=tkip</p><p>Nas runs with: /usr/sbin/nas /tmp/nas.conf /tmp/nas.pid lan as per the FAQ suggest. (Autogenerated) /tmp/nas.conf reads:<br />nas -P /tmp/nas.pid -l br0 -H 34954<br />-i eth1 -A -m 2 -k AABBCCDDEE -s &lt;ssid&gt; -w 2 -g 3600</p><p>This doesn&#039;t work; each AP and its&#039; clients don&#039;t communicate with the other side.</p><p>I have read on the Chupa Asus WL500g forums about nas4not and nas4wds symlinks (here: <a href="http://forum.chupa.nl/showthread.php?p=5663)">http://forum.chupa.nl/showthread.php?p=5663)</a>. After that it is unclear to me if I have to invoke separate instances of nas or what.</p><p>As per your suggestion I link /usr/sbin/nas4not -&gt; nas</p><p>Doesn&#039;t change anything. I also link nas4wds -&gt; nas but still no luck.</p><p>Then I find this thread on that forum again:<br /><a href="http://forum.chupa.nl/showthread.php?t=1917&amp;page=12&amp;pp=15&amp;highlight=WDS">http://forum.chupa.nl/showthread.php?t= … hlight=WDS</a><br />Michael there got this to work by adding the AP&#039;s own wifi interface mac address to the WDS member mac address list (i.e. wl0_wds). So the AP also creates a WDS link to itself.<br />No matter how crazy that sounded, I tried it too. No difference...</p><p>I have stumbled across numerous technical explanations why WPA and WDS should not work, and they all seemed quite reasonable. However if this does actually work after all, as various ppl have mysteriously reported here and there, I believe it would have to involve something as running a separate instance(s) of NAS over the WDS link so as the clients of each AP can authenticate, if need be, to the other AP as well? Or something crazy along that line.</p><p>Since available information (not to mention a howto..) on this topic is rather scarce (and often contradictive), would you mind describing how this nas4not scheme works and what one needs to get it to happen?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7145">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">cajoline</div>
					<div class="post-datetime">
						13 May 2005, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>Anyone read the above? mbm, nieslpriem ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7151">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						13 May 2005, 23:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi cajoline,</p><p>I&#039;ve read it - but I have no sollution/sugestion for you - I&#039;m really sorry.</p><p>After &quot;fumbling&quot; around with &quot;WPA for WDS&quot; I&#039;ve given up because of 2 reasons:</p><p>1. I havn&#039;t found a solution - sorry.</p><p>2. I think that WPA is too weak for a bridged network - I think it&#039;s only a matter of time, until WPA is hacked - so I have decided, to go for a IPsec tunnel - bridged over WDS.</p><p>The idea is, to use 2 separate routers/bridges which build a IPsec VPN tunnel over the two completly open WRT&#039;s (OK - a least MAC list on both sides). In addition these seperate routers/bridges are building a second tunnel over a 4 MBit/s 4-wire DSL line - and they are doing &quot;load balancing&quot;. So if one connection fails, the other one is allready up.</p><p>So I&#039;m sorry, that I can&#039;t help you ...</p><p>Bye<br />Daniel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7528">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">sbingner</div>
					<div class="post-datetime">
						25 May 2005, 00:09					</div>
				</div>
				<div class="post-content content">
					<p>I got WDS+WPA working and have given copies of my S41wds and /sbin/hotplug scripts that work with current nas to the openwrt dev&#039;s&nbsp; they can be reached at <a href="http://www.bingner.com/openwrt">http://www.bingner.com/openwrt</a></p><p>You need to have the following set in nvram</p><p>wl0_crypto=(aes|tkip|aes+tkip)<br />wl0_wds_crypto=(aes|tkip|aes+tkip) - optional but can be different from wl0_crypto<br />wl0_auth_mode=psk<br />wl0_wpa_psk=YOURPRESHAREDKEY<br />wl0_wds_wpa_psk=PSKFORWDSLINKS - optional but can be different from wl0_crypto<br />wl0_ssid=YOURSID<br />wl0_wpa_gtk_rekey=REKEYINTERVAL - default 3600</p><p>This should also work properly if you are using wifi as your wireless interface name</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7547">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						25 May 2005, 12:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sbingner wrote:</cite><blockquote><p>I got WDS+WPA working and have given copies of my S41wds and /sbin/hotplug scripts that work with current nas to the openwrt dev&#039;s&nbsp; they can be reached at <a href="http://www.bingner.com/openwrt">http://www.bingner.com/openwrt</a></p><p>You need to have the following set in nvram</p><p>(...snip...)</p><p>This should also work properly if you are using wifi as your wireless interface name</p></blockquote></div><p>Can you please post the settings of your lan_ifname, wifi_ifname, and so on parameters? Couldn&#039;t get it to work - if I set lan_ifname=eth0 - I can&#039;t connect to the boxes anymore.</p><p>TIA<br />Daniel</p><p>PS: How if the format of the wl0_wpa_psk parameter? Is if a &quot;hex-code&quot; or a simple ASCII string? And what si the maximum length of the key?</p>											<p class="post-edited">(Last edited by <strong>nieslpriem</strong> on 25 May 2005, 12:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7548">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">sbingner</div>
					<div class="post-datetime">
						25 May 2005, 12:41					</div>
				</div>
				<div class="post-content content">
					<p>you have to have the ifname for the interface that is your wireless interface as a bridge, or it won&#039;t be able to add the wds links to said bridge... </p><p>shouldn&#039;t have broken any connections from the wired networks either way...</p><p>psk has to be at least 8-63 characters, as ascii or it can be hex as 64 characters</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7549">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">sbingner</div>
					<div class="post-datetime">
						25 May 2005, 12:45					</div>
				</div>
				<div class="post-content content">
					<p>My config for my main router:</p><p>lan_gateway=192.168.1.1<br />lan_ifname=vlan0<br />lan_ipaddr=192.168.1.10<br />lan_netmask=255.255.255.0<br />lan_proto=static<br />wan_hostname=wrt54gs-main<br />wan_ifname=vlan2<br />wan_ipaddr=192.168.0.2<br />wan_netmask=255.255.255.0<br />wan_proto=static<br />wifi_ifname=br0<br />wifi_ifnames=eth1<br />wifi_ipaddr=192.168.100.1<br />wifi_netmask=255.255.255.0<br />wifi_proto=static</p><p>wan ifname is vlan2 bevcause I have vlan tagging on, and it&#039;s actually a vlan on my cisco switch, would normally be vlan0 and lan as vlan1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7551">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						25 May 2005, 13:32					</div>
				</div>
				<div class="post-content content">
					<p>Hi sbingner,</p><p>thanks for helping me so far ... but it doesn&#039;t work ...</p><p>After booting the WRT&#039;s I don&#039;t get any error messages, and I can see (using ps) that nas is running:<br /></p><div class="codebox"><pre><code>/usr/sbin/nas -P /tmp/nas.lan.pid -l br0 -H 34954 -i eth1 -A -m 2 -k AABBCCDDEEFF -s BridgeHiPP -w 2 -g 3600</code></pre></div><p>But I cannot see nas4not.</p><p>So after short study of your /sbin/hotplug I tried:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# export INTERFACE=wds0.2
root@OpenWrt:~# /sbin/hotplug</code></pre></div><p>I receive the following message immediately: &quot;device wds0.2 is already a member of a bridge; can&#039;t enslave it to bridge br0.&quot; Which is obviously a message of brctl - because wl0_wds... is allready active and bridged.</p><p>And after about 10 seconds, I reaceive the error message: &quot;No interface specified. Quitting...&quot; Which seems to be an error from the /usr/sbin/nas4not symlink to nas ... </p><p>The nas4not command line (in &quot;your&quot; nas4not script procedure) is expanded like this:<br /></p><div class="codebox"><pre><code>/usr/sbin/nas4not lan wds0.2 up auto tkip psk AABBCCDDEEFF BridgeHiPP</code></pre></div><p>(extracted using an echo command just before the command)</p><p>So everything seems to be like it should be ... or not ???</p><p>Do you know anything further?</p><p>TIA<br />Daniel</p><p>PS: Here are some (maybe) important nvram settings:<br /></p><div class="codebox"><pre><code>...
lan_ifname=br0
lan_ifnames=vlan0 eth1
lan_ipaddr=172.23.129.22
lan_netmask=255.255.0.0
lan_proto=static
lan_stp=0
...
wl0_auth=0
wl0_auth_mode=psk
wl0_crypto=tkip
wl0_ifname=eth1
wl0_maclist=00:13:10:15:23:d2
wl0_ssid=BridgeHiPP
wl0_wds=00:13:10:15:23:d2
wl0_wep=disabled
wl0_wep_bit=128
wl0_wpa_gtk_rekey=3600
wl0_wpa_psk=AABBCCDDEEFF
...</code></pre></div>											<p class="post-edited">(Last edited by <strong>nieslpriem</strong> on 25 May 2005, 13:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7561">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						25 May 2005, 16:33					</div>
				</div>
				<div class="post-content content">
					<p>OK ... please forget everything I said, about the not working WDS-WPA link ... it works like a charm <img src="https://forum.openwrt.org/img/smilies/lol.png" width="15" height="15" alt="lol" /></p><p>My problem was, that I had installed one of the nas ipkg&#039;s (I think it was version 0.2 or so) - and I have read now that these packages are all broken. So I extracted the nas binary from the LinkSys source package wrt54gs.3.37.2.tgz - and replaced the binary directly on both routers.</p><p>And now, everything works fine, and seems to be encoded with WPA - as far as I can see/check this. We will try both routers in this configuration now for some days, to make sure, that it also works over a long time (esp. rekeying ...). I will post the results of our tests in a few days in this thread.</p><p>So thank you very much - you&#039;re really great, and you will get one of the top places in my personal &quot;all-time-top-100-:cool:-it-gurus&quot; charts ;-)</p><p>Bye for now,</p><p>Daniel <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7584">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">gr0k</div>
					<div class="post-datetime">
						26 May 2005, 07:57					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to setup wds using wpa tkip between two wrt54g (one version 2, the other version 2.2).&nbsp; I don&#039;t know if I&#039;m having the same problem or not.&nbsp; I&#039;m able to connect to either router using wpa, so I&#039;m fairly sure I have the correct version of nas.</p><p>I&#039;ve tried downloading sbingner&#039;s scripts and that hasn&#039;t helped either.&nbsp; I created the nas4not symlink.&nbsp; When they come up, they both show wds0.2 interfaces and those interfaces show up under brctl show.&nbsp; However, neither of them can ping the other.&nbsp; I&#039;ve tried the suggestions in this thread... I&#039;ve tried setting both mac addresses on each&#039;s wl0_wds setting.&nbsp; I&#039;ve tried changing wl0_lazywds on or off on one or the other.</p><p>Strangely, the hotplug script doesn&#039;t seem to be launching nas.&nbsp; Shouldn&#039;t I be seeing two nas/nas4not processes or am I reading that wrong?&nbsp; I only see a line that says:</p><p>/usr/sbin/nas -P /tmp/nas.lan.pid -l br0 -H 34954 -i eth1 -A -m 2 -k test -s basement -w 2 -g 3600</p><p>logread shows this on both routers.&nbsp; Is the attempt to add interface with same source the problem?&nbsp; If so, what could that be?</p><p>Dec 31 19:00:14 (none) kern.info kernel: device wds0.2 entered promiscuous mode<br />Dec 31 19:00:14 (none) kern.info kernel: wds0.2: attempt to add interface with same source address.<br />Dec 31 19:00:14 (none) kern.info kernel: br0: port 3(wds0.2) entering learning state<br />Dec 31 19:00:14 (none) kern.info kernel: br0: port 3(wds0.2) entering forwarding state</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7588">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">cajoline</div>
					<div class="post-datetime">
						26 May 2005, 10:51					</div>
				</div>
				<div class="post-content content">
					<p>Well I tried everything that sbingner mentions, but it doesn&#039;t seem to work.</p><p>I installed S41wpa and replaced hotplug with your script.</p><p>I don&#039;t know what version of nas I have, so I downloaded <a href="http://www.linksys.com/support/opensourcecode/wrt54gs/3.37.2/wrt54gs.3.37.2.tgz">http://www.linksys.com/support/opensour … 3.37.2.tgz</a> and extracted nas from it (WRT54GS_3_37_2_1109_US/release/src/router/mipsel/install/nas/usr/sbin/nas), replaced my binary and created the link /usr/sbin/nas4not -&gt; /usr/sbin/nas.</p><p>However this version of nas, whenever I run it and no matter what arguments, it always says on stderr &quot;nas: not found&quot; and returns 127. So I guess this version doesn&#039;t run properly on the OpenWRT build I am running (experimental 20050329). Anyway.</p><p>I set the nvram variables exactly like you suggested. I even used a different key for wds, setting it in wl0_wds_wpa_psk.</p><p>When the system comes up the only thing I notice is a process like the one below:<br />&nbsp; 355 root&nbsp; &nbsp; &nbsp; &nbsp; 444 S&nbsp; &nbsp;/bin/ash -x /sbin/hotplug net <br />I don&#039;t know what is calling hotplug, but by looking at the script it sure seems it&#039;s being called in the wrong way. hotplug expects to find a variable INTERFACE in the environment, and not an argument. But even that argument seems wrong..<br />Apart from that there is no nas process running, since obviously it has died due to the &quot;nas: not found&quot; error above. I do see /tmp/nas.lan.conf however:<br />/usr/sbin/nas -P /tmp/nas.lan.pid -l br0 -H 34954 -i eth1 -A -m 2 -k AABBCCDDEE -s mousmoul -w 2 -g 3600<br />The above clearly shows an attempt to run nas from /etc/init.d/S41wpa.</p><p>So I go back to the nas binary I had and try again. This time I see the above instance of nas running. But I see no other nas or nas4not process and no trace of one whatsoever.</p><p>As I have noted before, this is my lan/wan configuration:<br />lan_ifname=br0<br />lan_stp=on<br />lan_ifnames=vlan0 eth1<br />vlan0hwname=et0<br />vlan0ports=0 1 2 3 4 5*<br />lan_proto=static<br />lan_ipaddr=192.168.0.3<br />lan_netmask=255.255.255.0<br />lan_gateway=192.168.0.1<br />lan_dns=192.168.0.1 192.168.0.3<br />wl0_ifname=eth1<br />wan_proto=none<br />wan_ifname=vlan1<br />(yes I don&#039;t do any routing on this box, only switching and bridging)</p><p>I really have no clue what is happenning. What is supposed to call hotplug? wlconf? And what is supposed to happen when nas4not is called? Another instance of nas running, or does it signal the nas process somehow? Can you please give some insight? Apart from getting it to work, I&#039;d really like to understand how this works...</p>											<p class="post-edited">(Last edited by <strong>cajoline</strong> on 26 May 2005, 10:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7589">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						26 May 2005, 10:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi grOk,</p><p>I have &quot;played around&quot; with the scipts and nas4not not for a long time, and now it seems to work.</p><p>Here are some tipps, which I think, you could try:</p><p>1. Check the nas binary:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ls -l /usr/sbin/nas*
-rwxr-xr-x    1 root     root       126444 Jan  1 00:02 /usr/sbin/nas
lrwxrwxrwx    1 root     root            3 Jan  6  2000 /usr/sbin/nas4not -&gt; nas
lrwxrwxrwx    1 root     root            3 Jan  6  2000 /usr/sbin/nas4wds -&gt; nas</code></pre></div><p>I should have the right size - at least, only the &quot;123 kB&quot; version works for me - I have extraced it from the LinkSys &quot;source&quot; package (wrt54gs.3.37.2.tgz).</p><p>2. Check that WDS is running without WPA</p><p>3. Check that /etc/init.d/S41wpa (from <a href="http://www.bingner.com/openwrt/)">http://www.bingner.com/openwrt/)</a> is starting nas correctly on both WRT&#039;s:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ps fax
  PID  Uid     VmSize Stat Command
(...snip...)
  370 root        496 S   /usr/sbin/nas -P /tmp/nas.lan.pid -l br0 -H 34954 -i eth1 -A -m 2 -k mySimpleTestKey
(...snap...)</code></pre></div><p>Even after running /sbin/hotplug only this nas process is active all the time - the nas4not call only seems to register the WDS link.</p><p>4. Check iwconfig - it should look like this:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# iwconfig
(...snip...)
eth1      IEEE 802.11-DS  ESSID:&quot;BridgeSSID&quot;
          Mode:Master  Frequency:2.462 GHz  Access Point: 00:13:10:15:23:D2
          Tx-Power:22 dBm
          RTS thr=2347 B   Fragment thr=2346 B
          Encryption key:****-****-****-****-****-****-****-****-****-****-****-****-****-****-****-****
(...snap...)</code></pre></div><p>If the ESSID is empty - you may have the wrong nas binary.</p><p>4. Try to run the /sbin/hotplug (from <a href="http://www.bingner.com/openwrt/)">http://www.bingner.com/openwrt/)</a> manually with:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# export INTERFACE=wds0.2
root@OpenWrt:~# /sbin/hotplug
device wds0.2 is already a member of a bridge; can&#039;t enslave it to bridge br0.</code></pre></div><p>You should receive the brctl error message, because wds0.2 is allready part of the bridge - but if you wait for about 10 seconds, and you get another error message (&quot;No interface specified. Quitting...&quot;) something is wrong - I my case it was the wrong nas binary.</p><p>5. For diagnosis, put an echo into the hotplug script - locate the nas4not procedure, and edit it like this:<br /></p><div class="codebox"><pre><code>nas4not() {
  (
    while ! nasrunning; do
    sleep 1
    done
    # Wait - nas dosn&#039;t always accept registration immediately
    sleep 10
    echo /usr/sbin/nas4not $@     # &lt;- insert this line
    /usr/sbin/nas4not $@
  ) &amp;
}</code></pre></div><p>Now try step 4 again - after 10 seconds (or so) you should receive a copy of the nas4not command line on the console, which should look like this one:<br /></p><div class="codebox"><pre><code>/usr/sbin/nas4not lan wds0.2 up auto tkip psk mySimpleTestKey BridgeSSID</code></pre></div><p>6. Check the nvram - I have found out, that the S41wpa script (from sbingner) likes to have some variables set, which are otherwise not neccessary - e.g.:<br /></p><div class="codebox"><pre><code>lan_ifname=br0
lan_ifnames=vlan0 eth1</code></pre></div><p>And double check the other important nvram variables:<br /></p><div class="codebox"><pre><code>wl0_auth=0
wl0_auth_mode=psk
wl0_crypto=tkip
wl0_ssid=BridgeSSID
wl0_wds=00:13:10:15:23:cf
wl0_wep=disabled
wl0_wpa_gtk_rekey=3600
wl0_wpa_psk=mySimpleTestKey</code></pre></div><p>This list is eventually not fully complete - so try to check every setting again.</p><p>If you have WDS working without WPA and you have the &quot;sbingner-scripts&quot;, IMHO there must be an error with the nas binary or the nvram variables - I have no other idea.</p><p>Right now, my two WRT54GS (v1.1) are running WDS with WPA for about 17 hours - without any problem. I have started simultanious flood pings (ping -f ...) on both sides each crossing the bridge. And I have also startet bing on one side, to &quot;measure&quot; the throughput of the WDS/WPA link - with 22.5 Mbit/s it seems OK for me ;-)</p><p>I hope this will help - if not, contact me again, first we can try to cross-check the nvram variables on our boxes - second, I&#039;m trying to write a short documentation, of what I have done with my 2 WRT&#039;s (I&#039;m in the IT department of a mid sizes logistics company in Germany) to make it &quot;reproduceable&quot; - I have planned to post this doc on the openwrt.org Website, to help others.</p><p>HTH and bye<br />Daniel</p>											<p class="post-edited">(Last edited by <strong>nieslpriem</strong> on 26 May 2005, 10:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7626">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">gr0k</div>
					<div class="post-datetime">
						27 May 2005, 02:28					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for taking the time to give me more suggestions!</p><p>At this point, wds works with wpa turned off.&nbsp; (duh I should have tried that first)&nbsp; And I&#039;m using sbingner&#039;s scripts.&nbsp; I&#039;m pretty sure the nvram variables are set right, just in case here they are:</p><p>wl0_auth=0<br />wl0_auth_mode=psk<br />wl0_crypto=tkip<br />wl0_ssid=buser_basement<br />wl0_wds=00:12:17:C9:C5:3D<br />wl0_wep=disabled<br />wl0_wpa_gtk_rekey=3600<br />wl0_wpa_psk=test</p><p>Only difference is mine has:</p><p>lan_ifnames=vlan0 eth1 eth2 eth3</p><p>So, thinking it could be a bad nas, I downloaded <a href="http://www.linksys.com/support/opensourcecode/wrt54gs/3.37.2/wrt54gs.3.37.2.tgz">http://www.linksys.com/support/opensour … 3.37.2.tgz</a> which seems wrong, considering I&#039;m not running gs, I&#039;m running just g.&nbsp; Now the weirdest thing is, it can&#039;t execute nas as if it&#039;s not there, but it is there.&nbsp; See:</p><p>root@buser_basement:~# ls -lh /usr/sbin/nas<br />-rwx------&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp;123.6k May 26 18:12 /usr/sbin/nas<br />root@buser_basement:~# /usr/sbin/nas<br />-ash: /usr/sbin/nas: not found</p><p>?? So anyway... I&#039;m now downloading <a href="http://www.linksys.com/support/opensourcecode/wrt54g/3.01.3/wrt54g.3.01.3.tgz">http://www.linksys.com/support/opensour … 3.01.3.tgz</a> and will give that a try once it&#039;s finished.&nbsp; At this point, I can remember where I got the version of nas I was running.&nbsp; I think I got it by extracting it from the firmware image from WRT54GV2_3.01.3_US_code.bin.&nbsp; Perhaps the nas from the .tgz will be better... 200 meg download... for a 123k file... <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>											<p class="post-edited">(Last edited by <strong>gr0k</strong> on 27 May 2005, 02:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7628">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">gr0k</div>
					<div class="post-datetime">
						27 May 2005, 03:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gr0k wrote:</cite><blockquote><p>root@buser_basement:~# ls -lh /usr/sbin/nas<br />-rwx------&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp;123.6k May 26 18:12 /usr/sbin/nas<br />root@buser_basement:~# /usr/sbin/nas<br />-ash: /usr/sbin/nas: not found</p></blockquote></div><p>Woops, I was using the nas in the mipsel directory instead of the mipsel-uclibc.&nbsp; <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>So, I&#039;ve tried the nas from the latest wrt54g and wrt54gs 200 meg .tgz downloads... still not working.&nbsp; <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I don&#039;t know, should I upgrade to the latest openwrt?&nbsp; The one I&#039;m running is from 2005.04.23 (according to the busybox login message, what is the correct way to tell the version?)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p7633">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">cajoline</div>
					<div class="post-datetime">
						27 May 2005, 07:25					</div>
				</div>
				<div class="post-content content">
					<p>OK, finally success thanks to all of you guys!</p><p>The procedure that sbingner described and nielspriem further explained in detail definitely works.</p><p>At least for OpenWRT experimental 20050329 you need indeed the specific version of the nas binary (126444 bytes, 043685e8e6b8be97fd2a720d221f62a3 md5sum). I got this one from someone in #wrt54g. The one I initially extracted from the Linksys distribution (wrt54gs.3.37.2.tgz) was *not* the same, as by mistake I got the one from the mipsel tree instead of mipsel-uclibc. That one is 126536 bytes long.<br />gr0k, if you use the mipsel-uclibc one, as you noted yourself, this should work, no matter what distribution you get it from!</p><p>Using this version of nas, bringner&#039;s init script successfully starts nas, which authenticates the AP clients. Then his hotplug script, which is probably called when the wds0.2 interface is brought up, registers the key for the WDS link through nas4not,&nbsp; 10 seconds later. You can indeed have a separate key for WDS links, and actually it looks like you can have a separate key for every WDS link.</p><p>What fooled me the first time I tried this was first of all the nas binary, I was trying to use the wrong one.<br />Then I have also experienced a quite weird problem. I have a wireless client, a laptop running Windows XP SP2 with a Cisco Aironet 350 PCMCIA card. The Windows miniport driver, as it happens for many older 802.11b drivers, did not support WPA-PSK, so I had to install the current Cisco driver. Of course I had to install their complete suite, including the client manager and all the EAP drivers, which I later had to uninstall because it comes with a lot of (completely useless to me) bells and whistles which loads up the system considerably and also inevitably takes away some Windows easy-cheesy functionality (such as fast user switching). Removing the package you are left with a set of drivers which supports WPA-PSK, and from what others have reported, you can now use the crappy Windows Wireless Zero Configuration to manage the interface and connect to the network using WPA-PSK.</p><p>However, after I&#039;ve done all the above and finally try to connect to my WPA+WDS AP it seems like the Aironet client is completely crashing the wifi interface on the wrt54gs! I am not sure what is happening, I have used tcpdump trying to capture anything coming from the Aironet card that could give me some insight, and all I see is these two broadcasts:<br />23:27:33.271625 00:07:50:ca:fd:f2 &gt; Broadcast null xid/R: 01 00 len=0<br />23:27:33.272135 00:07:50:ca:fd:f2 &gt; 00:12:17:e7:7e:0b snap ui/C len=39<br />After that it just looks like eth1 is completely frozen, nothing comes in or out, and the WDS link eventually goes down...<br />Everything magically goes back to normal a few seconds after the Aironet radio shuts down.<br />You don&#039;t happen to have any clue what is going on here? I&#039;m not sure these are WPA related at all.</p><p>Anyway once again a big thank you to all three of you guys.</p>											<p class="post-edited">(Last edited by <strong>cajoline</strong> on 27 May 2005, 07:27)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>