<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Problem adjusting clock with openntpd</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p20033">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">StephenR0</div>
					<div class="post-datetime">
						1 Feb 2006, 19:26					</div>
				</div>
				<div class="post-content content">
					<p>I was running RC4 and noticed that my time was drifting.&nbsp; This is a WRT54GS version 2.1.&nbsp; I reinstalled and had the same problem.&nbsp; Just now, I got the latest snapshot of RC5 and seem to be having the same problem.&nbsp; Here are some ntpd messages that demonstrate what I talking about:</p><p>ntp engine ready<br />reply from 202.173.190.30: offset -0.149107 delay 0.264184, next query 5s<br />reply from 202.173.190.30: offset -0.081669 delay 0.407680, next query 5s<br />reply from 202.173.190.30: offset -0.162649 delay 0.260134, next query 5s<br />peer 202.173.190.30 now valid<br />reply from 202.173.190.30: offset -0.169952 delay 0.266047, next query 5s<br />reply from 202.173.190.30: offset -0.171825 delay 0.256831, next query 5s<br />reply from 202.173.190.30: offset -0.172606 delay 0.266266, next query 5s<br />reply from 202.173.190.30: offset -0.180708 delay 0.254188, next query 83s<br />reply from 202.173.190.30: offset -0.261974 delay 0.270893, next query 57s<br />adjusting local clock by -0.180708s<br />reply from 202.173.190.30: offset -0.292880 delay 0.256159, next query 51s<br />reply from 202.173.190.30: offset -0.310264 delay 0.270391, next query 48s<br />reply from 202.173.190.30: offset -0.343430 delay 0.255689, next query 43s<br />reply from 202.173.190.30: offset -0.368003 delay 0.265315, next query 40s<br />reply from 202.173.190.30: offset -0.376725 delay 0.268369, next query 39s<br />reply from 202.173.190.30: offset -0.400322 delay 0.259992, next query 37s<br />reply from 202.173.190.30: offset -0.422815 delay 0.253269, next query 35s<br />adjusting local clock by -0.422815s<br />reply from 202.173.190.30: offset -0.440518 delay 0.254082, next query 34s<br />reply from 202.173.190.30: offset -0.457762 delay 0.255851, next query 32s<br />reply from 202.173.190.30: offset -0.473482 delay 0.252992, next query 31s<br />reply from 202.173.190.30: offset -0.489123 delay 0.257798, next query 30s<br />reply from 202.173.190.30: offset -0.504052 delay 0.257961, next query 30s<br />reply from 202.173.190.30: offset -0.520328 delay 0.257732, next query 30s<br />reply from 202.173.190.30: offset -0.533866 delay 0.254549, next query 30s<br />reply from 202.173.190.30: offset -0.549388 delay 0.254005, next query 30s<br />adjusting local clock by -0.473482s<br />reply from 202.173.190.30: offset -0.564953 delay 0.255268, next query 30s<br />reply from 202.173.190.30: offset -0.580751 delay 0.255172, next query 30s<br />reply from 202.173.190.30: offset -0.594351 delay 0.261779, next query 30s<br />adjusting local clock by -0.549388s<br />reply from 202.173.190.30: offset -0.610277 delay 0.256282, next query 30s<br />reply from 202.173.190.30: offset -0.624437 delay 0.259881, next query 30s</p><p>As you can see, the clock isn&#039;t actually getting set, but the time did seem to get set on boot.&nbsp; Has anyone seen this before?</p><p>Steve</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20902">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">DennisMoore</div>
					<div class="post-datetime">
						15 Feb 2006, 14:34					</div>
				</div>
				<div class="post-content content">
					<p>I am runnning RC4 with openntpd with the default config.</p><p>I get the same messages and my clock is always up-to-date.<br />I even tried to fool the system by setting the clock to -30 seconds manually.<br />After the next sync the clock was reset to the correct time.</p><p>All I did was installing openntpd by using ipkg.<br />I altered the ntp.conf in /etc, setting the &quot;listen on&quot; parameter to provide ntp service to the locally connected machines.</p><p>Of course I set the local Timezone in /etc/TZ so that my local time would be correct (GMT +1).</p><p>I get &quot;peer ... now valid&quot; and some time after that the &quot;adjusting clock&quot; message.</p><p>So no problem at all.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20903">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						15 Feb 2006, 14:39					</div>
				</div>
				<div class="post-content content">
					<p>This is a hardware issue -- there is no actual clock; it does not make any sense to run a time server on a system that is incapable of keeping time.</p><p>What you see when you run &#039;date&#039; is the system clock; a software emulation which is based on counting clock cycles, which isn&#039;t very accurate.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20908">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">StephenR0</div>
					<div class="post-datetime">
						15 Feb 2006, 18:14					</div>
				</div>
				<div class="post-content content">
					<p>I understand that there is no real clock hardware on these machines.&nbsp; I don&#039;t really expect much out of it.&nbsp; I&#039;m just confused by the fact that ntpd can&#039;t seem to adjust the software clock when it tries to do it, at least on my machine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20909">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">florian_</div>
					<div class="post-datetime">
						15 Feb 2006, 18:14					</div>
				</div>
				<div class="post-content content">
					<p>use rdate instead, it works fine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20910">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">StephenR0</div>
					<div class="post-datetime">
						15 Feb 2006, 18:22					</div>
				</div>
				<div class="post-content content">
					<p>Since I noticed this problem, I&#039;ve been using ntpclient which seems to work as well.</p><p>Edit:&nbsp; Actually, I should have mentioned that I&#039;m using ntpclient in a cron job to periodically set the time once each time.&nbsp; Ntpclient has the same problem trying to keep the time syncronized that ntpd does, again at least on my machine.</p>											<p class="post-edited">(Last edited by <strong>StephenR0</strong> on 15 Feb 2006, 18:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p24331">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">StephenR0</div>
					<div class="post-datetime">
						3 Apr 2006, 07:06					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve solved this problem.&nbsp; Referencing this thread:</p><p><a href="http://forum.openwrt.org/viewtopic.php?id=534">http://forum.openwrt.org/viewtopic.php?id=534</a></p><p>I tried the ntpclient frequency tuning procedure and ended up with such a large frequency that adjtimex couldn&#039;t set it.&nbsp; From this howto (also referenced in the above thread):</p><p><a href="http://doolittle.icarus.com/ntpclient/HOWTO">http://doolittle.icarus.com/ntpclient/HOWTO</a></p><p>there&#039;s a paragraph that touches on using adjtimex -t to make course adjustments to the system clock.&nbsp; I found that I could get the tuning procedure to test various values of adjtimex -t (default 10000).&nbsp; My hardware took a value of 9990 (a relatively large change) to get a reasonably accurate clock.&nbsp; With that value, I ran the tuning procedure again and arrived at a much smaller frequency value that adjtimex could set.&nbsp; Now I set both the -t and -f values in the openntpd startup script and everything runs just fine.&nbsp; It would be nice if you didn&#039;t have to rebuild busybox with adjtimex selected to get the adjtimex utility, though.&nbsp; Hopefully, this will help someone else with the same problem some day.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>