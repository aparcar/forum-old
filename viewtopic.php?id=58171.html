<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unbricking tp-link mr 3420 v2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p281316">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mr9</div>
					<div class="post-datetime">
						25 Jun 2015, 14:09					</div>
				</div>
				<div class="post-content content">
					<p>Hello everybody,<br />I&#039;ve searched for similiar problems but since I haven&#039;t found any I&#039;m posting such one myself.<br />So I&#039;ve bricked (i think so) my mr3420v2. To make long story short: I have installed Gargoyle instead of original firmware in search of broader possibilities. Everything worked like it should but I haven&#039;t found what I was looking for so I tried to install open-wrt instead (which perhaps was the thing that doomed me). The installation completed and bang - cannot access my router via browser interface anymore.<br />I reasearched some information about how to debrick on wiki.openwrt.org. Found out that I should put it into failsafe. So I tried to according to this info <a href="http://wiki.openwrt.org/doc/howto/generic.failsafe.">http://wiki.openwrt.org/doc/howto/generic.failsafe.</a> And this is where the problems began. In normal mode I could access the router via telnet and the interface was there. But when in failsafe (fast-blinking sys led) when I tried to telnet nothing was displayed. I tried entering mtd -r erase rootfs_data command in normal mode, the device rebooted, but there was no change whatsoever. So instead I set up a root password and proceeded to SSH (it was also told somewhere in the site). I wasn&#039;t able to do anything there as well. Then I dropped the topic for several weeks, as I had no time for it.<br />Now I need my router again so I turn to you for help. However I see more problems now. When I try to telnet it says connection refused and I cant SSH to it because I forgot the password I have set weeks ago.<br />I really hope you guys can help get out of it. I would be very thankfull. I will try to provide you with any desired information that I am able to derive. Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281415">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ruvy99x</div>
					<div class="post-datetime">
						26 Jun 2015, 04:08					</div>
				</div>
				<div class="post-content content">
					<p>Keep browsing through OpenWRT wiki, you might find a way to get in. Also, did you try a hard reset on your router?</p><p>MR3420 has very low processor, you shouldnt have tried flashing its ROM</p><p>Check <a href="http://www.techkhoji.com/recover-reset-router-modem-password/">this guide on how to do a factory reset on your router.</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281416">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						26 Jun 2015, 04:41					</div>
				</div>
				<div class="post-content content">
					<p>In most cases, allowing the router to boot fully into OpenWrt, then holding the reset button down for more than 5 seconds, then releasing it, will initiate a reset to defaults which will erase the password.</p><p>You need one of the release versions to have the web interface built in.&nbsp; The trunk builds do not include it.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 26 Jun 2015, 04:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281421">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">minix</div>
					<div class="post-datetime">
						26 Jun 2015, 05:43					</div>
				</div>
				<div class="post-content content">
					<p>How about that:</p><p>1. Download the stock firmware (TL-MR3420_V2_150319) from <a href="http://www.tp-link.com/en/handlers/download.ashx?resourceid=13172">here</a> or BB openwrt from <a href="https://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/openwrt-ar71xx-generic-tl-mr3420-v2-squashfs-factory.bin">here</a>.</p><p>2. Download TFTPD from <a href="http://tftpd32.jounin.net/download/Tftpd32-4.52-setup.exe">here</a>. I suppose your PC is running Windows. If not, use the appropriate OS version. If firewall is blocking it, allow access!</p><p>3. Install the TFTPD. Rename The firmware .bin file to &quot;mr3420v2_tp_recovery.bin&quot; and copy it to the tftpd&#039;s root directory.</p><p>4. Connect your twisted pair cable to you PC and to one of your router LAN (perhaps yellow) ports.</p><p>5. Configure your PC network interface (card) with IP 192.168.0.66/24. If your tftpd server receives no connection on that IP address then try with x.x.1.66/24.</p><p>6. Run the tftpd server on your PC.</p><p>7. While your router is plugged off from the power supply or just switched off from the power on/off button, press and hold the RESET button, then turn on your router while keep pressing the RESET button for about 3 more seconds and then release it.</p><p>8. Now wait until your router reboots and then when its done loading, you can access it via <a href="http://192.168.0.1">http://192.168.0.1</a> (openwrt) or <a href="http://192.168.1.1">http://192.168.1.1</a> or whatever (stock firmware).</p><p>Hope that helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281423">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						26 Jun 2015, 06:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>minix wrote:</cite><blockquote><p>How about that:</p><p>1. Download the stock firmware (TL-MR3420_V2_150319) from <a href="http://www.tp-link.com/en/handlers/download.ashx?resourceid=13172">here</a> or BB openwrt from <a href="https://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/openwrt-ar71xx-generic-tl-mr3420-v2-squashfs-factory.bin">here</a>.</p><p>2. Download TFTPD from <a href="http://tftpd32.jounin.net/download/Tftpd32-4.52-setup.exe">here</a>. I suppose your PC is running Windows. If not, use the appropriate OS version. If firewall is blocking it, allow access!</p><p>3. Install the TFTPD. Rename The firmware .bin file to &quot;mr3420v2_tp_recovery.bin&quot; and copy it to the tftpd&#039;s root directory.</p><p>4. Connect your twisted pair cable to you PC and to one of your router LAN (perhaps yellow) ports.</p><p>5. Configure your PC network interface (card) with IP 192.168.0.66/24. If your tftpd server receives no connection on that IP address then try with x.x.1.66/24.</p><p>6. Run the tftpd server on your PC.</p><p>7. While your router is plugged off from the power supply or just switched off from the power on/off button, press and hold the RESET button, then turn on your router while keep pressing the RESET button for about 3 more seconds and then release it.</p><p>8. Now wait until your router reboots and then when its done loading, you can access it via <a href="http://192.168.0.1">http://192.168.0.1</a> (openwrt) or <a href="http://192.168.1.1">http://192.168.1.1</a> or whatever (stock firmware).</p><p>Hope that helps.</p></blockquote></div><p>Don&#039;t think this will work AFAIK mr3420 never had uboot updates with the failsafe mechanism.<br />Correction V2 has it, it is V1 that has no uboot upgrades</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 26 Jun 2015, 06:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281455">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mr9</div>
					<div class="post-datetime">
						26 Jun 2015, 12:33					</div>
				</div>
				<div class="post-content content">
					<p>Thank you guys for your response. I have succesfully reverted password to default.<br />Now, minix, thanks for your instruction but something is not clear to me.<br />At point 5, do I configure the net interface in my network properties? Like here?<br /><span class="postimg"><img src="http://i.imgur.com/gGjl7ta.png" alt="0" /></span><br />How do I know if I reveive a connection on the tftpd?<br />Then where is the part where i somehow interact with the router giving it the bin file I downloaded?</p><p>PS. When I input the adress and file here:<br /><span class="postimg"><img src="http://i.imgur.com/GxzRW0b.png" alt="1" /></span></p><p>And then press &quot;put&quot; (is this what I&#039;m supposed to do?) the progress bar never fills.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281476">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">minix</div>
					<div class="post-datetime">
						26 Jun 2015, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>Yes, the network interface is configured correctly.</p><p>On the tftpd procedure. The current directory is the tftpd&#039;s root directory and may wanna change that or just copy the renamed image file to it. Either way you need the renamed firmware image in the tftpd&#039;s root directory. Then select the proper interface (192.168.0.66) from the interfaces drop-down list. After that click on the &quot;Tftp Server&quot; tab and there you will see the connection attempts and file transfers. You might also see some data in the &quot;Log viewer&quot; tab. Then just proceed as described in my earlier post.</p><p>Note that before all you may need to shave off the first 131584 bytes <strong>ONLY</strong> if you&#039;re going to flash stock firmware. But I am not quite sure about that because I&#039;ve successfully used the above procedure on many TL models without shaving off anything from the stock firmware. Here is the trimming procedure anyway:</p><p>1. Make sure your stock firmware has the &quot;boot&quot; word in its name or that the .bin file size is 4063744 bytes.<br />2. Download the DD for Windows in your case from <a href="http://www.chrysocome.net/downloads/dd-0.5.zip">here</a><br />3. Extract the DD utility and copy the stock firmware in the same directory.<br />5. Run CMD and navigate to the directory you&#039;ve copied the DD utility to.<br />6. In CMD type the following </p><div class="codebox"><pre><code>dd if=&quot;stock-firmware-name.bin&quot; of=mr3420v2_tp_recovery.bin skip=257 bs=512</code></pre></div><p>7. That&#039;s it!</p><p>Because the tftpd procedure is manufacturer procedure I don&#039;t think proceeding without shaving off anything would be a problem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281503">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						26 Jun 2015, 22:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>minix wrote:</cite><blockquote><p>Because the tftpd procedure is manufacturer procedure I don&#039;t think proceeding without shaving off anything would be a problem.</p></blockquote></div><p>the problem is that not all tp-link firmware have uboot included..&nbsp; look at the file size and make your decision <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>the tftpd procedure is &quot;stupid&quot;, you have to know that it &quot;wants&quot; a file without uboot <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281507">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">minix</div>
					<div class="post-datetime">
						27 Jun 2015, 00:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><p>the problem is that not all tp-link firmware have uboot included..&nbsp; look at the file size and make your decision <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>I think I&#039;ve already mentioned that in the 1st step of the trimming procedure.</p><div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><p>the tftpd procedure is &quot;stupid&quot;, you have to know that it &quot;wants&quot; a file without uboot <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>tl-wr841n v9 is working with the uboot included in the firmware! It does have &quot;boot&quot; in the name and the file size is 4063744 bytes. Here, take a look at the screenshot:</p><p><span class="postimg"><img src="http://i57.tinypic.com/2hx14qq.png" alt="http://i57.tinypic.com/2hx14qq.png" /></span></p><p>Look at the transferred bytes and the filesize. After that it copies the firmware to the flash, then it says Done and boots into the new firmware. So, maybe some devices wants firmware without uboot but not all. You know a list of any that wants firmware without uboot for sure?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281546">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						27 Jun 2015, 09:42					</div>
				</div>
				<div class="post-content content">
					<p>wow, sorry for being incorrect, that is the first time I see something like that, if I&#039;d have to write a list I&#039;d say every model exept yours ^^</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281560">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">mr9</div>
					<div class="post-datetime">
						27 Jun 2015, 13:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>minix wrote:</cite><blockquote><p>On the tftpd procedure. The current directory is the tftpd&#039;s root directory and may wanna change that or just copy the renamed image file to it. Either way you need the renamed firmware image in the tftpd&#039;s root directory. Then select the proper interface (192.168.0.66) from the interfaces drop-down list. After that click on the &quot;Tftp Server&quot; tab and there you will see the connection attempts and file transfers. You might also see some data in the &quot;Log viewer&quot; tab. Then just proceed as described in my earlier post.</p></blockquote></div><p>Well, that doesn&#039;t seem to work. I choose 192.168.0.66 or x.x.1.66 but whenever I change a tab the network interface reverts to 127.0.0.1 Software loop. And when I choose the correct one while on &quot;server&quot; tab it displays nothing. Maybe there is something in settings that I ought to set?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281577">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						27 Jun 2015, 16:44					</div>
				</div>
				<div class="post-content content">
					<p>The PC&#039;s ethernet port has to be up- cable plugged in to a live device at the other end and the link light (if equipped) on.&nbsp; &nbsp;You may need to use an ethernet switch or another router (acting as a simple switch) so the PC port stays &quot;connected&quot; and Windows doesn&#039;t kill your server as you cut the power to the router and reboot it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281622">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">minix</div>
					<div class="post-datetime">
						28 Jun 2015, 06:22					</div>
				</div>
				<div class="post-content content">
					<p>The tftp server is passive program that waits for client requests. In your case the client is the router.</p><p>Choose 192.168.0.66 while you&#039;re on the &quot;Tftp Server&quot; tab. Make sure that this IP address is configured actually on your Ethernet port and not some virtual device. As I see your Ethernet adapter seems to be Realtek. Make sure that you&#039;ve allowed access to the tftpd32 program in your firewall. Make sure that the renamed firmware file is located in the tftpd&#039;s root directory (Current Directory) /steps 1 and 3/. Make sure that the tftpd32 program is running during the whole procedure. After this point no additional settings for the Tftpd32 program are needed.</p><p>When you choose the correct interface while on the &quot;Tftp Server&quot; tab nothing happens, that is normal. Then you need to follow steps 4, 7 and 8.</p><p>If you have spare devices, then follow what mk24 said, it might help. But most of the time it should work without additional switch because the tftpd server is listening on all interfaces </p><div class="codebox"><pre><code>UDP 0.0.0.0:67, UDP 0.0.0.0:69</code></pre></div><p>. A brief lost of Ethernet connection shouldn&#039;t be a concern also. Tested all the cases!</p><p>Btw, bear in mind the DD procedure. Your router may need it.</p><p>There is also a possibility that your router&#039;s stock firmware were old and your U-boot boot-loader may not support the fail-safe protocol. I believe that the fail-safe update is coming with some of the firmwares but I am not sure.</p><p>One more thing. This procedure is used mainly for bricked devices. Is your device really bricked? If it&#039;s not and if you simply want to revert back to stock firmware, then do the following:</p><p>1. Download /better/ the oldest available stock firmware for your device.<br />2. Follow the DD procedure as described earlier. Mind the size of the firmware .bin file.<br />3. Transfer the ready firmware to the router&#039;s /tmp directory via SCP. You can use <a href="http://the.earth.li/~sgtatham/putty/latest/x86/pscp.exe">this</a> tool from CMD. Here is example </p><div class="codebox"><pre><code>PSCP.EXE -p ready-firmware.bin root@192.168.1.1:/tmp</code></pre></div><p>4. Login the to device via SSH.<br />5. Execute </p><div class="codebox"><pre><code>mtd -r write /tmp/ready-firmware.bin firmware</code></pre></div><p>6. Keep in mind that I am not 100% sure that this won&#039;t brick your router. You see, this is not an exact science as you already might have guessed.</p><p>If everything else fails, then look on <a href="http://redacacia.me/2013/03/07/debrick-your-tl-mr3420-router-with-a-serial-ttl-cable/">this</a> page.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p322508">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">brimur</div>
					<div class="post-datetime">
						4 May 2016, 14:49					</div>
				</div>
				<div class="post-content content">
					<p>Just wanted to say thanks for the TFTP recovery info. I was using Solarwinds TFTP but that did not get picked up for some reason. Using TFTPD32 worked a treat! </p><p>I had to do this recovery when I tried to write the stock firmware back over OpenWRT and it threw an error saying it could not erase a block and then the router was unusable</p>											<p class="post-edited">(Last edited by <strong>brimur</strong> on 4 May 2016, 14:50)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>