<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Why can I still see fq_codel in bmon after turn SQM off?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 11 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p369629">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">a2232189</div>
					<div class="post-datetime">
						15 Dec 2017, 07:27					</div>
				</div>
				<div class="post-content content">
					<p>I use command </p><div class="codebox"><pre><code>/etc/init.d/sqm stop</code></pre></div><p> to stop sqm. Here is output:</p><div class="quotebox"><blockquote><p>root@OpenWrt:~# /etc/init.d/sqm stop<br />SQM: /usr/lib/sqm/stop-sqm: Stopping eth0.2<br />SQM: ifb associated with interface eth0.2: <br />SQM: Currently no ifb is associated with eth0.2, this is normal during starting of the sqm system.<br />SQM: /usr/lib/sqm/stop-sqm: ifb4eth0.2 shaper deleted<br />SQM: /usr/lib/sqm/stop-sqm: ifb4eth0.2 interface deleted<br />SQM: /usr/lib/sqm/stop-sqm: Stopping wlan0<br />SQM: ifb associated with interface wlan0: <br />SQM: Currently no ifb is associated with wlan0, this is normal during starting of the sqm system.<br />SQM: /usr/lib/sqm/stop-sqm: ifb4wlan0 shaper deleted<br />SQM: /usr/lib/sqm/stop-sqm: ifb4wlan0 interface deleted<br />root@OpenWrt:~# bmon<br />root@OpenWrt:~# bmon<br />root@OpenWrt:~# /etc/init.d/sqm stop<br />root@OpenWrt:~# /etc/init.d/sqm stop<br />root@OpenWrt:~# /etc/init.d/sqm stop</p></blockquote></div><p>However, if I use bmon to see network traffic, I can still see fq_codel, which means SQM is not turned off :</p><br /><p> </p><div class="quotebox"><blockquote><p>lo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bmon 3.5 <br />Interfaces&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x RX bps&nbsp; &nbsp; &nbsp; &nbsp;pps&nbsp; &nbsp; &nbsp;%x TX bps&nbsp; &nbsp; &nbsp; &nbsp;pps&nbsp; &nbsp; &nbsp;%<br /> &gt;lo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; eth0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x 120.59KiB&nbsp; &nbsp; 137&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp;9.81KiB&nbsp; &nbsp; 116<br />&nbsp; &nbsp; qdisc none (fq_codel)&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp;9.35KiB&nbsp; &nbsp; 116<br />&nbsp; &nbsp; eth0.1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x 115.02KiB&nbsp; &nbsp; 117&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp;9.34KiB&nbsp; &nbsp; 116<br />&nbsp; &nbsp; eth0.2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x&nbsp; &nbsp;3.15KiB&nbsp; &nbsp; &nbsp;20&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp; &nbsp;14B&nbsp; &nbsp; &nbsp; &nbsp; 0<br />&nbsp; br-lan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x 114.89KiB&nbsp; &nbsp; 116&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp;9.34KiB&nbsp; &nbsp; 116<br />&nbsp; wlan0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x&nbsp; &nbsp;9.02KiB&nbsp; &nbsp; 115&nbsp; &nbsp; &nbsp; x 118.67KiB&nbsp; &nbsp; 115<br />&nbsp; tun0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; qdisc none (fq_codel)&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; x&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</p></blockquote></div><p>Am I missing something here? How can I truely turn SQM off without reboot?</p>											<p class="post-edited">(Last edited by <strong>a2232189</strong> on 15 Dec 2017, 07:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369644">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						15 Dec 2017, 18:32					</div>
				</div>
				<div class="post-content content">
					<p>Erm, please post the output of:</p><p>cat /etc/config/sqm<br />tc -s qdisc<br />tc -s qdisc</p><p>Most likely you see fq_codel as I believe this is the default qdisc in openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369663">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">a2232189</div>
					<div class="post-datetime">
						16 Dec 2017, 04:07					</div>
				</div>
				<div class="post-content content">
					<p>One thing I must metion is that, I uninstalled luci-app-sqm after I posted this topic but before I posted this reply. (sqm-scripts hasn&#039;t been uninstalled.) I don&#039;t know whether the uninstall action will cause something different so I metioned it here.<br /></p><div class="quotebox"><blockquote><p>root@OpenWrt:~# cat /etc/config/sqm</p><p>config queue &#039;eth1&#039;<br />&nbsp; &nbsp; option qdisc &#039;fq_codel&#039;<br />&nbsp; &nbsp; option script &#039;simple.qos&#039;<br />&nbsp; &nbsp; option qdisc_advanced &#039;0&#039;<br />&nbsp; &nbsp; option linklayer &#039;none&#039;<br />&nbsp; &nbsp; option interface &#039;wlan0&#039;<br />&nbsp; &nbsp; option download &#039;0&#039;<br />&nbsp; &nbsp; option upload &#039;0&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p><p>config queue<br />&nbsp; &nbsp; option qdisc &#039;fq_codel&#039;<br />&nbsp; &nbsp; option script &#039;simple.qos&#039;<br />&nbsp; &nbsp; option linklayer &#039;none&#039;<br />&nbsp; &nbsp; option interface &#039;eth0.2&#039;<br />&nbsp; &nbsp; option download &#039;0&#039;<br />&nbsp; &nbsp; option upload &#039;0&#039;<br />&nbsp; &nbsp; option qdisc_advanced &#039;0&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p><p>root@OpenWrt:~# tc -s qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 13719269501 bytes 16813727 pkt (dropped 0, overlimits 0 requeues 501) <br /> backlog 0b 0p requeues 501 <br />&nbsp; maxpacket 13626 drop_overlimit 0 new_flow_count 989 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc mq 0: dev wlan0 root <br /> Sent 721992021 bytes 3568052 pkt (dropped 323, overlimits 0 requeues 199) <br /> backlog 0b 0p requeues 199 <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 1866486 bytes 5385 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 720099320 bytes 3562538 pkt (dropped 323, overlimits 0 requeues 199) <br /> backlog 0b 0p requeues 199 <br />&nbsp; maxpacket 7370 drop_overlimit 0 new_flow_count 2710 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 26215 bytes 129 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc fq_codel 0: dev tun0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />root@OpenWrt:~#</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369664">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">a2232189</div>
					<div class="post-datetime">
						16 Dec 2017, 04:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Erm, please post the output of:</p><p>cat /etc/config/sqm<br />tc -s qdisc<br />tc -s qdisc</p><p>Most likely you see fq_codel as I believe this is the default qdisc in openwrt.</p></blockquote></div><p>So are you suggesting that fq_codel is the default qdisc in openwrt? In other words, I can&#039;t verify whether SQM is enable or not by using bmon to see whether there is traffic through fq_codel, right?</p>											<p class="post-edited">(Last edited by <strong>a2232189</strong> on 16 Dec 2017, 04:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369699">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						16 Dec 2017, 22:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>a2232189 wrote:</cite><blockquote><p>One thing I must metion is that, I uninstalled luci-app-sqm after I posted this topic but before I posted this reply. (sqm-scripts hasn&#039;t been uninstalled.) I don&#039;t know whether the uninstall action will cause something different so I metioned it here.<br /></p><div class="quotebox"><blockquote><p>root@OpenWrt:~# cat /etc/config/sqm</p><p>config queue &#039;eth1&#039;<br />&nbsp; &nbsp; option qdisc &#039;fq_codel&#039;<br />&nbsp; &nbsp; option script &#039;simple.qos&#039;<br />&nbsp; &nbsp; option qdisc_advanced &#039;0&#039;<br />&nbsp; &nbsp; option linklayer &#039;none&#039;<br />&nbsp; &nbsp; option interface &#039;wlan0&#039;<br />&nbsp; &nbsp; option download &#039;0&#039;<br />&nbsp; &nbsp; option upload &#039;0&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p><p>config queue<br />&nbsp; &nbsp; option qdisc &#039;fq_codel&#039;<br />&nbsp; &nbsp; option script &#039;simple.qos&#039;<br />&nbsp; &nbsp; option linklayer &#039;none&#039;<br />&nbsp; &nbsp; option interface &#039;eth0.2&#039;<br />&nbsp; &nbsp; option download &#039;0&#039;<br />&nbsp; &nbsp; option upload &#039;0&#039;<br />&nbsp; &nbsp; option qdisc_advanced &#039;0&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p><p>root@OpenWrt:~# tc -s qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 13719269501 bytes 16813727 pkt (dropped 0, overlimits 0 requeues 501) <br /> backlog 0b 0p requeues 501 <br />&nbsp; maxpacket 13626 drop_overlimit 0 new_flow_count 989 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc mq 0: dev wlan0 root <br /> Sent 721992021 bytes 3568052 pkt (dropped 323, overlimits 0 requeues 199) <br /> backlog 0b 0p requeues 199 <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 1866486 bytes 5385 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 720099320 bytes 3562538 pkt (dropped 323, overlimits 0 requeues 199) <br /> backlog 0b 0p requeues 199 <br />&nbsp; maxpacket 7370 drop_overlimit 0 new_flow_count 2710 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 26215 bytes 129 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />qdisc fq_codel 0: dev tun0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br /> Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0<br />root@OpenWrt:~#</p></blockquote></div></blockquote></div><p>Okay, un-installing luci-app-sqm will not disable running or configured sqm instances. In your case you set the upload and download to zero which effectively disables sqm&#039;s shaper (it seems less round about to me to better set &quot;enabled&quot; to zero, but that is just me). Since simple.qos/fq_codel will employ htb as its traffic shaper the fact that you do not see entries for htb in the &quot;tc qdisc&quot; outputs confirms tat sqm is doing nothing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369700">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						16 Dec 2017, 22:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>a2232189 wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Erm, please post the output of:</p><p>cat /etc/config/sqm<br />tc -s qdisc<br />tc -s qdisc</p><p>Most likely you see fq_codel as I believe this is the default qdisc in openwrt.</p></blockquote></div><p>So are you suggesting that fq_codel is the default qdisc in openwrt? In other words, I can&#039;t verify whether SQM is enable or not by using bmon to see whether there is traffic through fq_codel, right?</p></blockquote></div><p>As far as I remember, yes fq_codel is openwrt/lede&#039;s default qdisc, so simply seeing fq_codel instances is not diagnostic for sqm-scripts one way or the other.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>