<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [How to] bridgeAP via ethernet with DHCP from bridge?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 11 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p205349">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">des245</div>
					<div class="post-datetime">
						22 Jun 2013, 20:36					</div>
				</div>
				<div class="post-content content">
					<p>------------------------------------<br />Using Openwrt on a TP MR3040.<br />------------------------------------</p><br /><p>What i want to achieve is this -<br />----------------------------------</p><p>TL-MR3040 to connect to &#039;main router&#039; via &#039;ethernet cable only&#039; (TL-MR3040&#039;s WAN port to main router&#039;s LAN port) and then internet is then shared via &#039;wifi&#039; AP on the TL-MR3040 to multiple wifi clients. </p><p>Client should then only gets their ip addresses from &#039;wifi&#039; (DHCP on the TL-MR3040) and not from the &#039;main router&#039;.</p><br /><br /><p>What i have now is -<br />----------------------</p><p>TL-MR3040 is connected to &#039;main router&#039; via &#039;ethernet cable only&#039; and then internet is then shared via &#039;wifi&#039; AP on the TL-MR3040 to wifi client. </p><p>Client does connect okay to the internet, however client only get its ip address from DHCP on the &#039;main router&#039; and not from DHCP on the TL-MR3040.</p><br /><p>Any comments or help or direction will be most appreciated.</p><p>Thanks <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>p.s.</p><p>Please note that the TL-MR3040 has only one ethernet port, so any possible solution should take this into consideration.</p>											<p class="post-edited">(Last edited by <strong>des245</strong> on 24 Jun 2013, 16:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205405">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						23 Jun 2013, 14:38					</div>
				</div>
				<div class="post-content content">
					<p>Is the lan port set as WAN?<br />network<br /></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcp&#039;</code></pre></div><p>Check the repeater config #2 on this post:<br /><a href="https://forum.openwrt.org/viewtopic.php?id=39077">https://forum.openwrt.org/viewtopic.php?id=39077</a><br />Cheers</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 23 Jun 2013, 14:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205409">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">des245</div>
					<div class="post-datetime">
						23 Jun 2013, 15:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dabyd64 wrote:</cite><blockquote><p>Is the lan port set as WAN?<br />network<br /></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcp&#039;</code></pre></div><p>Check the repeater config #2 on this post:<br /><a href="https://forum.openwrt.org/viewtopic.php?id=39077">https://forum.openwrt.org/viewtopic.php?id=39077</a><br />Cheers</p></blockquote></div><p>Thanks for dropping by mate ...appreciated.</p><p>Will have a look and try your suggestion out and will report back if successful <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205494">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">des245</div>
					<div class="post-datetime">
						24 Jun 2013, 14:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dabyd64 wrote:</cite><blockquote><p>Is the lan port set as WAN?<br />network<br /></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcp&#039;</code></pre></div><p>Check the repeater config #2 on this post:<br /><a href="https://forum.openwrt.org/viewtopic.php?id=39077">https://forum.openwrt.org/viewtopic.php?id=39077</a><br />Cheers</p></blockquote></div><p>Hi dabyd64</p><p>I am afraid your suggestions didnt get things working as i need it to be <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>It could be because i didnt really undertand what you suggested thought, however this is what happened:</p><p>I did change lan to wan as you suggested but the result of that was me not being able to get an ip from the TL-MR3040 via wifi or ethernet and had to use the TL-MR3040 <strong>&#039;failsafe-mode&#039;</strong> in order to be able to telnet into it and then change &#039;network&#039; setting back to what it was before, only then was i able to then get an ip as normal from it again.</p><p>I also checked out the link you quoted <span class="bbu"> but that is for connecting to a mainrouter&#039;s wifi signal and repeating it via a wifi-AP on the second router</span> e.g. on the TL-MR3040...where wifi clients then connect to the TL-MR3040 wifi-AP and get their ip addresses from the TL-MR3040, whilst the mainrouter only sees the connection from the TL-MR3040.</p><p>...what i want to do is similar but slightly different:-</p><p>I want to connect from the TL-MR3040 to a mainrouter <strong><span class="bbu">via ethernet ports only</span></strong> (TL-MR3040&#039;s WAN port to main router&#039;s LAN port) using ethernet cable and then create a wifi-AP on the TL-MR3040 for clients to connect to and most importantly <strong><span class="bbu">for these wifi clients to get their ip from the TL-MR3040 only</span></strong> and not from the mainrouter. I only want the mainrouter to see and give out an ip to the TL-MR3040 (and not for the mainrouter to see the clients connected to the TL-MR3040).</p><br /><p>Cheers mate <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>p.s.</p><p>dont worry about me bricking the TL-MR3040, i know how to use either <strong><span style="color: blue">&#039;failsafe-mode&#039; or go in via serial to fix it</span></strong>, so i am willing to try any suggestion <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>											<p class="post-edited">(Last edited by <strong>des245</strong> on 24 Jun 2013, 16:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205638">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						25 Jun 2013, 11:48					</div>
				</div>
				<div class="post-content content">
					<p>OpenWrt, by default, bridges the wireless network to the LAN, i.e. br-lan. You want to &quot;break&quot; that bridge and define eth0 as wan/dhcp. Delete<br /></p><div class="codebox"><pre><code>option ifname &#039;eth0&#039;
option type &#039;bridge&#039;</code></pre></div><p> in /e/c/network interface &#039;lan&#039; section and introduce what dabyd64 just posted.</p><p>If you&#039;re lost, please post TL-MR3040&#039;s default /e/c/network, /e/c/wireless.</p><p>Also, if you mess up but still have access to ssh, issue<br /></p><div class="codebox"><pre><code># firstboot</code></pre></div><p> to reset the router to default settings.</p><p>EDIT: option ipaddr in interface &#039;lan&#039; section certainly need to be different from host router subnet, e.g. host router=192.168.1.1/24, TL-MR3040=192.168.2.1/24</p>											<p class="post-edited">(Last edited by <strong>orange</strong> on 25 Jun 2013, 12:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205686">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">des245</div>
					<div class="post-datetime">
						25 Jun 2013, 21:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>orange wrote:</cite><blockquote><p>OpenWrt, by default, bridges the wireless network to the LAN, i.e. br-lan. You want to &quot;break&quot; that bridge and define eth0 as wan/dhcp. Delete<br /></p><div class="codebox"><pre><code>option ifname &#039;eth0&#039;
option type &#039;bridge&#039;</code></pre></div><p> in /e/c/network interface &#039;lan&#039; section and introduce what dabyd64 just posted.</p><p>If you&#039;re lost, please post TL-MR3040&#039;s default /e/c/network, /e/c/wireless.</p><p>Also, if you mess up but still have access to ssh, issue<br /></p><div class="codebox"><pre><code># firstboot</code></pre></div><p> to reset the router to default settings.</p><p>EDIT: option ipaddr in interface &#039;lan&#039; section certainly need to be different from host router subnet, e.g. host router=192.168.1.1/24, TL-MR3040=192.168.2.1/24</p></blockquote></div><br /><p>Hi <strong>orange</strong>,</p><p>I believe i misunderstood what <strong>dabyd64</strong> suggested i do, however with your very clear directions i was able to sort things out and now have it exactly as i wanted.</p><p>Thank you very much for taking time to help me...appreciated <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>...and of-course a big thank you to <strong>dabyd64</strong> for his input as well <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205695">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						26 Jun 2013, 00:50					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;re very welcome. Trying to help people, I myself very much appreciate if someone actually takes the time/care to explain his/her problem the best that he/she can. This IMO deserves care in answering. Glad that we sorted out this particular issue for you. Have fun!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205738">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">des245</div>
					<div class="post-datetime">
						26 Jun 2013, 16:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>orange wrote:</cite><blockquote><p>You&#039;re very welcome. Trying to help people, I myself very much appreciate if someone actually takes the time/care to explain his/her problem the best that he/she can. This IMO deserves care in answering. Glad that we sorted out this particular issue for you. Have fun!</p></blockquote></div><br /><p>Thanks man <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ...I wish there were more people like you, who not only try to help others as best they can, but also sensitive enough to appreciate others efforts too.</p><p>...i endeavour everyday to do just that...the world sure needs more of that.</p><p>Have fun too mate <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205788">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						27 Jun 2013, 01:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>des245 wrote:</cite><blockquote><p>Thanks man <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ...I wish there were more people like you, who not only try to help others as best they can, but also sensitive enough to appreciate others efforts too.</p><p>...i endeavour everyday to do just that...the world sure needs more of that.</p><p>Have fun too mate <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p></blockquote></div><p>Thanks man, much appreciated! I&#039;m with you on that one.</p>											<p class="post-edited">(Last edited by <strong>orange</strong> on 27 Jun 2013, 01:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205804">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">twinclouds</div>
					<div class="post-datetime">
						27 Jun 2013, 08:31					</div>
				</div>
				<div class="post-content content">
					<p>@des245:<br />Sorry I was out of country when you sent me pm.&nbsp; I am glad you are fine now.<br />Recently, I have been playing with Gargoyle.&nbsp; I found it has a very nice user interface.&nbsp; Especially, if you want to set up the networking part, it is much easier to use.&nbsp; I only had problem if I want to install new kernel modules but usually you don&#039;t need to.<br />In particular, if you want to set up a repeater in the same subnet.&nbsp; It seems very hard and I still don&#039;t how to do it in Openwrt.&nbsp; However, for Gargoyle, it is almost trivial.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205844">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						27 Jun 2013, 14:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><p>In particular, if you want to set up a repeater in the same subnet.&nbsp; It seems very hard and I still don&#039;t how to do it in Openwrt.&nbsp; However, for Gargoyle, it is almost trivial.</p></blockquote></div><p>It&#039;s a patch by Gargoyle devs actually, i.e. ARP-NAT. You may configure relayd to get bridged clientmode with OpenWrt. While it isn&#039;t the same from an implementation perspective, it is from a user perspective.</p><p>Read <a href="http://wiki.openwrt.org/doc/howto/clientmode#bridged.client.mode.issues">http://wiki.openwrt.org/doc/howto/clien … ode.issues</a> and <a href="http://wiki.openwrt.org/doc/recipes/relayclient">http://wiki.openwrt.org/doc/recipes/relayclient</a></p><p>EDIT: Patch is at <a href="http://www.gargoyle-router.com/gargoyle/projects/gargoyle/repository/revisions/master/entry/patches-generic/04-arpnat.patch">http://www.gargoyle-router.com/gargoyle … pnat.patch</a></p>											<p class="post-edited">(Last edited by <strong>orange</strong> on 27 Jun 2013, 14:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205896">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">des245</div>
					<div class="post-datetime">
						28 Jun 2013, 00:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><p>@des245:<br />Sorry I was out of country when you sent me pm.&nbsp; I am glad you are fine now.<br />Recently, I have been playing with Gargoyle.&nbsp; I found it has a very nice user interface.&nbsp; Especially, if you want to set up the networking part, it is much easier to use.&nbsp; I only had problem if I want to install new kernel modules but usually you don&#039;t need to.<br />In particular, if you want to set up a repeater in the same subnet.&nbsp; It seems very hard and I still don&#039;t how to do it in Openwrt.&nbsp; However, for Gargoyle, it is almost trivial.</p></blockquote></div><p>Hi <strong>twinclouds </strong>, no probs mate, <strong>orange</strong> was kind enough to put me right <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Gargoyle sound interesting...will have a look at it.</p><p>Thanks for stopping by though.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206353">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">jdonth</div>
					<div class="post-datetime">
						3 Jul 2013, 15:56					</div>
				</div>
				<div class="post-content content">
					<p>des245,</p><p>I am trying to accomplish the exact same thing that you are.</p><p>Would you post or send me your MR3020 modifications that worked for you (/etc/config/network, /etc/config/wireless and any others)?</p><p>Thanks,<br />Joe</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>