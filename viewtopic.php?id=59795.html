<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Traffic Shaping and Multiple SSID</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p292825">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">emanuelebruno</div>
					<div class="post-datetime">
						21 Sep 2015, 16:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br />I&#039;m studying how openwrt (v15.05 release) works, and in particular I&#039;m verifying the operation with an access point tp-link tl-wa701nd (v2.2).<br />the problem that I am finding it is not being able to put into practice the guides I found on the internet.</p><p>my goal is to:<br />-create multiple ssid, the first one &quot;guest&quot; with bandwith restriction; the second one &quot;office&quot; without any bandwith restriction;<br />-the &quot;guest&quot; connection should have a dedicated bandwidth (for example 640 kbps in download and 128 kbps in upload);</p><p>I would like to put into practice the advice I found on this link: <a href="https://hrshadhin.wordpress.com/2014/05/16/multiple-ssid-on-openwrt-with-bandwidth-limit/">https://hrshadhin.wordpress.com/2014/05 … dth-limit/</a></p><p>unfortunately it does not work:<br />-doesn&#039;t exist any &quot;iwconfig&quot; command;<br />-if I digit &quot;iw dev&quot;, i find two interfaces: wlan0 (office) and wlan0-1 (guest)<br />-digiting &quot;/etc/init.d/wshaper start&quot; or &quot;/etc/init.d/wshaper enable&quot; and reboot, wshaper doesn&#039;t work: it does nothing I suppose.</p><p>Is there anybody who can help me?</p><p>PS Following the instructions in this link <a href="http://wiki.openwrt.org/doc/uci/qos">http://wiki.openwrt.org/doc/uci/qos</a> I can enable bandwidth to wireless connection, but *NOT* only in a specific SSID, in my case the &quot;guest&quot; interface&nbsp; (it gives me an error when I set wlan0-1)</p>											<p class="post-edited">(Last edited by <strong>emanuelebruno</strong> on 21 Sep 2015, 16:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292828">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						21 Sep 2015, 16:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi emanuelebruno,</p><div class="quotebox"><cite>emanuelebruno wrote:</cite><blockquote><p>Hi all,<br />I&#039;m studying how openwrt (v15.05 release) works, and in particular I&#039;m verifying the operation with an access point tp-link tl-wa701nd (v2.2).<br />the problem that I am finding it is not being able to put into practice the guides I found on the internet.</p><p>my goal is to:<br />-create multiple ssid, the first one &quot;guest&quot; with bandwith restriction; the second one &quot;office&quot; without any bandwith restriction;<br />-the &quot;guest&quot; connection should have a dedicated bandwidth (for example 640 kbps in download and 128 kbps in upload);</p><p>I would like to put into practice the advice I found on this link: <a href="https://hrshadhin.wordpress.com/2014/05/16/multiple-ssid-on-openwrt-with-bandwidth-limit/">https://hrshadhin.wordpress.com/2014/05 … dth-limit/</a></p><p>unfortunately it does not work:<br />-doesn&#039;t exist any &quot;iwconfig&quot; command;<br />-if I digit &quot;iw dev&quot;, i find two interfaces: wlan0 (office) and wlan0-1 (guest)<br />-digiting &quot;/etc/init.d/wshaper start&quot; or &quot;/etc/init.d/wshaper enable&quot; and reboot, wshaper doesn&#039;t work: it does nothing I suppose.</p><p>Is there anybody who can help me?</p></blockquote></div><p>There seems to be considerable consensus that wonder shaper should be considered a more note worthy relict of an earlier simlper time (see <a href="http://www.bufferbloat.net/projects/cerowrt/wiki/wondershaper_must_die">http://www.bufferbloat.net/projects/cer … r_must_die</a> ) and less a solution for contemporary problems.<br />That said, if your guest SSID has its own (virtual) wifi interface you might be able to use sqm-scripts to configure something close to what you want using that wifi interface AND putting 128 as Download and 640 as Upload bandwidths. Note that Download and upload are always see from the direction of the router; so if the shaper sits on the WAN interface upload and download between your internal network and the router are &quot;aligned&quot;, but if the shaper sits between the router and an internal section the directions need to be configured inverted.<br />This will basically restrict guest traffic to the limits you specified, but will make no guarantees that guests actually will get that much bandwidth, but I assume that basically is close to what you want.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp;M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292829">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">emanuelebruno</div>
					<div class="post-datetime">
						21 Sep 2015, 16:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi moeller0, and thanks for your reply.</p><p>I said that qos-scripts works but it enables traffic shaping to the wireless interface (both SSID): I need to do that only in &quot;guest&quot; interface... I hope to be clear now</p><p>PS I don&#039;t know how to set a guest SSID that has its own (virtual) interface... <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>											<p class="post-edited">(Last edited by <strong>emanuelebruno</strong> on 21 Sep 2015, 16:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292832">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						21 Sep 2015, 16:32					</div>
				</div>
				<div class="post-content content">
					<p>Hi emanuelebruno,</p><div class="quotebox"><cite>emanuelebruno wrote:</cite><blockquote><p>Hi moeller0, and thanks for your reply.</p><p>I said that qos-scripts works but it enables traffic shaping to the wireless interface (both SSID): I need to do that only in &quot;guest&quot; interface... I hope to be clear now</p><p>PS I don&#039;t know how to set a guest SSID that has its own (virtual) interface... <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></blockquote></div><p>Sorry, I did not read this attentively enough. Is the default mode bridged? If yes and the interface you see is br-lan I would assume that you might need to switch to a routed insztead of switched configuration, than there should be a dedicated wifi interface for your guest SSID (if you configure it). See <a href="http://wiki.openwrt.org/doc/recipes/routedap">http://wiki.openwrt.org/doc/recipes/routedap</a> for hints... I would assume that it should be sufficient to route the guest wifi instead of everything, but I have not tried that with 15.05.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292841">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">emanuelebruno</div>
					<div class="post-datetime">
						21 Sep 2015, 17:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi moeller0,<br />perhaps it is something wrong: dhcp works, I can ping from ssh to guest interface (192.168.2.1) and to guest client (192.168.2.101); from the guest client I can ping to Access Point interface (192.168.178.1) but I can&#039;t surf from guest client...</p><p>these are my configuration files:</p><p>/etc/config/network<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd3c:625a:153c::/48&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0&#039;
        option force_link &#039;1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.178.171&#039;
        option netmask &#039;255.255.255.0&#039;
        option gateway &#039;192.168.178.1&#039;
        option dns &#039;192.168.178.1&#039;
        option ip6assign &#039;60&#039;

config interface &#039;guest&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.2.1&#039;
        option netmask &#039;255.255.255.0&#039;</code></pre></div><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
        option type &#039;mac80211&#039;
        option channel &#039;11&#039;
        option hwmode &#039;11g&#039;
        option path &#039;platform/ar933x_wmac&#039;
        option htmode &#039;HT20&#039;
        option distance &#039;3&#039;
        option short_preamble &#039;1&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option network &#039;lan&#039;
        option mode &#039;ap&#039;
        option ssid &#039;Office&#039;
        option encryption &#039;psk2+tkip+aes&#039;
        option key &#039;12345678&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option network &#039;guest&#039;
        option mode &#039;ap&#039;
        option ssid &#039;guest&#039;
        option encryption &#039;none&#039;
        option isolate &#039;1&#039;</code></pre></div><p>/etc/config/dhcp<br /></p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option filterwin2k &#039;0&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option nonegcache &#039;0&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;
        option dhcpv6 &#039;server&#039;
        option ra &#039;server&#039;
        option ignore &#039;1&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;

config odhcpd &#039;odhcpd&#039;
        option maindhcp &#039;0&#039;
        option leasefile &#039;/tmp/hosts/odhcpd&#039;
        option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;

config dhcp &#039;guest&#039;
        option interface &#039;guest&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;</code></pre></div><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config defaults
        option syn_flood        1
        option input            ACCEPT
        option output           ACCEPT
        option forward          REJECT
# Uncomment this line to disable ipv6 rules
#       option disable_ipv6     1

config zone
        option name             lan
        list   network          &#039;lan&#039;
        option input            ACCEPT
        option output           ACCEPT
        option forward          ACCEPT

config zone
        option name             wan
        list   network          &#039;wan&#039;
        list   network          &#039;wan6&#039;
        option input            REJECT
        option output           ACCEPT
        option forward          REJECT
        option masq             1
        option mtu_fix          1

# Config zone -&gt; Guest
config zone
        option name             guest
        list network            &#039;guest&#039;
        option input            &#039;ACCEPT&#039;
        option forward          &#039;REJECT&#039;
        option output           &#039;ACCEPT&#039;

# Allow Guest -&gt; Internet
config forwarding
        option src              guest
        option dest             wan

# Allow Guest -&gt; Lan
config forwarding
        option src              guest
        option dest             lan
# We need to accept udp packets on port 68,
# see [url]https://dev.openwrt.org/ticket/4108[/url]
config rule
        option name             Allow-DHCP-Renew
        option src              wan
        option proto            udp
        option dest_port        68
        option target           ACCEPT
        option family           ipv4

# Allow IPv4 ping
config rule
        option name             Allow-Ping
        option src              wan
        option proto            icmp
        option icmp_type        echo-request
        option family           ipv4
        option target           ACCEPT

config rule
        option name             Allow-IGMP
        option src              wan
        option proto            igmp
        option family           ipv4
        option target           ACCEPT

# Allow DHCPv6 replies
# see [url]https://dev.openwrt.org/ticket/10381[/url]
config rule
        option name             Allow-DHCPv6
        option src              wan
        option proto            udp
        option src_ip           fe80::/10
        option src_port         547
        option dest_ip          fe80::/10
        option dest_port        546
        option family           ipv6
        option target           ACCEPT

config rule
        option name             Allow-MLD
        option src              wan
        option proto            icmp
        option src_ip           fe80::/10
        list icmp_type          &#039;130/0&#039;
        list icmp_type          &#039;131/0&#039;
        list icmp_type          &#039;132/0&#039;
        list icmp_type          &#039;143/0&#039;
        option family           ipv6
        option target           ACCEPT

# Allow essential incoming IPv6 ICMP traffic
config rule
        option name             Allow-ICMPv6-Input
        option src              wan
        option proto    icmp
        list icmp_type          echo-request
        list icmp_type          echo-reply
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big
        list icmp_type          time-exceeded
        list icmp_type          bad-header
        list icmp_type          unknown-header-type
        list icmp_type          router-solicitation
        list icmp_type          neighbour-solicitation
        list icmp_type          router-advertisement
        list icmp_type          neighbour-advertisement
        option limit            1000/sec
        option family           ipv6
        option target           ACCEPT

# Allow essential forwarded IPv6 ICMP traffic
config rule
        option name             Allow-ICMPv6-Forward
        option src              wan
        option dest             *
        option proto            icmp
        list icmp_type          echo-request
        list icmp_type          echo-reply
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big
        list icmp_type          time-exceeded
        list icmp_type          bad-header
        list icmp_type          unknown-header-type
        option limit            1000/sec
        option family           ipv6
        option target           ACCEPT

# include a file with users custom iptables rules
config include
        option path /etc/firewall.user

# allow IPsec/ESP and ISAKMP passthrough
config rule
        option src              wan
        option dest             lan
        option proto            esp
        option target           ACCEPT

config rule
        option src              wan
        option dest             lan
        option dest_port        500
        option proto            udp
        option target           ACCEPT</code></pre></div>											<p class="post-edited">(Last edited by <strong>emanuelebruno</strong> on 21 Sep 2015, 17:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292845">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						21 Sep 2015, 17:52					</div>
				</div>
				<div class="post-content content">
					<p>Hi emanuelebruno,</p><div class="quotebox"><cite>emanuelebruno wrote:</cite><blockquote><p>Hi moeller0,<br />perhaps it is something wrong: dhcp works, I can ping from ssh to guest interface (192.168.2.1) and to guest client (192.168.2.101); from the guest client I can ping to Access Point interface (192.168.178.1) but I can&#039;t surf from guest client...</p><p>these are my configuration files:</p><p>/etc/config/network<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd3c:625a:153c::/48&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0&#039;
        option force_link &#039;1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.178.171&#039;
        option netmask &#039;255.255.255.0&#039;
        option gateway &#039;192.168.178.1&#039;
        option dns &#039;192.168.178.1&#039;
        option ip6assign &#039;60&#039;

config interface &#039;guest&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.2.1&#039;
        option netmask &#039;255.255.255.0&#039;</code></pre></div><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
        option type &#039;mac80211&#039;
        option channel &#039;11&#039;
        option hwmode &#039;11g&#039;
        option path &#039;platform/ar933x_wmac&#039;
        option htmode &#039;HT20&#039;
        option distance &#039;3&#039;
        option short_preamble &#039;1&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option network &#039;lan&#039;
        option mode &#039;ap&#039;
        option ssid &#039;Office&#039;
        option encryption &#039;psk2+tkip+aes&#039;
        option key &#039;12345678&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option network &#039;guest&#039;
        option mode &#039;ap&#039;
        option ssid &#039;guest&#039;
        option encryption &#039;none&#039;
        option isolate &#039;1&#039;</code></pre></div><p>/etc/config/dhcp<br /></p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option filterwin2k &#039;0&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option nonegcache &#039;0&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;
        option dhcpv6 &#039;server&#039;
        option ra &#039;server&#039;
        option ignore &#039;1&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;

config odhcpd &#039;odhcpd&#039;
        option maindhcp &#039;0&#039;
        option leasefile &#039;/tmp/hosts/odhcpd&#039;
        option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;

config dhcp &#039;guest&#039;
        option interface &#039;guest&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;</code></pre></div><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config defaults
        option syn_flood        1
        option input            ACCEPT
        option output           ACCEPT
        option forward          REJECT
# Uncomment this line to disable ipv6 rules
#       option disable_ipv6     1

config zone
        option name             lan
        list   network          &#039;lan&#039;
        option input            ACCEPT
        option output           ACCEPT
        option forward          ACCEPT

config zone
        option name             wan
        list   network          &#039;wan&#039;
        list   network          &#039;wan6&#039;
        option input            REJECT
        option output           ACCEPT
        option forward          REJECT
        option masq             1
        option mtu_fix          1

# Config zone -&gt; Guest
config zone
        option name             guest
        list network            &#039;guest&#039;
        option input            &#039;ACCEPT&#039;
        option forward          &#039;REJECT&#039;
        option output           &#039;ACCEPT&#039;

# Allow Guest -&gt; Internet
config forwarding
        option src              guest
        option dest             wan

# Allow Guest -&gt; Lan
config forwarding
        option src              guest
        option dest             lan
# We need to accept udp packets on port 68,
# see [url]https://dev.openwrt.org/ticket/4108[/url]
config rule
        option name             Allow-DHCP-Renew
        option src              wan
        option proto            udp
        option dest_port        68
        option target           ACCEPT
        option family           ipv4

# Allow IPv4 ping
config rule
        option name             Allow-Ping
        option src              wan
        option proto            icmp
        option icmp_type        echo-request
        option family           ipv4
        option target           ACCEPT

config rule
        option name             Allow-IGMP
        option src              wan
        option proto            igmp
        option family           ipv4
        option target           ACCEPT

# Allow DHCPv6 replies
# see [url]https://dev.openwrt.org/ticket/10381[/url]
config rule
        option name             Allow-DHCPv6
        option src              wan
        option proto            udp
        option src_ip           fe80::/10
        option src_port         547
        option dest_ip          fe80::/10
        option dest_port        546
        option family           ipv6
        option target           ACCEPT

config rule
        option name             Allow-MLD
        option src              wan
        option proto            icmp
        option src_ip           fe80::/10
        list icmp_type          &#039;130/0&#039;
        list icmp_type          &#039;131/0&#039;
        list icmp_type          &#039;132/0&#039;
        list icmp_type          &#039;143/0&#039;
        option family           ipv6
        option target           ACCEPT

# Allow essential incoming IPv6 ICMP traffic
config rule
        option name             Allow-ICMPv6-Input
        option src              wan
        option proto    icmp
        list icmp_type          echo-request
        list icmp_type          echo-reply
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big
        list icmp_type          time-exceeded
        list icmp_type          bad-header
        list icmp_type          unknown-header-type
        list icmp_type          router-solicitation
        list icmp_type          neighbour-solicitation
        list icmp_type          router-advertisement
        list icmp_type          neighbour-advertisement
        option limit            1000/sec
        option family           ipv6
        option target           ACCEPT

# Allow essential forwarded IPv6 ICMP traffic
config rule
        option name             Allow-ICMPv6-Forward
        option src              wan
        option dest             *
        option proto            icmp
        list icmp_type          echo-request
        list icmp_type          echo-reply
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big
        list icmp_type          time-exceeded
        list icmp_type          bad-header
        list icmp_type          unknown-header-type
        option limit            1000/sec
        option family           ipv6
        option target           ACCEPT

# include a file with users custom iptables rules
config include
        option path /etc/firewall.user

# allow IPsec/ESP and ISAKMP passthrough
config rule
        option src              wan
        option dest             lan
        option proto            esp
        option target           ACCEPT

config rule
        option src              wan
        option dest             lan
        option dest_port        500
        option proto            udp
        option target           ACCEPT</code></pre></div></blockquote></div><br /><p>Not Sure but should /etc/config/firewall not also contain:<br />config forwarding<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;guest</p><p>so that data can flow in that direction as well. Also do you have BCP38 enabled (or what is the content of /etc/config/bcp38)? If yes you need to allow the address range in use by the guest wifi.</p><p>And finally you have:<br />config forwarding<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; guest<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan</p><p>Are you really trusting the guests enough to invite them into your LAN?</p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292849">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">emanuelebruno</div>
					<div class="post-datetime">
						21 Sep 2015, 18:18					</div>
				</div>
				<div class="post-content content">
					<p>It is driving me crazy</p><p>it still doesn&#039;t work and this is my last configuration (I reboot every time even I know that I can digit /etc/init.d/firewall restart...)</p><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood    1
    option input        ACCEPT
    option output        ACCEPT
    option forward        REJECT

config zone
    option name        lan
    list   network        &#039;lan&#039;
    option input        ACCEPT
    option output        ACCEPT
    option forward        ACCEPT

config zone
    option name        wan
    list   network        &#039;wan&#039;
    list   network        &#039;wan6&#039;
    option input        REJECT
    option output        ACCEPT
    option forward        REJECT
    option masq        1
    option mtu_fix        1

# Config zone -&gt; Guest
config zone
    option name        guest
    list network        &#039;guest&#039;
    option input        &#039;ACCEPT&#039;
    option forward        &#039;REJECT&#039;
    option output        &#039;ACCEPT&#039;

# Allow Guest -&gt; Internet
config forwarding
    option src         guest
    option dest        wan

# Allow Lan -&gt; Guest
config forwarding
        option src              lan
        option dest             guest

# Allow Wan -&gt; Guest
config forwarding
        option src              wan
        option dest             guest

config rule
    option name        Allow-DHCP-Renew
    option src        wan
    option proto        udp
    option dest_port    68
    option target        ACCEPT
    option family        ipv4

config rule
    option name        Allow-Ping
    option src        wan
    option proto        icmp
    option icmp_type    echo-request
    option family        ipv4
    option target        ACCEPT

config rule
    option name        Allow-IGMP
    option src        wan
    option proto        igmp
    option family        ipv4
    option target        ACCEPT

config rule
    option name        Allow-DHCPv6
    option src        wan
    option proto        udp
    option src_ip        fe80::/10
    option src_port        547
    option dest_ip        fe80::/10
    option dest_port    546
    option family        ipv6
    option target        ACCEPT

config rule
    option name        Allow-MLD
    option src        wan
    option proto        icmp
    option src_ip        fe80::/10
    list icmp_type        &#039;130/0&#039;
    list icmp_type        &#039;131/0&#039;
    list icmp_type        &#039;132/0&#039;
    list icmp_type        &#039;143/0&#039;
    option family        ipv6
    option target        ACCEPT

config rule
    option name        Allow-ICMPv6-Input
    option src        wan
    option proto    icmp
    list icmp_type        echo-request
    list icmp_type        echo-reply
    list icmp_type        destination-unreachable
    list icmp_type        packet-too-big
    list icmp_type        time-exceeded
    list icmp_type        bad-header
    list icmp_type        unknown-header-type
    list icmp_type        router-solicitation
    list icmp_type        neighbour-solicitation
    list icmp_type        router-advertisement
    list icmp_type        neighbour-advertisement
    option limit        1000/sec
    option family        ipv6
    option target        ACCEPT

config rule
    option name        Allow-ICMPv6-Forward
    option src        wan
    option dest        *
    option proto        icmp
    list icmp_type        echo-request
    list icmp_type        echo-reply
    list icmp_type        destination-unreachable
    list icmp_type        packet-too-big
    list icmp_type        time-exceeded
    list icmp_type        bad-header
    list icmp_type        unknown-header-type
    option limit        1000/sec
    option family        ipv6
    option target        ACCEPT

config include
    option path /etc/firewall.user

config rule
    option src        wan
    option dest        lan
    option proto        esp
    option target        ACCEPT

config rule
    option src        wan
    option dest        lan
    option dest_port    500
    option proto        udp
    option target        ACCEPT</code></pre></div><p>do you think that I have some hope that it will work?</p>											<p class="post-edited">(Last edited by <strong>emanuelebruno</strong> on 21 Sep 2015, 19:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292867">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						21 Sep 2015, 20:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi emanuelebruno,</p><div class="quotebox"><cite>emanuelebruno wrote:</cite><blockquote><p>It is driving me crazy</p><p>it still doesn&#039;t work and this is my last configuration (I reboot every time even I know that I can digit /etc/init.d/firewall restart...)</p><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood    1
    option input        ACCEPT
    option output        ACCEPT
    option forward        REJECT

config zone
    option name        lan
    list   network        &#039;lan&#039;
    option input        ACCEPT
    option output        ACCEPT
    option forward        ACCEPT

config zone
    option name        wan
    list   network        &#039;wan&#039;
    list   network        &#039;wan6&#039;
    option input        REJECT
    option output        ACCEPT
    option forward        REJECT
    option masq        1
    option mtu_fix        1

# Config zone -&gt; Guest
config zone
    option name        guest
    list network        &#039;guest&#039;
    option input        &#039;ACCEPT&#039;
    option forward        &#039;REJECT&#039;
    option output        &#039;ACCEPT&#039;

# Allow Guest -&gt; Internet
config forwarding
    option src         guest
    option dest        wan

# Allow Lan -&gt; Guest
config forwarding
        option src              lan
        option dest             guest

# Allow Wan -&gt; Guest
config forwarding
        option src              wan
        option dest             guest

config rule
    option name        Allow-DHCP-Renew
    option src        wan
    option proto        udp
    option dest_port    68
    option target        ACCEPT
    option family        ipv4

config rule
    option name        Allow-Ping
    option src        wan
    option proto        icmp
    option icmp_type    echo-request
    option family        ipv4
    option target        ACCEPT

config rule
    option name        Allow-IGMP
    option src        wan
    option proto        igmp
    option family        ipv4
    option target        ACCEPT

config rule
    option name        Allow-DHCPv6
    option src        wan
    option proto        udp
    option src_ip        fe80::/10
    option src_port        547
    option dest_ip        fe80::/10
    option dest_port    546
    option family        ipv6
    option target        ACCEPT

config rule
    option name        Allow-MLD
    option src        wan
    option proto        icmp
    option src_ip        fe80::/10
    list icmp_type        &#039;130/0&#039;
    list icmp_type        &#039;131/0&#039;
    list icmp_type        &#039;132/0&#039;
    list icmp_type        &#039;143/0&#039;
    option family        ipv6
    option target        ACCEPT

config rule
    option name        Allow-ICMPv6-Input
    option src        wan
    option proto    icmp
    list icmp_type        echo-request
    list icmp_type        echo-reply
    list icmp_type        destination-unreachable
    list icmp_type        packet-too-big
    list icmp_type        time-exceeded
    list icmp_type        bad-header
    list icmp_type        unknown-header-type
    list icmp_type        router-solicitation
    list icmp_type        neighbour-solicitation
    list icmp_type        router-advertisement
    list icmp_type        neighbour-advertisement
    option limit        1000/sec
    option family        ipv6
    option target        ACCEPT

config rule
    option name        Allow-ICMPv6-Forward
    option src        wan
    option dest        *
    option proto        icmp
    list icmp_type        echo-request
    list icmp_type        echo-reply
    list icmp_type        destination-unreachable
    list icmp_type        packet-too-big
    list icmp_type        time-exceeded
    list icmp_type        bad-header
    list icmp_type        unknown-header-type
    option limit        1000/sec
    option family        ipv6
    option target        ACCEPT

config include
    option path /etc/firewall.user

config rule
    option src        wan
    option dest        lan
    option proto        esp
    option target        ACCEPT

config rule
    option src        wan
    option dest        lan
    option dest_port    500
    option proto        udp
    option target        ACCEPT</code></pre></div><p>do you think that I have some hope that it will work?</p></blockquote></div><p>So, I would guess that there is some hope, after all openwrt is a router distribution, so routing is in its DNA so to speak. I do not know exactly why it is not working for you. In the distribution I still use, cerowrt which is based on a BB snapshot I find the following in /etc/config/firewall:</p><p>config zone<br />&nbsp; &nbsp; &nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;guest&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;guest&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option network &#039;guest&#039;</p><p>While you have &quot;option forward &#039;REJECT&#039;&quot; I am not sure whether this difference might be important.</p><p>Oh, could you find a /etc/config/bcp38 on your router? And if yes what are the contents?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292869">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">emanuelebruno</div>
					<div class="post-datetime">
						21 Sep 2015, 21:32					</div>
				</div>
				<div class="post-content content">
					<p>I have no /etc/config/bcp38 in my router... anyway I have tryed even with your code<br /></p><div class="codebox"><pre><code>config zone
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option name &#039;guest&#039;
        option forward &#039;ACCEPT&#039;
        option device &#039;guest&#039;
        option network &#039;guest&#039;</code></pre></div><p>From the guest wifi I have this situation:</p><p>-I can ssh to 192.168.178.171 and 192.168.2.1<br />-From &quot;guest&quot; SSID, from Windows prompt I can&#039;t ping the gateway (adsl) 192.168.178.1 and I can&#039;t ping Google <br /></p><div class="codebox"><pre><code>Microsoft Windows [Versione 10.0.10532]
(c) 2015 Microsoft Corporation. Tutti i diritti sono riservati.

C:\WINDOWS\system32&gt;ping 192.168.2.1

Esecuzione di Ping 192.168.2.1 con 32 byte di dati:
Risposta da 192.168.2.1: byte=32 durata=1ms TTL=64
Risposta da 192.168.2.1: byte=32 durata=1ms TTL=64
Risposta da 192.168.2.1: byte=32 durata=1ms TTL=64
Risposta da 192.168.2.1: byte=32 durata=2ms TTL=64

Statistiche Ping per 192.168.2.1:
    Pacchetti: Trasmessi = 4, Ricevuti = 4,
    Persi = 0 (0% persi),
Tempo approssimativo percorsi andata/ritorno in millisecondi:
    Minimo = 1ms, Massimo =  2ms, Medio =  1ms

C:\WINDOWS\system32&gt;ping 192.168.178.1

Esecuzione di Ping 192.168.178.1 con 32 byte di dati:
Risposta da 192.168.2.1: Porta di destinazione non raggiungibile.
Risposta da 192.168.2.1: Porta di destinazione non raggiungibile.
Risposta da 192.168.2.1: Porta di destinazione non raggiungibile.
Risposta da 192.168.2.1: Porta di destinazione non raggiungibile.

Statistiche Ping per 192.168.178.1:
    Pacchetti: Trasmessi = 4, Ricevuti = 4,
    Persi = 0 (0% persi),

C:\WINDOWS\system32&gt;ping www.google.it

Esecuzione di Ping www.google.it [173.194.113.24] con 32 byte di dati:
Risposta da 192.168.2.1: Porta di destinazione non raggiungibile.
Risposta da 192.168.2.1: Porta di destinazione non raggiungibile.
Risposta da 192.168.2.1: Porta di destinazione non raggiungibile.
Risposta da 192.168.2.1: Porta di destinazione non raggiungibile.

Statistiche Ping per 173.194.113.24:
    Pacchetti: Trasmessi = 4, Ricevuti = 4,
    Persi = 0 (0% persi),</code></pre></div><p>otherwise, if I connect from &quot;office&quot;, I can ping everything:</p><div class="codebox"><pre><code>C:\WINDOWS\system32&gt;ping 192.168.178.171

Esecuzione di Ping 192.168.178.171 con 32 byte di dati:
Risposta da 192.168.178.171: byte=32 durata=1ms TTL=64
Risposta da 192.168.178.171: byte=32 durata=1ms TTL=64
Risposta da 192.168.178.171: byte=32 durata=2ms TTL=64
Risposta da 192.168.178.171: byte=32 durata=1ms TTL=64

Statistiche Ping per 192.168.178.171:
    Pacchetti: Trasmessi = 4, Ricevuti = 4,
    Persi = 0 (0% persi),
Tempo approssimativo percorsi andata/ritorno in millisecondi:
    Minimo = 1ms, Massimo =  2ms, Medio =  1ms

C:\WINDOWS\system32&gt;ping 192.168.178.1

Esecuzione di Ping 192.168.178.1 con 32 byte di dati:
Risposta da 192.168.178.1: byte=32 durata=1ms TTL=64
Risposta da 192.168.178.1: byte=32 durata=1ms TTL=64
Risposta da 192.168.178.1: byte=32 durata=1ms TTL=64
Risposta da 192.168.178.1: byte=32 durata=4ms TTL=64

Statistiche Ping per 192.168.178.1:
    Pacchetti: Trasmessi = 4, Ricevuti = 4,
    Persi = 0 (0% persi),
Tempo approssimativo percorsi andata/ritorno in millisecondi:
    Minimo = 1ms, Massimo =  4ms, Medio =  1ms

C:\WINDOWS\system32&gt;ping www.google.it

Esecuzione di Ping www.google.it [173.194.113.111] con 32 byte di dati:
Risposta da 173.194.113.111: byte=32 durata=55ms TTL=52
Risposta da 173.194.113.111: byte=32 durata=55ms TTL=52
Risposta da 173.194.113.111: byte=32 durata=57ms TTL=52
Risposta da 173.194.113.111: byte=32 durata=58ms TTL=52

Statistiche Ping per 173.194.113.111:
    Pacchetti: Trasmessi = 4, Ricevuti = 4,
    Persi = 0 (0% persi),
Tempo approssimativo percorsi andata/ritorno in millisecondi:
    Minimo = 55ms, Massimo =  58ms, Medio =  56ms</code></pre></div><p>This is the output from the Access Point (ssh interface):<br /></p><div class="codebox"><pre><code>root@Advanced-AP:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.178.1   0.0.0.0         UG    0      0        0 br-lan
192.168.2.0     *               255.255.255.0   U     0      0        0 wlan0-1
192.168.178.0   *               255.255.255.0   U     0      0        0 br-lan</code></pre></div><p>it seems all ok, so what is the problem?</p>											<p class="post-edited">(Last edited by <strong>emanuelebruno</strong> on 21 Sep 2015, 21:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292952">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">emanuelebruno</div>
					<div class="post-datetime">
						22 Sep 2015, 16:06					</div>
				</div>
				<div class="post-content content">
					<p>toc-toc: is there anybody how can help me?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>