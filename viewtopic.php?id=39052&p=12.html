<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 12 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=11.html">11</a></li><li class="pagination-current"><span>12</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=13.html">13</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=14.html">14</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p202345">
				<div class="post-metadata">
					<div class="post-num">Post #276</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 May 2013, 20:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sgelband wrote:</cite><blockquote><p>1) Can I define a pool of OpenVPN tun interfaces to be my Wan connections?</p></blockquote></div><p>Yes</p><div class="quotebox"><cite>sgelband wrote:</cite><blockquote><p>2) What is the fastest time I can set for detecting a fail-over? sub-second? (I am trying not to drop a call)</p></blockquote></div><p>Sub-second is not possible. A practical minimum i would say is about three seconds </p><div class="quotebox"><cite>sgelband wrote:</cite><blockquote><p>3) can I setup a rule to only route my VoIP phones over this link? based on vlan ID? based on source IP?</p></blockquote></div><p>Yes, rules can be based on source and/or destination ip address and/or ports</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202568">
				<div class="post-metadata">
					<div class="post-num">Post #277</div>
					<div class="post-author">vinca</div>
					<div class="post-datetime">
						23 May 2013, 15:26					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>What it the right setup to switch to 3G when wan is down and switch back to wan when wan is up?</p><p>At the beginning: <br/>root@openwrt:~# route -n<br/>Kernel IP routing table<br/>Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br/>10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg<br/>192.168.1.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br/>192.168.30.0&nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.30.1&nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg</p><p>64 bytes from 8.8.8.8: seq=109 ttl=47 time=25.610 ms<br/>64 bytes from 8.8.8.8: seq=110 ttl=47 time=25.819 ms<br/>64 bytes from 8.8.8.8: seq=111 ttl=47 time=25.669 ms<br/>64 bytes from 8.8.8.8: seq=112 ttl=47 time=25.623 ms<br/>64 bytes from 8.8.8.8: seq=113 ttl=47 time=25.315 ms<br/>64 bytes from 8.8.8.8: seq=114 ttl=47 time=25.166 ms</p><br/><p>After ifconfig eth1 down, it switches to 3G:</p><p>64 bytes from 8.8.8.8: seq=150 ttl=44 time=70.635 ms<br/>64 bytes from 8.8.8.8: seq=151 ttl=44 time=70.490 ms<br/>64 bytes from 8.8.8.8: seq=152 ttl=44 time=70.373 ms<br/>64 bytes from 8.8.8.8: seq=153 ttl=44 time=70.270 ms<br/>64 bytes from 8.8.8.8: seq=154 ttl=44 time=70.151 ms<br/>64 bytes from 8.8.8.8: seq=155 ttl=44 time=70.028 ms</p><p>root@openwrt:~# route -n<br/>Kernel IP routing table<br/>Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br/>10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg<br/>192.168.1.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg</p><br/><p>After ifconfig eth1 up strange situation happens:</p><p>root@openwrt:~# route -n<br/>Kernel IP routing table<br/>Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br/>10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg<br/>192.168.1.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br/>192.168.30.0&nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg</p><p>64 bytes from 8.8.8.8: seq=5 ttl=44 time=71.091 ms<br/>64 bytes from 8.8.8.8: seq=6 ttl=44 time=70.959 ms<br/>64 bytes from 8.8.8.8: seq=7 ttl=44 time=70.824 ms<br/>64 bytes from 8.8.8.8: seq=8 ttl=44 time=70.708 ms<br/>64 bytes from 8.8.8.8: seq=9 ttl=44 time=70.582 ms</p><p>My configuration is:</p><p>Firewall default output policy (must be ACCEPT) :</p><p>ACCEPT</p><p>Output of &quot;ip route show&quot; :</p><p>10.64.64.64 dev 3gg proto kernel scope link src 188.196.84.26 <br/>192.168.1.0/24 dev br-lan proto kernel scope link src 192.168.1.1 <br/>192.168.30.0/24 dev eth1 proto static scope link metric 10 <br/>default via 192.168.30.1 dev eth1 proto static metric 10 <br/>default via 10.64.64.64 dev 3gg proto static metric 30 </p><p>Output of &quot;ip rule show&quot; :</p><p>0: from all lookup local <br/>1001: from all fwmark 0x100/0xff00 lookup 1001 <br/>1002: from all fwmark 0x200/0xff00 lookup 1002 <br/>1016: from all fwmark 0x1000/0xff00 lookup 1016 <br/>1017: from all fwmark 0x1100/0xff00 lookup 1017 <br/>1018: from all fwmark 0x1200/0xff00 lookup 1018 <br/>32766: from all lookup main <br/>32767: from all lookup default </p><p>Output of &quot;ip route list table 1001-1027&quot; :</p><p>1001<br/>default via 10.64.64.64 dev 3gg 1002<br/>default via 192.168.30.1 dev eth1 1016<br/>default via 192.168.30.1 dev eth1 metric 1 default via 10.64.64.64 dev 3gg metric 2 1017<br/>default via 192.168.30.1 dev eth1 metric 1 1018<br/>default via 10.64.64.64 dev 3gg metric 1 <br/>Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; :</p><p>Chain PREROUTING (policy ACCEPT 1171 packets, 460K bytes)<br/>pkts bytes target prot opt in out source destination <br/>44134 12M mwan3_pre all -- * * 0.0.0.0/0 0.0.0.0/0 </p><p>Chain INPUT (policy ACCEPT 200 packets, 17294 bytes)<br/>pkts bytes target prot opt in out source destination <br/>13930 1280K mwan3_post all -- * * 0.0.0.0/0 0.0.0.0/0 </p><p>Chain OUTPUT (policy ACCEPT 138 packets, 49994 bytes)<br/>pkts bytes target prot opt in out source destination <br/>9754 2097K mwan3_pre all -- * * 0.0.0.0/0 0.0.0.0/0 </p><p>Chain POSTROUTING (policy ACCEPT 1085 packets, 492K bytes)<br/>pkts bytes target prot opt in out source destination <br/>37863 12M mwan3_post all -- * * 0.0.0.0/0 0.0.0.0/0 </p><p>Chain mwan3_default (1 references)<br/>pkts bytes target prot opt in out source destination <br/>14 1747 MARK all -- * * 0.0.0.0/0 224.0.0.0/3 mark match !0x8000/0x8000 MARK or 0x8000 <br/>0 0 MARK all -- * * 0.0.0.0/0 10.64.64.64 mark match !0x8000/0x8000 MARK or 0x8000 <br/>216 56243 MARK all -- * * 0.0.0.0/0 192.168.1.0/24 mark match !0x8000/0x8000 MARK or 0x8000 <br/>0 0 MARK all -- * * 0.0.0.0/0 192.168.30.0/24 mark match !0x8000/0x8000 MARK or 0x8000 </p><p>Chain mwan3_post (2 references)<br/>pkts bytes target prot opt in out source destination <br/>521 251K MARK all -- * eth1 0.0.0.0/0 0.0.0.0/0 mark match !0x8000/0x8000 MARK xset 0x200/0xff00 <br/>3548 255K MARK all -- * 3gg 0.0.0.0/0 0.0.0.0/0 mark match !0x8000/0x8000 MARK xset 0x100/0xff00 <br/>27503 8669K MARK all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x8000/0x8000 MARK and 0xffff7fff <br/>51793 13M CONNMARK all -- * * 0.0.0.0/0 0.0.0.0/0 CONNMARK save mask 0xff00 </p><p>Chain mwan3_pre (2 references)<br/>pkts bytes target prot opt in out source destination <br/>53888 14M CONNMARK all -- * * 0.0.0.0/0 0.0.0.0/0 CONNMARK restore mask 0xff00 <br/>540 201K MARK all -- eth1 * 0.0.0.0/0 0.0.0.0/0 MARK xset 0x8200/0xff00 <br/>837 72358 MARK all -- 3gg * 0.0.0.0/0 0.0.0.0/0 MARK xset 0x8100/0xff00 <br/>36034 7254K mwan3_default all -- * * 0.0.0.0/0 0.0.0.0/0 mark match !0x8000/0x8000 <br/>7090 520K mwan3_rules all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x0/0xff00 </p><p>Chain mwan3_rules (1 references)<br/>pkts bytes target prot opt in out source destination <br/>91 6317 MARK all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x0/0xff00 MARK xset 0x1000/0xff00 </p><p>Output of &quot;ifconfig&quot; :</p><p>3gg Link encap:Point-to-Point Protocol <br/>inet addr:188.196.84.26 P-t-P:10.64.64.64 Mask:255.255.255.255<br/>UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1<br/>RX packets:845 errors:0 dropped:0 overruns:0 frame:0<br/>TX packets:3558 errors:0 dropped:0 overruns:0 carrier:0<br/>collisions:0 txqueuelen:3 <br/>RX bytes:72510 (70.8 KiB) TX bytes:255119 (249.1 KiB)</p><p>br-lan Link encap:Ethernet HWaddr 00:D0:50:43:BF:C6 <br/>inet addr:192.168.1.1 Bcast:192.168.1.255 Mask:255.255.255.0<br/>inet6 addr: fe80::2d0:50ff:fe43:bfc6/64 Scope:Link<br/>UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br/>RX packets:22550 errors:0 dropped:0 overruns:0 frame:0<br/>TX packets:16874 errors:0 dropped:0 overruns:0 carrier:0<br/>collisions:0 txqueuelen:0 <br/>RX bytes:4937607 (4.7 MiB) TX bytes:7825113 (7.4 MiB)</p><p>eth0 Link encap:Ethernet HWaddr 00:D0:50:43:BF:C6 <br/>UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br/>RX packets:22605 errors:0 dropped:0 overruns:0 frame:0<br/>TX packets:16836 errors:0 dropped:0 overruns:0 carrier:0<br/>collisions:0 txqueuelen:1000 <br/>RX bytes:5623087 (5.3 MiB) TX bytes:7823261 (7.4 MiB)<br/>Base address:0x6000 </p><p>eth1 Link encap:Ethernet HWaddr 00:D0:50:43:BF:C7 <br/>inet addr:192.168.30.103 Bcast:192.168.30.255 Mask:255.255.255.0<br/>inet6 addr: fe80::2d0:50ff:fe43:bfc7/64 Scope:Link<br/>UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br/>RX packets:20259 errors:0 dropped:0 overruns:0 frame:0<br/>TX packets:15199 errors:0 dropped:0 overruns:0 carrier:0<br/>collisions:0 txqueuelen:1000 <br/>RX bytes:7150504 (6.8 MiB) TX bytes:4633305 (4.4 MiB)<br/>Base address:0xe000 </p><p>eth1.242 Link encap:Ethernet HWaddr 00:D0:50:43:BF:C7 <br/>inet6 addr: fe80::2d0:50ff:fe43:bfc7/64 Scope:Link<br/>UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br/>RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br/>TX packets:800 errors:0 dropped:0 overruns:0 carrier:0<br/>collisions:0 txqueuelen:0 <br/>RX bytes:0 (0.0 B) TX bytes:309512 (302.2 KiB)</p><p>lo Link encap:Local Loopback <br/>inet addr:127.0.0.1 Mask:255.0.0.0<br/>inet6 addr: ::1/128 Scope:Host<br/>UP LOOPBACK RUNNING MTU:16436 Metric:1<br/>RX packets:3224 errors:0 dropped:0 overruns:0 frame:0<br/>TX packets:3224 errors:0 dropped:0 overruns:0 carrier:0<br/>collisions:0 txqueuelen:0 <br/>RX bytes:209362 (204.4 KiB) TX bytes:209362 (204.4 KiB)</p><p>Output of &quot;cat /etc/config/mwan3&quot; :</p><p>config rule &#039;wan_g3&#039;<br/>option dest_ip &#039;0.0.0.0/0&#039;<br/>option use_policy &#039;wan_pri_3g_sec&#039;<br/>option proto &#039;all&#039;</p><p>config interface &#039;3g&#039;<br/>option enabled &#039;1&#039;<br/>option reliability &#039;1&#039;<br/>option count &#039;1&#039;<br/>option timeout &#039;2&#039;<br/>option interval &#039;5&#039;<br/>list track_ip &#039;8.8.8.8&#039;<br/>list track_ip &#039;8.8.4.4&#039;<br/>option down &#039;3&#039;<br/>option up &#039;5&#039;</p><p>config interface &#039;wan&#039;<br/>option enabled &#039;1&#039;<br/>option reliability &#039;1&#039;<br/>option count &#039;1&#039;<br/>option timeout &#039;2&#039;<br/>option interval &#039;5&#039;<br/>list track_ip &#039;8.8.8.8&#039;<br/>list track_ip &#039;8.8.4.4&#039;<br/>option down &#039;3&#039;<br/>option up &#039;5&#039;</p><p>config member &#039;wan_m1_w3&#039;<br/>option interface &#039;wan&#039;<br/>option metric &#039;1&#039;<br/>option weight &#039;2&#039;</p><p>config member &#039;wan_m2_w3&#039;<br/>option interface &#039;wan&#039;<br/>option metric &#039;2&#039;<br/>option weight &#039;2&#039;</p><p>config member &#039;3g_m1_w2&#039;<br/>option interface &#039;3g&#039;<br/>option metric &#039;1&#039;<br/>option weight &#039;3&#039;</p><p>config member &#039;3g_m2_w2&#039;<br/>option interface &#039;3g&#039;<br/>option metric &#039;2&#039;<br/>option weight &#039;3&#039;</p><p>config policy &#039;wan_pri_3g_sec&#039;<br/>list use_member &#039;wan_m1_w3&#039;<br/>list use_member &#039;3g_m2_w2&#039;</p><p>config policy &#039;wan_only&#039;<br/>list use_member &#039;wan_m1_w3&#039;</p><p>config policy &#039;3g_only&#039;<br/>list use_member &#039;3g_m1_w2&#039;</p><p>Output of &quot;cat /etc/config/network&quot; :</p><p>config switch &#039;eth0&#039;<br/>option enable &#039;1&#039;</p><p>config switch_vlan &#039;eth0_1&#039;<br/>option device &#039;eth0&#039;<br/>option vlan &#039;1&#039;<br/>option ports &#039;0 1 2 3 4&#039;</p><p>config interface &#039;loopback&#039;<br/>option ifname &#039;lo&#039;<br/>option proto &#039;static&#039;<br/>option ipaddr &#039;127.0.0.1&#039;<br/>option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br/>option ifname &#039;eth0&#039;<br/>option type &#039;bridge&#039;<br/>option proto &#039;static&#039;<br/>option ipaddr &#039;192.168.1.1&#039;<br/>option netmask &#039;255.255.255.0&#039;</p><p>config interface &#039;mng&#039;<br/>option proto &#039;dhcp&#039;<br/>option ifname &#039;eth1.242&#039;</p><p>config interface &#039;wan&#039;<br/>option _orig_ifname &#039;eth1.100&#039;<br/>option _orig_bridge &#039;false&#039;<br/>option ifname &#039;eth1&#039;<br/>option proto &#039;static&#039;<br/>option ipaddr &#039;192.168.30.103&#039;<br/>option netmask &#039;255.255.255.0&#039;<br/>option gateway &#039;192.168.30.1&#039;<br/>option metric &#039;10&#039;</p><p>config route<br/>option interface &#039;mng&#039;<br/>option target &#039;172.28.2.49&#039;<br/>option gateway &#039;192.168.242.1&#039;</p><p>config route<br/>option interface &#039;mng&#039;<br/>option target &#039;172.18.48.19&#039;<br/>option gateway &#039;192.168.242.1&#039;</p><p>config interface &#039;3g&#039;<br/>option ifname &#039;3gg&#039;<br/>option device &#039;/dev/ttyUSB2&#039;<br/>option service &#039;umts&#039;<br/>option proto &#039;3g&#039;<br/>option apn &#039;AGD&#039;<br/>option pincode &#039;1234&#039;<br/>option username &#039;user&#039;<br/>option password &#039;user&#039;<br/>option ctrldev &#039;/dev/ttyUSB1&#039;<br/>option metric &#039;30&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202574">
				<div class="post-metadata">
					<div class="post-num">Post #278</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						23 May 2013, 15:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi vinca,</p><br/><p>The problem you are facing does not look like a mwan3 problem but a general problem. The way you test your failover (ifconfig {up|down}) does not work. Please try it by plugging / unplugging the eth1 interface. You could also use the command &quot;ACTION=ifdown DEVICE=eth1 INTERFACE=wan /sbin/hotplug-call iface&quot; to trigger an interface down.</p><p>The main problem is that there is no default route available for eth1 after &quot;ifconfig eth1 up&quot;. This is why mwan3 dows not work.</p><div class="codebox"><pre><code>After ifconfig eth1 up strange situation happens:

root@openwrt:~# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.64.64.64     0.0.0.0         255.255.255.255 UH    0      0        0 3gg
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.30.0    0.0.0.0         255.255.255.0   U     0      0        0 eth1
0.0.0.0         10.64.64.64     0.0.0.0         UG    30     0        0 3gg</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202634">
				<div class="post-metadata">
					<div class="post-num">Post #279</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						24 May 2013, 11:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>khanh3t wrote:</cite><blockquote><p>ps: i cant remove ip server ping in interface</p></blockquote></div><p>There&#039;s some buggy behavior in LuCI pages which effects dynamic lists. I confirmed it on the DHCP and DNS page. If you want to confirm it just run a similar test on that page in the domain whitelist dynamic lists.</p><p>In the dynamic list boxes if you have say 4 IPs set for pinging (8.8.8.8, 8.8.4.4, 1.1.1.1, 2.2.2.2 for example) and then you edit the interface and remove all the boxes but one and change the last entry when you click save and apply it will put back all of the entries you deleted and add your new entry as a 5th option (in my case it added 192.168.51.1 when I removed all those IPs and replaced the last one with that and tried to Save &amp; Apply)</p><p>Workaround:<br/>Delete all the dynamic list boxes and completely blank out the last one and Save &amp; Apply then go back and configure them again</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 25 May 2013, 00:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202700">
				<div class="post-metadata">
					<div class="post-num">Post #280</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						25 May 2013, 04:20					</div>
				</div>
				<div class="post-content content">
					<p>btw. does somebody have the current ipks for the ath7xxx (TP-Link TLWR1043ND)? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><br/><p>Cheers Thomy</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202709">
				<div class="post-metadata">
					<div class="post-num">Post #281</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						25 May 2013, 05:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>does somebody have the current ipks for the ath7xxx (TP-Link TLWR1043ND)?</p></blockquote></div><p><a href="http://www.mediafire.com/folder/fvd0r4i8n4ikg/mwan3">http://www.mediafire.com/folder/fvd0r4i8n4ikg/mwan3</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202768">
				<div class="post-metadata">
					<div class="post-num">Post #282</div>
					<div class="post-author">grisha</div>
					<div class="post-datetime">
						25 May 2013, 18:51					</div>
				</div>
				<div class="post-content content">
					<p>Hi-<br/>How and where to add entries to WAN1 was only for 192.168.0.243 ?<br/>thx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202794">
				<div class="post-metadata">
					<div class="post-num">Post #283</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						26 May 2013, 02:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>grisha wrote:</cite><blockquote><p>Hi-<br/>How and where to add entries to WAN1 was only for 192.168.0.243 ?<br/>thx</p></blockquote></div><p>You should read the first post in this thread.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202795">
				<div class="post-metadata">
					<div class="post-num">Post #284</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						26 May 2013, 02:28					</div>
				</div>
				<div class="post-content content">
					<p>There were several reports on load balancing issues recently, have they been fixed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202801">
				<div class="post-metadata">
					<div class="post-num">Post #285</div>
					<div class="post-author">chrisrenz</div>
					<div class="post-datetime">
						26 May 2013, 09:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>does somebody have the current ipks for the ath7xxx (TP-Link TLWR1043ND)?</p></blockquote></div><p><a href="http://www.mediafire.com/folder/fvd0r4i8n4ikg/mwan3">http://www.mediafire.com/folder/fvd0r4i8n4ikg/mwan3</a></p></blockquote></div><p>great&nbsp; thanks arfett</p><p>i&#039;ve been waitting for someone compiling the new packages for long!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202820">
				<div class="post-metadata">
					<div class="post-num">Post #286</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						26 May 2013, 14:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>There were several reports on load balancing issues recently, have they been fixed?</p></blockquote></div><p>The issues that i heard of are still&nbsp; unresolved. It is not clear what the source of the issue is or that it even is a mwan3 problem. Are you seeing issues with the latest version?</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 26 May 2013, 14:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202866">
				<div class="post-metadata">
					<div class="post-num">Post #287</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						27 May 2013, 04:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>There were several reports on load balancing issues recently, have they been fixed?</p></blockquote></div><p>The issues that i heard of are still&nbsp; unresolved. It is not clear what the source of the issue is or that it even is a mwan3 problem. Are you seeing issues with the latest version?</p></blockquote></div><p>I don&#039;t use load balancing - was just wondering.. and considering &#039;my possibilities&#039;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202867">
				<div class="post-metadata">
					<div class="post-num">Post #288</div>
					<div class="post-author">brick2008</div>
					<div class="post-datetime">
						27 May 2013, 04:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi,Adze,<br/>I am using OpenWrt Barrier Breaker r36641 / LuCI Trunk (svn-r9814) ,mwan3 is not that stable,<br/>I can post&nbsp; the troubleshooting if you need ,and which version of openwrt works well? 12.09 final?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202883">
				<div class="post-metadata">
					<div class="post-num">Post #289</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 May 2013, 09:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>brick2008 wrote:</cite><blockquote><p>I am using OpenWrt Barrier Breaker r36641 / LuCI Trunk (svn-r9814) ,mwan3 is not that stable,<br/>I can post&nbsp; the troubleshooting if you need ,and which version of openwrt works well? 12.09 final?</p></blockquote></div><p>I had instability issues also. The router became unreachable from any interface over time. It was actually the firewall3 deamon that caused this. I now run r36713 and haven&#039;t seen that instability issue since.</p><p>Maybe you could try r36713 and the latest mwan3?</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 27 May 2013, 09:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202889">
				<div class="post-metadata">
					<div class="post-num">Post #290</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						27 May 2013, 10:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>brick2008 wrote:</cite><blockquote><p>I am using OpenWrt Barrier Breaker r36641 / LuCI Trunk (svn-r9814) ,mwan3 is not that stable,<br/>I can post&nbsp; the troubleshooting if you need ,and which version of openwrt works well? 12.09 final?</p></blockquote></div><p>I had instability issues also. The router became unreachable from any interface over time.</p></blockquote></div><p>I confirm that. The same happened once and I had to reboot (manually) the router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202891">
				<div class="post-metadata">
					<div class="post-num">Post #291</div>
					<div class="post-author">brick2008</div>
					<div class="post-datetime">
						27 May 2013, 10:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>brick2008 wrote:</cite><blockquote><p>I am using OpenWrt Barrier Breaker r36641 / LuCI Trunk (svn-r9814) ,mwan3 is not that stable,<br/>I can post&nbsp; the troubleshooting if you need ,and which version of openwrt works well? 12.09 final?</p></blockquote></div><p>I had instability issues also. The router became unreachable from any interface over time. It was actually the firewall3 deamon that caused this. I now run r36713 and haven&#039;t seen that instability issue since.</p><p>Maybe you could try r36713 and the latest mwan3?</p></blockquote></div><p>Where to download the latest mwan3?&nbsp; 213.136.13.52 is down.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202892">
				<div class="post-metadata">
					<div class="post-num">Post #292</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 May 2013, 10:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>brick2008 wrote:</cite><blockquote><p>Where to download the latest mwan3?&nbsp; 213.136.13.52 is down.</p></blockquote></div><p>See start post:</p><div class="codebox"><pre><code>edit4: GitHub repo is up: https://github.com/Adze1502/mwan . svn repo is down. Please update your &quot;feeds.conf.default&quot; file with the line &quot;src-git mwan git://github.com/Adze1502/mwan.git&quot; and remove the old svn repo.</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202893">
				<div class="post-metadata">
					<div class="post-num">Post #293</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						27 May 2013, 10:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>brick2008 wrote:</cite><blockquote><p>Where to download the latest mwan3?&nbsp; 213.136.13.52 is down.</p></blockquote></div><p>here:</p><div class="quotebox"><cite>arfett wrote:</cite><blockquote><p><a href="http://www.mediafire.com/folder/fvd0r4i8n4ikg/mwan3">http://www.mediafire.com/folder/fvd0r4i8n4ikg/mwan3</a></p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202902">
				<div class="post-metadata">
					<div class="post-num">Post #294</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						27 May 2013, 12:50					</div>
				</div>
				<div class="post-content content">
					<p>Thanks arfett for compiling and uploading the latest build <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202935">
				<div class="post-metadata">
					<div class="post-num">Post #295</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						27 May 2013, 17:33					</div>
				</div>
				<div class="post-content content">
					<p>I have a problem with the newest version. Switching to 3G works fine but when it switched to 3G i am not able to lookup an IP adress (even if i ssh to my router and do nslookup &quot;<a href="http://www.google.de/">www.google.de</a>&quot; i get &quot;connection refused&quot;).</p><p>Here is the output of the troubleshooting page:<br/></p><div class="codebox"><pre><code>MWAN3 package versions : 

mwan3 - 1.2-5
luci-app-mwan3 - 1.0-3

Firewall default output policy (must be ACCEPT) : 

ACCEPT

Output of &quot;ip route show&quot; : 

default via 10.64.64.64 dev 3g-wwan  proto static 
10.64.64.64 dev 3g-wwan  proto kernel  scope link  src 10.33.7.153 
188.99.176.1 dev pppoe-wan  proto kernel  scope link  src 188.99.188.141 
192.168.2.0/24 dev br-lan  proto kernel  scope link  src 192.168.2.1 

Output of &quot;ip rule show&quot; : 

0:    from all lookup local 
1001:    from all fwmark 0x100/0xff00 lookup 1001 
1002:    from all fwmark 0x200/0xff00 lookup 1002 
1016:    from all fwmark 0x1000/0xff00 lookup 1016 
32766:    from all lookup main 
32767:    from all lookup default 

Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) : 

1001
default via 188.99.176.1 dev pppoe-wan 
1002
default via 10.64.64.64 dev 3g-wwan 
1016
default via 188.99.176.1 dev pppoe-wan  metric 1 
default via 10.64.64.64 dev 3g-wwan  metric 2 

Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; : 

Chain PREROUTING (policy ACCEPT 4215 packets, 1263K bytes)
 pkts bytes target     prot opt in     out     source               destination         
10865 3991K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INPUT (policy ACCEPT 1961 packets, 180K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 3856  359K mwan3_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 2049 packets, 803K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 3834 1229K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain POSTROUTING (policy ACCEPT 4297 packets, 1885K bytes)
 pkts bytes target     prot opt in     out     source               destination         
10734 4845K mwan3_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain mwan3_default (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   13   839 MARK       all  --  *      *       0.0.0.0/0            224.0.0.0/3         mark match !0x8000/0x8000 MARK or 0x8000 
    0     0 MARK       all  --  *      *       0.0.0.0/0            127.0.0.0/8         mark match !0x8000/0x8000 MARK or 0x8000 
    0     0 MARK       all  --  *      *       0.0.0.0/0            10.64.64.64         mark match !0x8000/0x8000 MARK or 0x8000 
    0     0 MARK       all  --  *      *       0.0.0.0/0            188.99.176.1        mark match !0x8000/0x8000 MARK or 0x8000 
 2583  863K MARK       all  --  *      *       0.0.0.0/0            192.168.2.0/24      mark match !0x8000/0x8000 MARK or 0x8000 

Chain mwan3_post (2 references)
 pkts bytes target     prot opt in     out     source               destination         
  316 26544 MARK       all  --  *      3g-wwan  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x200/0xff00 
 2071  260K MARK       all  --  *      pppoe-wan  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x100/0xff00 
10533 4711K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x8000/0x8000 MARK and 0xffff7fff 
14590 5204K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff00 

Chain mwan3_pre (2 references)
 pkts bytes target     prot opt in     out     source               destination         
14699 5221K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff00 
  317 26628 MARK       all  --  3g-wwan *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8200/0xff00 
 2562 1408K MARK       all  --  pppoe-wan *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8100/0xff00 
 9653 1912K mwan3_default  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 
 1365  104K mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  757 61077 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x1000/0xff00 

Output of &quot;ifconfig&quot; : 

3g-wwan   Link encap:Point-to-Point Protocol  
          inet addr:10.33.7.153  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:326 errors:0 dropped:0 overruns:0 frame:0
          TX packets:326 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:26808 (26.1 KiB)  TX bytes:26844 (26.2 KiB)

br-lan    Link encap:Ethernet  HWaddr B0:48:7A:EB:70:0A  
          inet addr:192.168.2.1  Bcast:192.168.2.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:5909 errors:0 dropped:127 overruns:0 frame:0
          TX packets:6643 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:723004 (706.0 KiB)  TX bytes:4442372 (4.2 MiB)

eth0      Link encap:Ethernet  HWaddr B0:48:7A:EB:70:0A  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4668 errors:0 dropped:0 overruns:60145 frame:0
          TX packets:4766 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:2378947 (2.2 MiB)  TX bytes:569030 (555.6 KiB)
          Interrupt:4 

eth0.1    Link encap:Ethernet  HWaddr B0:48:7A:EB:70:0A  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:750 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:108307 (105.7 KiB)

eth0.2    Link encap:Ethernet  HWaddr B0:48:7A:EB:70:0A  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:3570 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3079 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1475446 (1.4 MiB)  TX bytes:336153 (328.2 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:42 errors:0 dropped:0 overruns:0 frame:0
          TX packets:42 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:3426 (3.3 KiB)  TX bytes:3426 (3.3 KiB)

pppoe-wan Link encap:Point-to-Point Protocol  
          inet addr:188.99.188.141  P-t-P:188.99.176.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:2567 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2076 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:1408702 (1.3 MiB)  TX bytes:260329 (254.2 KiB)

wlan0     Link encap:Ethernet  HWaddr B0:48:7A:EB:70:0A  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:6094 errors:0 dropped:0 overruns:0 frame:0
          TX packets:7581 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32 
          RX bytes:891806 (870.9 KiB)  TX bytes:4786701 (4.5 MiB)

Output of &quot;cat /etc/config/mwan3&quot; : 

config rule &#039;default&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_pri_wwan_sec&#039;
    option dest_ip &#039;0.0.0.0/0&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;3&#039;
    list track_ip &#039;173.194.69.94&#039;
    list track_ip &#039;8.8.8.8&#039;

config interface &#039;wwan&#039;
    option enabled &#039;1&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;3&#039;
    list track_ip &#039;173.194.69.94&#039;
    list track_ip &#039;8.8.8.8&#039;

config member &#039;wwan_m1_w1&#039;
    option interface &#039;wwan&#039;
    option metric &#039;1&#039;
    option weight &#039;1&#039;

config member &#039;wwan_m2_w1&#039;
    option interface &#039;wwan&#039;
    option metric &#039;2&#039;
    option weight &#039;1&#039;

config policy &#039;wan_pri_wwan_sec&#039;
    list use_member &#039;wan_m1_w1&#039;
    list use_member &#039;wwan_m2_w1&#039;

config member &#039;wan_m2_w1&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;1&#039;

config member &#039;wan_m1_w1&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;1&#039;

Output of &quot;cat /etc/config/network&quot; : 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0.1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.2.1&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option _orig_ifname &#039;eth0.2&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;pppoe&#039;
    option username &#039;1und1/pt1228-985@online.de&#039;
    option password &#039;******&#039;

config switch
    option name &#039;rtl8366rb&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;rtl8366rb&#039;
    option vlan &#039;1&#039;
    option ports &#039;1 2 3 4 5t&#039;

config switch_vlan
    option device &#039;rtl8366rb&#039;
    option vlan &#039;2&#039;
    option ports &#039;0 5t&#039;

config interface &#039;wwan&#039;
    option proto &#039;3g&#039;
    option device &#039;/dev/ttyUSB0&#039;
    option service &#039;umts&#039;
    option apn &#039;internet&#039;
    option username &#039;root&#039;
    option password &#039;*******&#039;</code></pre></div><p>When i reconnect my main ADSL line it works again. How can i fix this problem? </p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/resolv.conf
search homezone.de
nameserver 127.0.0.1

cat /tmp/resolv.conf
search homezone.de
nameserver 127.0.0.1</code></pre></div>											<p class="post-edited">(Last edited by <strong>Thomymaster</strong> on 27 May 2013, 17:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202936">
				<div class="post-metadata">
					<div class="post-num">Post #296</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						27 May 2013, 17:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>I have a problem with the newest version. Switching to 3G works fine but when it switched to 3G i am not able to lookup an IP adress (even if i ssh to my router and do nslookup &quot;<a href="http://www.google.de/">www.google.de</a>&quot; i get &quot;connection refused&quot;).</p></blockquote></div><p>You have no metrics configured on your interfaces.</p><p>edit:<br/>1.0-6 has been put on mediafire if you want to try it. The interface pages will warn you about duplicate and missing metrics and even highlights the offending parties in red for you.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 27 May 2013, 20:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202966">
				<div class="post-metadata">
					<div class="post-num">Post #297</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 May 2013, 20:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>I have a problem with the newest version. Switching to 3G works fine but when it switched to 3G i am not able to lookup an IP adress (even if i ssh to my router and do nslookup &quot;<a href="http://www.google.de/">www.google.de</a>&quot; i get &quot;connection refused&quot;).</p></blockquote></div><p>You have no metrics configured on your interfaces. Version 1.0-6 and later of the GUI page will warn you about duplicate and missing metrics.</p></blockquote></div><p>What arfett says + You don&#039;t use the loopback route trick (but you do run a caching nameserver on your router) which causes the traffic originating from the router never to failover.</p><p>So in summary:</p><p>- Configure metrics for your interfaces in your network config<br/>- Use the loopback route trick to also load-balance router originating traffic. </p><p>More info about this in the first post.</p><p>On a side note, you must use a dns server that allows lookups from any source ip. Most isp&#039;s block lookups on their dns servers if the source ip address is not from their AS.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 27 May 2013, 20:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202994">
				<div class="post-metadata">
					<div class="post-num">Post #298</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						28 May 2013, 01:31					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>-Where is the download link for the new luci-mwan3 package?</p><p>-To use the loopback trick, i have to issue</p><p>ip route add default via 127.0.0.1 dev lo src 192.168.0.1</p><p>??<br/>Where do i have to put the command so that it survives a reboot?</p><br/><p>-Regarding metrics, i have set it up in the mwan3 config or what exactly do you mean?</p><p>Cheers</p><p>Thomy</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203017">
				<div class="post-metadata">
					<div class="post-num">Post #299</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 May 2013, 11:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>To use the loopback trick, i have to issue &quot;ip route add default via 127.0.0.1 dev lo src 192.168.0.1&quot; ??</p></blockquote></div><p>Almost.. replace 192.168.0.1 with the ip adres of your routers lan interface.</p><div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>Where do i have to put the command so that it survives a reboot?</p></blockquote></div><p>/etc/rc.local</p><div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>Regarding metrics, i have set it up in the mwan3 config or what exactly do you mean?</p></blockquote></div><p>You have to set them in your network config! Please read the first post as it is clearly described...</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 28 May 2013, 11:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203026">
				<div class="post-metadata">
					<div class="post-num">Post #300</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						28 May 2013, 13:54					</div>
				</div>
				<div class="post-content content">
					<p>Yes i did that and now its working, thanks a lot <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>I only need the latest binary for the luci-app from arfett now</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 12 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=11.html">11</a></li><li class="pagination-current"><span>12</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=13.html">13</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=14.html">14</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>