<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Optimized version of mmc.c</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 5 Jun 2014 and 7 Mar 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 7 of 7</div><nav><ul><li><a href="viewtopic.php%3Fid=9653&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=9653&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=9653&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p86895">
				<div class="post-metadata">
					<div class="post-num">Post #151</div>
					<div class="post-author">slthomason</div>
					<div class="post-datetime">
						29 Apr 2009, 08:35					</div>
				</div>
				<div class="post-content content">
					<p>Hi there,</p><p>I am getting the exact same error off the exact same build and router.&nbsp; I have a WRT54GL v1.1 and installed kamikaze 8.09 kernel 2.4.35.4.&nbsp; I ran the following:</p><p>-cd /lib/modules/2.4.35.4/<br/>-wget <a href="http://programmingstuff.free.fr/files/openwrt/whiterussian/mmc/1_3_4/gpio2/mmc.o">http://programmingstuff.free.fr/files/openwrt/whiterussian/mmc/1_3_4/gpio2/mmc.o</a><br/>-opkg update<br/>-opkg install kmod-fs-ext2</p><p>I then did an ls to see what I was looking at and these are what are installed:</p><p>root@OpenWrt:/lib/modules/2.4.35.4# ls<br/>diag.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipt_REJECT.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ppp_generic.o<br/>ext2.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipt_TCPMSS.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pppoe.o<br/>ip_conntrack.o&nbsp; &nbsp; &nbsp; &nbsp;ipt_limit.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pppox.o<br/>ip_conntrack_ftp.o&nbsp; &nbsp;ipt_mac.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slhc.o<br/>ip_conntrack_irc.o&nbsp; &nbsp;ipt_multiport.o&nbsp; &nbsp; &nbsp; switch-adm.o<br/>ip_conntrack_tftp.o&nbsp; ipt_state.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch-core.o<br/>ip_nat_ftp.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iptable_filter.o&nbsp; &nbsp; &nbsp;switch-robo.o<br/>ip_nat_irc.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iptable_mangle.o&nbsp; &nbsp; &nbsp;wl.o<br/>ip_tables.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iptable_nat.o&nbsp; &nbsp; &nbsp; &nbsp; wlcompat.o<br/>ipt_LOG.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mmc.o<br/>ipt_MASQUERADE.o&nbsp; &nbsp; &nbsp;ppp_async.o</p><p>I then ran:<br/>-mkdir /mmc<br/>-echo &quot;0x9c&quot; &gt; /proc/diag/gpiomask<br/>-insmod mmc</p><p>I checked and then there wasn&#039;t an mmc in /dev, so I ran dmesg and got the following:</p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43656 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43323 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[ERROR] mmc_init: got an error calling mmc_card_init: 01<br/>[ERROR] mmc_check_media: change detected but was not able to initialize new card: ffffffff</p><p>Any ideas what can be causing this?</p><p>Thanks in advance!</p><p>Spencer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p86899">
				<div class="post-metadata">
					<div class="post-num">Post #152</div>
					<div class="post-author">opensys</div>
					<div class="post-datetime">
						29 Apr 2009, 10:27					</div>
				</div>
				<div class="post-content content">
					<p>To me is CPU cycles problem, but this driver must be converted to 2.6 kernel.<br/>Now i solved this buying a router with usb ports.</p><div class="quotebox"><cite>slthomason wrote:</cite><blockquote><p>Hi there,</p><p>I am getting the exact same error off the exact same build and router.&nbsp; I have a WRT54GL v1.1 and installed kamikaze 8.09 kernel 2.4.35.4.&nbsp; I ran the following:</p><p>-cd /lib/modules/2.4.35.4/<br/>-wget <a href="http://programmingstuff.free.fr/files/openwrt/whiterussian/mmc/1_3_4/gpio2/mmc.o">http://programmingstuff.free.fr/files/openwrt/whiterussian/mmc/1_3_4/gpio2/mmc.o</a><br/>-opkg update<br/>-opkg install kmod-fs-ext2</p><p>I then did an ls to see what I was looking at and these are what are installed:</p><p>root@OpenWrt:/lib/modules/2.4.35.4# ls<br/>diag.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipt_REJECT.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ppp_generic.o<br/>ext2.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipt_TCPMSS.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pppoe.o<br/>ip_conntrack.o&nbsp; &nbsp; &nbsp; &nbsp;ipt_limit.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pppox.o<br/>ip_conntrack_ftp.o&nbsp; &nbsp;ipt_mac.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slhc.o<br/>ip_conntrack_irc.o&nbsp; &nbsp;ipt_multiport.o&nbsp; &nbsp; &nbsp; switch-adm.o<br/>ip_conntrack_tftp.o&nbsp; ipt_state.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch-core.o<br/>ip_nat_ftp.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iptable_filter.o&nbsp; &nbsp; &nbsp;switch-robo.o<br/>ip_nat_irc.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iptable_mangle.o&nbsp; &nbsp; &nbsp;wl.o<br/>ip_tables.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iptable_nat.o&nbsp; &nbsp; &nbsp; &nbsp; wlcompat.o<br/>ipt_LOG.o&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mmc.o<br/>ipt_MASQUERADE.o&nbsp; &nbsp; &nbsp;ppp_async.o</p><p>I then ran:<br/>-mkdir /mmc<br/>-echo &quot;0x9c&quot; &gt; /proc/diag/gpiomask<br/>-insmod mmc</p><p>I checked and then there wasn&#039;t an mmc in /dev, so I ran dmesg and got the following:</p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43656 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43323 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[ERROR] mmc_init: got an error calling mmc_card_init: 01<br/>[ERROR] mmc_check_media: change detected but was not able to initialize new card: ffffffff</p><p>Any ideas what can be causing this?</p><p>Thanks in advance!</p><p>Spencer</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p86942">
				<div class="post-metadata">
					<div class="post-num">Post #153</div>
					<div class="post-author">slthomason</div>
					<div class="post-datetime">
						29 Apr 2009, 19:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>opensys wrote:</cite><blockquote><p>To me is CPU cycles problem, but this driver must be converted to 2.6 kernel.</p></blockquote></div><p>Any idea where to go with a &quot;CPU cycles problem?&quot;&nbsp; Also, why would it need to be convered to 2.6 kernel.&nbsp; I am using the 2.4 kernel .....</p><div class="quotebox"><cite>opensys wrote:</cite><blockquote><p>Now i solved this buying a router with usb ports.</p></blockquote></div><p>For what I am trying to achieve, I need to use the WRT54GL, and there are lots of people who have gotten SD cards mounted with a WRT54GL .... so I should be able to pull it off.</p><p>Any hints in what direction to try would be greatly appreciated.</p><p>Spencer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p86972">
				<div class="post-metadata">
					<div class="post-num">Post #154</div>
					<div class="post-author">opensys</div>
					<div class="post-datetime">
						29 Apr 2009, 22:58					</div>
				</div>
				<div class="post-content content">
					<p>The messages seams that he can not make the correct sync with the card, the cpu speed maybe its the problem.</p><p>I have 3 wrt54gl and one wrt54g all with mmc card hacks, white Russian works good, kamikaze 8.09 not.<br/>Change from the 2.4 to 2.6 is the future, but yes 2.6 kernel need more space then 2.4.<br/>This driver works very good, and have good rw speed.<br/>the openwrt is working on a mmc driver, only fonera work fine, all other not work, or work very bad.<br/>ex: broadcom 2.6, detect ok, mount ok, but when RW in the card he freeze the router, he get a kernel panic by low memory.</p><div class="quotebox"><cite>slthomason wrote:</cite><blockquote><div class="quotebox"><cite>opensys wrote:</cite><blockquote><p>To me is CPU cycles problem, but this driver must be converted to 2.6 kernel.</p></blockquote></div><p>Any idea where to go with a &quot;CPU cycles problem?&quot;&nbsp; Also, why would it need to be convered to 2.6 kernel.&nbsp; I am using the 2.4 kernel .....</p><div class="quotebox"><cite>opensys wrote:</cite><blockquote><p>Now i solved this buying a router with usb ports.</p></blockquote></div><p>For what I am trying to achieve, I need to use the WRT54GL, and there are lots of people who have gotten SD cards mounted with a WRT54GL .... so I should be able to pull it off.</p><p>Any hints in what direction to try would be greatly appreciated.</p><p>Spencer</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87019">
				<div class="post-metadata">
					<div class="post-num">Post #155</div>
					<div class="post-author">slthomason</div>
					<div class="post-datetime">
						30 Apr 2009, 17:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>opensys wrote:</cite><blockquote><p>I have 3 wrt54gl and one wrt54g all with mmc card hacks, white Russian works good, kamikaze 8.09 not.<br/>Change from the 2.4 to 2.6 is the future, but yes 2.6 kernel need more space then 2.4.<br/>This driver works very good, and have good rw speed.<br/>the openwrt is working on a mmc driver, only fonera work fine, all other not work, or work very bad.<br/>ex: broadcom 2.6, detect ok, mount ok, but when RW in the card he freeze the router, he get a kernel panic by low memory.</p></blockquote></div><p>So your recommendation is to go back to White Russian to get this to work?&nbsp; Are you seeing this with all cards?&nbsp; Or just some?&nbsp; I am currently trying this with a Kingston 2GB MicroSD.&nbsp; I soldered to the SD adapter .... could something in that be the problem?&nbsp; I am going to try and go get a different card today to try ...</p><p>Spencer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87035">
				<div class="post-metadata">
					<div class="post-num">Post #156</div>
					<div class="post-author">slthomason</div>
					<div class="post-datetime">
						30 Apr 2009, 21:20					</div>
				</div>
				<div class="post-content content">
					<p>Okay - so I ran out to Walmart and got a new MicroSD card.&nbsp; This is a Sandisk 2GB.&nbsp; Plugged it in, recycled the router (to clear out the other stuff since I don&#039;t have the driver being loaded at startup), and loaded the &quot;optimized version of mmc.o (beginning of this post, used version 1.3.4, GPIO2) into temp, and ran &quot;insmod mmc.o&quot;.&nbsp; This is the &quot;dmesg | grep mmc&quot; after:</p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43646 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[INFO] mmc_card_init: doing initialization loop<br/>[INFO] mmc_card_init: card inited successfully in 460 tries (14190890 CPU cycles).<br/>[INFO] mmc_init: MMC/SD Card ID:<br/>[INFO] mmc_card_config: size = 1931264, hardsectsize = 1024, sectors = 1931264<br/>[WARN] mmc_init: hd_sizes=1931264, hd[0].nr_sects=3862528<br/>[INFO] mmc_card_init: set_blocklen (CMD16) succeeded !<br/> mmca: p1</p><p>I checked /dev and it can see the card.</p><p>So I went back into the WebUI and enabled the WebUI, set MMC device to enable, set GPIO pins select to Manual --&gt; DI: 2&nbsp; D0: 4&nbsp; CLK: 3&nbsp; CS:&nbsp; 7 and setting JFFS2 Support to enabled, Clean JFFS2 to disabled.&nbsp; I rebooted the router, and it rebooted a few times, with the both LEDs / flashing.&nbsp; It settled in after a little bit (5-10 minutes) with the Orange LED set, and then showing the Total / Free Size as 2,816.00 KB / 0 --&gt; which we all know means it isn&#039;t working (especially since it is only a 2 GB card).&nbsp; After rebooting the, dmesg | grep mmc showed:</p><p>root@DD-WRT:~# dmesg |grep mmc<br/>mmc: starting module with: SD_DI=0x4, SD_DO=0x10, SD_CLK=0x8, SD_CS=0x80<br/>mmc: this board has no MMC mod installed!<br/>mmc: error in mmc_init (-1)</p><p>Which seems really odd to me what pins it is showing.&nbsp; Is it just me ... Or are these not what I set in the UI (UI still shows the DI: 2&nbsp; D0: 4&nbsp; CLK: 3&nbsp; CS:&nbsp; 7)?</p><p>So I set the MMC Device to disabled, but left the JFFS2 to enabled and rebooted the router.&nbsp; After it came back up I did the following:</p><p>-SCP&#039;d into the box and copied the optimized mmc.o up to /tmp.&nbsp; I can not get wget to work on DD-WRT (have no idea why).<br/>-telneted into the box and did &quot;rm mmc.o&quot; from the /lib/modules/2.4.36 directory.&nbsp; It prompted, and I said y.&nbsp; However, after I did an ls it still shows in the directory.&nbsp; Not sure why it wouldn&#039;t remove.<br/>-I then changed the directory to /tmp and checked that the uploaded mmc.o was there - it was.&nbsp; So from /tmp I ran mmc.o.<br/>-I then ran dmesg again, and got this:<br/>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43646 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43271 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[ERROR] mmc_init: got an error calling mmc_card_init: 01<br/>[ERROR] mmc_check_media: change detected but was not able to initialize new card: ffffffff</p><p>After wanting to throw the computer, the router, and every other inanimate object out the window .... I:<br/>-rebooted the router (from the command line), <br/>-checked the dmesg to ensure there wasn&#039;t anything there.&nbsp; <br/>-I then went back into the WebUI and turned the JFFS2 to disabled, still leaving the MMC disabled in the WebUI, saved and rebooted. <br/>-I uploaded the optimized mmc.o to /tmp.<br/>-I telneted into the box, checked that the mmc.o was there, then ran &quot;insmod mmc.o&quot;<br/>-ran dmesg, and same output as above (the errorring one).</p><p>Really ready to throw the thing, I went back to the unit, checked my solders, then figured I would cycle it by unplugging and replugging in the power.&nbsp; So I did that.<br/>-I then uploaded the mmc.o to /tmp.<br/>-telneted into it and from /tmp ran &quot;insmod mmc.o&quot;.<br/>-dmesg | grep mmc shows:</p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43649 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[INFO] mmc_card_init: doing initialization loop<br/>[INFO] mmc_card_init: card inited successfully in 531 tries (16381213 CPU cycles).<br/>[INFO] mmc_init: MMC/SD Card ID:<br/>[INFO] mmc_card_config: size = 1931264, hardsectsize = 1024, sectors = 1931264<br/>[WARN] mmc_init: hd_sizes=1931264, hd[0].nr_sects=3862528<br/>[INFO] mmc_card_init: set_blocklen (CMD16) succeeded !<br/> mmca: p1</p><p>So .... I know this has been REALLY long .... but I have a couple of questions:<br/>-First, any idea for this behavior?&nbsp; First why the optimized mmc.o from this works, but the one that the GUI is trying to load from the kernel is bombing?<br/>-Next, why the mmc.o file from the /lib/modules/2.4.36/ can&#039;t be removed?<br/>-Why wget doesn&#039;t work in DD-WRT?<br/>-How I should go about getting this to mount so I don&#039;t have to do this every time I have to reboot ....</p><p>Thanks!</p><p>Spencer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89937">
				<div class="post-metadata">
					<div class="post-num">Post #157</div>
					<div class="post-author">eidos</div>
					<div class="post-datetime">
						15 Jun 2009, 22:55					</div>
				</div>
				<div class="post-content content">
					<p>I tried a test with a multimeter on the pin (4 and 2) i noticed that the gpio 4 and 2 are like shortcutted... cause both turn on/off the white led on my wrt54gl v1.1 is it normal? it&#039;s trivial that the sd mod doesn&#039;t work for me <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/><br/>Any help?</p><p>I found maybe a solution... here:<br/><a href="http://nil-techno.blogspot.com/2008/07/adding-2gb-sd-card-on-wrt54g-with.html?showComment=1245101708717#c2914859185673494175">http://nil-techno.blogspot.com/2008/07/ … 5673494175</a><br/> i&#039;ll try it asap..</p>											<p class="post-edited">(Last edited by <strong>eidos</strong> on 16 Jun 2009, 01:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90883">
				<div class="post-metadata">
					<div class="post-num">Post #158</div>
					<div class="post-author">deathazre</div>
					<div class="post-datetime">
						5 Jul 2009, 18:31					</div>
				</div>
				<div class="post-content content">
					<p>So.... I have the same issue.</p><p>I&#039;m convinced the card connections are right - this card has been used successfully prior to upgrading to 8.09 kamikaze.</p><p>My first driver load attempt appeared successful:</p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43643 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[INFO] mmc_card_init: doing initialization loop<br/>[INFO] mmc_card_init: card inited successfully in 195 tries (6015626 CPU cycles).<br/>[INFO] mmc_init: MMC/SD Card ID:<br/>27 50 48 53 44 35 31 32 11 e5 40 02 07 00 69 81 [INFO] Manufacturer ID&nbsp; &nbsp;: 27<br/>[INFO] OEM/Application ID: PH<br/>[INFO] Product name&nbsp; &nbsp; &nbsp; : SD512<br/>[INFO] Product revision&nbsp; : 1.1<br/>[INFO] Product SN&nbsp; &nbsp; &nbsp; &nbsp; : e5400207<br/>[INFO] Product Date&nbsp; &nbsp; &nbsp; : 2006-9<br/>[INFO] mmc_card_config: size = 497152, hardsectsize = 512, sectors = 994304<br/>[WARN] mmc_init: hd_sizes=497152, hd[0].nr_sects=994304<br/>[INFO] mmc_card_init: set_blocklen (CMD16) succeeded !<br/>Partition check:<br/> mmca: p1</p><p>the mmc appeared in /dev/ - for whatever reason, after loading the filesystem drivers and attempting to mount, all attempts to use the mmc fail.</p><p>Even subsequent attempts to load the driver now fail with that error:</p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43643 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43324 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[ERROR] mmc_init: got an error calling mmc_card_init: 01<br/>[ERROR] mmc_check_media: change detected but was not able to initialize new card: ffffffff</p><p>Thanks to everyone who helped us get this far <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>											<p class="post-edited">(Last edited by <strong>deathazre</strong> on 5 Jul 2009, 18:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91211">
				<div class="post-metadata">
					<div class="post-num">Post #159</div>
					<div class="post-author">bud</div>
					<div class="post-datetime">
						11 Jul 2009, 14:20					</div>
				</div>
				<div class="post-content content">
					<p>a discussion about mmc support on kernel 2.6 is here<br/><a href="http://forum.openwrt.org/viewtopic.php?pid=91200">http://forum.openwrt.org/viewtopic.php?pid=91200</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p97036">
				<div class="post-metadata">
					<div class="post-num">Post #160</div>
					<div class="post-author">rdondoyano</div>
					<div class="post-datetime">
						8 Nov 2009, 14:36					</div>
				</div>
				<div class="post-content content">
					<p>Wow super fast transfer rates... Now I can copy files faster than ever. Thanks for the info...</p><p>Ryan D<br/><a href="http://www.goodbanners.com/">banner design</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p97045">
				<div class="post-metadata">
					<div class="post-num">Post #161</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						8 Nov 2009, 16:19					</div>
				</div>
				<div class="post-content content">
					<p>Get a router with USB if you need extra storage...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100798">
				<div class="post-metadata">
					<div class="post-num">Post #162</div>
					<div class="post-author">bud</div>
					<div class="post-datetime">
						18 Jan 2010, 12:20					</div>
				</div>
				<div class="post-content content">
					<p>the new package broadcom-sdhc is meant to replace the outdated broadcom-mmc driver for brcm-2.4 in trunk. Please try it. It&#039;s an enhanced version of the broadcom-mmc version 1.3.5 module.<br/>See <a href="https://forum.openwrt.org/viewtopic.php?pid=100795#p100795">https://forum.openwrt.org/viewtopic.php?pid=100795#p100795</a></p><p>.. bud</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139865">
				<div class="post-metadata">
					<div class="post-num">Post #163</div>
					<div class="post-author">MadKraut</div>
					<div class="post-datetime">
						25 Jul 2011, 03:45					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>yet another success story with WRT54GL v1.1 and Kamikaze 8.09.2, r18961 (2.4.35.4 linux kernel) and the 1.3.4 driver, using GPIO 2 = DI, 4 = DO, 3 = CLK and 7 = CS:</p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43646 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[INFO] mmc_card_init: doing initialization loop<br/>[INFO] mmc_card_init: card inited successfully in 2 tries (61580 CPU cycles).<br/>[INFO] mmc_init: MMC/SD Card ID:<br/>28 42 45 42 34 39 38 33 10 00 00 f0 e2 00 5c 03 [INFO] Manufacturer ID&nbsp; &nbsp;: 28<br/>[INFO] OEM/Application ID: BE<br/>[INFO] Product name&nbsp; &nbsp; &nbsp; : B4983<br/>[INFO] Product revision&nbsp; : 1.0<br/>[INFO] Product SN&nbsp; &nbsp; &nbsp; &nbsp; : 0000f0e2<br/>[INFO] Product Date&nbsp; &nbsp; &nbsp; : 2005-12<br/>[INFO] mmc_card_config: size = 249856, hardsectsize = 512, sectors = 499712<br/>[WARN] mmc_init: hd_sizes=249856, hd[0].nr_sects=499712<br/>[INFO] mmc_card_init: set_blocklen (CMD16) succeeded !<br/>Partition check:<br/> mmca: p1</p><p>I also found the following links quite helpful:<br/>1. <a href="http://beta.ivc.no/wiki/index.php/Adding_SD_card_to_WRT54GL">http://beta.ivc.no/wiki/index.php/Adding_SD_card_to_WRT54GL</a> - great description with various pinouts, also pointing to these enhanced drivers<br/>2. <a href="http://www.hendlsofen.de/WRT54GL/eng/WRT54GL_main.html">http://www.hendlsofen.de/WRT54GL/eng/WRT54GL_main.html</a> - very nice step-by-step type instructions, especially for mounting the SD-card as root</p><p>I have a 256 MB microSD card with ext2 partition. I soldered the wires to the microSD card adaptor, instead of directly to the microSD card, so I used the SD card pinout. This made soldering a lot easier for me, as it is much larger - yet, I still got it wrong on the first attempt. If you are seeing this error:</p><p>[FATAL] mmc_card_init: invalid response from card: 00 found, waiting for 01</p><p>it may very well be that you are having a similar problem like I had - my GPIO 4 was apparently shorted to ground. So in my case it was a soldering / wiring problem. </p><p>Hope this may help someone.</p><p>Many thanks to Cyril for his great work !</p><p>Kind Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p157072">
				<div class="post-metadata">
					<div class="post-num">Post #164</div>
					<div class="post-author">hdei</div>
					<div class="post-datetime">
						11 Feb 2012, 22:20					</div>
				</div>
				<div class="post-content content">
					<p>I have a 8 GB card and WRT54GL V1.1 with OpenWrt kernel 2.4</p><p>when I boot the card is installed nearly ok, second part mean mounting not</p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[INFO] mmc_card_init: doing initialization loop<br/>[ERROR] mmc_card_init: card not successfully inited after 30000 tries.<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[INFO] mmc_card_init: doing initialization loop<br/>[INFO] mmc_card_init: card inited successfully in 7207 tries (118 seconds -351182 usec).<br/>[WARN] mmc_init: impossible to get card indentification info for reason code: 02<br/>[ERROR] mmc_init: got an error when trying to get card configuration registers: 02<br/>[ERROR] mmc_check_media: change detected but was not able to initialize new card: ffffffff</p><p>When I rmmod mmc and istmod mmc do then </p><p>[INFO] mmc_hardware_init: initializing GPIOs<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43657 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[INFO] mmc_card_init: the period of a 380KHz frequency lasts 524 CPU cycles<br/>[INFO] mmc_card_init: powering card on. sending 80 CLK<br/>[INFO] mmc_card_init: 80 CLK sent in 43309 CPU cycles<br/>[INFO] mmc_card_init: resetting card (CMD0)<br/>[FATAL] mmc_card_init: invalid response from card: ff found, waiting for 01<br/>[ERROR] mmc_init: got an error calling mmc_card_init: 01<br/>[ERROR] mmc_check_media: change detected but was not able to initialize new card: ffffffff</p><p>has some any idea what I can do?<br/>I need the space for my own HTML and co.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p158348">
				<div class="post-metadata">
					<div class="post-num">Post #165</div>
					<div class="post-author">McKein</div>
					<div class="post-datetime">
						22 Feb 2012, 15:25					</div>
				</div>
				<div class="post-content content">
					<p>Will this version recognize the GPIO layout in the Buffalo WHR-HP-G54??? I&#039;ve been trying and trying to get anything, a nice generic SP3 would be nice. I&#039;m bad at compiling and scripting though <a href="http://www.mspy.com/">cell phone tracker</a></p>											<p class="post-edited">(Last edited by <strong>McKein</strong> on 11 Apr 2012, 09:05)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 7 of 7</div><nav><ul><li><a href="viewtopic.php%3Fid=9653&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=9653&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=9653&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>