<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Weak Ciphers in SSL found by OpenVas security scanner</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p349728">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">e3c77773</div>
					<div class="post-datetime">
						19 Jan 2017, 19:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys</p><p><strong><em>The security issue</em></strong><br />To check security of the router, I ran an OpenVas security scanner against OpenWrt Chaos Calmer 15.05.1 / LuCI 15.05-188-g87e9837 </p><p>OpenVas detects WEAK CIPHERS in Https (like Sha1 autogenerated certificate) and SSH.</p><p><strong><em>Actions: </em></strong><br />- Removed buggy dropbear, replace by openssh<br />- Apparently the only way to adjust the ciphers is through /etc/sshd_config (config below). After each edit, restarted sshd. Some changes, but still presents weak ciphers and sha1 certificate. </p><p><em><strong>Big Question</strong></em><br />- How to block negotiating weak ciphers. <br />- How to strengthen the certificates. <br />Am I missing something, or does ssh needs a patch ?</p><br /><p><strong><em>Additional info</em></strong><br />Installed packages related to ssh/ssl are<br />libopenssl &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 1.0.2g-1<br />libpolarssl &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 1.3.14-1<br />libustream-polarssl &nbsp; &nbsp;&nbsp; 2015-07-09-c2d73c2261..2d3<br />luci-ssl &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; git-16.043.44305-e2f9172-1<br />openssh-keygen &nbsp; &nbsp;&nbsp; 7.1p2-1<br />openssh-server &nbsp; &nbsp;&nbsp; 7.1p2-1<br />openssh-sftp-server 7.1p2-1</p><br /><p><strong><em>Changes and additions /etc/sshd_config :</em></strong></p><p>Protocol 2<br />HostKey /etc/ssh/ssh_host_rsa_key<br />HostKey /etc/ssh/ssh_host_dsa_key<br />ServerKeyBits 2048</p><p>Ciphers aes256-ctr,aes192-ctr,aes128-ctr,aes256-gcm@openssh.com</p><p>MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-ripemd160-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,hmac-ripemd160,umac-128@openssh.com</p><p>HostKeyAlgorithms ssh-rsa,ssh-dss</p><p>Hostbasedacceptedkeytypes ssh-rsa,ssh-ed25519</p><p>KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351897">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">e3c77773</div>
					<div class="post-datetime">
						14 Feb 2017, 11:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi, anyone ? <br />Big Question<br />- How to block negotiating weak ciphers by Luci and Luci-ssl<br />- How to strengthen the certificates.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351899">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						14 Feb 2017, 11:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e3c77773 wrote:</cite><blockquote><p>- How to block negotiating weak ciphers by Luci and Luci-ssl<br />- How to strengthen the certificates.</p></blockquote></div><p>Move away from polarssl that has been deprecated. With LEDE and Openwrt DD trunk you can e.g. use luci-ssl-openssl and use openssl for SSL certificate generation. </p><p>(With luci-ssl Openwrt&#039;s px5g key generation tool only knows to use the deprecated polarssl, which is a shame. In LEDE px5g uses the more modern mbedtls instead of polarssl.)</p><p>----</p><p>There is no need to use the built-in automatic tools for certificate &amp; key generation.</p><p>Manually generate dropbear SSH keys with higher bit amount (using the dropbearkey command) and then place the keys to the correct place.</p><p>You can also generate the SSL certificate for Luci (uhttpd) manually by installing openssl-utils package to get the openssl commandline tools. With that you can generate the SSL keys for uhttpd.</p><p>Some command examples for certificate creation:<br /></p><div class="codebox"><pre><code>/usr/sbin/px5g  selfsigned -der -days 365 -newkey rsa:2048 -keyout ./test.key -out ./test.crt -subj /C=&quot;FI&quot;/ST=&quot;Uusi maa&quot;/L=&quot;Es poo&quot;/CN=&quot;user&quot;

openssl req -x509 -outform der -nodes -days 365 -newkey rsa:2048 -keyout ./test.key -out ./test.crt -subj /C=&quot;FI&quot;/ST=&quot;Uusi maa&quot;/L=&quot;Es poo&quot;/O=&quot;something&quot;/CN=&quot;user&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351900">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">e3c77773</div>
					<div class="post-datetime">
						14 Feb 2017, 11:47					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for swift reply.<br />Makes sense for the certificate part. <br />Not sure about negotiating weaker keys by luci however. Ill try asap and let you know !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351901">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						14 Feb 2017, 11:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e3c77773 wrote:</cite><blockquote><p>Makes sense for the certificate part. <br />Not sure about negotiating weaker keys by luci however.</p></blockquote></div><p>LuCI ssl (= uhttpd service in practice) uses the certificate generated by you. You can use Openssl to first generate a stronger key if you like, and then generate the certificate. Internet is full of advice for using openssl for self-signed certificates.</p><p>Cert and key just need to be placed as /etc/uhttpd.key and uhttpd.crt</p><div class="codebox"><pre><code>root@LEDE:~# ls /etc/uhttpd.*
/etc/uhttpd.crt  /etc/uhttpd.key</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351915">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						14 Feb 2017, 14:10					</div>
				</div>
				<div class="post-content content">
					<p>finally some reasonable explanations about self-signed cert. when i tried it first time i followed wrong tutorials that focused on importing some certs in browser. now i see these are actually put into device.</p><p>if polarssl is deprecated shouldn&#039;t it be removed? and what about cyassl? openssl doesn&#039;t support older browser versions so it&#039;s not best either. i&#039;ve yet to check on mbedtls.</p><p>luci-lib-px5g is not even selected in menuconfig (openwrt trunk)</p><p>now i see there are two different choice possibilites:</p><p>1. LuCI-&gt;Collections<br />2. Network-&gt;Web Servers/Proxies-&gt;uhttpd-mod-tls</p><p>if they mismatch does that mean secure version of site will not be available?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351917">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						14 Feb 2017, 14:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>if polarssl is deprecated shouldn&#039;t it be removed? </p><p>luci-lib-px5g is not even selected in menuconfig (openwrt trunk)</p><p>now i see there are two different choice possibilites:</p><p>1. LuCI-&gt;Collections<br />2. Network-&gt;Web Servers/Proxies-&gt;uhttpd-mod-tls</p></blockquote></div><p>Polarssl has been removed from LEDE (where almost all core developers are active nowadays), but as the Openwrt development is pretty dead, nobody has taken care of that in the Openwrt repo.</p><p>luci-lib-px5g is quite something else. It is not needed.&nbsp; &nbsp;<br />&nbsp; &nbsp;(px5g is a seperate package pulled in by luci-ssl, and is only used once for SSL certificate generation)</p><p>uhttpd-mod-tls is not needed. it is an empty package (and has been deleted from LEDE).</p><p>To get SSL-based LuCI for Openwrt DD master (or LEDE master), you either <br />* install luci-ssl that installs uhttpd, libustream-mbedtls (in DD trunk) and px5g (and indirectly also libpolarssl in Openwrt or libmbedtls in LEDE).&nbsp; <a href="https://github.com/openwrt/luci/blob/master/collections/luci-ssl/Makefile">https://github.com/openwrt/luci/blob/ma … l/Makefile</a><br /> * install luci-ssl-openssl, that installs uhttpd, libustream-openssl, libopenssl and openssl-util and is an &quot;openssl-only&quot; version of LuCI.&nbsp; &nbsp; &nbsp;<a href="https://github.com/openwrt/luci/blob/master/collections/luci-ssl-openssl/Makefile">https://github.com/openwrt/luci/blob/ma … l/Makefile</a></p><p>(Note that CC15.05 branch still appears to install libustream-polarssl)</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 14 Feb 2017, 14:41)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>