<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to get more free RAM?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p69995">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">petrs</div>
					<div class="post-datetime">
						24 Jun 2008, 15:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I compiled JFFS2 image for my DSL-362T. This modem has 8MB RAM but most of them is occupied:</p><div class="quotebox"><blockquote><p>Memory: 4596k/8192k available (1875k kernel code, 3596k reserved, 395k data, 120k init, 0k highmem)</p></blockquote></div><p>After boot modem has only 620KB of free RAM:</p><div class="codebox"><pre><code># free
              total         used         free       shared      buffers
  Mem:         4716         4000          620            0            0
 Swap:            0            0            0
Total:         4716         4000          620</code></pre></div><p>When I run simple script like </p><div class="codebox"><pre><code>#!bin/sh
ls -lR / &gt; /tmp/ls.txt
cat /tmp/ls.txt</code></pre></div><p>...system consumes free memory and after that kill any suitable process to free memory: </p><div class="quotebox"><blockquote><p>Out of memory: kill process 340 (ash) score 111 or a child<br />Killed process 347 (cat)<br />watchdog invoked oom-killer: gfp_mask=0x1201d2, order=0, oomkilladj=0<br />Call Trace:<br />[&lt;94107e64&gt;] dump_stack+0x8/0x34<br />[&lt;941566c8&gt;] oom_kill_process+0x64/0x1cc<br />[&lt;94156b90&gt;] out_of_memory+0x1bc/0x21c<br />[&lt;94159748&gt;] __alloc_pages+0x284/0x350<br />[&lt;9415c954&gt;] __do_page_cache_readahead+0xe4/0x2b8<br />[&lt;9415d0f8&gt;] do_page_cache_readahead+0x70/0xa8<br />[&lt;94155388&gt;] filemap_fault+0x184/0x448<br />[&lt;94165334&gt;] __do_fault+0x7c/0x5ac<br />[&lt;941678e8&gt;] handle_mm_fault+0x3ac/0x7f4<br />[&lt;9410bdf0&gt;] do_page_fault+0x100/0x340<br />[&lt;941015c0&gt;] ret_from_exception+0x0/0x24</p></blockquote></div><p>I would like to run at least simple scripts on such HW so I need more free RAM. I have tweaked kernel and busybox settings but with little success. Are there any settings I can modify to reduce for example reserved memory?</p>											<p class="post-edited">(Last edited by <strong>petrs</strong> on 24 Jun 2008, 15:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70057">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ciscostu</div>
					<div class="post-datetime">
						25 Jun 2008, 15:47					</div>
				</div>
				<div class="post-content content">
					<p>Try not using /tmp.&nbsp; It&#039;s a tmpfs RAM drive that can grow up to 4MB (50% of the RAM size by default).</p><p>Hope this helps,<br />Charlie</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70061">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">petrs</div>
					<div class="post-datetime">
						25 Jun 2008, 16:04					</div>
				</div>
				<div class="post-content content">
					<p>I tried this but free RAM seems not to be affected by existence of /tmp. I simply commented out mount of /tmp in /etc/preinit but free RAM is still the same. Kernel probably allocates some amount of RAM for tmpfs by default. When /tmp partition size is ommited ds -h shows that /tmp size is approx. 2.4MB</p>											<p class="post-edited">(Last edited by <strong>petrs</strong> on 25 Jun 2008, 16:08)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>