<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> device.dts manuals?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p209992">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">wjding</div>
					<div class="post-datetime">
						17 Aug 2013, 08:54					</div>
				</div>
				<div class="post-content content">
					<p>Does anyone know where I can find documents on how to write the device.dts files? </p><p>I see under target/linux/ramips/, there is no files/arch directory anymore, currently the dts is used for device definition. However, I failed to find any manuals on how to write it. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Your help to provide me the manual is much appreciated! </p><p>Below is mine in original mach-device.c file. However, I have no idea whether to map the rootfs and kernel partitions. <br />static struct mtd_partition hg255d_partitions[] = {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp;= &quot;u-boot&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .offset = 0,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp;= SZ_128K,<br />&nbsp; &nbsp; &nbsp; &nbsp; }, {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp;= &quot;kernel&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .offset = SZ_128K,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp;= SZ_1M,<br />&nbsp; &nbsp; &nbsp; &nbsp; }, {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp;= &quot;rootfs&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .offset = SZ_1M + SZ_128K,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp;= FLASH_SIZE - (SZ_1M + SZ_128K * 2),<br />&nbsp; &nbsp; &nbsp; &nbsp; }, {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp;= &quot;firmware&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .offset = SZ_128K,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp;= FLASH_SIZE - (SZ_128K * 2),<br />&nbsp; &nbsp; &nbsp; &nbsp; }, {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp;= &quot;factory&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .offset = SZ_1M + (SZ_128K),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp;= SZ_128K,<br />&nbsp; &nbsp; &nbsp; &nbsp; }, {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp;= &quot;fullflash&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .offset = 0x000000,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp;= FLASH_SIZE,<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />};</p>											<p class="post-edited">(Last edited by <strong>wjding</strong> on 17 Aug 2013, 08:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210020">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">wjding</div>
					<div class="post-datetime">
						17 Aug 2013, 18:27					</div>
				</div>
				<div class="post-content content">
					<p>plntyk helped to answer me on irc:<br />&lt;plntyk&gt; wjding: i think i saw some advice about dts aka DeviceTree at some linux-kernel arm page wiki<br />&lt;plntyk&gt; <a href="http://www.devicetree.org/Main_Page">http://www.devicetree.org/Main_Page</a> there for example and other stuff<br />&lt;plntyk&gt; that you find in google</p><p>Many thanks to plntyk!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210042">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						17 Aug 2013, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>Does DTS include partitioning? I&#039;m not so sure about that. I thought it&#039;s for devices only, not MTD dev partitions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210165">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">wjding</div>
					<div class="post-datetime">
						19 Aug 2013, 18:02					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s also strange to me that some files include the partition information, while others not. </p><p>I have tried to add the partition information and it works well. However, do you know where does the partition information come if there&#039;s no such information in the DTS files?</p><p>Below is an example:<br />&nbsp; &nbsp; &nbsp; &nbsp; cfi@1f000000 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compatible = &quot;cfi-flash&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reg = &lt;0x1f000000 0x1000000&gt;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bank-width = &lt;2&gt;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; device-width = &lt;2&gt;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #address-cells = &lt;1&gt;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #size-cells = &lt;1&gt;;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; partition@0 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; label = &quot;u-boot&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reg = &lt;0x0 0x20000&gt;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read-only;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; kernel: partition@20000 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; label = &quot;kernel&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reg = &lt;0x20000 0x100000&gt;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read-only;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rootfs: partition@120000 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; label = &quot;rootfs&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reg = &lt;0x120000 0xec0000&gt;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; partition@fe0000 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; label = &quot;factory&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reg = &lt;0xfe0000 0x20000&gt;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read-only;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; &nbsp; &nbsp; };</p>											<p class="post-edited">(Last edited by <strong>wjding</strong> on 19 Aug 2013, 18:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210181">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						19 Aug 2013, 23:04					</div>
				</div>
				<div class="post-content content">
					<p>I think the information comes from the bootloader.<br />As I understand the devicetree dts file is some config file for the kernel - stating components etc. - so you can use the same kernel with different boards and you only switch your &quot;config&quot; file at boot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210280">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">wjding</div>
					<div class="post-datetime">
						21 Aug 2013, 07:54					</div>
				</div>
				<div class="post-content content">
					<p>zloop, do you mean the kenel parameters passed during boot by bootloader?<br />Or I don&#039;t think it has anything to do with bootloader. My bootloader was always the default one, but I can freely modify my partitions. Any ideas?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>