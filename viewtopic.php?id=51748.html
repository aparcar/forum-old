<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Mesh performance problem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p240952">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Soularie</div>
					<div class="post-datetime">
						21 Jul 2014, 15:40					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />This is a question on a Freifunk mesh network. Since Freifunk is based on OpenWRT I hope someone on this forum might have a suggestion for my problem.</p><p>I just added a node to our municipal Wifi mesh network to provide internet access. I am observing very poor internet download performance when going through the mesh network. See the cabling in attached picture.</p><p><span class="postimg"><img src="http://www.agr.nl/xfer/Mesh_wiring_diagram.png" alt="mesh performance problem" /></span></p><p>The internet comes from a satellite dish and is connected to the WAN port of a LinkSys WRT54GL running Freifunk v1.7.4. Via the Wifi this router is connected to the Freifunk mesh. Via a LAN output the router is connected to another Wifi router (Netgear) configured as access point.</p><p>Another router (Buffalo) which is part of the mesh is located about 10 m away from the new router. I can get access to the internet via the mesh through another connected TP-link Wifi router.</p><p>If I perform a speedtest.net test on an iPad connected to the Netgear router I get a download of about 9-17 Mb/s and an upload of about 4.5 Mb/s, which is in line with what I expect from the satellite internet.<br />However, if I perform the same speedtest.net measurement when I connect the iPad via the Freifunk mesh I only get about .01 Mb/s download and about 2 Mb/s upload.</p><p>If I run the netperf test on the mesh network I get speeds of around 10 Mb/s for both ways.</p><p>So the download performance via the mesh is very slow.</p><p>Any ideas what might cause this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240981">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						21 Jul 2014, 19:17					</div>
				</div>
				<div class="post-content content">
					<p>The important question is how far away is the TP-Link router from the Buffalo?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241006">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Soularie</div>
					<div class="post-datetime">
						21 Jul 2014, 23:16					</div>
				</div>
				<div class="post-content content">
					<p>The distance between the TP-Link and Buffalo routers is about 10 m. But it is a wired connection.<br />I should have been more clear. The function of the TP LINK and the Netgear routers is to provide wifi access to the iPad. They are configured as normal Access Points. The Buffalo and Linksys routers are configured in ad-hoc mode.<br />So the blue path is from the iPad via Wifi to the Netgear, then via wire through the Linksys to the satellite modem.<br />The red path id from from the iPad via Wifi to the TP link, then via wire to the Buffalo, via the wifi mesh to the Linksys, and via wire to the modem.</p>											<p class="post-edited">(Last edited by <strong>Soularie</strong> on 21 Jul 2014, 23:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241012">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mwarning</div>
					<div class="post-datetime">
						22 Jul 2014, 00:26					</div>
				</div>
				<div class="post-content content">
					<p>Does your WRT54L has a speed setting? Some Freifunk Firmwares have this feature so not to block your Internet connection. And your Firmware might be quite old (since it is an old router model).</p><p>Also, the traffic over the Netgear router will likely exit into the Internet at your Internet connection.<br />But the traffic over the Freifunk mesh is probably encrypted (slow) and send over Internet to some server<br />that forwards the traffic to exit in foreign countries.</p>											<p class="post-edited">(Last edited by <strong>mwarning</strong> on 22 Jul 2014, 00:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241021">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						22 Jul 2014, 02:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Soularie wrote:</cite><blockquote><p>The distance between the TP-Link and Buffalo routers is about 10 m. But it is a wired connection.<br />I should have been more clear. The function of the TP LINK and the Netgear routers is to provide wifi access to the iPad. They are configured as normal Access Points. The Buffalo and Linksys routers are configured in ad-hoc mode.<br />So the blue path is from the iPad via Wifi to the Netgear, then via wire through the Linksys to the satellite modem.<br />The red path id from from the iPad via Wifi to the TP link, then via wire to the Buffalo, via the wifi mesh to the Linksys, and via wire to the modem.</p></blockquote></div><p>Yes I understood that fine. The distance between them still matters though, because if you two routers or access points too close to each other they will destroy performance due to interference even when on completely different channels. But 10m should be enough separation to take sideband interference out of the picture, unless you&#039;re using 40Mhz channels on either device.</p><p>Since you seem to be familiar with netperf and have set it up to run between routers the first thing I would do is to identify the bottleneck. I would run throughput tests from the TP-Link to the Linksys, as well as from the iPad to the TP-Link. Similarly I would observe latency and packet loss during and after said tests, again between said hops. I&#039;d also keep an eye on link rates (I&#039;m not sure how modified Freifunk is but if it still has the iw command you should be able to see per device per direction link rates and signal)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241047">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Soularie</div>
					<div class="post-datetime">
						22 Jul 2014, 11:34					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for thinking along! But it was a mistake on my part - &quot;a short between the earphones&quot; as old radio amateurs used to say. I had traffic shaping switched on on my gateway which reduced output....</p><p>Apologies!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241066">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						22 Jul 2014, 15:56					</div>
				</div>
				<div class="post-content content">
					<p>To 0.01Mbps? That&#039;s some extreme traffic shaping :-P</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241076">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Soularie</div>
					<div class="post-datetime">
						22 Jul 2014, 17:49					</div>
				</div>
				<div class="post-content content">
					<p>Indeed it is. <br />I installed the gateway module, which by default has traffic shaping on and reduces it to 50% of 128kb/s.<br />When I disabled it performance shot up to about 5Mb/s.<br />What threw me off was the upload was much less affected. I would have expected that upload would have been easier to squeeze.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>