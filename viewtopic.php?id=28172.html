<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to initialize samba3 with a higher priority than default lowest?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p125635">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						16 Jan 2011, 18:20					</div>
				</div>
				<div class="post-content content">
					<p>Why can&#039;t I use nice to initialize samba3 with higher priority? <br />I use nice -n -20 to init samba3&#039;s process smbd -D.But it still run in default lowest priority.But in Tomato,samba&#039;s priority can be modify.How to modify samba priority in OPENWRT?</p><br /><p>22512 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0&nbsp; 1088&nbsp; &nbsp;240&nbsp; &nbsp;156 S&nbsp; 0.0&nbsp; 0.4&nbsp; 0:02.20 miniupnpd -i pppoe-wan -a<br /> 1583 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0&nbsp; 2124&nbsp; &nbsp;488&nbsp; &nbsp;344 S&nbsp; 0.0&nbsp; 0.8&nbsp; 1:05.96 nmbd -D<br />24023 root&nbsp; &nbsp; &nbsp; 39&nbsp; 19&nbsp; 2628&nbsp; 1280&nbsp; &nbsp;580 S&nbsp; 0.0&nbsp; 2.1&nbsp; 0:00.07 smbd -D<br />24283 root&nbsp; &nbsp; &nbsp; 39&nbsp; 19&nbsp; 2916&nbsp; 1676&nbsp; &nbsp;920 S&nbsp; 0.0&nbsp; 2.7&nbsp; 0:00.04 smbd -D<br />24477 nobody&nbsp; &nbsp; 39&nbsp; 19&nbsp; 2892&nbsp; 1512&nbsp; &nbsp;788 S&nbsp; 0.0&nbsp; 2.4&nbsp; 0:00.00 smbd -D<br />&nbsp; 339 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0&nbsp; 1356&nbsp; &nbsp;148&nbsp; &nbsp;128 S&nbsp; 0.0&nbsp; 0.2&nbsp; 0:40.39 syslogd -C16<br />20413 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0 26296 17720&nbsp; 1040 S&nbsp; 0.0 28.5&nbsp; 0:17.42 transmission-daemon -g /m<br />20414 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0 26296 17720&nbsp; 1040 S&nbsp; 0.0 28.5&nbsp; 0:00.34 transmission-daemon -g /m<br />20415 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0 26296 17720&nbsp; 1040 S 13.0 28.5&nbsp; 9h56:24 transmission-daemon -g /m<br />20418 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0 26296 17720&nbsp; 1040 S&nbsp; 0.0 28.5&nbsp; 1:45.40 transmission-daemon -g /m<br /> 1431 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0&nbsp; 1048&nbsp; &nbsp; 56&nbsp; &nbsp; 44 S&nbsp; 0.0&nbsp; 0.1&nbsp; 0:00.37 vsftpd</p>											<p class="post-edited">(Last edited by <strong>axishero</strong> on 16 Jan 2011, 18:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125814">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						18 Jan 2011, 15:09					</div>
				</div>
				<div class="post-content content">
					<p>any ideas?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125816">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">flux</div>
					<div class="post-datetime">
						18 Jan 2011, 15:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>axishero wrote:</cite><blockquote><p>any ideas?</p></blockquote></div><p>by editing /etc/init.d/samba ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125906">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">robnitro</div>
					<div class="post-datetime">
						19 Jan 2011, 03:19					</div>
				</div>
				<div class="post-content content">
					<p>I couldn&#039;t figure that out either so I started running transmission with nice 19.</p><p>Editing init.d/samba didn&#039;t work.&nbsp; Even killing the service and running the command with nice -19 didn&#039;t change it.</p><br /><p>My modified startup for transmission:<br />nice -n 19 transmission-daemon -b -g /mnt/usb/transmission-daemon </p><p>And disabled the transmission init.d service as it would anyway regularly try to run a new settings.json ANNOYING!</p><p>Mem:60M used:23M buffers:1M cache:34M&nbsp; &nbsp; &nbsp;<br />CPU[|||&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3.9%] Loa[|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00/0.02/0.00]<br />CPU:&nbsp; 1.3% sy:&nbsp; 0.7% ni:&nbsp; 2.0% hi:&nbsp; 0.0% si:&nbsp; 0.0% wa:&nbsp; 0.0%<br />USER&nbsp; &nbsp; &nbsp; NI&nbsp; VIRT&nbsp; &nbsp;RES S CPU% MEM%&nbsp; &nbsp;TIME+&nbsp; Command<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1308&nbsp; &nbsp;680 R&nbsp; 1.0&nbsp; 1.1&nbsp; 0:00.14 htop<br />root&nbsp; &nbsp; &nbsp; 19 10428&nbsp; 6752 S&nbsp; 1.0 10.9 48:47.51 transmission-daemon -b -g /mnt/usb/tra<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1364&nbsp; &nbsp;120 S&nbsp; 0.0&nbsp; 0.2&nbsp; 0:04.24 init<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1364&nbsp; &nbsp; 44 S&nbsp; 0.0&nbsp; 0.1&nbsp; 0:00.00 init<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1416&nbsp; &nbsp;176 S&nbsp; 0.0&nbsp; 0.3&nbsp; 0:01.24 syslogd -C64<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1352&nbsp; &nbsp; 88 S&nbsp; 0.0&nbsp; 0.1&nbsp; 0:00.02 klogd<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp;776&nbsp; &nbsp; 80 S&nbsp; 0.0&nbsp; 0.1&nbsp; 0:00.06 /sbin/hotplug2 --override --persistent<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1372&nbsp; &nbsp;244 S&nbsp; 0.0&nbsp; 0.4&nbsp; 0:05.56 crond -c /etc/crontabs -l 5<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1140&nbsp; &nbsp;128 S&nbsp; 0.0&nbsp; 0.2&nbsp; 0:00.25 /usr/sbin/dropbear <br />nobody&nbsp; &nbsp; &nbsp;0&nbsp; 2024&nbsp; &nbsp;280 S&nbsp; 0.0&nbsp; 0.5&nbsp; 0:05.44 proftpd: (accepting connections)<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1564&nbsp; &nbsp;204 S&nbsp; 0.0&nbsp; 0.3&nbsp; 2:38.96 /usr/sbin/uhttpd -f -h /www -r OpenWrt<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1368&nbsp; &nbsp;168 S&nbsp; 0.0&nbsp; 0.3&nbsp; 0:01.07 udhcpc -t 0 -i eth1 -b -p /var/run/dhc<br />nobody&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp;932&nbsp; &nbsp;332 S&nbsp; 0.0&nbsp; 0.5&nbsp; 0:11.18 /usr/sbin/dnsmasq -K -D -y -Z -b -E -s<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1360&nbsp; &nbsp;112 S&nbsp; 0.0&nbsp; 0.2&nbsp; 0:01.20 watchdog -t 5 /dev/watchdog<br />root&nbsp; &nbsp; &nbsp; 19 10428&nbsp; 6752 S&nbsp; 0.0 10.9&nbsp; 0:05.67 transmission-daemon -b -g /mnt/usb/tra<br />root&nbsp; &nbsp; &nbsp; 19 10428&nbsp; 6752 S&nbsp; 0.0 10.9&nbsp; 0:00.00 transmission-daemon -b -g /mnt/usb/tra<br />root&nbsp; &nbsp; &nbsp; 19 10428&nbsp; 6752 S&nbsp; 0.0 10.9&nbsp; 0:15.99 transmission-daemon -b -g /mnt/usb/tra<br />root&nbsp; &nbsp; &nbsp; 19&nbsp; 2624&nbsp; &nbsp;492 S&nbsp; 0.0&nbsp; 0.8&nbsp; 0:00.03 smbd -D<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 2124&nbsp; &nbsp;540 S&nbsp; 0.0&nbsp; 0.9&nbsp; 0:00.88 nmbd -D<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1100&nbsp; &nbsp;232 S&nbsp; 0.0&nbsp; 0.4&nbsp; 0:01.66 miniupnpd -i eth1 -a 192.168.2.1 -p 50<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp;828&nbsp; &nbsp;160 S&nbsp; 0.0&nbsp; 0.3&nbsp; 0:01.17 /usr/sbin/ntpclient -i 600 -s -l -D -p<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1368&nbsp; &nbsp;224 S&nbsp; 0.0&nbsp; 0.4&nbsp; 0:00.42 udhcpc -t 0 -i eth1 -b -p /var/run/dhc<br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1216&nbsp; &nbsp;408 S&nbsp; 0.0&nbsp; 0.7&nbsp; 0:02.01 /usr/sbin/dropbear <br />root&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; 1364&nbsp; &nbsp;400 S&nbsp; 0.0&nbsp; 0.6&nbsp; 0:00.22 -ash</p>											<p class="post-edited">(Last edited by <strong>robnitro</strong> on 19 Jan 2011, 03:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126297">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						23 Jan 2011, 18:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robnitro wrote:</cite><blockquote><p>I couldn&#039;t figure that out either so I started running transmission with nice 19.</p><p>Editing init.d/samba didn&#039;t work.&nbsp; Even killing the service and running the command with nice -19 didn&#039;t change it.</p><br /><p>My modified startup for transmission:<br />nice -n 19 transmission-daemon -b -g /mnt/usb/transmission-daemon </p><p>And disabled the transmission init.d service as it would anyway regularly try to run a new settings.json ANNOYING!</p></blockquote></div><p>You encounter the same problem as mine.I&#039;ve tried start transmission with nice -19,but it lower transmission&#039;s performance.<br />There must be a file to define samba&#039;s pri,for I can change it&#039;s nice&nbsp; in Tomato or Ubuntu.</p>											<p class="post-edited">(Last edited by <strong>axishero</strong> on 23 Jan 2011, 18:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127095">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">robnitro</div>
					<div class="post-datetime">
						1 Feb 2011, 21:32					</div>
				</div>
				<div class="post-content content">
					<p>Transmission runs fine with nice -19 as other processes barely use any CPU (besides samba).<br />In fact, I prefer transmission to be lowest priority because it doesn&#039;t require realtime access.&nbsp; Samba on the other hand can be slowed down affecting playing videos from the share, etc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127120">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						2 Feb 2011, 03:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robnitro wrote:</cite><blockquote><p>Transmission runs fine with nice -19 as other processes barely use any CPU (besides samba).<br />In fact, I prefer transmission to be lowest priority because it doesn&#039;t require realtime access.&nbsp; Samba on the other hand can be slowed down affecting playing videos from the share, etc.</p></blockquote></div><p>Maybe you are seeding much fewer torrents than me or using a better performance device.I seed over 170 torrents using modify 8M 64M MR3420 router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127607">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">robnitro</div>
					<div class="post-datetime">
						7 Feb 2011, 22:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>axishero wrote:</cite><blockquote><div class="quotebox"><cite>robnitro wrote:</cite><blockquote><p>Transmission runs fine with nice -19 as other processes barely use any CPU (besides samba).<br />In fact, I prefer transmission to be lowest priority because it doesn&#039;t require realtime access.&nbsp; Samba on the other hand can be slowed down affecting playing videos from the share, etc.</p></blockquote></div><p>Maybe you are seeding much fewer torrents than me or using a better performance device.I seed over 170 torrents using modify 8M 64M MR3420 router.</p></blockquote></div><p>But, I am confused.&nbsp; If you set transmission to lowest priority, when other things are not using cpu on the device (check top or htop) transmission can use almost all of cpu, especially when doing many torrents.&nbsp; </p><p>Are you saying in this case when everything else is idle, transmission is slower at nice -19 than nice 0?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150377">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">forza.stiinta</div>
					<div class="post-datetime">
						5 Dec 2011, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>Did you find a solution to start samba with higher priority? It is not only transmission that can eat up resources...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150383">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">obsy</div>
					<div class="post-datetime">
						5 Dec 2011, 18:02					</div>
				</div>
				<div class="post-content content">
					<p>Use renice to change priority. Samba has hardcoded value which sets the value at the start.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150384">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">forza.stiinta</div>
					<div class="post-datetime">
						5 Dec 2011, 18:06					</div>
				</div>
				<div class="post-content content">
					<p>I cannot install &quot;renice&quot; package. I am a total newbie. Any help? Is it included in some other packages, or another way of running it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156108">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">swaaye</div>
					<div class="post-datetime">
						3 Feb 2012, 02:34					</div>
				</div>
				<div class="post-content content">
					<p>It looks like the only way to get renice is to recompile busybox?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156116">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">floatrock</div>
					<div class="post-datetime">
						3 Feb 2012, 04:14					</div>
				</div>
				<div class="post-content content">
					<p>Great promotion of their business and great and nice mode of marketing lovely post… keep it up guy. I always stand with you.<br /><a href="http://www.legitwebdesign.com.au/">wep page</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156261">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">swaaye</div>
					<div class="post-datetime">
						4 Feb 2012, 22:00					</div>
				</div>
				<div class="post-content content">
					<p>Ok I taught myself how to build OpenWRT. Pretty easy to do I have to say, thanks to the useful Wiki pages about the subject. I used Debian, installed into VirtualBox.</p><p>Anyway, I built busybox with renice, which works but is a bit of an annoying workaround. So I decided to explore the samba3 patches and change the hard-coded priority value to &quot;0&quot; instead of &quot;19&quot;. This works nicely it looks like. I pegged the CPU with a simple script with 19 priority and smbd was able to get 70% CPU usage.&nbsp; I really wanted SAMBA unimpeded, particularly by Transmission, because of how slow transfers are to and from the device even with 100% of the CPU devoted to it.</p>											<p class="post-edited">(Last edited by <strong>swaaye</strong> on 4 Feb 2012, 22:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223651">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">bisont87</div>
					<div class="post-datetime">
						24 Jan 2014, 20:26					</div>
				</div>
				<div class="post-content content">
					<p>I applied the nice option modifing <br /><strong>/etc/init.d/samba</strong> this way: <br /></p><div class="codebox"><pre><code>...
start() {
        config_load samba
        config_foreach smb_header samba
        config_foreach smb_add_share sambashare
        service_start /bin/nice -n -10 /usr/sbin/smbd -D
        service_start /bin/nice -n -10 /usr/sbin/nmbd -D
}
...</code></pre></div><p>I can&#039;t tell if it makes any effective differences in cpu priority, but in <strong>htop</strong> I can see nice values<br /><a href="https://imageshack.com/i/nby42bj"><span class="postimg"><img src="http://imagizer.imageshack.us/v2/320x240q90/839/y42b.jpg" alt="http://imagizer.imageshack.us/v2/320x240q90/839/y42b.jpg" /></span></a></p><p>I did the same thing with transmision init file </p><div class="codebox"><pre><code>...
    echo &quot;\&quot;&quot;invalid-key&quot;\&quot;: false&quot; &gt;&gt; $config_file
    echo &quot;}&quot; &gt;&gt; $config_file

    SERVICE_UID=&quot;$user&quot; \
    service_start /bin/nice /usr/bin/transmission-daemon -g $config_dir #aggiunto nice per ridurre la priorita
}
...</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>