<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link TL-MR13U - small router with built-in 10,400 mAh battery</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Jun 2015 and 22 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 5</div><nav><ul><li><a href="viewtopic.php%3Fid=44755&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=44755&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=5.html">5</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p207649">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">ron</div>
					<div class="post-datetime">
						20 Jul 2013, 23:45					</div>
				</div>
				<div class="post-content content">
					<p>Why dont you make a patch for Attitude adjustment? Its released, where as the&nbsp; trunk will keep changing.</p>											<p class="post-edited">(Last edited by <strong>ron</strong> on 20 Jul 2013, 23:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207658">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						21 Jul 2013, 01:59					</div>
				</div>
				<div class="post-content content">
					<p>@kamwanlai: thank you again for sharing your script!</p><p>@ron: I am interested to complete the patch against current trunk and submit it to openwrt-devel list for official inclusion. Later I can produce a patch for&nbsp; AA.</p><p>Here goes the instruction of how to flash TL-MR13U with OEM firmware to OpenWRT.</p><p>I got my unit from AliExpress shop named DNS, exceptional attention, very good price and extremely fast delivery.</p><p>TP-Link TL-MR13U has a button on the left to check the battery level. If you press it you will see several blue leds turning on on the left side of the unit, right where you see a blue line, on its right side. My unit came with 3 leds charge level.</p><p>I put it to charge for several hours with 5V 1A charger (I understand that we can use 5V 2A charges too) I had from ebook reader. While charging it has a blue leds turning on as the charge progress, all leds go off as soon as it gets fully charged (4 leds).</p><p>I have not tryed to connect to the router with Ethernet cables as I did last time with TP-Link TL-MR10U and directly started the unit trying to connect by Wi-Fi. Wi-Fi came up (SSID: TP-LINK_XXXXXX, where XXXXXX is the last 6 digits of MAC address of your router printed on its back), but I was unable to get an IP address lease from the router. I had the switch on the router in position &quot;AP&quot;, so I turned off the router, moved the switch into the middle position - &quot;Router&quot; and turned it on again. This time I got an IP lease.</p><p>Pointing the browser to <a href="http://192.168.1.1/">http://192.168.1.1/</a> I got following screen:<br/><a href="http://www.flickr.com/photos/otitov/9328289087/"><span class="postimg"><img src="http://farm3.staticflickr.com/2843/9328289087_127af8d7f6_m.jpg" alt="http://farm3.staticflickr.com/2843/9328289087_127af8d7f6_m.jpg"/></span></a><br/>where I just put &quot;admin&quot; (it was printed on the router&#039;s back) and pressed the button.</p><p>I got next screen:<br/><a href="http://www.flickr.com/photos/otitov/9328288939/"><span class="postimg"><img src="http://farm3.staticflickr.com/2863/9328288939_62386a3a16_m.jpg" alt="http://farm3.staticflickr.com/2863/9328288939_62386a3a16_m.jpg"/></span></a><br/>Sorry, I have no idea what it means, I just pressed the button and moved to router&#039;s main screen:<br/><a href="http://www.flickr.com/photos/otitov/9331084272/"><span class="postimg"><img src="http://farm4.staticflickr.com/3681/9331084272_19fa0aa25c_m.jpg" alt="http://farm4.staticflickr.com/3681/9331084272_19fa0aa25c_m.jpg"/></span></a><br/>From this screen I can see following interesting information:<br/></p><div class="codebox"><pre><code>3.15.1 Build 130517 Rel. 51827n
TL-MR13U v1 00000000</code></pre></div><p>I assume that first line gives us information about firmware used and the second one - about hardware revision we have.</p><p>Taking steps to last item in the left column, and then selecting third item from top of the new list you reach firmware upgrade page (you can try to navigate to <a href="http://192.168.1.1/SoftwareUpgradeRpm.htm).">http://192.168.1.1/SoftwareUpgradeRpm.htm).</a> Click on the button on the right of the input field, select firmware image &quot;openwrt-ar71xx-generic-tl-mr13u-v1-squashfs-factory.bin&quot; (the <strong>factory</strong> component in name is important) and press the button lower on the left. This will start the file upload to the router and you will advance to this screen:<br/><a href="http://www.flickr.com/photos/otitov/9331084560/"><span class="postimg"><img src="http://farm8.staticflickr.com/7399/9331084560_c36c192590_m.jpg" alt="http://farm8.staticflickr.com/7399/9331084560_c36c192590_m.jpg"/></span></a><br/>You will see it for some time without any change as the file uploads to router. As soon as upload had finished you will advance to this screen:<br/><a href="http://www.flickr.com/photos/otitov/9331084502/"><span class="postimg"><img src="http://farm8.staticflickr.com/7319/9331084502_1c1318e791_m.jpg" alt="http://farm8.staticflickr.com/7319/9331084502_1c1318e791_m.jpg"/></span></a><br/>I assume that this progress bar show the flashing process progress. At some point you will loose wi-fi connection, I think in this moment the router reboots. As flashing finishes you will get this screen:<br/><a href="http://www.flickr.com/photos/otitov/9331084402/"><span class="postimg"><img src="http://farm4.staticflickr.com/3730/9331084402_bacbb5f903_m.jpg" alt="http://farm4.staticflickr.com/3730/9331084402_bacbb5f903_m.jpg"/></span></a><br/>And few moments later the browser will refresh the page and you will get &quot;Error 404&quot; as the OpenWRT is running now and wi-fi is disabled by default:<br/><a href="http://www.flickr.com/photos/otitov/9331084382/"><span class="postimg"><img src="http://farm6.staticflickr.com/5457/9331084382_67cf9d33d5_m.jpg" alt="http://farm6.staticflickr.com/5457/9331084382_67cf9d33d5_m.jpg"/></span></a></p><p>That&#039;s it. Your router now has the OpenWRT firmware, you need to connect by Ethernet cable, telnet to 192.168.1.1, run &quot;passwd&quot;, type twice your new root&#039;s password and exit. Now you should be able to connect by ssh and continue with router configuration. Probably you want to edit /etc/config/wireless and remove this line to get Wi-Fi working:<br/></p><div class="codebox"><pre><code># REMOVE THIS LINE TO ENABLE WIFI: 
option disabled 0</code></pre></div><p>To start wi-fi interface just run &quot;wifi&quot; on command line.</p><p>You also may find useful to instal LuCI for easy web-based configuration:<br/></p><div class="codebox"><pre><code>opkg update
opkg install luci
/etc/init.d/uhttpd enable
/etc/init.d/uhttpd start</code></pre></div><p>To transfer package files to router for further installation I use <em>scp</em>:<br/></p><div class="codebox"><pre><code>scp packagename.ipk root@192.168.1.1:/tmp/</code></pre></div>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 7 Aug 2013, 18:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207664">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						21 Jul 2013, 08:26					</div>
				</div>
				<div class="post-content content">
					<p>Got running kernel 3.10.1:<br/></p><div class="codebox"><pre><code>BusyBox v1.19.4 (2013-07-20 23:19:58 CDT) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (Bleeding Edge, r37485)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir.
  * 2 tsp. Creme de Cacao
 -----------------------------------------------------
root@OpenWrt:~# uname -a
Linux OpenWrt 3.10.1 #1 Sat Jul 20 23:29:35 CDT 2013 mips GNU/Linux
root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.1M    216.0K    936.0K  19% /
/dev/root                 1.8M      1.8M         0 100% /rom
tmpfs                    14.2M     48.0K     14.1M   0% /tmp
/dev/mtdblock3            1.1M    216.0K    936.0K  19% /overlay
overlayfs:/overlay        1.1M    216.0K    936.0K  19% /
tmpfs                   512.0K         0    512.0K   0% /dev
root@OpenWrt:~# </code></pre></div><p>:-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207997">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						25 Jul 2013, 04:31					</div>
				</div>
				<div class="post-content content">
					<p>They fixed MEGA so here comes build r37513 for TL-MR13U:</p><p>20130722 (Folder Link, 26.2 MB)<br/><a href="https://mega.co.nz/#F!9cR11QbY!VI31qn4__tsZrwmRAxF97Q">https://mega.co.nz/#F!9cR11QbY!VI31qn4__tsZrwmRAxF97Q</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208003">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						25 Jul 2013, 06:00					</div>
				</div>
				<div class="post-content content">
					<p>thanks for the update @otlabs.</p><p>I would also love to see a patch for AA 12.09 r36088.</p><p>My MR13U is on the way!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208004">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						25 Jul 2013, 06:09					</div>
				</div>
				<div class="post-content content">
					<p>You are very welcome @grayman4hire! Thank you for testing. My roadmap is following - I am waiting for acceptance of the patch for TL-MR10U unit in main trunk, ASAP it gets accepted I will submit a patch for TL-MR13U and right after that I will do my best to add support for TL-13U in AA. Hope your MR13U will arrive in one week, maybe I will have an AA patch that time ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208030">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						25 Jul 2013, 13:13					</div>
				</div>
				<div class="post-content content">
					<p>You can also take a look of this<br/><a href="http://www.yoobao.com/en/product.asp?b_id=143&amp;m_id=215&amp;a_id=739">http://www.yoobao.com/en/product.asp?b_ … p;a_id=739</a></p><p>I think it is tl-wr703 inside.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208098">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						26 Jul 2013, 00:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>johan666 wrote:</cite><blockquote><p>You can also take a look of this<br/><a href="http://www.yoobao.com/en/product.asp?b_id=143&amp;m_id=215&amp;a_id=739">http://www.yoobao.com/en/product.asp?b_ … p;a_id=739</a></p><p>I think it is tl-wr703 inside.</p></blockquote></div><p>That router has a built in flashlight! Too funny. Is it a Cree?</p>											<p class="post-edited">(Last edited by <strong>grayman4hire</strong> on 26 Jul 2013, 00:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208130">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						26 Jul 2013, 10:11					</div>
				</div>
				<div class="post-content content">
					<p>Nowadays most of those external battery also include &quot;light&quot;.<br/>And that LED light can last for over hundreds of hours !<br/>(that one claimed that able to light up for 380hrs)<br/>It is quite useful !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208206">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						26 Jul 2013, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>I made some final changes to patch, now it applies against current trunk (r37561). So far latest firmware based on trunk runs fine so I submitted this patch to openwrt-devel list. Here comes the latest version of the patch:<br/></p><div class="codebox"><pre><code>diff --git a/target/linux/ar71xx/base-files/etc/diag.sh b/target/linux/ar71xx/base-files/etc/diag.sh
index 56e87b1..0bad4e4 100755
--- a/target/linux/ar71xx/base-files/etc/diag.sh
+++ b/target/linux/ar71xx/base-files/etc/diag.sh
@@ -134,6 +134,7 @@ get_status_led() {
         ;;
     archer-c7 | \
     tl-mr10u | \
+    tl-mr13u | \
     tl-wdr4300 | \
     tl-wr703n | \
     tl-wr720n-v3)
diff --git a/target/linux/ar71xx/base-files/etc/uci-defaults/02_network b/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
index 05b4566..883ac8c 100755
--- a/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
+++ b/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
@@ -211,6 +211,7 @@ mr600v2 |\
 rb-411 |\
 tl-mr10u |\
 tl-mr11u |\
+tl-mr13u |\
 tl-mr3020 |\
 tl-mr3040 |\
 tl-wa901nd |\
diff --git a/target/linux/ar71xx/base-files/lib/ar71xx.sh b/target/linux/ar71xx/base-files/lib/ar71xx.sh
index bb96f63..b657a85 100755
--- a/target/linux/ar71xx/base-files/lib/ar71xx.sh
+++ b/target/linux/ar71xx/base-files/lib/ar71xx.sh
@@ -138,6 +138,9 @@ tplink_board_detect() {
     &quot;001101&quot;*)
         model=&quot;TP-Link TL-MR11U&quot;
         ;;
+    &quot;001301&quot;*)
+        model=&quot;TP-Link TL-MR13U&quot;
+        ;;
     &quot;302000&quot;*)
         model=&quot;TP-Link TL-MR3020&quot;
         ;;
@@ -456,6 +459,9 @@ ar71xx_board_detect() {
     *&quot;TL-MR11U&quot;)
         name=&quot;tl-mr11u&quot;
         ;;
+    *&quot;TL-MR13U&quot;)
+        name=&quot;tl-mr13u&quot;
+        ;;
     *UniFi)
         name=&quot;unifi&quot;
         ;;
diff --git a/target/linux/ar71xx/base-files/lib/upgrade/platform.sh b/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
index c57e5d5..6370a6c 100755
--- a/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
+++ b/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
@@ -159,6 +159,7 @@ platform_check_image() {
     archer-c7 | \
     tl-mr10u | \
     tl-mr11u | \
+    tl-mr13u | \
     tl-mr3020 | \
     tl-mr3040 | \
     tl-mr3220 | \
diff --git a/target/linux/ar71xx/config-3.10 b/target/linux/ar71xx/config-3.10
index 8695bad..0b52737 100644
--- a/target/linux/ar71xx/config-3.10
+++ b/target/linux/ar71xx/config-3.10
@@ -64,6 +64,7 @@ CONFIG_ATH79_MACH_TEW_632BRP=y
 CONFIG_ATH79_MACH_TEW_673GRU=y
 CONFIG_ATH79_MACH_TEW_712BR=y
 CONFIG_ATH79_MACH_TL_MR11U=y
+CONFIG_ATH79_MACH_TL_MR13U=y
 CONFIG_ATH79_MACH_TL_MR3020=y
 CONFIG_ATH79_MACH_TL_MR3X20=y
 CONFIG_ATH79_MACH_TL_WA901ND=y
diff --git a/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c b/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
new file mode 100644
index 0000000..8b03645
--- /dev/null
+++ b/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
@@ -0,0 +1,107 @@
+/*
+ *  TP-LINK TL-MR13U board support
+ *
+ *  Copyright (C) 2011 dongyuqi &lt;729650915@qq.com&gt;
+ *  Copyright (C) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;
+ *
+ *  This program is free software; you can redistribute it and/or modify it
+ *  under the terms of the GNU General Public License version 2 as published
+ *  by the Free Software Foundation.
+ */
+
+#include &lt;linux/gpio.h&gt;
+
+#include &lt;asm/mach-ath79/ath79.h&gt;
+
+#include &quot;dev-eth.h&quot;
+#include &quot;dev-gpio-buttons.h&quot;
+#include &quot;dev-leds-gpio.h&quot;
+#include &quot;dev-m25p80.h&quot;
+#include &quot;dev-usb.h&quot;
+#include &quot;dev-wmac.h&quot;
+#include &quot;machtypes.h&quot;
+
+#define TL_MR13U_GPIO_LED_SYSTEM    27
+
+#define TL_MR13U_GPIO_BTN_RESET        11
+#define TL_MR13U_GPIO_BTN_SW1        6
+#define TL_MR13U_GPIO_BTN_SW2        7
+
+#define TL_MR13U_GPIO_USB_POWER        18
+
+#define TL_MR13U_KEYS_POLL_INTERVAL    20    /* msecs */
+#define TL_MR13U_KEYS_DEBOUNCE_INTERVAL    (3 * TL_MR13U_KEYS_POLL_INTERVAL)
+
+static const char *tl_mr13u_part_probes[] = {
+    &quot;tp-link&quot;,
+    NULL,
+};
+
+static struct flash_platform_data tl_mr13u_flash_data = {
+    .part_probes    = tl_mr13u_part_probes,
+};
+
+static struct gpio_led tl_mr13u_leds_gpio[] __initdata = {
+    {
+        .name        = &quot;tp-link:blue:system&quot;,
+        .gpio        = TL_MR13U_GPIO_LED_SYSTEM,
+        .active_low    = 1,
+    },
+};
+
+static struct gpio_keys_button tl_mr13u_gpio_keys[] __initdata = {
+    {
+        .desc        = &quot;reset&quot;,
+        .type        = EV_KEY,
+        .code        = KEY_RESTART,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_RESET,
+        .active_low    = 0,
+    },
+    {
+        .desc        = &quot;sw1&quot;,
+        .type        = EV_KEY,
+        .code        = BTN_0,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_SW1,
+        .active_low    = 0,
+    },
+    {
+        .desc        = &quot;sw2&quot;,
+        .type        = EV_KEY,
+        .code        = BTN_1,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_SW2,
+        .active_low    = 0,
+    },
+};
+
+static void __init tl_mr13u_setup(void)
+{
+    u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);
+    u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);
+
+    /* disable PHY_SWAP and PHY_ADDR_SWAP bits */
+    ath79_setup_ar933x_phy4_switch(false, false);
+
+    ath79_register_m25p80(&amp;tl_mr13u_flash_data);
+    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_mr13u_leds_gpio),
+                 tl_mr13u_leds_gpio);
+    ath79_register_gpio_keys_polled(-1, TL_MR13U_KEYS_POLL_INTERVAL,
+                    ARRAY_SIZE(tl_mr13u_gpio_keys),
+                    tl_mr13u_gpio_keys);
+
+    gpio_request_one(TL_MR13U_GPIO_USB_POWER,
+             GPIOF_OUT_INIT_HIGH | GPIOF_EXPORT_DIR_FIXED,
+             &quot;USB power&quot;);
+    ath79_register_usb();
+
+    ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+
+    ath79_register_mdio(0, 0x0);
+    ath79_register_eth(0);
+    ath79_register_wmac(ee, mac);
+}
+
+MIPS_MACHINE(ATH79_MACH_TL_MR13U, &quot;TL-MR13U&quot;, &quot;TP-LINK TL-MR13U v1&quot;,
+         tl_mr13u_setup);
diff --git a/target/linux/ar71xx/generic/profiles/tp-link.mk b/target/linux/ar71xx/generic/profiles/tp-link.mk
index 30e2b9c..634d94f 100644
--- a/target/linux/ar71xx/generic/profiles/tp-link.mk
+++ b/target/linux/ar71xx/generic/profiles/tp-link.mk
@@ -38,6 +38,17 @@ endef
 $(eval $(call Profile,TLMR11U))
 
 
+define Profile/TLMR13U
+    NAME:=TP-LINK TL-MR13U
+    PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
+endef
+
+define Profile/TLMR13U/Description
+    Package set optimized for the TP-LINK TL-MR13U.
+endef
+$(eval $(call Profile,TLMR13U))
+
+
 define Profile/TLMR3020
     NAME:=TP-LINK TL-MR3020
     PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
diff --git a/target/linux/ar71xx/image/Makefile b/target/linux/ar71xx/image/Makefile
index ceb0d0a..743e47f 100644
--- a/target/linux/ar71xx/image/Makefile
+++ b/target/linux/ar71xx/image/Makefile
@@ -973,6 +973,7 @@ $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),ARCHERC7,archer-c7-v1,ARCHE
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR10U,tl-mr10u-v1,TL-MR10U,ttyATH0,115200,0x00100101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR11UV1,tl-mr11u-v1,TL-MR11U,ttyATH0,115200,0x00110101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR11UV2,tl-mr11u-v2,TL-MR11U,ttyATH0,115200,0x00110102,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR13U,tl-mr13u-v1,TL-MR13U,ttyATH0,115200,0x00130101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-MR3220-v2,ttyATH0,115200,0x32200002,1,4Mlzma))
diff --git a/target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch b/target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch
new file mode 100644
index 0000000..76891c5
--- /dev/null
+++ b/target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch
@@ -0,0 +1,39 @@
+--- a/arch/mips/ath79/Kconfig
++++ b/arch/mips/ath79/Kconfig
+@@ -516,6 +516,16 @@ config ATH79_MACH_TL_MR11U
+     select ATH79_DEV_USB
+     select ATH79_DEV_WMAC
+ 
++config ATH79_MACH_TL_MR13U
++    bool &quot;TP-LINK TL-MR13U support&quot;
++    select SOC_AR933X
++    select ATH79_DEV_ETH
++    select ATH79_DEV_GPIO_BUTTONS
++    select ATH79_DEV_LEDS_GPIO
++    select ATH79_DEV_M25P80
++    select ATH79_DEV_USB
++    select ATH79_DEV_WMAC
++
+ config ATH79_MACH_TL_MR3020
+     bool &quot;TP-LINK TL-MR3020 support&quot;
+     select SOC_AR933X
+--- a/arch/mips/ath79/machtypes.h
++++ b/arch/mips/ath79/machtypes.h
+@@ -83,6 +83,7 @@ enum ath79_mach_type {
+     ATH79_MACH_TEW_712BR,        /* TRENDnet TEW-712BR */
+     ATH79_MACH_TL_MR10U,        /* TP-LINK TL-MR10U */
+     ATH79_MACH_TL_MR11U,        /* TP-LINK TL-MR11U */
++    ATH79_MACH_TL_MR13U,        /* TP-LINK TL-MR13U */
+     ATH79_MACH_TL_MR3020,        /* TP-LINK TL-MR3020 */
+     ATH79_MACH_TL_MR3040,        /* TP-LINK TL-MR3040 */
+     ATH79_MACH_TL_MR3220,        /* TP-LINK TL-MR3220 */
+--- a/arch/mips/ath79/Makefile
++++ b/arch/mips/ath79/Makefile
+@@ -79,6 +79,7 @@ obj-$(CONFIG_ATH79_MACH_TEW_632BRP)    += m
+ obj-$(CONFIG_ATH79_MACH_TEW_673GRU)    += mach-tew-673gru.o
+ obj-$(CONFIG_ATH79_MACH_TEW_712BR)    += mach-tew-712br.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR11U)    += mach-tl-mr11u.o
++obj-$(CONFIG_ATH79_MACH_TL_MR13U)    += mach-tl-mr13u.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR3020)    += mach-tl-mr3020.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR3X20)    += mach-tl-mr3x20.o
+ obj-$(CONFIG_ATH79_MACH_TL_WA901ND)    += mach-tl-wa901nd.o
diff --git a/tools/firmware-utils/src/mktplinkfw.c b/tools/firmware-utils/src/mktplinkfw.c
index 19dc2b4..2574678 100644
--- a/tools/firmware-utils/src/mktplinkfw.c
+++ b/tools/firmware-utils/src/mktplinkfw.c
@@ -31,6 +31,7 @@
 
 #define HEADER_VERSION_V1    0x01000000
 #define HWID_TL_MR10U_V1    0x00100101
+#define HWID_TL_MR13U_V1    0x00130101
 #define HWID_TL_MR3020_V1    0x30200001
 #define HWID_TL_MR3220_V1    0x32200001
 #define HWID_TL_MR3220_V2    0x32200002
@@ -199,6 +200,11 @@ static struct board_info boards[] = {
         .hw_rev        = 1,
         .layout_id    = &quot;4Mlzma&quot;,
     }, {
+        .id        = &quot;TL-MR13Uv1&quot;,
+        .hw_id        = HWID_TL_MR13U_V1,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-MR3020v1&quot;,
         .hw_id        = HWID_TL_MR3020_V1,
         .hw_rev        = 1,</code></pre></div><p>These image files are good for &quot;long time use&quot; as they use latest kerner 3.10.3 so you can install all kernel modules and other packages from snapshot repository, e.g. right from opkg managed or LuCI:</p><p>20130726 (Folder Link, 26.2 MB)<br/><a href="https://mega.co.nz/#F!wQwmSK4D!PcfV-CdEDawlAps9BIYstw">https://mega.co.nz/#F!wQwmSK4D!PcfV-CdEDawlAps9BIYstw</a></p><p>Some screenshots:<br/></p><div class="codebox"><pre><code>BusyBox v1.19.4 (2013-07-26 11:38:41 CDT) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (Bleeding Edge, r37561)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir.
  * 2 tsp. Creme de Cacao
 -----------------------------------------------------
root@OpenWrt:~# free
             total         used         free       shared      buffers
Mem:         29068        17308        11760            0         1496
-/+ buffers:              15812        13256
Swap:            0            0            0
root@OpenWrt:~# uname -a
Linux OpenWrt 3.10.3 #1 Fri Jul 26 11:48:32 CDT 2013 mips GNU/Linux
root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.1M    208.0K    944.0K  18% /
/dev/root                 1.8M      1.8M         0 100% /rom
tmpfs                    14.2M     52.0K     14.1M   0% /tmp
tmpfs                    14.2M     28.0K     14.2M   0% /tmp/root
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/mtdblock3            1.1M    208.0K    944.0K  18% /overlay
overlayfs:/overlay        1.1M    208.0K    944.0K  18% /</code></pre></div><p>UPDATE: the patch is corrected now - I have changed 130101 to 001301.</p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 7 Aug 2013, 05:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208954">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">jmac928</div>
					<div class="post-datetime">
						4 Aug 2013, 17:38					</div>
				</div>
				<div class="post-content content">
					<p>@slboat opened the TL-MR13U and took nice pictures!<br/><a href="https://forum.openwrt.org/viewtopic.php?pid=208953#p208953">https://forum.openwrt.org/viewtopic.php … 53#p208953</a></p>											<p class="post-edited">(Last edited by <strong>jmac928</strong> on 4 Aug 2013, 21:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208957">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						4 Aug 2013, 18:20					</div>
				</div>
				<div class="post-content content">
					<p>@jamc928, thank you for the link! It would be better to use <a href="https://forum.openwrt.org/viewtopic.php?id=45631">https://forum.openwrt.org/viewtopic.php?id=45631</a> and provide short descruiption about what we will find following this link, something like:</p><p>@slboat opened the TL-MR13U and took nice pictures!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208963">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						4 Aug 2013, 18:49					</div>
				</div>
				<div class="post-content content">
					<p>I made a mistake in my patch, Cezary Jackiewicz was so kind to comment me about it - we need to use &quot;001301&quot;*) in <em>./target/linux/ar71xx/base-files/lib/ar71xx.sh</em>. Please, take this into account.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208975">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">jmac928</div>
					<div class="post-datetime">
						4 Aug 2013, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>thank you otlabs i fixed</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209067">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						6 Aug 2013, 02:09					</div>
				</div>
				<div class="post-content content">
					<p>My MR-13U came this Saturday, but no one was around to sign for the registered mail (of all days they had to come on a Saturday). Of course, my wife can&#039;t find the notice they left, so now I&#039;m trying to figure out what post office to pick it up from.</p><p>Anyways...any status on the AA patch?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209073">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						6 Aug 2013, 03:34					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, no AA patch yet - I am still waiting for any response on patch submitted to openwrt-devel list.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209161">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						7 Aug 2013, 05:33					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the update and no problem @otlabs.</p><p>Just got my MR13U!</p><p>How do I go about building my own firmware image using the patch you provided above?</p><div class="codebox"><pre><code>cd ~
mkdir mr13u
cd mr13u
svn co -r 37561 svn://svn.openwrt.org/openwrt/trunk
#cut/paste the content of your patch above into mr13u.37561.patch
patch -p1&lt; mr13u.37561.patch
make menuconfig
#select mr13u</code></pre></div><p>Just want to make sure I got it right. From @slboat pictures (thank you so much!) I would hate to have open it up to recover.</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209162">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						7 Aug 2013, 05:51					</div>
				</div>
				<div class="post-content content">
					<p>There is no need to checkout r37561, this patch should cleanly apply on top of latest r37734 (I just checked).</p><p>Yes, all steps are correct, if you get any complains from patch - publish them here.</p><p>IMPORTANT: do not forget to change 130101 -&gt; 001301 as it stated in msg #38!</p><p>UPDATE: I have corrected the patch in msg #35, you can just copy from there.</p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 7 Aug 2013, 18:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209163">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						7 Aug 2013, 06:31					</div>
				</div>
				<div class="post-content content">
					<p>Thanks @otlabs!</p><p>Call me paranoid, but I&#039;m going to stick with r37561 since its been tested by you <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>I copied your patch to my dropbox to make it easier to pull down. Here is what I&#039;m running:</p><div class="codebox"><pre><code>cd ~
mkdir mr13u
cd mr13u
svn co -r 37561 svn://svn.openwrt.org/openwrt/trunk
cd trunk
wget http://dl.dropbox.com/u/42238/openwrt/mr13u/mr13u.patch
patch -p1&lt; mr13u.patch</code></pre></div><p>What am I doing wrong? Can&#039;t image those FAILED messages are normal.</p><div class="codebox"><pre><code>user@ubuntu:~/mr13u/trunk$ patch -p1&lt; mr13u.patch
patching file target/linux/ar71xx/base-files/etc/diag.sh
Hunk #1 FAILED at 134.
1 out of 1 hunk FAILED -- saving rejects to file target/linux/ar71xx/base-files/etc/diag.sh.rej
patching file target/linux/ar71xx/base-files/etc/uci-defaults/02_network
patching file target/linux/ar71xx/base-files/lib/ar71xx.sh
Hunk #1 FAILED at 138.
Hunk #2 FAILED at 456.
2 out of 2 hunks FAILED -- saving rejects to file target/linux/ar71xx/base-files/lib/ar71xx.sh.rej
patching file target/linux/ar71xx/base-files/lib/upgrade/platform.sh
Hunk #1 FAILED at 159.
1 out of 1 hunk FAILED -- saving rejects to file target/linux/ar71xx/base-files/lib/upgrade/platform.sh.rej
patching file target/linux/ar71xx/config-3.10
patching file target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
patching file target/linux/ar71xx/generic/profiles/tp-link.mk
Hunk #1 succeeded at 38 with fuzz 2.
patching file target/linux/ar71xx/image/Makefile
patching file target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch
patching file tools/firmware-utils/src/mktplinkfw.c
Hunk #1 FAILED at 31.
Hunk #2 FAILED at 199.
2 out of 2 hunks FAILED -- saving rejects to file tools/firmware-utils/src/mktplinkfw.c.rej
user@ubuntu:~/mr13u/trunk$</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209164">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						7 Aug 2013, 06:39					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s not so bad idea to use r37561 ;-) Trunk is so unstable.</p><p>If you copied the patch from this message board you can get some problems with white spaces, e.g. tabs were changed to 8 spaces. I assume that&#039;s the problem.</p><p>Do you know an option for patch to ignore whitespaces?</p><p>I am unable to attach any file to my messages here. Can you download the patch from MEGA?</p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 7 Aug 2013, 06:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209167">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						7 Aug 2013, 07:09					</div>
				</div>
				<div class="post-content content">
					<p>Yeah, I&#039;ll give that a try. Thanks</p><p>[Edit] - That was it. I used the patch file from mega (with the minor correction you noted in post 38) and all is good now.</p><div class="codebox"><pre><code>patching file target/linux/ar71xx/base-files/etc/diag.sh
patching file target/linux/ar71xx/base-files/etc/uci-defaults/02_network
patching file target/linux/ar71xx/base-files/lib/ar71xx.sh
patching file target/linux/ar71xx/base-files/lib/upgrade/platform.sh
patching file target/linux/ar71xx/config-3.10
patching file target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
patching file target/linux/ar71xx/generic/profiles/tp-link.mk
patching file target/linux/ar71xx/image/Makefile
patching file target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch
patching file tools/firmware-utils/src/mktplinkfw.c</code></pre></div><p>Thank you again.</p>											<p class="post-edited">(Last edited by <strong>grayman4hire</strong> on 7 Aug 2013, 07:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209173">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">miguipda</div>
					<div class="post-datetime">
						7 Aug 2013, 14:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>does somebody know how could we use it with a solar panel charger ?<br/><a href="https://forum.openwrt.org/viewtopic.php?id=45680">https://forum.openwrt.org/viewtopic.php?id=45680</a></p><p>Which panel must we use and which charger control must we use to have it as an autonomous router ?</p><p>Sincerely thanks and have a nice day,</p><p>Miguipda ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209188">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						7 Aug 2013, 17:59					</div>
				</div>
				<div class="post-content content">
					<p>@grayman4hire: Great! You are welcome!</p><p>@miguipda: great start on so important topic of solar energy for autonomous routers! Keep researching and sharing your results! It&#039;s my huge dream to put MR13U on solar only power supply (and MR10U with built-in webcam).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209220">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						8 Aug 2013, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>Christmas comes early this year. Especially for @grayman4hire ;-)</p><p>This patch brings support for TP-Link TL-MR13U in Attitude Adjustment 12.09 (r37729, latest release for AA):<br/></p><div class="codebox"><pre><code>diff --git a/target/linux/ar71xx/base-files/etc/diag.sh b/target/linux/ar71xx/base-files/etc/diag.sh
index 416322d..7590414 100755
--- a/target/linux/ar71xx/base-files/etc/diag.sh
+++ b/target/linux/ar71xx/base-files/etc/diag.sh
@@ -139,6 +139,7 @@ get_status_led() {
     tl-wr941nd)
         status_led=&quot;tp-link:green:system&quot;
         ;;
+    tl-mr13u | \
     tl-wdr4300 | \
     tl-wr703n)
         status_led=&quot;tp-link:blue:system&quot;
diff --git a/target/linux/ar71xx/base-files/etc/uci-defaults/network b/target/linux/ar71xx/base-files/etc/uci-defaults/network
index 7fa219d..6daf568 100755
--- a/target/linux/ar71xx/base-files/etc/uci-defaults/network
+++ b/target/linux/ar71xx/base-files/etc/uci-defaults/network
@@ -154,6 +154,7 @@ eap7660d |\
 mr600 |\
 rb-411 |\
 tl-mr11u |\
+tl-mr13u |\
 tl-mr3020 |\
 tl-mr3040 |\
 tl-wa901nd |\
diff --git a/target/linux/ar71xx/base-files/lib/ar71xx.sh b/target/linux/ar71xx/base-files/lib/ar71xx.sh
index 2bc8194..ed3b33e 100755
--- a/target/linux/ar71xx/base-files/lib/ar71xx.sh
+++ b/target/linux/ar71xx/base-files/lib/ar71xx.sh
@@ -111,6 +111,9 @@ tplink_board_detect() {
     &quot;110101&quot;*)
         model=&quot;TP-Link TL-MR11U&quot;
         ;;
+    &quot;001301&quot;*)
+        model=&quot;TP-Link TL-MR13U&quot;
+        ;;
     &quot;302000&quot;*)
         model=&quot;TP-Link TL-MR3020&quot;
         ;;
@@ -384,6 +387,9 @@ ar71xx_board_detect() {
     *&quot;TL-MR11U&quot;)
         name=&quot;tl-mr11u&quot;
         ;;
+    *&quot;TL-MR13U&quot;)
+        name=&quot;tl-mr13u&quot;
+        ;;
     *UniFi)
         name=&quot;unifi&quot;
         ;;
diff --git a/target/linux/ar71xx/base-files/lib/upgrade/platform.sh b/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
index 49b1de9..c105318 100755
--- a/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
+++ b/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
@@ -148,6 +148,7 @@ platform_check_image() {
         return 1
         ;;
     tl-mr11u | \
+    tl-mr13u | \
     tl-mr3020 | \
     tl-mr3040 | \
     tl-mr3220 | \
diff --git a/target/linux/ar71xx/config-3.3 b/target/linux/ar71xx/config-3.3
index 446f202..ff1db6a 100644
--- a/target/linux/ar71xx/config-3.3
+++ b/target/linux/ar71xx/config-3.3
@@ -56,6 +56,7 @@ CONFIG_ATH79_MACH_TEW_632BRP=y
 CONFIG_ATH79_MACH_TEW_673GRU=y
 CONFIG_ATH79_MACH_TEW_712BR=y
 CONFIG_ATH79_MACH_TL_MR11U=y
+CONFIG_ATH79_MACH_TL_MR13U=y
 CONFIG_ATH79_MACH_TL_MR3020=y
 CONFIG_ATH79_MACH_TL_MR3X20=y
 CONFIG_ATH79_MACH_TL_WA901ND=y
diff --git a/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c b/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
new file mode 100644
index 0000000..8b03645
--- /dev/null
+++ b/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
@@ -0,0 +1,107 @@
+/*
+ *  TP-LINK TL-MR13U board support
+ *
+ *  Copyright (C) 2011 dongyuqi &lt;729650915@qq.com&gt;
+ *  Copyright (C) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;
+ *
+ *  This program is free software; you can redistribute it and/or modify it
+ *  under the terms of the GNU General Public License version 2 as published
+ *  by the Free Software Foundation.
+ */
+
+#include &lt;linux/gpio.h&gt;
+
+#include &lt;asm/mach-ath79/ath79.h&gt;
+
+#include &quot;dev-eth.h&quot;
+#include &quot;dev-gpio-buttons.h&quot;
+#include &quot;dev-leds-gpio.h&quot;
+#include &quot;dev-m25p80.h&quot;
+#include &quot;dev-usb.h&quot;
+#include &quot;dev-wmac.h&quot;
+#include &quot;machtypes.h&quot;
+
+#define TL_MR13U_GPIO_LED_SYSTEM    27
+
+#define TL_MR13U_GPIO_BTN_RESET        11
+#define TL_MR13U_GPIO_BTN_SW1        6
+#define TL_MR13U_GPIO_BTN_SW2        7
+
+#define TL_MR13U_GPIO_USB_POWER        18
+
+#define TL_MR13U_KEYS_POLL_INTERVAL    20    /* msecs */
+#define TL_MR13U_KEYS_DEBOUNCE_INTERVAL    (3 * TL_MR13U_KEYS_POLL_INTERVAL)
+
+static const char *tl_mr13u_part_probes[] = {
+    &quot;tp-link&quot;,
+    NULL,
+};
+
+static struct flash_platform_data tl_mr13u_flash_data = {
+    .part_probes    = tl_mr13u_part_probes,
+};
+
+static struct gpio_led tl_mr13u_leds_gpio[] __initdata = {
+    {
+        .name        = &quot;tp-link:blue:system&quot;,
+        .gpio        = TL_MR13U_GPIO_LED_SYSTEM,
+        .active_low    = 1,
+    },
+};
+
+static struct gpio_keys_button tl_mr13u_gpio_keys[] __initdata = {
+    {
+        .desc        = &quot;reset&quot;,
+        .type        = EV_KEY,
+        .code        = KEY_RESTART,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_RESET,
+        .active_low    = 0,
+    },
+    {
+        .desc        = &quot;sw1&quot;,
+        .type        = EV_KEY,
+        .code        = BTN_0,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_SW1,
+        .active_low    = 0,
+    },
+    {
+        .desc        = &quot;sw2&quot;,
+        .type        = EV_KEY,
+        .code        = BTN_1,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_SW2,
+        .active_low    = 0,
+    },
+};
+
+static void __init tl_mr13u_setup(void)
+{
+    u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);
+    u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);
+
+    /* disable PHY_SWAP and PHY_ADDR_SWAP bits */
+    ath79_setup_ar933x_phy4_switch(false, false);
+
+    ath79_register_m25p80(&amp;tl_mr13u_flash_data);
+    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_mr13u_leds_gpio),
+                 tl_mr13u_leds_gpio);
+    ath79_register_gpio_keys_polled(-1, TL_MR13U_KEYS_POLL_INTERVAL,
+                    ARRAY_SIZE(tl_mr13u_gpio_keys),
+                    tl_mr13u_gpio_keys);
+
+    gpio_request_one(TL_MR13U_GPIO_USB_POWER,
+             GPIOF_OUT_INIT_HIGH | GPIOF_EXPORT_DIR_FIXED,
+             &quot;USB power&quot;);
+    ath79_register_usb();
+
+    ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+
+    ath79_register_mdio(0, 0x0);
+    ath79_register_eth(0);
+    ath79_register_wmac(ee, mac);
+}
+
+MIPS_MACHINE(ATH79_MACH_TL_MR13U, &quot;TL-MR13U&quot;, &quot;TP-LINK TL-MR13U v1&quot;,
+         tl_mr13u_setup);
diff --git a/target/linux/ar71xx/generic/profiles/tp-link.mk b/target/linux/ar71xx/generic/profiles/tp-link.mk
index 07d7059..34c7933 100644
--- a/target/linux/ar71xx/generic/profiles/tp-link.mk
+++ b/target/linux/ar71xx/generic/profiles/tp-link.mk
@@ -16,6 +16,17 @@ endef
 $(eval $(call Profile,TLMR11U))
 
 
+define Profile/TLMR13U
+    NAME:=TP-LINK TL-MR13U
+    PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
+endef
+
+define Profile/TLMR13U/Description
+    Package set optimized for the TP-LINK TL-MR13U.
+endef
+$(eval $(call Profile,TLMR13U))
+
+
 define Profile/TLMR3020
     NAME:=TP-LINK TL-MR3020
     PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
diff --git a/target/linux/ar71xx/image/Makefile b/target/linux/ar71xx/image/Makefile
index 9ebe486..5206b9b 100644
--- a/target/linux/ar71xx/image/Makefile
+++ b/target/linux/ar71xx/image/Makefile
@@ -873,6 +873,7 @@ $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR941NV4,tl-wr941nd-v4,TL-WR74
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR1043,tl-wr1043nd-v1,TL-WR1043ND,ttyS0,115200,0x10430001,1,8M))
 
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR11U,tl-mr11u-v1,TL-MR11U,ttyATH0,115200,0x00110101,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR13U,tl-mr13u-v1,TL-MR13U,ttyATH0,115200,0x00130101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR703,tl-wr703n-v1,TL-WR703N,ttyATH0,115200,0x07030101,1,4Mlzma))
diff --git a/target/linux/ar71xx/patches-3.3/930-add-tl-mr13u-support.patch b/target/linux/ar71xx/patches-3.3/930-add-tl-mr13u-support.patch
new file mode 100644
index 0000000..2daf6cd
--- /dev/null
+++ b/target/linux/ar71xx/patches-3.3/930-add-tl-mr13u-support.patch
@@ -0,0 +1,39 @@
+--- a/arch/mips/ath79/Kconfig
++++ b/arch/mips/ath79/Kconfig
+@@ -441,6 +441,16 @@ config ATH79_MACH_TL_MR11U
+     select ATH79_DEV_USB
+     select ATH79_DEV_WMAC
+ 
++config ATH79_MACH_TL_MR13U
++    bool &quot;TP-LINK TL-MR13U support&quot;
++    select SOC_AR933X
++    select ATH79_DEV_ETH
++    select ATH79_DEV_GPIO_BUTTONS
++    select ATH79_DEV_LEDS_GPIO
++    select ATH79_DEV_M25P80
++    select ATH79_DEV_USB
++    select ATH79_DEV_WMAC
++
+ config ATH79_MACH_TL_MR3020
+     bool &quot;TP-LINK TL-MR3020 support&quot;
+     select SOC_AR933X
+--- a/arch/mips/ath79/Makefile
++++ b/arch/mips/ath79/Makefile
+@@ -75,6 +75,7 @@ obj-$(CONFIG_ATH79_MACH_TEW_632BRP)    += m
+ obj-$(CONFIG_ATH79_MACH_TEW_673GRU)    += mach-tew-673gru.o
+ obj-$(CONFIG_ATH79_MACH_TEW_712BR)    += mach-tew-712br.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR11U)    += mach-tl-mr11u.o
++obj-$(CONFIG_ATH79_MACH_TL_MR13U)    += mach-tl-mr13u.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR3020)    += mach-tl-mr3020.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR3X20)    += mach-tl-mr3x20.o
+ obj-$(CONFIG_ATH79_MACH_TL_WA901ND)    += mach-tl-wa901nd.o
+--- a/arch/mips/ath79/machtypes.h
++++ b/arch/mips/ath79/machtypes.h
+@@ -72,6 +72,7 @@ enum ath79_mach_type {
+     ATH79_MACH_TEW_673GRU,        /* TRENDnet TEW-673GRU */
+     ATH79_MACH_TEW_712BR,        /* TRENDnet TEW-712BR */
+     ATH79_MACH_TL_MR11U,        /* TP-LINK TL-MR11U */
++    ATH79_MACH_TL_MR13U,        /* TP-LINK TL-MR13U */
+     ATH79_MACH_TL_MR3020,        /* TP-LINK TL-MR3020 */
+     ATH79_MACH_TL_MR3040,        /* TP-LINK TL-MR3040 */
+     ATH79_MACH_TL_MR3220,        /* TP-LINK TL-MR3220 */
diff --git a/tools/firmware-utils/src/mktplinkfw.c b/tools/firmware-utils/src/mktplinkfw.c
index 2be6335..595e6f9 100644
--- a/tools/firmware-utils/src/mktplinkfw.c
+++ b/tools/firmware-utils/src/mktplinkfw.c
@@ -30,6 +30,7 @@
 #define ALIGN(x,a) ({ typeof(a) __a = (a); (((x) + __a - 1) &amp; ~(__a - 1)); })
 
 #define HEADER_VERSION_V1    0x01000000
+#define HWID_TL_MR13U_V1    0x00130101
 #define HWID_TL_MR3020_V1    0x30200001
 #define HWID_TL_MR3220_V1    0x32200001
 #define HWID_TL_MR3420_V1    0x34200001
@@ -179,6 +180,11 @@ static struct flash_layout layouts[] = {
 
 static struct board_info boards[] = {
     {
+        .id        = &quot;TL-MR13Uv1&quot;,
+        .hw_id        = HWID_TL_MR13U_V1,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-MR3020v1&quot;,
         .hw_id        = HWID_TL_MR3020_V1,
         .hw_rev        = 1,</code></pre></div><p>You can get a patch file, firmware images and some packages from MEGA:</p><p>20130807 (Folder Link, 38.1 MiB)<br/><a href="https://mega.co.nz/#F!UVQmibwD!YYg-tmcyCaZpKtmAOpPsBA">https://mega.co.nz/#F!UVQmibwD!YYg-tmcyCaZpKtmAOpPsBA</a></p><p>WARNING: I had no time to test this build, so use it at your own risk (or wait till I get some time to test it).</p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 8 Aug 2013, 02:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209221">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">jmac928</div>
					<div class="post-datetime">
						8 Aug 2013, 02:27					</div>
				</div>
				<div class="post-content content">
					<p>Hello @miguipda<br/>Please check this forum , in this thread you could find your answer..</p><br/><p><a href="http://forum.daviddarts.com/read.php?2,7697">http://forum.daviddarts.com/read.php?2,7697</a></p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 5</div><nav><ul><li><a href="viewtopic.php%3Fid=44755&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=44755&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=5.html">5</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>