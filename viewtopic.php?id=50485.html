<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> firewall (?) problem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p232507">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">eric9873232</div>
					<div class="post-datetime">
						5 May 2014, 22:47					</div>
				</div>
				<div class="post-content content">
					<p>Hello, </p><p>Since yesterday, by router does not work correctly. Of course I played around. In particular I updated firewall. This may be the reason of my trouble, and may not. I have no idea how to debug this, any hints are welcome:</p><p>symptoms:&nbsp; I can<br />- still SSH to openwrt (barrier breaker) <br />- still do DNS lookups using the router <br />- get on internet ON the router (after ssh, traceroute <a href="http://www.google.com">www.google.com</a> will work on the router)</p><p>however, when connected either on wifi nor lan, packets that should be sent to the internet seem to &quot;hang&quot; on the router (traceroute will show a double line 192.168.2.1 and stop there).</p><p>Some configurations I use for some time:&nbsp; <br />/etc/config/network<br />&nbsp; &nbsp; &nbsp;- wan: static IP, fixed gateway (seems to work anyhow)<br />&nbsp; &nbsp; &nbsp;- two different zones for lan 192.168.1.x and wifi 192.168.2.x<br />/etc/config/firewall<br />&nbsp; &nbsp; &nbsp;- an extra wifi zone (input and&nbsp; output accept, forward reject)<br />&nbsp; &nbsp; &nbsp;- 4 forward rules: wifi&nbsp; &lt;-&gt; LAN and wifi -&gt; wan and lan -&gt; wan.</p><p>That had worked perfectly ... until yesterday. Can the error be somewhere else? How to Bugtrack that??</p><br /><p>Other possibility: I played around to turn off leds. May I have done some harm when sending <br />echo 0 &gt;&nbsp; /sys/.... /whatsover-containing-blue-or-green&nbsp; to find out which one controlls which? <br />I rebooted with power-off afterwards of course! </p><br /><p>Thanks, Eric</p><p>P.S:&nbsp; started to ask this question in the MSSFIX thread, but actually the subject has changed (it seems i best trun off mss clamping to get rid of logs). Since I hope for more attention under the right title I repost it. Sorry!</p>											<p class="post-edited">(Last edited by <strong>eric9873232</strong> on 5 May 2014, 23:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p232522">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						6 May 2014, 00:53					</div>
				</div>
				<div class="post-content content">
					<p>Whats the output of iptables-save ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p232543">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">eric9873232</div>
					<div class="post-datetime">
						6 May 2014, 09:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi Jow,</p><p>thank you for your time! Here is&nbsp; &nbsp;iptables-save (its a bit long):</p><div class="quotebox"><blockquote><p># Generated by iptables-save v1.4.20 on Tue May&nbsp; 6 08:53:50 2014<br />*nat<br />:PREROUTING ACCEPT [1:60]<br />:INPUT ACCEPT [0:0]<br />:OUTPUT ACCEPT [0:0]<br />:POSTROUTING ACCEPT [1:40]<br />:delegate_postrouting - [0:0]<br />:delegate_prerouting - [0:0]<br />:postrouting_lan_rule - [0:0]<br />:postrouting_rule - [0:0]<br />:postrouting_wan_rule - [0:0]<br />:postrouting_wifi_rule - [0:0]<br />:prerouting_lan_rule - [0:0]<br />:prerouting_rule - [0:0]<br />:prerouting_wan_rule - [0:0]<br />:prerouting_wifi_rule - [0:0]<br />:zone_lan_postrouting - [0:0]<br />:zone_lan_prerouting - [0:0]<br />:zone_wan_postrouting - [0:0]<br />:zone_wan_prerouting - [0:0]<br />:zone_wifi_postrouting - [0:0]<br />:zone_wifi_prerouting - [0:0]<br />-A PREROUTING -j delegate_prerouting<br />-A POSTROUTING -j delegate_postrouting<br />-A delegate_postrouting -m comment --comment &quot;user chain for postrouting&quot; -j postrouting_rule<br />-A delegate_prerouting -m comment --comment &quot;user chain for prerouting&quot; -j prerouting_rule<br />-A zone_lan_postrouting -m comment --comment &quot;user chain for postrouting&quot; -j postrouting_lan_rule<br />-A zone_lan_prerouting -m comment --comment &quot;user chain for prerouting&quot; -j prerouting_lan_rule<br />-A zone_wan_postrouting -m comment --comment &quot;user chain for postrouting&quot; -j postrouting_wan_rule<br />-A zone_wan_postrouting -j MASQUERADE<br />-A zone_wan_prerouting -m comment --comment &quot;user chain for prerouting&quot; -j prerouting_wan_rule<br />-A zone_wifi_postrouting -m comment --comment &quot;user chain for postrouting&quot; -j postrouting_wifi_rule<br />-A zone_wifi_prerouting -m comment --comment &quot;user chain for prerouting&quot; -j prerouting_wifi_rule<br />COMMIT<br /># Completed on Tue May&nbsp; 6 08:53:50 2014<br /># Generated by iptables-save v1.4.20 on Tue May&nbsp; 6 08:53:50 2014<br />*raw<br />:PREROUTING ACCEPT [76:5264]<br />:OUTPUT ACCEPT [49:5852]<br />:delegate_notrack - [0:0]<br />-A PREROUTING -j delegate_notrack<br />COMMIT<br /># Completed on Tue May&nbsp; 6 08:53:50 2014<br /># Generated by iptables-save v1.4.20 on Tue May&nbsp; 6 08:53:50 2014<br />*mangle<br />:PREROUTING ACCEPT [76:5264]<br />:INPUT ACCEPT [74:5144]<br />:FORWARD ACCEPT [2:120]<br />:OUTPUT ACCEPT [49:5852]<br />:POSTROUTING ACCEPT [49:5852]<br />:fwmark - [0:0]<br />:mssfix - [0:0]<br />-A PREROUTING -j fwmark<br />-A FORWARD -j mssfix<br />COMMIT<br /># Completed on Tue May&nbsp; 6 08:53:50 2014<br /># Generated by iptables-save v1.4.20 on Tue May&nbsp; 6 08:53:50 2014<br />*filter<br />:INPUT ACCEPT [0:0]<br />:FORWARD DROP [0:0]<br />:OUTPUT ACCEPT [0:0]<br />:delegate_forward - [0:0]<br />:delegate_input - [0:0]<br />:delegate_output - [0:0]<br />:forwarding_lan_rule - [0:0]<br />:forwarding_rule - [0:0]<br />:forwarding_wan_rule - [0:0]<br />:forwarding_wifi_rule - [0:0]<br />:input_lan_rule - [0:0]<br />:input_rule - [0:0]<br />:input_wan_rule - [0:0]<br />:input_wifi_rule - [0:0]<br />:output_lan_rule - [0:0]<br />:output_rule - [0:0]<br />:output_wan_rule - [0:0]<br />:output_wifi_rule - [0:0]<br />:reject - [0:0]<br />:syn_flood - [0:0]<br />:zone_lan_dest_ACCEPT - [0:0]<br />:zone_lan_forward - [0:0]<br />:zone_lan_input - [0:0]<br />:zone_lan_output - [0:0]<br />:zone_lan_src_ACCEPT - [0:0]<br />:zone_wan_dest_ACCEPT - [0:0]<br />:zone_wan_forward - [0:0]<br />:zone_wan_input - [0:0]<br />:zone_wan_output - [0:0]<br />:zone_wan_src_REJECT - [0:0]<br />:zone_wifi_dest_ACCEPT - [0:0]<br />:zone_wifi_forward - [0:0]<br />:zone_wifi_input - [0:0]<br />:zone_wifi_output - [0:0]<br />:zone_wifi_src_ACCEPT - [0:0]<br />-A INPUT -j delegate_input<br />-A FORWARD -j delegate_forward<br />-A OUTPUT -j delegate_output<br />-A delegate_forward -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_rule<br />-A delegate_forward -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br />-A delegate_forward -j reject<br />-A delegate_input -i lo -j ACCEPT<br />-A delegate_input -m comment --comment &quot;user chain for input&quot; -j input_rule<br />-A delegate_input -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br />-A delegate_input -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn_flood<br />-A delegate_output -o lo -j ACCEPT<br />-A delegate_output -m comment --comment &quot;user chain for output&quot; -j output_rule<br />-A delegate_output -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br />-A reject -p tcp -j REJECT --reject-with tcp-reset<br />-A reject -j REJECT --reject-with icmp-port-unreachable<br />-A syn_flood -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m limit --limit 25/sec --limit-burst 50 -j RETURN<br />-A syn_flood -j DROP<br />-A zone_lan_forward -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_lan_rule<br />-A zone_lan_forward -m comment --comment &quot;forwarding lan -&gt; wan&quot; -j zone_wan_dest_ACCEPT<br />-A zone_lan_forward -m comment --comment &quot;forwarding lan -&gt; wifi&quot; -j zone_wifi_dest_ACCEPT<br />-A zone_lan_forward -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT<br />-A zone_lan_forward -j zone_lan_src_ACCEPT<br />-A zone_lan_input -m comment --comment &quot;user chain for input&quot; -j input_lan_rule<br />-A zone_lan_input -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT<br />-A zone_lan_input -j zone_lan_src_ACCEPT<br />-A zone_lan_output -m comment --comment &quot;user chain for output&quot; -j output_lan_rule<br />-A zone_lan_output -j zone_lan_dest_ACCEPT<br />-A zone_wan_forward -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_wan_rule<br />-A zone_wan_forward -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT<br />-A zone_wan_forward -j zone_wan_src_REJECT<br />-A zone_wan_input -m comment --comment &quot;user chain for input&quot; -j input_wan_rule<br />-A zone_wan_input -p udp -m udp --dport 68 -m comment --comment Allow-DHCP-Renew -j ACCEPT<br />-A zone_wan_input -p icmp -m icmp --icmp-type 8 -m comment --comment Allow-Ping -j ACCEPT<br />-A zone_wan_input -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT<br />-A reject -j REJECT --reject-with icmp-port-unreachable<br />-A syn_flood -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m limit --limit 25/sec --limit-burst 50 -j RETURN<br />-A syn_flood -j DROP<br />-A zone_lan_forward -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_lan_rule<br />-A zone_lan_forward -m comment --comment &quot;forwarding lan -&gt; wan&quot; -j zone_wan_dest_ACCEPT<br />-A zone_lan_forward -m comment --comment &quot;forwarding lan -&gt; wifi&quot; -j zone_wifi_dest_ACCEPT<br />-A zone_lan_forward -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT<br />-A zone_lan_forward -j zone_lan_src_ACCEPT<br />-A zone_lan_input -m comment --comment &quot;user chain for input&quot; -j input_lan_rule<br />-A zone_lan_input -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT<br />-A zone_lan_input -j zone_lan_src_ACCEPT<br />-A zone_lan_output -m comment --comment &quot;user chain for output&quot; -j output_lan_rule<br />-A zone_lan_output -j zone_lan_dest_ACCEPT<br />-A zone_wan_forward -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_wan_rule<br />-A zone_wan_forward -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT<br />-A zone_wan_forward -j zone_wan_src_REJECT<br />-A zone_wan_input -m comment --comment &quot;user chain for input&quot; -j input_wan_rule<br />-A zone_wan_input -p udp -m udp --dport 68 -m comment --comment Allow-DHCP-Renew -j ACCEPT<br />-A zone_wan_input -p icmp -m icmp --icmp-type 8 -m comment --comment Allow-Ping -j ACCEPT<br />-A zone_wan_input -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT<br />-A zone_wan_input -j zone_wan_src_REJECT<br />-A zone_wan_output -m comment --comment &quot;user chain for output&quot; -j output_wan_rule<br />-A zone_wan_output -j zone_wan_dest_ACCEPT<br />-A zone_wan_src_REJECT -m limit --limit 10/sec -j LOG --log-prefix &quot;REJECT(src wan)&quot;<br />-A zone_wifi_forward -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_wifi_rule<br />-A zone_wifi_forward -m comment --comment &quot;forwarding wifi -&gt; lan&quot; -j zone_lan_dest_ACCEPT<br />-A zone_wifi_forward -m comment --comment &quot;forwarding wifi -&gt; wan&quot; -j zone_wan_dest_ACCEPT<br />-A zone_wifi_forward -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT<br />-A zone_wifi_forward -j zone_wifi_src_ACCEPT<br />-A zone_wifi_input -m comment --comment &quot;user chain for input&quot; -j input_wifi_rule<br />-A zone_wifi_input -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT<br />-A zone_wifi_input -j zone_wifi_src_ACCEPT<br />-A zone_wifi_output -m comment --comment &quot;user chain for output&quot; -j output_wifi_rule<br />-A zone_wifi_output -j zone_wifi_dest_ACCEPT<br />COMMIT</p></blockquote></div><br /><p>Thank you, Eric</p>											<p class="post-edited">(Last edited by <strong>eric9873232</strong> on 6 May 2014, 09:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p232665">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">eric9873232</div>
					<div class="post-datetime">
						7 May 2014, 11:16					</div>
				</div>
				<div class="post-content content">
					<p>Sniff .. no help available?&nbsp; I attach the two important config files, hoping for some hint.</p><p>Thank you!</p><p>/etc/config/network<br /></p><div class="quotebox"><blockquote><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;<br />config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.0.36&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway &#039;192.168.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns&nbsp; &nbsp; &nbsp;&#039;109.69.8.34&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns&nbsp; &nbsp; &nbsp;&#039;188.165.25.65&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns&nbsp; &nbsp; &nbsp;&#039;151.236.6.156&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns&nbsp; &nbsp; &nbsp;&#039;185.27.253.92&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns&nbsp; &nbsp; &nbsp;&#039;95.85.9.86&#039;<br />config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;<br />config interface &#039;wifi&#039; <br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039; <br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.2.1&#039; <br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039; <br />config switch<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable_vlan &#039;1&#039;<br />config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 2 3 4 5&#039;<br />config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 1&#039;</p></blockquote></div><p>and&nbsp; /etc/config/firewall<br /></p><div class="quotebox"><blockquote><p>config defaults<br />&nbsp; &nbsp; &nbsp; &nbsp; option syn_flood&nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br /># Uncomment this line to disable ipv6 rules<br />#&nbsp; &nbsp; &nbsp; &nbsp;option disable_ipv6&nbsp; &nbsp; &nbsp;1</p><p>config zone<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br />&nbsp; &nbsp; &nbsp; &nbsp; list&nbsp; &nbsp;network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT</p><p>config zone<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />&nbsp; &nbsp; &nbsp; &nbsp; list&nbsp; &nbsp;network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list&nbsp; &nbsp;network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br />&nbsp; &nbsp; &nbsp; &nbsp; option masq&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1<br />&nbsp; &nbsp; &nbsp; &nbsp; option log&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option mtu_fix&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</p><p>config zone <br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wifi<br />&nbsp; &nbsp; &nbsp; &nbsp; list network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;wifi&#039; <br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT <br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT <br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p><p>config forwarding<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />config forwarding&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wifi&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br />config forwarding <br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wifi<br />config forwarding<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wifi<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />&nbsp; &nbsp; &nbsp; &nbsp; # We need to accept udp packets on port 68,<br /># see <a href="https://dev.openwrt.org/ticket/4108">https://dev.openwrt.org/ticket/4108</a><br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCP-Renew<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 68<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4</p><p># Allow IPv4 ping<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-Ping<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; option icmp_type&nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow DHCPv6 replies<br /># see <a href="https://dev.openwrt.org/ticket/10381">https://dev.openwrt.org/ticket/10381</a><br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCPv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fe80::/10<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;547<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fe80::/10<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 546<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential incoming IPv6 ICMP traffic<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Input<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-reply<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-solicitation<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-solicitation<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-advertisement<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-advertisement<br />&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential forwarded IPv6 ICMP traffic<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Forward<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-reply<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br />&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># include a file with users custom iptables rules<br />config include<br />&nbsp; &nbsp; &nbsp; &nbsp; option path /etc/firewall.user</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p232677">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						7 May 2014, 13:11					</div>
				</div>
				<div class="post-content content">
					<p>&quot;How to Bugtrack that??&quot;</p><p>&nbsp; firewall debug mode<br />&nbsp; firewall LOG setup<br />&nbsp; tcpdump / wireshark</p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p232715">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						7 May 2014, 18:14					</div>
				</div>
				<div class="post-content content">
					<p>What OpenWrt version do you run?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p232723">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">eric9873232</div>
					<div class="post-datetime">
						7 May 2014, 19:18					</div>
				</div>
				<div class="post-content content">
					<p>Dear 3zl and Jow,</p><p>thanks for your time and hints.&nbsp; I have</p><p>hardware: tp-link 3600, <br />opnwrt:&nbsp; &nbsp;BARRIER BREAKER (Bleeding Edge, r39755), <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;uname -a gives&nbsp; Linux OpenWrt 3.10.32 #1 Thu Feb 27 01:08:26 UTC 2014 mips GNU/Linux.</p><p>I upgraded firewall (only!) so maybe this causes the problem. Should I try a &quot;dist-upgrade&quot;&nbsp; ?</p><p>thanks Eric</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p232794">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						8 May 2014, 14:38					</div>
				</div>
				<div class="post-content content">
					<p>You should upgrade your entire image. I suspect the newer firewqall package is not able to resolve interfaces on your older system.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p232882">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">eric9873232</div>
					<div class="post-datetime">
						9 May 2014, 15:38					</div>
				</div>
				<div class="post-content content">
					<p>Hi Jow,</p><p>you saved me! the sysupgrade made all work anagin.Thank you for this lesson on partial upgrades <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>Eric</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>