<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> D-Link DIR-825: some notes on flashing + some questions</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p109245">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						17 May 2010, 16:40					</div>
				</div>
				<div class="post-content content">
					<p>Good day.</p><p>Had anybody had any success in flashing DIR-825 under linux using the instructions from the wiki page?</p><p>I&#039;ve done some experiments and I was only able to flash the device under Windows XP using either IE6 or Firefox 3.6.3.<br />Under linux the firmware flash page (<a href="http://192.168.0.1">http://192.168.0.1</a>) opens up correctly but then the process times out after clicking on the &quot;Update&quot; button.<br />I had tried linux versions of Firefox 3.6.3, Konqueror 3.5.10 and elinks 0.11.3, all without success. The inspection of the PC&lt;-&gt;Router packets exchange (captured using Wireshark) shows no clear picture concerning the cause of the problem. There are some &quot;TCP Dup ACK&quot; and &quot;TCP Out-Of-Order&quot; packets in the captured log, so the problems might be caused by TCP stack incompatibilities between DIR-825 recovery mode and linux network stack but I have got no ideas how to troubleshoot it.<br />Any suggestions?</p><p>Apart from firmware flashing problems, what is the difference between the firmware files &quot;openwrt-ar71xx-generic-dir-825-b1-squashfs-backup-loader.bin&quot;, &quot;openwrt-ar71xx-generic-dir-825-b1-squashfs-factory.bin&quot; and &quot;openwrt-ar71xx-generic-dir-825-b1-squashfs-sysupgrade.bin&quot;? </p><p>I had tried to flash the device with both &quot;openwrt-ar71xx-generic-dir-825-b1-squashfs-backup-loader.bin&quot; and &quot;openwrt-ar71xx-generic-dir-825-b1-squashfs-factory.bin&quot;.<br />Both attempts were successful, in either cases the device had reflashed itself and then normally booted up into OpenWRT. Hadn&#039;t tried to flash the device with &quot;openwrt-ar71xx-generic-dir-825-b1-squashfs-sysupgrade.bin&quot; but the file name suggests that is should be used when performing sysupgrade process from withing OpenWRT. Meanwhile wiki page insists on using &quot;openwrt-ar71xx-dir-825-b1-squashfs-backup-loader.bin&quot; and flashing it directly into the &quot;firmware&quot; flash partition using mtd.<br />Which approach is the right one?</p><p>Side note: inside the /sbin folder of the newly flashed DIR-825 there is the &quot;wget2nand&quot; script. Quick inspection shows that it might be yet another (currently non-documented) way to install the OpenWRT. Unfortunately I wasn&#039;t able to find in the docs and wiki any information concerning the wget2nand utility. Had anybody got any information that can bring the light on the wget2nand usage/purpose?</p><p>I would appreciate any answers, thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109250">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						17 May 2010, 19:02					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve had success flashing a DIR-825 B1 with openwrt-ar71xx-dir-825-b1-squashfs-factory.bin<br />(this image doesn&#039;t appear to be present on the backfire download site, but it gets built if you compile backfire yourself with the dir-825-b1 profile).</p><p>I just used the normal D-Link web interface, and chose the firmware upgrade tool.&nbsp; It worked fine.</p><p>I&#039;ve also re-flashed a DIR-825 that already had OpenWrt on it, again using the factory.bin image, and using the Luci firmware upgrade page.&nbsp; That also worked fine.</p><p>I haven&#039;t had to use the emergency recovery mode (yet :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109264">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						17 May 2010, 20:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I&#039;ve had success flashing a DIR-825 B1 with openwrt-ar71xx-dir-825-b1-squashfs-factory.bin<br />(this image doesn&#039;t appear to be present on the backfire download site, but it gets built if you compile backfire yourself with the dir-825-b1 profile).</p></blockquote></div><p>I also had used to self-compile OpenWRT from the latest SVN trunk: about a year ago it was the only way to get wifi working on DIR-320 with 2.6 kernel.</p><div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I just used the normal D-Link web interface, and chose the firmware upgrade tool.&nbsp; It worked fine.</p></blockquote></div><p>By the &quot;normal D-Link interface&quot; did you mean the original router web-interface you may normally get into using &quot;admin&quot;/&lt;empty password&gt; after a regular router boot-up? What operating system and a browser had you been using?</p><div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I&#039;ve also re-flashed a DIR-825 that already had OpenWrt on it, again using the factory.bin image, and using the Luci firmware upgrade page.&nbsp; That also worked fine. I haven&#039;t had to use the emergency recovery mode (yet :-)</p></blockquote></div><p>That&#039;s interesting info, but is still not clear what file should be used when proceeding with sysupgrade from command line.</p><p>I had spend some time looking into ar71xx target makefiles and it seems that the *-backup-loader.bin and the *-factory.bin images both got build up from the *-sysupgrade.bin one. </p><p>As far as I understand the make process correctly, images get&#039;s made using the following procedure:<br />1. Take the non-ELF kernel image (so-called &quot;kernel binary&quot;), patch it with the correct default command line, compress with the LZMA and prepare it for use by U-boot bootloader (feed it to the mkimage with the correct settings).<br />2. Take the results of the step 1, pad them with zeroes to be 1Mb in size, and concatenate with the rootfs image (squashfs in our case).<br />3. Place the result of step 2 into *-sysupgrade.bin file.<br />4. Concatenate the results of the step 2 with the string &quot;01AP94-AR7161-RT-080619-00&quot;, place the results into *-backup-loader.bin file.<br />5. Pad the results of the step 2 with zeroes to be 4Mb in size and concatenate with the string &quot;00AP94-AR7161-RT-080619-00&quot;. Place the results into the *-factory.bin file.</p><p>If I got the algorithm right, it seems that the strings appended to the end of &quot;*-factory.bin&quot; and &quot;*-backup-loader.bin&quot; are just the &quot;safety markers&quot; that the original firmware expects to find in the correct firmware images. My experiments shows that the emergency recovery mode web-interface accepts both &quot;*-factory.bin&quot; and &quot;*-backup-loader.bin&quot; images. Most probably it is required to use &quot;*-factory.bin&quot; to flash the router using &quot;normal&quot; D-Link web-interface.<br />When flashing from command line using sysupgrade tool it is most likely that the &quot;safety markers&quot; are not required (it seems to me that the sysupgrate only checks the image to start with byte 27h followed by 05h when reflashing for DIR-825), and it is safe to use any of the *-squashfs-*.bin images with sysupgrade. It is harmless to flash the &quot;safety marker&quot; in, as it will be hopefully overwritten on the first boot during the initialization of the jffs2 rootfs_data partition.</p><p>It is still not clear though if the wget2nand may be used on dir-825 to install OpenWRT. Inspection of the wget2nand source shows that is formats the kernel and the rootfs partitions of the flash to the yaffs2 filesystem and then merely copies the ELF version of the kernel to the root of the kernel partition filesystem naming the file &quot;kernel&quot;, and untars *-rootfs.tar.gz onto the rootfs partition filesystem.</p><p>I&#039;m pretty sure that this won&#039;t work &quot;as it is&quot; with the dir-825, as the ELF kernel image size is almost 2.5Mb, while the kernel partition of dir-825 is only 1Mb in size. The same applies to the rootfs: the total disk usage of the /rom on my dir-825 is about 8.2Mb while the rootfs partition is only about 5Mb in size. Thanks to the compression offered by the squashfs, this 8.2Mb shrinks down to the 2.5Mb leaving 2.5Mb for the jffs2. yaffs2 does not use any compression (while jffs2 may use zlib and some other algorithms), so this 8.2Mb would not fit on the 5Mb flash partition. Another problem with this setup is the DIR-825 U-boot bootloader, which I believe to be non-capable of booting the kernel from the yaffs2 kernel partition.</p><p>To the bottom line, looks like that the inclusion of the wget2nand tool in the dir-825 firmware is pointless, and it may be safely removed from the &quot;target/linux/ar71xx/base-files/sbin&quot; prior to the compile of the firmware. The savings in the firmware size would only be around 1kb, though.</p>											<p class="post-edited">(Last edited by <strong>lexa2</strong> on 17 May 2010, 20:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109266">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						17 May 2010, 21:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lexa2 wrote:</cite><blockquote><div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I just used the normal D-Link web interface, and chose the firmware upgrade tool.&nbsp; It worked fine.</p></blockquote></div><p>By the &quot;normal D-Link interface&quot; did you mean the original router web-interface you may normally get into using &quot;admin&quot;/&lt;empty password&gt; after a regular router boot-up? What operating system and a browser had you been using?</p></blockquote></div><p>That&#039;s right.&nbsp; I connected to it from a desktop PC running Debian (squeeze) and Firefox (3.5.9).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109336">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						18 May 2010, 20:54					</div>
				</div>
				<div class="post-content content">
					<p>Today I had tried to sysupgrade one of the DIR-825 I have using &quot;*-sysupgrade.bin&quot; file as the firmware image.<br />Reflashing was successful, router works great with a new firmware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109419">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						19 May 2010, 17:32					</div>
				</div>
				<div class="post-content content">
					<p>I have updated D-Link DIR-825 <a href="http://wiki.openwrt.org/toh/d-link/dir-825">wiki page</a> with the recent info findings and experiment results.</p><p>Still looking for more info about wget2nand script and it&#039;s relation to the DIR-825.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115511">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Dehir</div>
					<div class="post-datetime">
						19 Aug 2010, 12:24					</div>
				</div>
				<div class="post-content content">
					<p>Well if there is problem with linux and dir-825 firmware upgrade then im confirming it. I tried with rescue mode and trough dlink default upgrade and no success what so ever. Tries to upload but nothing happens either way. So windows is the only way to upload firmware for the bow successfully ? And are there any known bugs in backfire/10.03.1-rc1 i should be aware of ? </p><p>And my Hardware Version: B1&nbsp; &nbsp;&nbsp; &nbsp; Firmware Version: 2.01EU</p><br /><p>Ok managed to install trough windows and internet-explorer 7 but used openwrt-ar71xx-dir-825-b1-squashfs-backup-loader.bin trought d-link web firmware update :\ So going and running now</p>											<p class="post-edited">(Last edited by <strong>Dehir</strong> on 19 Aug 2010, 14:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140302">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">acitta</div>
					<div class="post-datetime">
						30 Jul 2011, 22:42					</div>
				</div>
				<div class="post-content content">
					<p>I successfully flashed the dir-825 under Jolicloud Linux with Firefox 3.16.14 using the firmware recovery mode.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>