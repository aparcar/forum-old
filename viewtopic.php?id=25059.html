<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> openvpn did not work on backfire</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p110299">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">supertom64</div>
					<div class="post-datetime">
						1 Jun 2010, 00:06					</div>
				</div>
				<div class="post-content content">
					<p>hi </p><p>i have installed openvpn on backfire.</p><p>openvpn should work in bridging mode with tap0</p><p>sadly backfire do not bridge the wan interface with the openvpn interface tap0 in<br />contrary to kamikaze 8.09.</p><p>any hints</p><p>thx<br />tom</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110304">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						1 Jun 2010, 02:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi.</p><div class="quotebox"><cite>supertom64 wrote:</cite><blockquote><p>any hints</p></blockquote></div><p>Yes. Without knowing your setup and specific configuration, nobody will be able to help you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110311">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">supertom64</div>
					<div class="post-datetime">
						1 Jun 2010, 06:52					</div>
				</div>
				<div class="post-content content">
					<p>hi jow,</p><p>first thx for your reply.</p><p>Router is a WR741NDv1<br />Firmware is backfire 10.03 build from source with openvpn in addition to defaults.</p><br /><p>NETWORK CONFIGURATION:</p><p>root@OpenWrt:~# cat /etc/config/network<br />config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface eth<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; none</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&#039;lan1 lan2 lan3 lan4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;172.29.230.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><p>config interface wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&#039;eth1 tap0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.180<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway&nbsp; 192.168.1.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns&nbsp; &nbsp; &nbsp; 192.168.1.1</p><br /><p>OPENVPN CONFIGURATION:</p><p>package openvpn</p><p>### unten &#039;server bridge&#039; bearbeiten ###</p><p>#################################################<br /># Sample to include a custom config file.&nbsp; &nbsp; &nbsp; &nbsp;#<br />#################################################</p><p>config openvpn custom_config</p><p>&nbsp; &nbsp; # Set to 1 to enable this instance:<br />&nbsp; &nbsp; option enable 0</p><p>&nbsp; &nbsp; # Include OpenVPN configuration<br />&nbsp; &nbsp; option config /etc/openvpn/my-vpn.conf</p><br /><p>#################################################<br /># Sample OpenVPN 2.0 uci config for&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#<br /># multi-client server.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #<br />#################################################</p><p>config openvpn sample_server</p><p>&nbsp; &nbsp; # Set to 1 to enable this instance:<br />&nbsp; &nbsp; option enable 1</p><p>&nbsp; &nbsp; # Which local IP address should OpenVPN<br />&nbsp; &nbsp; # listen on? (optional)<br />#&nbsp; &nbsp; option local 0.0.0.0</p><p>&nbsp; &nbsp; # Which TCP/UDP port should OpenVPN listen on?<br />&nbsp; &nbsp; # If you want to run multiple OpenVPN instances<br />&nbsp; &nbsp; # on the same machine, use a different port<br />&nbsp; &nbsp; # number for each one.&nbsp; You will need to<br />&nbsp; &nbsp; # open up this port on your firewall.<br />&nbsp; &nbsp; option port 1194</p><p>&nbsp; &nbsp; # TCP or UDP server?<br />#&nbsp; &nbsp; option proto tcp<br />&nbsp; &nbsp; option proto udp</p><p>&nbsp; &nbsp; # &quot;dev tun&quot; will create a routed IP tunnel,<br />&nbsp; &nbsp; # &quot;dev tap&quot; will create an ethernet tunnel.<br />&nbsp; &nbsp; # Use &quot;dev tap0&quot; if you are ethernet bridging<br />&nbsp; &nbsp; # and have precreated a tap0 virtual interface<br />&nbsp; &nbsp; # and bridged it with your ethernet interface.<br />&nbsp; &nbsp; # If you want to control access policies<br />&nbsp; &nbsp; # over the VPN, you must create firewall<br />&nbsp; &nbsp; # rules for the the TUN/TAP interface.<br />&nbsp; &nbsp; # On non-Windows systems, you can give<br />&nbsp; &nbsp; # an explicit unit number, such as tun0.<br />&nbsp; &nbsp; # On Windows, use &quot;dev-node&quot; for this.<br />&nbsp; &nbsp; # On most systems, the VPN will not function<br />&nbsp; &nbsp; # unless you partially or fully disable<br />&nbsp; &nbsp; # the firewall for the TUN/TAP interface.<br />&nbsp; &nbsp; option dev tap0<br />#&nbsp; &nbsp; option dev tun</p><p>&nbsp; &nbsp; # SSL/TLS root certificate (ca), certificate<br />&nbsp; &nbsp; # (cert), and private key (key).&nbsp; Each client<br />&nbsp; &nbsp; # and the server must have their own cert and<br />&nbsp; &nbsp; # key file.&nbsp; The server and all clients will<br />&nbsp; &nbsp; # use the same ca file.<br />&nbsp; &nbsp; #<br />&nbsp; &nbsp; # See the &quot;easy-rsa&quot; directory for a series<br />&nbsp; &nbsp; # of scripts for generating RSA certificates<br />&nbsp; &nbsp; # and private keys.&nbsp; Remember to use<br />&nbsp; &nbsp; # a unique Common Name for the server<br />&nbsp; &nbsp; # and each of the client certificates.<br />&nbsp; &nbsp; #<br />&nbsp; &nbsp; # Any X509 key management system can be used.<br />&nbsp; &nbsp; # OpenVPN can also use a PKCS #12 formatted key file<br />&nbsp; &nbsp; # (see &quot;pkcs12&quot; directive in man page).<br />&nbsp; &nbsp; #option ca /etc/openvpn/ca.crt<br />&nbsp; &nbsp; #option cert /etc/openvpn/server.crt<br />&nbsp; &nbsp; # This file should be kept secret:<br />&nbsp; &nbsp; #option key /etc/openvpn/server.key</p><p>&nbsp; &nbsp; option pkcs12 /etc/openvpn/server.p12</p><p>&nbsp; &nbsp; # Diffie hellman parameters.<br />&nbsp; &nbsp; # Generate your own with:<br />&nbsp; &nbsp; #&nbsp; &nbsp;openssl dhparam -out dh1024.pem 1024<br />&nbsp; &nbsp; # Substitute 2048 for 1024 if you are using<br />&nbsp; &nbsp; # 2048 bit keys.<br />&nbsp; &nbsp; option dh /etc/openvpn/dh1024.pem</p><p>&nbsp; &nbsp; # Configure server mode and supply a VPN subnet<br />&nbsp; &nbsp; # for OpenVPN to draw client addresses from.<br />&nbsp; &nbsp; # The server will take 10.8.0.1 for itself,<br />&nbsp; &nbsp; # the rest will be made available to clients.<br />&nbsp; &nbsp; # Each client will be able to reach the server<br />&nbsp; &nbsp; # on 10.8.0.1. Comment this line out if you are<br />&nbsp; &nbsp; # ethernet bridging. See the man page for more info.<br />#&nbsp; &nbsp; option server &quot;10.8.0.0 255.255.255.0&quot;</p><p>&nbsp; &nbsp; # Maintain a record of client &lt;-&gt; virtual IP address<br />&nbsp; &nbsp; # associations in this file.&nbsp; If OpenVPN goes down or<br />&nbsp; &nbsp; # is restarted, reconnecting clients can be assigned<br />&nbsp; &nbsp; # the same virtual IP address from the pool that was<br />&nbsp; &nbsp; # previously assigned.<br />#&nbsp; &nbsp; option ifconfig_pool_persist ipp.txt</p><p>&nbsp; &nbsp; # Configure server mode for ethernet bridging.<br />&nbsp; &nbsp; # You must first use your OS&#039;s bridging capability<br />&nbsp; &nbsp; # to bridge the TAP interface with the ethernet<br />&nbsp; &nbsp; # NIC interface.&nbsp; Then you must manually set the<br />&nbsp; &nbsp; # IP/netmask on the bridge interface, here we<br />&nbsp; &nbsp; # assume 10.8.0.4/255.255.255.0.&nbsp; Finally we<br />&nbsp; &nbsp; # must set aside an IP range in this subnet<br />&nbsp; &nbsp; # (start=10.8.0.50 end=10.8.0.100) to allocate<br />&nbsp; &nbsp; # to connecting clients.&nbsp; Leave this line commented<br />&nbsp; &nbsp; # out unless you are ethernet bridging.<br />&nbsp; &nbsp; option server_bridge &quot;192.168.1.0 255.255.255.0 192.168.1.233 192.168.1.239&quot;<br />&nbsp; &nbsp; # Push routes to the client to allow it<br />&nbsp; &nbsp; # to reach other private subnets behind<br />&nbsp; &nbsp; # the server.&nbsp; Remember that these<br />&nbsp; &nbsp; # private subnets will also need<br />&nbsp; &nbsp; # to know to route the OpenVPN client<br />&nbsp; &nbsp; # address pool (10.8.0.0/255.255.255.0)<br />&nbsp; &nbsp; # back to the OpenVPN server.<br />#&nbsp; &nbsp; list push &quot;route 192.168.10.0 255.255.255.0&quot;<br />#&nbsp; &nbsp; list push &quot;route 192.168.20.0 255.255.255.0&quot;</p><p>&nbsp; &nbsp; # To assign specific IP addresses to specific<br />&nbsp; &nbsp; # clients or if a connecting client has a private<br />&nbsp; &nbsp; # subnet behind it that should also have VPN access,<br />&nbsp; &nbsp; # use the subdirectory &quot;ccd&quot; for client-specific<br />&nbsp; &nbsp; # configuration files (see man page for more info).</p><p>&nbsp; &nbsp; # EXAMPLE: Suppose the client<br />&nbsp; &nbsp; # having the certificate common name &quot;Thelonious&quot;<br />&nbsp; &nbsp; # also has a small subnet behind his connecting<br />&nbsp; &nbsp; # machine, such as 192.168.40.128/255.255.255.248.<br />&nbsp; &nbsp; # First, uncomment out these lines:<br />#&nbsp; &nbsp; option client_config_dir ccd<br />#&nbsp; &nbsp; list route &quot;192.168.40.128 255.255.255.248&quot;<br />&nbsp; &nbsp; # Then create a file ccd/Thelonious with this line:<br />&nbsp; &nbsp; #&nbsp; &nbsp;iroute 192.168.40.128 255.255.255.248<br />&nbsp; &nbsp; # This will allow Thelonious&#039; private subnet to<br />&nbsp; &nbsp; # access the VPN.&nbsp; This example will only work<br />&nbsp; &nbsp; # if you are routing, not bridging, i.e. you are<br />&nbsp; &nbsp; # using &quot;dev tun&quot; and &quot;server&quot; directives.</p><p>&nbsp; &nbsp; # EXAMPLE: Suppose you want to give<br />&nbsp; &nbsp; # Thelonious a fixed VPN IP address of 10.9.0.1.<br />&nbsp; &nbsp; # First uncomment out these lines:<br />#&nbsp; &nbsp; option client_config_dir ccd<br />#&nbsp; &nbsp; list route &quot;10.9.0.0 255.255.255.252&quot;<br />#&nbsp; &nbsp; list route &quot;192.168.100.0 255.255.255.0&quot;<br />&nbsp; &nbsp; # Then add this line to ccd/Thelonious:<br />&nbsp; &nbsp; #&nbsp; &nbsp;ifconfig-push &quot;10.9.0.1 10.9.0.2&quot;</p><p>&nbsp; &nbsp; # Suppose that you want to enable different<br />&nbsp; &nbsp; # firewall access policies for different groups<br />&nbsp; &nbsp; # of clients.&nbsp; There are two methods:<br />&nbsp; &nbsp; # (1) Run multiple OpenVPN daemons, one for each<br />&nbsp; &nbsp; #&nbsp; &nbsp; &nbsp;group, and firewall the TUN/TAP interface<br />&nbsp; &nbsp; #&nbsp; &nbsp; &nbsp;for each group/daemon appropriately.<br />&nbsp; &nbsp; # (2) (Advanced) Create a script to dynamically<br />&nbsp; &nbsp; #&nbsp; &nbsp; &nbsp;modify the firewall in response to access<br />&nbsp; &nbsp; #&nbsp; &nbsp; &nbsp;from different clients.&nbsp; See man<br />&nbsp; &nbsp; #&nbsp; &nbsp; &nbsp;page for more info on learn-address script.<br />#&nbsp; &nbsp; option learn_address ./script</p><p>&nbsp; &nbsp; # If enabled, this directive will configure<br />&nbsp; &nbsp; # all clients to redirect their default<br />&nbsp; &nbsp; # network gateway through the VPN, causing<br />&nbsp; &nbsp; # all IP traffic such as web browsing and<br />&nbsp; &nbsp; # and DNS lookups to go through the VPN<br />&nbsp; &nbsp; # (The OpenVPN server machine may need to NAT<br />&nbsp; &nbsp; # the TUN/TAP interface to the internet in<br />&nbsp; &nbsp; # order for this to work properly).<br />&nbsp; &nbsp; # CAVEAT: May break client&#039;s network config if<br />&nbsp; &nbsp; # client&#039;s local DHCP server packets get routed<br />&nbsp; &nbsp; # through the tunnel.&nbsp; Solution: make sure<br />&nbsp; &nbsp; # client&#039;s local DHCP server is reachable via<br />&nbsp; &nbsp; # a more specific route than the default route<br />&nbsp; &nbsp; # of 0.0.0.0/0.0.0.0.<br />#&nbsp; &nbsp; list push &quot;redirect-gateway&quot;</p><p>&nbsp; &nbsp; # Certain Windows-specific network settings<br />&nbsp; &nbsp; # can be pushed to clients, such as DNS<br />&nbsp; &nbsp; # or WINS server addresses.&nbsp; CAVEAT:<br />&nbsp; &nbsp; # <a href="http://openvpn.net/faq.html#dhcpcaveats">http://openvpn.net/faq.html#dhcpcaveats</a><br />#&nbsp; &nbsp; list push &quot;dhcp-option DNS 10.8.0.1&quot;<br />#&nbsp; &nbsp; list push &quot;dhcp-option WINS 10.8.0.1&quot;</p><p>&nbsp; &nbsp; # Uncomment this directive to allow different<br />&nbsp; &nbsp; # clients to be able to &quot;see&quot; each other.<br />&nbsp; &nbsp; # By default, clients will only see the server.<br />&nbsp; &nbsp; # To force clients to only see the server, you<br />&nbsp; &nbsp; # will also need to appropriately firewall the<br />&nbsp; &nbsp; # server&#039;s TUN/TAP interface.<br />#&nbsp; &nbsp; option client_to_client 1</p><p>&nbsp; &nbsp; # Uncomment this directive if multiple clients<br />&nbsp; &nbsp; # might connect with the same certificate/key<br />&nbsp; &nbsp; # files or common names.&nbsp; This is recommended<br />&nbsp; &nbsp; # only for testing purposes.&nbsp; For production use,<br />&nbsp; &nbsp; # each client should have its own certificate/key<br />&nbsp; &nbsp; # pair.<br />&nbsp; &nbsp; #<br />&nbsp; &nbsp; # IF YOU HAVE NOT GENERATED INDIVIDUAL<br />&nbsp; &nbsp; # CERTIFICATE/KEY PAIRS FOR EACH CLIENT,<br />&nbsp; &nbsp; # EACH HAVING ITS OWN UNIQUE &quot;COMMON NAME&quot;,<br />&nbsp; &nbsp; # UNCOMMENT THIS LINE OUT.<br />#&nbsp; &nbsp; option duplicate_cn 1</p><p>&nbsp; &nbsp; # The keepalive directive causes ping-like<br />&nbsp; &nbsp; # messages to be sent back and forth over<br />&nbsp; &nbsp; # the link so that each side knows when<br />&nbsp; &nbsp; # the other side has gone down.<br />&nbsp; &nbsp; # Ping every 10 seconds, assume that remote<br />&nbsp; &nbsp; # peer is down if no ping received during<br />&nbsp; &nbsp; # a 120 second time period.<br />&nbsp; &nbsp; option keepalive &quot;10 120&quot;</p><p>&nbsp; &nbsp; # For extra security beyond that provided<br />&nbsp; &nbsp; # by SSL/TLS, create an &quot;HMAC firewall&quot;<br />&nbsp; &nbsp; # to help block DoS attacks and UDP port flooding.<br />&nbsp; &nbsp; #<br />&nbsp; &nbsp; # Generate with:<br />&nbsp; &nbsp; #&nbsp; &nbsp;openvpn --genkey --secret ta.key<br />&nbsp; &nbsp; #<br />&nbsp; &nbsp; # The server and each client must have<br />&nbsp; &nbsp; # a copy of this key.<br />&nbsp; &nbsp; # The second parameter should be &#039;0&#039;<br />&nbsp; &nbsp; # on the server and &#039;1&#039; on the clients.<br />&nbsp; &nbsp; # This file is secret:<br />&nbsp; &nbsp; option tls_auth &quot;/etc/openvpn/ta.key 0&quot;</p><p>&nbsp; &nbsp; # Select a cryptographic cipher.<br />&nbsp; &nbsp; # This config item must be copied to<br />&nbsp; &nbsp; # the client config file as well.<br />&nbsp; &nbsp; # Blowfish (default):<br />&nbsp; &nbsp; option cipher BF-CBC<br />&nbsp; &nbsp; # AES:<br />#&nbsp; &nbsp; option cipher AES-128-CBC<br />&nbsp; &nbsp; # Triple-DES:<br />#&nbsp; &nbsp; option cipher DES-EDE3-CBC</p><p>&nbsp; &nbsp; # Enable compression on the VPN link.<br />&nbsp; &nbsp; # If you enable it here, you must also<br />&nbsp; &nbsp; # enable it in the client config file.<br />#&nbsp; &nbsp; option comp_lzo 1</p><p>&nbsp; &nbsp; # The maximum number of concurrently connected<br />&nbsp; &nbsp; # clients we want to allow.<br />&nbsp; &nbsp; option max_clients 10</p><p>&nbsp; &nbsp; # The persist options will try to avoid<br />&nbsp; &nbsp; # accessing certain resources on restart<br />&nbsp; &nbsp; # that may no longer be accessible because<br />&nbsp; &nbsp; # of the privilege downgrade.<br />&nbsp; &nbsp; option persist_key 1<br />&nbsp; &nbsp; option persist_tun 1</p><p>&nbsp; &nbsp; # Output a short status file showing<br />&nbsp; &nbsp; # current connections, truncated<br />&nbsp; &nbsp; # and rewritten every minute.<br />#&nbsp; &nbsp; option status openvpn-status.log</p><p>&nbsp; &nbsp; # By default, log messages will go to the syslog (or<br />&nbsp; &nbsp; # on Windows, if running as a service, they will go to<br />&nbsp; &nbsp; # the &quot;\Program Files\OpenVPN\log&quot; directory).<br />&nbsp; &nbsp; # Use log or log-append to override this default.<br />&nbsp; &nbsp; # &quot;log&quot; will truncate the log file on OpenVPN startup,<br />&nbsp; &nbsp; # while &quot;log-append&quot; will append to it.&nbsp; Use one<br />&nbsp; &nbsp; # or the other (but not both).<br />#&nbsp; &nbsp; option log&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;openvpn.log<br />#&nbsp; &nbsp; option log_append&nbsp; openvpn.log</p><p>&nbsp; &nbsp; # Set the appropriate level of log<br />&nbsp; &nbsp; # file verbosity.<br />&nbsp; &nbsp; #<br />&nbsp; &nbsp; # 0 is silent, except for fatal errors<br />&nbsp; &nbsp; # 4 is reasonable for general usage<br />&nbsp; &nbsp; # 5 and 6 can help to debug connection problems<br />&nbsp; &nbsp; # 9 is extremely verbose<br />&nbsp; &nbsp; option verb 3</p><p>&nbsp; &nbsp; # Silence repeating messages.&nbsp; At most 20<br />&nbsp; &nbsp; # sequential messages of the same message<br />&nbsp; &nbsp; # category will be output to the log.<br />&nbsp; &nbsp; option mute 20</p><br /><p>##############################################<br /># Sample client-side OpenVPN 2.0 uci config&nbsp; #<br /># for connecting to multi-client server.&nbsp; &nbsp; &nbsp;#<br />##############################################</p><p>config openvpn sample_client</p><p>&nbsp; &nbsp; # Set to 1 to enable this instance:<br />&nbsp; &nbsp; option enable 0</p><p>&nbsp; &nbsp; # Specify that we are a client and that we<br />&nbsp; &nbsp; # will be pulling certain config file directives<br />&nbsp; &nbsp; # from the server.<br />&nbsp; &nbsp; option client 1</p><p>&nbsp; &nbsp; # Use the same setting as you are using on<br />&nbsp; &nbsp; # the server.<br />&nbsp; &nbsp; # On most systems, the VPN will not function<br />&nbsp; &nbsp; # unless you partially or fully disable<br />&nbsp; &nbsp; # the firewall for the TUN/TAP interface.<br />#&nbsp; &nbsp; option dev tap<br />&nbsp; &nbsp; option dev tun</p><p>&nbsp; &nbsp; # Are we connecting to a TCP or<br />&nbsp; &nbsp; # UDP server?&nbsp; Use the same setting as<br />&nbsp; &nbsp; # on the server.<br />#&nbsp; &nbsp; option proto tcp<br />&nbsp; &nbsp; option proto udp</p><p>&nbsp; &nbsp; # The hostname/IP and port of the server.<br />&nbsp; &nbsp; # You can have multiple remote entries<br />&nbsp; &nbsp; # to load balance between the servers.<br />&nbsp; &nbsp; list remote &quot;my_server_1 1194&quot;<br />#&nbsp; &nbsp; list remote &quot;my_server_2 1194&quot;</p><p>&nbsp; &nbsp; # Choose a random host from the remote<br />&nbsp; &nbsp; # list for load_balancing.&nbsp; Otherwise<br />&nbsp; &nbsp; # try hosts in the order specified.<br />#&nbsp; &nbsp; option remote_random 1</p><p>&nbsp; &nbsp; # Keep trying indefinitely to resolve the<br />&nbsp; &nbsp; # host name of the OpenVPN server.&nbsp; Very useful<br />&nbsp; &nbsp; # on machines which are not permanently connected<br />&nbsp; &nbsp; # to the internet such as laptops.<br />&nbsp; &nbsp; option resolv_retry infinite</p><p>&nbsp; &nbsp; # Most clients don&#039;t need to bind to<br />&nbsp; &nbsp; # a specific local port number.<br />&nbsp; &nbsp; option nobind 1</p><p>&nbsp; &nbsp; # Try to preserve some state across restarts.<br />&nbsp; &nbsp; option persist_key 1<br />&nbsp; &nbsp; option persist_tun 1</p><p>&nbsp; &nbsp; # If you are connecting through an<br />&nbsp; &nbsp; # HTTP proxy to reach the actual OpenVPN<br />&nbsp; &nbsp; # server, put the proxy server/IP and<br />&nbsp; &nbsp; # port number here.&nbsp; See the man page<br />&nbsp; &nbsp; # if your proxy server requires<br />&nbsp; &nbsp; # authentication.<br />&nbsp; &nbsp; # retry on connection failures:<br />#&nbsp; &nbsp; option http_proxy_retry 1<br />&nbsp; &nbsp; # specify http proxy address and port:<br />#&nbsp; &nbsp; option http_proxy &quot;192.168.1.100 8080&quot;</p><p>&nbsp; &nbsp; # Wireless networks often produce a lot<br />&nbsp; &nbsp; # of duplicate packets.&nbsp; Set this flag<br />&nbsp; &nbsp; # to silence duplicate packet warnings.<br />#&nbsp; &nbsp; option mute_replay_warnings 1</p><p>&nbsp; &nbsp; # SSL/TLS parms.<br />&nbsp; &nbsp; # See the server config file for more<br />&nbsp; &nbsp; # description.&nbsp; It&#039;s best to use<br />&nbsp; &nbsp; # a separate .crt/.key file pair<br />&nbsp; &nbsp; # for each client.&nbsp; A single ca<br />&nbsp; &nbsp; # file can be used for all clients.<br />&nbsp; &nbsp; option ca ca.crt<br />&nbsp; &nbsp; option cert client.crt<br />&nbsp; &nbsp; option key client.key</p><p>&nbsp; &nbsp; # Verify server certificate by checking<br />&nbsp; &nbsp; # that the certicate has the nsCertType<br />&nbsp; &nbsp; # field set to &quot;server&quot;.&nbsp; This is an<br />&nbsp; &nbsp; # important precaution to protect against<br />&nbsp; &nbsp; # a potential attack discussed here:<br />&nbsp; &nbsp; #&nbsp; <a href="http://openvpn.net/howto.html#mitm">http://openvpn.net/howto.html#mitm</a><br />&nbsp; &nbsp; #<br />&nbsp; &nbsp; # To use this feature, you will need to generate<br />&nbsp; &nbsp; # your server certificates with the nsCertType<br />&nbsp; &nbsp; # field set to &quot;server&quot;.&nbsp; The build_key_server<br />&nbsp; &nbsp; # script in the easy_rsa folder will do this.<br />#&nbsp; &nbsp; option ns_cert_type server</p><p>&nbsp; &nbsp; # If a tls_auth key is used on the server<br />&nbsp; &nbsp; # then every client must also have the key.<br />#&nbsp; &nbsp; option tls_auth &quot;ta.key 1&quot;</p><p>&nbsp; &nbsp; # Select a cryptographic cipher.<br />&nbsp; &nbsp; # If the cipher option is used on the server<br />&nbsp; &nbsp; # then you must also specify it here.<br />#&nbsp; &nbsp; option cipher x</p><p>&nbsp; &nbsp; # Enable compression on the VPN link.<br />&nbsp; &nbsp; # Don&#039;t enable this unless it is also<br />&nbsp; &nbsp; # enabled in the server config file.<br />&nbsp; &nbsp; option comp_lzo 1</p><p>&nbsp; &nbsp; # Set log file verbosity.<br />&nbsp; &nbsp; option verb 3</p><p>&nbsp; &nbsp; # Silence repeating messages<br />#&nbsp; &nbsp; option mute 20</p><p>Exactly the same config works on Kamikaze 8.09 on a wrt54gl.<br />Here after manually call /etc/init.d/openvpn<br />the interface &quot;tap0&quot; and the bridge &quot;br-wan tap0&quot; are setup automatically.</p><p>But with Backfire I can only see the tap0 with &quot;ifconfig -a&quot;<br />and with brctl I can see that br-wan is not build.</p><p>If I do a &quot;/etc/init.d/network restart&quot; the interface tap0 and the br-wan/tap0<br />are build and doing after this a &quot;/etc/init.d/openvpn restart&quot; it destroy the bridge and tap0 can only be see with ifconfig -a</p><p>I had a look at /etc/init.d/openvpn which I assume should make the magic but could no see any difference with Kamikaze 8.09.</p><p>Maybe you can clear the magic behind openvpn. :-)</p><p>thx <br />tom</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110313">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">supertom64</div>
					<div class="post-datetime">
						1 Jun 2010, 07:23					</div>
				</div>
				<div class="post-content content">
					<p>hi,</p><p>just playing around and tried</p><p>[ -n &quot;$ARGS&quot; ] &amp;&amp; \<br />&nbsp; &nbsp; &nbsp; &nbsp; eval &quot;$SSD -q -b -p &#039;$PID&#039; -x $BIN -S -- --syslog &#039;openvpn($s)&#039; --writepid &#039;$PID&#039; $ARGS&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />#addition<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sleep 2<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig tap0 up<br />&nbsp; &nbsp; &nbsp; &nbsp; brctl addif br-wan tap0</p><p>which bring up the tap0 interface<br />and finally bridge the the wan interface.</p><p>Anyway this is really not a clean solution and it would be interesting what is broken behind /etc/init.d/openvpn</p><p>thx<br />tom</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>