<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN connection with my openwrt router</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p364562">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						29 Aug 2017, 21:36					</div>
				</div>
				<div class="post-content content">
					<p>Hey guys,</p><p>am trying to make an openvpn server of my router, so i can connect from the outside/inside with my local lan to do some maintance on my&nbsp; pi.</p><p>I installed opkg install openvpn-openssl openvpn-easy-rsa and followed the post on:<br />wiki.openwrt.org/doc/howto/vpn.openvpn</p><p>I opened the ports on my ISP modem/router and forwarded it to my openwrt router.<br />but the connection wont come up, the openvpn log says: MANAGEMENT: &gt;STATE:1503950087,WAIT,,,,,,</p><p>Here is my output of the commands:<br />cat /tmp/openvpn.log<br />cat /etc/config/network<br />cat /etc/config/firewall<br />cat /etc/config/openvpn</p><div class="codebox"><pre><code>root@Unknown:~# cat /tmp/openvpn.log
cat: can&#039;t open &#039;/tmp/openvpn.log&#039;: No such file or directory
root@Unknown:~# cat /etc/config/network

config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;XX.XX.XX.XX::/48&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth1&#039;
        option force_link &#039;1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;
        option ipaddr &#039;192.168.1.254&#039;
        option dns &#039;XX.XX.XX.22 XX.XX.XX.23 8.8.8.8 8.8.4.4&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth0&#039;
        option _orig_ifname &#039;eth0&#039;
        option _orig_bridge &#039;false&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.178.11&#039;
        option netmask &#039;255.255.255.0&#039;
        option gateway &#039;192.168.178.1&#039;
        option delegate &#039;0&#039;
        option type &#039;bridge&#039;
        option dns &#039;.XX.XX.XX.22 XX.XX.XX.23&#039;

config switch
        option name &#039;switch0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0 2 3 4 5&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option ports &#039;1 6&#039;

config route
        option interface &#039;lan&#039;
        option target &#039;0.0.0.0&#039;
        option gateway &#039;192.168.178.1&#039;

config route

config interface &#039;vpn0&#039;
        option ifname &#039;tun0&#039;
        option proto &#039;none&#039;
        option auto &#039;1&#039;

root@Unknown:~# cat /etc/config/firewall

config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;

config zone
        option name &#039;lan&#039;
        list network &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;wan&#039;
        list network &#039;wan&#039;
        list network &#039;wan6&#039;
        option input &#039;REJECT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;

config forwarding
        option src &#039;lan&#039;
        option dest &#039;wan&#039;

config rule
        option name &#039;Allow-DHCP-Renew&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;68&#039;
        option target &#039;ACCEPT&#039;
        option family &#039;ipv4&#039;

config rule
        option name &#039;Allow-Ping&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option icmp_type &#039;echo-request&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-IGMP&#039;
        option src &#039;wan&#039;
        option proto &#039;igmp&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-DHCPv6&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option src_ip &#039;fe80::/10&#039;
        option src_port &#039;547&#039;
        option dest_ip &#039;fe80::/10&#039;
        option dest_port &#039;546&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-MLD&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option src_ip &#039;fe80::/10&#039;
        list icmp_type &#039;130/0&#039;
        list icmp_type &#039;131/0&#039;
        list icmp_type &#039;132/0&#039;
        list icmp_type &#039;143/0&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Input&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        list icmp_type &#039;router-solicitation&#039;
        list icmp_type &#039;neighbour-solicitation&#039;
        list icmp_type &#039;router-advertisement&#039;
        list icmp_type &#039;neighbour-advertisement&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Forward&#039;
        option src &#039;wan&#039;
        option dest &#039;*&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config include
        option path &#039;/etc/firewall.user&#039;

config include &#039;miniupnpd&#039;
        option type &#039;script&#039;
        option path &#039;/usr/share/miniupnpd/firewall.include&#039;
        option family &#039;any&#039;
        option reload &#039;1&#039;

config include &#039;bcp38&#039;
        option type &#039;script&#039;
        option path &#039;/usr/lib/bcp38/run.sh&#039;
        option family &#039;IPv4&#039;
        option reload &#039;1&#039;

config redirect
        option target &#039;DNAT&#039;
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option proto &#039;tcp&#039;
        option src_dport &#039;80&#039;
        option dest_ip &#039;192.168.1.104&#039;
        option dest_port &#039;80&#039;
        option name &#039;Apache Server to Pi&#039;
        option enabled &#039;0&#039;

config redirect
        option target &#039;DNAT&#039;
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option proto &#039;tcp udp&#039;
        option src_dport &#039;8080&#039;
        option dest_ip &#039;192.168.1.104&#039;
        option dest_port &#039;8080&#039;
        option name &#039;Apache Server to Pi&#039;
        option enabled &#039;0&#039;

config rule &#039;Allow_OpenVPN_Inbound&#039;
        option target &#039;ACCEPT&#039;
        option src &#039;*&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;1194&#039;

config zone &#039;vpn&#039;
        option name &#039;vpn&#039;
        option network &#039;vpn0&#039;
        option input &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option output &#039;ACCEPT&#039;
        option masq &#039;1&#039;

config forwarding &#039;vpn_forwarding_lan_in&#039;
        option src &#039;vpn&#039;
        option dest &#039;lan&#039;

config forwarding &#039;vpn_forwarding_lan_out&#039;
        option src &#039;lan&#039;
        option dest &#039;vpn&#039;

config forwarding &#039;vpn_forwarding_wan&#039;
        option src &#039;vpn&#039;
        option dest &#039;wan&#039;

config redirect
        option enabled &#039;1&#039;
        option target &#039;DNAT&#039;
        option src &#039;wan&#039;
        option dest &#039;vpn&#039;
        option proto &#039;udp&#039;
        option src_dport &#039;1194&#039;
        option dest_ip &#039;192.168.1.254&#039;
        option dest_port &#039;1194&#039;
        option name &#039;VPN&#039;

root@Unknown:~# cat /etc/config/openvpn

config openvpn &#039;lan&#039;
        option enable &#039;1&#039;
        option port &#039;1194&#039;
        option proto &#039;udp&#039;
        option dev &#039;tun&#039;
        option ca &#039;/etc/easy-rsa/keys/ca.crt&#039;
        option cert &#039;/etc/easy-rsa/keys/server.crt&#039;
        option key &#039;/etc/easy-rsa/keys/server.key&#039;
        option dh &#039;/etc/easy-rsa/keys/dh2048.pem&#039;
        option ifconfig_pool_persist &#039;/tmp/ipp.txt&#039;
        option keepalive &#039;10 120&#039;
        option comp_lzo &#039;no&#039;
        option persist_key &#039;1&#039;
        option persist_tun &#039;1&#039;
        option status &#039;/var/log/openvpn-status.log&#039;
        option verb &#039;3&#039;
        option server &#039;10.0.0.0 255.255.255.0&#039;
        option client_to_client &#039;1&#039;
        list push &#039;redirect-gateway def1&#039;
        list push &#039;dhcp-option DNS 192.168.1.254&#039;
        list push &#039;route 192.168.1.0 255.255.255.0&#039;
        option enabled &#039;1&#039;</code></pre></div><p>Could someone please help with a push in the right direction. Maybe it is something noobish what am asking, just let me know <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Thanks in regards!</p><p>Hpower</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364567">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						29 Aug 2017, 23:19					</div>
				</div>
				<div class="post-content content">
					<p>What is it?<br /></p><div class="codebox"><pre><code>config redirect
        option enabled &#039;1&#039;
        option target &#039;DNAT&#039;
        option src &#039;wan&#039;
        option dest &#039;vpn&#039;
        option proto &#039;udp&#039;
        option src_dport &#039;1194&#039;
        option dest_ip &#039;192.168.1.254&#039;
        option dest_port &#039;1194&#039;
        option name &#039;VPN&#039;</code></pre></div><p>Do you see in vpn-logs of server anything?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364569">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						29 Aug 2017, 23:35					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>config redirect
        option enabled &#039;1&#039;
        option target &#039;DNAT&#039;
        option src &#039;wan&#039;
        option dest &#039;vpn&#039;
        option proto &#039;udp&#039;
        option src_dport &#039;1194&#039;
        option dest_ip &#039;192.168.1.254&#039;
        option dest_port &#039;1194&#039;
        option name &#039;VPN&#039;</code></pre></div><p>Do not do this; remove this section entirely.&nbsp; The &quot;Allow_OpenVPN_Inbound&quot; rule from the wiki recipe is sufficient to get VPN requests from the WAN to port 1194 in your router.<br />Using src &#039;*&#039; makes sure you could log in to the VPN server from your LAN, useful for testing.&nbsp; It could be src &#039;wan&#039;.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 29 Aug 2017, 23:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364694">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						31 Aug 2017, 22:09					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the response!!<br />I removed the section mk24 metioned and change src &#039;*&#039; into src &#039;wan&#039;.</p><p>My openvpn logfile is empty:<br /></p><div class="codebox"><pre><code>-rwx--x--x    1 root     root             0 Aug 31 20:45 openvpn-status.log</code></pre></div><p>I can connect to my openvpn server cause it is my router?</p><p>i can do a /etc/init.d/openvpn start without an error but still it seems not let any vpn connections in.</p><p>when i do a nmap scan local:<br />sudo nmap -Pn -sU -p 1194 192.168.1.254</p><p>Starting Nmap <br />Nmap scan report for Unknown.lan (192.168.1.254)<br />Host is up (0.00024s latency).</p><p>PORT&nbsp; &nbsp; &nbsp;STATE&nbsp; SERVICE<br />1194/udp closed openvpn</p><p>nmap on my public ip:</p><p>Starting Nmap<br />Nmap scan report for XX.XX.XX.XX<br />Host is up.</p><p>PORT&nbsp; &nbsp; &nbsp;STATE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SERVICE<br />1194/udp open|filtered openvpn</p><p>Is there any other method to see if my openvpn server is active on my router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364696">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						31 Aug 2017, 22:16					</div>
				</div>
				<div class="post-content content">
					<p>Empty log means you have troubles with starting openvpn-server. Add more verbosity &#039;verb 5&#039;, do you see it in processes? <br /></p><div class="codebox"><pre><code>ps | grep openvpn</code></pre></div><p>Kill it and start manually from console:<br /></p><div class="codebox"><pre><code>/etc/init.d/openvpn stop
/etc/init.d/openvpn start</code></pre></div><p>What do you see in log and in console?</p><p>You have typo in your openvpn config:<br />Your option:<br /></p><div class="codebox"><pre><code>option enable &#039;1&#039;</code></pre></div><p>Correct option:<br /></p><div class="codebox"><pre><code>option enabled &#039;1&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 31 Aug 2017, 22:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364702">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						31 Aug 2017, 23:38					</div>
				</div>
				<div class="post-content content">
					<p>I edit the verb and change enable to enabled but still nothing in the log file. <br />I think it has problems with starting the openvpn...</p><br /><p>the </p><div class="codebox"><pre><code>ps | grep openvpn</code></pre></div><p> command gives:</p><p>7321 root&nbsp; &nbsp; &nbsp; 1364 S&nbsp; &nbsp; grep openvpn</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364703">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						31 Aug 2017, 23:42					</div>
				</div>
				<div class="post-content content">
					<p>Gonna try to reinstall it tomorrow will update this post.<br />Thanks for the help so far!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364704">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						31 Aug 2017, 23:51					</div>
				</div>
				<div class="post-content content">
					<p>Try looking at the regular <strong>logread</strong>.</p><p>Then /etc/init.d/openvpn restart and check the log again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364705">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						1 Sep 2017, 00:07					</div>
				</div>
				<div class="post-content content">
					<p>Change<br /></p><div class="codebox"><pre><code>config openvpn &#039;lan&#039;</code></pre></div><p>for something like<br /></p><div class="codebox"><pre><code>config openvpn &#039;myvpn&#039;</code></pre></div><p>Yes, restart openvpn and see log<br /></p><div class="codebox"><pre><code>logread -e openvpn</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364758">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						1 Sep 2017, 20:42					</div>
				</div>
				<div class="post-content content">
					<p>Ok did what you asked, got some nice information now, where i further can work on.<br />Will do some internet research thanks!</p><div class="codebox"><pre><code>Fri Sep  1 19:39:11 2017 daemon.warn openvpn(openvpn)[7500]: Warning: Error redi                                                                                        recting stdout/stderr to --log file: /var/log/openvpn/openvpn.log: No such file                                                                                         or directory (errno=2)
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(myvpn)[7499]: OpenVPN 2.3.6 mips-                                                                                        openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(myvpn)[7499]: library versions: O                                                                                        penSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(openvpn)[7500]: OpenVPN 2.3.6 mip                                                                                        s-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 20                                                                                        16
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(openvpn)[7500]: library versions:                                                                                         OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(openvpn)[7500]: Diffie-Hellman in                                                                                        itialized with 2048 bit key
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(myvpn)[7499]: Diffie-Hellman init                                                                                        ialized with 2048 bit key
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(myvpn)[7499]: TLS-Auth MTU parms                                                                                         [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(myvpn)[7499]: Socket Buffers: R=[                                                                                        163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:39:11 2017 daemon.err openvpn(myvpn)[7499]: ERROR: Cannot open TUN                                                                                        /TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(myvpn)[7499]: Exiting due to fata                                                                                        l error
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(openvpn)[7500]: TLS-Auth MTU parm                                                                                        s [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(openvpn)[7500]: Socket Buffers: R                                                                                        =[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:39:11 2017 daemon.err openvpn(openvpn)[7500]: ERROR: Cannot open T                                                                                        UN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:39:11 2017 daemon.notice openvpn(openvpn)[7500]: Exiting due to fa                                                                                        tal error
Fri Sep  1 19:39:16 2017 daemon.warn openvpn(openvpn)[7504]: Warning: Error redi                                                                                        recting stdout/stderr to --log file: /var/log/openvpn/openvpn.log: No such file                                                                                         or directory (errno=2)
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(openvpn)[7504]: OpenVPN 2.3.6 mip                                                                                        s-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 20                                                                                        16
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(openvpn)[7504]: library versions:                                                                                         OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(openvpn)[7504]: Diffie-Hellman in                                                                                        itialized with 2048 bit key
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(openvpn)[7504]: TLS-Auth MTU parm                                                                                        s [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(openvpn)[7504]: Socket Buffers: R                                                                                        =[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:39:16 2017 daemon.err openvpn(openvpn)[7504]: ERROR: Cannot open T                                                                                        UN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(openvpn)[7504]: Exiting due to fa                                                                                        tal error
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(myvpn)[7503]: OpenVPN 2.3.6 mips-                                                                                        openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(myvpn)[7503]: library versions: O                                                                                        penSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(myvpn)[7503]: Diffie-Hellman init                                                                                        ialized with 2048 bit key
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(myvpn)[7503]: TLS-Auth MTU parms                                                                                         [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(myvpn)[7503]: Socket Buffers: R=[                                                                                        163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:39:16 2017 daemon.err openvpn(myvpn)[7503]: ERROR: Cannot open TUN                                                                                        /TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:39:16 2017 daemon.notice openvpn(myvpn)[7503]: Exiting due to fata                                                                                        l error
Fri Sep  1 19:39:21 2017 daemon.warn openvpn(openvpn)[7505]: Warning: Error redi                                                                                        recting stdout/stderr to --log file: /var/log/openvpn/openvpn.log: No such file                                                                                         or directory (errno=2)
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(openvpn)[7505]: OpenVPN 2.3.6 mip                                                                                        s-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 20                                                                                        16
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(openvpn)[7505]: library versions:                                                                                         OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(openvpn)[7505]: Diffie-Hellman in                                                                                        itialized with 2048 bit key
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(openvpn)[7505]: TLS-Auth MTU parm                                                                                        s [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(openvpn)[7505]: Socket Buffers: R                                                                                        =[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:39:21 2017 daemon.err openvpn(openvpn)[7505]: ERROR: Cannot open T                                                                                        UN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(openvpn)[7505]: Exiting due to fa                                                                                        tal error
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(myvpn)[7507]: OpenVPN 2.3.6 mips-                                                                                        openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(myvpn)[7507]: library versions: O                                                                                        penSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(myvpn)[7507]: Diffie-Hellman init                                                                                        ialized with 2048 bit key
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(myvpn)[7507]: TLS-Auth MTU parms                                                                                         [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(myvpn)[7507]: Socket Buffers: R=[                                                                                        163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:39:21 2017 daemon.err openvpn(myvpn)[7507]: ERROR: Cannot open TUN                                                                                        /TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:39:21 2017 daemon.notice openvpn(myvpn)[7507]: Exiting due to fata                                                                                        l error</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364759">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						1 Sep 2017, 20:50					</div>
				</div>
				<div class="post-content content">
					<p>okay, fixed the /var/log/openvpn error<br />created the folder and added more privileges.<br />Now i get a openvpn log:</p><div class="codebox"><pre><code>Fri Sep  1 19:47:08 2017 us=809935 OpenVPN 2.3.6 mips-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:47:08 2017 us=810139 library versions: OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:47:08 2017 us=832959 Diffie-Hellman initialized with 2048 bit key
Fri Sep  1 19:47:08 2017 us=836721 TLS-Auth MTU parms [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:47:08 2017 us=836926 Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:47:08 2017 us=837789 ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:47:08 2017 us=837893 Exiting due to fatal error
Fri Sep  1 19:47:13 2017 us=849876 OpenVPN 2.3.6 mips-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:47:13 2017 us=850066 library versions: OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:47:13 2017 us=852812 Diffie-Hellman initialized with 2048 bit key
Fri Sep  1 19:47:13 2017 us=856664 TLS-Auth MTU parms [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:47:13 2017 us=856868 Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:47:13 2017 us=857747 ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:47:13 2017 us=857851 Exiting due to fatal error
Fri Sep  1 19:47:18 2017 us=871195 OpenVPN 2.3.6 mips-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:47:18 2017 us=871387 library versions: OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:47:18 2017 us=874084 Diffie-Hellman initialized with 2048 bit key
Fri Sep  1 19:47:18 2017 us=877754 TLS-Auth MTU parms [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:47:18 2017 us=877962 Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:47:18 2017 us=879513 ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:47:18 2017 us=879626 Exiting due to fatal error
Fri Sep  1 19:47:23 2017 us=902930 OpenVPN 2.3.6 mips-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:47:23 2017 us=903118 library versions: OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:47:23 2017 us=905797 Diffie-Hellman initialized with 2048 bit key
Fri Sep  1 19:47:23 2017 us=909521 TLS-Auth MTU parms [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:47:23 2017 us=909728 Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:47:23 2017 us=920751 ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:47:23 2017 us=920892 Exiting due to fatal error
Fri Sep  1 19:47:28 2017 us=933910 OpenVPN 2.3.6 mips-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:47:28 2017 us=934097 library versions: OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:47:28 2017 us=936805 Diffie-Hellman initialized with 2048 bit key
Fri Sep  1 19:47:28 2017 us=950676 TLS-Auth MTU parms [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:47:28 2017 us=950932 Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:47:28 2017 us=951948 ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:47:28 2017 us=952072 Exiting due to fatal error
Fri Sep  1 19:47:33 2017 us=965026 OpenVPN 2.3.6 mips-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Fri Sep  1 19:47:33 2017 us=965217 library versions: OpenSSL 1.0.2j  26 Sep 2016, LZO 2.08
Fri Sep  1 19:47:33 2017 us=967903 Diffie-Hellman initialized with 2048 bit key
Fri Sep  1 19:47:33 2017 us=981727 TLS-Auth MTU parms [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]
Fri Sep  1 19:47:33 2017 us=981960 Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]
Fri Sep  1 19:47:33 2017 us=982937 ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)
Fri Sep  1 19:47:33 2017 us=983063 Exiting due to fatal error</code></pre></div><p>gonna search how to create a TUN file.<br /></p><div class="codebox"><pre><code>ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364760">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						1 Sep 2017, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>It is strange, that it tries to use device tun, it should use device tun0.<br />Start with changing<br /></p><div class="codebox"><pre><code>        option dev &#039;tun&#039;</code></pre></div><p>by<br /></p><div class="codebox"><pre><code>        option dev &#039;tun0&#039;</code></pre></div><p>Can you see device tun0 in output of <br /></p><div class="codebox"><pre><code>ifconfig</code></pre></div><p>?</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 1 Sep 2017, 21:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364761">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						1 Sep 2017, 21:19					</div>
				</div>
				<div class="post-content content">
					<p>So all my changes of /etc/config/openvpn</p><div class="codebox"><pre><code>config openvpn &#039;myvpn&#039;
        option enabled &#039;1&#039;
        option port &#039;1194&#039;
        option proto &#039;udp&#039;
        option dev &#039;tun0&#039;
        option ca &#039;/etc/easy-rsa/keys/ca.crt&#039;
        option cert &#039;/etc/easy-rsa/keys/server.crt&#039;
        option key &#039;/etc/easy-rsa/keys/server.key&#039;
        option dh &#039;/etc/easy-rsa/keys/dh2048.pem&#039;
        option ifconfig_pool_persist &#039;/tmp/ipp.txt&#039;
        option keepalive &#039;10 120&#039;
        option comp_lzo &#039;no&#039;
        option persist_key &#039;1&#039;
        option persist_tun &#039;1&#039;
        option status &#039;/var/log/openvpn-status.log&#039;
        option verb &#039;5&#039;
        option server &#039;10.0.0.0 255.255.255.0&#039;
        option client_to_client &#039;1&#039;
        list push &#039;redirect-gateway def1&#039;
        list push &#039;dhcp-option DNS 192.168.1.254&#039;
        list push &#039;route 192.168.1.0 255.255.255.0&#039;
        option enabled &#039;1&#039;</code></pre></div><p><strong>no tun0 in my ifconfig..</strong></p><p>and after a reboot the folder: /var/log/openvpn is gone.<br />i read that i need the permissions of the ./var folder cause it is read only?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364762">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						1 Sep 2017, 21:22					</div>
				</div>
				<div class="post-content content">
					<p>/var is a link to /tmp, which is a RAM disk.&nbsp; It will all be erased on reboot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364763">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						1 Sep 2017, 21:37					</div>
				</div>
				<div class="post-content content">
					<p>Okay thanks, changed the directory to /etc/openvpn in server.conf, at least it will create a log file <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364764">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						1 Sep 2017, 21:54					</div>
				</div>
				<div class="post-content content">
					<p>Okay after some more research the problem is with kmod-tun package...<br />i deleted the package and tried to reinstall, i get the error:</p><div class="codebox"><pre><code>opkg install kmod-tun
Installing kmod-tun (3.18.23-1) to root...
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ar71xx/generic/packages/base/kmod-tun_3.18.23-1_ar71xx.ipk.
Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-tun:
 *      kernel (= 3.18.23-1-b2f200610f46d20ef52d269421369d0c) *
 * opkg_install_cmd: Cannot install package kmod-tun.</code></pre></div><p>it seems the package has the wrong kernel <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364767">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						1 Sep 2017, 23:26					</div>
				</div>
				<div class="post-content content">
					<p>Try trunk version: package kernel-tun is in kernel folder, not base.<br /><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/kernel/kmod-tun_4.4.14-1_ar71xx.ipk">http://downloads.openwrt.org/snapshots/ … ar71xx.ipk</a></p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 1 Sep 2017, 23:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364865">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">MrHpower</div>
					<div class="post-datetime">
						3 Sep 2017, 20:27					</div>
				</div>
				<div class="post-content content">
					<p>Finally i got it working!! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I installed LEDE on my router cause of the problem with virtual tun creation..</p><p>After that i had some problems starting openvpn and my certificates where gone.<br />Reinstalled Openvpn and rebuild my certificates on my laptop.<br />Had some problem with the client.crt cause of the index.txt wasn&#039;t empty (delete the content with admin privileges).</p><p>I could make a vpn connection but couldn&#039;t get connected to anything else.<br />searching in the log i saw that the comp-lzo wasn&#039;t the same on local en server side.<br />reconfiguration with on both side &quot;comp-lzo yes&quot;, it works all smoothly and well.</p><p>The only thing i have left is:<br /></p><div class="codebox"><pre><code>MULTI: bad source address from client [::], packet dropped</code></pre></div><p>Thanks for all the advice and especially the command logread -e openvpn will never forget it, thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364868">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						3 Sep 2017, 23:43					</div>
				</div>
				<div class="post-content content">
					<p>You get the message as it, or in </p><div class="codebox"><pre><code>[::]</code></pre></div><p> is real IP of client? It should be real IP, so OpenVPN-server (router) doesn&#039;t have route to this network. Add route.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>