<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link TL-MR13U - small router with built-in 10,400 mAh battery</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Jun 2015 and 22 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 5</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=44755&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=44755&amp;p=5.html">5</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p204718">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						15 Jun 2013, 19:47					</div>
				</div>
				<div class="post-content content">
					<p>TP-Link got a nice wi-fi router with 10,400 mAh rechargeable battery - TP-Link TL-MR13U!</p><p>Oficial page:<br/><a href="http://www.tp-link.com.cn/product_150m_306.html">http://www.tp-link.com.cn/product_150m_306.html</a> (in Chinese)</p><p>Google Translated:<br/><a href="http://translate.google.com/translate?hl=en&amp;sl=zh-CN&amp;tl=en&amp;u=http%3A%2F%2Fwww.tp-link.com.cn%2Fproduct_150m_306.html">http://translate.google.com/translate?h … m_306.html</a></p><p>You can get it for about 45USD at AliExpress:<br/><a href="http://www.aliexpress.com/wholesale?SearchText=tl-mr13u">http://www.aliexpress.com/wholesale?SearchText=tl-mr13u</a></p><p>Anybody got this beauty? Any pictures of it? Any chance to get OpenWRT running on it?</p><p>It would be nice to have it with [Pirate|Library]Box!</p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 16 Jun 2013, 10:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204722">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kirschwasser</div>
					<div class="post-datetime">
						15 Jun 2013, 21:01					</div>
				</div>
				<div class="post-content content">
					<p>What is a Pirate/Library-Box anway???</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204724">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						15 Jun 2013, 22:35					</div>
				</div>
				<div class="post-content content">
					<p>PirateBox: <a href="http://wiki.daviddarts.com/PirateBox_DIY">http://wiki.daviddarts.com/PirateBox_DIY</a><br/>LibraryBox: <a href="http://jasongriffey.net/librarybox/">http://jasongriffey.net/librarybox/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204725">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						15 Jun 2013, 22:41					</div>
				</div>
				<div class="post-content content">
					<p>Picture of TP-Link TL-MR13U (from manufacturer&#039;s website):<br/><span class="postimg"><img src="http://www.tp-link.com.cn/content/images/products/532px/face/TL-MR13U.jpg" alt="http://www.tp-link.com.cn/content/images/products/532px/face/TL-MR13U.jpg"/></span></p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 15 Jun 2013, 22:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204771">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">kirschwasser</div>
					<div class="post-datetime">
						16 Jun 2013, 19:41					</div>
				</div>
				<div class="post-content content">
					<p>So, PirateBox = opkg-package for OpenWrt + configuration for OpenWrt of kind of Captive Portal + direct connect hub + IRC server /other chat server / forum software</p><p>And LibraryBox = it what? and why do they use the piratebox-logo: <a href="https://github.com/griffey/LibraryBox/blob/master/piratebox-logo.png">https://github.com/griffey/LibraryBox/b … x-logo.png</a></p>											<p class="post-edited">(Last edited by <strong>kirschwasser</strong> on 16 Jun 2013, 19:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204774">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						16 Jun 2013, 20:46					</div>
				</div>
				<div class="post-content content">
					<p>Yes, you are right - PirateBox is a captive portal with file sharing and anonymous chat.</p><p>PirateBox has several follow-up/similar projects, LibraryBox is one of them. Take a look at very end of this page - <a href="http://daviddarts.com/piratebox/">http://daviddarts.com/piratebox/</a></p><p>LibraryBox is designed for legal file distribution in libraries, no chart.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204782">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">kirschwasser</div>
					<div class="post-datetime">
						16 Jun 2013, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>Hm, GPLv3, so why isn&#039;t it available in the OpenWrt-Repository?</p><p>I couldn&#039;t find a link to the source-code.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204784">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						16 Jun 2013, 23:05					</div>
				</div>
				<div class="post-content content">
					<p>Yeah, it is quite challenging&nbsp; to find a link to source code. Maybe because all these project based on Droopy (<a href="http://stackp.online.fr/droopy">http://stackp.online.fr/droopy</a>). It was hard, but I found these links to source code:<br/>PirateBox - <a href="https://github.com/cr/mkPirateBox">https://github.com/cr/mkPirateBox</a><br/>LibraryBox - <a href="https://github.com/griffey/LibraryBox">https://github.com/griffey/LibraryBox</a></p><p>You can write to authors asking to publish source code. It would be nice if they publish direct links to latest versions.</p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 16 Jun 2013, 23:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204918">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">jmac928</div>
					<div class="post-datetime">
						17 Jun 2013, 21:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>otlabs wrote:</cite><blockquote><p>Yeah, it is quite challenging&nbsp; to find a link to source code. Maybe because all these project based on Droopy (<a href="http://stackp.online.fr/droopy">http://stackp.online.fr/droopy</a>). It was hard, but I found these links to source code:<br/>PirateBox - <a href="https://github.com/cr/mkPirateBox">https://github.com/cr/mkPirateBox</a><br/>LibraryBox - <a href="https://github.com/griffey/LibraryBox">https://github.com/griffey/LibraryBox</a></p><p>You can write to authors asking to publish source code. It would be nice if they publish direct links to latest versions.</p></blockquote></div><p>How can i share info here and in open wrt hardware page about PirateBox and libraryBox</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204937">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						18 Jun 2013, 00:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmac928 wrote:</cite><blockquote><p>How can i share info here and in open wrt hardware page about PirateBox and libraryBox</p></blockquote></div><p>You need to register at OpenWRT wiki to be able create/edit pages. It is a separate registration. Credential you have for forum are not working for wiki. Visit <a href="http://wiki.openwrt.org/start?do=register">http://wiki.openwrt.org/start?do=register</a> and register yourself.</p><p>Then learn a bit about how to use wiki - <a href="http://wiki.openwrt.org/meta/start.">http://wiki.openwrt.org/meta/start.</a></p><p>You can also start a new thread about [Pirate|Library]Box in General Discussion (if it was not already done).</p><p>Good luck! And thank you for contributing!</p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 18 Jun 2013, 00:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204945">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">jmac928</div>
					<div class="post-datetime">
						18 Jun 2013, 06:57					</div>
				</div>
				<div class="post-content content">
					<p>New PirateBox &amp; LibraryBox Topic</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=44803">https://forum.openwrt.org/viewtopic.php?id=44803</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205268">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">jmac928</div>
					<div class="post-datetime">
						21 Jun 2013, 18:37					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/toh/tp-link/tl-mr10u#piratebox.and.librarybox.support">http://wiki.openwrt.org/toh/tp-link/tl- … ox.support</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205651">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">MaStr</div>
					<div class="post-datetime">
						25 Jun 2013, 15:19					</div>
				</div>
				<div class="post-content content">
					<p>moved the &quot;about PirateBox&quot;-post over to the PirateBox thread.</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=205652#p205652">https://forum.openwrt.org/viewtopic.php … 52#p205652</a></p><p>(sorry)</p>											<p class="post-edited">(Last edited by <strong>MaStr</strong> on 25 Jun 2013, 15:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206746">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">kamwanlai</div>
					<div class="post-datetime">
						8 Jul 2013, 21:16					</div>
				</div>
				<div class="post-content content">
					<p>I have running openwrt on tl-mr13u.It works well.</p><p>Click <a href="http://pan.baidu.com/share/link?shareid=4253606529&amp;uk=4046777419">here</a> to download the firmware(rev36674) and packages OR <a href="http://pan.baidu.com/share/link?shareid=879403506&amp;uk=4046777419"> here </a> to download what you want.</p><p>Here is how I change on openwrt source base r36674.(git diff output)You can download this file from <a href="http://pan.baidu.com/share/link?shareid=968576279&amp;uk=4046777419">here</a></p><div class="codebox"><pre><code>diff --git a/package/libs/popt/Makefile b/package/libs/popt/Makefile
index 1cdcc40..f4c1ff2 100644
--- a/package/libs/popt/Makefile
+++ b/package/libs/popt/Makefile
@@ -15,7 +15,7 @@ PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
 PKG_SOURCE_URL:=http://downloads.openwrt.org/sources/
 PKG_MD5SUM:=5988e7aeb0ae4dac8d83561265984cc9
 
-PKG_FIXUP:=autoreconf
+PKG_FIXUP:=autoreconf libtool
 PKG_REMOVE_FILES:=autogen.sh aclocal.m4
 
 PKG_INSTALL:=1
diff --git a/target/linux/ar71xx/base-files/etc/diag.sh b/target/linux/ar71xx/base-files/etc/diag.sh
index ed269b2..d6ad4c3 100755
--- a/target/linux/ar71xx/base-files/etc/diag.sh
+++ b/target/linux/ar71xx/base-files/etc/diag.sh
@@ -134,6 +134,7 @@ get_status_led() {
         ;;
     tl-wdr4300 | \
     tl-wr703n | \
+    tl-mr13u | \
     tl-wr720n-v3)
         status_led=&quot;tp-link:blue:system&quot;
         ;;
diff --git a/target/linux/ar71xx/base-files/etc/uci-defaults/02_network b/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
index a9a3ff2..ed830e4 100755
--- a/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
+++ b/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
@@ -200,6 +200,7 @@ tl-mr3040 |\
 tl-wa901nd |\
 tl-wa901nd-v2 |\
 tl-wr703n |\
+tl-mr13u |\
 wndap360 |\
 wp543)
     ucidef_set_interface_lan &quot;eth0&quot;
diff --git a/target/linux/ar71xx/base-files/lib/ar71xx.sh b/target/linux/ar71xx/base-files/lib/ar71xx.sh
index 194a40b..98ca034 100755
--- a/target/linux/ar71xx/base-files/lib/ar71xx.sh
+++ b/target/linux/ar71xx/base-files/lib/ar71xx.sh
@@ -132,6 +132,9 @@ tplink_board_detect() {
     &quot;254300&quot;*)
         model=&quot;TP-Link TL-WR2543N/ND&quot;
         ;;
+    &quot;001301&quot;*)
+        model=&quot;TP-Link TL-MR13U&quot;
+        ;;
     &quot;110101&quot;*)
         model=&quot;TP-Link TL-MR11U&quot;
         ;;
@@ -441,6 +444,9 @@ ar71xx_board_detect() {
     *&quot;TL-WR720N v3&quot;)
         name=&quot;tl-wr720n-v3&quot;
         ;;
+    *&quot;TL-MR13U v1&quot;)
+        name=&quot;tl-mr13u&quot;
+        ;;
     *&quot;TL-MR11U&quot;)
         name=&quot;tl-mr11u&quot;
         ;;
diff --git a/target/linux/ar71xx/base-files/lib/upgrade/platform.sh b/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
index 817123b..32bf8f4 100755
--- a/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
+++ b/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
@@ -155,6 +155,7 @@ platform_check_image() {
         return 1
         ;;
     tl-mr11u | \
+    tl-mr13u | \
     tl-mr3020 | \
     tl-mr3040 | \
     tl-mr3220 | \
diff --git a/target/linux/ar71xx/config-3.8 b/target/linux/ar71xx/config-3.8
index ea2be6b..44a85b2 100644
--- a/target/linux/ar71xx/config-3.8
+++ b/target/linux/ar71xx/config-3.8
@@ -61,6 +61,7 @@ CONFIG_ATH79_MACH_RW2458N=y
 CONFIG_ATH79_MACH_TEW_632BRP=y
 CONFIG_ATH79_MACH_TEW_673GRU=y
 CONFIG_ATH79_MACH_TEW_712BR=y
+CONFIG_ATH79_MACH_TL_MR13U=y
 CONFIG_ATH79_MACH_TL_MR11U=y
 CONFIG_ATH79_MACH_TL_MR3020=y
 CONFIG_ATH79_MACH_TL_MR3X20=y
diff --git a/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c b/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
new file mode 100644
index 0000000..42e9fce
--- /dev/null
+++ b/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
@@ -0,0 +1,108 @@
+/*
+ *  TP-LINK TL-MR13U board support
+ *
+ *  Copyright (C) 2011 dongyuqi &lt;729650915@qq.com&gt;
+ *  Copyright (C) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;
+ *
+ *  This program is free software; you can redistribute it and/or modify it
+ *  under the terms of the GNU General Public License version 2 as published
+ *  by the Free Software Foundation.
+ */
+
+#include &lt;linux/gpio.h&gt;
+
+#include &lt;asm/mach-ath79/ath79.h&gt;
+
+#include &quot;dev-eth.h&quot;
+#include &quot;dev-gpio-buttons.h&quot;
+#include &quot;dev-leds-gpio.h&quot;
+#include &quot;dev-m25p80.h&quot;
+#include &quot;dev-usb.h&quot;
+#include &quot;dev-wmac.h&quot;
+#include &quot;machtypes.h&quot;
+
+#define TL_MR13U_GPIO_LED_SYSTEM    27
+
+#define TL_MR13U_GPIO_BTN_RESET    11
+#define TL_MR13U_GPIO_BTN_SW1    6
+#define TL_MR13U_GPIO_BTN_SW2    7
+
+#define TL_MR13U_GPIO_USB_POWER    18
+
+#define TL_MR13U_KEYS_POLL_INTERVAL    20    /* msecs */
+#define TL_MR13U_KEYS_DEBOUNCE_INTERVAL    (3 * TL_MR13U_KEYS_POLL_INTERVAL)
+
+static const char *tl_mr13u_part_probes[] = {
+    &quot;tp-link&quot;,
+    NULL,
+};
+
+static struct flash_platform_data tl_mr13u_flash_data = {
+    .part_probes    = tl_mr13u_part_probes,
+};
+
+static struct gpio_led tl_mr13u_leds_gpio[] __initdata = {
+    {
+        .name        = &quot;tp-link:blue:system&quot;,
+        .gpio        = TL_MR13U_GPIO_LED_SYSTEM,
+        .active_low    = 1,
+    },
+};
+
+static struct gpio_keys_button tl_mr13u_gpio_keys[] __initdata = {
+    {
+        .desc        = &quot;reset&quot;,
+        .type        = EV_KEY,
+        .code        = KEY_RESTART,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_RESET,
+        .active_low    = 0,
+    },
+    {
+        .desc        = &quot;sw1&quot;,
+        .type        = EV_KEY,
+        .code        = BTN_0,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_SW1,
+        .active_low    = 0,
+    },
+    {
+        .desc        = &quot;sw2&quot;,
+        .type        = EV_KEY,
+        .code        = BTN_1,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_SW2,
+        .active_low    = 0,
+    }
+
+};
+
+static void __init tl_mr13u_setup(void)
+{
+    u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);
+    u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);
+
+    /* disable PHY_SWAP and PHY_ADDR_SWAP bits */
+    ath79_setup_ar933x_phy4_switch(false, false);
+
+    ath79_register_m25p80(&amp;tl_mr13u_flash_data);
+    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_mr13u_leds_gpio),
+                 tl_mr13u_leds_gpio);
+    ath79_register_gpio_keys_polled(-1, TL_MR13U_KEYS_POLL_INTERVAL,
+                    ARRAY_SIZE(tl_mr13u_gpio_keys),
+                    tl_mr13u_gpio_keys);
+
+    gpio_request_one(TL_MR13U_GPIO_USB_POWER,
+             GPIOF_OUT_INIT_HIGH | GPIOF_EXPORT_DIR_FIXED,
+             &quot;USB power&quot;);
+    ath79_register_usb();
+
+    ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+
+    ath79_register_mdio(0, 0x0);
+    ath79_register_eth(0);
+    ath79_register_wmac(ee, mac);
+}
+
+MIPS_MACHINE(ATH79_MACH_TL_MR13U, &quot;TL-MR13U&quot;, &quot;TP-LINK TL-MR13U v1&quot;,
+         tl_mr13u_setup);
diff --git a/target/linux/ar71xx/generic/profiles/tp-link.mk b/target/linux/ar71xx/generic/profiles/tp-link.mk
index 4ac6ba9..9923d62 100644
--- a/target/linux/ar71xx/generic/profiles/tp-link.mk
+++ b/target/linux/ar71xx/generic/profiles/tp-link.mk
@@ -16,6 +16,17 @@ endef
 $(eval $(call Profile,TLMR11U))
 
 
+define Profile/TLMR13U
+    NAME:=TP-LINK TL-MR13U
+    PACKAGES:=kmod-usb-core kmod-usb2
+endef
+
+define Profile/TLMR13U/Description
+    Package set optimized for the TP-LINK TL-MR13U.
+endef
+$(eval $(call Profile,TLMR13U))
+
+
 define Profile/TLMR3020
     NAME:=TP-LINK TL-MR3020
     PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
diff --git a/target/linux/ar71xx/image/Makefile b/target/linux/ar71xx/image/Makefile
index c6b4dc4..058c570 100644
--- a/target/linux/ar71xx/image/Makefile
+++ b/target/linux/ar71xx/image/Makefile
@@ -929,6 +929,7 @@ $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR1043,tl-wr1043nd-v1,TL-WR104
 
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR11UV1,tl-mr11u-v1,TL-MR11U,ttyATH0,115200,0x00110101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR11UV2,tl-mr11u-v2,TL-MR11U,ttyATH0,115200,0x00110102,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR13U,tl-mr13u-v1,TL-MR13U,ttyATH0,115200,0x00130101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-MR3220-v2,ttyATH0,115200,0x32200002,1,4Mlzma))
diff --git a/target/linux/ar71xx/patches-3.8/920-add-tl-mr13u-support.patch b/target/linux/ar71xx/patches-3.8/920-add-tl-mr13u-support.patch
new file mode 100644
index 0000000..3cca7ac
--- /dev/null
+++ b/target/linux/ar71xx/patches-3.8/920-add-tl-mr13u-support.patch
@@ -0,0 +1,46 @@
+Index: linux-3.8.12/arch/mips/ath79/Kconfig
+===================================================================
+--- linux-3.8.12.orig/arch/mips/ath79/Kconfig    2013-06-30 19:30:23.355712506 +0000
++++ linux-3.8.12/arch/mips/ath79/Kconfig    2013-06-30 19:34:17.719718265 +0000
+@@ -575,6 +575,17 @@
+     select ATH79_DEV_USB
+     select ATH79_DEV_WMAC
+ 
++config ATH79_MACH_TL_MR13U
++    bool &quot;TP-LINK TL-MR13U support&quot;
++    select SOC_AR933X
++    select ATH79_DEV_ETH
++    select ATH79_DEV_GPIO_BUTTONS
++    select ATH79_DEV_LEDS_GPIO
++    select ATH79_DEV_M25P80
++    select ATH79_DEV_USB
++    select ATH79_DEV_WMAC
++
++
+ config ATH79_MACH_TL_WR720N_V3
+     bool &quot;TP-LINK TL-WR720N v3 support&quot;
+     select SOC_AR933X
+Index: linux-3.8.12/arch/mips/ath79/Makefile
+===================================================================
+--- linux-3.8.12.orig/arch/mips/ath79/Makefile    2013-06-30 19:30:23.355712506 +0000
++++ linux-3.8.12/arch/mips/ath79/Makefile    2013-06-30 19:35:54.835720651 +0000
+@@ -93,6 +93,7 @@
+ obj-$(CONFIG_ATH79_MACH_TL_WR1043ND)    += mach-tl-wr1043nd.o
+ obj-$(CONFIG_ATH79_MACH_TL_WR2543N)    += mach-tl-wr2543n.o
+ obj-$(CONFIG_ATH79_MACH_TL_WR703N)    += mach-tl-wr703n.o
++obj-$(CONFIG_ATH79_MACH_TL_MR13U)    += mach-tl-mr13u.o
+ obj-$(CONFIG_ATH79_MACH_TL_WR720N_V3)    += mach-tl-wr720n-v3.o
+ obj-$(CONFIG_ATH79_MACH_UBNT)        += mach-ubnt.o
+ obj-$(CONFIG_ATH79_MACH_UBNT_XM)    += mach-ubnt-xm.o
+Index: linux-3.8.12/arch/mips/ath79/machtypes.h
+===================================================================
+--- linux-3.8.12.orig/arch/mips/ath79/machtypes.h    2013-06-30 19:30:23.355712506 +0000
++++ linux-3.8.12/arch/mips/ath79/machtypes.h    2013-06-30 19:37:00.523722265 +0000
+@@ -94,6 +94,7 @@
+     ATH79_MACH_TL_WR1043ND,        /* TP-LINK TL-WR1043ND */
+     ATH79_MACH_TL_WR2543N,        /* TP-LINK TL-WR2543N/ND */
+     ATH79_MACH_TL_WR703N,        /* TP-LINK TL-WR703N */
++    ATH79_MACH_TL_MR13U,        /* TP-LINK TL-MR13U */
+     ATH79_MACH_TL_WR720N_V3,    /* TP-LINK TL-WR720N v3 */
+     ATH79_MACH_TL_WR741ND,        /* TP-LINK TL-WR741ND */
+     ATH79_MACH_TL_WR741ND_V4,    /* TP-LINK TL-WR741ND  v4*/
diff --git a/tools/firmware-utils/src/mktplinkfw.c b/tools/firmware-utils/src/mktplinkfw.c
index 74a55fd..d27a238 100644
--- a/tools/firmware-utils/src/mktplinkfw.c
+++ b/tools/firmware-utils/src/mktplinkfw.c
@@ -43,6 +43,7 @@
 #define HWID_TL_WA901ND_V1    0x09010001
 #define HWID_TL_WA901ND_V2    0x09010002
 #define HWID_TL_WDR4900_V1    0x49000001
+#define HWID_TL_MR13U_V1    0x00130101
 #define HWID_TL_WR703N_V1    0x07030101
 #define HWID_TL_WR720N_V3    0x07200103
 #define HWID_TL_WR741ND_V1    0x07410001
@@ -343,6 +344,13 @@ static struct board_info boards[] = {
         .hw_rev        = 1,
         .layout_id    = &quot;4Mlzma&quot;,
     }, {
+        .id        = &quot;TL-MR13Uv1&quot;,
+        .hw_id        = HWID_TL_MR13U_V1,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+
+    }, {
+
         /* terminating entry */
     }
 };</code></pre></div>											<p class="post-edited">(Last edited by <strong>kamwanlai</strong> on 8 Jul 2013, 21:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206748">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						8 Jul 2013, 21:45					</div>
				</div>
				<div class="post-content content">
					<p>Wow. That looks like an awesome router!</p><p>Are both USB operational? Or is one of them charge only? Basically, can I use one USB port for a USB Flash Drive and another for USB Audio?</p><p>Thank you @kamwanlai. Hopefully we can get this router officially supported soon.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206750">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						8 Jul 2013, 21:59					</div>
				</div>
				<div class="post-content content">
					<p>Great job @kamwanlai! Thank you! I am waiting for my router to arrive!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206753">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						8 Jul 2013, 22:16					</div>
				</div>
				<div class="post-content content">
					<p>@kamwanlai: could you post OEM bootlog and OpenWRT bootlog? I will add them to wiki.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206756">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">kamwanlai</div>
					<div class="post-datetime">
						8 Jul 2013, 23:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>grayman4hire wrote:</cite><blockquote><p>Wow. That looks like an awesome router!</p><p>Are both USB operational? Or is one of them charge only? Basically, can I use one USB port for a USB Flash Drive and another for USB Audio?</p><p>Thank you @kamwanlai. Hopefully we can get this router officially supported soon.</p></blockquote></div><p>only one usb port can transfer data,the 2A output usb port is charge only.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206758">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">kamwanlai</div>
					<div class="post-datetime">
						9 Jul 2013, 00:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>otlabs wrote:</cite><blockquote><p>@kamwanlai: could you post OEM bootlog and OpenWRT bootlog? I will add them to wiki.</p></blockquote></div><p>I don&#039;t have serial cable to read OEM bootlog.</p><p>Here is OpenWRT bootlog.<br/></p><div class="codebox"><pre><code>Jan  1 00:00:33 OpenWrt syslog.info syslogd started: BusyBox v1.19.4
Jan  1 00:00:33 OpenWrt kern.notice kernel: klogd started: BusyBox v1.19.4 (2013-07-01 13:34:47 UTC)
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.000000] Linux version 3.8.12 (mint@mint) (gcc version 4.6.4 (OpenWrt/Linaro GCC 4.6-2012.12 r37092) ) #2 Mon Jul 1 13:58:26 UTC 2013
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.000000] MyLoader: sysp=fa89c804, boardp=69cd3b24, parts=31a09c82
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] bootconsole [early0] enabled
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] CPU revision is: 00019374 (MIPS 24Kc)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] SoC: Atheros AR9330 rev 1
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] Clocks: CPU:400.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] Determined physical RAM map:
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000]  memory: 02000000 @ 00000000 (usable)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] Initrd not found or empty - disabling initrd
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.000000] Zone ranges:
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.000000] Movable zone start for each node
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.000000] Early memory node ranges
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.000000]   node   0: [mem 0x00000000-0x01ffffff]
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.000000] On node 0 totalpages: 8192
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.000000] free_area_init_node: node 0, pgdat 8031ca20, node_mem_map 81000000
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.000000]   Normal zone: 64 pages used for memmap
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.000000]   Normal zone: 0 pages reserved
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.000000]   Normal zone: 8128 pages, LIFO batch:0
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.000000] pcpu-alloc: [0] 0 
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.000000] Kernel command line:  board=TL-MR13U console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.000000] __ex_table already sorted, skipping sort
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] Writing ErrCtl register=00000000
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] Readback ErrCtl register=00000000
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] Memory: 28720k/32768k available (2289k kernel code, 4048k reserved, 607k data, 236k init, 0k highmem)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.000000] NR_IRQS:51
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.080000] Calibrating delay loop... 265.42 BogoMIPS (lpj=1327104)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.080000] pid_max: default: 32768 minimum: 301
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.080000] Mount-cache hash table entries: 512
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.090000] NET: Registered protocol family 16
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.090000] MIPS: machine is TP-LINK TL-MR13U v1
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.350000] bio: create slab &lt;bio-0&gt; at 0
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.350000] Switching to clocksource MIPS
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.360000] NET: Registered protocol family 2
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.360000] TCP established hash table entries: 512 (order: 0, 4096 bytes)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.370000] TCP bind hash table entries: 512 (order: -1, 2048 bytes)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.370000] TCP: Hash tables configured (established 512 bind 512)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.380000] TCP: reno registered
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.380000] UDP hash table entries: 256 (order: 0, 4096 bytes)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.390000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.400000] NET: Registered protocol family 1
Jan  1 00:00:33 OpenWrt kern.debug kernel: [    0.400000] PCI: CLS 0 bytes, default 32
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.420000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.510000] 0x000000000000-0x000000020000 : &quot;u-boot&quot;
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.520000] 0x000000020000-0x000000121fbc : &quot;kernel&quot;
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.520000] mtd: partition &quot;kernel&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.530000] 0x000000121fbc-0x0000003f0000 : &quot;rootfs&quot;
Jan  1 00:00:33 OpenWrt kern.warn kernel: [    0.540000] mtd: partition &quot;rootfs&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.550000] mtd: partition &quot;rootfs&quot; set to be root filesystem
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.560000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=2D0000, len=120000 
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.560000] 0x0000002d0000-0x0000003f0000 : &quot;rootfs_data&quot;
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.570000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    0.580000] 0x000000020000-0x0000003f0000 : &quot;firmware&quot;
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.600000] libphy: ag71xx_mdio: probed
Jan  1 00:00:33 OpenWrt kern.info kernel: [    0.600000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:MII
Jan  1 00:00:33 OpenWrt kern.info kernel: [    1.150000] ag71xx ag71xx.0 eth0: connected to PHY at ag71xx-mdio.1:04 [uid=004dd041, driver=Generic PHY]
Jan  1 00:00:33 OpenWrt kern.info kernel: [    1.160000] TCP: cubic registered
Jan  1 00:00:33 OpenWrt kern.info kernel: [    1.160000] NET: Registered protocol family 17
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    1.170000] Bridge firewalling registered
Jan  1 00:00:33 OpenWrt kern.info kernel: [    1.170000] 8021q: 802.1Q VLAN Support v1.8
Jan  1 00:00:33 OpenWrt kern.info kernel: [    1.190000] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
Jan  1 00:00:33 OpenWrt kern.info kernel: [    1.190000] Freeing unused kernel memory: 236k freed
Jan  1 00:00:33 OpenWrt kern.info kernel: [    6.170000] eth0: link up (100Mbps/Full duplex)
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    6.780000] jffs2: notice: (458) jffs2_build_xattr_subsystem: complete building xattr subsystem, 19 of xdatum (1 unchecked, 18 orphan) and 28 of xref (0 dead, 18 orphan) found.
Jan  1 00:00:33 OpenWrt kern.notice kernel: [    7.540000] SCSI subsystem initialized
Jan  1 00:00:33 OpenWrt kern.info kernel: [    7.570000] usbcore: registered new interface driver usbfs
Jan  1 00:00:36 OpenWrt kern.info kernel: [   36.160000] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready
Jan  1 00:00:36 OpenWrt kern.info kernel: [   36.160000] device eth0 entered promiscuous mode
Jan  1 00:00:36 OpenWrt kern.info kernel: [   36.170000] IPv6: ADDRCONF(NETDEV_UP): br-lan: link is not ready
Jan  1 00:00:36 OpenWrt daemon.notice netifd: Interface &#039;lan&#039; is now up
Jan  1 00:00:36 OpenWrt daemon.notice netifd: Interface &#039;loopback&#039; is now up
Jan  1 00:00:36 OpenWrt user.notice firewall: Reloading firewall due to ifup of lan (br-lan)
Jan  1 00:00:36 OpenWrt kern.info kernel: [   36.740000] eth0: link up (100Mbps/Full duplex)
Jan  1 00:00:36 OpenWrt kern.info kernel: [   36.750000] br-lan: port 1(eth0) entered forwarding state
Jan  1 00:00:36 OpenWrt kern.info kernel: [   36.750000] br-lan: port 1(eth0) entered forwarding state
Jan  1 00:00:36 OpenWrt kern.info kernel: [   36.760000] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready
Jan  1 00:00:36 OpenWrt kern.info kernel: [   36.760000] IPv6: ADDRCONF(NETDEV_CHANGE): br-lan: link becomes ready
Jan  1 00:00:37 OpenWrt daemon.warn 6relayd[776]: Failed to relay to ff02::1%br-lan (Cannot assign requested address)
Jan  1 00:00:38 OpenWrt kern.info kernel: [   38.750000] br-lan: port 1(eth0) entered forwarding state</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206759">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						9 Jul 2013, 00:20					</div>
				</div>
				<div class="post-content content">
					<p>Thank you! Already updated wiki.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206898">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">jmac928</div>
					<div class="post-datetime">
						11 Jul 2013, 06:17					</div>
				</div>
				<div class="post-content content">
					<p>TL-MR13U&nbsp; &nbsp; US $40.83&nbsp; with free shipping world wide<br/><a href="http://www.aliexpress.com/item/TP-LINK150M-portable-3G-wireless-router-TL-MR13U-built-10400mAh-mobile-power-rFor-Phone-Tablet-PC/951579303.html">http://www.aliexpress.com/item/TP-LINK1 … 79303.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207029">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						12 Jul 2013, 22:23					</div>
				</div>
				<div class="post-content content">
					<p>My unit just arrived. I took some pictures of it: <a href="http://flic.kr/s/aHsjGNzqG5">http://flic.kr/s/aHsjGNzqG5</a></p><p>Now I am charging it, will test it later!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207201">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						15 Jul 2013, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>I went ahead and ordered one this weekend.</p><p>Hopefully someone will document the OpenWRT installation process by the time I get it. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207611">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						20 Jul 2013, 08:42					</div>
				</div>
				<div class="post-content content">
					<p>I got OpenWRT running on TP-Link TL-MR13U!!! I made a different patch based on <a href="https://lists.openwrt.org/pipermail/openwrt-devel/2013-July/020580.html,">https://lists.openwrt.org/pipermail/ope … 0580.html,</a> it is based on Bleeding Edge, r37237 (kernel 3.8.13):<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# uname -a
Linux OpenWrt 3.8.13 #1 Fri Jul 19 23:46:01 CDT 2013 mips GNU/Linux
root@OpenWrt:~# free
             total         used         free       shared      buffers
Mem:         29128        16476        12652            0         1500
-/+ buffers:              14976        14152
Swap:            0            0            0
root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.2M    208.0K   1008.0K  17% /
/dev/root                 1.8M      1.8M         0 100% /rom
tmpfs                    14.2M     52.0K     14.2M   0% /tmp
/dev/mtdblock3            1.2M    208.0K   1008.0K  17% /overlay
overlayfs:/overlay        1.2M    208.0K   1008.0K  17% /
tmpfs                   512.0K         0    512.0K   0% /dev</code></pre></div><p>Tomorrow I would like to build an image against latest trunk (with kernel 3.10.1). I would like to add extended support for buttons developed by @kamwanlai also.</p><p>I documented the install process and will publish it tomorrow (you just need to use OEM WebGUI and minor tweak).</p><p>Meanwhile if you want to test my build you can get all the files at MEGA:</p><p>20130719 (Folder Link, 34.5MB)<br/><a href="https://mega.co.nz/#F!lUI3wBjb!ezMX0G6yn5pUKbGTFzhOsw">https://mega.co.nz/#F!lUI3wBjb!ezMX0G6yn5pUKbGTFzhOsw</a></p><p>Update: I just plugged a USB flash drive and it was powered correctly, in dmesg I got an error:<br/></p><div class="codebox"><pre><code>[  803.180000] usb 1-1: new full-speed USB device number 2 using ehci-platform
[  808.300000] usb 1-1: device descriptor read/64, error -71</code></pre></div><p>Anyway, tomorrow I plan to switch to new kernel and will re-check this issue.</p>											<p class="post-edited">(Last edited by <strong>otlabs</strong> on 20 Jul 2013, 08:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207613">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">kamwanlai</div>
					<div class="post-datetime">
						20 Jul 2013, 10:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>otlabs wrote:</cite><blockquote><p>I got OpenWRT running on TP-Link TL-MR13U!!! I made a different patch based on <a href="https://lists.openwrt.org/pipermail/openwrt-devel/2013-July/020580.html,">https://lists.openwrt.org/pipermail/ope … 0580.html,</a> it is based on Bleeding Edge, r37237 (kernel 3.8.13):<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# uname -a
Linux OpenWrt 3.8.13 #1 Fri Jul 19 23:46:01 CDT 2013 mips GNU/Linux
root@OpenWrt:~# free
             total         used         free       shared      buffers
Mem:         29128        16476        12652            0         1500
-/+ buffers:              14976        14152
Swap:            0            0            0
root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.2M    208.0K   1008.0K  17% /
/dev/root                 1.8M      1.8M         0 100% /rom
tmpfs                    14.2M     52.0K     14.2M   0% /tmp
/dev/mtdblock3            1.2M    208.0K   1008.0K  17% /overlay
overlayfs:/overlay        1.2M    208.0K   1008.0K  17% /
tmpfs                   512.0K         0    512.0K   0% /dev</code></pre></div><p>Tomorrow I would like to build an image against latest trunk (with kernel 3.10.1). I would like to add extended support for buttons developed by @kamwanlai also.</p><p>I documented the install process and will publish it tomorrow (you just need to use OEM WebGUI and minor tweak).</p><p>Meanwhile if you want to test my build you can get all the files at MEGA:</p><p>20130719 (Folder Link, 34.5MB)<br/><a href="https://mega.co.nz/#F!lUI3wBjb!ezMX0G6yn5pUKbGTFzhOsw">https://mega.co.nz/#F!lUI3wBjb!ezMX0G6yn5pUKbGTFzhOsw</a></p><p>Update: I just plugged a USB flash drive and it was powered correctly, in dmesg I got an error:<br/></p><div class="codebox"><pre><code>[  803.180000] usb 1-1: new full-speed USB device number 2 using ehci-platform
[  808.300000] usb 1-1: device descriptor read/64, error -71</code></pre></div><p>Anyway, tomorrow I plan to switch to new kernel and will re-check this issue.</p></blockquote></div><p>I use this script to make the switch button work.<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/hotplug.d/button/99-switch-button
#!/bin/sh

if [ $ACTION == &quot;released&quot; ] ; then
        if [ $BUTTON == &quot;BTN_1&quot; ] ; then
                logger &quot;Slider ROUTER&quot;
                #YOUR COMMAND HERE
        elif [ $BUTTON == &quot;BTN_0&quot; ] ; then
                logger &quot;Slider 3G&quot;
                #YOUR COMMAND HERE
        fi
elif [ $BUTTON == &quot;BTN_0&quot; ] || [ $BUTTON == &quot;BTN_1&quot; ] ; then
        if grep -qe &quot;sw1.*in  hi&quot; /sys/kernel/debug/gpio ; then
                if grep -qe &quot;sw2.*in  hi&quot; /sys/kernel/debug/gpio ; then
                        logger &quot;Slider AP&quot;
                        #YOUR COMMAND HERE
                fi
        fi
fi</code></pre></div><p>In my case the usb port works well,here is dmesg log<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# logread -f
Jan  1 00:10:00 OpenWrt kern.info kernel: [  600.110000] usb 1-1: new high-speed USB device number 3 using ehci-platform
Jan  1 00:10:00 OpenWrt kern.info kernel: [  600.270000] scsi1 : usb-storage 1-1:1.0
Jan  1 00:10:01 OpenWrt kern.notice kernel: [  601.270000] scsi 1:0:0:0: Direct-Access     SKY      USB              1.00 PQ: 0 ANSI: 2
Jan  1 00:10:01 OpenWrt kern.notice kernel: [  601.280000] sd 1:0:0:0: [sda] 15663104 512-byte logical blocks: (8.01 GB/7.46 GiB)
Jan  1 00:10:01 OpenWrt kern.notice kernel: [  601.280000] sd 1:0:0:0: [sda] Write Protect is off
Jan  1 00:10:01 OpenWrt kern.debug kernel: [  601.290000] sd 1:0:0:0: [sda] Mode Sense: 23 00 00 00
Jan  1 00:10:01 OpenWrt kern.err kernel: [  601.290000] sd 1:0:0:0: [sda] No Caching mode page present
Jan  1 00:10:01 OpenWrt kern.err kernel: [  601.300000] sd 1:0:0:0: [sda] Assuming drive cache: write through
Jan  1 00:10:01 OpenWrt kern.err kernel: [  601.340000] sd 1:0:0:0: [sda] No Caching mode page present
Jan  1 00:10:01 OpenWrt kern.err kernel: [  601.340000] sd 1:0:0:0: [sda] Assuming drive cache: write through
Jan  1 00:10:02 OpenWrt kern.info kernel: [  602.340000]  sda: sda1 sda2
Jan  1 00:10:02 OpenWrt kern.err kernel: [  602.350000] sd 1:0:0:0: [sda] No Caching mode page present
Jan  1 00:10:02 OpenWrt kern.err kernel: [  602.350000] sd 1:0:0:0: [sda] Assuming drive cache: write through
Jan  1 00:10:02 OpenWrt kern.notice kernel: [  602.360000] sd 1:0:0:0: [sda] Attached SCSI removable disk</code></pre></div>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 5</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=44755&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=44755&amp;p=5.html">5</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>