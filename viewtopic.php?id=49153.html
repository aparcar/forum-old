<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> building package (openobex) raises: &quot;package &#039;udev&#039; not found&quot;</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p225996">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						22 Feb 2014, 14:38					</div>
				</div>
				<div class="post-content content">
					<p>hi,</p><p>I&#039;m struggling to build openobex as a open-wrt package (tp-link 3040 - sdk revision 388888)</p><p>i have build the sdk successfully and can build a simple package like this the one mentioned in <a href="https://forum.openwrt.org/viewtopic.php?id=43461">https://forum.openwrt.org/viewtopic.php?id=43461</a></p><p>i have read the various docs closely:</p><ul><li><p><a href="http://wiki.openwrt.org/doc/devel/packages">http://wiki.openwrt.org/doc/devel/packages</a></p></li><li><p><a href="http://wiki.openwrt.org/doc/howto/obtain.firmware.sdk">http://wiki.openwrt.org/doc/howto/obtain.firmware.sdk</a></p></li><li><p><a href="http://wiki.openwrt.org/doc/howtobuild/single.package">http://wiki.openwrt.org/doc/howtobuild/single.package</a></p></li></ul><p>i do as follow:</p><h5>Step 1</h5><p>download openobex tar from <a href="https://www.gitorious.org/openobex/pages/Home">https://www.gitorious.org/openobex/pages/Home</a> (i know i can make a makefile that also can download directly but i had problems to get it to extract right - so will focus on the build here)</p><br /><h5>Step 2</h5><p>create dir &lt;path to open-wrt&gt;/package/open-obex</p><br /><h5>Step 3</h5><p>place the extracted openobex dir here as openobex-mainline</p><h5>Step 4</h5><p>set up the make file as follow:</p><br /><div class="codebox"><pre><code>include $(TOPDIR)/rules.mk

PKG_NAME:=open-obex
PKG_VERSION:=1.7
PKG_RELEASE:=1

include $(INCLUDE_DIR)/package.mk
include $(INCLUDE_DIR)/cmake.mk


define Package/open-obex
    SECTION:=util
    CATEGORY:=Bluetooth
    TITLE:=Open Obex implementation
endef

define Package/knode/description
    Open Obex implementation
endef

define Build/Prepare
    mkdir -p $(PKG_BUILD_DIR)
    $(CP) ./openobex-mainline/* $(PKG_BUILD_DIR)/
endef

define Package/knode/install
    $(INSTALL_DIR) $(1)/usr/bin
    $(INSTALL_BIN) $(PKG_BUILD_DIR)/open-obex $(1)/usr/bin/
endef

$(eval $(call BuildPackage,open-obex))</code></pre></div><br /><h5>Step 4b</h5><p>In the Makelists.txt of open obex I have disabled the documentation building to keep things simple.</p><div class="codebox"><pre><code>...
option ( BUILD_DOCUMENTATION &quot;Build library and application documentation&quot; OFF)
...</code></pre></div><h5>Step 5</h5><p>so fare so good - now doing the building roughly lets compile:</p><br /><div class="codebox"><pre><code>$ make tools/install
$ make toolchain/install
$ package/open-obex/compile V=99</code></pre></div><p>then i got various complain about packages missing</p><div class="codebox"><pre><code>...
WARNING: skipping libssp -- package not selected     
WARNING: skipping libstdcpp -- package not selected
WARNING: skipping libpthread -- package not selected
WARNING: skipping libthread-db -- package not selected
WARNING: skipping librt -- package not selected
WARNING: skipping libgfortran -- package not selected   
WARNING: skipping ldd -- package not selected           
WARNING: skipping ldconfig -- package not selected     
...</code></pre></div><br /><p>enable it &#039;y&#039; through make menuconfig - some are hard to find <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> so i ended up just doing it directly in </p><p>&lt;path to open-wrt&gt;/.config and set &quot;=y&quot;</p><h5>Step 6</h5><p>clean and compile again $package/open-obex/{clean,compile} V=99</p><p>and still got complains about missing bluez / libusb and udev</p><p>bluez and libusb was easy -&gt;</p><br /><p>the compile and install bluez:</p><div class="codebox"><pre><code>$ make package/feeds/packages/bluez-utils/compile V=99
$ make package/feeds/packages/bluez-utils/compile V=99</code></pre></div><p>enable it in .config</p><p>the compile and install bluez:</p><div class="codebox"><pre><code>$ make package/libs/libusb/compile V=99
$ make package/libs/libusb/compile V=99</code></pre></div><p>enable it in .config</p><div class="codebox"><pre><code>$ make package/system/udev/compile V=99
$ make package/system/udev/install V=99</code></pre></div><p>enable it in .config</p><br /><h5>Step 6</h5><p>clean and compile again package/open-obex/{clean,compile} V=99</p><p>but udev kept being not found:</p><div class="codebox"><pre><code>...
-- checking for module &#039;bluez&#039;
--   found bluez, version 3.36
-- checking for module &#039;libusb-1.0&#039;
--   found libusb-1.0, version 1.0.9
-- Looking for libusb_get_device_list in /home/pelle/playground_openwrt/openwrt_trunk/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libusb-1.0.so
-- Looking for libusb_get_device_list in /home/pelle/playground_openwrt/openwrt_trunk/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libusb-1.0.so - found
-- Performing Test COMPILER_HAS_HIDDEN_INLINE_VISIBILITY
CMake Error at /home/pelle/playground_openwrt/openwrt_trunk/staging_dir/host/share/cmake-2.8/Modules/CheckCXXSourceCompiles.cmake:61 (try_compile):
  Unknown extension &quot;.cxx&quot; for file

    /home/pelle/playground_openwrt/openwrt_trunk/build_dir/target-mips_34kc_uClibc-0.9.33.2/open-obex-1.7/CMakeFiles/CMakeTmp/src.cxx

  try_compile() works only for enabled languages.  Currently these are:

    C

  See project() command to enable other languages.
Call Stack (most recent call first):
  /home/pelle/playground_openwrt/openwrt_trunk/staging_dir/host/share/cmake-2.8/Modules/CheckCXXCompilerFlag.cmake:40 (CHECK_CXX_SOURCE_COMPILES)
  CMakeModules/GenerateExportHeader.cmake:211 (check_cxx_compiler_flag)
  CMakeModules/GenerateExportHeader.cmake:365 (_test_compiler_hidden_visibility)
  lib/CMakeLists.txt:196 (generate_export_header)


-- Performing Test COMPILER_HAS_HIDDEN_INLINE_VISIBILITY - Failed
-- checking for module &#039;udev&#039;
--   package &#039;udev&#039; not found
-- Configuring incomplete, errors occurred!
See also &quot;/home/pelle/playground_openwrt/openwrt_trunk/build_dir/target-mips_34kc_uClibc-0.9.33.2/open-obex-1.7/CMakeFiles/CMakeOutput.log&quot;.
See also &quot;/home/pelle/playground_openwrt/openwrt_trunk/build_dir/target-mips_34kc_uClibc-0.9.33.2/open-obex-1.7/CMakeFiles/CMakeError.log&quot;.
make[2]: *** [/home/pelle/playground_openwrt/openwrt_trunk/build_dir/target-mips_34kc_uClibc-0.9.33.2/open-obex-1.7/.configured_] Error 1
make[2]: Leaving directory `/home/pelle/playground_openwrt/openwrt_trunk/package/open-obex&#039;
make[1]: *** [package/open-obex/compile] Error 2
make[1]: Leaving directory `/home/pelle/playground_openwrt/openwrt_trunk&#039;
make: *** [package/open-obex/compile] Error 2
...</code></pre></div><p>any suggestions / hints are warmly appreciated!</p><p>//</p><p>pelle</p>											<p class="post-edited">(Last edited by <strong>pellekrogholt</strong> on 23 Feb 2014, 22:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226078">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						23 Feb 2014, 19:09					</div>
				</div>
				<div class="post-content content">
					<p>It looks like udev.pc is in the wrong(?) path</p><div class="codebox"><pre><code>find . -iname &quot;libusb-1.0.pc&quot;
find . -iname &quot;udev.pc&quot;</code></pre></div><p>notice the difference</p><p>I added to package/system/udev/Makefile in section InstallDev:<br /></p><div class="codebox"><pre><code>$(CP) $(PKG_INSTALL_DIR)/usr/share/pkgconfig/udev.pc $(1)/usr/lib/pkgconfig</code></pre></div><p>at the end</p><div class="codebox"><pre><code>## be more verbose with cmake
VERBOSE=1 make package/feeds/packages/openobex/configure V=s

-- Performing Test COMPILER_HAS_HIDDEN_INLINE_VISIBILITY - Failed
-- checking for module &#039;udev&#039;
--   found udev, version 173
-- Configuring incomplete, errors occurred!</code></pre></div><p>Makefile:<br /></p><div class="codebox"><pre><code>#
# Copyright (C) 2014 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#

include $(TOPDIR)/rules.mk

PKG_NAME:=openobex
PKG_VERSION:=1.7.1
PKG_RELEASE:=1

PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
PKG_SOURCE_SUBDIR:=$(PKG_NAME)-$(PKG_VERSION)
PKG_SOURCE_URL:=git://gitorious.org/openobex/mainline.git
PKG_SOURCE_VERSION:=2e1c0fc5a8f5e41886141a6b402d00db735ccf49
PKG_MD5SUM:=2e1c0fc5a8f5e41886141a6b402d00db735ccf49

CMAKE_INSTALL:=1

include $(INCLUDE_DIR)/package.mk
include $(INCLUDE_DIR)/cmake.mk

define Package/openobex
  SECTION:=utils
  CATEGORY:=Utilities
  DEPENDS:=+libusb-1.0 +bluez-libs +udev +libxml2
  TITLE:=Free open source implementation of the Object Exchange (OBEX) protocol.
  URL:=https://gitorious.org/openobex
endef

# libxml2 : xmllint ?
# udev detected if udev Makefile modified

CMAKE_OPTIONS += \
        -DCMAKE_BUILD_TYPE=MinSizeRel \
        -DBUILD_DOCUMENTATION:BOOL=OFF \
        -DCMAKE_VERBOSE_MAKEFILE:BOOL=TRUE

$(eval $(call BuildPackage,openobex))</code></pre></div><p>running <br />make package/feeds/packages/openobex/compile<br />a second time generates output files with the incomplete config</p><p>But the configure still errors out on the cxx test - I dont know if its really needed or can be deactivated</p>											<p class="post-edited">(Last edited by <strong>zloop</strong> on 23 Feb 2014, 19:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226111">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						23 Feb 2014, 22:53					</div>
				</div>
				<div class="post-content content">
					<p>hi zloop,</p><p>thanks a lot for your feedback and for a sane Makefile - i have done the above and now get the udev build niecely! - but ends with compile errors...</p><br /><div class="codebox"><pre><code>make package/openobex/compile V=99
...
-- Performing Test COMPILER_HAS_HIDDEN_INLINE_VISIBILITY - Failed
-- checking for module &#039;udev&#039;
--   found udev, version 173
-- Configuring incomplete, errors occurred!
See also &quot;/home/pelle/playground_openwrt/openwrt_trunk/build_dir/target-mips_34kc_uClibc-0.9.33.2/openobex-1.7.1/CMakeFiles/CMakeOutput.log&quot;.
See also &quot;/home/pelle/playground_openwrt/openwrt_trunk/build_dir/target-mips_34kc_uClibc-0.9.33.2/openobex-1.7.1/CMakeFiles/CMakeError.log&quot;.
make[2]: *** [/home/pelle/playground_openwrt/openwrt_trunk/build_dir/target-mips_34kc_uClibc-0.9.33.2/openobex-1.7.1/.configured_] Error 1
make[2]: Leaving directory `/home/pelle/playground_openwrt/openwrt_trunk/package/openobex&#039;
make[1]: *** [package/openobex/compile] Error 2
make[1]: Leaving directory `/home/pelle/playground_openwrt/openwrt_trunk&#039;
make: *** [package/openobex/compile] Error 2</code></pre></div><p>i&#039;m not 100% sure when you say</p><div class="quotebox"><blockquote><p>But the configure still errors out on the cxx test - I dont know if its really needed or can be deactivated</p></blockquote></div><p>how / where do i deactive .... ?</p><p>thx</p><p>//</p><p>pelle</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226141">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						24 Feb 2014, 10:33					</div>
				</div>
				<div class="post-content content">
					<p>another thing i realized with fresh eyes that i kind of skipped the step</p><div class="codebox"><pre><code>VERBOSE=1 make package/feeds/packages/openobex/configure V=s</code></pre></div><p>didn&#039;t play well it should be ?</p><div class="codebox"><pre><code>VERBOSE=1 make package/openobex/configure V=s</code></pre></div><br /><p>how do i get the openobex*.ipk file created? - i tried in .config:</p><div class="codebox"><pre><code>...
CONFIG_PACKAGE_openobex=y
...</code></pre></div><p>or</p><div class="codebox"><pre><code>...
CONFIG_PACKAGE_openobex=m
...</code></pre></div><p>well i&#039;m a newbie on the open-wrt package building so forgive me for the naive questions...</p><p>thx</p><p>//</p><p>pelle</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226142">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						24 Feb 2014, 10:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pellekrogholt wrote:</cite><blockquote><p>how do i get the openobex*.ipk file created? - i tried in .config:</p></blockquote></div><p>make package/openobex/compile V=s</p><p>both =y and =m should work for creating the .ipk.<br />=m just makes the package, but it does not get included in the firmware binary<br />=y compiles the package and it will be icluded in the firmware image</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 24 Feb 2014, 10:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226153">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						24 Feb 2014, 13:16					</div>
				</div>
				<div class="post-content content">
					<p>hi hnyman,</p><p>thanks a lot for the clarification about y vs. m.</p><p>lets say in .config&nbsp; i have set:</p><div class="codebox"><pre><code>...
CONFIG_PACKAGE_openobex=y
...</code></pre></div><p>i have done :</p><div class="codebox"><pre><code>...
make package/openobex/compile V=99
...
make package/openobex/install V=99</code></pre></div><p>then:</p><div class="codebox"><pre><code>looking in ls bin/ar71xx/packages/ and or

find . -iname &quot;*obex*.ipk&quot;

&lt;empty / no results&gt;</code></pre></div><p>what is generally a good way to debug when ipk&#039;s not are created ?</p><p>thx</p><p>//</p><p>pelle</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226154">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						24 Feb 2014, 13:26					</div>
				</div>
				<div class="post-content content">
					<p>Have you already fixed your Makefile?<br />Your own in the first message contains several errors (e.g. references to knode), so are you using zloop&#039;s Makefile?</p><p>The general way is to check the build log to see if the package compiled succesfully. If compilation still breaks for the config error, naturally the *.ipk is not geneated.</p><p>EDIT:<br />your error messages also suggest, that more info might be in CMakeError.log and CMakeOutput.log</p><p>googling for that failing config line reveals that there should also be a Cmake option USE_COMPILER_HIDDEN_VISIBILITY that you probably could disable</p><p>EDIT2:<br />could you provide your exact current Makefile? I might try it on my own build system.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 24 Feb 2014, 13:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226156">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						24 Feb 2014, 14:05					</div>
				</div>
				<div class="post-content content">
					<p>hnyman</p><p>ok sorry not for being 100% clear -&nbsp; my Makefile in the retry was not the initial one but the the version provided by zloop placed here:</p><div class="codebox"><pre><code>  /home/pelle/playground_openwrt/openwrt_trunk/package/openobex:
...
 Makefile</code></pre></div><p>containing:</p><div class="codebox"><pre><code>#
# Copyright (C) 2014 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#

include $(TOPDIR)/rules.mk

PKG_NAME:=openobex
PKG_VERSION:=1.7.1
PKG_RELEASE:=1

PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
PKG_SOURCE_SUBDIR:=$(PKG_NAME)-$(PKG_VERSION)
PKG_SOURCE_URL:=git://gitorious.org/openobex/mainline.git
PKG_SOURCE_VERSION:=2e1c0fc5a8f5e41886141a6b402d00db735ccf49
PKG_MD5SUM:=2e1c0fc5a8f5e41886141a6b402d00db735ccf49

CMAKE_INSTALL:=1

include $(INCLUDE_DIR)/package.mk
include $(INCLUDE_DIR)/cmake.mk

define Package/openobex
  SECTION:=utils
  CATEGORY:=Utilities
  DEPENDS:=+libusb-1.0 +bluez-libs +udev +libxml2
  TITLE:=Free open source implementation of the Object Exchange (OBEX) protocol.
  URL:=https://gitorious.org/openobex
endef

# libxml2 : xmllint ?
# udev detected if udev Makefile modified

CMAKE_OPTIONS += \
        -DCMAKE_BUILD_TYPE=MinSizeRel \
        -DBUILD_DOCUMENTATION:BOOL=OFF \
        -DCMAKE_VERBOSE_MAKEFILE:BOOL=TRUE

$(eval $(call BuildPackage,openobex))</code></pre></div><p>+100 I you have the time to run it with your setup...</p><p>thx</p><p>//</p><p>pelle</p>											<p class="post-edited">(Last edited by <strong>pellekrogholt</strong> on 24 Feb 2014, 14:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226178">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						24 Feb 2014, 18:03					</div>
				</div>
				<div class="post-content content">
					<p>I have fixed the makefile and it compiles but since I dont have a Smartphone or Obex compatible hand nor bluetooth I cannot test further</p><p>Edit 1: CMakeLists.txt is in DOS format ... because of that patching fails when trying to build - so one &quot;hack&quot; is to provide a patched CMakeLists.txt with the package and copy it to the build dir </p><p>working* Makefile:</p><div class="codebox"><pre><code>#
# Copyright (C) 2014 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#

include $(TOPDIR)/rules.mk

PKG_NAME:=openobex
PKG_VERSION:=1.7.1
PKG_RELEASE:=1

PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
PKG_SOURCE_SUBDIR:=$(PKG_NAME)-$(PKG_VERSION)
PKG_SOURCE_URL:=git://gitorious.org/openobex/mainline.git
PKG_SOURCE_VERSION:=2e1c0fc5a8f5e41886141a6b402d00db735ccf49

include $(INCLUDE_DIR)/package.mk
include $(INCLUDE_DIR)/cmake.mk

define Package/openobex
  SECTION:=utils
  CATEGORY:=Utilities
  DEPENDS:=+libusb-1.0 +bluez-libs +udev +libxml2
  TITLE:=Free open source implementation of the Object Exchange (OBEX) protocol.
  URL:=https://gitorious.org/openobex
endef

CMAKE_OPTIONS += \
        -DCMAKE_BUILD_TYPE=MinSizeRel \
        -DBUILD_DOCUMENTATION=OFF

define Build/Prepare
    $(Build/Prepare/Default)
    $(RM) -f $(PKG_BUILD_DIR)/CMakeLists.txt
    $(CP) ./files/CMakeLists.txt $(PKG_BUILD_DIR)/CMakeLists.txt
endef

define Package/openobex/install
    $(INSTALL_DIR) $(1)/sbin
    $(CP) $(PKG_INSTALL_DIR)/usr/sbin/* $(1)/sbin/
    $(INSTALL_DIR) $(1)/lib/udev/rules.d
    $(CP) $(PKG_INSTALL_DIR)/lib/udev/rules.d/* $(1)/lib/udev/rules.d/
    $(INSTALL_DIR) $(1)/usr/lib
    $(CP) $(PKG_INSTALL_DIR)/usr/lib/libopenobex.so* $(1)/usr/lib/
endef


$(eval $(call BuildPackage,openobex))</code></pre></div><p>additionally there is still a patch for udev (posted above) or the build-system missing<br />PKG_CONFIG_PATH is set only to /usr/lib/pkgconfig and not to /usr/share/pkgconfig (only vala and udev use these in OpenWrt - but on Arch there are some more .pc files in /usr/share/ )</p><p>CMakeLists has one tiny change:<br /></p><div class="codebox"><pre><code>-project ( openobex C )
+project ( openobex C CXX)</code></pre></div><p>Edit 2: I sent a complete patch to the mailing list. So look there or at patchwork</p><p>Edit 3: Makefile was missing package/install - i only had that locally committed and missed to add that to the patch<br />Patch v2 sent to mailing list too</p><p>STILL : cannot test further because I dont have such Smartphone</p>											<p class="post-edited">(Last edited by <strong>zloop</strong> on 24 Feb 2014, 20:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226248">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						25 Feb 2014, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>hi zloop,</p><p>again thanks a lot for your detailed feedback / work!</p><div class="quotebox"><blockquote><p>... but since I don&#039;t have a Smartphone or Obex compatible hand nor bluetooth I cannot test further ...</p></blockquote></div><p>well such smart devices are also a bit overrated these days - i gladly like to do that &quot;smart&quot; part.</p><p>here is what i did so fare:</p><p>update the make file to correspond with your new changes:</p><div class="codebox"><pre><code>$ diff Makefile Makefile_20130216 
17a18,20
&gt; PKG_MD5SUM:=2e1c0fc5a8f5e41886141a6b402d00db735ccf49
&gt; 
&gt; CMAKE_INSTALL:=1
29a33,35
&gt; # libxml2 : xmllint ?
&gt; # udev detected if udev Makefile modified
&gt; 
32,48c38,39
&lt;         -DBUILD_DOCUMENTATION=OFF
&lt; 
&lt; define Build/Prepare
&lt;     $(Build/Prepare/Default)
&lt;     $(RM) -f $(PKG_BUILD_DIR)/CMakeLists.txt
&lt;     $(CP) ./files/CMakeLists.txt $(PKG_BUILD_DIR)/CMakeLists.txt
&lt; endef
&lt; 
&lt; define Package/openobex/install
&lt;     $(INSTALL_DIR) $(1)/sbin
&lt;     $(CP) $(PKG_INSTALL_DIR)/usr/sbin/* $(1)/sbin/
&lt;     $(INSTALL_DIR) $(1)/lib/udev/rules.d
&lt;     $(CP) $(PKG_INSTALL_DIR)/lib/udev/rules.d/* $(1)/lib/udev/rules.d/
&lt;     $(INSTALL_DIR) $(1)/usr/lib
&lt;     $(CP) $(PKG_INSTALL_DIR)/usr/lib/libopenobex.so* $(1)/usr/lib/
&lt; endef
&lt; 
---
&gt;         -DBUILD_DOCUMENTATION:BOOL=OFF \
&gt;         -DCMAKE_VERBOSE_MAKEFILE:BOOL=TRUE
50c41
&lt; $(eval $(call BuildPackage,openobex))
---
&gt; $(eval $(call BuildPackage,openobex))
\ No newline at end of file</code></pre></div><p>then i created the files dir and placed a dos2unix transformed version of CMakeLists.txt of open-obex there:</p><div class="codebox"><pre><code>$ ls package/openobex/files
CMakeLists.txt</code></pre></div><p>and changed package/openobex/files/CMakeLists.txt:<br /></p><div class="codebox"><pre><code>-project ( openobex C )
+project ( openobex C CXX)</code></pre></div><p>Ran the usual suspects of commands:<br /></p><div class="codebox"><pre><code>VERBOSE=1 make package/openobex/configure V=s
...
make package/openobex/compile V=99
...
make package/openobex/install V=99
...
make package/index
...</code></pre></div><br /><p>verified we have an ipk file:</p><div class="codebox"><pre><code>$ find -iname &quot;openobex*.ipk&quot;
./bin/ar71xx/packages/openobex_1.7.1-1_ar71xx.ipk</code></pre></div><p>Uploaded/updated Packages/Packages.gz/openobex_1.7.1-1_ar71xx.ipk to custom package repo and installed openobex sucessfully:</p><div class="codebox"><pre><code>opkg install http://&lt;my project&gt;.itu.dk/open-wrt/trunk-21nov2013/packages
# opkg install openobex
Installing openobex (1.7.1-1) to root...
Downloading http://&lt;my project&gt;.itu.dk/open-wrt/trunk-21nov2013/packages/openobex_1.7.1-1_ar71xx.ipk.
Installing libusb-1.0 (1.0.9-1) to root...
Downloading http://&lt;my project&gt;.itu.dk/open-wrt/trunk-21nov2013/packages/libusb-1.0_1.0.9-1_ar71xx.ipk.
Installing udev (173-1) to root...
Downloading http://&lt;my project&gt;.itu.dk/open-wrt/trunk-21nov2013/packages/udev_173-1_ar71xx.ipk.
Installing libxml2 (2.7.8-2) to root...
Downloading http://&lt;my project&gt;.itu.dk/open-wrt/trunk-21nov2013/packages/libxml2_2.7.8-2_ar71xx.ipk.
Configuring libxml2.
Configuring libusb-1.0.
Configuring udev.
Configuring openobex.</code></pre></div><br /><p>Ok fine i assume i have openobex now and would like to use it - for example with ussp-push (<a href="http://xmailserver.org/ussp-push.html">http://xmailserver.org/ussp-push.html</a>) - then i can do:</p><div class="codebox"><pre><code>$ ussp-push --debug  00:1B:35:0A:7A:AE@1 myfile.mp3 myfile.mp3 </code></pre></div><p>i start up the package dir:</p><br /><p>create a Makefile</p><div class="codebox"><pre><code>#
# Copyright (C) 2014 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#

include $(TOPDIR)/rules.mk

PKG_NAME:=ussp-push
PKG_VERSION:=0.11
PKG_RELEASE:=1

PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
PKG_SOURCE_SUBDIR:=$(PKG_NAME)-$(PKG_VERSION)
PKG_SOURCE_URL:=http://xmailserver.org
# the next steps didn&#039;t work out well:
#PKG_MD5SUM:=5c44983ee27809867041feff6bb4423a 
#PKG_CAT:=zcat

include $(INCLUDE_DIR)/package.mk

define Package/ussp-push
  SECTION:=utils
  CATEGORY:=Utilities
  DEPENDS:=+openobex
  TITLE:=ussp-push is a OBEX object pusher for Linux, using the BlueZ BlueTooth stack.
  URL:=http://xmailserver.org/ussp-push.html
endef

define Build/Configure
       $(call Build/Configure/Default,--with-linux-headers=$(LINUX_DIR))
endef

define Package/ussp-push/install
    $(INSTALL_DIR) $(1)/usr/bin
    $(INSTALL_BIN) $(PKG_BUILD_DIR)/ussp-push $(1)/usr/bin/
endef


$(eval $(call BuildPackage,ussp-push))</code></pre></div><p>lets configure:</p><div class="codebox"><pre><code>VERBOSE=1 make package/ussp-push/configure V=s
....

checking for BLUETOOTH... yes
checking for OPENOBEX... configure: error: Package requirements (openobex) were not met:

No package &#039;openobex&#039; found

Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.

Alternatively, you may set the environment variables OPENOBEX_CFLAGS
and OPENOBEX_LIBS to avoid the need to call pkg-config.
See the pkg-config man page for more details.

make[2]: *** [/home/pelle/playground_openwrt/openwrt_trunk/build_dir/target-mips_34kc_uClibc-0.9.33.2/ussp-push-0.11/.configured_] Error 1
make[2]: Leaving directory `/home/pelle/playground_openwrt/openwrt_trunk/package/ussp-push&#039;
make[1]: *** [package/ussp-push/configure] Error 2
make[1]: Leaving directory `/home/pelle/playground_openwrt/openwrt_trunk&#039;
make: *** [package/ussp-push/configure] Error 2</code></pre></div><br /><p>then i&#039;m a bit confused about how to add the freshly build openobex as a dependency in the right(TM) way -&nbsp; even if the make do make some hints....</p><br /><p>further help appreciated....</p><p>thx</p><p>pelle</p>											<p class="post-edited">(Last edited by <strong>pellekrogholt</strong> on 25 Feb 2014, 16:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226260">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						25 Feb 2014, 21:03					</div>
				</div>
				<div class="post-content content">
					<p>I added a section to the openobex Makefile regarding missing header,library and pkgconfig files.</p><p>add this section:<br /></p><div class="codebox"><pre><code>define Build/InstallDev
    $(INSTALL_DIR) $(1)/usr/include/openobex
    $(INSTALL_DIR) $(1)/usr/lib
    $(INSTALL_DIR) $(1)/usr/lib/pkgconfig
    $(CP) $(PKG_INSTALL_DIR)/usr/include/openobex/*.h $(1)/usr/include/openobex/
    $(CP) $(PKG_INSTALL_DIR)/usr/lib/libopenobex.so* $(1)/usr/lib/
    $(CP) $(PKG_INSTALL_DIR)/usr/lib/pkgconfig/openobex.pc $(1)/usr/lib/pkgconfig/
endef</code></pre></div><p>I modified the ussp-push Makefile to make it compile</p><p>I had to edit 2 more locations in source because ussp-push apparently uses an old openobex version.</p><p>for the Makefile of ussp-push and the 2 patches of its source look at: <a href="http://paste.debian.net/84056/">http://paste.debian.net/84056/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226332">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						26 Feb 2014, 17:03					</div>
				</div>
				<div class="post-content content">
					<p>hi zloop,</p><p>once again thx for the contionued help - i have adjusted the open-wrt Makefile of openobex and ussp-push according to&nbsp; <a href="http://paste.debian.net/84056/">http://paste.debian.net/84056/</a></p><br /><p>when reading further through the paste - i got a bit in doubt - there should be two patches placed here right ?</p><div class="codebox"><pre><code>$ &lt;open wrt sdk code&gt;/package/ussp-push/patches
100-include_obex_const_header.patch
200_add_inline_convert.patch</code></pre></div><p>if so can i see the entire&nbsp; content of 100-include_obex_const_header.patch and 200_add_inline_convert.patch ?</p><p>sorry if i&#039;m of the track...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226334">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						26 Feb 2014, 17:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pellekrogholt wrote:</cite><blockquote><p>if so can i see the entire&nbsp; content of 100-include_obex_const_header.patch and 200_add_inline_convert.patch ?</p></blockquote></div><p>The wrappers for those patch files start on lines 52 and 77, and the patch itself starts on line 57 and 82.<br /><a href="http://paste.debian.net/84056/">http://paste.debian.net/84056/</a><br />There is an extra + at each line, as the actual patches are created by the surrounding wrapper patch ;-)</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 26 Feb 2014, 17:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226401">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						27 Feb 2014, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>hi hnyman,</p><p>thanx for the explanation ^^ - i&#039;m clearly in open wather here :)</p><p>so how do i apply the patches /wrappers of <a href="http://paste.debian.net/84056">http://paste.debian.net/84056</a> within my openwrt build setup ?</p><p>thx</p><p>//</p><p>pelle</p><br /><p>EDIT 2:</p><br /><p>Ok i &quot;git&quot; it - doh its a git patch which of course was my first thought but then i got confused - because i had the ussp-push dir&nbsp; out side the feeds/package/utils git based dir - lets move it:</p><div class="codebox"><pre><code>$ mv openwrt_trunk/package/ussp-push
$ feeds/packages/utils/ussp-push
# download patch
$ wget http://paste.debian.net/download/84056
...</code></pre></div><p>ok we have the patch lets apply it</p><div class="codebox"><pre><code>$ git am 84056
Patch format detection failed.
# or 
$ git am &lt; 84056
Patch does not have a valid e-mail address.</code></pre></div><p>any hints for ^^ ?</p>											<p class="post-edited">(Last edited by <strong>pellekrogholt</strong> on 27 Feb 2014, 12:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226410">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						27 Feb 2014, 14:09					</div>
				</div>
				<div class="post-content content">
					<p>Just create and edit the files manually. Copy-paste the contents, then remove the extra + chars. That is probably easiest.</p><p>Or use just normal &quot;patch&quot; to apply the patch. You do not need git.</p><p>(git requires the committer to always have an email address, so that the changeset is attributed to somebody. you should have that email defined in your local git settings, or alternatively in the patch file for that patch. I don&#039;t use git for patches, so this is half-guessing)</p><p>You are looking for basic patch skills... ;-)</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 27 Feb 2014, 14:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226416">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">pellekrogholt</div>
					<div class="post-datetime">
						27 Feb 2014, 14:47					</div>
				</div>
				<div class="post-content content">
					<p>hnyman thanks for the patience <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> main while i was doing:</p><p>Ok i &quot;git&quot; it - doh its a git patch which of course was my first thought but then i got confused - because i had the ussp-push dir&nbsp; out side the feeds/package/utils git based dir - lets move it:</p><div class="codebox"><pre><code>$ mv openwrt_trunk/package/ussp-push
$ feeds/packages/utils/ussp-push
# download patch
$ wget [url]http://paste.debian.net/download/84056[/url]
...</code></pre></div><p>ok we have the patch lets apply it</p><div class="codebox"><pre><code>$ git am 84056
Patch format detection failed.
# or 
$ git am &lt; 84056
Patch does not have a valid e-mail address.</code></pre></div><p>ok i was thinking a bit to fancy and simply forgot god old &quot;patch -p1&quot; lets go for that:</p><div class="codebox"><pre><code>$ patch -p1 &lt; 84056
patching file utils/ussp-push/Makefile
Hunk #1 FAILED at 15.
1 out of 1 hunk FAILED -- saving rejects to file utils/ussp-push/Makefile.rej
patching file utils/ussp-push/patches/100-include_obex_const_header.patch
patching file utils/ussp-push/patches/200_add_inline_convert.patch
pelle@tupelo:~/playground_openwrt/openwrt_trunk/feeds/packages$ cat utils/ussp-push/Makefile.rej
--- utils/ussp-push/Makefile
+++ utils/ussp-push/Makefile
...</code></pre></div><p>then edit ussp-push/Makefile by hand and configure/compile </p><div class="codebox"><pre><code>pelle@tupelo:~/playground_openwrt/openwrt_trunk$ VERBOSE=1 make feeds/packages/utils/ussp-push/configure V=s
WARNING: your configuration is out of sync. Please run make menuconfig, oldconfig or defconfig!
make[1]: Entering directory `/home/pelle/playground_openwrt/openwrt_trunk&#039;
make[1]: *** No rule to make target `feeds/packages/utils/ussp-push/configure&#039;.  Stop.
make[1]: Leaving directory `/home/pelle/playground_openwrt/openwrt_trunk&#039;
make: *** [feeds/packages/utils/ussp-push/configure] Error 2</code></pre></div><p>i dont understand that one lets put ussp-push back to the old dir:<br /></p><div class="codebox"><pre><code>$ mv mv feeds/packages/utils/ussp-push package/</code></pre></div><p>configure/compile install goes fine and finally i got the ipk build</p><p>i update my custom package repos with the right info in &quot;Packages&quot; and the right versions of openobex...ipk (including the adjusts &quot;I added a section to the openobex Makefile regarding missing header,library and pkgconfig files.&quot;) and ussp-push.ipk </p><p>they install fine - BUT when doing a ussp-push command it looks as follow - where it hangs on the request on a openwrt box:</p><div class="codebox"><pre><code>ussp-push --debug  00:1B:35:0A:7A:29@1 myfile1.mp3 myfile1.mp3
pushing file myfile1.mp3
name=myfile1.mp3, size=59194
__obex_connect: client_context_t = 0x54d778
Registered transport
Set user data
Created new objext
Started a new request
^C</code></pre></div><p>on a ubuntu i can do:</p><div class="codebox"><pre><code>$ ussp-push --debug  00:1B:35:0A:7A:29@1 done.mp3 done.mp3
pushing file done.mp3
name=done.mp3, size=75676
__obex_connect: client_context_t = 0x2403800
Registered transport
Set user data
Created new objext
cobex_write
Local device 00:1A:7D:DA:71:08
Remote device 00:1B:35:0A:7A:29 (1)
Wrote 7 fragment
Wrote 7 bytes (expected 7)
obex_event: client_context_t = 0x2403800
Made some progress...
Started a new request
cobex_handle_input
expect 7 bytes
Read 7 bytes
obex_event: client_context_t = 0x2403800
ReqDone
Command (00) has now finished, rsp: 20
Connected!
Connection return code: 0, id: 0
Connection established
Connected to server
obex_push: client_context_t = 0x2403800
Sending file: done.mp3, path: done.mp3, size: 75676
cobex_write
Wrote 1024 fragment
Wrote 1024 bytes (expected 1024)
obex_event: client_context_t = 0x2403800
Made some progress...
cobex_handle_input
expect 3 bytes
Read 3 bytes
cobex_write
Wrote 1024 fragment
Wrote 1024 bytes (expected 1024)
obex_event: client_context_t = 0x2403800
Made some progress...
cobex_handle_input
...
ReqDone
Command (01) has now finished, rsp: 20
Disconnect done!
cobex_disconnect
cobex_close
Pushed!!</code></pre></div><br /><p>as always further help appreciated ... thx</p><br /><h5> EDIT 2 </h5><p>pardon my weak failure description above ^^ - for me its confusing if its about:</p><p>- openobex build wrongly?<br />- open-ussp with openobex patches build / patched wrongly?</p><p>or some internal code errors of openobex or assumedly open-ussp - i&#039;m still looking for hints / directions here ...</p><p>my next step would of course be to go into gdb-debugging and so - my c/gdb skills are currently a bit rusty but i might take the jump when time arise... </p><h5> EDIT 3 </h5><p>for the impatient simply do it with python / pybluez / pyobex:</p><div class="codebox"><pre><code>opkg install python
opkg install python-bluez</code></pre></div><p>well i could not get pip to fly well on open-wrt so the install of PyOBEX is a bit cumbersome and for some reason on open-wrt (bluez version: 3.36 / Python 2.7.5) i have to force it to use python bluez (bluetooth) - this was not the case on ubuntu (bluez version: 4.101-0ubuntu8b1 / Python 2.7.5) etc...</p><div class="codebox"><pre><code>echo &quot;we are about to install a patched version of Pyobex-0.25.Zip&quot;
cd /tmp
wget http://www.boddie.org.uk/david/Projects/Python/PyOBEX/Software/PyOBEX-0.25.zip
unzip PyOBEX-0.25.zip
cd PyOBEX-0.25 
wget --no-check-certificate https://gist.githubusercontent.com/pellekrogholt/9259610/raw/3ca323ff81b690f7d5c7ba415bb9d6fcc9fe3efd/pyobex_common_py.patch
patch -p1  PyOBEX/common.py &lt; pyobex_common_py.patch
python setup.py install</code></pre></div><p>simple working client to push a file:</p><div class="codebox"><pre><code>from PyOBEX.client import BrowserClient
mac_address = &#039;00:1B:35:0A:7A:AE&#039;
channel = 1
client = BrowserClient(mac_address, channel)
client.connect()
file_name=&#039;myfile.mp3&#039;
file = open(file_name, &#039;r&#039;)
file_read = file.read() 
response = client.put(file_name, file_read, header_list=())
client.disconnect()</code></pre></div><p>thats it.</p>											<p class="post-edited">(Last edited by <strong>pellekrogholt</strong> on 28 Feb 2014, 11:11)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>