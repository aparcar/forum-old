<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SOLVED - Bridge WAN to LAN - TP-Link wr740n</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p193857">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						5 Mar 2013, 10:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi, guys! I&#039;m trying to make bridge between WAN port and some of the LAN ports. I want the others LAN ports to be NAT. OK! I follow up these 2 posts:</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=19540">1</a></p><p>and</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=11028">2</a></p><p>but nothing. When I make the changes in <strong>/etc/config/network</strong> and everything goes down. The router works but I don&#039;t have connection with it - neither on WEB nor on ping - there is no DHCP - nothing. I download the <strong>/etc/config/network</strong> to my PC - make changes and then uploaded to the router.</p>											<p class="post-edited">(Last edited by <strong>icemans</strong> on 13 Mar 2013, 16:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193881">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">DB1</div>
					<div class="post-datetime">
						5 Mar 2013, 15:49					</div>
				</div>
				<div class="post-content content">
					<p>You have most likely changed the line endings in the file from unix to Windows. This will cause most unix programs to barf when they try and read it. How did you transfer the file? To the PC and back.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193886">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						5 Mar 2013, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>Transfer via scp:<br /></p><div class="codebox"><pre><code>$ scp</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193898">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">DB1</div>
					<div class="post-datetime">
						5 Mar 2013, 19:31					</div>
				</div>
				<div class="post-content content">
					<p>Just had a quick look at the man page for scp and it does not mention ASCII or Binary modes such as FTP uses so my gut feeling is it would essentially do a binary transfer. ie no messing with what it thinks are line endings. So if you edited it on a non unix system you could well have introduced a few CR-LF endings.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193915">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						5 Mar 2013, 21:57					</div>
				</div>
				<div class="post-content content">
					<p>I agree with you! I will try to edit the config under unix with &quot;vi&quot; or &quot;nano&quot;.....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193917">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						5 Mar 2013, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>Could you tell me what is the software numbers of the ports - WAN-LAN1 to LAN4 for this routers? Which port is 0 and 4 ?</p>											<p class="post-edited">(Last edited by <strong>icemans</strong> on 5 Mar 2013, 22:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193921">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">wondersmaker</div>
					<div class="post-datetime">
						5 Mar 2013, 22:09					</div>
				</div>
				<div class="post-content content">
					<p>vi is easy and built on <br />vi /etc/config/network<br />esc + i ( to insert ) <br />then edit whatever you wanna edit<br />esc + : + w ( to save )<br />esc + : + q ( to quite )<br />thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193970">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						6 Mar 2013, 08:58					</div>
				</div>
				<div class="post-content content">
					<p>Thank you <strong>wondersmaker</strong>. I know this but what is numeration of the ports from 0 to 4? Which port is 0 and 4 ? Thank you!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194145">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						7 Mar 2013, 14:33					</div>
				</div>
				<div class="post-content content">
					<p>Please tell me - which port is 0 and which is 4? And what port is CPU - 5 or 0?!?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194147">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">DB1</div>
					<div class="post-datetime">
						7 Mar 2013, 14:56					</div>
				</div>
				<div class="post-content content">
					<p>Most routers I have looked at have 0 - 3 reversed to what they are labeled. ie the box says 1 - 4 which is actually 3 - 0 respectively. CPU is 5 on a non Gigabit router and 8 on Gigabit.</p><p>Quick test is to put the port marked 1 into a different vlan on its own and then see what the logs say when you try and use it.</p><p>HTH</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194150">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						7 Mar 2013, 15:50					</div>
				</div>
				<div class="post-content content">
					<p>My router is TP-Link WR740N - I&#039;ll try to make this test - thank you! And what does it mean a symbol &quot;t&quot; after port number, e.g. &quot;5t&quot;? Thank you!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194151">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						7 Mar 2013, 15:54					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/doc/uci/network/switch#vlanswitch.config">http://wiki.openwrt.org/doc/uci/network â€¦ tch.config</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194195">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						7 Mar 2013, 23:21					</div>
				</div>
				<div class="post-content content">
					<p>Thank you, <strong>nebbia88</strong>! But, <strong>DB1</strong> I couldn&#039;t do the thes about the port numeration. Whatever i do in the LOG I see only that port1 is changed?! Could you explain me how exactly I have to do? Thank you!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194489">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						10 Mar 2013, 23:01					</div>
				</div>
				<div class="post-content content">
					<p>OK guys! I&#039;ve tried to edit the file via &quot;vi&quot; but no success <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> I&#039;ve tried the 2 first variants from the my first post. But I couldn&#039;t understand what is the WAN port number. Here is my default <strong>/etc/config/network</strong> file:</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.1&#039;
        option netmask &#039;255.255.255.0&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcp&#039;

config switch
        option name &#039;eth0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;eth0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0 1 2 3 4&#039;</code></pre></div><p>And from <br /></p><div class="codebox"><pre><code>~# swconfig dev switch0 help
switch0: eth0(AR7240/AR9330 built-in switch), ports: 5 (cpu @ 0), vlans: 16</code></pre></div><p>I see that my CPU port is &quot;0&quot; and LAN ports are from 1 to 4. But nothing about the WAN port. When I edited the file I used port &quot;5&quot; as the WAN but no success. What can I do?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194624">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						12 Mar 2013, 10:42					</div>
				</div>
				<div class="post-content content">
					<p>OK! I have a little success with this config:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;                                                     
        option ifname &#039;lo&#039;                                                      
        option proto &#039;static&#039;                                                   
        option ipaddr &#039;127.0.0.1&#039;                                               
        option netmask &#039;255.0.0.0&#039;                                              
                                                                                
config interface &#039;lan&#039;                                                          
        option type &#039;bridge&#039;                                                    
        option proto &#039;static&#039;                                                   
        option ipaddr &#039;192.168.1.1&#039;                                             
        option netmask &#039;255.255.255.0&#039;                                          
        option _orig_ifname &#039;eth0 radio0.network1&#039;                              
        option _orig_bridge &#039;true&#039;                                              
        option ifname &#039;eth0 eth0.1&#039;                                             
                                                                                
config interface &#039;wan&#039;                                                          
        option proto &#039;dhcp&#039;                                                     
        option type &#039;bridge&#039;                                                    
        option _orig_ifname &#039;eth1&#039;                                              
        option _orig_bridge &#039;true&#039;                                              
        option ifname &#039;eth0.2 eth1&#039;                                             
                                                                                
config switch                                                                   
        option name &#039;eth0&#039;                                                      
        option reset &#039;1&#039;                                                        
        option enable_vlan &#039;1&#039;                                                  
                                                                                
config switch_vlan                                                              
        option device &#039;eth0&#039;                                                    
        option vlan &#039;1&#039;                                                         
        option vid &#039;1&#039;                                                          
        option ports &#039;0 2 3 4&#039;                                                  
                                                                                
config switch_vlan                                                              
        option device &#039;eth0&#039;                                                    
        option vlan &#039;2&#039;                                                         
        option vid &#039;2&#039;                                                          
        option ports &#039;0t 1&#039;</code></pre></div><p>In this case I have a switch between WAN and LAN4 (port 1) but there is no DHCP on the others LAN ports - LAN1 to LAN3. If I set static address to my PC I don&#039;t have a ping to the router. But if I restart the router and voila <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />) there is ping, link and Internet until I disconnect the cable or something else?!? After restart the router I have a link again but there is no DHCP <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194628">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">DB1</div>
					<div class="post-datetime">
						12 Mar 2013, 11:38					</div>
				</div>
				<div class="post-content content">
					<p>If you have 5 ports then they are numbered 0-4 by the look of&nbsp; it which is why 5 did not do anything. Re the test. Have a firewall rule that logs everything on the test vlan which has the single port (front labelled 1 or 4) Plug into that port and do anything. Then look in the log. If you got it right then you will see logs for what you did - ping will be enough. If you guessed wrong it is the other one. ie define vlan for port 1 plug into port labelled 1 if you get a log than that is 1 otherwise the one labelled 4 is one. Hope that makes sense. 1 - 4 labelled are often &quot;actual 4 - 1.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p194712">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">icemans</div>
					<div class="post-datetime">
						12 Mar 2013, 22:32					</div>
				</div>
				<div class="post-content content">
					<p>OK! The ports are - phisical - 1 2 3 4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;logical&nbsp; -&nbsp; 2 3 4 1&nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CPU&nbsp; &nbsp; &nbsp;-&nbsp; &nbsp;0</p><p>And working config is:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option _orig_ifname &#039;eth0 radio0.network1&#039;
    option _orig_bridge &#039;true&#039;
    option ifname &#039;eth0.1&#039;

config interface &#039;wan&#039;
    option proto &#039;dhcp&#039;
    option type &#039;bridge&#039;
    option _orig_ifname &#039;eth1&#039;
    option _orig_bridge &#039;true&#039;
    option ifname &#039;eth0.2 eth1&#039;

config switch
    option name &#039;eth0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;1&#039;
    option vid &#039;1&#039;
    option ports &#039;0t 1 3 4&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;2&#039;
    option vid &#039;2&#039;
    option ports &#039;0t 2&#039;</code></pre></div><p>Now I have switch between WAN and LAN1 and the other ports are behind NAT. Thank you to all of you!</p>											<p class="post-edited">(Last edited by <strong>icemans</strong> on 12 Mar 2013, 22:32)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>