<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to fix the TCP/IP packet latency to a constant?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p70903">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						15 Jul 2008, 05:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>&nbsp; I suppose I have a rather weird question for this forum, however I need to fix a packets latency in AP to a constant value say 10ms. By latency I mean the time interval starting when the last bit of the input frame reaches the input port and ending when the first bit of the output frame is seen on the output port. I vaguely told that it is possible on Linux, however I am not sure if this has to be taken care by the sender of the packet or inside the APs firmware. I did try googling however in vain. Maybe you guys have any suggestions? </p><p>I know it may sound pointless but I can assure its not <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70904">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">alexsamad</div>
					<div class="post-datetime">
						15 Jul 2008, 05:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tA wrote:</cite><blockquote><p>Hi all,</p><p>&nbsp; I suppose I have a rather weird question for this forum, however I need to fix a packets latency in AP to a constant value say 10ms. By latency I mean the time interval starting when the last bit of the input frame reaches the input port and ending when the first bit of the output frame is seen on the output port. I vaguely told that it is possible on Linux, however I am not sure if this has to be taken care by the sender of the packet or inside the APs firmware. I did try googling however in vain. Maybe you guys have any suggestions? </p><p>I know it may sound pointless but I can assure its not <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Why not just fix the ap&#039;s rate</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70905">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						15 Jul 2008, 05:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alexsamad wrote:</cite><blockquote><p>Why not just fix the ap&#039;s rate</p></blockquote></div><p>Well thing is that I need to have as deterministic system as possible, and fixing the AP&#039;s rate still leaves me with uncertainty.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70906">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						15 Jul 2008, 06:02					</div>
				</div>
				<div class="post-content content">
					<p>There&#039;s no way to reliably do a precise delay without a real RTOS, but you can use TC to induce &#039;rough&#039; delays.&nbsp; You probably won&#039;t notice the difference unless you really do mean 10ms, but in that case you&#039;re shopping in the wrong market.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70907">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						15 Jul 2008, 06:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>aoz.syn wrote:</cite><blockquote><p>There&#039;s no way to reliably do a precise delay without a real RTOS, but you can use TC to induce &#039;rough&#039; delays.&nbsp; You probably won&#039;t notice the difference unless you really do mean 10ms, but in that case you&#039;re shopping in the wrong market.</p></blockquote></div><p>Sorry TC?</p><p>well I am currently trying to squeeze RTAI into OpenWRT for this purpose <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70908">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						15 Jul 2008, 06:19					</div>
				</div>
				<div class="post-content content">
					<p>The &#039;standard&#039; Linux utility for shaping traffic.&nbsp; Check lartc.org for extensive documentation.</p><p>RTAI probably isn&#039;t going to help you, that&#039;s only for real-time userspace applications; nothing in networking is in userland.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70909">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						15 Jul 2008, 06:24					</div>
				</div>
				<div class="post-content content">
					<p>Also, check out one of the 2WIRE 2700 units - they induce a consistent 200ms delay in every packet.&nbsp; I hate them.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70910">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						15 Jul 2008, 06:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>aoz.syn wrote:</cite><blockquote><p>Also, check out one of the 2WIRE 2700 units - they induce a consistent 200ms delay in every packet.&nbsp; I hate them.</p></blockquote></div><p>Thank you, I&#039;ll look at them right now.</p><p>But RTAI is not only in userspace, it has a HRT kernel space as well, the only problem is to put it into ASUS 500gP</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70911">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						15 Jul 2008, 06:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>But RTAI is not only in userspace, it has a HRT kernel space as well, the only problem is to put it into ASUS 500gP</p></blockquote></div><p>Yes, it has a kernel-space driver; it couldn&#039;t claim RT-like performance if it didn&#039;t.&nbsp; Even so, it has everything to do with how applications are executed and nothing to do with how traffic is routed.&nbsp; It&#039;s like saying the disk scheduler is affected by a USB-serial driver - never the twain shall meet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70912">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						15 Jul 2008, 06:38					</div>
				</div>
				<div class="post-content content">
					<p>Yes I see your point. However (well its just an impression of Linux illiterate) wouldn&#039;t it be possible to move some network trafficking under RT conditions, since RTAI squeezes itself in between hardware and the original OS kernel layer?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70915">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						15 Jul 2008, 07:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tA wrote:</cite><blockquote><p>Yes I see your point. However (well its just an impression of Linux illiterate) wouldn&#039;t it be possible to move some network trafficking under RT conditions, since RTAI squeezes itself in between hardware and the original OS kernel layer?</p></blockquote></div><p>RTAI doesn&#039;t place itself between the hardware and OS kernel, it replaces the scheduler and some other components, integrating itself into the kernel itself (think metastasizing).&nbsp; A hypervisor (Xen, etc.) inserts itself as a shim between an unmodified kernel and the hardware.</p><p>RTnet (a sibling project of RTAI) is an attempt at using RTAI to produce hard real-time networking, but requires a dedicated ethernet segment that only RTnet devices can talk on and only supports a very narrow spectrum of copper ethernet interfaces - no wireless.&nbsp; RTAI may be able to give you (again, very rough) control over the latency of the networking stack, but only by starving or providing it with CPU time - <em>hard</em> real-time networking requires a dedicated, purpose-written stack from copper to layer 7 with a supporting RT scheduler.&nbsp; That doesn&#039;t even start to deal with the latencies and transmission issues on the relatively (as compared with copper/fiber ethernet) unreliable 2.4GHz band.</p><p>There are lots of things to say and ask here, but I think the simplest is this: why?&nbsp; Of all the ways to induce rather reliable delays why did you choose to go the most hard-core route that makes even the grungiest embedded engineer shudder?&nbsp; Simply deciding you&#039;re going to go for hard packet timings isn&#039;t a very trivial decision.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70950">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						16 Jul 2008, 00:42					</div>
				</div>
				<div class="post-content content">
					<p>aoz.syn, thank you for your insight. To answer your question &#039;why?&#039; I can only say because of lack of knowledge and experience in communication networks. I am from satellite positioning navigation and timing (GPS, Galileo, etc.) sphere and I have this project to augment indoor GNSS positioning with communication networks. The only reasonable way to do it is by measuring time. This project is orientated to produce a software solution which could be used together with of the shelve mainstream AP. These decisions to use ASUS AP&#039;s with MIPS chips on them and employ RTAI obviously have been made without proper consideration. </p><p>Hell, I can see that initial idea is totally FUBAR and I will need to come up with something smart ASAP...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70951">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						16 Jul 2008, 01:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tA wrote:</cite><blockquote><p>I have this project to augment indoor GNSS positioning with communication networks. The only reasonable way to do it is by measuring time. This project is orientated to produce a software solution which could be used together with of the shelve mainstream AP.</p></blockquote></div><p>Are you intending to re-distribute the GNSS signal, or are you just trying to distribute timing information?&nbsp; If timing, I&#039;ve seen somewhat-COTS MIPS systems use a combination of NTP, OXCO, and GPS discipline to get down to &lt;30ps synchronization over 40 miles.&nbsp; That&#039;s relatively easy to do.</p><p>If you&#039;re trying to actually replicate the signal, short of setting up repeaters I&#039;m not sure there&#039;s a good solution for you.&nbsp; If RTnet has a driver for the copper NICs on the APs or you could get someone to write one for you, you could conceivably set up a dedicated ethernet segment that utilized the copper interfaces on the APs for your RTnet link (signal distribution), then a custom driver for the WiFi that emitted your timing packets.&nbsp; Even so, you&#039;d still have to get over the fact that the 802.11 radios aren&#039;t going to be capable of broadcasting in a GNSS spectrum and the clients will somehow have to handle that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70953">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						16 Jul 2008, 01:41					</div>
				</div>
				<div class="post-content content">
					<p>No no, its a different approach, I am not trying to make pseudolites from APs, but rather going to sensor fusion solution and opportunistic positioning. Its possible to achieve a very nice accuracy with sophisticated architecture and hardware, however this project focuses on &#039;make it as simple as possible&#039; goal. In this case I don&#039;t neither sinc the AP&#039;s with GPS time nor even in between, the TOA (time of arrival) measurements are then dealt with in particle/Kalman filters to obtain positioning solution. I was aware of RTnet, however it does not suit the raised objective as it requires centralized management. In my case just constraining latency and minimizing its jitter in otherwise unmodified AP is sufficient.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70954">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						16 Jul 2008, 02:02					</div>
				</div>
				<div class="post-content content">
					<p>If you just need to minimize jitter of IP packets, do some experimentation with the &#039;dstlimit&#039; iptables module.&nbsp; I think tc also has some qdiscs that recognize a &#039;pps&#039; rate instead of traditional data-based rates, but that&#039;s just a vague memory.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70955">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						16 Jul 2008, 02:11					</div>
				</div>
				<div class="post-content content">
					<p>Definitely will look into it. </p><p>Appreciate your help</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70960">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						16 Jul 2008, 06:24					</div>
				</div>
				<div class="post-content content">
					<p>One more bit - the sch_netem scheduler may help as well.&nbsp; I&#039;m not sure how usable it is, but it&#039;s a testing module designed to artificially induce latency, jitter, packet loss, and so on.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71003">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">alexsamad</div>
					<div class="post-datetime">
						17 Jul 2008, 05:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tA wrote:</cite><blockquote><div class="quotebox"><cite>alexsamad wrote:</cite><blockquote><p>Why not just fix the ap&#039;s rate</p></blockquote></div><p>Well thing is that I need to have as deterministic system as possible, and fixing the AP&#039;s rate still leaves me with uncertainty.</p></blockquote></div><p>If you don&#039;t fix the rate, then it doesn&#039;t matter weather you use tc or any other method.</p><p>If you set 54Mb/s that is guaranteed to send 54Mb every second even if you only send 1 bit or 300 or 54M.</p><p>The other problem you have is getting the data to the wireless card on time.</p><br /><p>Even if you send 1 packet to the wireless card every time unit, if the wireless card change bit rates it will send the data at different rates</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71005">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">tA</div>
					<div class="post-datetime">
						17 Jul 2008, 06:15					</div>
				</div>
				<div class="post-content content">
					<p>well the thing is if I fix the rate to a low value, expecting that the packet will be delayed until next available broadcast, I will never be sure how long the packet was in the buffer waiting for retransmission (timing uncertainty is the size of delay in buffer, minus process time). And if the rate is higher than the process time of the packet, then I will not be able to extrapolate how many cycles it missed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71008">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						17 Jul 2008, 07:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alexsamad wrote:</cite><blockquote><p>If you don&#039;t fix the rate, then it doesn&#039;t matter weather you use tc or any other method.</p><p>If you set 54Mb/s that is guaranteed to send 54Mb every second even if you only send 1 bit or 300 or 54M.</p><p>The other problem you have is getting the data to the wireless card on time.</p><br /><p>Even if you send 1 packet to the wireless card every time unit, if the wireless card change bit rates it will send the data at different rates</p></blockquote></div><p>You&#039;re in the right neighborhood, but approaching it completely wrong.&nbsp; tA is looking at transmission latency and not at link bandwidth.&nbsp; Mistake of ignoring the significant overhead of 802.11 aside, link speed on most ethernet-style interfaces has nearly zero effect on how quickly an individual packet is transmitted.&nbsp; Put another way, you&#039;re not changing the speed of light.</p><p>However, part of negotiating a particular speed with an AP in WiFi involves a decision on how wide a transmit time slice you get.&nbsp; If using the full 802.11 stack (which if you look at tA&#039;s other posts they likely won&#039;t end up doing), yes - if the point-in-time you issue packet data to the card doesn&#039;t align with its slice, it&#039;ll wait in the card&#039;s buffers until it has another transmit window.&nbsp; AFAICT, that&#039;s not a concern here.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>