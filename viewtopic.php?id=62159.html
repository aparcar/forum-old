<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Encoding in Console?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p307637">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">czg1997</div>
					<div class="post-datetime">
						14 Jan 2016, 20:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys,</p><p>I am porting some drivers on the OpenWRT trunk, after the board loads the kernel, the console shows</p><p>---------------------------------------------------------------<br />[&nbsp; &nbsp; 3.492219] init: Console is alive<br />[&nbsp; &nbsp; 4.606697] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 4.617835] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 4.628576] usbcore: registered new device driver usb<br />[&nbsp; &nbsp; 4.648580] SCSI subsystem initialized<br />[&nbsp; &nbsp; 4.662606] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp; 4.677275] ehci-platform: EHCI generic platform driver<br />[&nbsp; &nbsp; 4.707798] ehci-platform ehci-platform: EHCI Host Controller<br />[&nbsp; &nbsp; 4.719322] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1<br />[&nbsp; &nbsp; 4.735267] ehci-platform ehci-platform: irq 18, io mem 0x101c0000<br />[&nbsp; &nbsp; 4.759766] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00<br />[&nbsp; &nbsp; 4.773359] hub 1-0:1.0: USB hub found<br />[&nbsp; &nbsp; 4.781300] hub 1-0:1.0: 1 port detected<br />[&nbsp; &nbsp; 4.792256] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />[&nbsp; &nbsp; 4.806099] ohci-platform: OHCI generic platform driver<br />[&nbsp; &nbsp; 4.836606] ohci-platform ohci-platform: Generic Platform OHCI controller<br />[&nbsp; &nbsp; 4.850210] ohci-platform ohci-platform: new USB bus registered, assigned bus number 2<br />[&nbsp; &nbsp; 4.866129] ohci-platform ohci-platform: irq 18, io mem 0x101c1000<br />[&nbsp; &nbsp; 4.934747] hub 2-0:1.0: USB hub found<br />[&nbsp; &nbsp; 4.942692] hub 2-0:1.0: 1 port detected<br />[&nbsp; &nbsp; 4.964140] usbcore: registered new interface driver usb-storage<br />[&nbsp; &nbsp; 5.508156] init: - preinit -<br />c. wr<br />&nbsp; &nbsp; &nbsp;c. wr<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c. wr<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c. wr<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c. wr<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;d<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Se<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ers 3d g<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [&nbsp; &nbsp; 8.568469] mount_root: jffs2 not ready yet, using temporary tmpfs overlay<br />[&nbsp; &nbsp; 8.599206] procd: - early -<br />[&nbsp; &nbsp; 9.395148] procd: - ubus -<br />[&nbsp; &nbsp;10.403499] random: ubusd urandom read with 16 bits of entropy available<br />[&nbsp; &nbsp;10.418902] procd: - init -&nbsp; &nbsp; &nbsp;<br />---------------------------------------------------------------</p><br /><p>But the strange thing is when I enter commands (like ls), it always shows incorrect characters for output:<br />---------------------------------------------------------------<br />&nbsp; ls<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[m;&nbsp; [u;;&nbsp; lr;&nbsp; [t<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ls<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [m;&nbsp; [u;;&nbsp; lr;&nbsp; [t&nbsp; &nbsp;<br />---------------------------------------------------------------</p><p>All correct text are output by printk. So I guess the &quot;Console&quot; uses a different encoding. How can I change the settings in scripts?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307646">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jmranger</div>
					<div class="post-datetime">
						14 Jan 2016, 21:04					</div>
				</div>
				<div class="post-content content">
					<p>Haven&#039;t done that in a long time, so I&#039;m not sure I&#039;m steering you the right way, but...</p><p>I guess that you&#039;re looking at this over a serial connection. What software are you using? I kind of remember that there are settings in the terminal emulator software. Could this be related to xon/xoff (software flow control) ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307670">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">matty</div>
					<div class="post-datetime">
						15 Jan 2016, 00:24					</div>
				</div>
				<div class="post-content content">
					<p>It looks like its trying to add color to the output (because of the escape character [ ). I know that &#039;Putty&#039; can handle this.<br />You can try &quot;ls --color=never&quot; to see if it looks more normal?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307696">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">czg1997</div>
					<div class="post-datetime">
						15 Jan 2016, 04:08					</div>
				</div>
				<div class="post-content content">
					<p>The terminal software is ZOC. It could show colors. I believe the output from serial port is incomplete. I write an app to see raw output from serial port:</p><p>1. For printk output, the raw buffer is complete, like &quot;init: - preinit -&quot;\n (by procd)<br />2. For bash scripts output, such as /etc/xxx.sh, the output should be &quot;starting&quot;, but actually the output buffer is 0x6120</p><p>So I guess the text is encoded in somewhere before sending it via serial port.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307702">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">czg1997</div>
					<div class="post-datetime">
						15 Jan 2016, 05:43					</div>
				</div>
				<div class="post-content content">
					<p>By the way, after I enter &quot;ls&quot; command, the serial port output the following buffers:<br />6C 73 0A 20 5B 6D 3B 20 20 5B 75 3B 3B 20 20 6C 72 3B 20 20 5B 74 20 CC 00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />ls. [m;&nbsp; [u;;&nbsp; lr;&nbsp; [t ÃŒ.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307789">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">matty</div>
					<div class="post-datetime">
						15 Jan 2016, 23:14					</div>
				</div>
				<div class="post-content content">
					<p>Oooh, I had a look at the hex data too (but using telnet, and a non-openwrt device)<br />* Unfortunately I don&#039;t have access to a easy serial port at the moment *</p><br /><p>ls [1;34mbin<br />6C 73 0A 1B 5B 31 3B 33 34 6D 62 69 6E</p><br /><p>I have noticed the 4th byte here is 0x1B (escape), but you have 0x20 (space or completely missing)</p><p>I believe the encoding is fine, just because its all readable.&nbsp; And I&#039;m assuming its a normal emulation like VT220.<br />So... I wonder if the router is incorrectly sending or completely missing the ESC character.&nbsp; You also seem to be missing the control numbers that go with it (1;34m), but that just might be my miss-interpretation.<br />But I can not find an easy way to check the Linux kernel.&nbsp; Hopefully you can find something?</p><br /><p>EDIT:<br />Regarding the &quot;init: - preinit -&quot; and &quot;starting&quot;.&nbsp; I don&#039;t recall that ever appearing correctly on any router I changed?</p>											<p class="post-edited">(Last edited by <strong>matty</strong> on 15 Jan 2016, 23:29)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>