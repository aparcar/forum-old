<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ALL-U-NEED Ad Blocking by YAQUI - Does it work with OpenWRT</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 Apr 2018 and 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=30760&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=30760&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p138525">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						6 Jul 2011, 04:10					</div>
				</div>
				<div class="post-content content">
					<p>I searched the forums for specific terms such as &quot;ALL-U-NEED&quot; and &quot;YAQUI&quot; but didn&#039;t get any hits on any of the forums.</p><p>My question is whether or not the script below would work on OpenWRT? [My current build is Attitude Adjustment (r27096)]</p><p>I found the script here: <a href="http://www.linksysinfo.org/forums/showthread.php?t=65454">http://www.linksysinfo.org/forums/showt â€¦ hp?t=65454</a> -- and it covers the sections of the script and what it does.</p><p>The script is below...</p><div class="codebox"><pre><code>## ALL-U-NEED Ad Blocking v3.9d
## http://goo.gl/mhykQ
## Original script by YAQUI
## Updated by ~nephelim~, Syl, jochen, groosh, ng12345, ray123, mstombs
## base64 decoder by Danny Chouinard&#039;s

sleep 10

ADB=&quot;/tmp/ADBLOCK.sh&quot;
{
cat &lt;&lt;&#039;ENDF&#039; &gt;$ADB
#!/bin/sh

OPTIMISE=&quot;Y&quot;
GETS=&quot;1 2 3 4&quot;
TRIM_BEGIN=3
S1=&quot;http://pgl.yoyo.org/as/serverlist.php?hostformat=nohtml&quot;  #44K
S2=&quot;http://mirror1.malwaredomains.com/files/justdomains&quot;    #189K
S3=&quot;http://www.malwaredomainlist.com/hostslist/hosts.txt&quot;   #97K
S4=&quot;http://www.mvps.org/winhelp2002/hosts.txt&quot;              #620K
S5=&quot;http://hosts-file.net/hphosts-partial.asp&quot;              #460K
S6=&quot;http://hostsfile.mine.nu/Hosts&quot;                         #2641K
S7=&quot;http://support.it-mate.co.uk/downloads/hosts.txt&quot;       #3851K

USEWHITELIST=&quot;Y&quot; # N/Y/R for remote
WURL=&quot;http://example.com/whitelist.txt&quot;
WHITE=&quot;intel.com&quot;
BLACK=&quot;&quot;

USEPIXELSERV=&quot;N&quot;
PXL_IP=192.168.1.2
PXL_EXE=&quot;/tmp/pixelserv&quot;
PXL_URL=&quot;http://example.com/pixelserv&quot;

UPLOAD=&quot;N&quot;
FTP_SERVER=&quot;example.com&quot;
FTP_USER=&quot;&quot;
FTP_PASS=&quot;&quot;
FTP_PORT=21
FTP_PATH=&quot;/gen&quot;

ADD_CONF=&quot;N&quot;
USEHOSTS=&quot;N&quot;
ROUTER=&quot;Y&quot;

NIP=&quot;0.0.0.0&quot;

ENDF
}

UPDATE=&quot;Y&quot;
AUP() {
if [[ &quot;$UPDATE&quot; == &quot;Y&quot; ]] ; then
if [[ &quot;$(cru l | grep AdUpd | cut -d &#039;#&#039; -f2)&quot; != &quot;AdUpd&quot; ]] ; then
cru a AdUpd &quot;0 4 * * * $ADB&quot;
fi
fi
}

#### DO NOT EDIT BELOW ####

b64=&quot;openssl enc -base64 -d&quot;
[[ &quot;$(echo WQ==|$b64)&quot; != &quot;Y&quot; ]] &amp;&amp; b64=&quot;b64&quot; 

b64(){
awk &#039;BEGIN{b64=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;}
{for(i=1;i&lt;=length($0);i++){c=index(b64,substr($0,i,1));if(c--)
for(b=0;b&lt;6;b++){o=o*2+int(c/32);c=(c*2)%64;if(++obc==8){if(o)
{printf&quot;%c&quot;,o}else{system(&quot;echo -en \&quot;\\0\&quot;&quot;)}obc=o=0}}}}&#039;;}

{
cat &lt;&lt;&#039;ENDF&#039;| $b64 |gunzip &gt;&gt;$ADB
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
/QdjDEMl1Q8AAA==
ENDF
}

chmod 775 $ADB
$ADB
AUP</code></pre></div><p>This would be really convenient as it does download new versions of the websites with a cron job and would really help out with my internet connection at home since I have multiple users on the network.</p><p>Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138526">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						6 Jul 2011, 04:41					</div>
				</div>
				<div class="post-content content">
					<p>Interesting. I hope you will get it working and perhaps write up some howto for posterity.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138563">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						6 Jul 2011, 16:47					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://www.howtogeek.com/51477/how-to-remove-advertisements-with-pixelserv-on-dd-wrt/">How to Remove Advertisements with Pixelserv on DD-WRT - How-To Geek</a><br /><a href="http://www.dd-wrt.com/phpBB2/viewtopic.php?t=52112">DD-WRT Forum :: View topic - Possibility of adding perl to dd-wrt</a><br /><a href="http://www.linksysinfo.org/forums/showthread.php?t=62758">pixelserv compiled to run on router WRT54G - LinksysInfo - Community Forums for Linksys Devices</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138574">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						6 Jul 2011, 18:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fyi wrote:</cite><blockquote><p><a href="http://www.howtogeek.com/51477/how-to-remove-advertisements-with-pixelserv-on-dd-wrt/">How to Remove Advertisements with Pixelserv on DD-WRT - How-To Geek</a><br /><a href="http://www.dd-wrt.com/phpBB2/viewtopic.php?t=52112">DD-WRT Forum :: View topic - Possibility of adding perl to dd-wrt</a><br /><a href="http://www.linksysinfo.org/forums/showthread.php?t=62758">pixelserv compiled to run on router WRT54G - LinksysInfo - Community Forums for Linksys Devices</a></p></blockquote></div><p>fyi:<br />For-your-information, to use any of the above requires extensive re-write of the scripts to run with openwtrt.&nbsp; I know because I have done it.&nbsp; Re-write needs to change from use of /jffs, change from use of nvram, change the alias network interface used, change the way file-age of file is determined (-mtime does not work with the find command in openwrt), change the way that the cron entry is created, change the iptables entry to work properly.&nbsp; Encyclopedic references are somewhat helpful, but actually having accomplished something can impart real knowledge.</p>											<p class="post-edited">(Last edited by <strong>KingJL</strong> on 6 Jul 2011, 18:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138577">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						6 Jul 2011, 18:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KingJL wrote:</cite><blockquote><p>I know because I have done it.</p></blockquote></div><p>KingJL -- could you share some of what you&#039;ve used to accomplish this? I realized there was a great deal of commands within the script I posted that didn&#039;t (or wouldn&#039;t) work and I didn&#039;t want to drop this into my router&#039;s start-up just to see if it would work.</p><p>Any help you could provide would be greatly appreciated -- even if that help is just pointing me to a forum/wiki that acts like a Rosetta Stone to the commands in the script to function within OpenWRT.</p><p>Thanks in advance</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138579">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						6 Jul 2011, 19:07					</div>
				</div>
				<div class="post-content content">
					<p>What architecture are you using.&nbsp; I can provide a zip file that works with the latest trunk for ar71xx w/ath9k architecture.&nbsp; If you are not the trunk ar71xx ath9k, the network interface alias will need to be changed.&nbsp; If you are not ar71xx, you will need to find a different pixelserv binary (i do have a binary for broadcom).&nbsp; If you want the zip file, PM me with your email address.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138581">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						6 Jul 2011, 20:12					</div>
				</div>
				<div class="post-content content">
					<p>KingKL, I am interested in your mods. I have a router based on an AR71XX platform. If it is easy to modify to use on a BRCM47XX platform, that will be cool too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138584">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						6 Jul 2011, 20:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>KingKL, I am interested in your mods. I have a router based on an AR71XX platform. If it is easy to modify to use on a BRCM47XX platform, that will be cool too.</p></blockquote></div><p>PM with a valid email address (forum email does not provide for attachments).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138589">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						6 Jul 2011, 22:11					</div>
				</div>
				<div class="post-content content">
					<p>PM sent -- thanks KingJL <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138651">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						7 Jul 2011, 20:17					</div>
				</div>
				<div class="post-content content">
					<p>Thanks again for the PM KingJL.</p><p>I&#039;ve gotten the files over to the router and attempted to get it running. I&#039;ve followed your instructions within your e-mail and created the necessary directory on the router and copied the files over to that path. I&#039;ve also made sure to modify the files so that they were executable. The only file I&#039;ve place into startup is the script to disable the advertisements since the pixelserv process is called within that shell script. I&#039;ve also made sure that all the calls on interfaces within the script match what is actually used by my firmware on the router.</p><p>When I reboot the router though -- the shell script isn&#039;t being executed or it isn&#039;t staying up as a process because it isn&#039;t showing as an active process.</p><div class="codebox"><pre><code>root@OpenWrt:/etc/dns# ps | grep -v grep | grep /etc/dns/disable_adds.sh 
root@OpenWrt:/etc/dns#</code></pre></div><p>I&#039;m not sure what I may have done incorrectly -- but here is a listing of the files in their respective path on the router.</p><div class="codebox"><pre><code>root@OpenWrt:/etc/dns# pwd
/etc/dns
root@OpenWrt:/etc/dns# ls -l
-rwxr-xr-x    1 root     root          5099 Jun 28 21:47 disable_adds.sh
-rwxr-xr-x    1 root     root          7596 Jun 28 21:48 pixelserv</code></pre></div><p>This is my &quot;Local Startup&quot; within the Luci console.</p><div class="codebox"><pre><code># Put your custom commands here that should be executed once
# the system init finished. By default this file does nothing.

mkdir /var/log/openvpn &amp;
/etc/openvpn/openvpnbridge &amp;
openvpn /etc/openvpn/vpn.conf &amp;
/etc/dns/disable_adds.sh &amp;


exit 0</code></pre></div><p>Any help would be greatly appreciated -- and more than likely is something missed incidentally.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138654">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 Jul 2011, 20:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KingJL wrote:</cite><blockquote><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>KingKL, I am interested in your mods. I have a router based on an AR71XX platform. If it is easy to modify to use on a BRCM47XX platform, that will be cool too.</p></blockquote></div><p>PM with a valid email address (forum email does not provide for attachments).</p></blockquote></div><p>I PMed you my e-mail address a few days ago and have not received your codes, yet. If you didn&#039;t receive my PM, you can send your code as an attachment to me on KingJL@slickdeals.endjunk.com e-mail address. Once I have received your e-mail, I will inform you here and disable this e-mail address.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138655">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						7 Jul 2011, 20:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><div class="quotebox"><cite>KingJL wrote:</cite><blockquote><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>KingKL, I am interested in your mods. I have a router based on an AR71XX platform. If it is easy to modify to use on a BRCM47XX platform, that will be cool too.</p></blockquote></div><p>PM with a valid email address (forum email does not provide for attachments).</p></blockquote></div><p>I PMed you my e-mail address a few days ago and have not received your codes, yet. If you didn&#039;t receive my PM, you can send your code as an attachment to me on KingJL@slickdeals.endjunk.com e-mail address. Once I have received your e-mail, I will inform you here and disable this e-mail address.</p></blockquote></div><p>PM&#039;d you mazilo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138657">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						7 Jul 2011, 21:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rgranados80 wrote:</cite><blockquote><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><div class="quotebox"><cite>KingJL wrote:</cite><blockquote><p>PM with a valid email address (forum email does not provide for attachments).</p></blockquote></div><p>I PMed you my e-mail address a few days ago and have not received your codes, yet. If you didn&#039;t receive my PM, you can send your code as an attachment to me on KingJL@slickdeals.endjunk.com e-mail address. Once I have received your e-mail, I will inform you here and disable this e-mail address.</p></blockquote></div><p>PM&#039;d you mazilo</p></blockquote></div><p>I sent this out to you and rgranados80 (email was address to both of you) yesterday to the email address in your original PM!&nbsp; Just resent to that email and the temp email address in previous post.&nbsp; Did rgranados80 get it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138658">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						7 Jul 2011, 21:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KingJL wrote:</cite><blockquote><p>Did rgranados80 get it?</p></blockquote></div><p>Yep -- just posted above the problems I&#039;m experiencing above. PM sent too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138659">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						7 Jul 2011, 22:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rgranados80 wrote:</cite><blockquote><p>Thanks again for the PM KingJL.</p><p>I&#039;ve gotten the files over to the router and attempted to get it running. I&#039;ve followed your instructions within your e-mail and created the necessary directory on the router and copied the files over to that path. I&#039;ve also made sure to modify the files so that they were executable. The only file I&#039;ve place into startup is the script to disable the advertisements since the pixelserv process is called within that shell script. I&#039;ve also made sure that all the calls on interfaces within the script match what is actually used by my firmware on the router.</p><p>When I reboot the router though -- the shell script isn&#039;t being executed or it isn&#039;t staying up as a process because it isn&#039;t showing as an active process.</p><div class="codebox"><pre><code>root@OpenWrt:/etc/dns# ps | grep -v grep | grep /etc/dns/disable_adds.sh 
root@OpenWrt:/etc/dns#</code></pre></div><p>I&#039;m not sure what I may have done incorrectly -- but here is a listing of the files in their respective path on the router.</p><div class="codebox"><pre><code>root@OpenWrt:/etc/dns# pwd
/etc/dns
root@OpenWrt:/etc/dns# ls -l
-rwxr-xr-x    1 root     root          5099 Jun 28 21:47 disable_adds.sh
-rwxr-xr-x    1 root     root          7596 Jun 28 21:48 pixelserv</code></pre></div><p>This is my &quot;Local Startup&quot; within the Luci console.</p><div class="codebox"><pre><code># Put your custom commands here that should be executed once
# the system init finished. By default this file does nothing.

mkdir /var/log/openvpn &amp;
/etc/openvpn/openvpnbridge &amp;
openvpn /etc/openvpn/vpn.conf &amp;
/etc/dns/disable_adds.sh &amp;


exit 0</code></pre></div><p>Any help would be greatly appreciated -- and more than likely is something missed incidentally.</p></blockquote></div><p>Directories, disable_adds.sh, and pixelserv appear ok.</p><p>Take your disable_adds.sh command out of startup temporarily until you see why the script is not running.</p><p>reboot, then ssh into the router and run the disable_adds.sh script manually.&nbsp; See if any errors.<br />Also in LuCi take a look at the system log,&nbsp; there are entries &quot;local0.notice&quot; &quot;ad_blocker_script&quot; that indicate progress.<br />When the shell script successfully completes ther will be 4 additional files in the /etc/dns directory.</p><p>The package, as sent, is set up for ar71xx, trunk build (not backfire), and the interface alias of the br-lan interface (creates br-lan:1).&nbsp; Check if you have br-lan with ifconfig.</p>											<p class="post-edited">(Last edited by <strong>KingJL</strong> on 7 Jul 2011, 22:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138660">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						7 Jul 2011, 22:33					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve gone ahead and removed the script from the start up to be on the safe side.</p><p>When I tried to run the script manually -- I&#039;m getting the messages below?</p><div class="codebox"><pre><code>root@OpenWrt:~# cd /etc/dns
root@OpenWrt:/etc/dns# ls
disable_adds.sh  pixelserv
root@OpenWrt:/etc/dns# ./disable_adds.sh 
-ash: ./disable_adds.sh: not found
root@OpenWrt:/etc/dns# ./etc/dns/disable_adds.sh
-ash: ./etc/dns/disable_adds.sh: not found</code></pre></div><p>I was curious of where I could find the logs for the router in general -- and I&#039;m not familiar with what I&#039;d be looking for within them yet. I&#039;m also uncertain of the four files that would be located in the /etc/dns path -- but I knew there would be two; &quot;dlhosts&quot; and &quot;adblock.conf&quot; (I&#039;ve only gotten that far in the script. None of those files have been created since the script hasn&#039;t been able to be run on my router it seems.</p><p>The build that my router is running is a Trunk build and is based on the ar71xx architecture. Truly stumped at&nbsp; the moment. :T</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138661">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						7 Jul 2011, 22:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rgranados80 wrote:</cite><blockquote><p>I&#039;ve gone ahead and removed the script from the start up to be on the safe side.</p><p>When I tried to run the script manually -- I&#039;m getting the messages below?</p><div class="codebox"><pre><code>root@OpenWrt:~# cd /etc/dns
root@OpenWrt:/etc/dns# ls
disable_adds.sh  pixelserv
root@OpenWrt:/etc/dns# ./disable_adds.sh 
-ash: ./disable_adds.sh: not found
root@OpenWrt:/etc/dns# ./etc/dns/disable_adds.sh
-ash: ./etc/dns/disable_adds.sh: not found</code></pre></div><p>I was curious of where I could find the logs for the router in general -- and I&#039;m not familiar with what I&#039;d be looking for within them yet. I&#039;m also uncertain of the four files that would be located in the /etc/dns path -- but I knew there would be two; &quot;dlhosts&quot; and &quot;adblock.conf&quot; (I&#039;ve only gotten that far in the script. None of those files have been created since the script hasn&#039;t been able to be run on my router it seems.</p><p>The build that my router is running is a Trunk build and is based on the ar71xx architecture. Truly stumped at&nbsp; the moment. :T</p></blockquote></div><p>For right now, you&#039;ve got me stumped!&nbsp; For the last command above change it from</p><div class="codebox"><pre><code>./etc/dns/disable_adds.sh</code></pre></div><p>to </p><div class="codebox"><pre><code>/etc/dns/disable_adds.sh</code></pre></div><p>For some reason the sh doesn&#039;t see disable_adds as ann executable scrript.&nbsp; Once you discover why, things can progress.</p><p>When the scrip successfully finishes the /etc/dns directory will look as follows</p><div class="codebox"><pre><code>root@OpenWrt:/etc/dns# ls
adblock.conf            dlhosts                 pixelserv
disable_adds.sh         personal-ads-list.conf  whitelist</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138662">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						7 Jul 2011, 22:53					</div>
				</div>
				<div class="post-content content">
					<p>Alright -- I&#039;ve made some progress with a google search. This is the first time I&#039;ve ever had to do this since I started meddling around within *nix type systems.</p><div class="codebox"><pre><code>root@OpenWrt:/etc/dns# sh disable_adds.sh 
: not founds.sh: line 10: {
ad_blocker_script: 
: not founds.sh: line 12: }
: not founds.sh: line 13: 
: not founds.sh: line 15: 
: not founds.sh: line 16: 
: not founds.sh: line 17: 
disable_adds.sh: line 105: syntax error: unexpected end of file (expecting &quot;done&quot;)</code></pre></div><p>I had to pre-fix the script with &quot;sh&quot; -- and then it gave me the output you see above. Do I need to make more modifications to the file permissions?</p><div class="codebox"><pre><code>root@OpenWrt:/etc/dns# ls -l
-rwxr-xr-x    1 root     root          5099 Jun 28 21:47 disable_adds.sh
-rwxr-xr-x    1 root     root          7596 Jun 28 21:48 pixelserv</code></pre></div><p>At least I was able to make it attempt to run within the shell.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138664">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 Jul 2011, 23:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KingJL wrote:</cite><blockquote><div class="quotebox"><cite>rgranados80 wrote:</cite><blockquote><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>I PMed you my e-mail address a few days ago and have not received your codes, yet. If you didn&#039;t receive my PM, you can send your code as an attachment to me on KingJL@slickdeals.endjunk.com e-mail address. Once I have received your e-mail, I will inform you here and disable this e-mail address.</p></blockquote></div><p>PM&#039;d you mazilo</p></blockquote></div><p>I sent this out to you and rgranados80 (email was address to both of you) yesterday to the email address in your original PM!&nbsp; Just resent to that email and the temp email address in previous post.&nbsp; Did rgranados80 get it?</p></blockquote></div><p>Thanks. I received your e-mail with an attachment.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138665">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						7 Jul 2011, 23:15					</div>
				</div>
				<div class="post-content content">
					<p>The errors reported do not make sense.&nbsp; There is something wierd about your shell environment.&nbsp; Busybox with it&#039;s built in shell is not functioning as mine (Bleeding Edge r27170) does.&nbsp; I wonder if it is some busybox features that are not enabled or some needed packages missing in your configuration.&nbsp; I am at a loss!</p><p>inspect the disable_ads.sh script.&nbsp; It may be corrupted! Here is the script below:</p><div class="codebox"><pre><code>#!/bin/sh
########Debug commands for terminal############
#echo &quot;alias mem=&#039;cat /proc/meminfo&#039;&quot; &gt;&gt;/tmp/root/.profile
#echo &quot;alias ll=&#039;ls -lash --color=auto&#039;&quot; &gt;&gt;/tmp/root/.profile
#echo &quot;alias ls=&#039;ls --color=auto&#039;&quot; &gt;&gt;/tmp/root/.profile
#echo &quot;alias tlog=&#039;tail -f /var/log/messages&#039;&quot; &gt;&gt;/tmp/root/.profile
#echo &quot;alias clog=&#039;cat /var/log/messages | grep local0.notice&#039;&quot; &gt;&gt;/tmp/root/.profile
########Functions setup#########################
logger_ads()
{
logger -s -p local0.notice -t ad_blocker_script $1
}
 
##################################################

logger_ads &quot;###########Ads blocker ed###########&quot;

if [[ -z &quot;$1&quot; ]]; then
    logger_ads &quot;Sleeping for 30 secs to give time for router boot&quot;
    sleep 30
else
    logger_ads &quot;override switch given&quot;
    [[ $1 = &quot;-h&quot; || $1 = &quot;/?&quot; ]] &amp;&amp; echo &quot;use -m to override the 30 seconds delay and -f to force a list refresh&quot; &amp;&amp; exit 0    
    [ $1 = &quot;-f&quot; ] &amp;&amp; rm /etc/dns/adblock.conf &amp;&amp; rm /etc/dns/dlhosts
fi

# while ! ping www.google.com -c 1 &gt; /dev/null ; do
# use wget for thos instances where the host network prevents pings
while ! wget http://www.google.com -O /dev/null 2&gt;/dev/null ; do
    logger_ads &quot;waiting for the internet connection to come up&quot;
    sleep 5
done
 
logger_ads &quot;New IP and ports setup&quot;
pixel=&quot;`ifconfig br-lan | grep inet | awk &#039;{ print $3 }&#039; | awk -F &quot;:&quot; &#039;{ print $2 }&#039; | cut -d . -f 1,2,3`.254&quot;
/sbin/ifconfig br-lan:1 $pixel
#/sbin/ifconfig br-lan:1 $pixel netmask &quot;`ifconfig br-lan | grep inet | awk &#039;{ print $4 }&#039; | awk -F &quot;:&quot; &#039;{ print $2 }&#039;`&quot; broadcast &quot;`ifconfig br-lan | grep inet | awk &#039;{ print $3 }&#039; | awk -F &quot;:&quot; &#039;{ print $2 }&#039;`&quot; up
 
logger_ads &quot;Adding a refresh cycle by puting the script in cron if it isnt there yet&quot;
if [[ -z &quot;`cat /etc/crontabs/root | grep &quot;/etc/dns/disable_adds.sh&quot;`&quot; ]] ; then
    echo &#039;0 0 * * * root /etc/dns/disable_adds.sh -m&#039; &gt;&gt; /etc/crontabs/root
    /etc/init.d/cron restart &amp;&amp; logger_ads &quot;restarted the cron service&quot;
else
    logger_ads &quot;The script is already in cron&quot;
fi

logger_ads &quot;Redirect setup &amp; Appending to the FW script&quot;
[[ -z &quot;`iptables -L -n -t nat | grep ${pixel} | grep 88`&quot; ]] &amp;&amp; logger_ads &quot;did NOT find an active redirect rule with the iptable command, injecting it now.&quot; &amp;&amp; /usr/sbin/iptables -t nat -I PREROUTING 1 -d ${pixel} -p tcp --dport 80 -j DNAT --to ${pixel}:88

 
logger_ads &quot;Starting or ReSpawning pixelsrv&quot;
if [[ -n &quot;`ps | grep -v grep | grep /etc/dns/pixelserv`&quot; ]]
then
logger_ads &quot;the pixelserv is already up&quot;
else
logger_ads &quot;it seems that the pixelserv isnt up. starting it now&quot;
/etc/dns/pixelserv $pixel -p 88
fi

logger_ads &quot;Get the online lists&quot;
tnow=`date +%s`
tdlh=`date +%s -r /etc/dns/dlhosts`
tadblk=`date +%s -r /etc/dns/adblock.conf`
tdlh=`expr $tdlh + 86400`
tadblk=`expr $tadblk + 86400`

[ ! -e /etc/dns/whitelist ] &amp;&amp; echo google-analytics &gt; /etc/dns/whitelist &amp;&amp; echo googleadservices &gt;&gt; /etc/dns/whitelist
if [[ $tnow -ge $tdlh || $tnow -ge $tadblk || ! -e /etc/dns/dlhosts || ! -e /etc/dns/adblock.conf ]]; then
    logger_ads &quot;The lists are NOT setup at all yet, or more then 3 days old. will now retrieve them from the web&quot;
    logger_ads &quot;Retrieving the MVPS hosts list&quot;
    wget -q -O - http://www.mvps.org/winhelp2002/hosts.txt | grep &quot;^127.0.0.1&quot; | grep -v localhost | tr -d &#039;\015&#039; &gt;/tmp/dlhosts.tmp
    logger_ads &quot;adjusting the MVPS hosts list for our use&quot;
    cat /etc/dns/whitelist | while read line; do sed -i /${line}/d /tmp/dlhosts.tmp ; done
    sed -i s/127.0.0.1/$pixel/g /tmp/dlhosts.tmp
    logger_ads &quot;done adjusting the MVPS hosts list use&quot;
    logger_ads &quot;retrieving the Yoyo domain list&quot;
    wget -q &quot;http://pgl.yoyo.org/adservers/serverlist.php?hostformat=dnsmasq&amp;showintro=0&amp;mimetype=plaintext&quot; -O /tmp/adblock.tmp
    logger_ads &quot;adjusting the Yoyo domain list for our use&quot;
    cat /etc/dns/whitelist | while read line; do sed -i /${line}/d /tmp/adblock.tmp ; done
    sed -i s/127.0.0.1/$pixel/g /tmp/adblock.tmp
    logger_ads &quot;Moving the Yoyo list to etc&quot;
    mv /tmp/adblock.tmp /etc/dns/adblock.conf
    logger_ads &quot;Moving the MVPS hosts list to etc&quot;
    mv /tmp/dlhosts.tmp /etc/dns/dlhosts

else
    logger_ads &quot;The lists are less then 3 days old, saving on flash erosion and NOT refreshing them&quot;
fi
 
logger_ads &quot;Removing whitelist from the personal file&quot;
[ ! -e /etc/dns/personal-ads-list.conf ] &amp;&amp; touch /etc/dns/personal-ads-list.conf
cat /etc/dns/whitelist | while read line; do sed -i /${line}/d /etc/dns/personal-ads-list.conf ; done

# Replace the adblock stuff in the &quot;dnsmasq.conf&quot; file.
sed  -i &quot;/^#BEGIN--adblock-custom/,/^#END--adblock-custom/d&quot; /etc/dnsmasq.conf
echo &quot;#BEGIN--adblock-custom&quot; &gt;&gt;/etc/dnsmasq.conf
echo &quot;conf-file=/etc/dns/adblock.conf&quot; &gt;&gt;/etc/dnsmasq.conf
echo &quot;addn-hosts=/etc/dns/dlhosts&quot; &gt;&gt;/etc/dnsmasq.conf
echo &quot;conf-file=/etc/dns/personal-ads-list.conf&quot; &gt;&gt; /etc/dnsmasq.conf
echo &quot;#END--adblock-custom&quot; &gt;&gt;/etc/dnsmasq.conf

logger_ads &quot;Refreshing DNS settings&quot;
/etc/init.d/dnsmasq restart &amp;&amp; logger_ads &quot;restarted the dnsmasq service&quot;

logger_ads &quot;##########The Ads blocker script has finished its run and you should up and running##########&quot;</code></pre></div>											<p class="post-edited">(Last edited by <strong>KingJL</strong> on 7 Jul 2011, 23:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138666">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						7 Jul 2011, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>After reviewing the location the shell responded as being &quot;wrong&quot; I was also stumped. It&#039;s stopping on the brackets for some reason...</p><div class="codebox"><pre><code>BusyBox v1.18.4 (2011-06-03 02:18:49 CEST) multi-call binary.</code></pre></div><p>These are the modules I have loaded.</p><div class="codebox"><pre><code>Module
aes_generic
arc4
ath
ath9k
ath9k_common
ath9k_hw
button_hotplug
cfg80211
compat
crc_ccitt
crypto_algapi
ehci_hcd
gpio_keys_polled
input_core
input_polldev
ip_tables
ipt_LOG
ipt_MASQUERADE
ipt_REJECT
iptable_filter
iptable_mangle
iptable_nat
iptable_raw
leds_gpio
leds_wndr3700_usb
ledtrig_usbdev
mac80211
nf_conntrack
nf_conntrack_ftp
nf_conntrack_ipv4
nf_conntrack_irc
nf_defrag_ipv4
nf_nat
nf_nat_ftp
nf_nat_irc
nls_base
ohci_hcd
ppp_async
ppp_generic
pppoe
pppox
slhc
tun
usbcore
x_tables
xt_comment
xt_conntrack
xt_limit
xt_mac
xt_multiport
xt_NOTRACK
xt_state
xt_TCPMSS
xt_tcpudp</code></pre></div><p>I can&#039;t think of anything else I could provide to explain what is running -- unless you can think of any.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138667">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						7 Jul 2011, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>rgranados80:<br />In LuCi go to System-&gt;Software<br />What version of busybox is listed?<br />My version is: 1.18.4-1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138670">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">rgranados80</div>
					<div class="post-datetime">
						7 Jul 2011, 23:44					</div>
				</div>
				<div class="post-content content">
					<p>busybox&nbsp; &nbsp; 1.18.4-1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138671">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						7 Jul 2011, 23:55					</div>
				</div>
				<div class="post-content content">
					<p>Maybe a dev can give a hint to where to look!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138676">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">KingJL</div>
					<div class="post-datetime">
						8 Jul 2011, 00:28					</div>
				</div>
				<div class="post-content content">
					<p>rgranados80:<br />What are the permissions on the /etc/dns directory?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=30760&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=30760&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>