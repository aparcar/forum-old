<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Modul nf_conntrack_ftp</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p109626">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">rymn</div>
					<div class="post-datetime">
						22 May 2010, 00:52					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>in order to get passive ftp working, i need the kernel-module nf_conntrack_ftp ... but unfortunately its not included i my bf buid (<a href="http://openwrt.groov.pl/WR1043NDv1/backfire-10.3/EN_README">http://openwrt.groov.pl/WR1043NDv1/back … /EN_README</a>).</p><p>What package do i have to install in order to get this kernel-module?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109693">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">rymn</div>
					<div class="post-datetime">
						23 May 2010, 16:50					</div>
				</div>
				<div class="post-content content">
					<p>Any ideas? I which opk-package nf_conntrack_ftp is normaly delivered? Or is it included in the standard firmare-image?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109700">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						23 May 2010, 20:21					</div>
				</div>
				<div class="post-content content">
					<p>iptables-mod-conntrack</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109741">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">rymn</div>
					<div class="post-datetime">
						24 May 2010, 11:35					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your reply.</p><p>Unfortunately the module NF_CONNTRACK_FTP ist not in the package:</p><p>root@OpenWrt:~# opkg files iptables-mod-conntrack<br />Package iptables-mod-conntrack (1.4.6-2) is installed on root and has the following files:<br />/usr/lib/iptables/libxt_NOTRACK.so<br />/usr/lib/iptables/libxt_state.so<br />root@OpenWrt:~#</p><p>root@OpenWrt:~# opkg install kmod-ipt-conntrack --force-reinstall<br />Reinstalling kmod-ipt-conntrack (2.6.32.10-1) on root...<br />Downloading <a href="http://downloads.openwrt.org/backfire/10.03/ar71xx/packages/kmod-ipt-conntrack_2.6.32.10-1_ar71xx.ipk">http://downloads.openwrt.org/backfire/1 … ar71xx.ipk</a>.<br />Configuring kmod-ipt-conntrack.<br />root@OpenWrt:~# opkg files kmod-ipt-conntrack<br />Package kmod-ipt-conntrack (2.6.32.10-1) is installed on root and has the following files:<br />/lib/modules/2.6.32.10/xt_NOTRACK.ko<br />/lib/modules/2.6.32.10/nf_conntrack.ko<br />/etc/modules.d/41-ipt-conntrack<br />/lib/modules/2.6.32.10/nf_defrag_ipv4.ko<br />/lib/modules/2.6.32.10/iptable_raw.ko<br />/lib/modules/2.6.32.10/xt_state.ko<br />/lib/modules/2.6.32.10/nf_conntrack_ipv4.ko<br />root@OpenWrt:~#</p><br /><p>Is there another package i could try? Or is there a package search engine aviable (like apt-file) where i could search in all packages (also the not installed packages) where a file is?</p>											<p class="post-edited">(Last edited by <strong>rymn</strong> on 24 May 2010, 11:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109749">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						24 May 2010, 14:48					</div>
				</div>
				<div class="post-content content">
					<p>Yes, there is an iptables-mod-conntrack-extra with further ct helpers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109752">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">rymn</div>
					<div class="post-datetime">
						24 May 2010, 14:55					</div>
				</div>
				<div class="post-content content">
					<p>i tryed this also - there is no NF_CONNTRACK_FTP - Module in this package .... any other hints?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109758">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						24 May 2010, 15:19					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I just checked. nf_conntrack_ftp is in kmod-ipt-nathelper</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109771">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						24 May 2010, 17:11					</div>
				</div>
				<div class="post-content content">
					<p>[s]See for example this Makefile, its for an out-of-tree wireless driver.<br /><a href="https://dev.openwrt.org/browser/trunk/package/carl9170/Makefile">https://dev.openwrt.org/browser/trunk/p … 0/Makefile</a>[/s]</p><p>That post does not belong here, it was meant to appear in <a href="https://forum.openwrt.org/viewtopic.php?id=24907">https://forum.openwrt.org/viewtopic.php?id=24907</a></p>											<p class="post-edited">(Last edited by <strong>jow</strong> on 25 May 2010, 00:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109794">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">rymn</div>
					<div class="post-datetime">
						25 May 2010, 00:14					</div>
				</div>
				<div class="post-content content">
					<p>Thank you !!! kmod-ipt-nathelper - That was the missing hint: Now i can accept incomming passive-ftp connections with enabled firewall</p>											<p class="post-edited">(Last edited by <strong>rymn</strong> on 25 May 2010, 00:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109836">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">TobsTec</div>
					<div class="post-datetime">
						25 May 2010, 13:08					</div>
				</div>
				<div class="post-content content">
					<p>@rymn:<br />Did you edit the default firewall/iptables setup to get passive ftp client access from lan to wan working?<br />The default setup just keeps dropping packets for me. See here: <a href="https://forum.openwrt.org/viewtopic.php?id=24900">https://forum.openwrt.org/viewtopic.php?id=24900</a><br />It&#039;s really annoying as i cannot even download any linux source package without 10-20 retries until it falls back to HTTP :-(((((<br />Thought the conntrack module should open the port when needed by default. <br />But maybe it&#039;s some really difficult issue as NAT and masquerading, prerouting postrouting e.t.c. comes on top. No idea, my Linux-End-User knowledge is not up to cracking this one...</p><p>Tobias</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109842">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">rymn</div>
					<div class="post-datetime">
						25 May 2010, 14:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi Tobias,</p><p>i modifyed tho following two files, in order to get incomming passive ftp to work (i use vsftpd that accepts passive ftp):</p><p>/etc/config/firewall</p><p>config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option _name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FTP<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 815<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><br /><br /><p>/etc/modules.d/45-ipt-nathelper<br />nf_conntrack_ftp ports=815</p><br /><p>You must substitude the 815 with the port of your ftp server</p>											<p class="post-edited">(Last edited by <strong>rymn</strong> on 25 May 2010, 14:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109854">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">TobsTec</div>
					<div class="post-datetime">
						25 May 2010, 16:30					</div>
				</div>
				<div class="post-content content">
					<p>Thanks rymn!</p><p>So how does it work the other way round? I can&#039;t access FTP servers in passive mode which are in WAN / ppp0 ...<br />As soon as i enter &quot;passive&quot; in the FTP client the connection is dead.</p><p>Tobias</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109862">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">rymn</div>
					<div class="post-datetime">
						25 May 2010, 18:05					</div>
				</div>
				<div class="post-content content">
					<p>perhaps dont need the fierewall rule but the kernel-module for natig pasive ftp: nf_conntrack_ftp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109874">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">TobsTec</div>
					<div class="post-datetime">
						25 May 2010, 21:32					</div>
				</div>
				<div class="post-content content">
					<p>The conntrack module is loaded, otherwhise i wouldn&#039;t get these log messages from the deepest pits of hell i guess:</p><p>May 23 12:42:50 router user.emerg kernel: nf_ct_ftp: dropping packetIN= OUT=br-lan SRC=195.27.236.210 DST=192.168.0.3 LEN=98 TOS=0x00 PREC=0x00 TTL=252 ID=55680 PROTO=TCP SPT=21 DPT=52738 SEQ=3981344773 ACK=3658541342 WINDOW=32768 RES=0x00 ACK PSH URGP=0 OPT (0101080A08</p><p>*sigh*<br />Tobias</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109876">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">siris</div>
					<div class="post-datetime">
						25 May 2010, 22:05					</div>
				</div>
				<div class="post-content content">
					<p>Do you have an IPtables port 21 permit rule (if not have you added your FTP port to the port list that Rymn has suggested)?&nbsp; The nf_conntrack_ftp helper module creates an expectation within netfilter to allow the ftp data channel to pass data.&nbsp; That sysloged rule appears to be the FTP response from the server back to your client on your command channel.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109919">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">TobsTec</div>
					<div class="post-datetime">
						26 May 2010, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>Intresting.. Why do i have to open port 21 on my firewall to access FTP servers in the internet??? Isn&#039;t that what the evil conntrack module is supposed to do automatically? ... I really don&#039;t get it... Mooore beeer... </p><p>@All the kind guys trying to help me:<br />Can we move the discussion to <a href="https://forum.openwrt.org/viewtopic.php?id=24900">https://forum.openwrt.org/viewtopic.php?id=24900</a> ?<br />Sorry for highjacking your thread rymn :&gt;</p><p>Tobias</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>