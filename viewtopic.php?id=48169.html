<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Can a WR702 be upgraded to run OpenWrt?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p221553">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Mark_V</div>
					<div class="post-datetime">
						3 Jan 2014, 13:01					</div>
				</div>
				<div class="post-content content">
					<p>The default flash is to small to run OpenWrt, but i have some<br />flash chips (16Mb) which i normally use for the wr703.</p><p>Can i fit one in the wr702 to run OpenWrt? and is the flash<br />layout (Uboot/data/Firmware/ART) the same?</p><p>Besides flash the ram is only 16Mb is this enough to run OpenWrt?</p><p>I know that the price difference between a wr702 and a wr703 is<br />very small to go throught all this trouble, but i have the hardware<br />and all it have to do is run a small telnet server with a bash script.</p><p>Grtzz&nbsp; Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p221564">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						3 Jan 2014, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>Do you mean 16 MB?,&nbsp; also you say the RAM is 16Mb, the but the wiki says 8 MB. might be enough with a very stripped Openwrt compiled by yourself.&nbsp; </p><p>I don&#039;t have this router, but I think this is possible.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p221571">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Mark_V</div>
					<div class="post-datetime">
						3 Jan 2014, 17:21					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the answer, and indeed the Wiki says 8Mb ram (i thought it was 16Mb ram)<br />i also have some ram chips (64Mb)&nbsp; but it will be a nightmare to get it in... (66 TSOP)</p><p>If it&#039;s only a FLASH/RAM problem i can solve that, the rest of the hardware is identical<br />to a wr703 i hope...</p><p>Grtzz&nbsp; Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p221668">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">dimonix</div>
					<div class="post-datetime">
						4 Jan 2014, 22:08					</div>
				</div>
				<div class="post-content content">
					<p>I did upgrade wr702n to 64Mbyte RAM / 16Mbyte flash and OpenWRT. It has the same hardware as wr703n, except for missing USB plug and USB related tiny pieces of hardware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p221722">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Mark_V</div>
					<div class="post-datetime">
						5 Jan 2014, 14:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dimonix wrote:</cite><blockquote><p>I did upgrade wr702n to 64Mbyte RAM / 16Mbyte flash and OpenWRT. It has the same hardware as wr703n, except for missing USB plug and USB related tiny pieces of hardware.</p></blockquote></div><p>That&#039;s good! to hear thank you for the answer, i don&#039;t need the USB, it only tears a webpage every 5 minutes and parses it<br />so that my AMX can telnet the data for further use, a perfect! job for a wr702.</p><p>Grtzz&nbsp; Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224396">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">psyko_chewbacca</div>
					<div class="post-datetime">
						3 Feb 2014, 04:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dimonix wrote:</cite><blockquote><p>I did upgrade wr702n to 64Mbyte RAM / 16Mbyte flash and OpenWRT. It has the same hardware as wr703n, except for missing USB plug and USB related tiny pieces of hardware.</p></blockquote></div><p>That&#039;s exactly what I&#039;m currently doing. I&#039;ve got the 64MB ram chip soldered on. I dumped the stock flash chip and replaced U-Boot on the 2MB flash with pepe2k&#039;s modified one. </p><p>So right now I do have the failsafe web interface of U-Boot. It takes the first 64KB of the 2MB, the rest is untouched. I plan on programming this 2MB image (custom U-Boot + stock firmware image) on the 16MB chip once I get it.</p><p>Now I&#039;m not sure if it&#039;s how to do it properly... I plan on updating the firmware with an openWRT &quot;sysupgrade&quot; image (custom built for 16MB flash) using U-Boot firmware upgrade page. I just hope this will properly map the ART partition and retreive it from the untouched stock flash offset.</p><p>Is it how it should be done?</p><p>Should I put the 100% stock image of the TL-WR702N on the 16MB and upgrade firmware to openWRT using the 16MB build generated for when you flash from official firmware?</p><p>I just want to make sure I get the proper specific data (MAC, serial, ART) when I upgrade to openWRT!</p><p>Thanks.</p><p>EDIT: <br />I&#039;d also like to get my head clear on the flash layout of the WR702N.</p><p>From what I read about WR703 the first 128KB is reserved for U-Boot(first 64KB) and specific unit Data like MAC(second 64KB). The last 64KB of the 2MB is ART partition. The rest can be considered as the &quot;firmware&quot; partition and contains no unit-specific data. </p><p>Is that right?</p>											<p class="post-edited">(Last edited by <strong>psyko_chewbacca</strong> on 3 Feb 2014, 04:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224408">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dimonix</div>
					<div class="post-datetime">
						3 Feb 2014, 09:30					</div>
				</div>
				<div class="post-content content">
					<p>You need a SPI programmer with proper adapter to handle flash chips.<br />The procedure is the following (router without soldered serial port):<br />1) upgrade your router to openwrt.<br />2) backup mtd0 (you need to keep MAC and model id)&nbsp; and mtd4 (ART) partitions from your router to your pc<br />3) dd if=mtd0.bin bs=1 skip=64K of=mtd0-1.bin &amp;&amp; cat mtd0-1.bin &gt;&gt; uboot.bin<br />&nbsp; &nbsp; where uboot.bin is your modified uboot with web interface.<br />4) program your new 16MB flash chip with uboot.bin (created above) using SPI programmer; replace your old flash with new one<br />5) boot the router in failsafe mode with web interface<br />6) program ART using mtd4.bin file; program FIRMWARE using openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin<br />Did I miss something? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>dimonix</strong> on 3 Feb 2014, 09:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224431">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">psyko_chewbacca</div>
					<div class="post-datetime">
						3 Feb 2014, 14:41					</div>
				</div>
				<div class="post-content content">
					<p>Well first of all, I can&#039;t upgrade to OpenWRT using the stock flash chip of the WR702N (2MB). So I cannot recover mtd0 and mtd4 the way you describe.</p><p>I do have a SPI flash programmer and that&#039;s how I did manage to overwrite the U-Boot on the 2MB chips. I just need to know the current offsets of the ART partition, MAC and Model ID data to extract from the stock dump and inject into a freshly built OpenWRT image.</p><p>After thinking about it, I&#039;ll simply take the &quot;factory&quot; generated image and manually inject all the data (U-Boot, ART, MAC, model ID) into it before programming the 16MB flash chip with it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224474">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Mark_V</div>
					<div class="post-datetime">
						3 Feb 2014, 21:38					</div>
				</div>
				<div class="post-content content">
					<p>I modified a few WR702/703 to 16Mb Flash/64Mb RAM, this is how i did it.<br />(I have a SPI Flash programmer)</p><p>1. Unbox and test if the unit works, after that upgrade the 16/32Mb ram to 64Mb,<br />&nbsp; &nbsp;again test if the unit still works. (The Chinese firmware works fine with 64Mb)<br />2. Remove original Flash and make a dump of it, i do this always twice and compare<br />&nbsp; &nbsp;these two to be 100 procent sure the data is OK.<br />3. Download modified U-Boot <a href="http://www.tech-blog.pl/pliki/u-boot_mod_wr703n_15012014.rar">http://www.tech-blog.pl/pliki/u-boot_mo … 012014.rar</a><br />&nbsp; &nbsp;this is the latest (for WR703) from pepe2k with overclock feature.<br />4. Download OpenWRT AA 12.09 <br />&nbsp; &nbsp;<a href="http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin">http://downloads.openwrt.org/attitude_a … actory.bin</a><br />5. From your original Flash dump only the ART section is important, it&#039;s exactly 1088bytes<br />&nbsp; &nbsp;for a 4Mb Flash the ART section starts at 0x3F1000, for a 2Mb Flash it starts at 0x1F1000<br />&nbsp; &nbsp;dump these 1088 bytes to a file.<br />6. Next step depends a little on your Flash programmer, if you can work with offsets you don&#039;t<br />&nbsp; &nbsp;need to make an empty file, else you have to make a file filled with 0xFF from exactly! 16.777.216 bytes<br />7. My $7 dollar programmer can&#039;t so i work with this empty file and a good HEXeditor.<br />&nbsp; &nbsp;at 0x000000 replace with the modified U-boot bootloader<br />&nbsp; &nbsp;at 0x01FC00 is your MACaddress xx xx xx xx xx xx (you can read this from the bottom of your WR702/703)<br />&nbsp; &nbsp;at 0x01FD00 is (i think) model and WPS pin, i always use 0x07 0x03 0x01 0x01 0x00 0x00 0x00 0x01<br />&nbsp; &nbsp;at 0x020000 replace with OpenWRT AA 12.09<br />&nbsp; &nbsp;at 0xFF1000 replace with your saved 1088bytes ART data.<br />8. Program your 16Mb Flash with this data, again to be sure i read the Flash and compare it with the file.<br />9. Put your new 16Mb Flash back in and if everything wend well you will find a fresh WR703 with OpenWRT at<br />&nbsp; &nbsp;192.168.1.1<br />A. Be Happy, you now have an almost unbrickable WR703 :-)</p><p>Grtzz Mark</p><p>PS: Does anybody know a good utility for Ubuntu that can send UDP packets, so i can talk to pepe2k U-boot<br />bootloader without the need for a serial connection?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224507">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">psyko_chewbacca</div>
					<div class="post-datetime">
						4 Feb 2014, 03:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi Mark_V</p><p>Thank you very much for the info. As the days go by I learn about this thing more and more.</p><p>What you&#039;re writing suggest that WPS and model number might be optionnal after all. I read that WPS pin and Model number are at 2 different offsets (1FC00 and 1FD00). So it looks like you don&#039;t need to enter a proper value coming from the stock dump at these 2 offsets for OpenWRT to work properly! I don&#039;t really mind about WPS functionnality (if that&#039;s what WPS PIN does). It also look like Model number wouldn&#039;t interfer with OpenWRT either.</p><p>So I&#039;ll be maing my 16MB images real soon!</p><p>Just for info, what 16MB flash chip did you use? I ordered 2 Spansion S25FL127S but I was able to program them each only once and even with that, nothing got written between address 0x0 and 0x100... Now the chips cannot be erased or rewritten at all... </p><p>I think I&#039;ll order some Winbonds W25Q128 instead. Never had any issue with Winbond in the past. They&#039;re just a little more expensive than Spansion on Digikey.</p><p>EDIT: For your request on how to that to U-Boot via network you should check out <strong>netcat</strong> or <strong>syslog(-ng)</strong> if you just want to capture messages coming from it.</p>											<p class="post-edited">(Last edited by <strong>psyko_chewbacca</strong> on 4 Feb 2014, 03:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224569">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Mark_V</div>
					<div class="post-datetime">
						4 Feb 2014, 21:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>psyko_chewbacca wrote:</cite><blockquote><p>What you&#039;re writing suggest that WPS and model number might be optionnal after all. I read that WPS pin and Model number are at 2 different offsets (1FC00 and 1FD00). So it looks like you don&#039;t need to enter a proper value coming from the stock dump at these 2 offsets for OpenWRT to work properly! I don&#039;t really mind about WPS functionnality (if that&#039;s what WPS PIN does). It also look like Model number wouldn&#039;t interfer with OpenWRT either.</p></blockquote></div><p>At 0x1FC00 is definitely your MAC adress, if you look at pepe2k U-boot improvements it says:<br /></p><div class="quotebox"><blockquote><p>Ethernet MAC is set from FLASH (no more &quot;No valid address in FLASH. Using fixed address&quot;)</p></blockquote></div><p>I don&#039;t know (never tried) if OpenWRT looks at 0x1FD00 for its modelnumber, funny thing is<br />that all the WR702&#039;s i modified identify as WR703 v1 and that looks a lot like the hexnumbers<br />at 0x1FD00.</p><p>For the Flash chips i only used Winbond W25Q128 i bought them from:<br /><a href="http://www.ebay.nl/itm/380767987675?ssPageName=STRK:MEWNX:IT&amp;_trksid=p3984.m1439.l2649">http://www.ebay.nl/itm/380767987675?ssP … 1439.l2649</a></p><p>But... the cheap Chinese programmers do have problems with Win7 i had problems programming them<br />or they didn&#039;t program at all, when i used an old Window$ XP laptop all went fine. (allthough it still takes<br />a very! long time (+/- 30mins) to program a 16Mb Flash)<br />And it&#039;s wise to use Flash chips that are supported by the bootloader, for more info look at:<br /><a href="https://github.com/pepe2k/u-boot_mod">https://github.com/pepe2k/u-boot_mod</a></p><p>Happy programming</p><p>Grtzz Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p295870">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">overstate99</div>
					<div class="post-datetime">
						13 Oct 2015, 02:55					</div>
				</div>
				<div class="post-content content">
					<p>Followed Mark_V&nbsp; &nbsp;instructions to the T and it worked perfectly. Thank you.&nbsp; <br />Here&#039;s my setup:<br />• 16MB&nbsp; (128Mbit) Flash - Winbond&nbsp; PN: W25Q128&nbsp; &nbsp;(Digi-key PN: W25Q128FVSIG-ND)<br />• 64MB&nbsp; (512Mbit) RAM&nbsp; &nbsp;- Alliance Memory PN: AS4C32M16D1A-5TCN,&nbsp; 66 pin TSOP (Digi-key PN: 1450-1286-ND)<br />• Programmer:&nbsp; EZP2010 USB HIGH Speed Programmer (ebay, Aliexpress, etc).&nbsp; $11 free shipping from China, 2 weeks to U.S.<br />• &quot;SOIC SO8/SOP8 (for 0.200&quot; width body) to DIP8 EZ Programmer Adapter Socket&quot; to be used in the programmer in order to program the flash. Look on ebay or AliExpress, should be &lt;$5 USD.<br />• Hex Editor:&nbsp; Hex Editor Neo</p>											<p class="post-edited">(Last edited by <strong>overstate99</strong> on 6 Apr 2016, 06:03)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>