<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [How To] Home Automation - Relay Board controlled from Web page or SMS</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 17 Apr 2018 and 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 4 of 4</div><nav><ul><li><a href="viewtopic.php%3Fid=54722&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=54722&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=54722&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p272761">
				<div class="post-metadata">
					<div class="post-num">Post #76</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						16 Apr 2015, 19:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p>Eventually you might use a Triac instead of the relay, it&#039;s more reliable, needs less drive current and its lifespan is higher than the relay</p></blockquote></div><p>...if the load is resistive. If the load is inductive, he might run into problems.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272769">
				<div class="post-metadata">
					<div class="post-num">Post #77</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						16 Apr 2015, 21:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bopnrgi wrote:</cite><blockquote><div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p>Just connect in series the N.C. of the first relay to the N.O of the second one.</p></blockquote></div><p>thanks but i have to use 2 relays for 1 output, not very ecologic / econmic.<br />I&#039;m searching for a software solution</p></blockquote></div><p>You only need one NC relay to disable all the other ones during boot-up.&nbsp; Wire the relay to deny power to the coils of all the other ones while it is energized (during boot-up).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274798">
				<div class="post-metadata">
					<div class="post-num">Post #78</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						1 May 2015, 23:13					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve just added this Infrared USB Remote Controller to my OpenWRT Home Automation Server.<br />I paid it 10 Euro.<br />No drivers are needed, just plug in and use it (with Triggerhappy).</p><p>By using this device you can remote control your OpenWRT Server with a lot of functions, simply use Triggerhappy and configure some or all buttons of this remote controller with different functions of your choice <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> , just check event names and values of buttons with &quot;<strong>thd --dump /dev/input/event*</strong>&quot; command.</p><p><span class="postimg"><img src="http://img.dxcdn.com/productimages/sku_26368_1.jpg" alt="http://img.dxcdn.com/productimages/sku_26368_1.jpg" /></span></p><p>NOTE: do not press the red POWER button, if you do it, the event code names will change and a restart of the router is needed to go back to default.<br />I would suggest you to remove or cut this button.</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 1 May 2015, 23:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276190">
				<div class="post-metadata">
					<div class="post-num">Post #79</div>
					<div class="post-author">rymki.pl</div>
					<div class="post-datetime">
						13 May 2015, 19:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p>the finished job:</p><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server3.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server3.jpg" /></span></p></blockquote></div><p>Hello, </p><p>Would I be right assuming that your HG533 has bene running on BB flavor of OpenWrt?</p><p>If so, has the support of the status LEDs Ben handled there with the module like kmod-leds-gpio beong unloadable with opkg?</p><p>I have been struggling with CC of Openwrt, the support of LEDs has been buried in kernel there. I am unable to&nbsp; regain the control over these GPIOs unfortunately.</p><p>Any hints of how to reuse LEDs GPIOs of HG553 driven by OpenWrt CC would be very welcome!</p><p>Cheers</p><p>rymki.pl</p>											<p class="post-edited">(Last edited by <strong>rymki.pl</strong> on 13 May 2015, 19:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p280791">
				<div class="post-metadata">
					<div class="post-num">Post #80</div>
					<div class="post-author">eethon</div>
					<div class="post-datetime">
						20 Jun 2015, 07:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p>I&#039;ve just added another feature to this Home Automation Server:<br /><strong><em>Auto-restore of previous channels status after a reboot/crash/power outage</em></strong></p><br /><br /><p>You&#039;ll find all my &quot;ready-to-use&quot; configuration files and script, for Vodafone Station Huawei EchoLife HG553 + OpenWRT Attitude Adjustment, here: <br /><a href="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/">http://www.lovisolo.com/asterisk/softwa â€¦ on-Server/</a></p><p>If you want to use a different router, you&#039;ll just need to change the &quot;/sys/devices/platform/leds-gpio...&quot; trigger lines, with the ones suitable for your board.</p><p>Complete list of the board functionalities (using my files above):</p><p>- Three (or six) indipendent channels output (via simple relays board)<br />- Multiple input control (USB keyboard/USB keypad/USB mouse keys) with triggerhappy <br />- Full local control via keyboard/keypad/mouse<br />- Full local monitoring via red/blue leds on the router<br />- Full remote/local control/monitoring via internet webpage<br />- Full remote control/monitoring via SMS (internet connection not needed)<br />- Email and/or SMS notification for any channel status change<br />- Automatic restore of the previous channels status after a reboot/crash<br />- Realtime video remote/local control via USB webcam (mjpg-streamer)<br />- Realtime audio remote/local control via USB webcam&#039;s microphone (ssh arecord | aplay - alsa)</p><p><span class="bbu">Web Control/Monitoring Page (including Luci &amp; Webcam):</span></p><p>http://IP_Address/index.html </p><p><span class="bbu">List of remote SMS commands:</span></p><p><strong>On1</strong> = Activate Channel 1<br /><strong>On2</strong> = Activate Channel 2<br /><strong>On3</strong> = Activate Channel 3<br /><strong>Off1</strong> = Deactivate Channel 1<br /><strong>Off2</strong> = Deactivate Channel 2<br /><strong>Off3</strong> = Deactivate Channel 3<br /><strong>Status</strong> = Send all channels status by SMS</p><p><span class="bbu">List of local USB Keyboard control keys</span></p><p><strong>F1</strong> = Activate Channel 1<br /><strong>F2</strong> = Activate Channel 2<br /><strong>F3</strong> = Activate Channel 3<br /><strong>F4</strong> = Deactivate Channel 1<br /><strong>F5</strong> = Deactivate Channel 2<br /><strong>F6</strong> = Deactivate Channel 3<br /><strong>F9</strong> = Activate All Channels<br /><strong>F10</strong> = Deactivate All Channels</p><p>Enjoy <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><br /><p>Final notes: with Vodafone Station Huawei EchoLife HG553, you can have up to six indipendent output channels if you control and use both, red and blue leds, to drive the relays.</p></blockquote></div><p>Hello Pilovis, How to <strong>Auto-restore of previous channels status after a reboot/crash/power outage </strong> ? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281033">
				<div class="post-metadata">
					<div class="post-num">Post #81</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						22 Jun 2015, 23:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eethon wrote:</cite><blockquote><p>Hello Pilovis, How to <strong>Auto-restore of previous channels status after a reboot/crash/power outage </strong> ? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p><strong><span class="bbu">Example for Huawei EchoLife HG553 Barrier Breaker</span></strong></p><p>----------------------------<br />- Save channels status<br />-----------------------------</p><p>file /root/status.sh: (chmod 777)</p><p><em> <span style="color: #0000FF"> ####################################<br /># by pilovis - parknat12@yahoo.com<br />#<br /># Write channel status to a file<br />####################################</span></em></p><p><span style="color: #0000FF"><em># Area variabili<br />#<br />folder=/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Cartella di lavoro</em></span><br /><span style="color: #0000FF"><em>dbstato1=$folder/stato1&nbsp; &nbsp; # File Stato Canale 1 per ripristino<br />dbstato2=$folder/stato2&nbsp; &nbsp; # File Stato Canale 2 per ripristino<br />dbstato3=$folder/stato3&nbsp; &nbsp; # File Stato Canale 3 per ripristino</em></span></p><p><span style="color: #0000FF"><em># Aggiorna lo status di tutti i canali<br />#<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness &gt;&gt; $dbstatus&nbsp; &nbsp; &nbsp; &nbsp; # stato canale 1<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:hspa/brightness &gt;&gt; $dbstatus&nbsp; &nbsp; &nbsp; &nbsp;# stato canale 2<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness &gt;&gt; $dbstatus&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# stato canale 3</em></span></p><p><span style="color: #0000FF"><em># Cancella files /root/stato1-2-3 con dati precedenti (la sezione dopo li riscrive)<br />#<br />rm /root/stato1<br />rm /root/stato2<br />rm /root/stato3</em></span></p><p><span style="color: #0000FF"><em># Inserisce lo stato puro di ogni canale in /root/stato1-2-3 per il ripristino dopo un reboot/crash<br />#<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness &gt;&gt; $dbstato1&nbsp; &nbsp; &nbsp; &nbsp; # canale 1<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:hspa/brightness &gt;&gt; $dbstato2&nbsp; &nbsp; &nbsp; &nbsp;# canale 2<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness &gt;&gt; $dbstato3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# canale 3</em></span></p><p><span style="color: #0000FF"><em>exit 0 </em></span><em> </em></p><p>-------------------------------<br />- Restore channels status<br />-------------------------------</p><p>file /root/extract-status1.sh:&nbsp; (chmod 777)</p><p><em> <span style="color: #0000FF"> while IFS=: read canale1<br />do<br />echo ${canale1} &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness<br />done &lt; /root/stato1</span></em></p><p>file /root/extract-status2.sh:&nbsp; (chmod 777)</p><p><span style="color: #0000FF"><em>while IFS=: read canale2<br />do<br />echo ${canale2} &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:hspa/brightness<br />done &lt; /root/stato2</em></span></p><p>file /root/extract-status3.sh:&nbsp; (chmod 777)</p><p><span style="color: #0000FF"><em>while IFS=: read canale3<br />do<br />echo ${canale3} &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness<br />done &lt; /root/stato3 </em></span><em> </em></p><p>file /root/restore-status.sh:&nbsp; (chmod 777)</p><p><span style="color: #0000FF"><em>/bin/sh /root/extract-status1.sh<br />/bin/sh /root/extract-status2.sh<br />/bin/sh /root/extract-status3.sh </em></span></p><p>---------------------------<br />- Autostart at bootup<br />---------------------------</p><p>Insert this line in /etc/rc.local before &#039;exit 0&#039;:</p><p><span style="color: #0000FF"><em>/bin/sh /root/restore-status.sh </em></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 22 Jun 2015, 23:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282099">
				<div class="post-metadata">
					<div class="post-num">Post #82</div>
					<div class="post-author">eethon</div>
					<div class="post-datetime">
						2 Jul 2015, 06:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><div class="quotebox"><cite>eethon wrote:</cite><blockquote><p>Hello Pilovis, How to <strong>Auto-restore of previous channels status after a reboot/crash/power outage </strong> ? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p><strong><span class="bbu">Example for Huawei EchoLife HG553 Barrier Breaker</span></strong></p><p>----------------------------<br />- Save channels status<br />-----------------------------</p><p>file /root/status.sh: (chmod 777)</p><p><em> <span style="color: #0000FF"> ####################################<br /># by pilovis - parknat12@yahoo.com<br />#<br /># Write channel status to a file<br />####################################</span></em></p><p><span style="color: #0000FF"><em># Area variabili<br />#<br />folder=/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Cartella di lavoro</em></span><br /><span style="color: #0000FF"><em>dbstato1=$folder/stato1&nbsp; &nbsp; # File Stato Canale 1 per ripristino<br />dbstato2=$folder/stato2&nbsp; &nbsp; # File Stato Canale 2 per ripristino<br />dbstato3=$folder/stato3&nbsp; &nbsp; # File Stato Canale 3 per ripristino</em></span></p><p><span style="color: #0000FF"><em># Aggiorna lo status di tutti i canali<br />#<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness &gt;&gt; $dbstatus&nbsp; &nbsp; &nbsp; &nbsp; # stato canale 1<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:hspa/brightness &gt;&gt; $dbstatus&nbsp; &nbsp; &nbsp; &nbsp;# stato canale 2<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness &gt;&gt; $dbstatus&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# stato canale 3</em></span></p><p><span style="color: #0000FF"><em># Cancella files /root/stato1-2-3 con dati precedenti (la sezione dopo li riscrive)<br />#<br />rm /root/stato1<br />rm /root/stato2<br />rm /root/stato3</em></span></p><p><span style="color: #0000FF"><em># Inserisce lo stato puro di ogni canale in /root/stato1-2-3 per il ripristino dopo un reboot/crash<br />#<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness &gt;&gt; $dbstato1&nbsp; &nbsp; &nbsp; &nbsp; # canale 1<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:hspa/brightness &gt;&gt; $dbstato2&nbsp; &nbsp; &nbsp; &nbsp;# canale 2<br />cat&nbsp; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness &gt;&gt; $dbstato3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# canale 3</em></span></p><p><span style="color: #0000FF"><em>exit 0 </em></span><em> </em></p><p>-------------------------------<br />- Restore channels status<br />-------------------------------</p><p>file /root/extract-status1.sh:&nbsp; (chmod 777)</p><p><em> <span style="color: #0000FF"> while IFS=: read canale1<br />do<br />echo ${canale1} &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness<br />done &lt; /root/stato1</span></em></p><p>file /root/extract-status2.sh:&nbsp; (chmod 777)</p><p><span style="color: #0000FF"><em>while IFS=: read canale2<br />do<br />echo ${canale2} &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:hspa/brightness<br />done &lt; /root/stato2</em></span></p><p>file /root/extract-status3.sh:&nbsp; (chmod 777)</p><p><span style="color: #0000FF"><em>while IFS=: read canale3<br />do<br />echo ${canale3} &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness<br />done &lt; /root/stato3 </em></span><em> </em></p><p>file /root/restore-status.sh:&nbsp; (chmod 777)</p><p><span style="color: #0000FF"><em>/bin/sh /root/extract-status1.sh<br />/bin/sh /root/extract-status2.sh<br />/bin/sh /root/extract-status3.sh </em></span></p><p>---------------------------<br />- Autostart at bootup<br />---------------------------</p><p>Insert this line in /etc/rc.local before &#039;exit 0&#039;:</p><p><span style="color: #0000FF"><em>/bin/sh /root/restore-status.sh </em></span> </p><div class="quotebox"><cite>eethon wrote:</cite><blockquote><p>thanks pilovis above explanation, good luck always, sorry my English is not good <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282784">
				<div class="post-metadata">
					<div class="post-num">Post #83</div>
					<div class="post-author">najeebsalmaa</div>
					<div class="post-datetime">
						8 Jul 2015, 13:28					</div>
				</div>
				<div class="post-content content">
					<p>very nice thanks dude..</p>											<p class="post-edited">(Last edited by <strong>najeebsalmaa</strong> on 8 Jul 2015, 13:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292453">
				<div class="post-metadata">
					<div class="post-num">Post #84</div>
					<div class="post-author">apuk2</div>
					<div class="post-datetime">
						18 Sep 2015, 23:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server3.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server3.jpg" /></span></p></blockquote></div><p>Hello!</p><p>I would like to ask, what is it on the second plan of this photography? Looks closely to womens underwear, pareo? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />... or maybe is it your socks? <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p>											<p class="post-edited">(Last edited by <strong>apuk2</strong> on 18 Sep 2015, 23:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303120">
				<div class="post-metadata">
					<div class="post-num">Post #85</div>
					<div class="post-author">phantnang</div>
					<div class="post-datetime">
						10 Dec 2015, 08:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p><span class="bbu">Instructions how to transform a cheap 110/220Vac Home PIR Motion Sensor in a &quot;<strong>USB PIR motion sensor</strong>&quot; for OpenWRT/Raspberry/Arduino</span></p><p><span class="postimg"><img src="http://www.dzsc.com/news/uploadfile/2012724155955543.jpg" alt="http://www.dzsc.com/news/uploadfile/2012724155955543.jpg" /></span></p></blockquote></div><p>... if you have a router that supports GPIO inputs (Vodafone Station does NOT) you can connect the PIR sensor directly to GPIO without using USB, simply connect the collector of the Optocoupler output transistor to a GPIO input pin (button active low image). </p><p><span class="postimg"><img src="http://wiki.openwrt.org/_media/media/gpios-high_low.png" alt="http://wiki.openwrt.org/_media/media/gpios-high_low.png" /></span></p></blockquote></div><p>thank for all your works!<br />i have read this guides: <a href="https://wiki.openwrt.org/doc/howto/hardware.button#hotplugbuttons,">https://wiki.openwrt.org/doc/howto/hard â€¦ ugbuttons,</a> <a href="https://wiki.openwrt.org/doc/hardware/port.gpio">https://wiki.openwrt.org/doc/hardware/port.gpio</a><br />i want to check another gpio port (etc Lan1,2,3. led) to connect pir sensor. I could check status of them by uci command. how to excute a event when it change status without loop checking!<br />p/s: sorry my bad english</p>											<p class="post-edited">(Last edited by <strong>phantnang</strong> on 17 Dec 2015, 10:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p306164">
				<div class="post-metadata">
					<div class="post-num">Post #86</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						4 Jan 2016, 14:13					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">Bluetooth Presence Detection</span></p><p>In OpenWRT Attitude Adjustement, Barrier Breaker and Chaos Calmer, bluetooth does not work, there is no way to pair anything, so it is useless <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Anyway,&nbsp; I found a way to use the bluetooth to do something without the need to pair a device: &quot;bluetooth presence detection&quot;,<br />this could be usefull to enable or disable services when a specific bluetooth device is (or isn&#039;t) present in the nearby area. </p><p>First of all you need to install bluetooth service and USB support:</p><p><strong>opkg update<br />opkg install kmod-bluetooth bluez-libs bluez-utils kmod-usb-core kmod-usb-uhci kmod-usb2 usbutils</strong></p><p>then enable it with the following commands:</p><p><strong>/etc/init.d/dbus enable<br />/etc/init.d/bluez-utils enable<br />/etc/init.d/dbus start<br />/etc/init.d/bluez-utils start</strong></p><p>Then reboot the router.</p><br /><p>To check if your USB bluetooth device is properly detected and is working, run this command:</p><p><strong>hciconfig</strong></p><p>you should get something similar to this:</p><p><em>hci0:&nbsp; &nbsp; Type: USB<br />&nbsp; &nbsp; BD Address: 00:15:83:C9:17:96 ACL MTU: 310:10 SCO MTU: 64:8<br />&nbsp; &nbsp; UP RUNNING<br />&nbsp; &nbsp; RX bytes:22331 acl:0 sco:0 events:1428 errors:0<br />&nbsp; &nbsp; TX bytes:1482 acl:0 sco:0 commands:176 errors:0</em></p><p>now you can scan for you bluetooth device mac address with the following command:</p><p><strong>/usr/bin/hcitool scan</strong> </p><p>then create the &#039;check_presence_bt.sh&#039; script:</p><p><strong>vi /root/check_presence_bt.sh</strong></p><p>and add the following lines to it:</p><p> <span style="color: #0000FF"><em>#!/bin/sh<br /># Bluetooth Presence Detection<br /># By Lovisolo P.M. - parknat12@yahoo.com<br />#<br /># scan for bluetooth devices and put the result into a variable:<br />c=$(/usr/bin/hcitool scan)<br />#<br /># check for a specific MAC ADDRESS presence: <br />if [ `echo $c | grep -c &quot;<strong>38:2D:E8:49:C1:87</strong>&quot; ` -gt 0 ]<br />then<br />&nbsp; checkbt=$&#039;Device available&#039;;<br /># you may add here a command or script to be executed when the device is available<br />else<br />&nbsp; checkbt=$&#039;Device is OFF or unavailable&#039;;<br /># you may add here a command or script to be executed when the device is unavailable<br />fi<br /># write scan results to a file into the ramdisk:<br />/bin/echo $checkbt &gt; /tmp/checkbt.txt<br /># eof</em> </span> </p><p><em>note: 38:2D:E8:49:C1:87 is the mac address of the device to be discovered, change it to the desired mac addres.</em></p><br /><p>then give the right permissions to the script:</p><p><strong>chmod 755 /root/check_presence_bt.sh</strong></p><br /><p>Now you need to create a cron job to execute the above script every minute by inserting the following line in &#039;/etc/crontabs/root&#039; (if the file does not exist, create it):</p><p> <span style="color: #0000FF"><em>*/1 * * * * /bin/sh /root/check_presence_bt.sh</em></span></p><p>To display the &#039;Bluetooth Presence Detection&#039; current results, run the following command:</p><p><strong>/bin/cat /tmp/checkbt.txt</strong></p><br /><p><span class="bbu">*** IMPORTANT NOTE: the bluetooth target device must be set to &quot;discoverable&quot; ***</span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 19 May 2016, 20:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310094">
				<div class="post-metadata">
					<div class="post-num">Post #87</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						3 Feb 2016, 11:21					</div>
				</div>
				<div class="post-content content">
					<p>just a little note:</p><p>to check the GPIO configuration of your router, simply use this command:</p><p><strong>cat /sys/kernel/debug/gpio</strong></p><p>you should get something like this (example taken from TP-Link TL-WDR 3600):</p><p><em>GPIOs 0-22, ath79:<br /> gpio-11&nbsp; (tp-link:green:usb1&nbsp; ) out hi<br /> gpio-12&nbsp; (tp-link:green:usb2&nbsp; ) out hi<br /> gpio-13&nbsp; (tp-link:blue:wlan2g ) out lo<br /> gpio-14&nbsp; (tp-link:blue:system ) out hi<br /> gpio-15&nbsp; (tp-link:blue:qss&nbsp; &nbsp; ) out hi<br /> gpio-16&nbsp; (QSS button&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) in&nbsp; hi<br /> gpio-17&nbsp; (RFKILL switch&nbsp; &nbsp; &nbsp; &nbsp;) in&nbsp; hi<br /> gpio-18&nbsp; (external LNA0&nbsp; &nbsp; &nbsp; &nbsp;) out hi<br /> gpio-19&nbsp; (external LNA1&nbsp; &nbsp; &nbsp; &nbsp;) out hi<br /> gpio-21&nbsp; (USB2 power&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) out hi<br /> gpio-22&nbsp; (USB1 power&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) out hi<br /></em></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 3 Feb 2016, 11:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311476">
				<div class="post-metadata">
					<div class="post-num">Post #88</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						15 Feb 2016, 09:34					</div>
				</div>
				<div class="post-content content">
					<p>After more than two years of intensive testing about Openwrt with many routers, I can say that (in my opinion) Openwrt is very unreliable: too many crashes, bad USB support, fake bluetooth support, very unstable usb &quot;overlay&quot;.<br />This the end word at my Openwrt&nbsp; story, from now on I will move to Raspberry devices.<br /><img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311533">
				<div class="post-metadata">
					<div class="post-num">Post #89</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						15 Feb 2016, 17:28					</div>
				</div>
				<div class="post-content content">
					<p>Sorry to hear that you are leaving openWrt. I have appreciated your contributions. </p><p>With a dozen or more openWrt devices running for years, I have not experienced the unreliability that you report, even with power outages (though my applications have been much more simple than yours).</p><p>I appreciate your reporting (by implication) on high reliability for the Raspberry Pi family, since I&#039;m now looking at a system which has 13 temperature readings and controls 14 relays and needs to be quite reliable since failure could be expensive (though I&#039;ll try to mitigate that in the design and make it fail safely).</p><p>Can you elaborate further on the types of failures you have experienced?</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 15 Feb 2016, 17:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319617">
				<div class="post-metadata">
					<div class="post-num">Post #90</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						14 Apr 2016, 13:50					</div>
				</div>
				<div class="post-content content">
					<p>I performed many tests on Raspberry PI Wheezy and changed my idea, I found it extremely slow compared to a router with OpenWRT and very instable too.<br />Also I tested Rasperry PI with OpenWRT Barrier Breaker, worst than before, too many packages missing!</p><p>I think I will go back to my TP-link TL-WRD3600 with OpenWRT Barrier Breaker, the best solution I&#039;ve found up to now.</p><p>I will soon post a new project <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p322545">
				<div class="post-metadata">
					<div class="post-num">Post #91</div>
					<div class="post-author">phantnang</div>
					<div class="post-datetime">
						4 May 2016, 19:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p>I performed many tests on Raspberry PI Wheezy and changed my idea, I found it extremely slow compared to a router with OpenWRT and very instable too.<br />Also I tested Rasperry PI with OpenWRT Barrier Breaker, worst than before, too many packages missing!</p><p>I think I will go back to my TP-link TL-WRD3600 with OpenWRT Barrier Breaker, the best solution I&#039;ve found up to now.</p><p>I will soon post a new project <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>i think&nbsp; it&#039;s better with QCA soc such as: WRD7500, WR1043...</p><p>how to config gpio led port for input and read status it on Barrier Breaker.<br />(i found the reason: rmmod leds_gpio ------------&gt;echo &quot;leds-gpio&quot; &gt; /sys/bus/platform/drivers/leds-gpio/unbind)</p><p>sr, my bad english</p>											<p class="post-edited">(Last edited by <strong>phantnang</strong> on 4 May 2016, 21:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323529">
				<div class="post-metadata">
					<div class="post-num">Post #92</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						12 May 2016, 14:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hoatienii wrote:</cite><blockquote><p>Use USB drive for more storage. My router dlink dir615c2 400mhz,4MB flash, i use usb drive for more storage to install php and lighttpd. My web control run php with display status of relay. <br />Here my index.php</p><p>default user/pass is admin/admin</p><p><span class="postimg"><img src="https://lh3.googleusercontent.com/-pftJGLXMhp4/VKCSpCYgBvI/AAAAAAAAJnQ/p5fQk3NcgVE/w361-h577-no/Screenshot_2014-12-29-01-44-26.png" alt="https://lh3.googleusercontent.com/-pftJGLXMhp4/VKCSpCYgBvI/AAAAAAAAJnQ/p5fQk3NcgVE/w361-h577-no/Screenshot_2014-12-29-01-44-26.png" /></span></p><p><span class="postimg"><img src="https://lh6.googleusercontent.com/-s5nRG3GUGLk/VKCSoE9bjSI/AAAAAAAAJnE/52m9UF1kNBQ/w361-h577-no/Screenshot_2014-12-29-01-44-05.png" alt="https://lh6.googleusercontent.com/-s5nRG3GUGLk/VKCSoE9bjSI/AAAAAAAAJnE/52m9UF1kNBQ/w361-h577-no/Screenshot_2014-12-29-01-44-05.png" /></span></p></blockquote></div><p>Very nice job! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I just modified it a little bit to adapt it to my Huawei EchoLife HG553 (Barrier Breaker)</p><p>prerequisites:</p><p><strong>opkg update<br />opkg install php5 php5-cgi php5-mod-session</strong></p><br /><p>PHP code modifications (just the modified sections):<br /><span style="color: #0000FF"><em><br />$arrMode = array(<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;status0&#039;&nbsp; &nbsp; =&gt; &#039;cat /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness&#039;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;on rele&#039;&nbsp; &nbsp; =&gt; &quot;echo &#039;0&#039; &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;off rele&#039;&nbsp; &nbsp; =&gt; &quot;echo &#039;1&#039; &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:lan/brightness&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;status2&#039;&nbsp; &nbsp; =&gt; &#039;cat /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness&#039;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;on luce&#039;&nbsp; &nbsp; =&gt; &quot;echo &#039;0&#039; &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;off luce&#039;&nbsp; &nbsp; =&gt; &quot;echo &#039;1&#039; &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:blue:adsl/brightness&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; );<br />&nbsp; &nbsp; &nbsp; &nbsp; if(isset($_POST[&#039;router&#039;])) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // $contents = file_get_contents(&quot;{$_SERVER[&#039;DOCUMENT_ROOT&#039;]}./{$_POST[&#039;router&#039;]}.sh&quot;);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo shell_exec($arrMode[$_POST[&#039;router&#039;]]);<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; $status0 = shell_exec($arrMode[&#039;status0&#039;]);<br />&nbsp; &nbsp; &nbsp; &nbsp; $status2 = shell_exec($arrMode[&#039;status2&#039;]);<br />&nbsp; &nbsp; &nbsp; &nbsp; ?&gt;<br /><strong>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;10&quot; &gt;</strong></em></span></p><p><span style="color: #0000FF"><em>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</em></span><br />note: I have just two channels<br />also the page refreshes every 10 seconds to update the status of the channels (buttons change colors and labels when status change) since I can control the channels status also by SMS or by a phone call (I installed asterisk on the router <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> )<br />....</p><p> <span style="color: #0000FF"><em><br />}<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; input.on{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background-color: #E40606;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-color: #398439;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; input.off{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background-color: #449d44;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-color: #E40606;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br /> </em></span><br />note: I swapped red and green color of the buttons to better understand when the channel is on or off (red=on, green=off)</p><p>....</p><p> <span style="color: #0000FF"><em><br />&lt;form method=&quot;post&quot; action=&quot;&lt;?php echo $_SERVER[&#039;PHP_SELF&#039;]; ?&gt;&quot;&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input class=&quot;&lt;?php if((int)($status0)==0) echo &#039;on&#039;; else echo &#039;off&#039;;?&gt;&quot; type=&quot;submit&quot; name=&quot;router&quot; value=&quot;&lt;?php if((int)($status0)==1) echo &#039;on&#039;; else echo &#039;off&#039;;?&gt; rele&quot;&gt;&lt;br&gt;<br />&lt;p&gt;<br />&lt;hr&gt;<br />&lt;p&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input class=&quot;&lt;?php if((int)($status2)==0) echo &#039;on&#039;; else echo &#039;off&#039;;?&gt;&quot; type=&quot;submit&quot; name=&quot;router&quot; value=&quot;&lt;?php if((int)($status2)==1) echo &#039;on&#039;; else echo &#039;off&#039;;?&gt; luce&quot;&gt;&lt;br&gt;</em></span></p><p><span style="color: #0000FF"><em>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp;&lt;/form&gt;<br /> </em></span></p><br /><br /><p>Note: <br />Luce (italian) = Light = LED&nbsp; spotlight for Motion<br />rele (italian) = relay = output channel</p><p><strong>addendum:</strong></p><p>change USER (u) and PASSWORD (p) to access the control page:<br /><span style="color: #0000FF"><em>&nbsp; &nbsp;<br />&nbsp; &nbsp; &#039;u&#039;&nbsp; &nbsp; =&gt; &quot;d033e22ae348aeb5660fc2140aec35850c4da997&quot;,<br />&nbsp; &nbsp; &#039;p&#039;&nbsp; &nbsp; =&gt; &quot;d033e22ae348aeb5660fc2140aec35850c4da997&quot;<br /></em></span>&nbsp; &nbsp;<br />u= admin, p=admin</p><p>both need to be &quot;sha1&quot; encoded, you can find the online tools here:</p><p><a href="http://www.sha1-online.com/">http://www.sha1-online.com/</a></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 12 May 2016, 15:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337424">
				<div class="post-metadata">
					<div class="post-num">Post #93</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						6 Sep 2016, 22:39					</div>
				</div>
				<div class="post-content content">
					<p>Netgear DGND3700V1 has 11 LEDs of wich 9 of them can be used to control 9 relays, fortunately these 9 LEDs do not turn on or do not start blinking during startup process <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>The downside of this router is that the internal PCI WiFi module is bad supported on OpenWRT, as a workaround you can use a different WiFI PCI board or connect an external USB WiFi dongle to the router (or use an ethernet cable).</p><p>This router is very powerful: it has 2x400 Mhz CPUs, 2xUSB2 ports, 2 integrated Switch buttons (plus reset) both usable directly by triggerhappy, 1 WAN and 4 LAN ethernet connectors, 128 Mbytes of RAM plus 64 Mbytes of Swap (NAND) and 32 Mbytes of Flash (NOR).</p><p>Here are the commands to switch ON the 9 LEDs (to switch them off use &quot;echo 0 &gt; ...&quot;):<br /><em><span style="color: blue"><br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:blue:wifi5g/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:dsl/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:inet/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:usb-back/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:usb-front/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:wifi2g/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:wps/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:red:inet/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:lan/brightness</span></em></p><p>LED name, Color, GPIO, #note<br />power, red, 22, # it turns on at bootup<br />power, green, 24, # it turns on and starts blinking at bootup<br />lan, green, 23, # usable<br />usb-back, green, 14, # usable<br />wifi2g, green, 26, # usable<br />wifi5g, blue, 27, # usable<br />dsl, green, 2, # usable<br />inet, red, 4, # usable<br />inet, green, 5, # usable<br />usb-front, green, 13, # usable<br />wps, green, 11, # usable</p><br /><p>Board switches as seen by triggerhappy:</p><p><em>root@OpenWrt:~# thd --dump /dev/input/event*<br />EV_KEY&nbsp; &nbsp; <span style="color: red">KEY_WPS_BUTTON</span>&nbsp; &nbsp; 1&nbsp; &nbsp; /dev/input/event0<br /># KEY_WPS_BUTTON&nbsp; &nbsp; 1&nbsp; &nbsp; command<br />EV_KEY&nbsp; &nbsp; KEY_WPS_BUTTON&nbsp; &nbsp; 0&nbsp; &nbsp; /dev/input/event0<br /># KEY_WPS_BUTTON&nbsp; &nbsp; 0&nbsp; &nbsp; command<br />EV_KEY&nbsp; &nbsp; <span style="color: red">KEY_WLAN</span>&nbsp; &nbsp; 1&nbsp; &nbsp; /dev/input/event0<br /># KEY_WLAN&nbsp; &nbsp; 1&nbsp; &nbsp; command<br />EV_KEY&nbsp; &nbsp; KEY_WLAN&nbsp; &nbsp; 0&nbsp; &nbsp; /dev/input/event0<br /># KEY_WLAN&nbsp; &nbsp; 0&nbsp; &nbsp; command</em></p><p>KEY_WLAN = gpio-10<br />KEY_WPS_BUTTON =&nbsp; gpio-35</p><br /><p>Usable GPIOs:<br /><em><br />root@OpenWrt:~# cat /sys/kernel/debug/gpio<br />GPIOs 0-37, bcm63xx-gpio:<br /> gpio-2&nbsp; &nbsp;(DGND3700v1_3800B:gre) out hi<br /> gpio-4&nbsp; &nbsp;(DGND3700v1_3800B:red) out hi<br /> gpio-5&nbsp; &nbsp;(DGND3700v1_3800B:gre) out hi<br /> gpio-10&nbsp; (wlan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) in&nbsp; hi<br /> gpio-11&nbsp; (DGND3700v1_3800B:gre) out hi<br /> gpio-12&nbsp; (reset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) in&nbsp; hi<br /> gpio-13&nbsp; (DGND3700v1_3800B:gre) out hi<br /> gpio-14&nbsp; (DGND3700v1_3800B:gre) out hi<br /> gpio-22&nbsp; (DGND3700v1_3800B:red) out hi<br /> gpio-23&nbsp; (DGND3700v1_3800B:gre) out hi<br /> gpio-24&nbsp; (DGND3700v1_3800B:gre) out lo<br /> gpio-26&nbsp; (DGND3700v1_3800B:gre) out lo<br /> gpio-27&nbsp; (DGND3700v1_3800B:blu) out lo<br /> gpio-35&nbsp; (wps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) in&nbsp; hi</em></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 6 Sep 2016, 23:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338338">
				<div class="post-metadata">
					<div class="post-num">Post #94</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						15 Sep 2016, 14:47					</div>
				</div>
				<div class="post-content content">
					<p>just a note:</p><p>if you want to stream video from the remote location with you OpenWRT box, do not use mjpg-streamer.<br />I mean, if you want to check the remote location for just a few seconds, it&#039;s OK, <br />but&nbsp; when you start a realtime video streaming, after a few minutes that you are connected to see, mjpg-streamer crashes and the device &quot;/dev/video0&quot; disappears, the only way to recover it, it is to reboot the router or unplug and plug again the USB webcam.<br />Use Motion instead, it uses more CPU resources but it is stable and never crashes!</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 15 Sep 2016, 14:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338365">
				<div class="post-metadata">
					<div class="post-num">Post #95</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						15 Sep 2016, 21:55					</div>
				</div>
				<div class="post-content content">
					<p>this is my last (mad) creation:</p><p>OpenWRT Home Automation BOX</p><p>Features:</p><p>- 2 digital input channels (to get feedback from remote devices)<br />- 7 power output channels 1500 W max each (to switch ON and OFF remote devices)<br />- PBX Voip/GSM server (Asterisk 11 + GSM_dongle)<br />- remote control by phone by using DTMF tones (I created an IVR that says: &quot;press 1 to switch on relay 1, etc&quot;)<br />- HD video streaming to monitor remote location (Motion)<br />- 2 ways SMS server (receive commands and/or send back alerts/notifications) (Gnokii)<br />- remote/local control by web page (PHP + uhttpd)<br />- local control by USB keypad (Triggerhappy)<br />- restore the channels status after a power failure/reboot (restore the last status ON/OFF just before the power loss)</p><p>Maximum power consumption = 15W, one single power supply 12v/2.5A (I keept the original netgear PS)<br />This BOX can be powered by solar cells and/or by a 12V rechargeable lead battery<br />To save some electrical power and heating, I removed the (useless) WiFi PCI internal card because it is not supported by Barrier Breaker sad , maybe Chaos Calmer supports it, but C.C. sucks, it is almost useless since there are to many packages missing, included most of the packages I used for this BOX mad</p><p>Notes: by having a GSM dongle (GSM calls and SMS), this box can work anywere, even in a place without any internet connection.</p><p>I used (cost):</p><p>my brain (free) smile<br />many sleepless nights (almost free)<br />Openwrt Barrier Breaker (free)<br />Netgear DGND3700V1 router (Ebay @ 50 Euro)<br />USB HD webcam (local store @ 30 Euro)<br />8 channels Relay Board (Ebay @ 10 Euro)<br />USB GSM dongle Huawei E169 (Ebay @ 15 Euro)<br />USB Keypad (local store @ 5 Euro)<br />USB Hub (local store @ 5 Euro)</p><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183045.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183045.jpg" /></span><br /><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183100.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183100.jpg" /></span><br /><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183320.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183320.jpg" /></span><br /><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_180049.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_180049.jpg" /></span></p><p><span class="bbu">Important note on Netgear DGND3700V1 and Barrier Breaker.</span></p><p>This router with its custom OpenWRT Barrier Breaker firmware has a very bad problem: during a reboot, invoked by a program or by the reboot command,&nbsp; the router may hangs forever, unfortunately it happens quite often and the only way to recover it, it is to do a power cycle.<br />The problem occurs during the shutdown process, just before the reboot, it seems that some process cannot be stopped correctly.</p><p>To avoid this problem during reboot cycle, you might use the following command to do an hard_reboot of the router:</p><p><strong>/bin/echo b &gt; /proc/sysrq-trigger</strong></p><p>this&nbsp; is pretty much the same as pressing the reset button on a PC, no daemons will be shut down gracefully, no filesystem sync will occur (but we don&#039;t need it).</p><p>So, don&#039;t use anymore the &quot;reboot&quot; command (busybox) on this router, also disable watchcat and zram:&nbsp; <br /><strong>/etc/init.d/watchcat disable<br />/etc/init.d/zram disable</strong></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 15 Sep 2016, 22:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338367">
				<div class="post-metadata">
					<div class="post-num">Post #96</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						15 Sep 2016, 22:14					</div>
				</div>
				<div class="post-content content">
					<p>see <a href="https://forum.openwrt.org/viewtopic.php?pid=338370#p338370">https://forum.openwrt.org/viewtopic.php â€¦ 70#p338370</a> for the instructions.</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 15 Sep 2016, 22:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338720">
				<div class="post-metadata">
					<div class="post-num">Post #97</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						20 Sep 2016, 16:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p>just a note:</p><p>if you want to stream video from the remote location with you OpenWRT box, do not use mjpg-streamer.<br />I mean, if you want to check the remote location for just a few seconds, it&#039;s OK, <br />but&nbsp; when you start a realtime video streaming, after a few minutes that you are connected to see, mjpg-streamer crashes and the device &quot;/dev/video0&quot; disappears, the only way to recover it, it is to reboot the router or unplug and plug again the USB webcam.<br />Use Motion instead, it uses more CPU resources but it is stable and never crashes!</p></blockquote></div><p>In case you want to use mjpg-streamer anyway, this is the script to check if the process is active, if it is not, the script restart mjpg-streamer:</p><p><span style="color: blue"><em>#!/bin/sh<br /># check if the process &quot;mjpg-streamer&quot; is active<br />#<br />if ps w | grep -v grep | grep &#039;/usr/bin/mjpg_streamer --input input_uvc.so --device /dev/video0 --fps 1 --resolution 1280x720 --output o&#039; &gt; /dev/null<br />then<br />&nbsp; &nbsp; &nbsp; &nbsp; #&nbsp; &nbsp; echo &quot;OK&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; /bin/sleep 1<br />else<br />&nbsp; &nbsp; &nbsp; &nbsp; #&nbsp; &nbsp; echo &quot;KO&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; /init.d/mjpg-streamer restart<br />fi</em></span></p><p><span class="bbu">Notes:</span><br />change &quot;<span style="color: blue">--fps 1</span>&quot; with the frame per seconds value you are using, eg: --fps 8, <br />the same for &quot;<span style="color: blue">--resolution 1280x720</span>&quot;</p><br /><p>then put the following line in &quot;/etc/crontabs/root&quot; to check the mjpg-streamer process every minute:</p><p><span style="color: blue"><em>*/1 * * * * /bin/sh /root/mjpg-streamer_check.sh</em></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 20 Sep 2016, 16:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343570">
				<div class="post-metadata">
					<div class="post-num">Post #98</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						13 Nov 2016, 14:59					</div>
				</div>
				<div class="post-content content">
					<p><strong>How to control values of the cam in mjpg-streamer and motion</strong></p><p>The opkg version of mjpg-streamer has no control options for the camera. If you want to control exposure, brightness and other options you&#039;ll need to install uvcdynctrl. <br />By editing the cam values with this program I got big improvements in terms of sharpness and color fidelity <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p><span class="bbu">quick instructions:</span></p><p>install control program:<br /><strong>opkg install uvcdynctrl</strong></p><p>test the program and check the list of webcam available commands:<br /><strong>/usr/bin/uvcdynctrl -c</strong></p><p>copy cam internal values to a file:<br /><strong>/usr/bin/uvcdynctrl -W /etc/config/uvcdynctrl</strong></p><p>edit file with cam values:<br /><strong>vi /etc/config/uvcdynctrl</strong></p><p>example:<br /><span style="color: blue"><em>#V4L2/CTRL/0.0.2<br />APP{&quot;libwebcam&quot;}<br /># control data<br />#Brightness<br />ID{0x00980900};CHK{30:255:1:133}=VAL{133}<br />#Contrast<br />ID{0x00980901};CHK{0:10:1:5}=VAL{8}<br />#Saturation<br />ID{0x00980902};CHK{0:200:1:83}=VAL{120}<br />#White Balance Temperature, Auto<br />ID{0x0098090c};CHK{0:1:1:1}=VAL{1}<br />#Power Line Frequency<br />ID{0x00980918};CHK{0:2:1:2}=VAL{2}<br />#White Balance Temperature<br />ID{0x0098091a};CHK{2800:10000:1:4500}=VAL{4500}<br />#Sharpness<br />ID{0x0098091b};CHK{0:50:1:25}=VAL{45}<br />#Backlight Compensation<br />ID{0x0098091c};CHK{0:10:1:0}=VAL{0}<br />#Exposure, Auto<br />ID{0x009a0901};CHK{0:1:1:1}=VAL{3}<br />#Exposure (Absolute)<br />ID{0x009a0902};CHK{5:20000:1:156}=VAL{156}<br />#Pan (Absolute)<br />ID{0x009a0908};CHK{-201600:201600:3600:0}=VAL{201600}<br />#Tilt (Absolute)<br />ID{0x009a0909};CHK{-201600:201600:3600:0}=VAL{201600}<br />#Focus (absolute)<br />ID{0x009a090a};CHK{0:40:1:0}=VAL{3}<br />#Focus, Auto<br />ID{0x009a090c};CHK{0:1:1:0}=VAL{1}<br />#Zoom, Absolute<br />ID{0x009a090d};CHK{0:10:1:0}=VAL{1}</em></span></p><p>note: you need to change the value under braces <strong>{*}</strong><br />the first two numbers in <strong>CHK{<span style="color: red">x:x</span>:x:x} </strong> are in order the minimum and the maximum acceptable value you can use for each parameter</p> <br /><p>then to apply &#039;on-the-fly&#039; the new values (no need to restart mjpg-streamer):<br /><strong>/usr/bin/uvcdynctrl -L /etc/config/uvcdynctrl</strong></p><p>note: ignore errors!</p><br /><p>add the above command to /etc/rc.local to&nbsp; load and apply the new cam values at reboot:<br /><strong>vi /etc/rc.local</strong><br /><span style="color: blue"><em><br />#...<br />/usr/bin/uvcdynctrl -L /etc/config/uvcdynctrl<br />exit 0</em></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 14 Nov 2016, 18:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367220">
				<div class="post-metadata">
					<div class="post-num">Post #99</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						23 Oct 2017, 11:28					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">Just a quick update how to create a DDNS (Dynamic DNS) with Bind (server) and OpenWRT (client).</span></p><p>First of all you need to configure BIND on your server to accept dynamic updates from a remote client.</p><p>To configure BIND follow this guide:<br /><a href="http://www.foell.org/justin/diy-dynamic-dns-with-openwrt-bind/">http://www.foell.org/justin/diy-dynamic â€¦ nwrt-bind/</a></p><p>Important note: <br /><em><span style="color: red">your BIND server must be the authoritative DNS for the domain you want to manage,</span></em><br />see here: <a href="https://www.dnsknowledge.com/whatis/authoritative-name-server/">https://www.dnsknowledge.com/whatis/aut â€¦ me-server/</a></p><p><span class="bbu">On your OpenWRT Router:</span></p><p>-- install bind-client package</p><p><strong>opkg update<br />opkg install bind-client</strong></p><p>-- copy the two generated files from BIND server (file.key and file.private) to your OpenWRT router (/root directory)</p><p>-- create the script to check for public IP changes and update your zone if IP has changed:</p><p><strong>vi /root/check-ip.sh</strong></p><div class="codebox"><pre><code>#!/bin/bash
NOWIPADDR=&quot;/tmp/nowipaddr&quot;
GETIPADDR=&quot;curl http://icanhazip.com&quot;
IP=$(curl http://icanhazip.com)
if [ -f $NOWIPADDR ]
then
if [ `cat $NOWIPADDR` = `$GETIPADDR` ]
then
echo &quot;IP NOT changed&quot;
else
$GETIPADDR &gt; $NOWIPADDR
echo &quot;IP changed&quot;
echo &quot;server 222.222.222.222
zone domain.com.
update delete sub.domain.com. A
update add sub.domain.com. 86400 A $IP
show
send&quot; | nsupdate -k /root/Ksub.domain.com.+157+30338.key -v
fi
else
curl $GETIPADDR &gt;&gt; $NOWIPADDR
fi</code></pre></div><p>Notes: <br /><em>change &quot;<span style="color: red">222.222.222.222</span>&quot; with your BIND server static IP public address<br />change &quot;<span style="color: red">domain.com</span>&quot; and &quot;<span style="color: red">sub.domain.com</span>&quot; with your domain and your third <br />level domain name you want to update<br />change &quot;<span style="color: red">/root/Ksub.domain.com.+157+30338.key</span>&quot; with the file name (.key) generated by your BIND server&nbsp; </em></p><p>-- give the right permissions to the script:</p><p><strong>chmod 755 /root/check-ip.sh</strong></p><p>-- generate a crontab with <strong>crontab -e</strong> command to launch the script every 5 minutes:</p><div class="codebox"><pre><code>*/5 * * * * /bin/sh /root/check-ip.sh</code></pre></div><p>-- insert the following two lines to &quot;/etc/rc.local&quot; file, right before the &quot;exit 0&quot; line:</p><div class="codebox"><pre><code>/bin/touch /tmp/nowipaddr
/bin/sh /root/check-ip.sh</code></pre></div><p>reboot the router ...</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 23 Oct 2017, 15:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368341">
				<div class="post-metadata">
					<div class="post-num">Post #100</div>
					<div class="post-author">netgeppo</div>
					<div class="post-datetime">
						17 Nov 2017, 11:26					</div>
				</div>
				<div class="post-content content">
					<p>Ciao Pilovis,secondo te con una alix 3d2 (audio e mic integrato) posso trasformarla in un client per Mumble?magari con cuffie/mic bluetooth <br />Posso scriverti in mail?<br />Grazie</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 4 of 4</div><nav><ul><li><a href="viewtopic.php%3Fid=54722&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=54722&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=54722&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>