<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How do I close open WAN ports?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p233770">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">21e930c2</div>
					<div class="post-datetime">
						18 May 2014, 05:05					</div>
				</div>
				<div class="post-content content">
					<p>(Newb to openwrt)</p><p>I successfully installed openwrt. Works great. I love the linux package management feature (which a IMO makes openwrt more attractive than dd-wrt)</p><p>My only issue is that after doing a port scan (using grc shields up) there seems to be open WAN side listening ports that I&#039;d like to close. (135, 137,138,139, 445). Could someone give me instructions as to how to close these ports? (or as alternative links to existing article). Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233777">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						18 May 2014, 06:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>21e930c2 wrote:</cite><blockquote><p>(Newb to openwrt)</p><p>I successfully installed openwrt. Works great. I love the linux package management feature (which a IMO makes openwrt more attractive than dd-wrt)</p><p>My only issue is that after doing a port scan (using grc shields up) there seems to be open WAN side listening ports that I&#039;d like to close. (135, 137,138,139, 445). Could someone give me instructions as to how to close these ports? (or as alternative links to existing article). Thanks.</p></blockquote></div><p>Post firewall config</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233788">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						18 May 2014, 10:56					</div>
				</div>
				<div class="post-content content">
					<p>Don&#039;t test from inside your LAN!! By default all ports on the WAN are closed.</p>											<p class="post-edited">(Last edited by <strong>written_direcon</strong> on 18 May 2014, 10:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233791">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						18 May 2014, 11:23					</div>
				</div>
				<div class="post-content content">
					<p>Are they really reported &quot;open&quot; or &quot;stealth&quot;?<br />Many ISPs drop incoming traffic to those ports so that the traffic does not even reach your router, and the grc test reports them as &quot;stealth&quot;.</p><p>Read this thread, which sounds rather similar...<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=228834#p228834">https://forum.openwrt.org/viewtopic.php … 34#p228834</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 18 May 2014, 11:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233814">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">21e930c2</div>
					<div class="post-datetime">
						18 May 2014, 21:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><div class="quotebox"><cite>21e930c2 wrote:</cite><blockquote><p>(Newb to openwrt)</p><p>I successfully installed openwrt. Works great. I love the linux package management feature (which a IMO makes openwrt more attractive than dd-wrt)</p><p>My only issue is that after doing a port scan (using grc shields up) there seems to be open WAN side listening ports that I&#039;d like to close. (135, 137,138,139, 445). Could someone give me instructions as to how to close these ports? (or as alternative links to existing article). Thanks.</p></blockquote></div><p>Post firewall config</p></blockquote></div><p>How would I do that?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233815">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">21e930c2</div>
					<div class="post-datetime">
						18 May 2014, 21:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>written_direcon wrote:</cite><blockquote><p>Don&#039;t test from inside your LAN!! By default all ports on the WAN are closed.</p></blockquote></div><p>Thanks for reply but I believe Grc tests from remote website.<br /><a href="https://www.grc.com/x/ne.dll?bh0bkyd2">https://www.grc.com/x/ne.dll?bh0bkyd2</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233819">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">21e930c2</div>
					<div class="post-datetime">
						18 May 2014, 22:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>Are they really reported &quot;open&quot; or &quot;stealth&quot;?<br />Many ISPs drop incoming traffic to those ports so that the traffic does not even reach your router, and the grc test reports them as &quot;stealth&quot;.</p><p>Read this thread, which sounds rather similar...<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=228834#p228834">https://forum.openwrt.org/viewtopic.php … 34#p228834</a></p></blockquote></div><br /><p>Here is a screen shot of grc scan report. You&#039;re right it does say &quot;stealth&quot; but is there a way for it to be completely closed? (i..e be invisible to port scans)<br /><a href="https://i.imgur.com/NsuOREA.png">https://i.imgur.com/NsuOREA.png</a></p>											<p class="post-edited">(Last edited by <strong>21e930c2</strong> on 18 May 2014, 22:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233822">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						18 May 2014, 22:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>21e930c2 wrote:</cite><blockquote><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>Are they really reported &quot;open&quot; or &quot;stealth&quot;?<br />Many ISPs drop incoming traffic to those ports so that the traffic does not even reach your router, and the grc test reports them as &quot;stealth&quot;.</p><p>Read this thread, which sounds rather similar...<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=228834#p228834">https://forum.openwrt.org/viewtopic.php … 34#p228834</a></p></blockquote></div><p>Here is a screen shot of grc scan report. You&#039;re right it does say &quot;stealth&quot; but is there a way for it to be completely closed? (i..e be invisible to port scans)<br /><a href="https://i.imgur.com/NsuOREA.png">https://i.imgur.com/NsuOREA.png</a></p></blockquote></div><p>Yeah. I suspected that. So this is again a thread about a non-issue.</p><p>&quot;Stealth&quot; means that the grc test did not receive &quot;reject&quot; response, it waited for timeout and marked it then as stealth.<br />&quot;Closed&quot; means that your router blocked the traffic and sent &quot;reject&quot; feedback to grc. So the scanner knows that there is a device on that port.</p><p>Stealth is actually more invisible to the scan.<br />From your perspective both are the same. No traffic comes through.</p><p>If it is your ISP that quietly blocks the traffic to those ports, there is nothing you can do. And why should you do anything, as the traffic never reaches you?</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 18 May 2014, 22:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233832">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">21e930c2</div>
					<div class="post-datetime">
						19 May 2014, 01:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><div class="quotebox"><cite>21e930c2 wrote:</cite><blockquote><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>Are they really reported &quot;open&quot; or &quot;stealth&quot;?<br />Many ISPs drop incoming traffic to those ports so that the traffic does not even reach your router, and the grc test reports them as &quot;stealth&quot;.</p><p>Read this thread, which sounds rather similar...<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=228834#p228834">https://forum.openwrt.org/viewtopic.php … 34#p228834</a></p></blockquote></div><p>Here is a screen shot of grc scan report. You&#039;re right it does say &quot;stealth&quot; but is there a way for it to be completely closed? (i..e be invisible to port scans)<br /><a href="https://i.imgur.com/NsuOREA.png">https://i.imgur.com/NsuOREA.png</a></p></blockquote></div><p>Yeah. I suspected that. So this is again a thread about a non-issue.</p><p>&quot;Stealth&quot; means that the grc test did not receive &quot;reject&quot; response, it waited for timeout and marked it then as stealth.<br />&quot;Closed&quot; means that your router blocked the traffic and sent &quot;reject&quot; feedback to grc. So the scanner knows that there is a device on that port.</p><p>Stealth is actually more invisible to the scan.<br />From your perspective both are the same. No traffic comes through.</p><p>If it is your ISP that quietly blocks the traffic to those ports, there is nothing you can do. And why should you do anything, as the traffic never reaches you?</p></blockquote></div><p>Just to confirm (newb so please bare with me) what you are saying is that the closed (reject) response is coming from my ISP not Openwrt? (i.e. that there are no listening ports in openwrt by default)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233844">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						19 May 2014, 10:12					</div>
				</div>
				<div class="post-content content">
					<p>No, reject response (blue) is coming from the router, green (stealth) are silently blocked by your ISP.</p><p>Blue: grc ask to open a port, but openwrt responds by denying the access<br />Green: grc ask to open a port, but ISP throws the packet away and does not respond at all</p><p>So all you can do is to be stealth on all of the ports, &quot;stealth&quot; rule (=do not accept nor reject) is called DROP</p><p>Stealh you can become this way: 1. change ping from ACCEPT to DROP (openwr responds to ping by default), 2. change rules on WAN from REJECT to DROP. Example how to do it I wrote here: <a href="https://forum.openwrt.org/viewtopic.php?pid=229008#p229008">https://forum.openwrt.org/viewtopic.php … 08#p229008</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233941">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">21e930c2</div>
					<div class="post-datetime">
						20 May 2014, 03:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nozombian wrote:</cite><blockquote><p>No, reject response (blue) is coming from the router, green (stealth) are silently blocked by your ISP.</p><p>Blue: grc ask to open a port, but openwrt responds by denying the access<br />Green: grc ask to open a port, but ISP throws the packet away and does not respond at all</p><p>So all you can do is to be stealth on all of the ports, &quot;stealth&quot; rule (=do not accept nor reject) is called DROP</p><p>Stealh you can become this way: 1. change ping from ACCEPT to DROP (openwr responds to ping by default), 2. change rules on WAN from REJECT to DROP. Example how to do it I wrote here: <a href="https://forum.openwrt.org/viewtopic.php?pid=229008#p229008">https://forum.openwrt.org/viewtopic.php … 08#p229008</a></p></blockquote></div><p>Thanks for great reply.&nbsp; I followed your link. Had to do a bunch of reading to figure out how to change the file you mention but seemed to work. (all ports show stealth now). Here are exact steps I took in case any other newb runs across this issue.</p><p>1. Make sure ssh is installed on openwrt<br />Logon to openwrt via the browser <br />menu&gt;system&gt;administration (make sure there is a dropbear instance preferably LAN only)</p><p>2. Install Putty on host machine (to be used to connect to ssh service running on openwrt)<br /><a href="https://en.wikipedia.org/wiki/PuTTY">https://en.wikipedia.org/wiki/PuTTY</a></p><p>3. Open putty and connect to router&#039;s ip. Use your openwrt login and password to login.</p><p>4. In putty window edit firewall using vi editor<br />&nbsp; &nbsp; &nbsp;vi /etc/config/firewall<br />&nbsp; &nbsp; &nbsp;scroll to all lines that say &#039;REJECT&#039; and change them to &#039;DROP&#039; <br />&nbsp; &nbsp; &nbsp;(vi tips: press &#039;i&#039; to insert text, esc to return to command mode, :wq to save and quit)<br />&nbsp; &nbsp; &nbsp;exit Putty</p><p>5. Back in openwrt in browser navigate to menu&gt;network&gt;firewall</p><p>6. Change Forward field from &#039;reject&#039; to &quot;drop&quot;</p><p>7. Save and apply.</p>											<p class="post-edited">(Last edited by <strong>21e930c2</strong> on 22 May 2014, 08:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233956">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						20 May 2014, 07:21					</div>
				</div>
				<div class="post-content content">
					<p>To pass the GRC Shields Up Test you need to change 1 firewall rule.<br />Allow-Ping&nbsp; &nbsp; <br />IPv4-ICMP with type echo-request<br />From any host in wan<br />To any router IP on this device</p><p>to</p><p>Allow-Ping<br />&nbsp; &nbsp; <br />IPv4-ICMP with type echo-reply<br />From any host in wan<br />To any router IP on this device</p><p>so you can still ping WAN host but they are not able to ping you and set all rules to drop rather than reject.</p><p>Because GRC thinks that being pingable is not secure.</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 20 May 2014, 07:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233961">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						20 May 2014, 09:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>To pass the GRC Shields Up Test you need to change 1 firewall rule.<br />Allow-Ping&nbsp; &nbsp; <br />IPv4-ICMP with type echo-request<br />From any host in wan<br />To any router IP on this device</p><p>to</p><p>Allow-Ping<br />&nbsp; &nbsp; <br />IPv4-ICMP with type echo-reply<br />From any host in wan<br />To any router IP on this device</p><p>so you can still ping WAN host but they are not able to ping you and set all rules to drop rather than reject.</p><p>Because GRC thinks that being pingable is not secure.</p></blockquote></div><p>1. to pass the test, you need to change more than 1 rule, I gusess at least three, even more if you are on ipv6 <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> When set correctly, you can still accept ping replies originated from behind openwrt, but it won&#039;t respond to those originated from internet<br />2. grc thinks you are secure when you do not reply nor deny ping and do not accept nor reject connections. This is because, that attackers are doing simple tests before a complete port scan and when it looks like there&#039;s noone alive behind an IP, they move on rather than wasting resources by scanning probably unpopulated IP.</p><p>The objective of grc stealth is security by obscurity. By changing to stealth and moving well known ports to uncommon I have avoided 100% of password cracking attempts. Previously I had logs full from chinese ip addresses trying to guess my ssh password, but not a single hit since then. Being stealth also protects you from undiscovered exploits.</p>											<p class="post-edited">(Last edited by <strong>nozombian</strong> on 20 May 2014, 09:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233965">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">21e930c2</div>
					<div class="post-datetime">
						20 May 2014, 10:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nozombian wrote:</cite><blockquote><p>The objective of grc stealth is security by obscurity. By changing to stealth and moving well known ports to uncommon I have avoided 100% of password cracking attempts. Previously I had logs full from chinese ip addresses trying to guess my ssh password, but not a single hit since then. Being stealth also protects you from undiscovered exploits.</p></blockquote></div><p>Exactly my rationale. </p><p>Most hacks aren&#039;t targeted ergo obscurity seems to be a huge part of security.&nbsp; I actual migrated to open source router firmware because I read so many horror stories about unpatched OEM router firmware (easy pickings for scripts). <br /><a href="https://www.superevr.com/blog/2013/dont-use-linksys-routers/">https://www.superevr.com/blog/2013/dont … s-routers/</a></p><p>My next step is to run nmap on another machine to verify that everything is invisible. (found tool below)<br /><a href="http://nmap.online-domain-tools.com/">http://nmap.online-domain-tools.com/</a></p><p>I&#039;m actually thinking of also adding pfsense to the inside of my network for an additional layer of security (add snort, blocklists. proxy, honeypot, iptables, and any other goodies I can find) </p><p>You&#039;ve answered my question but its really just the first of several questions. If your interested in providing more input I&#039;m about to&nbsp; open a new post asking for suggestions to harden openwrt. (I&#039;ll post link to new thread below)</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=233967#p233967">https://forum.openwrt.org/viewtopic.php … 67#p233967</a></p>											<p class="post-edited">(Last edited by <strong>21e930c2</strong> on 20 May 2014, 11:13)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>