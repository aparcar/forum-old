<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> PPP interface in OpenWRT using Sim800L GSM Modem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p343072">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kumar.murugan</div>
					<div class="post-datetime">
						5 Nov 2016, 07:26					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,</p><p>I want to make a PPP interface using Sim800L GSM Modem connected through UART.</p><p>I am using MT7688 (LinkIt Smart 7688) where OpenWRT runs.</p><p>Please help me out making PPP interface or dial-up connection in openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343215">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kumar.murugan</div>
					<div class="post-datetime">
						7 Nov 2016, 14:47					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,</p><p>I have made the interface up.</p><p>Please refer the below link ...it will be useful....</p><p><a href="https://wiki.openwrt.org/doc/recipes/3gdongle">https://wiki.openwrt.org/doc/recipes/3gdongle</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348656">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">vnt-83</div>
					<div class="post-datetime">
						7 Jan 2017, 08:43					</div>
				</div>
				<div class="post-content content">
					<p>Hello. How You make this?<br />I read this link, but interface not up.</p><p>I set pincode on SIM card to 0000 (default pincode) and disabled SIM card blocking via mobile phone.</p><p>/etc/config/network:<br /></p><div class="codebox"><pre><code>config interface &#039;wan3g&#039;
        option ifname &#039;ppp0&#039;
        option proto &#039;3g&#039;
        option device &#039;/dev/ttyS0&#039;
        option apn &#039;internet&#039;
        option username &#039;gdata&#039;
        option password &#039;gdata&#039;
        option dialnumber &#039;*99***1#&#039;
        option service &#039;umts&#039;
        #option pincode &#039;&#039;</code></pre></div><p># logread:<br /></p><div class="codebox"><pre><code>Sat Jan  7 08:41:26 2017 daemon.notice netifd: Interface &#039;wan3g&#039; is setting up now
Sat Jan  7 08:41:28 2017 daemon.notice pppd[1390]: pppd 2.4.7 started by root, uid 0
Sat Jan  7 08:41:29 2017 local2.info chat[1392]: abort on (BUSY)
Sat Jan  7 08:41:29 2017 local2.info chat[1392]: abort on (NO CARRIER)
Sat Jan  7 08:41:29 2017 local2.info chat[1392]: abort on (ERROR)
Sat Jan  7 08:41:29 2017 local2.info chat[1392]: report (CONNECT)
Sat Jan  7 08:41:29 2017 local2.info chat[1392]: timeout set to 10 seconds
Sat Jan  7 08:41:29 2017 local2.info chat[1392]: send (AT&amp;F^M)
Sat Jan  7 08:41:29 2017 local2.info chat[1392]: expect (OK)
Sat Jan  7 08:41:39 2017 local2.info chat[1392]: alarm
Sat Jan  7 08:41:39 2017 local2.info chat[1392]: Failed
Sat Jan  7 08:41:39 2017 daemon.err pppd[1390]: Connect script failed
Sat Jan  7 08:41:40 2017 daemon.info pppd[1390]: Exit.
Sat Jan  7 08:41:40 2017 daemon.notice netifd: Interface &#039;wan3g&#039; is now down
Sat Jan  7 08:41:40 2017 daemon.notice netifd: Interface &#039;wan3g&#039; is setting up now
Sat Jan  7 08:41:41 2017 daemon.notice pppd[1412]: pppd 2.4.7 started by root, uid 0
Sat Jan  7 08:41:42 2017 local2.info chat[1414]: abort on (BUSY)
Sat Jan  7 08:41:42 2017 local2.info chat[1414]: abort on (NO CARRIER)
Sat Jan  7 08:41:42 2017 local2.info chat[1414]: abort on (ERROR)
Sat Jan  7 08:41:42 2017 local2.info chat[1414]: report (CONNECT)
Sat Jan  7 08:41:42 2017 local2.info chat[1414]: timeout set to 10 seconds
Sat Jan  7 08:41:42 2017 local2.info chat[1414]: send (AT&amp;F^M)
Sat Jan  7 08:41:42 2017 local2.info chat[1414]: expect (OK)
Sat Jan  7 08:41:52 2017 local2.info chat[1414]: alarm
Sat Jan  7 08:41:52 2017 local2.info chat[1414]: Failed
Sat Jan  7 08:41:52 2017 daemon.err pppd[1412]: Connect script failed
Sat Jan  7 08:41:53 2017 daemon.info pppd[1412]: Exit.
Sat Jan  7 08:41:53 2017 daemon.notice netifd: Interface &#039;wan3g&#039; is now down
...</code></pre></div><p># ifstatus wan3g:<br /></p><div class="codebox"><pre><code>{
        &quot;up&quot;: false,
        &quot;pending&quot;: true,
        &quot;available&quot;: true,
        &quot;autostart&quot;: true,
        &quot;proto&quot;: &quot;3g&quot;,
        &quot;data&quot;: {

        }
}</code></pre></div><br /><p>if I enabled SIM card blocking:</p><p>/etc/config/network:<br /></p><div class="codebox"><pre><code>config interface &#039;wan3g&#039;
        option ifname &#039;ppp0&#039;
        option proto &#039;3g&#039;
        option device &#039;/dev/ttyS0&#039;
        option apn &#039;internet&#039;
        option username &#039;gdata&#039;
        option password &#039;gdata&#039;
        option dialnumber &#039;*99***1#&#039;
        option service &#039;umts&#039;
        option pincode &#039;0000&#039;</code></pre></div><p># ifstatus wan3g:<br /></p><div class="codebox"><pre><code>{
        &quot;up&quot;: false,
        &quot;pending&quot;: false,
        &quot;available&quot;: true,
        &quot;autostart&quot;: false,
        &quot;proto&quot;: &quot;3g&quot;,
        &quot;data&quot;: {

        },
        &quot;errors&quot;: [
                {
                        &quot;subsystem&quot;: &quot;3g&quot;,
                        &quot;code&quot;: &quot;PIN_FAILED&quot;
                }
        ]
}</code></pre></div><p>0000 is a real pincode. I type it on mobile phone start.</p><p>Please help me.</p><p>OpenWRT is CHAOS CALMER (15.05, r46767).<br />Mikrotik RB951Ui 2HnD<br />Mobile provider is Megafon.</p><p>Also I disabled UART console and reset terminal to RAW mode:<br /></p><div class="codebox"><pre><code>/etc/sysctl.conf wrote:
kernel.printk = 0 4 1 7

/etc/inittab wrote:
::sysinit:/etc/init.d/rcS S boot
::shutdown:/etc/init.d/rcS K shutdown
#::askconsole:/bin/ash --login

etc/rc.local wrote:
stty -F /dev/ttyS0 4:0:18b2:0:0:0:0:0:1:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0</code></pre></div>											<p class="post-edited">(Last edited by <strong>vnt-83</strong> on 7 Jan 2017, 08:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348657">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">kumar.murugan</div>
					<div class="post-datetime">
						7 Jan 2017, 09:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi </p><p>PIN is not mandatory...No need to include the same....</p><p>Can you try without user name , password, PIN etc.,?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348658">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">kumar.murugan</div>
					<div class="post-datetime">
						7 Jan 2017, 09:18					</div>
				</div>
				<div class="post-content content">
					<p>Dial number is correct?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348660">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">vnt-83</div>
					<div class="post-datetime">
						7 Jan 2017, 09:38					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I try without username, password, PIN. Connection not work.</p><div class="codebox"><pre><code>config interface &#039;wan3g&#039;
        option ifname &#039;ppp0&#039;
        option proto &#039;3g&#039;
        option device &#039;/dev/ttyS0&#039;
        option apn &#039;internet&#039;
        option username &#039;&#039;
        option password &#039;&#039;
        option dialnumber &#039;*99#&#039;
        option service &#039;umts&#039;
#       option pincode &#039;0000&#039;</code></pre></div><p>Although through the AT command module calls on my phone. Maybe module is defective? I will check GET requests via AT commands.</p><p>I added wan3g interface via luci. Could I miss something? Different kmod-usb-serial modules do not need me, right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348661">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">vnt-83</div>
					<div class="post-datetime">
						7 Jan 2017, 09:41					</div>
				</div>
				<div class="post-content content">
					<p>I try *99# and *99***1#. Now I will try without dial number.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348664">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">kumar.murugan</div>
					<div class="post-datetime">
						7 Jan 2017, 11:07					</div>
				</div>
				<div class="post-content content">
					<p>you can comment the username and password...</p><p>Dial number and apn is very important it should match with the GSM service provider details of the corresponding SIM you are using...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348666">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">vnt-83</div>
					<div class="post-datetime">
						7 Jan 2017, 11:24					</div>
				</div>
				<div class="post-content content">
					<p>Dial number and apn is ok.</p><p>Through the AT commands GET requests works correctly.</p><p>It is seen (via cat /dev/ttyS0) that the module sends the information not correctly.</p><p>Must be like this:<br /></p><div class="codebox"><pre><code>AT+CIPSEND=27
ERROR
AT*CIPSTART=&quot;TCP&quot;,&quot;site.com&quot;,80
OK

CONNECT OK

AT+CFTN=1
OK
AT+CPIN&gt;
+CPIN: READY

OK
AT+CSTT&lt;&quot;internet&quot;,&quot;&quot;,&quot;&quot;
OK</code></pre></div><br /><p>Actually as follows:<br /></p><div class="codebox"><pre><code>AT+CIPREND=26
ERRNR
AT*CIPST@RT=&quot;TBP&quot;,&quot;site.com&quot;,80
OK

CONNECT NK

AT+CFTN=1
NK
AT+CPIN&gt;
+CPHN: RE@DY

OK
AT+CSTT&lt;&quot;internet&quot;,&quot;&quot;,&quot;&quot;
NK</code></pre></div><p>I think this may be the cause. What could it be?</p>											<p class="post-edited">(Last edited by <strong>vnt-83</strong> on 7 Jan 2017, 11:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348669">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">kumar.murugan</div>
					<div class="post-datetime">
						7 Jan 2017, 11:47					</div>
				</div>
				<div class="post-content content">
					<p>can you share the chat script?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348671">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">vnt-83</div>
					<div class="post-datetime">
						7 Jan 2017, 12:52					</div>
				</div>
				<div class="post-content content">
					<p>Yes. I do not edit it.</p><div class="codebox"><pre><code># cat /etc/chatscripts/3g.chat
ABORT   BUSY
ABORT   &#039;NO CARRIER&#039;
ABORT   ERROR
REPORT  CONNECT
TIMEOUT 10
&quot;&quot;      &quot;AT&amp;F&quot;
OK      &quot;ATE1&quot;
OK      &#039;AT+CGDCONT=1,&quot;IP&quot;,&quot;$USE_APN&quot;&#039;
SAY     &quot;Calling UMTS/GPRS&quot;
TIMEOUT 30
OK      &quot;ATD$DIALNUMBER&quot;
CONNECT &#039; &#039;</code></pre></div><p>I manually entered all AT commands from this script. And I got as a result the success message.</p><div class="codebox"><pre><code># echo &quot;AT&amp;F&quot; &gt; /dev/ttyS0
# echo &quot;ATE1&quot; &gt; /dev/ttyS0
# echo &quot;AT+CGDCONT=1,\&quot;IP\&quot;,\&quot;internet\&quot;&quot; &gt; /dev/ttyS0
# echo &quot;ATD*99#&quot; &gt; /dev/ttyS0


# cat /dev/ttyS0
AT&amp;F
OK

ATE1
OK

AT+CGDCONT=0,&quot;IP&quot;,&quot;internet&quot;
OJ
ATD*99#
BONNECT</code></pre></div><p>I am confused by the wrong display from cat /dev/ttyS0. Here is part of the result of a GET request:</p><div class="codebox"><pre><code>codebase=&quot;http:/.downlnad.mabromedha.com.pub/shockwave/cabr/flash/swfl`sh.cab#vershon=9,0,18,0&quot;</code></pre></div><p>It seems that different settings have UART and serial port of module.</p>											<p class="post-edited">(Last edited by <strong>vnt-83</strong> on 7 Jan 2017, 13:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348682">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">vnt-83</div>
					<div class="post-datetime">
						7 Jan 2017, 16:38					</div>
				</div>
				<div class="post-content content">
					<p>I enabled debug in /etc/ppp/options and get new line in logread:</p><div class="codebox"><pre><code>daemon.debug pppd[3626]: Script USE_APN=internet DIALNUMBER=*99# /usr/sbin/chat -t5 -v -E -f /etc/chatscripts/3g.chat finished (pid 3627), status = 0x3</code></pre></div><div class="codebox"><pre><code># cat /etc/ppp/options
debug
logfile /dev/null
noipdefault
noaccomp
nopcomp
nocrtscts
lock
maxfail 0
lcp-echo-failure 5
lcp-echo-interval 1</code></pre></div><p>Full log:<br /></p><div class="codebox"><pre><code>Sat Jan  7 17:40:45 2017 daemon.notice netifd: Interface &#039;wan3g&#039; is setting up now
Sat Jan  7 17:40:47 2017 daemon.notice pppd[4646]: pppd 2.4.7 started by root, uid 0
Sat Jan  7 17:40:48 2017 local2.info chat[4651]: abort on (BUSY)
Sat Jan  7 17:40:48 2017 local2.info chat[4651]: abort on (NO CARRIER)
Sat Jan  7 17:40:48 2017 local2.info chat[4651]: abort on (ERROR)
Sat Jan  7 17:40:48 2017 local2.info chat[4651]: report (CONNECT)
Sat Jan  7 17:40:48 2017 local2.info chat[4651]: timeout set to 10 seconds
Sat Jan  7 17:40:48 2017 local2.info chat[4651]: send (AT&amp;F^M)
Sat Jan  7 17:40:48 2017 local2.info chat[4651]: expect (OK)
Sat Jan  7 17:40:58 2017 local2.info chat[4651]: alarm
Sat Jan  7 17:40:58 2017 local2.info chat[4651]: Failed
Sat Jan  7 17:40:58 2017 daemon.debug pppd[4646]: Script USE_APN=internet DIALNUMBER=*99# /usr/sbin/chat -t5 -v -E -f /etc/chatscripts/3g.chat finished (pid 4650), status = 0x3
Sat Jan  7 17:40:58 2017 daemon.err pppd[4646]: Connect script failed
Sat Jan  7 17:40:59 2017 daemon.info pppd[4646]: Exit.
Sat Jan  7 17:40:59 2017 daemon.notice netifd: Interface &#039;wan3g&#039; is now down</code></pre></div>											<p class="post-edited">(Last edited by <strong>vnt-83</strong> on 7 Jan 2017, 16:45)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>