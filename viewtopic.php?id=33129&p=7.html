<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> New package: mwan2; testers wanted.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 31 Mar 2018 and 27 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 7 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=33129&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=33129&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=33129&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=33129&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=33129&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=33129&amp;p=14.html">14</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p166057">
				<div class="post-metadata">
					<div class="post-num">Post #151</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						29 Apr 2012, 12:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>swoofz wrote:</cite><blockquote><p>Can you pls kindly see and advise what I did wrong or miss? Thank you.</p></blockquote></div><p>Looks OK so far... Only thing i would change is te give each wan interface a different metric in /etc/config/network, but that isn&#039;t the cause of your problem right now.</p><p>Could you paste me your firewall config, as i suspect there lies your problem. Could you also check if syn packets leave the router and syn-ack gets back: tcpdump -i br-lan -n port 5038.</p><p>Thank you for testing. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 29 Apr 2012, 12:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166082">
				<div class="post-metadata">
					<div class="post-num">Post #152</div>
					<div class="post-author">swoofz</div>
					<div class="post-datetime">
						29 Apr 2012, 19:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Looks OK so far... Only thing i would change is te give each wan interface a different metric in /etc/config/network, but that isn&#039;t the cause of your problem right now.</p><p>Could you paste me your firewall config, as i suspect there lies your problem. Could you also check if syn packets leave the router and syn-ack gets back: tcpdump -i br-lan -n port 5038.</p><p>Thank you for testing. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>This is my firewall config :<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/firewall

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-DHCP-Renew&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;68&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;
        option &#039;family&#039; &#039;ipv4&#039;

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-Ping&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        option &#039;icmp_type&#039; &#039;echo-request&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-DHCPv6&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;src_ip&#039; &#039;fe80::/10&#039;
        option &#039;src_port&#039; &#039;547&#039;
        option &#039;dest_ip&#039; &#039;fe80::/10&#039;
        option &#039;dest_port&#039; &#039;546&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-ICMPv6-Input&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        list &#039;icmp_type&#039; &#039;echo-request&#039;
        list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
        list &#039;icmp_type&#039; &#039;packet-too-big&#039;
        list &#039;icmp_type&#039; &#039;time-exceeded&#039;
        list &#039;icmp_type&#039; &#039;bad-header&#039;
        list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
        list &#039;icmp_type&#039; &#039;router-solicitation&#039;
        list &#039;icmp_type&#039; &#039;neighbour-solicitation&#039;
        option &#039;limit&#039; &#039;1000/sec&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-ICMPv6-Forward&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;dest&#039; &#039;*&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        list &#039;icmp_type&#039; &#039;echo-request&#039;
        list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
        list &#039;icmp_type&#039; &#039;packet-too-big&#039;
        list &#039;icmp_type&#039; &#039;time-exceeded&#039;
        list &#039;icmp_type&#039; &#039;bad-header&#039;
        list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
        option &#039;limit&#039; &#039;1000/sec&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;defaults&#039;
        option &#039;syn_flood&#039; &#039;1&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;ACCEPT&#039;
        option &#039;drop_invalid&#039; &#039;1&#039;

config &#039;zone&#039;
        option &#039;network&#039; &#039;lan&#039;
        option &#039;name&#039; &#039;lan&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;ACCEPT&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;wan&#039;
        option &#039;network&#039; &#039;3GWAN WAN&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;ACCEPT&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;masq&#039; &#039;1&#039;
        option &#039;mtu_fix&#039; &#039;1&#039;


config &#039;include&#039;
        option &#039;path&#039; &#039;/etc/firewall.user&#039;


config &#039;redirect&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;dest_ip&#039; &#039;192.168.0.201&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;proto&#039; &#039;tcp&#039;
        option &#039;src_dport&#039; &#039;5038&#039;
        option &#039;dest_port&#039; &#039;5038&#039;
        option &#039;target&#039; &#039;DNAT&#039;
        option &#039;dest&#039; &#039;lan&#039;

config &#039;forwarding&#039;
        option &#039;dest&#039; &#039;lan&#039;
        option &#039;src&#039; &#039;wan&#039;

config &#039;forwarding&#039;
        option &#039;dest&#039; &#039;wan&#039;
        option &#039;src&#039; &#039;lan&#039;</code></pre></div><p>and here&#039;s the tcpdump -i br-lan -n port 5038 :<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# tcpdump -i br-lan -n &quot;port 5038&quot;
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on br-lan, link-type EN10MB (Ethernet), capture size 65535 bytes
23:00:50.841238 IP 192.168.0.201.5038 &gt; 206.53.152.166.29710: Flags [S.], seq 1045335257, ack 2984618469, win 5792, options [mss 1460,sackOK,TS val 33630636 ecr 343148770,nop,wscale 2], length 0
23:00:52.554529 IP 206.53.152.166.8895 &gt; 192.168.0.201.5038: Flags [s], seq 3428477309, win 5840, options [mss 1380,sackOK,TS val 343172542 ecr 0,nop,wscale 7], length 0
23:00:52.554644 IP 192.168.0.201.5038 &gt; 206.53.152.166.8895: Flags [S.], seq 2531118748, ack 3428477310, win 5792, options [mss 1460,sackOK,TS val 33630807 ecr 343172542,nop,wscale 2], length 0
23:00:55.554290 IP 206.53.152.166.8895 &gt; 192.168.0.201.5038: Flags [s], seq 3428477309, win 5840, options [mss 1380,sackOK,TS val 343173293 ecr 0,nop,wscale 7], length 0
23:00:55.554404 IP 192.168.0.201.5038 &gt; 206.53.152.166.8895: Flags [S.], seq 2531118748, ack 3428477310, win 5792, options [mss 1460,sackOK,TS val 33631107 ecr 343172542,nop,wscale 2], length 0
23:00:56.641089 IP 192.168.0.201.5038 &gt; 206.53.152.166.8895: Flags [S.], seq 2531118748, ack 3428477310, win 5792, options [mss 1460,sackOK,TS val 33631216 ecr 343172542,nop,wscale 2], length 0
23:01:01.554149 IP 206.53.152.166.8895 &gt; 192.168.0.201.5038: Flags [s], seq 3428477309, win 5840, options [mss 1380,sackOK,TS val 343174793 ecr 0,nop,wscale 7], length 0
23:01:01.554256 IP 192.168.0.201.5038 &gt; 206.53.152.166.8895: Flags [S.], seq 2531118748, ack 3428477310, win 5792, options [mss 1460,sackOK,TS val 33631707 ecr 343172542,nop,wscale 2], length 0
23:01:01.840971 IP 192.168.0.201.5038 &gt; 206.53.152.167.53068: Flags [S.], seq 1204645195, ack 1869301636, win 5792, options [mss 1460,sackOK,TS val 33631736 ecr 343151224,nop,wscale 2], length 0</code></pre></div><p>Please advise. Thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166137">
				<div class="post-metadata">
					<div class="post-num">Post #153</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						30 Apr 2012, 12:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>swoofz wrote:</cite><blockquote><p>Please advise. Thank you.</p></blockquote></div><p>I think you have the same problem as nodoze. Start reading from post #95 to #105. As your post #150 suggests you not have a working connmark.</p><p>Good luck!</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 30 Apr 2012, 12:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166241">
				<div class="post-metadata">
					<div class="post-num">Post #154</div>
					<div class="post-author">marcel_ms</div>
					<div class="post-datetime">
						1 May 2012, 16:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>I have managed to setup the following scenario:</p><p>- 2 Wireless UMTS link</p><p>I wanted both 3G links to load-balance traffic<br />This is my config:</p><p>/etc/config/network:<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;loopback&#039;
    option &#039;ifname&#039; &#039;lo&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
    option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
    option &#039;ifname&#039; &#039;eth0&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;dns&#039; &#039;192.168.1.1&#039;

config &#039;interface&#039; &#039;wan&#039;
    option &#039;auto&#039; &#039;1&#039;
    option &#039;proto&#039; &#039;3g&#039;
    option &#039;device&#039; &#039;/dev/ttyUSB0&#039;
    option &#039;apn&#039; &#039;internet&#039;
    option &#039;service&#039; &#039;umts&#039;
    option &#039;metric&#039; &#039;10&#039;


config &#039;interface&#039; &#039;wan2&#039;
    option &#039;auto&#039; &#039;1&#039;
    option &#039;proto&#039; &#039;3g&#039;
    option &#039;device&#039; &#039;/dev/ttyUSB2&#039;
    option &#039;apn&#039; &#039;internet&#039;
    option &#039;service&#039; &#039;umts&#039;
    option &#039;metric&#039; &#039;20&#039;

config &#039;switch&#039; &#039;eth0&#039;
    option &#039;enable_vlan&#039; &#039;1&#039;

config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;eth0&#039;
    option &#039;vlan&#039; &#039;1&#039;
    option &#039;ports&#039; &#039;0 1 2 3 4&#039;</code></pre></div><p>/etc/config/mwan2:<br /></p><div class="codebox"><pre><code>package &#039;mwan2&#039;

config &#039;interface&#039; &#039;wan&#039;
    option &#039;enabled&#039; &#039;1&#039;
    option &#039;metric&#039; &#039;1&#039;
    option &#039;weight&#039; &#039;1&#039;
    option &#039;track_ip&#039; &#039;www.google.com&#039;
    option &#039;count&#039; &#039;1&#039;
    option &#039;timeout&#039; &#039;2&#039;
    option &#039;interval&#039; &#039;5&#039;


config &#039;interface&#039; &#039;wan2&#039;
    option &#039;enabled&#039; &#039;1&#039;
    option &#039;metric&#039; &#039;1&#039;
    option &#039;weight&#039; &#039;1&#039;
    option &#039;track_ip&#039; &#039;www.google.com&#039;
    option &#039;count&#039; &#039;1&#039;
    option &#039;timeout&#039; &#039;2&#039;
    option &#039;interval&#039; &#039;5&#039;</code></pre></div><p>/etc/config/firewall</p><div class="codebox"><pre><code>config &#039;defaults&#039;
    option &#039;input&#039; &#039;DROP&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;syn_flood&#039; &#039;1&#039;
    option &#039;drop_invalid&#039; &#039;1&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;local&#039;
    option &#039;network&#039; &#039;lan&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;internet&#039;
    option &#039;network&#039; &#039;wan wan2&#039;
    option &#039;input&#039; &#039;DROP&#039;
    option &#039;forward&#039; &#039;DROP&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;masq&#039; &#039;1&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;local&#039;
    option &#039;dest&#039; &#039;internet&#039;</code></pre></div><p>Could someone check the configurations</p><p>it does not work properly</p><p>I do not know openwrt so well</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166242">
				<div class="post-metadata">
					<div class="post-num">Post #155</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						1 May 2012, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>Please change your /etc/config/network to:</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;loopback&#039;
    option &#039;ifname&#039; &#039;lo&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
    option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
    option &#039;ifname&#039; &#039;eth0&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;dns&#039; &#039;192.168.1.1&#039;

config &#039;interface&#039; &#039;wan&#039;
    option &#039;auto&#039; &#039;1&#039;
    option &#039;proto&#039; &#039;3g&#039;
    option &#039;device&#039; &#039;/dev/ttyUSB0&#039;
    option &#039;apn&#039; &#039;internet&#039;
    option &#039;service&#039; &#039;umts&#039;
    option &#039;defaultroute&#039; &#039;0&#039;

config &#039;interface&#039; &#039;wan2&#039;
    option &#039;auto&#039; &#039;1&#039;
    option &#039;proto&#039; &#039;3g&#039;
    option &#039;device&#039; &#039;/dev/ttyUSB2&#039;
    option &#039;apn&#039; &#039;internet&#039;
    option &#039;service&#039; &#039;umts&#039;
    option &#039;defaultroute&#039; &#039;0&#039;

config &#039;route&#039;
    option &#039;interface&#039; &#039;wan&#039;
    option &#039;target&#039; &#039;0.0.0.0&#039;
    option &#039;netmask&#039; &#039;0.0.0.0&#039;
    option &#039;metric&#039; &#039;10&#039;

config &#039;route&#039;
    option &#039;interface&#039; &#039;wan2&#039;
    option &#039;target&#039; &#039;0.0.0.0&#039;
    option &#039;netmask&#039; &#039;0.0.0.0&#039;
    option &#039;metric&#039; &#039;20&#039;

config &#039;switch&#039; &#039;eth0&#039;
    option &#039;enable_vlan&#039; &#039;1&#039;

config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;eth0&#039;
    option &#039;vlan&#039; &#039;1&#039;
    option &#039;ports&#039; &#039;0 1 2 3 4&#039;</code></pre></div><p>Good luck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166260">
				<div class="post-metadata">
					<div class="post-num">Post #156</div>
					<div class="post-author">marcel_ms</div>
					<div class="post-datetime">
						1 May 2012, 22:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Please change your /etc/config/network to:</p><div class="codebox"><pre><code>...</code></pre></div><p>Good luck</p></blockquote></div><p>I changed it</p><p>works better but not enough</p><p>for example, download the same file on two computers(I use download accelerator DownThemAll, ten session for file)</p><p>I have ca. 250kb/s on each computer</p><p>when I download the same file only on one computer a have the same 250kb/s(it is max speed on my 3g link)</p><br /><p>otherwise download process is interrupted after a time in both cases</p><br /><p>any errors in the configuration?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166261">
				<div class="post-metadata">
					<div class="post-num">Post #157</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						1 May 2012, 22:43					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s a limitation of mwan2. See opening post:</p><p><strong>Known limitations:</strong><br />- Only host based load-balancing support (ones a packet is routed to a host, all packets to that same host traverse the same WAN).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166269">
				<div class="post-metadata">
					<div class="post-num">Post #158</div>
					<div class="post-author">marcel_ms</div>
					<div class="post-datetime">
						1 May 2012, 23:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>It&#039;s a limitation of mwan2. See opening post:</p><p><strong>Known limitations:</strong><br />- Only host based load-balancing support (ones a packet is routed to a host, all packets to that same host traverse the same WAN).</p></blockquote></div><p>OK, any change in future?<br />old Multi WAN adds bandwidth</p><br /><p>what about this?</p><p>download process is interrupted after some time</p><br /><p>This is the latest version<br />The package:<br /><a href="http://213.136.13.52/mwan2_1.3-10.ipk">http://213.136.13.52/mwan2_1.3-10.ipk</a><br />?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166304">
				<div class="post-metadata">
					<div class="post-num">Post #159</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						2 May 2012, 11:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>marcel_ms wrote:</cite><blockquote><p>download process is interrupted after some time.</p></blockquote></div><p>That&#039;s obviously not OK. I think it is a conntrack issue. Can you give me some extra info? Could you provide me the outcome of the following:</p><div class="codebox"><pre><code>lsmod | grep conntrack
route -n
ip route list table 3
ip rule list
ifconfig
cat /proc/net/nf_conntrack  (&lt;-- this command whilst downloading)</code></pre></div><div class="quotebox"><cite>marcel_ms wrote:</cite><blockquote><p>This is the latest version<br />The package:<br /><a href="http://213.136.13.52/mwan2_1.3-10.ipk">http://213.136.13.52/mwan2_1.3-10.ipk</a> ?</p></blockquote></div><p>Yes.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 2 May 2012, 12:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166370">
				<div class="post-metadata">
					<div class="post-num">Post #160</div>
					<div class="post-author">marcel_ms</div>
					<div class="post-datetime">
						3 May 2012, 00:44					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>lsmod | grep conntrack
route -n
ip route list table 3
ip rule list
ifconfig
cat /proc/net/nf_conntrack  (&lt;-- this command whilst downloading)</code></pre></div><div class="codebox"><pre><code>root@Gargoyle:~$ lsmod | grep conntrack
nf_conntrack_tftp       2400  1 nf_nat_tftp
nf_conntrack_irc        2512  1 nf_nat_irc
nf_conntrack_ftp        4640  1 nf_nat_ftp
xt_conntrack            2016  0 
nf_conntrack_ipv4       7376 11 iptable_nat,nf_nat
nf_defrag_ipv4           656  1 nf_conntrack_ipv4
nf_conntrack           37744 18 nf_nat_tftp,nf_conntrack_tftp,nf_nat_irc,nf_conntrack_irc,nf_nat_ftp,nf_conntrack_ftp,xt_layer7,ipt_MASQUERADE,iptable_nat,nf_nat,xt_CONNMARK,xt_helper,xt_conntrack,xt_connmark,xt_connbytes,xt_NOTRACK,xt_state,nf_conntrack_ipv4
x_tables                9296 44 ipt_SET,ipt_set,xt_IMQ,ipt_weburl,ipt_webmon,ipt_timerange,xt_iprange,xt_HL,xt_hl,xt_MARK,ipt_ECN,xt_CLASSIFY,xt_time,xt_tcpmss,xt_statistic,xt_mark,xt_length,ipt_ecn,xt_DSCP,xt_dscp,xt_string,xt_layer7,ipt_bandwidth,ipt_REDIRECT,ipt_NETMAP,ipt_MASQUERADE,iptable_nat,xt_CONNMARK,xt_recent,xt_helper,xt_conntrack,xt_connmark,xt_connbytes,xt_NOTRACK,xt_state,ipt_REJECT,xt_TCPMSS,ipt_LOG,xt_comment,xt_multiport,xt_mac,xt_limit,ip_tables,xt_tcpudp
root@Gargoyle:~$ routr\e   e -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.64.64.65     0.0.0.0         255.255.255.255 UH    0      0        0 3g-wan
10.64.64.64     0.0.0.0         255.255.255.255 UH    0      0        0 3g-wan2
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
0.0.0.0         10.64.64.65     0.0.0.0         UG    10     0        0 3g-wan
0.0.0.0         10.64.64.64     0.0.0.0         UG    20     0        0 3g-wan2
root@Gargoyle:~$ ip route list table 3
default  metric 1 
nexthop via 10.64.64.65  dev 3g-wan weight 1
nexthop via 10.64.64.64  dev 3g-wan2 weight 1
root@Gargoyle:~$ 
root@Gargoyle:~$ ip route list table 3         list  list  list  list u listl liste list list
0:from all lookup local 
192:from 37.209.134.99 fwmark 0x0/0x8000 lookup 1 
193:from 37.209.134.66 fwmark 0x0/0x8000 lookup 2 
256:from all fwmark 0x100/0xff00 lookup 1 
257:from all fwmark 0x200/0xff00 lookup 2 
258:from all fwmark 0x300/0xff00 lookup 3 
32766:from all lookup main 
32767:from all lookup default 
root@Gargoyle:~$ ifconfig
3g-wan    Link encap:Point-to-Point Protocol  
          inet addr:37.209.134.99  P-t-P:10.64.64.65  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:2417 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1771 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:2517589 (2.4 MiB)  TX bytes:108491 (105.9 KiB)

3g-wan2   Link encap:Point-to-Point Protocol  
          inet addr:37.209.134.66  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:861 errors:0 dropped:0 overruns:0 frame:0
          TX packets:972 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:266404 (260.1 KiB)  TX bytes:76384 (74.5 KiB)

br-lan    Link encap:Ethernet  HWaddr D8:5D:4C:E3:59:A8  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:3162 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3487 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:170939 (166.9 KiB)  TX bytes:2977489 (2.8 MiB)

eth0      Link encap:Ethernet  HWaddr D8:5D:4C:E3:59:A8  
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interrupt:5 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:515 errors:0 dropped:0 overruns:0 frame:0
          TX packets:515 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:40579 (39.6 KiB)  TX bytes:40579 (39.6 KiB)

mon.wlan0 Link encap:UNSPEC  HWaddr D8-5D-4C-E3-59-A8-00-00-00-00-00-00-00-00-00-00  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:6228 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32 
          RX bytes:1296011 (1.2 MiB)  TX bytes:0 (0.0 B)

wlan0     Link encap:Ethernet  HWaddr D8:5D:4C:E3:59:A8  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:3160 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3542 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32 
          RX bytes:215167 (210.1 KiB)  TX bytes:3057315 (2.9 MiB)</code></pre></div><p>downloading in progress</p><div class="codebox"><pre><code>root@Gargoyle:~$ cat /proc/net/nf_conntrack
ipv4     2 icmp     1 29 src=37.209.134.66 dst=8.8.8.8 type=8 code=0 id=8346 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.66 type=0 code=0 id=8346 packets=1 bytes=84 mark=512 use=2
ipv4     2 tcp      6 50 TIME_WAIT src=192.168.1.225 dst=78.24.191.177 sport=1550 dport=443 packets=59 bytes=42248 src=78.24.191.177 dst=37.209.134.66 sport=443 dport=1550 packets=60 bytes=42119 [ASSURED] mark=512 use=2
ipv4     2 udp      17 22 src=192.168.1.225 dst=192.168.1.1 sport=1564 dport=53 packets=1 bytes=59 src=192.168.1.1 dst=192.168.1.225 sport=53 dport=1564 packets=1 bytes=59 mark=0 use=2
ipv4     2 icmp     1 15 src=37.209.134.99 dst=8.8.8.8 type=8 code=0 id=8320 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.99 type=0 code=0 id=8320 packets=1 bytes=84 mark=768 use=2
ipv4     2 tcp      6 49 TIME_WAIT src=192.168.1.225 dst=192.168.1.1 sport=1415 dport=22 packets=1255 bytes=54204 src=192.168.1.1 dst=192.168.1.225 sport=22 dport=1415 packets=1242 bytes=172749 [ASSURED] mark=0 use=2
ipv4     2 icmp     1 21 src=37.209.134.99 dst=8.8.8.8 type=8 code=0 id=8334 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.99 type=0 code=0 id=8334 packets=1 bytes=84 mark=768 use=2
ipv4     2 icmp     1 10 src=37.209.134.99 dst=8.8.8.8 type=8 code=0 id=8312 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.99 type=0 code=0 id=8312 packets=1 bytes=84 mark=768 use=2
ipv4     2 udp      17 22 src=37.209.134.99 dst=193.41.112.14 sport=29629 dport=53 packets=1 bytes=59 src=193.41.112.14 dst=37.209.134.99 sport=53 dport=29629 packets=1 bytes=164 mark=768 use=2
ipv4     2 icmp     1 26 src=37.209.134.99 dst=8.8.8.8 type=8 code=0 id=8342 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.99 type=0 code=0 id=8342 packets=1 bytes=84 mark=768 use=2
ipv4     2 tcp      6 61 TIME_WAIT src=192.168.1.225 dst=192.168.1.1 sport=1500 dport=22 packets=522 bytes=31744 src=192.168.1.1 dst=192.168.1.225 sport=22 dport=1500 packets=435 bytes=73297 [ASSURED] mark=0 use=2
ipv4     2 tcp      6 50 TIME_WAIT src=192.168.1.225 dst=68.232.35.119 sport=1562 dport=80 packets=6 bytes=681 src=68.232.35.119 dst=37.209.134.66 sport=80 dport=1562 packets=5 bytes=873 [ASSURED] mark=512 use=2
ipv4     2 icmp     1 11 src=37.209.134.66 dst=8.8.8.8 type=8 code=0 id=8316 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.66 type=0 code=0 id=8316 packets=1 bytes=84 mark=512 use=2
ipv4     2 icmp     1 5 src=37.209.134.99 dst=8.8.8.8 type=8 code=0 id=8304 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.99 type=0 code=0 id=8304 packets=1 bytes=84 mark=768 use=2
ipv4     2 icmp     1 6 src=37.209.134.66 dst=8.8.8.8 type=8 code=0 id=8308 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.66 type=0 code=0 id=8308 packets=1 bytes=84 mark=512 use=2
ipv4     2 icmp     1 0 src=37.209.134.99 dst=8.8.8.8 type=8 code=0 id=8295 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.99 type=0 code=0 id=8295 packets=1 bytes=84 mark=768 use=2
ipv4     2 icmp     1 1 src=37.209.134.66 dst=8.8.8.8 type=8 code=0 id=8300 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.66 type=0 code=0 id=8300 packets=1 bytes=84 mark=512 use=2
ipv4     2 udp      17 22 src=192.168.1.225 dst=192.168.1.1 sport=1565 dport=53 packets=1 bytes=63 src=192.168.1.1 dst=192.168.1.225 sport=53 dport=1565 packets=1 bytes=63 mark=0 use=2
ipv4     2 tcp      6 50 TIME_WAIT src=192.168.1.225 dst=80.252.0.145 sport=1563 dport=80 packets=8 bytes=1073 src=80.252.0.145 dst=37.209.134.99 sport=80 dport=1563 packets=10 bytes=8950 [ASSURED] mark=768 use=2
ipv4     2 icmp     1 22 src=37.209.134.99 dst=8.8.8.8 type=8 code=0 id=8333 packets=3 bytes=252 src=8.8.8.8 dst=37.209.134.99 type=0 code=0 id=8333 packets=3 bytes=252 mark=768 use=2
ipv4     2 tcp      6 299 ESTABLISHED src=192.168.1.225 dst=192.168.1.1 sport=1414 dport=22 packets=1409 bytes=64052 src=192.168.1.1 dst=192.168.1.225 sport=22 dport=1414 packets=1356 bytes=196017 [ASSURED] mark=0 use=2
ipv4     2 tcp      6 599 ESTABLISHED src=192.168.1.225 dst=217.153.108.10 sport=1566 dport=80 packets=95 bytes=4190 src=217.153.108.10 dst=37.209.134.66 sport=80 dport=1566 packets=144 bytes=212055 [ASSURED] mark=512 use=2
ipv4     2 udp      17 22 src=37.209.134.99 dst=193.41.112.18 sport=29629 dport=53 packets=1 bytes=59 src=193.41.112.18 dst=37.209.134.99 sport=53 dport=29629 packets=1 bytes=164 mark=768 use=2
ipv4     2 icmp     1 21 src=37.209.134.66 dst=8.8.8.8 type=8 code=0 id=8338 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.66 type=0 code=0 id=8338 packets=1 bytes=84 mark=512 use=2
ipv4     2 icmp     1 16 src=37.209.134.66 dst=8.8.8.8 type=8 code=0 id=8324 packets=1 bytes=84 src=8.8.8.8 dst=37.209.134.66 type=0 code=0 id=8324 packets=1 bytes=84 mark=512 use=2
ipv4     2 udp      17 104 src=192.168.1.225 dst=192.168.1.1 sport=1087 dport=53 packets=2 bytes=124 src=192.168.1.1 dst=192.168.1.225 sport=53 dport=1087 packets=2 bytes=469 [ASSURED] mark=0 use=2
root@Gargoyle:~$</code></pre></div>											<p class="post-edited">(Last edited by <strong>marcel_ms</strong> on 3 May 2012, 00:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166398">
				<div class="post-metadata">
					<div class="post-num">Post #161</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 May 2012, 10:52					</div>
				</div>
				<div class="post-content content">
					<p>I maybe see the issue here. As the output &quot;cat /proc/net/nf_conntrack&quot; shows a MARK value of 768. This value is incorrect and should be 256...</p><p>Could you also paste me the output of &quot;iptables -L -t mangle -v -n&quot; please? Would it be possible if i gained access to your router to do some more troubleshooting.</p><p> Thank you!</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 3 May 2012, 20:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166433">
				<div class="post-metadata">
					<div class="post-num">Post #162</div>
					<div class="post-author">swoofz</div>
					<div class="post-datetime">
						3 May 2012, 17:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>swoofz wrote:</cite><blockquote><p>Please advise. Thank you.</p></blockquote></div><p>I think you have the same problem as nodoze. Start reading from post #95 to #105. As your post #150 suggests you not have a working connmark.</p><p>Good luck!</p></blockquote></div><p>Hi Adze,<br />I read all the posts and I decided to do fresh install of OpenWRT trunk in my MR3420. I now managed to get mwan2 works as expected, I can now access my NAS remotely using the IP Public on my Cable WAN.</p><p>The next question will be, how can I configure all outgoing connections from 192.168.0.0/24 to use 3GWAN and never connect using WAN. On the other side, incoming connections through WAN can only be replied using WAN not 3GWAN. Is this possible to achieve using mwan? Pls advise.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166444">
				<div class="post-metadata">
					<div class="post-num">Post #163</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 May 2012, 19:38					</div>
				</div>
				<div class="post-content content">
					<p>Nice to hear that it&#039;s working. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br /></p><div class="quotebox"><cite>swoofz wrote:</cite><blockquote><p>How can I configure all outgoing connections from 192.168.0.0/24 to use 3GWAN and never connect using WAN.</p></blockquote></div><p>Append the following lines to /etc/config/mwan2:<br /></p><div class="codebox"><pre><code>config &#039;rule&#039;
    option &#039;src_ip&#039; &#039;192.168.0.0/24&#039;
    list &#039;use_interface&#039; &#039;3GWAN&#039;</code></pre></div><p>Please note that mwan2 is not a firewall. If you want to be sure that traffic from 192.168.0.0/24 never traverses over WAN (e.g. when 3gWAN is down or incomming traffic from WAN), you should also add firewall rules.</p><div class="quotebox"><cite>swoofz wrote:</cite><blockquote><p>On the other side, incoming connections through WAN can only be replied using WAN not 3GWAN. Is this possible to achieve using mwan?</p></blockquote></div><p>This is automatic default behavior of mwan2 and is achieved by packet marking. No config needed, even with above configuration.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 3 May 2012, 20:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166450">
				<div class="post-metadata">
					<div class="post-num">Post #164</div>
					<div class="post-author">marcel_ms</div>
					<div class="post-datetime">
						3 May 2012, 20:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>I maybe see the issue here. As the output &quot;cat /proc/net/nf_conntrack&quot; shows a MARK value of 768. This value is incorrect and should be 256...</p><p>Could you also paste me the output of &quot;iptables -L -t mangle -v -n&quot; please? Would it be possible if i gained access to your router to do some more troubleshooting.</p><p> Thank you!</p></blockquote></div><div class="codebox"><pre><code>root@Gargoyle:~$ iptables -L -t mangle -v -n
Chain PREROUTING (policy ACCEPT 2835 packets, 1404K bytes)
 pkts bytes target     prot opt in     out     source               destination
72947   40M mwan2_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain INPUT (policy ACCEPT 630 packets, 61030 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 2205 packets, 1343K bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 612 packets, 62634 bytes)
 pkts bytes target     prot opt in     out     source               destination
 8103 1147K mwan2_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain POSTROUTING (policy ACCEPT 2798 packets, 1405K bytes)
 pkts bytes target     prot opt in     out     source               destination
72787   40M mwan2_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0
 2076  213K bw_egress  all  --  *      3g-wan  0.0.0.0/0            0.0.0.0/0

Chain bw_egress (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           bandwidth --id total1-upload-2-449 --type combined --current_bandwidth 0 --reset_interval 2 --reset_time 2 --intervals_to_save 449
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           match-set local_addr_set src bandwidth --id bdist1-upload-minute-15 --type individual_src --reset_interval minute --intervals_to_save 15
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           bandwidth --id total2-upload-minute-359 --type combined --current_bandwidth 1648 --reset_interval minute --intervals_to_save 359
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           match-set local_addr_set src bandwidth --id bdist2-upload-900-24 --type individual_src --reset_interval 900 --reset_time 900 --intervals_to_save 24
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           bandwidth --id total3-upload-180-479 --type combined --current_bandwidth 1648 --reset_interval 180 --reset_time 180 --intervals_to_save 479
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           match-set local_addr_set src bandwidth --id bdist3-upload-hour-24 --type individual_src --reset_interval hour --intervals_to_save 24
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           bandwidth --id total4-upload-7200-359 --type combined --current_bandwidth 212465 --reset_interval 7200 --reset_time 7200 --intervals_to_save 359
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           match-set local_addr_set src bandwidth --id bdist4-upload-day-31 --type individual_src --reset_interval day --intervals_to_save 31
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           bandwidth --id total5-upload-day-365 --type combined --current_bandwidth 212465 --reset_interval day --intervals_to_save 365
    0     0            all  --  *      *       0.0.0.0/0            0.0.0.0/0           match-set local_addr_set src bandwidth --id bdist5-upload-month-12 --type individual_src --reset_interval month --intervals_to_save 12

Chain mwan2_default (1 references)
 pkts bytes target     prot opt in     out     source               destination
    8  1500 MARK       all  --  *      *       0.0.0.0/0            127.0.0.0/8         MARK or 0x8000
    0     0 MARK       all  --  *      *       0.0.0.0/0            224.0.0.0/3         MARK or 0x8000
    0     0 MARK       all  --  *      *       0.0.0.0/0            10.64.64.65         MARK or 0x8000
    0     0 MARK       all  --  *      *       0.0.0.0/0            10.64.64.64         MARK or 0x8000
  277 31045 MARK       all  --  *      *       0.0.0.0/0            192.168.1.0/24      MARK or 0x8000
  570  294K MARK       all  --  *      *       0.0.0.0/0            37.209.130.131      MARK or 0x8000
 1063  963K MARK       all  --  *      *       0.0.0.0/0            37.209.134.132      MARK or 0x8000
  147  9609 MARK       all  --  *      *       0.0.0.0/0            192.168.1.1         MARK or 0x8000

Chain mwan2_post (1 references)
 pkts bytes target     prot opt in     out     source               destination
  619 60764 MARK       all  --  *      3g-wan2  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x200/0xff00
39221   36M MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x8000/0x8000 MARK and 0xffff7fff
72787   40M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff00

Chain mwan2_pre (2 references)
 pkts bytes target     prot opt in     out     source               destination
81050   41M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff00
  570  294K MARK       all  --  3g-wan2 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x200/0x7f00
81050   41M mwan2_default  all  --  *      *       0.0.0.0/0            0.0.0.0/0
 5484  385K mwan2_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00

Chain mwan2_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination
  553 41225 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x300/0xff00
root@Gargoyle:~$ route -n</code></pre></div><p>My provider does not allow access from internet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166453">
				<div class="post-metadata">
					<div class="post-num">Post #165</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 May 2012, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>For some reason only the rules for interface 3g-wan2 are there. Don&#039;t know why interface 3g-wan is missing... Is this always missing, also after rebooting?</p><p>Do you have the name of the interface correctly set in /etc/config/mwan2? Does it match with the interface name in /etc/config/network?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166458">
				<div class="post-metadata">
					<div class="post-num">Post #166</div>
					<div class="post-author">marcel_ms</div>
					<div class="post-datetime">
						3 May 2012, 21:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>For some reason only the rules for interface 3g-wan2 are there. Don&#039;t know why interface 3g-wan is missing... Is this always missing, also after rebooting?</p><p>Do you have the name of the interface correctly set in /etc/config/mwan2? Does it match with the interface name in /etc/config/network?</p></blockquote></div><p>3g-wan or 3g-wan2 is &quot;still on line&quot; a have script to check and restart connection</p><p>interface name is correct </p><br /><div class="codebox"><pre><code>May  3 20:39:02 Gargoyle user.notice root: mwan2: Lost 2 ping(s) on interface wan (3g-wan)
May  3 20:39:02 Gargoyle user.notice root: mwan2: Lost 2 ping(s) on interface wan2 (3g-wan2)
May  3 20:39:20 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan2 (3g-wan2)
May  3 20:39:20 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan (3g-wan)
May  3 20:39:38 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan2 (3g-wan2)
May  3 20:39:38 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan (3g-wan)
May  3 20:39:45 Gargoyle daemon.warn dnsmasq[2260]: possible DNS-rebind attack detected: ngrb0ts.co.cc
May  3 20:39:55 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan2 (3g-wan2)
May  3 20:39:56 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan (3g-wan)
May  3 20:40:19 Gargoyle user.notice root: mwan2: Lost 2 ping(s) on interface wan2 (3g-wan2)
May  3 20:40:39 Gargoyle daemon.warn dnsmasq[2260]: possible DNS-rebind attack detected: ngrb0ts.co.cc
May  3 20:40:40 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan (3g-wan)
May  3 20:40:51 Gargoyle user.notice root: mwan2: Lost 3 ping(s) on interface wan2 (3g-wan2)
May  3 20:40:53 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan (3g-wan)
May  3 20:41:25 Gargoyle daemon.warn dnsmasq[2260]: possible DNS-rebind attack detected: ngrb0ts.co.cc
May  3 20:41:27 Gargoyle user.notice root: mwan2: Lost 1 ping(s) on interface wan2 (3g-wan2)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166459">
				<div class="post-metadata">
					<div class="post-num">Post #167</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 May 2012, 22:03					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s a whole lot of pings lost, maybe the tracking values are to tight. You could try and remove them, to see if downloading remains stable. Try to remove the following lines in /etc/config/mwan2:</p><div class="codebox"><pre><code>option &#039;track_ip&#039; &#039;www.google.com&#039;
option &#039;count&#039; &#039;1&#039;
option &#039;timeout&#039; &#039;2&#039;
option &#039;interval&#039; &#039;5&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 3 May 2012, 22:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168157">
				<div class="post-metadata">
					<div class="post-num">Post #168</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						25 May 2012, 11:23					</div>
				</div>
				<div class="post-content content">
					<p>mwan2 has had an update, so it&#039;s now compatible with netifd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168164">
				<div class="post-metadata">
					<div class="post-num">Post #169</div>
					<div class="post-author">baojia</div>
					<div class="post-datetime">
						25 May 2012, 13:31					</div>
				</div>
				<div class="post-content content">
					<p>it is possible to load balancing with client mode and the wan port?<br />i mean a wired wan and a wireless wan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168166">
				<div class="post-metadata">
					<div class="post-num">Post #170</div>
					<div class="post-author">VeNoM</div>
					<div class="post-datetime">
						25 May 2012, 13:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>mwan2 has had an update, so it&#039;s now compatible with netifd.</p></blockquote></div><p>Perfect. Last night I tested with the latest trunk build the old version and did not work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168167">
				<div class="post-metadata">
					<div class="post-num">Post #171</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						25 May 2012, 13:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>baojia wrote:</cite><blockquote><p>it is possible to load balancing with client mode and the wan port?<br />i mean a wired wan and a wireless wan.</p></blockquote></div><p>Yes</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168751">
				<div class="post-metadata">
					<div class="post-num">Post #172</div>
					<div class="post-author">minimou</div>
					<div class="post-datetime">
						1 Jun 2012, 00:31					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>I haven&#039;t looked into mwan2 but it seems to be a good soft (hotplug, netifd support, qos-scripts compatibility) (just quickly read all the posts)<br />I&#039;m an active user of the multiwan package but i&#039;ve just discovered mwan2</p><p>First a small suggestion:<br />-the forum is not the only place, send a quick mail to openwrt-devel@lists.openwrt.org to annonce your soft</p><p>This said, a quick sumup on load balancing:<br />-packet based load balancing: for this either you have to make all the traffic go throught 1 point (rent a server, make vpn connection to it via each wan link .....) or own a small public ip subnet and an AS<br /><a href="http://en.wikipedia.org/wiki/Multihoming">http://en.wikipedia.org/wiki/Multihoming</a>.</p><p>-connection/session based load balancing: each new connection (new state for conntrack) is put on a wan. Once the connection is opened (related/established state for conntrack), the connection go through the same wan. It&#039;s the case of the multiwan package. It use &quot;statistic mode random probability 0.X&quot; in iptables to randomly assign a wan link for new connection.<br />Pro: If you make 10 connections to 1 IP, you can use the full capacity of your wans</p><p>-route based load balancing: it&#039;s the case of mwan2 (for the moment), when you start a connection, the route is cached for X sec so every new connections to the same IP will go through 1 wan<br />Pro:?<br />Con: The load balancing is worse, but with many clients it still help (you can&#039;t add the speed of your wan with multiple connections to 1 IP)</p><br /><p>As your script seems to have good &quot;dynamic&quot; handling (hotplug, netifd), and compatibility with qos-scripts ..., could you think of making it session based load balancing.<br />You already use connmark &amp; co so the argument of using less iptables than &quot;multiwan&quot; is not really valid</p><br /><p>In every case i hope i will find some time to test your work<br />Thanks for your job<br />Etienne</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168757">
				<div class="post-metadata">
					<div class="post-num">Post #173</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						1 Jun 2012, 01:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi Minimou,</p><br /><p>I completely agree with you. The thing that is missing is session based load balancing. I have thought of it, but haven&#039;t found a good solution yet...</p><p>The problem i have is this.</p><p>Route based load balancing should be active as default. This for compatibility reasons. Some websites rely on all connections comming from the same host as well as game servers e.a. Session based load balancing could be added as a per rule option.</p><p>But the difficult problem is how to do session based load balancing the easy way. In the past you could add equalize after the ip route statement and the kernel would take care of the distribution. But it seems this option got dropped due to instability issues. You could disable route caching, but this impacts routing performance.</p><p>You could go for, as you suggested, iptables probability factor. But than i have the problem how to deterime the factor, as mwan2 is started for each interface individually, it has no knowledge of other interfaces and therefor can&#039;t calculate the factor.</p><p>I&#039;m still working on this.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 1 Jun 2012, 01:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168883">
				<div class="post-metadata">
					<div class="post-num">Post #174</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						2 Jun 2012, 15:13					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><br /><p>As of version 1.4, mwan2 now supports session-based load sharing. Please read the mwan2 config file for more information. Also the config has changed a little. You now NEED to define at least one rule to make mwan2 work.</p><p>Below an example of a typical configuration.<br /></p><div class="codebox"><pre><code>#This is an mwan2 example config. In this config we define three load-balanced interfaces. Interface
#wan and wan2 are primary and load-balanced. Interface wan3 is a backup in case both wan and wan2 have
#failed. Load between wan and wan2 is shared on factor of 3:2. Both wan and wan2 have connection
#monitoring active. Interface wan3 is a last resort, so no connection monitoring there.

config &#039;interface&#039; &#039;wan&#039;
        option &#039;enabled&#039; &#039;1&#039;
        option &#039;metric&#039; &#039;1&#039;
        option &#039;weight&#039; &#039;3&#039;
        option &#039;track_ip&#039; &#039;8.8.8.8&#039;
        option &#039;count&#039; &#039;1&#039;
        option &#039;timeout&#039; &#039;2&#039;
        option &#039;interval&#039; &#039;5&#039;
        option &#039;down&#039; &#039;3&#039;
        option &#039;up&#039; &#039;8&#039;

config &#039;interface&#039; &#039;wan2&#039;
        option &#039;enabled&#039; &#039;1&#039;
        option &#039;metric&#039; &#039;1&#039;
        option &#039;weight&#039; &#039;2&#039;
        option &#039;track_ip&#039; &#039;8.8.4.4&#039;
        option &#039;count&#039; &#039;1&#039;
        option &#039;timeout&#039; &#039;2&#039;
        option &#039;interval&#039; &#039;5&#039;
        option &#039;down&#039; &#039;3&#039;
        option &#039;up&#039; &#039;8&#039;

config &#039;interface&#039; &#039;wan3&#039;
        option &#039;enabled&#039; &#039;1&#039;
        option &#039;metric&#039; &#039;2&#039;
        option &#039;weight&#039; &#039;1&#039;

#Below are the load balancing rules. These rules are matched in order, so if you define a matching
#rule, all following matches are ignored. By default mwan2 will load-balance nothing so to make mwan2
#work you have to define at least a default rule.

#Below an example to divert traffic to 192.168.0.0/16 to use the default routing table. This is used
#to reach subnets that are e.g. behind vpn tunnels or behind routers on the local lan.

config &#039;rule&#039;
        option &#039;dest_ip&#039; &#039;192.168.0.0/16&#039;
        list &#039;use_interface&#039; &#039;default&#039;

#Next an example rule which will send tcp traffic from 192.168.21.0 with destination port 563 only
#out on interface wan.

config &#039;rule&#039;
        option &#039;src_ip&#039; &#039;192.168.21.0/24&#039;
        option &#039;proto&#039; &#039;tcp&#039;
        option &#039;dest_port&#039; &#039;563&#039;
        list &#039;use_interface&#039; &#039;wan&#039;

#Next example will send tcp traffic from 192.168.21.0 with destination port 995 out on interfaces wan
#and wan2. This time we equalize the load on a session basis instead of route based.

config &#039;rule&#039;
        option &#039;src_ip&#039; &#039;192.168.21.0/24&#039;
        option &#039;proto&#039; &#039;tcp&#039;
        option &#039;dest_port&#039; &#039;995&#039;
        option &#039;equalize&#039; &#039;1&#039;
        list &#039;use_interface&#039; &#039;wan&#039;
        list &#039;use_interface&#039; &#039;wan2&#039;

#The last example is the default rule. All traffic that did not match before will be route balanced
#over all three interfaces. Option equalize is available, but to maintain compatibility we leave it
#out for now.

config &#039;rule&#039;
        option &#039;dest_ip&#039; &#039;0.0.0.0/0&#039;
        #option &#039;equalize&#039; &#039;1&#039;
        list &#039;use_interface&#039; &#039;wan&#039;
        list &#039;use_interface&#039; &#039;wan2&#039;
        list &#039;use_interface&#039; &#039;wan3&#039;</code></pre></div><p>Comments are welcome <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 2 Jun 2012, 15:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170178">
				<div class="post-metadata">
					<div class="post-num">Post #175</div>
					<div class="post-author">crisman</div>
					<div class="post-datetime">
						17 Jun 2012, 15:46					</div>
				</div>
				<div class="post-content content">
					<p>is it supposed to work with 2 wans having the same gateway address?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 7 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=33129&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=33129&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=33129&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=33129&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=33129&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=33129&amp;p=14.html">14</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>