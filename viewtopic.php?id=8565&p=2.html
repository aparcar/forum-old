<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Issue with SD card on WRT54GS v4  WHITE RUSSIAN (RC6)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=8565&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p39801">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">m4rc0</div>
					<div class="post-datetime">
						29 Dec 2006, 15:59					</div>
				</div>
				<div class="post-content content">
					<p>Do you have bad performance on disk I/O in general or with a certain program? </p><div class="quotebox"><cite>Kariota wrote:</cite><blockquote><p>I have installed with ipkg ( src backports&nbsp; <a href="http://downloads.openwrt.org/backports/rc6/">http://downloads.openwrt.org/backports/rc6/</a> ) only the package kmod-vfat and I have copy the mmc.o ( <a href="http://www.frontiernet.net/~beakmyn/openwrt/mmc/mmc%20-%20gpio2.tar">http://www.frontiernet.net/~beakmyn/ope … 0gpio2.tar</a> ) in /lib/modules/2.4.30/</p><p>The SD card is formated in FAT32</p><p>But it is not work fine&nbsp; :-( .Sometine the system work very slow when i use the SD card.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p39827">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">Kariota</div>
					<div class="post-datetime">
						29 Dec 2006, 19:02					</div>
				</div>
				<div class="post-content content">
					<p>Now It work good.&nbsp; ¿?</p><p>Thank you for help me, so I leave my city and I not can do more experiences with my WRT54 to my return.</p><p>Happy NEW YEAR</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p39831">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">m4rc0</div>
					<div class="post-datetime">
						29 Dec 2006, 19:50					</div>
				</div>
				<div class="post-content content">
					<p>What did you do to get it properly working??</p><p>happy new year to you too!!</p><br /><div class="quotebox"><cite>Kariota wrote:</cite><blockquote><p>Now It work good.&nbsp; ¿?</p><p>Thank you for help me, so I leave my city and I not can do more experiences with my WRT54 to my return.</p><p>Happy NEW YEAR</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40413">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						8 Jan 2007, 04:01					</div>
				</div>
				<div class="post-content content">
					<p>I wish I knew what Kariota did to get his working well. I am having the same issues. I have a WRT54GL v1.1 with SD mod, WhiteRussian 0.9 compiled myself with vfat &amp; msdos support. I have the mmc.o in /lib/modules.d/2.4.30 and the whole nine-yards. I have the card successfully mounted, edited ipkg.conf and /etc/profile to allow for installing packages to the mount point (/opt). However, when I go to install lighttpd it takes forever and a day to install the package. Then the power LED goes crazy and stays that way. Now I can&#039;t access the router through SSH or webif. Resulting in restoring everything back to factory settings. As soon as I do this, everything is speedy again; <strong>UNTIL</strong> I attempt to install packages to the SD card. Then the router bogs down and I have to repeat the process. I&#039;m at my wits end with this. Any help would be appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40422">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">gerd</div>
					<div class="post-datetime">
						8 Jan 2007, 10:52					</div>
				</div>
				<div class="post-content content">
					<p>see <a href="http://forum.openwrt.org/viewtopic.php?id=8867">http://forum.openwrt.org/viewtopic.php?id=8867</a><br />did you mask the gpio&#039;s you used in SD/MMC mod ?</p><p>Ciao Gerd</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40432">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						8 Jan 2007, 13:57					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, gerd. I&#039;ll try that when I get back to the router. I thought I masked the gpios, but I&#039;m not 100%. Do you know if this will fix the slow read/write problem I&#039;m having? I can deal with the power LED flashing, as long as I can use it. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40439">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">gerd</div>
					<div class="post-datetime">
						8 Jan 2007, 15:14					</div>
				</div>
				<div class="post-content content">
					<p>What means slow ?<br />i measured and it was about 166kbyte/s write speed<br />regarding gigabit ethernet this is slow :-)<br />BTW: read fix for power led.... it seems with gpiomask and insmod you mess something with the leds<br />i just uncommented last line in S99done and thats it... no mor flashing power led</p><p>Ciao Gerd</p>											<p class="post-edited">(Last edited by <strong>gerd</strong> on 8 Jan 2007, 15:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40478">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						8 Jan 2007, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, I should have been more clear. After getting everything set up (installing OpenWRT, adding mmc.o, mounting the SD card, and changing the libs other paths), access to the webif and my ssh connection are speedy (e.g.- navigating the menus in webif, or executing commands from the shell). However, when I use ipkg to install packages to the SD card the interface slows down. After installing a couple of packages, my connection drops off and I am unable to connect to the router for a long while (roughly an hour). This performance degradation happens as packages are installed. So, as I stated after a fresh flash (mounting, etc.) the interfaces are nice and quick. Then, I install... lighttpd. Downloading the package is quick, configuring the package is relatively quick, and installing the package is decently quick. Then I install... lighttpd-mod-status. This time the download takes a little longer, the package configuration is longer than previously, and installing takes quite a while. Then I install another package. Downloading the package now takes 15-20 seconds to initiate but downloading is quick, configuring the package seems to go on forever, and I don&#039;t know if it even installs because my ssh connection drops off with the error I reported earlier. Then, after the drop off I lose all contact with the router. I cannot ssh, telnet, or use the webif until I reboot the router. The packages are on the SD card when I check after the reboot, but I just don&#039;t think I have to manually reboot the router after installing a package. <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> This is only when installing packages to the SD card. Installing packages to the router itself has no problems (minus the small amount of storage <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ) I know the soldering and wiring are good b/c there are no problems with the card under dd-wrt. The card, btw, is a 1GB RiDATA SD card.</p>											<p class="post-edited">(Last edited by <strong>Liderc</strong> on 8 Jan 2007, 21:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40480">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						8 Jan 2007, 21:17					</div>
				</div>
				<div class="post-content content">
					<p>Is this with or without masking the GPIOs? Also, does anything unusual appear in the process list?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40483">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						8 Jan 2007, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>I haven&#039;t gotten back to the router itself yet to verify the gpio mask. But I&#039;ll check the process list when I get to it and let you guys know. Thanks for the help, btw.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40502">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						9 Jan 2007, 01:10					</div>
				</div>
				<div class="post-content content">
					<p>Well, gpiomask is not taking my values. I ran </p><div class="codebox"><pre><code> echo &#039;0x9c&#039; &gt; /proc/diag/gpiomask</code></pre></div><p>however gpiomask is still blank. <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> Also, I didn&#039;t notice anything odd in the process list. Maybe I&#039;m just used to everything being fast, so possibly if the card is writing at 166kbytes/second I&#039;m just being too impatient. How long does writing to the card normally take? The main thing that worries me is that my ssh connection (using puTTY) drops with the &quot;software ended connection&quot; error and I can&#039;t log back into the router for an <strong>EXTREMELY</strong> long time (45min. - 1 hour).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40527">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						9 Jan 2007, 14:04					</div>
				</div>
				<div class="post-content content">
					<p>D&#039;oh. Reread the gpiomask section and got gpiomask running. However, the Power LED still blinks upon first mmc access. Gerd, you say you uncommented the last line in S99done? In your other post you say that you&#039;ve removed the last line; set_state done. I&#039;ll try removing it later and see if that effects the blinking power LED. Haven&#039;t installed anything to the SD card yet, but I will later and inform you guys if the router bogs down again. Now I&#039;m just trying to get the crond mess sorted out from the webif² install so I can set up ez-ipupdate.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40534">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">m4rc0</div>
					<div class="post-datetime">
						9 Jan 2007, 17:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Liderc wrote:</cite><blockquote><p>D&#039;oh. Reread the gpiomask section and got gpiomask running.</p></blockquote></div><p>Can you tell me where that section is?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40539">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						9 Jan 2007, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>Yeah. It was just forum2006&#039;s 2nd post in his &quot;[HowTo] Compile the MMC driver (module) for the SD card mod&quot; post. This post here, actually:<br /><a href="http://forum.openwrt.org/viewtopic.php?pid=38699#p38699">http://forum.openwrt.org/viewtopic.php?pid=38699#p38699</a><br />I was just forgetting to create the init.d script to have </p><div class="codebox"><pre><code>echo &#039;0x9c&#039; &gt; /proc/diag/gpiomask</code></pre></div><p>run during reboots. My problem before was that I was using vi to view the actual gpiomask file (which I realize is locked <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" />). When I run cat now I get: </p><div class="codebox"><pre><code>root@Cerberos:~# cat /proc/diag/gpiomask
0x009c</code></pre></div><p>However, as I said earlier the power LED still goes crazy on first access to the mmc. <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40540">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">forum2006</div>
					<div class="post-datetime">
						9 Jan 2007, 18:15					</div>
				</div>
				<div class="post-content content">
					<p>@Liderc:</p><p>What happens if you use this:<br /></p><div class="codebox"><pre><code>echo &quot;9c&quot; &gt; /proc/diag/gpiomask</code></pre></div><p>Show me &#039;cat /proc/diag/gpiomask&#039;.</p>											<p class="post-edited">(Last edited by <strong>forum2006</strong> on 9 Jan 2007, 18:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40552">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						9 Jan 2007, 22:05					</div>
				</div>
				<div class="post-content content">
					<p>cat output is<br /></p><div class="codebox"><pre><code>root@Cerberos:~# echo &#039;9c&#039; &gt; /proc/diag/gpiomask
root@Cerberos:~# cat /proc/diag/gpiomask
0x0009</code></pre></div>											<p class="post-edited">(Last edited by <strong>Liderc</strong> on 9 Jan 2007, 22:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40576">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">gerd</div>
					<div class="post-datetime">
						10 Jan 2007, 08:49					</div>
				</div>
				<div class="post-content content">
					<p>Oh you are using the diagtest from nbd repos. :-)</p><p>because orig rc6 gives back an decimal, value. the test image a hex value</p><p>try echo &quot;0x9c&quot; &gt; /proc/diag/gpiomask</p><p>About my post for power LED</p><p>i was a little confused...<br />fact ist when you REMOVE or MAKE last line INACTIVE in S99done your power led stops blinking if you gpiomask before network (S40network) comes up..... (e.g. i have a S20mmc wher i do gpiomask / insmod / fsck / mount) when you do that after your network is up just make a &#039;wifi up&#039; and your power led stops blinking</p><p>Ciao Gerd</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40582">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">forum2006</div>
					<div class="post-datetime">
						10 Jan 2007, 12:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gerd wrote:</cite><blockquote><p>because orig rc6 gives back an decimal, value. the test image a hex value</p></blockquote></div><p>Ah, interesting. That explains something. Because I used a self-compiled post-RC6 WR for the tutorial...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40587">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						10 Jan 2007, 13:58					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, gerd. I&#039;ll give that a go here tonight. You say you added all of your commands:<br /></p><div class="codebox"><pre><code>echo &#039;0x9c&#039; &lt;-- (in my case) &gt; /proc/diag/gpiomask
mount /dev/mmc/disc0/part1 /opt &lt;-- (again, my instance)</code></pre></div><p>to your /etc/init.d/S20mmc script? Could you put up a print out of your S20mmc, I just want to compare. Also, not - completely related but I searched and couldn&#039;t find anything that made sense - with x-wrt webif^2 interface &amp; cron... I have crond started via the web interface. I placed my crontabs files in /var/spool/cron/crontabs (actually, /etc/spool/cron/crontabs/root) as the webif states. The webif shows the cron script but doesn&#039;t <strong>appear</strong> to execute. However, at terminal if I crontab -e and create a script and then crontab -l it shows the most recently created script (via crontab -e) but doesn&#039;t display the other. Which would I go with to have my script run properly. Or if anyone knows how to get the webif^2 to show the actual running script I&#039;d greatly appreciate it. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>											<p class="post-edited">(Last edited by <strong>Liderc</strong> on 10 Jan 2007, 14:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40597">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">gerd</div>
					<div class="post-datetime">
						10 Jan 2007, 16:04					</div>
				</div>
				<div class="post-content content">
					<p>Hi !</p><p>herr quick and dirty my s20mmc</p><p>#!/bin/sh<br />echo &quot;0xb8&quot; &gt; /proc/diag/gpiomask (i use gpio 3 4 5 and 7)<br />insmod mmc ( i guess you must insmod mmc after you masked gpio)<br />e2fsck /dev/mmc/disc0/part1<br />mount -t ext2 /dev/mmc/disc0/part1 /mnt/mmc</p><p>(for mmc.o you must be shure that it reflects you mmc-mod-setup&nbsp; :-)</p><p>I&#039;ll change it that i mount mmc somewhere in /tmp because i store data on it&nbsp; (rrd) and if after a powerloss mmc can not mounted again i&#039;ll fill my jffs and it &quot;bursts&quot;</p><p>i tried at the beginning and it worked</p><p>But it seems that when using reboot cmd the mmc is not clean unmounted because on every reboot log says &quot;filesystem is not clean&quot; (that&#039;s why i inserted e2fsck)</p><p>Ciao Gerd</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40601">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						10 Jan 2007, 16:59					</div>
				</div>
				<div class="post-content content">
					<p>Since you have insmod mmc in the S20mmc, do you have a script in /etc/modules.d/ for the mmc? I know it would be redundant to have that, but I&#039;m just curious. Also, if anyone has a clue on the cron situation, I&#039;d appreciate it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40627">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">gerd</div>
					<div class="post-datetime">
						11 Jan 2007, 09:33					</div>
				</div>
				<div class="post-content content">
					<p>no i don&#039;t have it in /etc/modules.d/ because if you insmod mmc before masking gpio you have the in some post before described effect.<br />i just have that setting and it seems to work (not tested under real enviroment, just testsetting on my desk transfering 50 MB to my 64 MB mmc card...)</p><p>Ciao Gerd</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40632">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">Liderc</div>
					<div class="post-datetime">
						11 Jan 2007, 13:39					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the info, gerd. After looking at my setup again I realized that the gpiomask was in fact running <span class="bbu">after</span> the mmc was started. I&#039;m going to try your method of loading gpiomask and mmc in the S20mmc to see if that helps. Thanks. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41195">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">Kariota</div>
					<div class="post-datetime">
						21 Jan 2007, 19:38					</div>
				</div>
				<div class="post-content content">
					<p>Hola de nuevo.<br />No entiendo inglés. Puedo intentar leerlo pero me cuesta mucho escribirlo. Como Liderc me ha escrito diciendo que habla español, me permito intervenir de nuevo:</p><p>Después de mis vacaciones, he vuelto a investigar mi WRT54 y veo que mi problema no fue solucionado. <br />En un primer momento, creí que la tarjeta SD iba bien, podía crear directorios, abrir ficheros y escribir en ellos perfectamente,&nbsp; pero al intentar instalar un paquete, el router se &quot;muere&quot;.</p><p>He intentado seguir los pasos descritos por Liderc y Gerc y lo único que he conseguido ha sido encender y apagar los leds a mi antojo :-)</p><p>Así es que lo siento, pero seguimos sin resolver el problema.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41210">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">m4rc0</div>
					<div class="post-datetime">
						21 Jan 2007, 22:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>m4rc0 wrote:</cite><blockquote><p>que? You might try english.... as I do not speak spanish.</p></blockquote></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=8565&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>