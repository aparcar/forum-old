<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SOLVED: Reboot doesn&#039;t work, poweroff doesn&#039;t work</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p297895">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						29 Oct 2015, 19:54					</div>
				</div>
				<div class="post-content content">
					<p>With a fresh (as of yesterday) installation of CC 15.05 to nand on a dockstar, ubifs format, reboot and poweroff have ceased working. I used reboot many times in getting to this point. The only new package I&#039;ve installed today is wpad-mini (which is working fine giving me wifi access).</p><p>What can be causing this?<br /></p><div class="codebox"><pre><code>BusyBox v1.23.2 (2015-07-24 20:06:02 CEST) built-in shell (ash)

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 CHAOS CALMER (15.05, r46767)
 -----------------------------------------------------
  * 1 1/2 oz Gin            Shake with a glassful
  * 1/4 oz Triple Sec       of broken ice and pour
  * 3/4 oz Lime Juice       unstrained into a goblet.
  * 1 1/2 oz Orange Juice
  * 1 tsp. Grenadine Syrup
 -----------------------------------------------------
root@dock86:/# ps
  PID USER       VSZ STAT COMMAND
    1 root      1372 S    /sbin/procd
    2 root         0 SW   [kthreadd]
    3 root         0 SW   [ksoftirqd/0]
    4 root         0 SW   [kworker/0:0]
    5 root         0 SW&lt;  [kworker/0:0H]
    6 root         0 SW   [kworker/u2:0]
    7 root         0 SW&lt;  [khelper]
    8 root         0 SW   [kworker/u2:1]
   15 root         0 SW&lt;  [writeback]
   17 root         0 SW&lt;  [bioset]
   19 root         0 SW&lt;  [kblockd]
   21 root         0 SW   [kswapd0]
   22 root         0 SW   [kworker/0:1]
   24 root         0 SW   [fsnotify_mark]
  749 root         0 SW&lt;  [deferwq]
  750 root         0 SW   [kworker/u2:2]
  770 root         0 SW   [kworker/0:2]
  772 root         0 SW   [ubi_bgt0d]
  776 root         0 SW   [ubifs_bgt0_0]
  822 root         0 SW   [ubifs_bgt0_1]
 1265 root       808 S    /sbin/ubusd
 1602 root      1340 S    /bin/ash --login
 2052 root         0 SW&lt;  [ipv6_addrconf]
 2251 root         0 SW&lt;  [cfg80211]
 2403 root       952 S    /sbin/logd -S 16
 2412 root      1460 S    /sbin/rpcd
 2444 root      1508 S    /sbin/netifd
 2491 root      1048 S    /usr/sbin/dropbear -F -P /var/run/dropbear.1.pid -p
 2529 root      1436 S    /usr/sbin/uhttpd -f -h /www -r dock86 -x /cgi-bin -u
 2632 root      2808 S    /usr/sbin/smbd -D
 2641 root      2868 S    /usr/sbin/nmbd -D
 2664 root      1380 S    {S95done} /bin/sh /etc/rc.common /etc/rc.d/S95done b
 2669 root      1332 S    sh /etc/rc.local
 2684 root      1592 S    /usr/sbin/wpa_supplicant -B -P /var/run/wpa_supplica
 2721 root       716 S    odhcp6c -s /lib/netifd/dhcpv6.script -t120 br-lan
 2726 root      9488 S    mjpg_streamer -i input_uvc.so -d /dev/video0 -f 5 -r
 2773 root      1336 R    ps
root@dock86:/# which reboot
/sbin/reboot
root@dock86:/# reboot
root@dock86:/# poweroff
root@dock86:/#</code></pre></div><p>Note at the end of the above:<br />root@dock86:/# reboot<br />root@dock86:/# poweroff<br />root@dock86:/#</p><p>What can be causing this?</p><p>New info: if I kill mjpg_streamer, the system immediately reboots (if the reboot command has been issued first). mjpg_streamer is started in /etc/rc.local</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 29 Oct 2015, 20:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p297897">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						29 Oct 2015, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>That last item was the clue. Putting &quot;&amp;&quot; at the end of the command in /etc/rc.local made it so that reboot works again.</p><p>Still don&#039;t know why it should be the case that you can enter a command at the prompt, and it won&#039;t execute (or complain). Other commands do work (e.g., ls, kill, nano).</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 29 Oct 2015, 20:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298203">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Lantis</div>
					<div class="post-datetime">
						1 Nov 2015, 13:41					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m having the same problem, but I don&#039;t have mjpg-streamer running. <br />Is there a way of determining which process is hanging the reboot?<br />I have nothing in rc.local.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298206">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						1 Nov 2015, 14:37					</div>
				</div>
				<div class="post-content content">
					<p>I saw what was happening when I killed mjpg-streamer and it immediately rebooted (having not done so after the prior reboot command).</p><p>You might try issuing the reboot, and then killing processes until you find the one which allows the reboot to occur. In case you don&#039;t know, &quot;ps&quot; will show the running processes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298223">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						1 Nov 2015, 16:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Lantis wrote:</cite><blockquote><p>I&#039;m having the same problem, but I don&#039;t have mjpg-streamer running..</p></blockquote></div><p>Same here with a Seagate GoFLEX Home and a PogoPlug Pro 02 where reboot just gets frozen and a power cycle is required.</p><p>lizby: Why do you need to install the wpad-mini package? Isn&#039;t the wpad-mini for a WiFi (minimal IEEE 802.1x/WPA Authenticator and Supplicant) which a DockStar doesn&#039;t have?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298318">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Lantis</div>
					<div class="post-datetime">
						2 Nov 2015, 03:11					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the tip. </p><p>nfsd was the culprit. Killing it started the reboot immediately. Now I just need to figure out why.</p><p> </p><div class="codebox"><pre><code>1963 root      1372 S    {S60nfsd} /bin/sh /etc/rc.common /etc/rc.d/S60nfsd b</code></pre></div>											<p class="post-edited">(Last edited by <strong>Lantis</strong> on 2 Nov 2015, 03:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298363">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						2 Nov 2015, 14:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p> ... lizby: Why do you need to install the wpad-mini package? Isn&#039;t the wpad-mini for a WiFi (minimal IEEE 802.1x/WPA Authenticator and Supplicant) which a DockStar doesn&#039;t have?</p></blockquote></div><p>Using a usb wifi device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298365">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						2 Nov 2015, 14:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>Same here with a Seagate GoFLEX Home and a PogoPlug Pro 02 where reboot just gets frozen and a power cycle is required.</p></blockquote></div><p>For me, reboot didn&#039;t freeze; the command prompt returned and I could execute other commands. Apparently, the reboot was queued waiting for something, and when I killed mjpg_streamer, it was executed. I don&#039;t think it had anything to do with mjpg_streamer itself, just the way it was run in rc.local with no &quot;&amp;&quot; at the end of the command.</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 2 Nov 2015, 14:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298386">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						2 Nov 2015, 17:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p> ... lizby: Why do you need to install the wpad-mini package? Isn&#039;t the wpad-mini for a WiFi (minimal IEEE 802.1x/WPA Authenticator and Supplicant) which a DockStar doesn&#039;t have?</p></blockquote></div><p>Using a usb wifi device.</p></blockquote></div><p>May I ask which USB WIFI dongle do you use for your DockStar? I have this <a href="http://www.aliexpress.com/item/USB-flash-disk-360-wifi-2-router-Ultra-mini-wireless-router-Computer-networking-share-devices/32346900789.html">USB flash disk 360 wifi 2 router</a> (without the internal storage). It is based on a MediaTek MT7601U chipset. When I plug it into my PogoPlug Pro 02, it gets recognized with its LED lights up bright and dmesg dump as shown below. Also, LuCI shows a Generic 802.11bgn Wireless Controller (radio1) interface. This is based on a self-built OpenWRT firmware.<br /></p><div class="codebox"><pre><code>[  231.320035] usb 1-1.4: new high-speed USB device number 4 using oxnas-ehci
[  231.533058] usb 1-1.4: New USB device found, idVendor=148f, idProduct=760b
[  231.625285] usb 1-1.4: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[  231.723310] usb 1-1.4: Product: 802.11 n WLAN
[  231.781665] usb 1-1.4: Manufacturer: MediaTek
[  231.840007] usb 1-1.4: SerialNumber: 1.0
[  231.990138] usb 1-1.4: reset high-speed USB device number 4 using oxnas-ehci
[  232.228625] mt7601u 1-1.4:1.0: ASIC revision: 76010001 MAC revision: 76010500
[  232.357460] mt7601u 1-1.4:1.0: Firmware Version: 0.1.00 Build: 7640 Build time: 201302052146____
[  232.937361] mt7601u 1-1.4:1.0: Warning: unsupported EEPROM version 0d
[  233.023744] mt7601u 1-1.4:1.0: EEPROM ver:0d fae:00
[  233.390448] ieee80211 phy1: Selected rate control algorithm &#039;minstrel_ht&#039;
[root@PogoPlug:/root 4%] #</code></pre></div><p>I used the same .config file and made the necessary changes for a Seagate GoFLEX Home (a Marvell Kirkwood platform). Unfortunately, this same USB WiFi dongle isn&#039;t detected (with its LED lights up dimmed) when I plugged into my Seagate GoFLEX Home when running with the newly built firmware. Its dmesg dump is as shown below.<br /></p><div class="codebox"><pre><code>[152997.628319] usb 1-1: USB disconnect, device number 3
[153003.624547] usb 1-1: new high-speed USB device number 4 using orion-ehci
[153003.786474] usb 1-1: New USB device found, idVendor=148f, idProduct=760b
[153003.793331] usb 1-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[153003.800645] usb 1-1: Product: 802.11 n WLAN
[153003.804959] usb 1-1: Manufacturer: MediaTek
[153003.809252] usb 1-1: SerialNumber: 1.0
[root@GoFLEX:/etc 67%] #</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298387">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						2 Nov 2015, 17:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><p>That last item was the clue. Putting &quot;&amp;&quot; at the end of the command in /etc/rc.local made it so that reboot works again.</p></blockquote></div><p>I tried your suggestion on my PogoPlug Pro 02 unit and it doesn&#039;t work, unfortunately. My /etc/rc.local file is a stock version and is shown below.<br /></p><div class="codebox"><pre><code># Put your custom commands here that should be executed once
# the system init finished. By default this file does nothing.

exit 0</code></pre></div><p>And, with an &#039;&amp;&#039; as shown below.<br /></p><div class="codebox"><pre><code># Put your custom commands here that should be executed once
# the system init finished. By default this file does nothing.

exit 0 &amp;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298397">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						2 Nov 2015, 18:33					</div>
				</div>
				<div class="post-content content">
					<p>The &quot;&amp;&quot; was at the end of my mjpg_streamer command, telling it to disconnect from its terminal, since mjpg_streamer isn&#039;t supposed to terminate itself.</p><p>It wasn&#039;t clear to me whether your &quot;reboot&quot; just hung, or whether it returned to the command prompt as mine did.</p><p>My dockstar is in the barn--I&#039;ll check on the wifi dongle this afternoon.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p298417">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						2 Nov 2015, 21:29					</div>
				</div>
				<div class="post-content content">
					<p>The usb wifi device is a TL-WN722N.</p><p>Here&#039;s how lsusb reports it:</p><p>Bus 001 Device 005: ID 0cf3:9271 Atheros Communications, Inc. AR9271 802.11n</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>