<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> VPN Client (windowz) needs to connect to a VPN Server at work</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p27621">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mikemcd</div>
					<div class="post-datetime">
						22 May 2006, 00:19					</div>
				</div>
				<div class="post-content content">
					<p>Greetings,</p><p>I just installed openwrt, works great, the only thing I have not been able to get working again is the ability to VPN into work. I&#039;m using windowz XP pro on a laptop issued to me by my employer. Its using the native VPN connection. I&#039;ve RTM on openvpn but it seems to discuss creating a tunnel from the router. Is there a config change I need to make to do VPN pass thru?</p><p>Regards </p><p>Mike McD.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p27627">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">LSU_guy</div>
					<div class="post-datetime">
						22 May 2006, 09:30					</div>
				</div>
				<div class="post-content content">
					<p>Look at openvpn.net - that will teach you how to do a openvpn server-client config.</p><p>Look at PPTP also - thats more straightforward to setup and requires no special software on your XP machine. Its also less secure.</p><p>If you want something quickly, contact me offline.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p27632">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Sonic</div>
					<div class="post-datetime">
						22 May 2006, 11:40					</div>
				</div>
				<div class="post-content content">
					<p>@mikemcd: Have you got already your vpn server ? or do you want make vpn server with OpenWrt ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p27671">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mikemcd</div>
					<div class="post-datetime">
						23 May 2006, 01:33					</div>
				</div>
				<div class="post-content content">
					<p>LSU_guy, looks like what I need is PPTP.&nbsp; Thanks </p><p>Sonic. no I&#039;m not looking to set up a server.. at least not at the moment. Looks like I&#039;m just needeing to pass throu a pptp tunnel.</p><br /><p>I&#039;ll let you know how It turns out..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p27674">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jruhe</div>
					<div class="post-datetime">
						23 May 2006, 01:58					</div>
				</div>
				<div class="post-content content">
					<p>I think, he wants to know how to etablish a pptp connection through the wrt, which is not possible. Which additional packaged must be installed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p27677">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Bartman007</div>
					<div class="post-datetime">
						23 May 2006, 02:05					</div>
				</div>
				<div class="post-content content">
					<p>He is saying that the company issued laptop is using a VPN client integrated into XP.&nbsp; This means it is either PPTP or IPsec (though he says looks like it is PPTP.)&nbsp; All he wants to know how to do is configure PPTP passthrough in OpenWRT so he can use the client installed on his laptop to establish a tunnel into his company&#039;s network.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p27808">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">chapelhill</div>
					<div class="post-datetime">
						24 May 2006, 22:05					</div>
				</div>
				<div class="post-content content">
					<p>PPTP was mode to work on this post.<br /><a href="http://forum.openwrt.org/viewtopic.php?id=5813">http://forum.openwrt.org/viewtopic.php?id=5813</a><br />But seeing as I was the author and do not really know what I am doing, please be aware it may not be secure. Not tested with ipsec either.<br />As I could find no information to solve the issue, hopefully others can benefit from my brute force problem solving with a good bit of luck!<br />Enjoy<br />Chapelhill</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p27834">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Sonic</div>
					<div class="post-datetime">
						25 May 2006, 14:37					</div>
				</div>
				<div class="post-content content">
					<p>I think you must configure the passthrough vpn with iptables. And allow forward GRE protocol imho ...<br />My lines but it&#039;s for pptp server on my OpenWrt ... perhaps you can adapt you<br /></p><div class="codebox"><pre><code>### Tunnel PPTP, VPN
iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 1723 -j ACCEPT
iptables        -A input_rule      -i $WAN -p tcp --dport 1723 -j ACCEPT
iptables        -A output_rule             -p 47               -j ACCEPT  # &lt;- Perhaps  just that lines can do the job ...
iptables        -A input_rule              -p 47               -j ACCEPT # &lt;- Perhaps  just that lines can do the job ...
iptables        -A forwarding_rule         -s 192.168.0.0/24 -d 192.168.0.0/24 -j ACCEPT
iptables        -A output_rule     -o ppp+ -s 192.168.0.0/24 -d 192.168.0.0/24 -j ACCEPT
iptables        -A input_rule      -i ppp+ -s 192.168.0.0/24 -d 192.168.0.0/24 -j ACCEPT
iptables        -A forwarding_rule -i ppp+ -o $WAN -j ACCEPT</code></pre></div>											<p class="post-edited">(Last edited by <strong>Sonic</strong> on 25 May 2006, 14:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p28317">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mikemcd</div>
					<div class="post-datetime">
						3 Jun 2006, 18:33					</div>
				</div>
				<div class="post-content content">
					<p>I tried this but&nbsp; got this warning. I suspect that I don&#039;t have $WAN defined</p><p>===========================<br />root@rt01:~# iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 1723 -j ACCEPT<br />Warning: wierd character in interface `-p&#039; (No aliases, :, ! or *).<br />Bad argument `tcp&#039;<br />Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.<br />root@rt01:~#<br />===========================</p><p>here is my current iptables List and Version </p><p>===========================<br />root@rt01:~# iptables --version<br />iptables v1.3.3<br />root@rt01:~# iptables -L<br />Chain INPUT (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp option=!2 flags:SYN/SYN<br />input_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;icmp --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;gre&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with tcp-reset<br />REJECT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with icmp-port-unreachable</p><p>Chain FORWARD (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />TCPMSS&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp flags:SYN,RST/SYN TCPMSS clamp to PMTU<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />forwarding_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere</p><p>Chain OUTPUT (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />output_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with tcp-reset<br />REJECT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with icmp-port-unreachable</p><p>Chain forward_vlan1 (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;huey<br />ACCEPT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;huey<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;huey<br />ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;huey<br />ACCEPT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;huey</p><p>Chain forwarding_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />forward_vlan1&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere</p><p>Chain input_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />input_vlan1&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere</p><p>Chain input_vlan1 (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain output_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />root@rt01:~#<br />==================================</p><p>I looks like I already have gre (-p 47 ) in my INPUT CHAIN.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p28319">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mikemcd</div>
					<div class="post-datetime">
						3 Jun 2006, 18:43					</div>
				</div>
				<div class="post-content content">
					<p>Ok I&#039;m a little slow.. the $WAN Var is set in /etc/init.d/S45firewall..</p><p>I&#039;ve added sonic&#039;s code between MASQ and USERRULES.. testing</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p28323">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">kultex</div>
					<div class="post-datetime">
						3 Jun 2006, 20:20					</div>
				</div>
				<div class="post-content content">
					<p>I am working on something simliar - to connect to Inertnet through VPN. My WLAN Provider wants MPPE MSChap v2 for connecting to the internet.</p><p>The best link I found is: <a href="http://pptpclient.sourceforge.net/routing.phtml">http://pptpclient.sourceforge.net/routing.phtml</a></p><p>@mikemcd&nbsp; &nbsp; &nbsp; &nbsp; this might be inttersting:&nbsp; <a href="http://wiki.openwrt.org/PPTPClientHowto">http://wiki.openwrt.org/PPTPClientHowto</a></p>											<p class="post-edited">(Last edited by <strong>kultex</strong> on 3 Jun 2006, 20:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p28329">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mikemcd</div>
					<div class="post-datetime">
						3 Jun 2006, 21:18					</div>
				</div>
				<div class="post-content content">
					<p>still no joy.. I&#039;ve loaded tcpdump and I&#039;m still working on it</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p28330">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">mikemcd</div>
					<div class="post-datetime">
						3 Jun 2006, 21:19					</div>
				</div>
				<div class="post-content content">
					<p>opps sorry... didn&#039;t see you there kultex... thanks I&#039;ll check out the link</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p29444">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">mikemcd</div>
					<div class="post-datetime">
						25 Jun 2006, 01:34					</div>
				</div>
				<div class="post-content content">
					<p>Well as it turns out this was not exactly an openwrt question as much as it was an iptables question. After consulting a co-worker, thanks Greg, I have a working config</p><p>#Send packets on port 1723 from VPN to the right machine<br />iptables -A FORWARD -p 47 -j ACCEPT<br />iptables -A FORWARD -d {corp VPN server}/32 -p tcp -j ACCEPT<br />iptables -A FORWARD -d {copr vpn server}/32 -j ACCEPT<br />iptables -A FORWARD -s {internal VPN client}/32 -p tcp -j ACCEPT<br />iptables -A FORWARD -s {internal VPN client}/32 -p 47 -j ACCEPT</p><p>iptables -t nat -A PREROUTING -s {copr vpn server}/32 -p tcp --dport 1723 -j DNAT --to {internal VPN client}<br />iptables -t nat -A PREROUTING -s {internal VPN client}/32 -p tcp --dport 1723 -j DNAT --to {copr vpn server}<br />iptables -t nat -A PREROUTING -s {copr vpn server}/32 -p 47 -j DNAT --to {internal VPN client}<br />iptables -t nat -A PREROUTING -s {internal VPN client}/32 -p 47 -j DNAT --to {copr vpn server}</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32654">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						24 Aug 2006, 00:44					</div>
				</div>
				<div class="post-content content">
					<p>For PPTP NAT try this package: <a href="http://downloads.openwrt.org/people/nbd/tmp/kmod-ipt-nat-pptp_2.4.30-brcm-3_mipsel.ipk">http://downloads.openwrt.org/people/nbd … mipsel.ipk</a>, reboot and let me know if it works.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51412">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">mikemcd</div>
					<div class="post-datetime">
						28 Jun 2007, 07:04					</div>
				</div>
				<div class="post-content content">
					<p>Very Sorry nbd for not following up. I did check back on this post for several weeks and had thought the issue closed. Yes I did come across your package but the thing is I&#039;m out of RAM. Since I did get the above configuration to work... well.. I now have another project in the pipe for which I may use mipsel. I&#039;ll report back in a few weeks.</p><p>--:)mcd(:--</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>