<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Forward Wifi through OpenVPN Interface</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p358027">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">e-horn</div>
					<div class="post-datetime">
						8 May 2017, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>Hello, I&#039;am an OpenWRT (Linux) Newbie and decided to buy an OpenWRT Router (Linksys WRT1200AC) cause I want to use a VPN-Service. I installed everything like it is described in the Tutorial on Providers-Page (nordvpn.com/de/tutorials/openwrt/openvpn/) and it works fine. Now my problem is the Wifi-Network. Something is wrong with my configuration I think because I cant connect to the internet via Wifi. <br />I created a new network Interface and configure the Firewall with Luci like the LAN Zone (like described inside the tutorial). But it doesnt work, I think i have to make some other changes but I doesn&#039;t have an idea which this could be. <br />I can connect to Wifi Network and get an ip-adres out of the &quot;right ip-pool&quot;...</p><p>Can anyone please help me</p><p>best regards,<br />ehorn</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358031">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						8 May 2017, 14:04					</div>
				</div>
				<div class="post-content content">
					<p>Hi, and welcome to the forums.</p><p>To make it easier for us to help you, please provide the following details from your current setup. You can get these details by opening an SSH connection to the router, and typing the commands listed below.</p><p>cat /etc/config/network<br />cat /etc/config/firewall<br />cat /etc/config/dhcp</p><p>The first one shows your network configuration as parsed by the UCI system. The second shows the firewall configuration. The last one shows your DHCP and DNS configuration.</p><p>Run each of these commands, and then copy the results of the commands into a new reply. When pasting the results, use the &#039;code&#039; formatting elements to maintain readability.</p><p>An example below:<br /></p><div class="codebox"><pre><code>root@OpenWRT:~# cat /etc/config/network

.... results ....</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358036">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">e-horn</div>
					<div class="post-datetime">
						8 May 2017, 16:21					</div>
				</div>
				<div class="post-content content">
					<p>Hello, here are the results</p><div class="codebox"><pre><code>network

config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd79:290a:e0e2::/48&#039;

config interface &#039;lan&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ip6assign &#039;60&#039;
        option ipaddr &#039;192.168.0.9&#039;
        option netmask &#039;255.255.0.0&#039;
        option _orig_ifname &#039;eth1 wlan0 wlan1&#039;
        option _orig_bridge &#039;true&#039;
        option ifname &#039;eth1&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth0&#039;
        option _orig_ifname &#039;eth0&#039;
        option _orig_bridge &#039;false&#039;
        option proto &#039;dhcp&#039;

config interface &#039;wan6&#039;
        option ifname &#039;eth0&#039;
        option proto &#039;dhcpv6&#039;

config switch
        option name &#039;switch0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0 1 2 3 6&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option ports &#039;4 5&#039;

config interface &#039;nordvpntun&#039;
        option proto &#039;none&#039;
        option ifname &#039;tun0&#039;

config interface &#039;wifi&#039;
        option proto &#039;static&#039;
        option netmask &#039;255.255.255.0&#039;
        option ipaddr &#039;192.168.0.110&#039;
        option gateway &#039;192.168.0.110&#039;
        option type &#039;bridge&#039;
        option _orig_ifname &#039;wlan0 wlan1&#039;
        option _orig_bridge &#039;true&#039;

config route
        option interface &#039;wan&#039;
        option target &#039;192.168.1.8&#039;
        option gateway &#039;192.168.1.2&#039;

config route
        option interface &#039;lan&#039;
        option target &#039;192.168.0.1&#039;
        option gateway &#039;192.168.0.9&#039;</code></pre></div><div class="codebox"><pre><code>firewall

config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;
        option network &#039;lan&#039;

config zone
        option name &#039;wan&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option network &#039;wan wan6&#039;

config rule
        option name &#039;Allow-DHCP-Renew&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;68&#039;
        option target &#039;ACCEPT&#039;
        option family &#039;ipv4&#039;

config rule
        option name &#039;Allow-Ping&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option icmp_type &#039;echo-request&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-IGMP&#039;
        option src &#039;wan&#039;
        option proto &#039;igmp&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-DHCPv6&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option src_ip &#039;fc00::/6&#039;
        option dest_ip &#039;fc00::/6&#039;
        option dest_port &#039;546&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-MLD&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option src_ip &#039;fe80::/10&#039;
        list icmp_type &#039;130/0&#039;
        list icmp_type &#039;131/0&#039;
        list icmp_type &#039;132/0&#039;
        list icmp_type &#039;143/0&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Input&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        list icmp_type &#039;router-solicitation&#039;
        list icmp_type &#039;neighbour-solicitation&#039;
        list icmp_type &#039;router-advertisement&#039;
        list icmp_type &#039;neighbour-advertisement&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Forward&#039;
        option src &#039;wan&#039;
        option dest &#039;*&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config include
        option path &#039;/etc/firewall.user&#039;

config rule
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option proto &#039;esp&#039;
        option target &#039;ACCEPT&#039;

config rule
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option dest_port &#039;500&#039;
        option proto &#039;udp&#039;
        option target &#039;ACCEPT&#039;

config zone
        option name &#039;vpnfirewall&#039;
        option input &#039;REJECT&#039;
        option output &#039;ACCEPT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;
        option forward &#039;ACCEPT&#039;
        option network &#039;nordvpntun&#039;

config zone
        option name &#039;wifi&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option network &#039;wifi&#039;
        option forward &#039;ACCEPT&#039;

config forwarding
        option dest &#039;vpnfirewall&#039;
        option src &#039;lan&#039;

config forwarding
        option dest &#039;lan&#039;
        option src &#039;vpnfirewall&#039;

config forwarding
        option dest &#039;lan&#039;
        option src &#039;wifi&#039;

config forwarding
        option dest &#039;vpnfirewall&#039;
        option src &#039;wifi&#039;

config forwarding
        option dest &#039;wifi&#039;
        option src &#039;lan&#039;

config forwarding
        option dest &#039;wifi&#039;
        option src &#039;vpnfirewall&#039;</code></pre></div><div class="codebox"><pre><code>dhcp

config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;
        option nonwildcard &#039;0&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option dhcpv6 &#039;server&#039;
        option ra &#039;server&#039;
        option ra_management &#039;1&#039;
        option ignore &#039;1&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;

config odhcpd &#039;odhcpd&#039;
        option maindhcp &#039;0&#039;
        option leasefile &#039;/tmp/hosts/odhcpd&#039;
        option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;

config dhcp &#039;wifi&#039;
        option interface &#039;wifi&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;

config host
        option name &#039;Server&#039;
        option mac &#039;4c:cc:6a:60:72:49&#039;
        option ip &#039;192.168.0.1&#039;

config host
        option name &#039;Rechner A&#039;
        option mac &#039;50:e5:49:b2:fa:4b&#039;
        option ip &#039;192.168.0.12&#039;

config host
        option name &#039;Rechner B&#039;
        option mac &#039;50:46:5D:8B:A6:E0&#039;
        option ip &#039;192.168.0.10&#039;

config host
        option name &#039;Drucker&#039;
        option mac &#039;00:15:99:A3:AE:7E&#039;
        option ip &#039;192.168.0.3&#039;

config host
        option name &#039;Internet-Radio&#039;
        option mac &#039;00:22:61:C0:D4:F4&#039;
        option ip &#039;192.168.0.6&#039;

config host
        option name &#039;Fernseher&#039;
        option mac &#039;E4:E0:C5:DA:A8:BC&#039;
        option ip &#039;192.168.0.7&#039;

config host
        option name &#039;Tablet&#039;
        option ip &#039;192.168.0.11&#039;
        option mac &#039;94:b1:0a:ca:5c:a8&#039;

config host
        option mac &#039;00:0C:E7:16:71:66&#039;
        option ip &#039;192.168.0.13&#039;
        option name &#039;Smartphone&#039;

config host
        option mac &#039;00:16:01:17:01:C2&#039;
        option ip &#039;192.168.0.8&#039;
        option name &#039;Kamera&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358081">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						9 May 2017, 08:03					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not entirely familiar with Linksys WRT1200AC device&#039;s hardware or with VPN-connections, but here are a few things which&nbsp; caught my eye in the configuration files. They may contribute to the inconsistent functionality, but I am by no means certain.</p><ul><li><p>The switch &amp; VLAN -configuration have no tagged ports, nor do they share a common port (usually all switched VLANs have one common port through which tagged traffic flows towards the CPU)</p></li><li><p>The LAN and WAN interfaces &#039;eth1&#039; and &#039;eth0&#039; seem strange. Did you intend &#039;eth0.1&#039; and &#039;eth0.0&#039; so as to refer to the VLANs defined in the switch configuration? Does your device have two distinct interfaces in addition to the switched circuit?</p></li><li><p>The &#039;bridge&#039; option for LAN and WLAN seems odd. Why do you want to bridge these two interfaces when they are using different IP address ranges?</p></li><li><p>The route configuration for WAN doesn&#039;t make sense to me since there are interface configurations using DHCP and DHCPv6</p></li></ul><p>Post the results of &#039;swconfig list&#039; so we can see what OpenWRT thinks about available switch devices onboard.</p><p>EDIT: After outputting the information about the switch devices, you can use &#039;swconfig dev &lt;device name&gt; show&#039; to print details about the ports inside the switch. Using this combination together with plugging a single RJ-45 cable that is connected to a PC to each of the ports in sequence will allow you to discover which switch ports map to which physical ports. This information may be useful later on if you want to setup a VLAN configuration. When discovering the ports, there should be one port which is always active even though no physical cable is connected. This is the CPU-facing port.</p><p>Another question regarding your network topology. Is it correct to assume that you have an upstream device connected to the physical yellow-colored WAN port of the Linksys device, and that this device is responsible for routing traffic from the Linksys device to the Internet at large?</p><p>Also, what kind of a VPN solution do you want to achieve? Do you want all traffic from the Linksys router to hop into the VPN tunnel, go out to the upstream device and through the Internet to the NordVPN destination, or do you want to have just specific addresses relayed to the VPN tunnel and others should be directed to the &quot;regular&quot; Internet?</p><p>EDIT: Also, I forgot to mention that &#039;cat /etc/config/wireless&#039; will display your Wi-Fi setup. Perhaps you can provide the output of this command as well?</p>											<p class="post-edited">(Last edited by <strong>Antek</strong> on 9 May 2017, 09:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358088">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						9 May 2017, 12:27					</div>
				</div>
				<div class="post-content content">
					<p>One more thing, which I didn&#039;t notice at first.</p><p>The IP ranges of the LAN and WLAN interfaces overlap, with the LAN being a 192.168.0.0 / 16 network and WLAN being a 192.168.0.0 / 24 network.</p><p>I&#039;m pretty sure this overlap will cause routing issues in the network. I think it might be a better idea to use different address ranges completely:</p><p>LAN IP: 192.168.0.9<br />LAN Netmask: 255.255.255.0</p><p>WLAN IP: 192.168.1.1<br />WLAN Netmask: 255.255.255.0</p><p>I took the liberty of changing the WLAN interface to be at address 1 instead of 110. You can change it back if you want to, but since you are providing a DHCP server through this interface to wireless clients, you should adjust the &#039;start&#039; number to be higher than &#039;110&#039; to prevent a wireless client from receiving the same address as the AP station.</p><p>I don&#039;t know how you&#039;d go about splitting one 255-address network to two 128-address networks in the OpenWRT configuration.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358092">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">cptdondo</div>
					<div class="post-datetime">
						9 May 2017, 14:28					</div>
				</div>
				<div class="post-content content">
					<p>The easiest way is to use a tap interface and add it to the bridge.</p><p>If you have to use tun, then you should look into iproute2 and use advanced routing rules to route through the tun interface.</p><p>One caveat:&nbsp; if the tun interface and your lan don&#039;t use the same subnet, then broadcasts won&#039;t work.</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;auth&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ifname &#039;eth1.4 tap0 tap1&#039;
    option ipaddr &#039;192.168.4.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option broadcast &#039;255.255.255.0&#039;
    option metric &#039;4&#039;
#    option mtu &#039;1492&#039;

config interface &#039;open&#039;
    option proto &#039;static&#039;
    option ifname &#039;eth1.5&#039;
    option ipaddr &#039;192.168.5.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option broadcast &#039;255.255.255.0&#039;
    option metric &#039;5&#039;
#    option mtu &#039;1492&#039;

config interface &#039;guest&#039;
    option proto &#039;static&#039;
    option ifname &#039;eth1.6&#039;
    option ipaddr &#039;192.168.6.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option broadcast &#039;255.255.255.0&#039;
    option metric &#039;6&#039;
#    option mtu &#039;1492&#039;

config interface &#039;dmz&#039;
    option proto &#039;static&#039;
    option ifname &#039;eth2.3&#039;
    option ipaddr &#039;192.168.3.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option mtu &#039;1492&#039;

config interface &#039;dsl&#039;
    option ifname &#039;eth0.8&#039;
    option proto &#039;pppoe&#039;
    option defaultroute &#039;0&#039;
    option peerdns &#039;0&#039;
    option metric &#039;1&#039;
    option enabled &#039;1&#039;

config interface &#039;cable&#039;
    option ifname &#039;eth0.9&#039;
    option proto &#039;dhcp&#039;
    list dns &#039;8.8.8.8&#039;
    list dns &#039;8.8.4.4&#039;
    option peerdns &#039;0&#039;
    option metric &#039;0&#039;

config interface &#039;wired&#039;
    option proto &#039;static&#039;
    option ifname &#039;eth1.7&#039;
    option ipaddr &#039;192.168.7.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option broadcast &#039;255.255.255.0&#039;
    option metric &#039;7&#039;
#    option mtu &#039;1492&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>cptdondo</strong> on 9 May 2017, 14:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358119">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">e-horn</div>
					<div class="post-datetime">
						9 May 2017, 22:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>I&#039;m not entirely familiar with Linksys WRT1200AC device&#039;s hardware or with VPN-connections, but here are a few things which&nbsp; caught my eye in the configuration files. They may contribute to the inconsistent functionality, but I am by no means certain.</p><ul><li><p>The switch &amp; VLAN -configuration have no tagged ports, nor do they share a common port (usually all switched VLANs have one common port through which tagged traffic flows towards the CPU)</p></li><li><p>The LAN and WAN interfaces &#039;eth1&#039; and &#039;eth0&#039; seem strange. Did you intend &#039;eth0.1&#039; and &#039;eth0.0&#039; so as to refer to the VLANs defined in the switch configuration? Does your device have two distinct interfaces in addition to the switched circuit?</p></li><li><p>The &#039;bridge&#039; option for LAN and WLAN seems odd. Why do you want to bridge these two interfaces when they are using different IP address ranges?</p></li><li><p>The route configuration for WAN doesn&#039;t make sense to me since there are interface configurations using DHCP and DHCPv6</p></li></ul><p>Post the results of &#039;swconfig list&#039; so we can see what OpenWRT thinks about available switch devices onboard.</p><p>EDIT: After outputting the information about the switch devices, you can use &#039;swconfig dev &lt;device name&gt; show&#039; to print details about the ports inside the switch. Using this combination together with plugging a single RJ-45 cable that is connected to a PC to each of the ports in sequence will allow you to discover which switch ports map to which physical ports. This information may be useful later on if you want to setup a VLAN configuration. When discovering the ports, there should be one port which is always active even though no physical cable is connected. This is the CPU-facing port.</p><p>Another question regarding your network topology. Is it correct to assume that you have an upstream device connected to the physical yellow-colored WAN port of the Linksys device, and that this device is responsible for routing traffic from the Linksys device to the Internet at large?</p><p>Also, what kind of a VPN solution do you want to achieve? Do you want all traffic from the Linksys router to hop into the VPN tunnel, go out to the upstream device and through the Internet to the NordVPN destination, or do you want to have just specific addresses relayed to the VPN tunnel and others should be directed to the &quot;regular&quot; Internet?</p><p>EDIT: Also, I forgot to mention that &#039;cat /etc/config/wireless&#039; will display your Wi-Fi setup. Perhaps you can provide the output of this command as well?</p></blockquote></div><br /><p>Hello, thanks for your answer. I&#039;m sorry but my english isn&#039;t very good so its a little hard for me to understand everything. I wil try it <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>First here is a picture of my wanted network-solution: <br />***://imagizer.imageshack.com/img923/4074/pk67zZ.jpg</p><p>Now I wil try to answer your questions<br />* I dont configure the switch and VLAN options. Is this necessary?<br />* I play around with the options (netmask...) so i could be that there are some conflicts or wrong configuration (like overlapping IP-Ranges)</p><p>I want to have a network like the picture above. All Network behind the VPN-Router should go through the VPN. Only the Server should have direkt internet-access. The server is behind another router (the first router) and have another IP-Range so in my opinion this should work. My problem is that i want to have access from all clients behind the vpn-router to the Server and the server should have access to the clients. I thougt i can reach this with another subnet-mask but it doesnt work. I think there should also be some ports forwared...<br />And the other problem is the Wifi I described above. Now you know the complete plan <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>The other points you answered I have to read twice and will post here tomorow...</p>											<p class="post-edited">(Last edited by <strong>e-horn</strong> on 9 May 2017, 22:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358141">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						10 May 2017, 10:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>First here is a picture of my wanted network-solution:</p></blockquote></div><p>This picture makes things a bit more clear. What firmware is the VDSL Router using? OpenWRT, or Telekom&#039;s own firmware?</p><div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>Now I wil try to answer your questions<br />* I dont configure the switch and VLAN options. Is this necessary?</p></blockquote></div><p>Based on your picture, the switch and VLAN configurations are not needed on the Linksys device. A VLAN configuration would allow you to isolate the four blue Ethernet ports behind the Linksys router from each other, so that port #1 has network #1, port #2 has network #2 and so on. Your picture has only the physical &#039;switch&#039; device drawn to it, and the PCs and the printer in a single network behind this switch, hence no VLAN configuration is needed.</p><div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>All Network behind the VPN-Router should go through the VPN. Only the Server should have direkt internet-access. The server is behind another router (the first router) and have another IP-Range so in my opinion this should work. My problem is that i want to have access from all clients behind the vpn-router to the Server and the server should have access to the clients.</p></blockquote></div><p>Since your server is visible to the Internet and visible to the clients behind the VPN-router, then what you need is a DMZ-configuration. The &#039;server&#039; computer is placed on a DMZ (de-militarized zone) that allows incoming traffic to and reply-packets out from the machines inside the zone, but prevents new connections from machines inside the DMZ towards the network behind the VPN-router. It is a layer of security that protects your client devices in case the &#039;server&#039; computer in the picture is breached by an attacker.</p><p>A simple subnet configuration will not be enough. You&#039;ll need routing and specific firewalling rules at least on the Linksys device, so traffic flows are correct. I might be able to help you in some bits, but most of the configuration is out of my league.</p><p>EDIT: For added security, you could consider creating a VLAN configuration on the VDSL router. Depending on what firmware the device is running, this may be a simple endeavor, or a bit harder.</p><p>For details on how a DMZ could be done in OpenWRT, see the article &quot;Setting up a DMZ&quot; in the OpenWRT Wiki. If you cannot create a DMZ with the VDSL router, then another alternative is to create a DMZ configuration on the Linksys device and make it your primary router, then attach the VDSL router directly to the WAN-port of the Linksys device. Note that this kind of a setup will place a heavy burden on the Linksys device so it&#039;s CPU, memory etc. specs need to be top notch.</p>											<p class="post-edited">(Last edited by <strong>Antek</strong> on 10 May 2017, 12:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358170">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">e-horn</div>
					<div class="post-datetime">
						10 May 2017, 21:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Antek wrote:</cite><blockquote><p> What firmware is the VDSL Router using? OpenWRT, or Telekom&#039;s own firmware?</p></blockquote></div><p>The original Telekom Firmware (I think it isnt possible to install OpenWRT at the router)</p><p>I tried to setup my network at least three times and everytime something doesn&#039;t work right. So I thought that I can set up my network piece by piece. </p><p>In my imagination I should first start to configure the VPN-Router. (please reply if i am wrong)</p><p>the firmware of the Router is:<br /></p><div class="codebox"><pre><code>Hostname    OpenWrt
Model    Linksys WRT1200AC
Firmware Version    OpenWrt Designated Driver r49377 / LuCI Master (git-16.151.26687-f4af114)
Kernel Version    4.4.7</code></pre></div><p>I set up a working vpn connection for the LAN-interface (like written above) with some firewall entries.<br />Now i will set up the WIFI-interface to go through the vpn-interface (-tunnel) too</p><p>...and if this works I will take a look on configuring the DMZ or how to solve the &quot;Server-Issue&quot;</p><p>@Antek you wrote that &quot;the &#039;bridge&#039; option for LAN and WLAN seems odd.&quot; What did you mean?<br />I configure the router via LUCI and there are no bridge-mode active?!</p><p>You also said &quot;The route configuration for WAN doesn&#039;t make sense to me since there are interface configurations using DHCP and DHCPv6&quot;<br />Can you explain me what you mean here?</p><br /><p>here is my WIFI-setup, hope it will help<br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
        option type &#039;mac80211&#039;
        option hwmode &#039;11a&#039;
        option path &#039;soc/soc:pcie-controller/pci0000:00/0000:00:01.0/0000:01:00.0&#039;
        option htmode &#039;VHT80&#039;
        option country &#039;DE&#039;
        option txpower &#039;20&#039;
        option channel &#039;auto&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option mode &#039;ap&#039;
        option key &#039;***&#039;
        option ssid &#039;(VPN 5GHz)&#039;
        option encryption &#039;psk-mixed&#039;
        option network &#039;wifi&#039;

config wifi-device &#039;radio1&#039;
        option type &#039;mac80211&#039;
        option channel &#039;11&#039;
        option hwmode &#039;11g&#039;
        option path &#039;soc/soc:pcie-controller/pci0000:00/0000:00:02.0/0000:02:00.0&#039;
        option htmode &#039;HT20&#039;
        option country &#039;DE&#039;
        option txpower &#039;20&#039;

config wifi-iface
        option device &#039;radio1&#039;
        option mode &#039;ap&#039;
        option macaddr &#039;62:38:e0:d9:2e:f6&#039;
        option ssid &#039;(VPN 2,4GHz)&#039;
        option encryption &#039;psk-mixed&#039;
        option key &#039;***&#039;
        option network &#039;wifi&#039;
        option disabled &#039;1&#039;</code></pre></div><p>thanks for your time and patience with me <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358198">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						11 May 2017, 14:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>I tried to setup my network at least three times and everytime something doesn&#039;t work right. So I thought that I can set up my network piece by piece.</p><p>In my imagination I should first start to configure the VPN-Router. (please reply if i am wrong)</p></blockquote></div><p>The idea of building network piece by piece is correct, but I think you are starting from the wrong end. To build this kind of a network, I would start from the VDSL router, with a single laptop connected to it over a regular LAN cable.</p><p>The VDSL router&#039;s WAN settings come from your ISP. Whatever they are, I do not know.</p><p>The VDSL router&#039;s LAN settings are static IP 192.168.1.1 with Netmask 255.255.255.0. DHCP server is <strong>enabled</strong> on the LAN side and address range is from 192.168.1.10 to 192.168.1.20 for a maximum of 10 clients. I do not know how to configure a Telekom router, so you&#039;re on your own to get these settings rights.</p><p>Now test that you can reach the Internet from the laptop that is connected to a LAN port on the VDSL router. If you can&#039;t reach the Internet at this point, go back to start and check your settings.</p><p>----</p><p>Now we move on to the OpenWRT side. Connect the laptop to the OpenWRT router&#039;s LAN port. Ensure you can access LuCI on the OpenWRT from your laptop. Set the administrative password if not set yet, then disable the OpenVPN service in System -&gt; Startup for now. First we need to get the general network working, then we build the VPN tunnel and other fancies on top of it.</p><p><strong>DISCLAIMER:</strong><br />The configuration files below are my own making and have not been tested in your specific situation. They may work, but they may also brick your device completely, making it inaccessible. Check and double-check the files carefully and before you save them, ensure you have some means of restoring the previous configuration if things go south. I will not take responsibility, nor will I compensate for any damages caused. You have thus been warned.</p><p>The baseline of these configurations comes from the files you posted earlier. I have removed everything that I thought unnecessary. Note that all # comments written into the files will be removed if you use LuCI or the &#039;uci&#039; command-line client to alter settings. Keep this in mind later on.</p><p>/etc/config/network:</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname          &#039;lo&#039;
        option proto           &#039;static&#039;
        option ipaddr          &#039;127.0.0.1&#039;
        option netmask         &#039;255.0.0.0&#039;

config globals &#039;globals&#039;

config interface &#039;wan&#039;
        option ifname          &#039;eth0&#039;
        option proto           &#039;dhcp&#039;  # We get the WAN IP from the VDSL Router - this may change later on
        option defaultroute    &#039;1&#039;     # This will create a default route for all traffic not intended to local LAN or WLAN clients

config interface &#039;lan&#039;
        option ifname          &#039;eth1&#039;
        option proto           &#039;static&#039;
        option ipaddr          &#039;192.168.2.1&#039;
        option netmask         &#039;255.255.255.0&#039;
        option ipv6            &#039;0&#039;       # We don&#039;t want IPv6 for now; we keep things simple
        option type            &#039;bridge&#039;  # We will bind to this network directly from the wireless config file</code></pre></div><p>As you can see, the switch option has completely been eradicated from this file. </p><p>I do not know if the Linksys device requires the switch configuration section in order for the Ethernet ports to work. If the switch configuration is required, then omitting it will cause the OpenWRT device to become inaccessible through the LAN ports. You should still be able to connect to it through WLAN, so all is not lost.</p><p>/etc/config/wireless:</p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
        option type       &#039;mac80211&#039;
        option hwmode     &#039;11a&#039;
        option path       &#039;soc/soc:pcie-controller/pci0000:00/0000:00:01.0/0000:01:00.0&#039;
        option htmode     &#039;VHT80&#039;
        option country    &#039;DE&#039;
        option txpower    &#039;20&#039;
        option channel    &#039;auto&#039;

config wifi-iface
        option device     &#039;radio0&#039;
        option mode       &#039;ap&#039;
        option encryption &#039;psk-mixed&#039;
        option key        &#039;***&#039;          # Change this
        option ssid       &#039;WLAN 5GHz&#039;    # Change this if needed. There&#039;s no VPN yet, though
        option network    &#039;lan&#039;          # Adds this interface to the LAN network, creating a two-way bridge (LAN &amp; 5 GHz)

config wifi-device &#039;radio1&#039;
        option type       &#039;mac80211&#039;
        option channel    &#039;11&#039;
        option hwmode     &#039;11g&#039;
        option path       &#039;soc/soc:pcie-controller/pci0000:00/0000:00:02.0/0000:02:00.0&#039;
        option htmode     &#039;HT20&#039;
        option country    &#039;DE&#039;
        option txpower    &#039;20&#039;
        option disabled   &#039;1&#039;            # Toggle to &#039;0&#039; to enable this radio device

config wifi-iface
        option device     &#039;radio1&#039;
        option mode       &#039;ap&#039;
        option macaddr    &#039;62:38:e0:d9:2e:f6&#039;        
        option encryption &#039;psk-mixed&#039;    
        option key        &#039;***&#039;          # Change this
        option ssid       &#039;WLAN 2,4GHz&#039;  # Change this if needed
        option network    &#039;lan&#039;          # Adds this interface to the LAN network, creating a three-way bridge (LAN, 5 GHz and 2.4 GHz)
        option disabled   &#039;1&#039;            # Toggle to &#039;0&#039; to enable this AP station on the radio device</code></pre></div><p>As you can see, we are bridging the LAN and the two WLAN networks together, and all the clients will be served by a single DHCP server residing in the OpenWRT router. Devices in the LAN and WLAN networks will be able to connect to each other right away.</p><p>/etc/config/dhcp:</p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded      &#039;1&#039;
        option boguspriv         &#039;1&#039;
        option localise_queries  &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost  &#039;0&#039;
        option local             &#039;/lan/&#039;
        option domain            &#039;lan&#039;
        option expandhosts       &#039;1&#039;
        option readethers        &#039;1&#039;
        option leasefile         &#039;/tmp/dhcp.leases&#039;
        option resolvfile        &#039;/tmp/resolv.conf.auto&#039;
        option localservice      &#039;1&#039;
        option nonwildcard       &#039;0&#039;

config dhcp &#039;dhcp-lan&#039;
        option interface         &#039;lan&#039;
        option dhcpv6            &#039;disabled&#039;
        option ra                &#039;disabled&#039;
        option ignore            &#039;0&#039;
        option start             &#039;10&#039;
        option limit             &#039;150&#039;
        option leasetime         &#039;12h&#039;

config dhcp &#039;dhcp-wan&#039;
        option interface         &#039;wan&#039;
        option ignore            &#039;1&#039;</code></pre></div><p>We enable DHCPv4 server on the LAN interface and disable it on the WAN.</p><p>/etc/config/firewall:</p><div class="codebox"><pre><code>config defaults
        option syn_flood   &#039;1&#039;
        option input       &#039;REJECT&#039;   # By default, all traffic in all zones is rejected so as to protect your networks
        option output      &#039;REJECT&#039;
        option forward     &#039;REJECT&#039;

config zone
        option name      &#039;zone-lan&#039;
        option network   &#039;lan&#039;
        option input     &#039;ACCEPT&#039;   # Traffic coming to this router from interfaces in this zone is allowed
        option output    &#039;ACCEPT&#039;   # Traffic going from this router through interfaces in this zone is allowed
        option forward   &#039;ACCEPT&#039;   # Traffic forwarded between interfaces in this zone is allowed
        option family    &#039;ipv4&#039;

config zone
        option name      &#039;zone-wan&#039;
        option network   &#039;wan&#039;
        option output    &#039;ACCEPT&#039;   # Masqueraded traffic will generate new packets, so we need to allow this
        option masq      &#039;1&#039;        # This option, together with forwarding configs below, will create the necessary rules for return traffic to work
        option mtu_fix   &#039;1&#039;
        option family    &#039;ipv4&#039;
    
# We need to allow incoming DHCPv4 renew, since the WAN interface is using DHCP
# Otherwise it will not get a new IP when the lease-time expires
config rule
        option name      &#039;Allow-DHCPv4-Renew&#039;
        option src       &#039;wan&#039;
        option proto     &#039;udp&#039;
        option dest_port &#039;68&#039;
        option target    &#039;ACCEPT&#039;
        option family    &#039;ipv4&#039;

# Remove this section if you do not want to allow pinging the router from WAN
config rule
        option name      &#039;Allow-Ping&#039;
        option src       &#039;wan&#039;
        option proto     &#039;icmp&#039;
        option icmp_type &#039;echo-request&#039;        
        option target    &#039;ACCEPT&#039;
        option family    &#039;ipv4&#039;

# Remove this section if you do not want to allow IGMP traffic to the router from WAN
config rule
        option name      &#039;Allow-IGMP&#039;
        option src       &#039;wan&#039;
        option proto     &#039;igmp&#039;
        option family    &#039;ipv4&#039;
        option target    &#039;ACCEPT&#039;

config include
        option path &#039;/etc/firewall.user&#039;

# Allow LAN &amp; WLAN traffic to forward to WAN (and to Internet). 
# Return traffic works automatically due to masquerading
config forwarding
        option src    &#039;lan&#039;
        option dest   &#039;wan&#039;
        option family &#039;ipv4&#039;</code></pre></div><p>This configuration <em>should</em> work, assuming I have not made mistakes or typos in the files. Check it and double-check it nevertheless. It can also give you some ideas on how OpenWRT works internally.</p><p>After making these changes, plug the WAN port of the OpenWRT router to a LAN port on the VDSL Router, restart the OpenWRT router and ensure your laptop can connect to Internet from the LAN and WLAN sides of the OpenWRT router.</p><p>Then we can carry with the remainder of the tasks.</p><p>---</p><div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>@Antek you wrote that &quot;the &#039;bridge&#039; option for LAN and WLAN seems odd.&quot; What did you mean?<br />I configure the router via LUCI and there are no bridge-mode active?!</p><p>You also said &quot;The route configuration for WAN doesn&#039;t make sense to me since there are interface configurations using DHCP and DHCPv6&quot;<br />Can you explain me what you mean here?</p></blockquote></div><p>The bridge option seemed odd because your earlier configuration did not add any other physical interfaces to the &quot;LAN&quot; UCI interface in /etc/config/network or in /etc/config/wireless. Perhaps this was a remnant from an older configuration?</p><p>The old &#039;wifi&#039; interface in /etc/config/network was the target of both &#039;wifi-iface&#039; interfaces from the old /etc/config/wireless, so the bridge option made sense there. You basically bridged the two WLANs together.</p><p>As for the old route configurations...</p><div class="codebox"><pre><code>config route
        option interface &#039;wan&#039;
        option target &#039;192.168.1.8&#039;
        option gateway &#039;192.168.1.2&#039;</code></pre></div><p>The old WAN interface was using DHCP and DHCPv6 clients (although who was serving it, I don&#039;t know). <br />In your picture, there are no devices with &#039;192.168.1.8&#039; address, nor are there any &#039;host&#039; entries in the old DHCP config with this address. I didn&#039;t know what this route was supposed to do, so it seemed odd.</p><div class="codebox"><pre><code>config route
        option interface &#039;lan&#039;
        option target &#039;192.168.0.1&#039;
        option gateway &#039;192.168.0.9&#039;</code></pre></div><p>The picture doesn&#039;t show who the address 192.168.0.1 belongs to, perhaps there is a typo and it should be 192.168.1.1 so as to refer to the old &#039;Server&#039; computer? Anyhow, it doesn&#039;t seem to make sense.</p>											<p class="post-edited">(Last edited by <strong>Antek</strong> on 11 May 2017, 14:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358415">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">e-horn</div>
					<div class="post-datetime">
						15 May 2017, 21:42					</div>
				</div>
				<div class="post-content content">
					<p>Hello Antek, ive cleaned up all older configurations for my VPN-Connection and tested your configuration. But something doesn&#039;t work <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />With the router itself I can connect to the Internet so there have to be something wrong with the forwarding maybe...<br />When I traceroute google from my pc after geting the correct IP-adress and gateway he said that he can&#039;t reach the target-protocol?!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358441">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						16 May 2017, 08:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>With the router itself I can connect to the Internet so there have to be something wrong with the forwarding maybe...<br />When I traceroute google from my pc after geting the correct IP-adress and gateway he said that he can&#039;t reach the target-protocol?!</p></blockquote></div><p>Here&#039;s a short checklist:</p><p>1) Ensure ping and possibly traceroute work from the VDSL router&#039;s configuration interface, if it has these tools<br />2) Ensure ping and traceroute work from your PC connected to a LAN port of the VDSL router<br />3) Ensure ping and traceroute work from the OpenWRT router&#039;s LuCI interface<br />4) Ensure ping and traceroute work from your PC connected to a LAN port of the OpenWRT router<br />5) Ensure ping and traceroute work from your PC connected over WLAN to the OpenWRT router</p><p>Just run &#039;ping <a href="http://www.google.fi">www.google.fi</a>&#039; and &#039;traceroute <a href="http://www.google.fi">www.google.fi</a>&#039; in each case. Where does it stop working?</p>											<p class="post-edited">(Last edited by <strong>Antek</strong> on 16 May 2017, 08:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358448">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">e-horn</div>
					<div class="post-datetime">
						16 May 2017, 10:22					</div>
				</div>
				<div class="post-content content">
					<p>The ping from VPN-Router works. The traceroute from my PC connected to Lan-port of the vpn-router stops at the vpn-router with error message written above</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358451">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						16 May 2017, 11:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>The ping from VPN-Router works. The traceroute from my PC connected to Lan-port of the vpn-router stops at the vpn-router with error message written above</p></blockquote></div><p>Can you write the full error message here? It can be in the original language, you don&#039;t need to translate it.</p><p>If you connect your PC to the OpenWRT router over WLAN, what happens then? Does the same problem occur?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358463">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">e-horn</div>
					<div class="post-datetime">
						16 May 2017, 14:41					</div>
				</div>
				<div class="post-content content">
					<p>I will post a screenshot of the error later. If I connect my tablet via wlan then the there appears the message that I should login to wlan?! (tablet is connected and got the right ip,subnet,gateway). Internet access doesn&#039;t work</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358464">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						16 May 2017, 15:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>If I connect my tablet via wlan then the there appears the message that I should login to wlan?! (tablet is connected and got the right ip,subnet,gateway). Internet access doesn&#039;t work</p></blockquote></div><p>Since we did not configure anything like this into the OpenWRT, then there are two possible explanations: either you are connecting to the wrong WLAN, or your VDSL-router (or Internet service provider) is generating the login page and requesting for login credentials.</p><p>If it is the latter case, then I am not surprised that your traceroute or ping attempts from the PC did not work: the ISP is blocking your traffic because you have not logged in yet.</p><p>You should really consult your ISP for details on the Internet connection.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358534">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">e-horn</div>
					<div class="post-datetime">
						17 May 2017, 22:36					</div>
				</div>
				<div class="post-content content">
					<p>Hello, now I tested your configuration with an fresh open-wrt (reset router) and than add your config files.<br />The same result <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Here are the screenshot:<br />h**p://imagizer.imageshack.com/img924/8882/qbdHHM.png<br />[traceroute from my PC with correct IP, Gateway, Subnet]</p><p>I&#039;m not sure what you mean with consulting my ISP, I dont understand what he have to do with this. Internet-Access works, but configuration doesn&#039;t.<br />On my tablet (android) there appears the message that I should login to network (like it does when you want to access an hotspot and you have to enter a password for internet-access...)</p>											<p class="post-edited">(Last edited by <strong>e-horn</strong> on 17 May 2017, 22:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358536">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						17 May 2017, 23:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e-horn wrote:</cite><blockquote><p>Hello, now I tested your configuration with an fresh open-wrt (reset router) and than add your config files.<br />The same result <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Here are the screenshot:<br />h**p://imagizer.imageshack.com/img924/8882/qbdHHM.png<br />[traceroute from my PC with correct IP, Gateway, Subnet]</p></blockquote></div><p>Something really strange is going on here.</p><p>In my configuration files, the OpenWRT router&#039;s address in the local network should be 192.168.2.1, and the DHCP server should be enabled. Client addresses should be between 192.168.2.10 and 192.168.2.160. In your screenshot, the first hop goes to 192.168.0.9, which is completely bizarre.</p><p>Are you sure your PC is configured correctly so it gets the IP address and gateway via DHCP from the OpenWRT router? What does the command &#039;ipconfig /all&#039; show on the PC?</p><div class="quotebox"><blockquote><p>I&#039;m not sure what you mean with consulting my ISP, I dont understand what he have to do with this. Internet-Access works, but configuration doesn&#039;t.<br />On my tablet (android) there appears the message that I should login to network (like it does when you want to access an hotspot and you have to enter a password for internet-access...)</p></blockquote></div><p>Sorry, this was my mistake. I understood your message incorrectly, and thought that when you open a browser on the tablet, then you see a login page. What you probably meant was the small Wi-fi icon with a question mark over it. That just signals a connectivity error.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358644">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						19 May 2017, 17:10					</div>
				</div>
				<div class="post-content content">
					<p>One thing which I didn&#039;t consider at first is the switch device on your router. According to the initial configuration you showed, there was a switch device on the router. The configuration that I posted omits the switch settings completely.</p><p>This may lead to a situation where the switch device is left to an unconfigured or uninitialized state, and causes misbehavior in your network.</p><p>To show the configuration of the switch, use SSH to connect to the router, and issue the following command: </p><div class="codebox"><pre><code>swconfig list</code></pre></div><p>This will show you available switch devices on the router, which have been identified by the kernel. If there is just one switch device, you can use </p><div class="codebox"><pre><code>swconfig dev &lt;device name&gt; show</code></pre></div><p> to display the status information from the switch.</p><p>With the help of your laptop, you can plug an Ethernet cable to each of the LAN and the WAN ports in sequence, issuing the above &#039;show&#039; command between each connection to see what the physical port layout looks like. When you plug in a cable that is connected to a laptop, the corresponding port should show a &quot;Link up&quot; status in the output of the &#039;show&#039; command.</p><p>Note that usually one port of the switch is always in &quot;Link up&quot; state, even when no cables were connected. This port is the CPU-facing port.</p><p>Looking back at the situation, I really should&#039;ve thought about this before.. Silly me..&nbsp; I made the assumption that the LAN and WAN interfaces are separate at the hardware level, but this may not be the case at all <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>To understand why this might be a problem, look at this diagram: <a href="https://wiki.openwrt.org/doc/uci/network/switch">https://wiki.openwrt.org/doc/uci/network/switch</a></p>											<p class="post-edited">(Last edited by <strong>Antek</strong> on 19 May 2017, 17:17)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>