<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Mount USB Stick With Kami706 in WL-500gP</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 12 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p51864">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">robrob</div>
					<div class="post-datetime">
						5 Jul 2007, 13:57					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m getting a &quot;mount failed&quot; message when i try to mount a fat formatted 128mb USB memory stick.</p><p>dmesg:&nbsp; <br /></p><div class="codebox"><pre><code>Bus Device Product Manufacturer VendorID:ProdID USB version 
03 5 USB 2.0 SD/MMC READER  SDMMC M121  14cd:6700 2.00</code></pre></div><div class="codebox"><pre><code>scsi3 : SCSI emulation for USB Mass Storage devices
usb-storage: device found at 5
usb-storage: waiting for device to settle before scanning
scsi 3:0:0:0: Direct-Access     USB 2.0  SD/MMC Reader         PQ: 0 ANSI: 0 CCS
SCSI device sda: 244864 512-byte hdwr sectors (125 MB)
sda: Write Protect is off
sda: Mode Sense: 03 00 00 00
sda: assuming drive cache: write through
SCSI device sda: 244864 512-byte hdwr sectors (125 MB)
sda: Write Protect is off
sda: Mode Sense: 03 00 00 00
sda: assuming drive cache: write through
 sda: sda1
sd 3:0:0:0: Attached scsi removable disk sda
usb-storage: device scan complete
FAT: codepage cp437 not found</code></pre></div><div class="codebox"><pre><code>Installed Packages

Action Package Version Description 
Uninstall base-files-brcm47xx-2.6 8-7431  
Uninstall bridge 1.0.6-1  
Uninstall busybox 1.4.2-1  
Uninstall dnsmasq 2.38-1  
Uninstall dropbear 0.49-1  
Uninstall ez-ipupdate 3.0.11b8-2  
Uninstall fdisk 2.12r-1  
Uninstall haserl 0.8.0-1  
Uninstall hotplug2 0.9-1  
Uninstall iptables 1.3.5-1  
Uninstall kernel 2.6.19.2-brcm47xx-1  
Uninstall kmod-diag 1+2.6.19.2-brcm47xx-1  
Uninstall kmod-fs-vfat 2.6.19.2-brcm47xx-1  
Uninstall kmod-ipt-nathelper 2.6.19.2-brcm47xx-1  
Uninstall kmod-madwifi 2.6.19.2+0.9.2.1-brcm47xx-1  
Uninstall kmod-nls-base 2.6.19.2-brcm47xx-1  
Uninstall kmod-ppp 2.6.19.2-brcm47xx-1  
Uninstall kmod-pppoe 2.6.19.2-brcm47xx-1  
Uninstall kmod-scsi-core 2.6.19.2-brcm47xx-1  
Uninstall kmod-switch 2.6.19.2-brcm47xx-1  
Uninstall kmod-usb-core 2.6.19.2-brcm47xx-1  
Uninstall kmod-usb-storage 2.6.19.2-brcm47xx-1  
Uninstall kmod-usb-uhci 2.6.19.2-brcm47xx-1  
Uninstall kmod-usb2 2.6.19.2-brcm47xx-1  
Uninstall libgcc 4.1.2-8  
Uninstall mtd 5  
Uninstall ntpclient 2003_194-2  
Uninstall ppp 2.4.3-7  
Uninstall ppp-mod-pppoe 2.4.3-7  
Uninstall uclibc 0.9.28-8  
Uninstall udevtrigger 106-1  
Uninstall webif 0.3-3  
Uninstall wireless-tools 28-1</code></pre></div><p>fdisk -l:</p><div class="codebox"><pre><code>root@Kamikazi:~# fdisk -l

Disk /dev/sda: 125 MB, 125370368 bytes
4 heads, 32 sectors/track, 1913 cylinders
Units = cylinders of 128 * 512 = 65536 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1        1913      122382+   6  FAT16
root@Kamikazi:~#</code></pre></div><p>mount:<br /></p><div class="codebox"><pre><code>root@Kamikazi:~# mount /dev/sda1 /mnt
mount: mounting /dev/sda1 on /mnt failed
root@Kamikazi:~# mount /dev/sda /mnt
mount: mounting /dev/sda on /mnt failed
root@Kamikazi:~#</code></pre></div><p>Anyone know what&#039;s wrong? Thanks in advance.</p><p>Rob</p>											<p class="post-edited">(Last edited by <strong>robrob</strong> on 6 Jul 2007, 00:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51867">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">spelth</div>
					<div class="post-datetime">
						5 Jul 2007, 15:06					</div>
				</div>
				<div class="post-content content">
					<p>Hrm... do you have /dev/scsi/[...]? <br />Then try this:<br /></p><div class="codebox"><pre><code>mount /dev/scsi/host0/bus0/target0/lun0/part1 /mnt</code></pre></div>											<p class="post-edited">(Last edited by <strong>spelth</strong> on 5 Jul 2007, 15:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51896">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">robrob</div>
					<div class="post-datetime">
						6 Jul 2007, 00:46					</div>
				</div>
				<div class="post-content content">
					<p>Same failure to mount:</p><div class="codebox"><pre><code>root@Kamikazi:~# mount /dev/scsi/host0/bus0/target0/lun0/part1 /mnt
mount: mounting /dev/scsi/host0/bus0/target0/lun0/part1 on /mnt failed
root@Kamikazi:~#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51902">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">p90</div>
					<div class="post-datetime">
						6 Jul 2007, 02:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />had the same problem.<br />Rebootet the router 3-4 times but still no chance.<br />Left the stick plugt in while I went sleeping. The next day it worked without a problem.<br />By the way, I have a WL-500g Delux, not a Premium, but maybe the problem has the same root.<br />with best regards<br />p90</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51922">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">raver</div>
					<div class="post-datetime">
						6 Jul 2007, 14:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>You must install at least these packages:</p><p><strong>kmod-nls-base<br />kmod-nls-cp437</strong></p><p>Additionally these might be needed according to the filenames&#039; charset.</p><p><strong>kmod-nls-cp850<br />kmod-nls-iso8859-1<br />kmod-nls-iso8859-15<br />kmod-nls-utf8</strong></p><p>To enable automount, you will need do add some scripts which are already included on kamikaze development branch (trunk)</p><p><strong>/sbin/usb-storage</strong><br /></p><div class="codebox"><pre><code>#!/bin/sh
# Copyright (C) 2006 OpenWrt.org
logger &quot;usb device is mass storage&quot;
i=0                                
while [ $i -le 10 ]; do
        logger &quot;waiting on usb drive $i ...&quot;                         
        i=$(($i+1))
        cd /sys${DEVPATH}
        for blk in `find host* -type d`; do
                cd /sys/${DEVPATH}/${blk}
                BLK=$(find block* -type l 2&gt; /dev/null)
                [ -n &quot;${BLK}&quot; ] &amp;&amp; {
                        cd /sys${DEVPATH}/${blk}/${BLK}
                        ls /dev/ &gt; /tmp/d
                        sleep 2
                        for node in `find sd* -type d | grep -v &quot;/&quot;`; do
                                echo &quot;mounting /dev/${node} on /mnt/usbdrive&quot;
                                mkdir -p /mnt/usbdrive
                                mount /dev/${node} /mnt/usbdrive
                                exit 0
                        done
                }
        done
        sleep 1
done</code></pre></div><p><strong>/etc/hotplug.d/usb/10-usb-storage</strong><br /></p><div class="codebox"><pre><code>#!/bin/sh
# Copyright (C) 2006 OpenWrt.org
case &quot;$ACTION&quot; in
        add)
                [ -n &quot;${INTERFACE}&quot; ] &amp;&amp;
                [ &quot;$(expr substr ${INTERFACE} 1 2)&quot; == &quot;8/&quot; ]  &amp;&amp; {
                        /sbin/usb-storage &amp;
                }
                ;;
esac</code></pre></div><p>Don&#039;t forget to make them executable (chmod +x) <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>You must edit <strong>/etc/hotplug2.rules</strong><br />Edit the line:<br /><strong>SUBSYSTEM ~~ (net|button){</strong><br />to:<br /><strong>SUBSYSTEM ~~ (net|button|usb){</strong></p><p>I hope it works for you <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>raver</strong> on 6 Jul 2007, 14:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51948">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">robrob</div>
					<div class="post-datetime">
						7 Jul 2007, 13:08					</div>
				</div>
				<div class="post-content content">
					<p>raver,</p><p>Thanks for the help. kmod-nls-base was already installed and I successfully added kmod-nls-cp437 but I get this error when trying to add the other packages you listed:</p><div class="codebox"><pre><code>root@Kamikazi:~# ipkg install kmod-nls-cp850
Installing kmod-nls-cp850 (2.6.19.2-brcm-1) to root...
Downloading ftp://ftp.berlios.de/pub/xwrt/kamikaze/broadcom-2.6/packages//./kmod-nls-cp850_2.6.19.2-brcm-1_mipsel.ipk
wget: bad response to RETR: 550 pub/xwrt/kamikaze/broadcom-2.6/packages//./kmod-nls-cp850_2.6.19.2-brcm-1_mipsel.ipk: No such file or directory
Nothing to be done
An error ocurred, return value: 22.
Collected errors:
ipkg_download: ERROR: Command failed with return value 1: `wget --passive-ftp    -q -P /tmp/ipkg-jDu5HS ftp://ftp.berlios.de/pub/xwrt/kamikaze/broadcom-2.6/packages//./kmod-nls-cp850_2.6.19.2-brcm-1_mipsel.ipk&#039;
Failed to download kmod-nls-cp850. Perhaps you need to run &#039;ipkg update&#039;?
root@Kamikazi:~#</code></pre></div><p>fdisk -l still gives the same info as in the previous post and the mount commands still fail.</p><p>Rob</p>											<p class="post-edited">(Last edited by <strong>robrob</strong> on 7 Jul 2007, 15:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51966">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">raver</div>
					<div class="post-datetime">
						8 Jul 2007, 02:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robrob wrote:</cite><blockquote><p>...I get this error when trying to add the other packages you listed</p></blockquote></div><p>Hi Rob <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I think those additional packages are only needed if filenames have special characters. Essential packages are kmod-nls-base and kmod-nls-cp437.</p><p>Did you try &quot;mount -t vfat /dev/sda1 /mnt&quot; and checked loaded modules (lsmod)?</p><p>I hope it helps <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Raver</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51970">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">robrob</div>
					<div class="post-datetime">
						8 Jul 2007, 04:26					</div>
				</div>
				<div class="post-content content">
					<p>Success!</p><p>raver,</p><p>Thanks for the help. As you mentioned, I needed to install kmod-nls-cp437--that&#039;s what was causing the mount command to fail. Following your direction, this mount command was successful:</p><div class="codebox"><pre><code>root@Kamikazi:/mnt# mount -t vfat /dev/sda1 /mnt/usb
root@Kamikazi:/mnt#</code></pre></div><div class="codebox"><pre><code>root@Kamikazi:/mnt# mount
rootfs on / type rootfs (rw)
/dev/root on /rom type squashfs (ro)
none on /proc type proc (rw)
none on /sys type sysfs (rw)
none on /tmp type tmpfs (rw,nosuid,nodev)
tmpfs on /dev type tmpfs (rw)
none on /dev/pts type devpts (rw)
/dev/mtdblock3 on /jffs type jffs2 (rw)
/jffs on / type mini_fo (rw)
none on /proc/bus/usb type usbfs (rw)
/dev/sda1 on /mnt/usb type vfat (rw,fmask=0022,dmask=0022,codepage=cp437,iocharset=iso8859-1)</code></pre></div><p>You&#039;re the man. Thanks again for the help. Now I&#039;m off to set up the auto mount.</p><p>Rob</p>											<p class="post-edited">(Last edited by <strong>robrob</strong> on 8 Jul 2007, 14:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51971">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">robrob</div>
					<div class="post-datetime">
						8 Jul 2007, 04:46					</div>
				</div>
				<div class="post-content content">
					<p>raver,</p><p>I owe you big time. I just got the automount script installed and running by following your excellent instructions.</p><p>A note to webif2 users: The &quot;Status/USB&quot; page shows the USB memory stick in the &quot;Connected&quot; section, but the &quot;Mounted USB / SCSI devices&quot; section is empty, but the drive is listed on the &quot;Status/System/Mount Usage&quot; page. When I ssh in and list the /mnt/usbdrive directory the contents of the memory stick are shown.</p><p>Thanks again raver,</p><p>Rob</p>											<p class="post-edited">(Last edited by <strong>robrob</strong> on 8 Jul 2007, 04:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p65789">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						26 Mar 2008, 12:52					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br /></p><div class="quotebox"><cite>raver wrote:</cite><blockquote><p>Additionally these might be needed according to the filenames&#039; charset.</p><p><strong>kmod-nls-cp850<br />kmod-nls-iso8859-1<br />kmod-nls-iso8859-15<br />kmod-nls-utf8</strong></p></blockquote></div><p>I had the same problem and this also solved it. I just would like to underline that having the right charset is important. I couldn&#039;t mount my USB until I installed the kmod-nls-iso8859-1 package.</p><p>Regards,<br />Tex</p>											<p class="post-edited">(Last edited by <strong>Tex-Twil</strong> on 26 Mar 2008, 12:52)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>