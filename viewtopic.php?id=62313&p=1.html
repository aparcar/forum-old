<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> router recommendationdue to network layout change</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 8 Apr 2018 and 12 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=62313&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p308618">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						22 Jan 2016, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>Greetings,</p><p>my current router (tl-wdr4300) suits my current layout well (2 machines, one connected via lan and the other via 5GHz wlan).<br />however I need to change my lan layout (3 machines, all wired).<br />I need to be able to pass data rather fast on the lan so I&#039;m looking for a openwrt supported router that has a usb jack (for my network storage) and supports 1Gbps connections (it seems that the tl-wdr4300 doesn&#039;t support 1Gbps.) speed over the lan.<br />regarding the wireless, I need 2.4GHz N support, nothing more.</p><p>any suggestions?</p>											<p class="post-edited">(Last edited by <strong>daggs</strong> on 22 Jan 2016, 16:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308660">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">cedricb</div>
					<div class="post-datetime">
						22 Jan 2016, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>...just add a 1gb switch between the router and your connected devices</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308667">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						23 Jan 2016, 01:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>I need to be able to pass data rather fast on the lan so I&#039;m looking for a openwrt supported router that has a usb jack (for my network storage) and supports 1Gbps connections (it seems that the tl-wdr4300 doesn&#039;t support 1Gbps.)</p></blockquote></div><p>I may be mistaken here, but I don&#039;t think that the USB-&gt;HDD on run of the mill router is going to be fast enough to saturate 1Gb. You may want to research that before spending money.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308715">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						23 Jan 2016, 14:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cedricb wrote:</cite><blockquote><p>...just add a 1gb switch between the router and your connected devices</p></blockquote></div><p>as openwrt doesn&#039;t supports the router completely, adding a new switch won&#039;t increase the speed I can read from the device.<br />in addition, I don&#039;t think that having 3 devices (modem, router and switch) to run a simple home network is the right way to go.<br />not to mention the reaction I&#039;ll get from the wife..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308716">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						23 Jan 2016, 15:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>I need to be able to pass data rather fast on the lan so I&#039;m looking for a openwrt supported router that has a usb jack (for my network storage) and supports 1Gbps connections (it seems that the tl-wdr4300 doesn&#039;t support 1Gbps.)</p></blockquote></div><p>I may be mistaken here, but I don&#039;t think that the USB-&gt;HDD on run of the mill router is going to be fast enough to saturate 1Gb. You may want to research that before spending money.</p></blockquote></div><p>first, I need the 1gb for data passing between the servers.<br />second, you are correct, currently the most I can get from the link is 20MB/s (using nc test method) and 7-9 MB/s when accessing the usb dev via nfs v3 mount.<br />but usb2 is bounded to 480Mb/s, so assuming I apply a 20% penalty on the speed, I get 384Mb/s which are ~48MB/s.<br />which is 2.4 times faster then what I have now in raw.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308785">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jeff_d</div>
					<div class="post-datetime">
						24 Jan 2016, 00:32					</div>
				</div>
				<div class="post-content content">
					<p>I have a similar setup at home. I had a cheap router (dlink dir-615), and a 8 port g&#039;bit switch connected to the lan side. I have 4 PCs attached to the switch. Data rates were speedy on the wire-to-wire connections, but wireless was slow due to the router being slow. Going from one USB2 drive on PC 1 to any other PCs would flood the USB bus it was on and would max out around 25-28MB/s. 30% NIC utilization.</p><p>I bought a WDR3600 to replace the dlink. Wifi speeds went up due to MIMO &amp; 5ghz. I thought I&#039;d just connect the USB drive to the router and wouldn&#039;t need the extra PC on all the time. Plugged it in, but it would kill the router whenever I would copy something. Max was 7-8MB/s and internet for the other PCs would slow to a crawl. The router processor couldn&#039;t keep up trying to read/write to the drive. Did lots of research, and couldn&#039;t find any FAST routers with USB that were cheap. All of them seem to max out around 7-10MB/s on wired connections.</p><p>Went back to the PC-to-PC method and bought a USB3 drive since one PC has USB3 ports. I can flood the g&#039;bit connection. Maxes out at 110MB/s. 85-90% NIC utilization. USB3 drive to the PC directly will transfer around 180MB/s.</p><p>As cedricb said, just add a switch and keep your router. If you don&#039;t like your router, pick a gigabit router and be limited to 4 ports. If the wife doesn&#039;t want a switch taking up all the space, find a small switch and a couple short cables to connect them.</p>											<p class="post-edited">(Last edited by <strong>jeff_d</strong> on 24 Jan 2016, 00:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308797">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						24 Jan 2016, 02:27					</div>
				</div>
				<div class="post-content content">
					<p>keep wdr4300 for networking/WLAN and buy a simple NAS</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308798">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						24 Jan 2016, 02:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jeff_d wrote:</cite><blockquote><p>Did lots of research, and couldn&#039;t find any FAST routers with USB that were cheap. All of them seem to max out around 7-10MB/s on wired connections.</p></blockquote></div><p>Asus RT-N56U <strong>B1</strong> with Padavan firmware will give you 40MB/s USB2.0 over AC (which&#039;ll be unlocked by firmware) and LAN<br />Openwrt will be also fast, but not so and it&#039;s still unsupported in the mainline as i know</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308802">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">jeff_d</div>
					<div class="post-datetime">
						24 Jan 2016, 05:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><div class="quotebox"><cite>jeff_d wrote:</cite><blockquote><p>Did lots of research, and couldn&#039;t find any FAST routers with USB that were cheap. All of them seem to max out around 7-10MB/s on wired connections.</p></blockquote></div><p>Asus RT-N56U <strong>B1</strong> with Padavan firmware will give you 40MB/s USB2.0 over AC (which&#039;ll be unlocked by firmware) and LAN<br />Openwrt will be also fast, but not so and it&#039;s still unsupported in the mainline as i know</p></blockquote></div><p>Good to know there are moderately faster USB routers now. This was at least 4-5 years ago. I think the RT-N56U had just came out. I move 200-400 GB of traffic every few days from recording HD &amp; 4k video from our church video ministries for processing. Even at 40MB/s it&#039;s still slow compared to 110MB/s. Fiber is an idea, but when you&#039;ve already got dual gbit on the motherboard, free always wins. But, the server I use for storage only has USB2 and one gbit port.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308813">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						24 Jan 2016, 09:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jeff_d wrote:</cite><blockquote><div class="quotebox"><cite>stas2z wrote:</cite><blockquote><div class="quotebox"><cite>jeff_d wrote:</cite><blockquote><p>Did lots of research, and couldn&#039;t find any FAST routers with USB that were cheap. All of them seem to max out around 7-10MB/s on wired connections.</p></blockquote></div><p>Asus RT-N56U <strong>B1</strong> with Padavan firmware will give you 40MB/s USB2.0 over AC (which&#039;ll be unlocked by firmware) and LAN<br />Openwrt will be also fast, but not so and it&#039;s still unsupported in the mainline as i know</p></blockquote></div><p>Good to know there are moderately faster USB routers now. This was at least 4-5 years ago. I think the RT-N56U had just came out. I move 200-400 GB of traffic every few days from recording HD &amp; 4k video from our church video ministries for processing. Even at 40MB/s it&#039;s still slow compared to 110MB/s. Fiber is an idea, but when you&#039;ve already got dual gbit on the motherboard, free always wins. But, the server I use for storage only has USB2 and one gbit port.</p></blockquote></div><p>for 100MB/s you need a router with MT7621A and USB3<br />i never tested USB3 of my WITI board (cuz im using SATA), but i heard it can reach a hundred with usb3</p>											<p class="post-edited">(Last edited by <strong>stas2z</strong> on 24 Jan 2016, 09:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308884">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">kelhgvrb</div>
					<div class="post-datetime">
						24 Jan 2016, 20:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>in addition, I don&#039;t think that having 3 devices (modem, router and switch) to run a simple home network is the right way to go.</p></blockquote></div><p>You have ADSL/VDSL connection?</p><p>get a TP-Link TD-W9980/TD-W8980</p><p>Its all in one. Modem, openwrt router, 1gbit switch</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309248">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						27 Jan 2016, 20:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><p>keep wdr4300 for networking/WLAN and buy a simple NAS</p></blockquote></div><p>why? my 3tb drive via usb suits my needs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309250">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						27 Jan 2016, 21:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kelhgvrb wrote:</cite><blockquote><div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>in addition, I don&#039;t think that having 3 devices (modem, router and switch) to run a simple home network is the right way to go.</p></blockquote></div><p>You have ADSL/VDSL connection?</p><p>get a TP-Link TD-W9980/TD-W8980</p><p>Its all in one. Modem, openwrt router, 1gbit switch</p></blockquote></div><p>I have a vdsl connection.<br />I&#039;m not sure how getting a newer tp link and the connection type will help me with my issue...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309255">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						27 Jan 2016, 21:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><div class="quotebox"><cite>jeff_d wrote:</cite><blockquote><p>Did lots of research, and couldn&#039;t find any FAST routers with USB that were cheap. All of them seem to max out around 7-10MB/s on wired connections.</p></blockquote></div><p>Asus RT-N56U <strong>B1</strong> with Padavan firmware will give you 40MB/s USB2.0 over AC (which&#039;ll be unlocked by firmware) and LAN<br />Openwrt will be also fast, but not so and it&#039;s still unsupported in the mainline as i know</p></blockquote></div><p>this one was my original selection but as my country have hard limitaion on importing and usage of 5GHz wireless networks, it wasn&#039;t worth while.<br />also as said before, my needs have changed now and 5GHz wireless network isn&#039;t something I need.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309562">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						30 Jan 2016, 06:44					</div>
				</div>
				<div class="post-content content">
					<p>ok, I was thinking abou this, lets assume I&#039;m going along with the additonal gigabit switch.</p><p>I flush the 4300&#039;s firmware to latest stock it get the full performence.<br />what remains in the media usb hdd, if I connect it to the 4300, I need to backup the data and replace the fs because the current fs on the drive ext4 and 4300 stock fw supports only fat32 or ntfs which are yuck.<br />os this begs the question. is there a gigabit switch (doesn&#039;t matter if the wan is gigabit, this will just change the connection order) that has full openwrt support of gigabit and usb2.0?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309598">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						30 Jan 2016, 13:35					</div>
				</div>
				<div class="post-content content">
					<p>Hey there.</p><p>Could you elaborate, why exactly your TP-Link 4300 does not already fit your needs?</p><p>I run a 4300 myself (besides three TP-Link 4900 and one 1043v1) and *all* of them get me close to 1GBit between my LAN devices.<br />I daisy-chained a couple of them (computer - 1043 - 4900 - 4300 - computer) and even get close to 1GBit betwen those two computers.</p><p>1GBit/s makes 125MByte/s. Adding some overhead, 100MByte/s should be realistic. If your numbers are more like 10MByte/s, I guess one of your devices or cables is demaged.</p><p>Some network devices tend to fall back to the next lower bandwith once they detect wiring issues. Did you use 8-pin connectors? Are all pairs drilled properly? Is one wire broken within a cable, like you might get it when you roll a revolving chair over your cable?</p><p>Regards,<br />Stephan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310268">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						4 Feb 2016, 14:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>golialive wrote:</cite><blockquote><p>Hey there.</p><p>Could you elaborate, why exactly your TP-Link 4300 does not already fit your needs?</p><p>I run a 4300 myself (besides three TP-Link 4900 and one 1043v1) and *all* of them get me close to 1GBit between my LAN devices.<br />I daisy-chained a couple of them (computer - 1043 - 4900 - 4300 - computer) and even get close to 1GBit betwen those two computers.</p><p>1GBit/s makes 125MByte/s. Adding some overhead, 100MByte/s should be realistic. If your numbers are more like 10MByte/s, I guess one of your devices or cables is demaged.</p><p>Some network devices tend to fall back to the next lower bandwith once they detect wiring issues. Did you use 8-pin connectors? Are all pairs drilled properly? Is one wire broken within a cable, like you might get it when you roll a revolving chair over your cable?</p><p>Regards,<br />Stephan.</p></blockquote></div><p>I really find what you are saying strange, all over the forum and the bug tracker people complain that they cannot achieve linerate with this and similar TP link routers.<br />even one of the devs say that the issue is that TP link routers have a hw nat feature that isn&#039;t supported in openwrt because TP link haven&#039;t released any form of documentation.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310289">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						4 Feb 2016, 16:56					</div>
				</div>
				<div class="post-content content">
					<p>Hey there.</p><p>You didn&#039;t talk about hardware nat and routing, you talked about passing data from one client to another client of the very same network.<br />As long as you don&#039;t use different vlans to create firewalled subnets, that&#039;s not even regular routing. Nor is it routing with nat. <br />That&#039;s plain switching. Which doesn&#039;t even hit the CPU.</p><p>So I expect as close to 100% of GBit performance in switching mode with OpenWRT as I expect the very same device with stock firmware. And as I expect any non-router regular SoHo switch.</p><p>If you do want routing and can live without NAT, then you will certainly not get a full GBit. But you will get more than 10%. You will more likely end up with something like 30%. That&#039;s not much, but for me that&#039;s just enogh for the rare cases I do routing.</p><p>Think about this very network setup:<br />* A local parents network is your primary network, having like a couple of laptops, computers and smart phones.<br />* The local childrens playground holds whatever devices your children use.<br />* The living room play station and smart tv network is separated from both to not expose connections to your private stuff by some clumys smart tv implementation.<br />* A guest wifi network spans just for guests.<br />* Whenever one client in one network needs to reach another client in the very same network (as long as its not wifi but wire), that&#039;s not routing but plain switching. Blazing fast.<br />* Whenever one clinet in one network needs to reach another client in another network, that&#039;s routing. That&#039;s kind of slow, but those cases are rare.</p><p>And: There is just no point in enabling nat between those four networks. Regular routing simply does the job.</p><p>If you do want routing, please have a look at this post of mine, it shows some numbers and explains my daily driver network setup.<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=290241#p290241">https://forum.openwrt.org/viewtopic.php … 41#p290241</a></p><p>Regards,<br />Stephan.</p>											<p class="post-edited">(Last edited by <strong>golialive</strong> on 4 Feb 2016, 17:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310470">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						6 Feb 2016, 10:48					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve reviewed another topic I&#039;ve opened on this issue, it seems to be a driver issue rather than hw nat but still I get no where near 100mb, my test is as follows:<br /></p><ol class="decimal"><li><p>on the server run: nc -l -p 22222 &gt; /dev/null</p></li><li><p>on the desktop run: dd if=/dev/zero bs=1024K count=1024 | nc router 22222</p></li></ol><p>the output is:<br /></p><div class="codebox"><pre><code>nc: using stream socket
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB) copied, 53.5432 s, 20.1 MB/s</code></pre></div><p>I don&#039;t think I use vlan or routing, my system is as follows:<br /></p><ol class="decimal"><li><p>40mb vdsl2+ connection</p></li><li><p>vdsl2+ router/modem configured as passthoguh (modem only), the router handles the dialup.</p></li><li><p>the router (tl-wdr4300) runs latest stable openwrt with mac based ip reservation for dhcp. I have a 3tb hdd connected via usb to it.</p></li><li><p>the lan is composed of a network printer and a desktop on which I preformed the test above.</p></li><li><p>the wlans are both wpa2 encrypted.</p></li><li><p>the 2.4 GHz has at most 2 laptops and one android based phone connected to it.</p></li><li><p>the 5 GHz has a rpi2 connected to.</p></li></ol><p>is there any vlan/routing issue in my setup?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310492">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						6 Feb 2016, 15:03					</div>
				</div>
				<div class="post-content content">
					<p>Hey there.</p><p>From your description there should be no routing involved. So having only 20MB/s is really strange.</p><p>20MB/s, that&#039;s 160MBit. Which means it&#039;s most likely no wiring issue. Wrong wiring would make 1GBit fall back to 100MBit, not 160.</p><p>Please open the web ui on your router on &quot;Network / Switch&quot;.<br />Where are your &quot;server&quot; and your &quot;desktop&quot; devices connected to?<br />Having plain switching without routing would require to have both devices on ports where both ports have the very same column set to &quot;untagged&quot; and all other columns set to &quot;off&quot;.</p><p><a href="http://s23.postimg.org/rvozqk52z/Screen_Shot_08_02_15_at_04_49_PM_005.jpg">http://s23.postimg.org/rvozqk52z/Screen … PM_005.jpg</a><br />Have a look at this one.<br />Devices on ports 2, 3 an 4 interconnect without routing since they are on the very same vlan (vlan id 1).<br />The device on port 1 goes only with routing to every other devices because of being in a distinct vlan (vlan id 3).<br />The devices on ports 5 and 6 interconnect without routing but require routing to connect to all devices on ports 1 to 4.</p><p>Keep in mind: That&#039;s *not* the default setup of OpenWrt but only an example of what vlan would look like.</p><p>So please elaborate on which vlan ports your devices &quot;server&quot; and &quot;desktop&quot; are connected to.</p><p>To make sure it&#039;s not an issue with routing, you could simply grep yourself a dumb switch (there are 5 port devices for less than 20€) and make sure both, destkop and server are hooked up both not to your router but to the switch. If that&#039;s still only 15% of a full GBit then one of your server or desktop devices has an issue.</p><p>Regards,<br />Stephan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310502">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						6 Feb 2016, 16:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>I&#039;ve reviewed another topic I&#039;ve opened on this issue, it seems to be a driver issue rather than hw nat but still I get no where near 100mb, my test is as follows:<br /></p><ol class="decimal"><li><p>on the server run: nc -l -p 22222 &gt; /dev/null</p></li><li><p>on the desktop run: dd if=/dev/zero bs=1024K count=1024 | nc router 22222</p></li></ol><p>the output is:<br /></p><div class="codebox"><pre><code>nc: using stream socket
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB) copied, 53.5432 s, 20.1 MB/s</code></pre></div><p>I don&#039;t think I use vlan or routing, my system is as follows:<br /></p><ol class="decimal"><li><p>40mb vdsl2+ connection</p></li><li><p>vdsl2+ router/modem configured as passthoguh (modem only), the router handles the dialup.</p></li><li><p>the router (tl-wdr4300) runs latest stable openwrt with mac based ip reservation for dhcp. I have a 3tb hdd connected via usb to it.</p></li><li><p>the lan is composed of a network printer and a desktop on which I preformed the test above.</p></li><li><p>the wlans are both wpa2 encrypted.</p></li><li><p>the 2.4 GHz has at most 2 laptops and one android based phone connected to it.</p></li><li><p>the 5 GHz has a rpi2 connected to.</p></li></ol><p>is there any vlan/routing issue in my setup?</p></blockquote></div><p>Hi daggs,</p><p>I believe the tl-wdr4300&#039;s SoC is only connected to the switch and hence all communication that involves the router (so either traffic for the WAN or traffic terminating on the router itself) will be sensitive to VLAN issues. I understand that you terminate the netcat traffic at the router so the second clause from above seems valid. Now there might be an issue with VLAN performance on your SoC, see <a href="https://dev.openwrt.org/ticket/13072">https://dev.openwrt.org/ticket/13072</a> and/or <a href="https://dev.openwrt.org/ticket/14120">https://dev.openwrt.org/ticket/14120</a> that is causing your issue.<br />But your router will be too slow to do anything meaningful besides performing NAT, firewalling and potentially PPPoE encapsulation and traffic shaping at your WAN speed, so you might as well give up on the idea of accessig a file server on the router. If you change the server away from the router to another machine that is physically plugged into one on the router&#039;s LAN ports and test throughput between two LAN only machines, what kind of speed do you see there?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310503">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						6 Feb 2016, 16:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>golialive wrote:</cite><blockquote><p>Hey there.</p><p>From your description there should be no routing involved. So having only 20MB/s is really strange.</p><p>20MB/s, that&#039;s 160MBit. Which means it&#039;s most likely no wiring issue. Wrong wiring would make 1GBit fall back to 100MBit, not 160.</p><p>Please open the web ui on your router on &quot;Network / Switch&quot;.<br />Where are your &quot;server&quot; and your &quot;desktop&quot; devices connected to?<br />Having plain switching without routing would require to have both devices on ports where both ports have the very same column set to &quot;untagged&quot; and all other columns set to &quot;off&quot;.</p><p><a href="http://s23.postimg.org/rvozqk52z/Screen_Shot_08_02_15_at_04_49_PM_005.jpg">http://s23.postimg.org/rvozqk52z/Screen … PM_005.jpg</a><br />Have a look at this one.<br />Devices on ports 2, 3 an 4 interconnect without routing since they are on the very same vlan (vlan id 1).<br />The device on port 1 goes only with routing to every other devices because of being in a distinct vlan (vlan id 3).<br />The devices on ports 5 and 6 interconnect without routing but require routing to connect to all devices on ports 1 to 4.</p><p>Keep in mind: That&#039;s *not* the default setup of OpenWrt but only an example of what vlan would look like.</p><p>So please elaborate on which vlan ports your devices &quot;server&quot; and &quot;desktop&quot; are connected to.</p><p>To make sure it&#039;s not an issue with routing, you could simply grep yourself a dumb switch (there are 5 port devices for less than 20€) and make sure both, destkop and server are hooked up both not to your router but to the switch. If that&#039;s still only 15% of a full GBit then one of your server or desktop devices has an issue.</p><p>Regards,<br />Stephan.</p></blockquote></div><p>Greetings,</p><p>here is my table: <a href="http://s28.postimg.org/efu2wn8nx/vlan.png">http://s28.postimg.org/efu2wn8nx/vlan.png</a><br />my tests are done between the desktop and the router.<br />currently, there is only one machine connected via the lan, that is the desktop on port 5. the one of port 1 should be the modem.<br />I didn&#039;t touched these settings so I have no idea why it is set like that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310506">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">daggs</div>
					<div class="post-datetime">
						6 Feb 2016, 16:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>I&#039;ve reviewed another topic I&#039;ve opened on this issue, it seems to be a driver issue rather than hw nat but still I get no where near 100mb, my test is as follows:<br /></p><ol class="decimal"><li><p>on the server run: nc -l -p 22222 &gt; /dev/null</p></li><li><p>on the desktop run: dd if=/dev/zero bs=1024K count=1024 | nc router 22222</p></li></ol><p>the output is:<br /></p><div class="codebox"><pre><code>nc: using stream socket
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB) copied, 53.5432 s, 20.1 MB/s</code></pre></div><p>I don&#039;t think I use vlan or routing, my system is as follows:<br /></p><ol class="decimal"><li><p>40mb vdsl2+ connection</p></li><li><p>vdsl2+ router/modem configured as passthoguh (modem only), the router handles the dialup.</p></li><li><p>the router (tl-wdr4300) runs latest stable openwrt with mac based ip reservation for dhcp. I have a 3tb hdd connected via usb to it.</p></li><li><p>the lan is composed of a network printer and a desktop on which I preformed the test above.</p></li><li><p>the wlans are both wpa2 encrypted.</p></li><li><p>the 2.4 GHz has at most 2 laptops and one android based phone connected to it.</p></li><li><p>the 5 GHz has a rpi2 connected to.</p></li></ol><p>is there any vlan/routing issue in my setup?</p></blockquote></div><p>Hi daggs,</p><p>I believe the tl-wdr4300&#039;s SoC is only connected to the switch and hence all communication that involves the router (so either traffic for the WAN or traffic terminating on the router itself) will be sensitive to VLAN issues. I understand that you terminate the netcat traffic at the router so the second clause from above seems valid. Now there might be an issue with VLAN performance on your SoC, see <a href="https://dev.openwrt.org/ticket/13072">https://dev.openwrt.org/ticket/13072</a> and/or <a href="https://dev.openwrt.org/ticket/14120">https://dev.openwrt.org/ticket/14120</a> that is causing your issue.<br />But your router will be too slow to do anything meaningful besides performing NAT, firewalling and potentially PPPoE encapsulation and traffic shaping at your WAN speed, so you might as well give up on the idea of accessig a file server on the router. If you change the server away from the router to another machine that is physically plugged into one on the router&#039;s LAN ports and test throughput between two LAN only machines, what kind of speed do you see there?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p></blockquote></div><p>Greetings,<br />unfortunately, disabling the file server is not possible as it is used by my family to view content or hear music.<br />if I reinstate the modem as modem/router, connect the WDR4300 as a switch to it (no pppoe) and connect the rest to it, will that improve the performance?<br />also, in the near future I plan to move the rpi2 to the lan, add another rpi2 to the lan and disable the 5 GHz wifi, will that improve my situation?</p><p>I&#039;ll preform the test you&#039;ve requested once I&#039;ll complete the transition.</p><p>thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310509">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						6 Feb 2016, 16:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daggs wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>I&#039;ve reviewed another topic I&#039;ve opened on this issue, it seems to be a driver issue rather than hw nat but still I get no where near 100mb, my test is as follows:<br /></p><ol class="decimal"><li><p>on the server run: nc -l -p 22222 &gt; /dev/null</p></li><li><p>on the desktop run: dd if=/dev/zero bs=1024K count=1024 | nc router 22222</p></li></ol><p>the output is:<br /></p><div class="codebox"><pre><code>nc: using stream socket
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB) copied, 53.5432 s, 20.1 MB/s</code></pre></div><p>I don&#039;t think I use vlan or routing, my system is as follows:<br /></p><ol class="decimal"><li><p>40mb vdsl2+ connection</p></li><li><p>vdsl2+ router/modem configured as passthoguh (modem only), the router handles the dialup.</p></li><li><p>the router (tl-wdr4300) runs latest stable openwrt with mac based ip reservation for dhcp. I have a 3tb hdd connected via usb to it.</p></li><li><p>the lan is composed of a network printer and a desktop on which I preformed the test above.</p></li><li><p>the wlans are both wpa2 encrypted.</p></li><li><p>the 2.4 GHz has at most 2 laptops and one android based phone connected to it.</p></li><li><p>the 5 GHz has a rpi2 connected to.</p></li></ol><p>is there any vlan/routing issue in my setup?</p></blockquote></div><p>Hi daggs,</p><p>I believe the tl-wdr4300&#039;s SoC is only connected to the switch and hence all communication that involves the router (so either traffic for the WAN or traffic terminating on the router itself) will be sensitive to VLAN issues. I understand that you terminate the netcat traffic at the router so the second clause from above seems valid. Now there might be an issue with VLAN performance on your SoC, see <a href="https://dev.openwrt.org/ticket/13072">https://dev.openwrt.org/ticket/13072</a> and/or <a href="https://dev.openwrt.org/ticket/14120">https://dev.openwrt.org/ticket/14120</a> that is causing your issue.<br />But your router will be too slow to do anything meaningful besides performing NAT, firewalling and potentially PPPoE encapsulation and traffic shaping at your WAN speed, so you might as well give up on the idea of accessig a file server on the router. If you change the server away from the router to another machine that is physically plugged into one on the router&#039;s LAN ports and test throughput between two LAN only machines, what kind of speed do you see there?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p></blockquote></div><p>Greetings,<br />unfortunately, disabling the file server is not possible as it is used by my family to view content or hear music.<br />if I reinstate the modem as modem/router, connect the WDR4300 as a switch to it (no pppoe) and connect the rest to it, will that improve the performance?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; As long as you connect the wdr4300&#039;s switch via one of the LAN ports I would assume it will act as a simple Gbit-switch and hence should switch packets close to line rate. If the slw sped was caused by the router&#039;s CPU running out of steam do to having to do too much already, then not having the WDR perform NAT firewalling and PPPoE CPU will not help...<br /></p><div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>also, in the near future I plan to move the rpi2 to the lan, add another rpi2 to the lan and disable the 5 GHz wifi, will that improve my situation?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; If you move the content/movie server to one of those rpi&#039;s that should help <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>daggs wrote:</cite><blockquote><p>I&#039;ll preform the test you&#039;ve requested once I&#039;ll complete the transition.</p><p>thanks.</p></blockquote></div><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310510">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						6 Feb 2016, 16:39					</div>
				</div>
				<div class="post-content content">
					<p>Hey there.</p><div class="quotebox"><blockquote><p>my tests are done between the desktop and the router.</p></blockquote></div><p>That&#039;s the issue. You&#039;re limiting performance by using the routers CPU.<br />If that&#039;s your main goal after all: That&#039;s most likely as best as it gets with your device.</p><p>I was under the impression your main goal was to link a couple of network devices (desktop computer, server, NAS) via GBit where none of them is the router itself. You said &quot;first, I need the 1gb for data passing between the servers.&quot;. That would be the situation to expect nearly GBit speed.</p><p>If you need nice performing network storage, I would suggest to not put an USB device as storage to your OpenWrt but use a regular NAS device for that, like an entry Synology or something. Spending 150 to 200€ for a basic NAS box would give you enough speed and enough space. Spending the very same money on blazing fast OpenWrt devices (compared to other OpenWrt devices and in terms of what a router is meant to do in the first place) most likely doesn&#039;t give you the same performance.</p><p>Regars,<br />Stephan.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=62313&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>