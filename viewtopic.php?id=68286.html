<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Hacking a Meraki MX60 Security Device</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p342325">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">inorfolk</div>
					<div class="post-datetime">
						28 Oct 2016, 11:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi Guy&#039;s,</p><p>Im just getting into this subject after my Meraki kit subscription ended and that wanted Â£500 to renew it. So I managed to follow this github.com/riptidewave93/Openwrt-MR24/blob/master/README.md#flashing to gain access boot but I think I have screwed up the flash some how.</p><br /><p>=&gt; reset<br />Unexpected magic number 27051956<br />recovery volume not found<br />=&gt; UBI: attached mtd1 to ubi0<br />UBI: MTD device name:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;mtd=2&quot;<br />UBI: MTD device size:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1021 MiB<br />UBI: number of good PEBs:&nbsp; &nbsp; &nbsp; &nbsp; 8174<br />UBI: number of bad PEBs:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br />UBI: max. allowed volumes:&nbsp; &nbsp; &nbsp; &nbsp;128<br />UBI: wear-leveling threshold:&nbsp; &nbsp; 4096<br />UBI: number of internal volumes: 1<br />UBI: number of user volumes:&nbsp; &nbsp; &nbsp;3<br />UBI: available PEBs:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3663<br />UBI: total number of reserved PEBs: 4511<br />UBI: number of PEBs reserved for bad PEB handling: 81<br />UBI: max/mean erase counter: 184/171<br />Volume kernel found at volume id 1<br />read 0 bytes from volume 1 to 800000(buf address)<br />Read [1786700] bytes<br />Unexpected magic number 27051956<br />recovery volume not found<br />=&gt;</p><p>Can anyone give me some pointers where to go with this please!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342328">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">inorfolk</div>
					<div class="post-datetime">
						28 Oct 2016, 12:47					</div>
				</div>
				<div class="post-content content">
					<p>=&gt; mtdparts</p><p>device nand0 &lt;nand0&gt;, # parts = 3<br /> #: name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; offset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mask_flags<br /> 0: firmware&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x00200000&nbsp; &nbsp; &nbsp; 0x00000000&nbsp; &nbsp; &nbsp; 0<br /> 1: panic&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x00040000&nbsp; &nbsp; &nbsp; 0x00200000&nbsp; &nbsp; &nbsp; 0<br /> 2: ubi&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x3fdc0000&nbsp; &nbsp; &nbsp; 0x00240000&nbsp; &nbsp; &nbsp; 0</p><p>active partition: nand0,0 - (firmware) 0x00200000 @ 0x00000000</p><p>defaults:<br />mtdids&nbsp; : none<br />mtdparts: none</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342329">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">inorfolk</div>
					<div class="post-datetime">
						28 Oct 2016, 12:48					</div>
				</div>
				<div class="post-content content">
					<p>=&gt; ubi info layout<br />UBI: volume information dump:<br />UBI: vol_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />UBI: reserved_pebs&nbsp; &nbsp;1<br />UBI: alignment&nbsp; &nbsp; &nbsp; &nbsp;1<br />UBI: data_pad&nbsp; &nbsp; &nbsp; &nbsp; 0<br />UBI: vol_type&nbsp; &nbsp; &nbsp; &nbsp; 3<br />UBI: name_len&nbsp; &nbsp; &nbsp; &nbsp; 12<br />UBI: usable_leb_size 129024<br />UBI: used_ebs&nbsp; &nbsp; &nbsp; &nbsp; 1<br />UBI: used_bytes&nbsp; &nbsp; &nbsp; 129024<br />UBI: last_eb_bytes&nbsp; &nbsp;129024<br />UBI: corrupted&nbsp; &nbsp; &nbsp; &nbsp;0<br />UBI: upd_marker&nbsp; &nbsp; &nbsp; 0<br />UBI: name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; board-config</p><p>UBI: volume information dump:<br />UBI: vol_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1<br />UBI: reserved_pebs&nbsp; &nbsp;263<br />UBI: alignment&nbsp; &nbsp; &nbsp; &nbsp;1<br />UBI: data_pad&nbsp; &nbsp; &nbsp; &nbsp; 0<br />UBI: vol_type&nbsp; &nbsp; &nbsp; &nbsp; 4<br />UBI: name_len&nbsp; &nbsp; &nbsp; &nbsp; 6<br />UBI: usable_leb_size 129024<br />UBI: used_ebs&nbsp; &nbsp; &nbsp; &nbsp; 14<br />UBI: used_bytes&nbsp; &nbsp; &nbsp; 1786700<br />UBI: last_eb_bytes&nbsp; &nbsp;109388<br />UBI: corrupted&nbsp; &nbsp; &nbsp; &nbsp;0<br />UBI: upd_marker&nbsp; &nbsp; &nbsp; 0<br />UBI: name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; kernel</p><p>UBI: volume information dump:<br />UBI: vol_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3<br />UBI: reserved_pebs&nbsp; &nbsp;4162<br />UBI: alignment&nbsp; &nbsp; &nbsp; &nbsp;1<br />UBI: data_pad&nbsp; &nbsp; &nbsp; &nbsp; 0<br />UBI: vol_type&nbsp; &nbsp; &nbsp; &nbsp; 3<br />UBI: name_len&nbsp; &nbsp; &nbsp; &nbsp; 7<br />UBI: usable_leb_size 129024<br />UBI: used_ebs&nbsp; &nbsp; &nbsp; &nbsp; 4162<br />UBI: used_bytes&nbsp; &nbsp; &nbsp; 536997888<br />UBI: last_eb_bytes&nbsp; &nbsp;129024<br />UBI: corrupted&nbsp; &nbsp; &nbsp; &nbsp;0<br />UBI: upd_marker&nbsp; &nbsp; &nbsp; 0<br />UBI: name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; storage</p><p>UBI: volume information dump:<br />UBI: vol_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2147479551<br />UBI: reserved_pebs&nbsp; &nbsp;2<br />UBI: alignment&nbsp; &nbsp; &nbsp; &nbsp;1<br />UBI: data_pad&nbsp; &nbsp; &nbsp; &nbsp; 0<br />UBI: vol_type&nbsp; &nbsp; &nbsp; &nbsp; 3<br />UBI: name_len&nbsp; &nbsp; &nbsp; &nbsp; 13<br />UBI: usable_leb_size 129024<br />UBI: used_ebs&nbsp; &nbsp; &nbsp; &nbsp; 2<br />UBI: used_bytes&nbsp; &nbsp; &nbsp; 258048<br />UBI: last_eb_bytes&nbsp; &nbsp;2<br />UBI: corrupted&nbsp; &nbsp; &nbsp; &nbsp;0<br />UBI: upd_marker&nbsp; &nbsp; &nbsp; 0<br />UBI: name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; layout volume</p><p>=&gt;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342436">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">riptide_wave</div>
					<div class="post-datetime">
						29 Oct 2016, 14:39					</div>
				</div>
				<div class="post-content content">
					<p>The guide you linked was for the Meraki MR24 only as no one has ported the MX60 to OpenWRT/LEDE at this time. Sadly without a copy of the original firmware, at this time there is not much you can do.</p><p>Good news though is I have a MX60 enroute that I hope to get ported over to LEDE in the future, but no ETA on when that will be.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342477">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">inorfolk</div>
					<div class="post-datetime">
						30 Oct 2016, 00:20					</div>
				</div>
				<div class="post-content content">
					<p>Looks like this is the dst for the MX60 board (bluestone) its obviously used for a few devices.</p><p>github.com/riptidewave93/meraki-linux/blob/093132b26f2873b4e30a8c58523339ebd90f2b07/arch/powerpc/boot/dts/bluestone.dts</p><p>So as I have this is there an idiots guide to building an image for this device? I have access to uboot and tftpboot and bootm seem to work. I can boot from the MR24 image, but I don&#039;t get any response from the console after the image is un-compressed seeing a its using the same SoC I was expecting at least this!!. Im probably missing several steps as I don&#039;t know what Im doing!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342596">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">riptide_wave</div>
					<div class="post-datetime">
						31 Oct 2016, 07:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>inorfolk wrote:</cite><blockquote><p>Looks like this is the dst for the MX60 board (bluestone) its obviously used for a few devices.</p><p>github.com/riptidewave93/meraki-linux/blob/093132b26f2873b4e30a8c58523339ebd90f2b07/arch/powerpc/boot/dts/bluestone.dts</p><p>So as I have this is there an idiots guide to building an image for this device? I have access to uboot and tftpboot and bootm seem to work. I can boot from the MR24 image, but I don&#039;t get any response from the console after the image is un-compressed seeing a its using the same SoC I was expecting at least this!!. Im probably missing several steps as I don&#039;t know what Im doing!</p></blockquote></div><p>Bluestone is what the boards are &quot;based&quot; on, but it is not the correct dts for the boards. For example, the MR24 uses the ikaram.dts file with some changes for the 4.4 kernel.</p><p>You are more than welcome to try and start porting the code over into LEDE for this board, but it will require it&#039;s own dts with support for the atheros switch. For now, my 2c would be to wait as I should get mine within a week so I can start getting this ported into LEDE.</p><p>EDIT: A port has been started, and you can build the firmware and test it from the Repo at <a href="https://github.com/riptidewave93/LEDE-MX60">https://github.com/riptidewave93/LEDE-MX60</a></p>											<p class="post-edited">(Last edited by <strong>riptide_wave</strong> on 4 Nov 2016, 20:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343152">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">inorfolk</div>
					<div class="post-datetime">
						6 Nov 2016, 20:11					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Chris that all worked fine. I can&#039;t believe how good this system is. I have more or less all the functionality I had with the MX60. Awesome!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343575">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">riptide_wave</div>
					<div class="post-datetime">
						13 Nov 2016, 15:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>inorfolk wrote:</cite><blockquote><p>Thanks Chris that all worked fine. I can&#039;t believe how good this system is. I have more or less all the functionality I had with the MX60. Awesome!</p></blockquote></div><p>Glad to hear! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> As for the device, I will post images every now and then to <a href="https://github.com/riptidewave93/LEDE-MX60/releases">https://github.com/riptidewave93/LEDE-MX60/releases</a> until this code gets merged upstream into LEDE, which should be soonish.</p><p>EDIT: Code has been merged into LEDE!</p>											<p class="post-edited">(Last edited by <strong>riptide_wave</strong> on 22 Nov 2016, 08:52)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>