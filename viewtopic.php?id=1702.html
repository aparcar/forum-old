<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> wireless vehicle tracking</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p8074">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">seanf</div>
					<div class="post-datetime">
						7 Jun 2005, 06:18					</div>
				</div>
				<div class="post-content content">
					<p>I have a little school project here that involves some Linksys wrt54gs and openWRT. I&#039;m creating a wireless vehicle tracking system for the University of Arizona CatTran shuttle. This is going to be as simple as possible, and I will only be implementing a test - this won&#039;t be a full-scale deployment. I&#039;ve come up with what I think will be a very simple solution, but I&#039;m missing a few details and I was hoping you guys could point me in the right direction. </p><p>I&#039;m going to place a few AP&#039;s around campus with big directional antennas pointed at timed stops. The shuttles will have an AP in client mode sitting on the dash board (or somewhere near a window). My thought is to have the AP&#039;s running a cron job that will check every minute or so whether one of the client AP&#039;s on the shuttle has connected to it, then send that data back to a server. The server will then put all the information on a web page that will be accessed by faculty and students. I will use the mac addresses of the client machines as identifiers for shuttles, and the mac address of the AP sending the server the information will tell me which AP the shuttle is near and therefore where the shuttle is.</p><p>What I need to know is, is there some sort of log file that keeps track of what mac addresses are connected at any given time? Or perhaps I could bind mac addresses to IP&#039;s and then I just need to know where to find the list of IP&#039;s?</p><p> I&#039;ve looked at a few bandwidth useage scripts like this: <a href="http://openwrt.org/forum/viewtopic.php?id=304">http://openwrt.org/forum/viewtopic.php?id=304</a></p><p>Is this the right direction? I don&#039;t need a full solution, mainly because I want to figure it out on my own. But any hints, tips, prods, etc. are very welcome. Please let me know if this is a bad explanation. I&#039;ll keep you all updated on the project. It&#039;s not very interesting at the moment, but if I can get this basic stuff out of the way then I can move on to more interesting applications.</p><p>Thanks for any help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8078">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">seanf</div>
					<div class="post-datetime">
						7 Jun 2005, 08:05					</div>
				</div>
				<div class="post-content content">
					<p>I think I found what I&#039;m looking for. I can use &#039;arp&#039;, or just &#039;cat /proc/net/arp&#039; to find mac address and IP pairs. Hopefully that will get the job done.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8093">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ussx</div>
					<div class="post-datetime">
						7 Jun 2005, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>An idea :<br />install a serial port and add a GPS to car AP<br />your car AP roams and sent location to information server</p><p><a href="http://jdc.parodius.com/wrt54g/serial.html">http://jdc.parodius.com/wrt54g/serial.html</a></p><p><a href="http://www.boondog.com/%5Ctutorials%5Cgps%5Cgps.html">http://www.boondog.com/%5Ctutorials%5Cgps%5Cgps.html</a></p>											<p class="post-edited">(Last edited by <strong>ussx</strong> on 7 Jun 2005, 12:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8105">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">seanf</div>
					<div class="post-datetime">
						7 Jun 2005, 19:27					</div>
				</div>
				<div class="post-content content">
					<p>GPS was what came to my mind immediately as well, however, one of the requirements is no subscription fees.</p><p>Also, how would I upload the GPS coordinates? I&#039;d have to wait until I reached one of my AP&#039;s, which would basically accomplish what I&#039;m doing now, but with more equipment to buy.</p><p>Thanks for the link to the serial port hack. Eventually I may add cameras to take pictures of how crowded the shuttle is.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8110">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">ussx</div>
					<div class="post-datetime">
						7 Jun 2005, 21:06					</div>
				</div>
				<div class="post-content content">
					<p>Got an other idea, heared it somewhere.</p><p>It&#039;s called foxhunt, played by radio amatures<br />place your ap&#039;s in a grid and measure the signal strength, i think it comes in a variable from WL or something else<br />it requires some test measurements to oak the thing but it&#039;s maybe possible at your campus.<br />with the required effort it should work</p><p>was thinking of doing the same thing in my free time, but at the moment i aint got any</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8111">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">seanf</div>
					<div class="post-datetime">
						7 Jun 2005, 21:18					</div>
				</div>
				<div class="post-content content">
					<p>Good idea. I&#039;m assuming this will use some sort of triangulation? Again I run into this problem of uploading the location data to the web where everyone can see it.</p><p>There is something out there called Place Lab that uses a passive technique to locate wireless access points, (can be anybody&#039;s), and then uses those positions, (which you entered into a DB earlier using war driving techniques), and signal strength to calculate your GPS coordinates. I think this is what foxhunting comes down to. It&#039;s really cool: <a href="http://www.placelab.org">http://www.placelab.org</a>/ </p><p>I thought that maybe I could use a series 60 phone and then send back the coordinates every so often using SMS - but again, I run into subscription fees. Maybe the UofA will get off their butts and install a wireless network across campus - that would solve all of my woes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8114">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">NateTrue</div>
					<div class="post-datetime">
						7 Jun 2005, 21:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>GPS was what came to my mind immediately as well, however, one of the requirements is no subscription fees.</p></blockquote></div><p>GPS is free for everybody in the world - no subscription fees.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8123">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">seanf</div>
					<div class="post-datetime">
						8 Jun 2005, 04:16					</div>
				</div>
				<div class="post-content content">
					<p>So I just need a GPS device? For some reason I thought I would need to pay a subscription. Thanks for the heads up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8165">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mrmoj</div>
					<div class="post-datetime">
						8 Jun 2005, 21:23					</div>
				</div>
				<div class="post-content content">
					<p>Hiya.</p><p>you only need a gps and a compatible cable connecting it to a serial or usb port for you.&nbsp; Verry cool!</p><p>I guess I would set up routing on the stationary APs to allow the mobile APs access to some part of your bigger network when they associate.&nbsp; My best results were obtained running all nodes in adhoc mode instead of AP, and with static IPs, and run an olsr daemon on each node to continually check for neighbors.&nbsp; This can be done every 0.05s or so, more than adequate.&nbsp; then, do one of the following:</p><p>1 - put a chunk of php on the web server that records a position for a shuttle and have the shuttles repeatedly try to access that php. eg, the shuttles have a shell script that has:<br /></p><div class="codebox"><pre><code>$curgps= $(get latest LL sentence from GPS)
$curlat = $(judicious use of &#039;cut&#039; to get lat from $curgps)
$curlong = $(judicious use of &#039;cut&#039; to get long from $curgps)
$thepass=$(make from $curlat and $curlong in a way webserver will be able to interpret)
wget -q http://ip.of.web.server/folder/update.php?shuttle_num=3&amp;gpslat=$curlat&amp;gpslong=$curlong&amp;password=$thepass&#039;
sleep 1s</code></pre></div><p>in a while true loop and the web server has a php file that might be pseudocoded like:<br /></p><div class="codebox"><pre><code>&lt;?php
  if (password, curlat, and curlong were sent and password is properly constructed)
  {
    system(&quot;mkdir -p nodes&quot;);
    open a text file, overwriting current contents in the name of &quot;nodes/shuttle_num&quot;
    put in file &quot;curlat\ncurlong\n&quot; and close it
 }
  else
    echo &#039;proper unusage ocurred&#039;;
?&gt;</code></pre></div><p>then for your public-viewable page, simply<br /></p><div class="codebox"><pre><code>&lt;?php
  system(&quot;ls -1 --color=no --almost-all nodes &gt; just_a_file&quot;);
  $a = file(&quot;just_a_file&quot;); system(&quot;rm just_a_file&quot;);
  // get a map ready
  foreach ($a as $b)
  {
    //open the file called $b, grab the lat and lon, plot on map
  }
  //show map to users,
  //refresh often
?&gt;</code></pre></div><p>or, 2 - set up public/private key authentication on all the nodes, and do a shell script like this:<br /></p><div class="codebox"><pre><code>$curgps= $(get latest LL sentence from GPS)
$curlat = $(judicious use of &#039;cut&#039; to get lat)
$curlong = $(judicious use of &#039;cut&#039; to get long)
#now make a file called shuttleX where X is some id of the shuttle
//put $curlat and $curlong in it as before, then, assuming shuttle number 3,
scp shuttle3 webserver:/var/www/html/myfolder/shuttle3
sleep 1s;</code></pre></div><p>in a while true loop again, of course.&nbsp; Then do something similar to the web server as discussed above in part 1, for the public-viewable page.</p><p>I do recommend using olsr, as the routing tables update fairly quickly upon neighbor recognition.&nbsp; It happens independent of ad-hoc association, which I&#039;m not sure how to be notified of.&nbsp; but when you can ping your shuttle, it&#039;s in range.&nbsp; I&#039;ve done something like <br /></p><div class="codebox"><pre><code>if [ &quot;`route -n | grep UH | cut -d&#039; &#039; -f 1 | grep -c 192\.168\.1\.74`&quot; -ne &quot;0&quot; ]</code></pre></div><p>to see if a neighbor exists presently.&nbsp; running -n to route makes it quick and the UH is something that seems pretty reliable to detect olsr routes.</p><p>hope this helps!</p><p>P.S.&nbsp; I&#039;ve set up a similar system.&nbsp; some preliminary pics can be found at <br /><a href="http://img.photobucket.com/albums/v342/mrmoj/stc.png">http://img.photobucket.com/albums/v342/mrmoj/stc.png</a><br /><a href="http://img.photobucket.com/albums/v342/mrmoj/dt.png">http://img.photobucket.com/albums/v342/mrmoj/dt.png</a></p><p>and at <a href="http://doctormojo.com/wrt54g/mesh_status/">http://doctormojo.com/wrt54g/mesh_status/</a> you can see an olsr network rearrange itself.&nbsp; (the image redraws itself every five seconds, and if there are only three nodes, the topology is pretty dull most of the time.&nbsp; But people walking between the nodes causes it to rearrange itself into some cool shapes.)</p><br /><p>Moj</p>											<p class="post-edited">(Last edited by <strong>mrmoj</strong> on 8 Jun 2005, 23:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8172">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mrmoj</div>
					<div class="post-datetime">
						8 Jun 2005, 23:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>seanf wrote:</cite><blockquote><p>I think I found what I&#039;m looking for. I can use &#039;arp&#039;, or just &#039;cat /proc/net/arp&#039; to find mac address and IP pairs. Hopefully that will get the job done.</p></blockquote></div><p>I&#039;m not sure how long the arp cache keeps entries in it, but it&#039;s probable they might remain long after a shuttle has left the stop.</p><p>Also, I can&#039;t see why the arp cache would have any entries before you&#039;ve commenced ip traffic.&nbsp; no ping or ssh (etc), no entry in the arp cache.&nbsp; So your mobile nodes would probably have to be pinging the stationary nodes constantly to keep refreshing the arp cache to make this method work, hence static ips a must..</p><p>but then again, olsr is ip traffic, so if you were to use olsr, catting the arp cache would work for you, aside from the stale entries problem aforementioned.</p><p>moj</p>											<p class="post-edited">(Last edited by <strong>mrmoj</strong> on 8 Jun 2005, 23:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8177">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">frogzoo</div>
					<div class="post-datetime">
						9 Jun 2005, 05:10					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m doing something similiar:</p><p>Have a GPS unit &amp; a CDMA modem but you could use GSM</p><p>With the dual serial mod, you&#039;re good to go.</p>											<p class="post-edited">(Last edited by <strong>frogzoo</strong> on 10 Jun 2005, 02:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8200">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">jeff</div>
					<div class="post-datetime">
						9 Jun 2005, 21:50					</div>
				</div>
				<div class="post-content content">
					<p>Why don&#039;t you put the cron events on the AP&#039;s riding the bus (assuming their OpenWRT, too). A 15-second sleeping script loop may do the trick as well.</p><p>Have each bus AP search for bus stop APs constantly. Once succesfully connected, send whatever info you were looking for to a central server for coordination and processing.</p><p>Depending on your storage needs, the &quot;central&quot; server could even be one of your standing boxes...</p><p>Also, if you want to tweak the range at which the AP is &quot;discoverable&quot;, so that you can control how close a bus is to each stop, you can either modify antenna power or build a script to check signal strength.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8212">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">seanf</div>
					<div class="post-datetime">
						10 Jun 2005, 04:16					</div>
				</div>
				<div class="post-content content">
					<p>Good advice all around. I have so much stuff to try now. :-)<br />I&#039;ll probably put together something that looks very similar to what mmroj put together - in fact this is exactly what I was leaning towards. Then once that&#039;s up I will see what I can do with those serial ports - possibly add a gps unit with a cdma modem, or sensors to count passengers as the enter and exit the shuttle...who knows. I&#039;ll have to find out what they want.</p><p>I&#039;ll let you all know how it turns out. Thanks again for the advice - openWRT certainly seems to have an excellent community around it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8214">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">inh</div>
					<div class="post-datetime">
						10 Jun 2005, 04:41					</div>
				</div>
				<div class="post-content content">
					<p>Heres what id do. Looks spiffy too <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>Hook up a gps, and run gpsd on the wrt&#039;s (would have to port it) and then on a webserver, you make a php script that connects to the routers on the gpsd port, gets the gps data, and then (this is the cool part) uses a google maps hack to display the position. Its an awesome effect (one i have actually done.) Loads more info <a href="http://stuff.rancidbacon.com/gmaps-standalone/">http://stuff.rancidbacon.com/gmaps-standalone/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8256">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">jeff</div>
					<div class="post-datetime">
						11 Jun 2005, 08:21					</div>
				</div>
				<div class="post-content content">
					<p>Slightly off-topic, but beware of unauthorized Google Maps hacks.. They&#039;re being nice about it, but it doesn&#039;t mean they&#039;re not serious....</p><p>Takedown story: <a href="http://slashdot.org/article.pl?sid=05/06/08/203208&amp;tid=217&amp;tid=1">http://slashdot.org/article.pl?sid=05/0 … &amp;tid=1</a></p><p>Google Maps terms: <a href="http://www.google.com/help/terms_local.html">http://www.google.com/help/terms_local.html</a></p>											<p class="post-edited">(Last edited by <strong>jeff</strong> on 11 Jun 2005, 08:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p13892">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">0xc0de</div>
					<div class="post-datetime">
						18 Oct 2005, 08:46					</div>
				</div>
				<div class="post-content content">
					<p>I am working on a GPSD / TNC based APRS tracker using the Linksys 54g.</p><p>At this point I have two serial ports working and GPSD compiled into a flash image based on White Russian RC3.&nbsp; If you would like to track my program check my blog at <a href="http://www.grennan.com">www.grennan.com</a>.&nbsp; &nbsp;</p><p>I would like to get GPSD included in the OpenWRT project.&nbsp; I am willing to maintain the GPSD codebase.&nbsp; How is the package manager?&nbsp; Is there a document / FAQ on becoming a package contributer?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p13894">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">dl</div>
					<div class="post-datetime">
						18 Oct 2005, 08:58					</div>
				</div>
				<div class="post-content content">
					<p>My thought (as has already been suggested) is to do a scan and use signal strength. But if you don&#039;t need to communicate with the buses otherwise the thing to do would be to put the bustops in client mode, buses in ap, each with a unique ssid. Then you could either cron or run continuously a job which did a scan/scanresults and sent the data to a central server for processing. You might even be able to triangulate a bit if two or more bus stops registered a bus at the same time.</p><p>but of course gps is a better solution but perhaps not as much fun <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>- DL</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14021">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">frogzoo</div>
					<div class="post-datetime">
						20 Oct 2005, 10:55					</div>
				</div>
				<div class="post-content content">
					<p>0xc0de,<br />I&#039;d very much like to use your port. There&#039;s a HowTo explaining the packaging process here: <a href="http://wiki.openwrt.org/BuildingPackagesHowTo">http://wiki.openwrt.org/BuildingPackagesHowTo</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14514">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">0xc0de</div>
					<div class="post-datetime">
						29 Oct 2005, 22:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dl wrote:</cite><blockquote><p>You might even be able to triangulate a bit if two or more bus stops registered a bus at the same time.</p></blockquote></div><p>I an KISS kind of guy so if there is a way to do it with less hardware I&#039;m very happy to go that directrion.&nbsp; So, I like your idea of doing it without a GPS.&nbsp; So the question is which is more complex,&nbsp; supporting lots of access points at bus stops, or using a GPS and reporting over a radio instead of WiFi.</p><p>Maybe there is another agenda/advantabe.&nbsp; People could use the WiFi at all the bus stops?</p><p>Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14515">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">0xc0de</div>
					<div class="post-datetime">
						29 Oct 2005, 22:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>frogzoo wrote:</cite><blockquote><p>0xc0de,<br />I&#039;d very much like to use your port. There&#039;s a HowTo explaining the packaging process here: <a href="http://wiki.openwrt.org/BuildingPackagesHowTo">http://wiki.openwrt.org/BuildingPackagesHowTo</a></p></blockquote></div><p>No problem.&nbsp; All my work, code, documentation and HowTo&#039;s even if they are just information on where to download stuff from will be avaible at my web site.&nbsp; <a href="http://www.grennan.com">www.grennan.com</a>.</p><p>My HAM friends are watch as I get the work done. Some are helping with hardware stuff like the best way to power the WRT so the &quot;Car Power&quot; can&#039;t kill it. (Battary backup?)&nbsp; Others are working on Docs.</p><p>Anyway, the project is just geting started but I do plan to have a working units and where/how to get the code my spring.&nbsp; The coding should be done my January.</p><p>mark</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>