<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ath9k on broadcom cpu (on WL500gP)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p74363">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">SR</div>
					<div class="post-datetime">
						7 Oct 2008, 21:53					</div>
				</div>
				<div class="post-content content">
					<p>I have TP-Link TL-WN961N minipci wi-fi adapter (with Atheros AR5416+AR2133 chipset, works with linux on pc) and wl-500gP router. Is it possible to build ath9k driver for broadcom cpu to get this card working on wl-500gP?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p75177">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">SR</div>
					<div class="post-datetime">
						22 Oct 2008, 19:13					</div>
				</div>
				<div class="post-content content">
					<p>It turns out wl500gP and&nbsp; works great with madwifi in b/g mode (but not n) as AP. And the signal quality is good (better then with original card).<br />I&#039;ve also compiled ath9k for wl500gP. If I connect first two antennas (to the connectors witch are marked as 0 and 1 on mini pci card) I can ifconfig wlan0 up interface scan networks and get it working as client. But I can&#039;t get it working in&nbsp; AP mode (everything seems ok, but I can&#039;t see AP when I scan networks and I can&#039;t connect to it).<br />If I connect 3 antennas (or one of antennas if I use only two) to connector witch is marked as 2 on mini pci card then I can&#039;t even bring interface up. This is what I get in dmesg (on r13011):<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# dmesg
Linux version 2.6.25.17 (sr@darkstar) (gcc version 4.1.2) #4 Mon Oct 20 14:08:16 MSD 2008
console [early0] enabled
CPU revision is: 00029006 (Broadcom BCM3302)
ssb: Core 0 found: ChipCommon (cc 0x800, rev 0x03, vendor 0x4243)
ssb: Core 1 found: Fast Ethernet (cc 0x806, rev 0x06, vendor 0x4243)
ssb: Core 2 found: Fast Ethernet (cc 0x806, rev 0x06, vendor 0x4243)
ssb: Core 3 found: USB 1.1 Hostdev (cc 0x808, rev 0x03, vendor 0x4243)
ssb: Core 4 found: PCI (cc 0x804, rev 0x08, vendor 0x4243)
ssb: Core 5 found: MIPS 3302 (cc 0x816, rev 0x03, vendor 0x4243)
ssb: Core 6 found: V90 (cc 0x807, rev 0x02, vendor 0x4243)
ssb: Core 7 found: IPSEC (cc 0x80B, rev 0x00, vendor 0x4243)
ssb: Core 8 found: MEMC SDRAM (cc 0x80F, rev 0x02, vendor 0x4243)
ssb: Initializing MIPS core...
ssb: set_irq: core 0x0806, irq 2 =&gt; 2
ssb: set_irq: core 0x0806, irq 3 =&gt; 3
ssb: set_irq: core 0x0804, irq 0 =&gt; 4
ssb: Sonics Silicon Backplane found at address 0x18000000
Serial init done.
Determined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Entering add_active_range(0, 0, 8192) 0 entries of 256 used
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal          0 -&gt;     8192
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0:        0 -&gt;     8192
On node 0 totalpages: 8192
  Normal zone: 64 pages used for memmap
  Normal zone: 0 pages reserved
  Normal zone: 8128 pages, LIFO batch:0
  Movable zone: 0 pages used for memmap
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,115200
Primary instruction cache 16kB, VIPT, 2-way, linesize 16 bytes.
Primary data cache 16kB, 2-way, VIPT, cache aliases, linesize 16 bytes
Synthesized clear page handler (26 instructions).
Synthesized copy page handler (46 instructions).
PID hash table entries: 128 (order: 7, 512 bytes)
console handover: boot [early0] -&gt; real [ttyS0]
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 29912k/32768k available (1996k kernel code, 2856k reserved, 301k data, 128k init, 0k highmem)
Calibrating delay loop... 263.16 BogoMIPS (lpj=526336)
Mount-cache hash table entries: 512
net_namespace: 444 bytes
NET: Registered protocol family 16
Switched to high resolution mode on CPU 0
ssb: PCIcore in host mode found
Registering a PCI bus after boot
PCI: Fixing up bridge 0000:00:00.0
PCI: Setting latency timer of device 0000:00:00.0 to 64
PCI: Fixing up device 0000:00:00.0
PCI: Fixing latency timer of device 0000:00:00.0 to 168
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP reno registered
detected lzma initramfs
initramfs: LZMA lc=1,lp=2,pb=2,origSize=512
squashfs: version 3.0 (2006/03/15) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  Ð’Â© 2001-2006 Red Hat, Inc.
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver $Revision: 1.90 $ 2 ports, IRQ sharing enabled
serial8250: ttyS0 at MMIO 0x0 (irq = 3) is a 16550A
serial8250: ttyS1 at MMIO 0x0 (irq = 3) is a 16550A
serial8250 serial8250.0: unable to register port at index 0 (IO0 MEMb8000300 IRQ3): -28
serial8250 serial8250.0: unable to register port at index 1 (IO0 MEMb8000400 IRQ3): -28
b44.c:v2.0
eth0: Broadcom 44xx/47xx 10/100BaseT Ethernet 00:1d:60:86:35:b9
eth1: Broadcom 44xx/47xx 10/100BaseT Ethernet 40:10:18:00:00:2d
flash init: 0x1c000000 0x02000000
Physically mapped flash: Found 1 x16 devices at 0x0 in 16-bit bank
Physically mapped flash: Found an alias at 0x800000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x1000000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x1800000 for the chip at 0x0
 Amd/Fujitsu Extended Query Table at 0x0040
Physically mapped flash: CFI does not contain boot bank location. Assuming top.
number of CFI chips: 1
cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
Flash device: 0x800000 at 0x1fc00000
bootloader size: 262144
Creating 4 MTD partitions on &quot;Physically mapped flash&quot;:
0x00000000-0x00040000 : &quot;cfe&quot;
0x00040000-0x007f0000 : &quot;linux&quot;
0x000f7800-0x007f0000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; doesn&#039;t start on an erase block boundary -- force read-only
mtd: partition &quot;rootfs&quot; set to be root filesystem
mtd: partition &quot;rootfs_data&quot; created automatically, ofs=300000, len=4F0000
0x00300000-0x007f0000 : &quot;rootfs_data&quot;
0x007f0000-0x00800000 : &quot;nvram&quot;
TCP vegas registered
NET: Registered protocol family 1
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
VFS: Mounted root (squashfs filesystem) readonly.
Freeing unused kernel memory: 128k freed
Please be patient, while OpenWrt loads ...
Algorithmics/MIPS FPU Emulator v1.5
diag: Detected &#039;ASUS WL-500g Premium&#039;
b44: eth0: Link is up at 100 Mbps, full duplex.
b44: eth0: Flow control is off for TX and off for RX.
roboswitch: Probing device eth0: found!
BFL_ENETADM not set in boardflags. Use force=1 to ignore.
b44: eth0: powering down PHY
mini_fo: using base directory: /
mini_fo: using storage directory: /jffs
b44: eth0: Link is up at 100 Mbps, full duplex.
b44: eth0: Flow control is off for TX and off for RX.
br-lan: Dropping NETIF_F_UFO since no NETIF_F_HW_CSUM feature.
device eth0.0 entered promiscuous mode
device eth0 entered promiscuous mode
br-lan: port 1(eth0.0) entering learning state
br-lan: topology change detected, propagating
br-lan: port 1(eth0.0) entering forwarding state
SCSI subsystem initialized
BFL_ENETADM not set in boardflags. Use force=1 to ignore.
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
ath9k: 0.1
PCI: Enabling device 0000:00:02.0 (0000 -&gt; 0002)
PCI: Fixing up device 0000:00:02.0
phy0: Selected rate control algorithm &#039;ath9k_rate_control&#039;
phy0: Atheros 5416: mem=0xc0120000, irq=6
PPP generic driver version 2.4.2
PPP MPPE Compression module registered
ip_tables: (C) 2000-2006 Netfilter Core Team
Driver &#039;sd&#039; needs updating - please use bus_type methods
nf_conntrack version 0.5.0 (1024 buckets, 4096 max)
PCI: Enabling device 0000:00:03.2 (0000 -&gt; 0002)http://sr.uz/media/blogs/sr/img/wl500gP3.jpg
PCI: Fixing up device 0000:00:03.2
ehci_hcd 0000:00:03.2: EHCI Host Controller
ehci_hcd 0000:00:03.2: new USB bus registered, assigned bus number 1
ehci_hcd 0000:00:03.2: irq 6, io mem 0x40010000
ehci_hcd 0000:00:03.2: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 4 ports detected
Initializing USB Mass Storage driver...
usbcore: registered new interface driver usb-storage
USB Mass Storage support registered.
device wlan0 entered promiscuous mode
br-lan: port 2(wlan0) entering disabled state
ath9k_add_interface: Only STA and IBSS are supported currently</code></pre></div><p>What is the problem? And is it possible to get wifi in AP mode with ath9k?</p><p>ps. Here is an image of wl-500gP v1 with 3 antennas (I wander was asus planning to make router with 3 antennas or is it just luck that they fit so great?):<br /><span class="postimg"><img src="http://sr.uz/media/blogs/sr/img/wl500gP3.jpg" alt="http://sr.uz/media/blogs/sr/img/wl500gP3.jpg" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p75178">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						22 Oct 2008, 19:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi.</p><p>Nice work!<br />But, the problem seems to be &quot;ath9k_add_interface: Only STA and IBSS are supported currently&quot;.</p><p>I guess you have to wait until ath9k gains AP mode support.</p><p>~ JoW</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p75360">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">SR</div>
					<div class="post-datetime">
						25 Oct 2008, 16:33					</div>
				</div>
				<div class="post-content content">
					<p>Are there any plans to make AP support in ath9k in nearest future? Or maybe it is possible to make AP using something like hostapd?</p>											<p class="post-edited">(Last edited by <strong>SR</strong> on 25 Oct 2008, 16:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p78118">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">ausean</div>
					<div class="post-datetime">
						15 Dec 2008, 10:41					</div>
				</div>
				<div class="post-content content">
					<p>hi</p><p>There was a patch submitted by kaloz on 12/03/08 (titled: add two patches for ath9k 802.11n AP mode ) for changeset 13497 (<a href="https://dev.openwrt.org/changeset/13497">https://dev.openwrt.org/changeset/13497</a>).</p><p>But this patch was not included in the latest trunk (13644).</p><p>Anyone knows why ?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p78262">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">RoundSparrow</div>
					<div class="post-datetime">
						17 Dec 2008, 06:40					</div>
				</div>
				<div class="post-content content">
					<p>I too am interested in ath9k AP mode.</p><p>AP81 based routers need replacement for:<br />wifi0: Atheros AR9100 WiSoC: mem=0xb80c0000, irq=2</p>											<p class="post-edited">(Last edited by <strong>RoundSparrow</strong> on 17 Dec 2008, 08:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p78285">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ojl</div>
					<div class="post-datetime">
						17 Dec 2008, 17:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SR wrote:</cite><blockquote><p>What is the problem? And is it possible to get wifi in AP mode with ath9k?</p></blockquote></div><p>AP mode doesn&#039;t work in ath9k/ath5k yet. See <a href="http://wireless.kernel.org/en/users/Drivers/ath9k">http://wireless.kernel.org/en/users/Drivers/ath9k</a> .</p><div class="quotebox"><cite>SR wrote:</cite><blockquote><p>ps. Here is an image of wl-500gP v1 with 3 antennas (I wander was asus planning to make router with 3 antennas or is it just luck that they fit so great?):</p></blockquote></div><p>They do have a three-antenna model, WL-500W. Here&#039;s pic with an original WLAN miniPCI (bcm4321, n-draft):</p><p><span class="postimg"><img src="http://gearloose.tontut.fi/~kurkku/kuvat/misc/asus_wl500w.jpg" alt="http://gearloose.tontut.fi/~kurkku/kuvat/misc/asus_wl500w.jpg" /></span></p><p>-- <br />kurkku</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79553">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">RoundSparrow</div>
					<div class="post-datetime">
						13 Jan 2009, 04:34					</div>
				</div>
				<div class="post-content content">
					<p>I do want to post here on this thread that the ath9k drivers do now work in AP mode in trunk (Openwrt-dev branch)!&nbsp; We have even managed to get them to work in 802.11n mode with compile option to hostapd.&nbsp; See the ar9102/ar9103 thread: <a href="http://forum.openwrt.org/viewtopic.php?id=18113">http://forum.openwrt.org/viewtopic.php?id=18113</a></p><p>On the AHB bus we have some performance issues with hostapd+ath9k with CPU usage and softirq - I&#039;m curious if someone with the PCI bus cards have the same issues?</p>											<p class="post-edited">(Last edited by <strong>RoundSparrow</strong> on 13 Jan 2009, 04:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79565">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						13 Jan 2009, 11:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SR wrote:</cite><blockquote><p>ps. Here is an image of wl-500gP v1 with 3 antennas (I wander was asus planning to make router with 3 antennas or is it just luck that they fit so great?):<br /><a href="http://sr.uz/media/blogs/sr/img/wl500gP3.jpg">http://sr.uz/media/blogs/sr/img/wl500gP3.jpg</a></p></blockquote></div><p>Did you do it on your own ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79586">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">SR</div>
					<div class="post-datetime">
						13 Jan 2009, 20:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RoundSparrow wrote:</cite><blockquote><p>I do want to post here on this thread that the ath9k drivers do now work in AP mode in trunk (Openwrt-dev branch)!&nbsp; We have even managed to get them to work in 802.11n mode with compile option to hostapd.&nbsp; See the ar9102/ar9103 thread: <a href="http://forum.openwrt.org/viewtopic.php?id=18113">http://forum.openwrt.org/viewtopic.php?id=18113</a></p><p>On the AHB bus we have some performance issues with hostapd+ath9k with CPU usage and softirq - I&#039;m curious if someone with the PCI bus cards have the same issues?</p></blockquote></div><p>I will try to get it working with my card.</p><div class="quotebox"><cite>Tex-Twil wrote:</cite><blockquote><p>Did you do it on your own ?</p></blockquote></div><p>Yes. The only problem was to find antennas.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79588">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						13 Jan 2009, 20:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SR wrote:</cite><blockquote><div class="quotebox"><cite>RoundSparrow wrote:</cite><blockquote><p>I do want to post here on this thread that the ath9k drivers do now work in AP mode in trunk (Openwrt-dev branch)!&nbsp; We have even managed to get them to work in 802.11n mode with compile option to hostapd.&nbsp; See the ar9102/ar9103 thread: <a href="http://forum.openwrt.org/viewtopic.php?id=18113">http://forum.openwrt.org/viewtopic.php?id=18113</a></p><p>On the AHB bus we have some performance issues with hostapd+ath9k with CPU usage and softirq - I&#039;m curious if someone with the PCI bus cards have the same issues?</p></blockquote></div><p>I will try to get it working with my card.</p><div class="quotebox"><cite>Tex-Twil wrote:</cite><blockquote><p>Did you do it on your own ?</p></blockquote></div><p>Yes. The only problem was to find antennas.</p></blockquote></div><p>ok, nice job. Actually I wanted to do the same but I thought that the 802.11n is still not supported on Atheros. plus I just got myself an Airport Express <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79590">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">RoundSparrow</div>
					<div class="post-datetime">
						13 Jan 2009, 20:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Tex-Twil wrote:</cite><blockquote><p>ok, nice job. Actually I wanted to do the same but I thought that the 802.11n is still not supported on Atheros. plus I just got myself an Airport Express <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>I think the word &quot;supported&quot; gets a bit overused here <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />&nbsp; How about &quot;possibly working&quot; and &quot;needs testing feedback&quot; <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82385">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">jhoderd</div>
					<div class="post-datetime">
						22 Feb 2009, 17:54					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m looking on doing something like this.&nbsp; Can you report if the performance benefits make it worth it? Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82973">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Yura80</div>
					<div class="post-datetime">
						1 Mar 2009, 20:15					</div>
				</div>
				<div class="post-content content">
					<p>Here is my experience with ath9k: <a href="http://forum.openwrt.org/viewtopic.php?pid=82969#p82969">http://forum.openwrt.org/viewtopic.php?pid=82969#p82969</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>