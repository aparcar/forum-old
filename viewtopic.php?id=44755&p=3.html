<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link TL-MR13U - small router with built-in 10,400 mAh battery</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Jun 2015 and 22 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 5</div><nav><ul><li><a href="viewtopic.php%3Fid=44755&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=44755&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=5.html">5</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p209222">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						8 Aug 2013, 02:42					</div>
				</div>
				<div class="post-content content">
					<p>Thanks @otlabs! I&#039;m not sure if I&#039;m brave enough to test it though <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209939">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">p4trykx</div>
					<div class="post-datetime">
						16 Aug 2013, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>I just received my MR-13u and I have a question about charging. I connected a charger to &quot;power&quot; micro USB and I have only the red led. I don&#039;t know if it&#039;s charging or not. The router seems to be cold. How long does it take to charge ii to full?<br/>I use a charger from Kindle Fire so it should provide enough power.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209946">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">Boompje123</div>
					<div class="post-datetime">
						16 Aug 2013, 16:57					</div>
				</div>
				<div class="post-content content">
					<p>I wouldn&#039;t be susprised if it needs 8 to 10 hours to fully charge<br/>I have a powerbank with the same capacity which needs that long to charge</p><p>And: on my mr10u, when I connect the power cable to charge, I get a red led too. So it sounds right to me!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209950">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">p4trykx</div>
					<div class="post-datetime">
						16 Aug 2013, 18:08					</div>
				</div>
				<div class="post-content content">
					<p>I just measured with energy meter and I have 7.5 W at wall wart so it&#039;s around ~1A at 5V and now the red led changed to blue. But it still 7.5W so it&#039;s probably charging.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209952">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						16 Aug 2013, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>You need to wait till you get all 4 blue LEDs on, then they will turn off and your unit is fully charged. It can take upto 10 hours (or even more) to get it fully charged with 1A charger. Be patient, observe how LEDs turn on one by one and enjoy ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209975">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">p4trykx</div>
					<div class="post-datetime">
						16 Aug 2013, 23:48					</div>
				</div>
				<div class="post-content content">
					<p>OK. The leds went off and now it&#039;s draws only about ~2W when turned on.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210045">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">p4trykx</div>
					<div class="post-datetime">
						18 Aug 2013, 00:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>otlabs wrote:</cite><blockquote><p>Christmas comes early this year. Especially for @grayman4hire ;-)</p><p>This patch brings support for TP-Link TL-MR13U in Attitude Adjustment 12.09 (r37729, latest release for AA):</p><br/><p>You can get a patch file, firmware images and some packages from MEGA:</p><p>20130807 (Folder Link, 38.1 MiB)<br/><a href="https://mega.co.nz/#F!UVQmibwD!YYg-tmcyCaZpKtmAOpPsBA">https://mega.co.nz/#F!UVQmibwD!YYg-tmcyCaZpKtmAOpPsBA</a></p><p>WARNING: I had no time to test this build, so use it at your own risk (or wait till I get some time to test it).</p></blockquote></div><p>I installed BB but now I can&#039;t revert to AA. When I run sysupgrade i get <br/></p><div class="codebox"><pre><code>Sysupgrade is not yet supported on unknown.
Image check &#039;platform_check_image&#039; failed.</code></pre></div><p>Can I maybe use --force option?</p><p>Or can I safely run?<br/></p><div class="codebox"><pre><code>mtd -r write openwrt-ar71xx-generic-tl-mr13u-v1-squashfs-sysupgrade.bin firmware</code></pre></div>											<p class="post-edited">(Last edited by <strong>p4trykx</strong> on 18 Aug 2013, 00:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210046">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">Boompje123</div>
					<div class="post-datetime">
						18 Aug 2013, 00:26					</div>
				</div>
				<div class="post-content content">
					<p>probably use mtd instead</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210050">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">p4trykx</div>
					<div class="post-datetime">
						18 Aug 2013, 02:03					</div>
				</div>
				<div class="post-content content">
					<p>OK<br/>mtd works but I wanted to revert to original software and I have some problems.</p><p>I downloaded the original <br/><a href="http://service.tp-link.com.cn/detail_download_1226.html">http://service.tp-link.com.cn/detail_download_1226.html</a><br/>and wanted to flash it with mtd but I get <br/></p><div class="codebox"><pre><code>Writing from /tmp/mr13uv1.bin to firmware ...  [e]Failed to erase block</code></pre></div><p>After that I didn&#039;t reboot and flashed again with OpenWrt.<br/>I looked around and I think that maybe the software form tp-link site has a bootloader in it.<br/>The file has 4,1 MB (4063744 bytes) <br/><a href="http://wiki.openwrt.org/toh/tp-link/tl-wr741nd#back.to.original.firmware">http://wiki.openwrt.org/toh/tp-link/tl-wr741nd#back.to.original.firmware</a><br/>I wonder if there is some way to determine it I have to cut the first 0x20200 bytes from original firmware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210062">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						18 Aug 2013, 09:28					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/toh/tp-link/tl-wr741nd#back.to.original.firmware">http://wiki.openwrt.org/toh/tp-link/tl-wr741nd#back.to.original.firmware</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210097">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">p4trykx</div>
					<div class="post-datetime">
						18 Aug 2013, 20:33					</div>
				</div>
				<div class="post-content content">
					<p>Ok. It worked :-). I will update the Wiki page. <br/>I was wondering if anyone manages to connect to the serial port. I saw some pictures form @slboat<br/><a href="https://forum.openwrt.org/viewtopic.php?pid=209022#p209022">https://forum.openwrt.org/viewtopic.php?pid=209022#p209022</a> <br/>and what I understand from the discussion attaching wires to those TX RX pads does not work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210357">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">rodi</div>
					<div class="post-datetime">
						21 Aug 2013, 22:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>otlabs wrote:</cite><blockquote><p>Christmas comes early this year. Especially for @grayman4hire ;-)</p><p>This patch brings support for TP-Link TL-MR13U in Attitude Adjustment 12.09 (r37729, latest release for AA):</p><br/><p>You can get a patch file, firmware images and some packages from MEGA:</p><p>20130807 (Folder Link, 38.1 MiB)<br/><a href="https://mega.co.nz/#F!UVQmibwD!YYg-tmcyCaZpKtmAOpPsBA">https://mega.co.nz/#F!UVQmibwD!YYg-tmcyCaZpKtmAOpPsBA</a></p><p>WARNING: I had no time to test this build, so use it at your own risk (or wait till I get some time to test it).</p></blockquote></div><p>Because it is not clear from the thread whether this version was so far successfully tested by anyone (AA 12.09, r37729), I would like to share my experience that updating the original TL-MR13U with openwrt-ar71xx-generic-tl-mr13u-v1-squashfs-factory.bin from the above mega link works fine for me. </p><p>The only difference to the description of &#039;otlabs&#039; is that for updating the original TP-Link firmware I used the ethernet cable instead of wifi.&nbsp; May be as a result, the TL-MR13U did not appear at 192.168.1.1 neither with AP nor ROUTER setting of the switch.&nbsp; After switching it to 3G (and power on/off) the device then appeared under 192.168.1.1 and all following steps worked like a charm.</p>											<p class="post-edited">(Last edited by <strong>rodi</strong> on 21 Aug 2013, 22:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210365">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">p4trykx</div>
					<div class="post-datetime">
						21 Aug 2013, 23:36					</div>
				</div>
				<div class="post-content content">
					<p>I anyone&#039;s interested here are Gargoyle images made by Obsy<br/><a href="http://openrouter.info/forum/viewtopic.php?p=30270#p30270">http://openrouter.info/forum/viewtopic.php?p=30270#p30270</a></p><p>U use them now and they are rather stable. The password for access is </p><div class="codebox"><pre><code>password</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210367">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">obsy</div>
					<div class="post-datetime">
						21 Aug 2013, 23:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>p4trykx wrote:</cite><blockquote><p>I anyone&#039;s interested here are Gargoyle images made by Obsy<br/><a href="http://openrouter.info/forum/viewtopic.php?p=30270#p30270">http://openrouter.info/forum/viewtopic.php?p=30270#p30270</a></p><p>U use them now and they are rather stable. The password for access is </p><div class="codebox"><pre><code>password</code></pre></div></blockquote></div><p>FYI: this is Polish version.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212610">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">eddieywlee</div>
					<div class="post-datetime">
						17 Sep 2013, 16:33					</div>
				</div>
				<div class="post-content content">
					<p>Hello all. I just got MR13U. Is there anybody who can provide the latest build for MR13U firmware?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212627">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						17 Sep 2013, 19:20					</div>
				</div>
				<div class="post-content content">
					<p>Yesterday I have re-submitted the patch to OpenWrt-Devel. The patch was updated to accommodate recent changes introduced with: ar71xx: remove fs_* variables from image/Makefile.</p><p>You can get the patch from <a href="http://patchwork.openwrt.org/patch/4063/">http://patchwork.openwrt.org/patch/4063/</a> and compile it by yourself. You will be rewarded with newest kernel 3.10.12!</p><p>As I can see this patch was already delegated to Gabor Juhos, this usually means that in 1-2-3 days were will be an answer, positive or negative, but the answer from OpenWrt team. That&#039;s very good.</p><p>Right now I am unable to generate firmware image for TL-MR13U as I am working on bringing back the deluge torrent client and my development environment is totally broken. Sorry.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212702">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">cz</div>
					<div class="post-datetime">
						18 Sep 2013, 19:32					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m unable to apply patch from <a href="http://patchwork.openwrt.org/patch/4063/">http://patchwork.openwrt.org/patch/4063/</a>&nbsp; on trunk(r38038)<br/></p><div class="codebox"><pre><code>git clone git://git.openwrt.org/openwrt.git openwrt-trunk
cd openwrt-trunk/
wget -O mr13u.patch http://patchwork.openwrt.org/patch/4063/raw/
git apply mr13u.patch</code></pre></div><p>the last command returns &quot;fatal: corrupt patch at line 227&quot;.<br/>Am I doing anything wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212703">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						18 Sep 2013, 19:44					</div>
				</div>
				<div class="post-content content">
					<p>Try:<br/></p><div class="codebox"><pre><code>patch -p1 &lt; mr13u.patch</code></pre></div><p>and let me know about results.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212706">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">cz</div>
					<div class="post-datetime">
						18 Sep 2013, 20:09					</div>
				</div>
				<div class="post-content content">
					<p>&quot;patch -p1 &lt; mr13u.patch&quot; also failed:<br/></p><div class="codebox"><pre><code>patching file target/linux/ar71xx/base-files/etc/diag.sh
Hunk #1 FAILED at 135.
1 out of 1 hunk FAILED -- saving rejects to file target/linux/ar71xx/base-files/etc/diag.sh.rej
patching file target/linux/ar71xx/base-files/etc/uci-defaults/02_network
patching file target/linux/ar71xx/base-files/lib/ar71xx.sh
Hunk #1 FAILED at 141.
Hunk #2 FAILED at 477.
2 out of 2 hunks FAILED -- saving rejects to file target/linux/ar71xx/base-files/lib/ar71xx.sh.rej
patching file target/linux/ar71xx/base-files/lib/upgrade/platform.sh
Hunk #1 FAILED at 161.
1 out of 1 hunk FAILED -- saving rejects to file target/linux/ar71xx/base-files/lib/upgrade/platform.sh.rej
patching file target/linux/ar71xx/config-3.10
patching file target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
patching file target/linux/ar71xx/generic/profiles/tp-link.mk
Hunk #1 succeeded at 38 with fuzz 2.
patching file target/linux/ar71xx/image/Makefile
patch: **** malformed patch at line 220: SingleProfile,TPLINK-LZMA,64kraw,ARCHERC7,archer-c7-v1,ARCHER-C7,t</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212711">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						18 Sep 2013, 20:24					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I was able to exactly reproduce all the error you have reported. I think these errors were introduced by my mail client - it broke several long lines in patch file.</p><p>I will publish the patch here, let me know if it working for you.</p><div class="codebox"><pre><code>---
 target/linux/ar71xx/base-files/etc/diag.sh         |   1 +
 .../ar71xx/base-files/etc/uci-defaults/02_network  |   1 +
 target/linux/ar71xx/base-files/lib/ar71xx.sh       |   6 ++
 .../ar71xx/base-files/lib/upgrade/platform.sh      |   1 +
 target/linux/ar71xx/config-3.10                    |   1 +
 .../ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c   | 107 +++++++++++++++++++++
 target/linux/ar71xx/generic/profiles/tp-link.mk    |  11 +++
 target/linux/ar71xx/image/Makefile                 |   1 +
 .../patches-3.10/930-add-tl-mr13u-support.patch    |  39 ++++++++
 tools/firmware-utils/src/mktplinkfw.c              |   6 ++
 10 files changed, 174 insertions(+)
 create mode 100644 target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
 create mode 100644 target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch

diff --git a/target/linux/ar71xx/base-files/etc/diag.sh b/target/linux/ar71xx/base-files/etc/diag.sh
index 7b790e2..381d4e8 100755
--- a/target/linux/ar71xx/base-files/etc/diag.sh
+++ b/target/linux/ar71xx/base-files/etc/diag.sh
@@ -135,6 +135,7 @@ get_status_led() {
         ;;
     archer-c7 | \
     tl-mr10u | \
+    tl-mr13u | \
     tl-wdr4300 | \
     tl-wr703n | \
     tl-wr710n | \
diff --git a/target/linux/ar71xx/base-files/etc/uci-defaults/02_network b/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
index 176c485..e64d2b4 100755
--- a/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
+++ b/target/linux/ar71xx/base-files/etc/uci-defaults/02_network
@@ -212,6 +212,7 @@ mr600v2 |\
 rb-411 |\
 tl-mr10u |\
 tl-mr11u |\
+tl-mr13u |\
 tl-mr3020 |\
 tl-mr3040 |\
 tl-wa901nd |\
diff --git a/target/linux/ar71xx/base-files/lib/ar71xx.sh b/target/linux/ar71xx/base-files/lib/ar71xx.sh
index e7fbfbe..e61db3d 100755
--- a/target/linux/ar71xx/base-files/lib/ar71xx.sh
+++ b/target/linux/ar71xx/base-files/lib/ar71xx.sh
@@ -141,6 +141,9 @@ tplink_board_detect() {
     &quot;001101&quot;*)
         model=&quot;TP-Link TL-MR11U&quot;
         ;;
+    &quot;001301&quot;*)
+        model=&quot;TP-Link TL-MR13U&quot;
+        ;;
     &quot;302000&quot;*)
         model=&quot;TP-Link TL-MR3020&quot;
         ;;
@@ -477,6 +480,9 @@ ar71xx_board_detect() {
     *&quot;TL-MR11U&quot;)
         name=&quot;tl-mr11u&quot;
         ;;
+    *&quot;TL-MR13U&quot;)
+        name=&quot;tl-mr13u&quot;
+        ;;
     *UniFi)
         name=&quot;unifi&quot;
         ;;
diff --git a/target/linux/ar71xx/base-files/lib/upgrade/platform.sh b/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
index 8294fa4..8fbd395 100755
--- a/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
+++ b/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
@@ -161,6 +161,7 @@ platform_check_image() {
     archer-c7 | \
     tl-mr10u | \
     tl-mr11u | \
+    tl-mr13u | \
     tl-mr3020 | \
     tl-mr3040 | \
     tl-mr3220 | \
diff --git a/target/linux/ar71xx/config-3.10 b/target/linux/ar71xx/config-3.10
index 82559b8..0b91202 100644
--- a/target/linux/ar71xx/config-3.10
+++ b/target/linux/ar71xx/config-3.10
@@ -65,6 +65,7 @@ CONFIG_ATH79_MACH_TEW_632BRP=y
 CONFIG_ATH79_MACH_TEW_673GRU=y
 CONFIG_ATH79_MACH_TEW_712BR=y
 CONFIG_ATH79_MACH_TL_MR11U=y
+CONFIG_ATH79_MACH_TL_MR13U=y
 CONFIG_ATH79_MACH_TL_MR3020=y
 CONFIG_ATH79_MACH_TL_MR3X20=y
 CONFIG_ATH79_MACH_TL_WA901ND=y
diff --git a/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c b/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
new file mode 100644
index 0000000..8b03645
--- /dev/null
+++ b/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-mr13u.c
@@ -0,0 +1,107 @@
+/*
+ *  TP-LINK TL-MR13U board support
+ *
+ *  Copyright (C) 2011 dongyuqi &lt;729650915@qq.com&gt;
+ *  Copyright (C) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;
+ *
+ *  This program is free software; you can redistribute it and/or modify it
+ *  under the terms of the GNU General Public License version 2 as published
+ *  by the Free Software Foundation.
+ */
+
+#include &lt;linux/gpio.h&gt;
+
+#include &lt;asm/mach-ath79/ath79.h&gt;
+
+#include &quot;dev-eth.h&quot;
+#include &quot;dev-gpio-buttons.h&quot;
+#include &quot;dev-leds-gpio.h&quot;
+#include &quot;dev-m25p80.h&quot;
+#include &quot;dev-usb.h&quot;
+#include &quot;dev-wmac.h&quot;
+#include &quot;machtypes.h&quot;
+
+#define TL_MR13U_GPIO_LED_SYSTEM    27
+
+#define TL_MR13U_GPIO_BTN_RESET        11
+#define TL_MR13U_GPIO_BTN_SW1        6
+#define TL_MR13U_GPIO_BTN_SW2        7
+
+#define TL_MR13U_GPIO_USB_POWER        18
+
+#define TL_MR13U_KEYS_POLL_INTERVAL    20    /* msecs */
+#define TL_MR13U_KEYS_DEBOUNCE_INTERVAL    (3 * TL_MR13U_KEYS_POLL_INTERVAL)
+
+static const char *tl_mr13u_part_probes[] = {
+    &quot;tp-link&quot;,
+    NULL,
+};
+
+static struct flash_platform_data tl_mr13u_flash_data = {
+    .part_probes    = tl_mr13u_part_probes,
+};
+
+static struct gpio_led tl_mr13u_leds_gpio[] __initdata = {
+    {
+        .name        = &quot;tp-link:blue:system&quot;,
+        .gpio        = TL_MR13U_GPIO_LED_SYSTEM,
+        .active_low    = 1,
+    },
+};
+
+static struct gpio_keys_button tl_mr13u_gpio_keys[] __initdata = {
+    {
+        .desc        = &quot;reset&quot;,
+        .type        = EV_KEY,
+        .code        = KEY_RESTART,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_RESET,
+        .active_low    = 0,
+    },
+    {
+        .desc        = &quot;sw1&quot;,
+        .type        = EV_KEY,
+        .code        = BTN_0,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_SW1,
+        .active_low    = 0,
+    },
+    {
+        .desc        = &quot;sw2&quot;,
+        .type        = EV_KEY,
+        .code        = BTN_1,
+        .debounce_interval = TL_MR13U_KEYS_DEBOUNCE_INTERVAL,
+        .gpio        = TL_MR13U_GPIO_BTN_SW2,
+        .active_low    = 0,
+    },
+};
+
+static void __init tl_mr13u_setup(void)
+{
+    u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);
+    u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);
+
+    /* disable PHY_SWAP and PHY_ADDR_SWAP bits */
+    ath79_setup_ar933x_phy4_switch(false, false);
+
+    ath79_register_m25p80(&amp;tl_mr13u_flash_data);
+    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_mr13u_leds_gpio),
+                 tl_mr13u_leds_gpio);
+    ath79_register_gpio_keys_polled(-1, TL_MR13U_KEYS_POLL_INTERVAL,
+                    ARRAY_SIZE(tl_mr13u_gpio_keys),
+                    tl_mr13u_gpio_keys);
+
+    gpio_request_one(TL_MR13U_GPIO_USB_POWER,
+             GPIOF_OUT_INIT_HIGH | GPIOF_EXPORT_DIR_FIXED,
+             &quot;USB power&quot;);
+    ath79_register_usb();
+
+    ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+
+    ath79_register_mdio(0, 0x0);
+    ath79_register_eth(0);
+    ath79_register_wmac(ee, mac);
+}
+
+MIPS_MACHINE(ATH79_MACH_TL_MR13U, &quot;TL-MR13U&quot;, &quot;TP-LINK TL-MR13U v1&quot;,
+         tl_mr13u_setup);
diff --git a/target/linux/ar71xx/generic/profiles/tp-link.mk b/target/linux/ar71xx/generic/profiles/tp-link.mk
index e63aa7a..b7d4ec0 100644
--- a/target/linux/ar71xx/generic/profiles/tp-link.mk
+++ b/target/linux/ar71xx/generic/profiles/tp-link.mk
@@ -38,6 +38,17 @@ endef
 $(eval $(call Profile,TLMR11U))
 
 
+define Profile/TLMR13U
+    NAME:=TP-LINK TL-MR13U
+    PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
+endef
+
+define Profile/TLMR13U/Description
+    Package set optimized for the TP-LINK TL-MR13U.
+endef
+$(eval $(call Profile,TLMR13U))
+
+
 define Profile/TLMR3020
     NAME:=TP-LINK TL-MR3020
     PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
diff --git a/target/linux/ar71xx/image/Makefile b/target/linux/ar71xx/image/Makefile
index 7f55e16..2f4aaec 100644
--- a/target/linux/ar71xx/image/Makefile
+++ b/target/linux/ar71xx/image/Makefile
@@ -911,6 +911,7 @@ $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,ARCHERC7,archer-c7-v1,ARCHER-C7,t
 $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR10U,tl-mr10u-v1,TL-MR10U,ttyATH0,115200,0x00100101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR11UV1,tl-mr11u-v1,TL-MR11U,ttyATH0,115200,0x00110101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR11UV2,tl-mr11u-v2,TL-MR11U,ttyATH0,115200,0x00110102,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR13U,tl-mr13u-v1,TL-MR13U,ttyATH0,115200,0x00130101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR3040V1,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR3040V2,tl-mr3040-v2,TL-MR3040,ttyATH0,115200,0x30400002,1,4Mlzma))
diff --git a/target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch b/target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch
new file mode 100644
index 0000000..76891c5
--- /dev/null
+++ b/target/linux/ar71xx/patches-3.10/930-add-tl-mr13u-support.patch
@@ -0,0 +1,39 @@
+--- a/arch/mips/ath79/Kconfig
++++ b/arch/mips/ath79/Kconfig
+@@ -516,6 +516,16 @@ config ATH79_MACH_TL_MR11U
+     select ATH79_DEV_USB
+     select ATH79_DEV_WMAC
+ 
++config ATH79_MACH_TL_MR13U
++    bool &quot;TP-LINK TL-MR13U support&quot;
++    select SOC_AR933X
++    select ATH79_DEV_ETH
++    select ATH79_DEV_GPIO_BUTTONS
++    select ATH79_DEV_LEDS_GPIO
++    select ATH79_DEV_M25P80
++    select ATH79_DEV_USB
++    select ATH79_DEV_WMAC
++
+ config ATH79_MACH_TL_MR3020
+     bool &quot;TP-LINK TL-MR3020 support&quot;
+     select SOC_AR933X
+--- a/arch/mips/ath79/machtypes.h
++++ b/arch/mips/ath79/machtypes.h
+@@ -83,6 +83,7 @@ enum ath79_mach_type {
+     ATH79_MACH_TEW_712BR,        /* TRENDnet TEW-712BR */
+     ATH79_MACH_TL_MR10U,        /* TP-LINK TL-MR10U */
+     ATH79_MACH_TL_MR11U,        /* TP-LINK TL-MR11U */
++    ATH79_MACH_TL_MR13U,        /* TP-LINK TL-MR13U */
+     ATH79_MACH_TL_MR3020,        /* TP-LINK TL-MR3020 */
+     ATH79_MACH_TL_MR3040,        /* TP-LINK TL-MR3040 */
+     ATH79_MACH_TL_MR3220,        /* TP-LINK TL-MR3220 */
+--- a/arch/mips/ath79/Makefile
++++ b/arch/mips/ath79/Makefile
+@@ -79,6 +79,7 @@ obj-$(CONFIG_ATH79_MACH_TEW_632BRP)    += m
+ obj-$(CONFIG_ATH79_MACH_TEW_673GRU)    += mach-tew-673gru.o
+ obj-$(CONFIG_ATH79_MACH_TEW_712BR)    += mach-tew-712br.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR11U)    += mach-tl-mr11u.o
++obj-$(CONFIG_ATH79_MACH_TL_MR13U)    += mach-tl-mr13u.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR3020)    += mach-tl-mr3020.o
+ obj-$(CONFIG_ATH79_MACH_TL_MR3X20)    += mach-tl-mr3x20.o
+ obj-$(CONFIG_ATH79_MACH_TL_WA901ND)    += mach-tl-wa901nd.o
diff --git a/tools/firmware-utils/src/mktplinkfw.c b/tools/firmware-utils/src/mktplinkfw.c
index 19dc2b4..2574678 100644
--- a/tools/firmware-utils/src/mktplinkfw.c
+++ b/tools/firmware-utils/src/mktplinkfw.c
@@ -31,6 +31,7 @@
 
 #define HEADER_VERSION_V1    0x01000000
 #define HWID_TL_MR10U_V1    0x00100101
+#define HWID_TL_MR13U_V1    0x00130101
 #define HWID_TL_MR3020_V1    0x30200001
 #define HWID_TL_MR3220_V1    0x32200001
 #define HWID_TL_MR3220_V2    0x32200002
@@ -199,6 +200,11 @@ static struct board_info boards[] = {
         .hw_rev        = 1,
         .layout_id    = &quot;4Mlzma&quot;,
     }, {
+        .id        = &quot;TL-MR13Uv1&quot;,
+        .hw_id        = HWID_TL_MR13U_V1,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-MR3020v1&quot;,
         .hw_id        = HWID_TL_MR3020_V1,
         .hw_rev        = 1,
-- 
1.8.4</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212715">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">cz</div>
					<div class="post-datetime">
						18 Sep 2013, 20:42					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, this new patch works.</p><p>[EDIT] I can apply the pacth by ignoring whitespace, but build failed:<br/></p><div class="codebox"><pre><code>Applying patch platform/930-add-tl-mr13u-support.patch
patching file arch/mips/ath79/Kconfig
Hunk #1 succeeded at 525 with fuzz 2 (offset 9 lines).
patching file arch/mips/ath79/machtypes.h
Hunk #1 FAILED at 83.
1 out of 1 hunk FAILED -- rejects in file arch/mips/ath79/machtypes.h
patching file arch/mips/ath79/Makefile
Hunk #1 FAILED at 79.
1 out of 1 hunk FAILED -- rejects in file arch/mips/ath79/Makefile
Patch platform/930-add-tl-mr13u-support.patch does not apply (enforce with -f)</code></pre></div><p>I guess it&#039;s because tab being replaced by whitespace.</p>											<p class="post-edited">(Last edited by <strong>cz</strong> on 18 Sep 2013, 21:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212717">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						18 Sep 2013, 21:00					</div>
				</div>
				<div class="post-content content">
					<p>hint:</p><p><a href="http://pastebin.com/">http://pastebin.com/</a></p><p><img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212830">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						20 Sep 2013, 04:15					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s my great pleasure to inform you that TP-Link TL-MR13U is fully supported in trunk!</p><p>Changesets:<br/><a href="https://dev.openwrt.org/changeset/38063">https://dev.openwrt.org/changeset/38063</a><br/><a href="https://dev.openwrt.org/changeset/38064">https://dev.openwrt.org/changeset/38064</a><br/><a href="https://dev.openwrt.org/changeset/38065">https://dev.openwrt.org/changeset/38065</a><br/><a href="https://dev.openwrt.org/changeset/38066">https://dev.openwrt.org/changeset/38066</a></p><p>Snapshot trunk download:<br/><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">http://downloads.openwrt.org/snapshots/trunk/ar71xx/</a> (not available yet)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212834">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">eddieywlee</div>
					<div class="post-datetime">
						20 Sep 2013, 07:47					</div>
				</div>
				<div class="post-content content">
					<p>Thanks a lot otlabs! Very helpful information!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212883">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">otlabs</div>
					<div class="post-datetime">
						21 Sep 2013, 07:42					</div>
				</div>
				<div class="post-content content">
					<p>Ok, the images are ready!</p><p>openwrt-ar71xx-generic-tl-mr13u-v1-squashfs-factory.bin (to be flushed on new devices without OpenWrt):<br/><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-mr13u-v1-squashfs-factory.bin">http://downloads.openwrt.org/snapshots/ … actory.bin</a></p><p>openwrt-ar71xx-generic-tl-mr13u-v1-squashfs-sysupgrade.bin (to be flashed on devices with OpenWrt already installed):<br/><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-mr13u-v1-squashfs-sysupgrade.bin">http://downloads.openwrt.org/snapshots/ … pgrade.bin</a></p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 76 to 75 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 3 of 5</div><nav><ul><li><a href="viewtopic.php%3Fid=44755&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=44755&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=44755&amp;p=5.html">5</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>