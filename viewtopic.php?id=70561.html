<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Any ideas about Turris Omnia vs PC-Engines apu3a2?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p356037">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						11 Apr 2017, 18:32					</div>
				</div>
				<div class="post-content content">
					<p>Hey there.</p><p><strong>Here&#039;s the reason why. Don&#039;t read if you don&#039;t care.</strong></p><p>I just payed a little with a Banana Pi.</p><p>My test scenario currently is<br />* a single NIC (that&#039;s what the Pi has)<br />* providing two VLANs tagged<br />* going into an ESX<br />* where one VM (sender) connects to one VLAN and another VM (receiver) to the second VLAN.<br />* The routing OpenWRT involved doesn&#039;t NAT.</p><p>I get something between 400 and 600MBit from one sender to receiver going through the PI.</p><p>When using my TP-Link 4900 with OpenWRT, I get something bewteen 350 and 400MBit.</p><p>Replacing the Banana Pi with a virtual OpenWRT on Virtualbox on my desktop computer (but still wired through a single tagged vlan cable), I get 950MBit from one VM to the other.</p><p>So I&#039;m pretty sure I get nearly 1GBit full duplex through a single NIC into and out of the ESX at the same time.</p><p>I don&#039;t *need* a new router, I&#039;m just curious and want to play a little. The BananaPi does provide enough performance at the moment. But since things can always get better if you throw more money at them ...</p><p><strong>Here&#039;s the topic</strong></p><p>I&#039;m looking for a &quot;routing device&quot; (doesn&#039;t necessarily be titled as a router by its vendor) that can route something between 800 and 1000MBit from one vlan to another, ideally through a single NIC full duplex.</p><p>I don&#039;t want an OEM router with onboard memory but something that directly boots from either USB or SD-Card where I can just replace the router but keep the OS in place, or just &quot;DD&quot; the entire storage as backup.</p><p>I&#039;m currently thinking about either the PC-Engines apu3a4 or the Turris Omnia.</p><p>I don&#039;t need Wifi (since I have enough APs spread around the house for that purpose), so I&#039;m comparing the No-Wifi versions of both.</p><p>The Turris Omnia has 5 LAN and an SFP. The LAN is clearly a plus I could use, the SFP is currently of no use for me at all.</p><p>The Turris has only 1GB of memory, the APU has 4.</p><p>What do you think about the CPU involved? Can they handle 1GBit routing?<br />What about the NICs of both devices? Can some offloading be enabled to reduce CPU load?</p><p>Any thoughts are welcome, even if you suggest a completely different device.</p><p>I&#039;m asking here because I want OpenWRT on it, no matter which device it will be.</p><p>Regards,<br />Stephan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356046">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Villeneuve</div>
					<div class="post-datetime">
						11 Apr 2017, 19:45					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://www.kickstarter.com/projects/802007522/up-squared-the-first-maker-board-with-intel-apollo">These</a> should start shipping soon.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356071">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">remlei</div>
					<div class="post-datetime">
						12 Apr 2017, 01:15					</div>
				</div>
				<div class="post-content content">
					<p>I think J1800 based motherboard will get you there.</p><p>J1900 is overkill for openwrt, specially that openwrt doesnt use pf (like what freebsd based dsitro like pfsense, monowall etc...) instead uses iptables/netfilter which is not a multi-core friendly.</p><p>But there&#039;s a Qotom J1900 mini pc there, that has 4 Intel NIC on it, its a little bit expensive since (compare to APU based system) you still need to buy a separate RAM for it and SSD (m-sata).</p>											<p class="post-edited">(Last edited by <strong>remlei</strong> on 12 Apr 2017, 01:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356091">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						12 Apr 2017, 10:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>golialive wrote:</cite><blockquote><p>[...]<br />I&#039;m looking for a &quot;routing device&quot; (doesn&#039;t necessarily be titled as a router by its vendor) that can route something between 800 and 1000MBit from one vlan to another, ideally through a single NIC full duplex.<br />[...]</p></blockquote></div><p>Mmh, if you route as VLAN over the same NIC, would your performance ceiling not be half the interface rate if yu test with full duplex saturating load, as each packet will need to go in and out through the same NIC?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356095">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						12 Apr 2017, 12:03					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for the answers.</p><p>Damn, some more device that I&#039;d really like to get my hands on and test <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />.</p><p>The UP could really be a thing. I think I&#039;ll wait for it to be not on pre-order bot regularly available and then give it a shot.</p><p>J1800 and J1900 was something I didn&#039;t even know to search for. But of course, really makes sense to search for the CPU generation.<br />And they aren&#039;t necessarily more expensive then the APU boards.<br /></p><ul><li><p>A PC Engines bundle with board, case, msata and power cord is available for ~190€ here.</p></li><li><p>The Qotom Q190G4N has board, case, msata and RAM just like the PC Engines bundle (it even has 64GB msata compared to the 16GB my APU3A4 comes with) is available for 180€.</p></li></ul><p>Hmm. I guess I&#039;ll give the Qotom a shot. There are of course other vendors providing J1800 or J1900, but the mentioned Qotom is a direct hit with 4 NICs on board, and the price range is right on the spot as well. So really really thank you.</p><p>@moeller0:</p><p>Nope, that&#039;s exactly what &quot;full dupplex&quot; means. 1GBit full duplex of a certain NIC means the very same NIC can handle 1GB in and 1GB out at the same time.</p><p>In contrast, there is &quot;half duplex&quot;, which means data can &quot;virtually&quot; go in and out at the same time (as on &quot;for the application it appears as they are simultaneous), but the actual wire switches fast between in and out and thus can only make the given bandwidth as a combination of in and out.</p><p>If course, in reality there&#039;s always some overlap. If you go TCP, you will get an ACK for every package sent, so sending data in one direction means also receiving confirmation.<br />When I do &quot;iperf -s&quot; on one side and &quot;iperf -c $sender -n 1G&quot; on the other side (which means sending 1GB of data via TCP) over the internet (which means no jumbo frames but MTU in the area of 1500) I have ~2% of ACK traffic, which means &quot;receiving 100MBit requires me to send 2MBit at the same time&quot;. But that&#039;s TCP (OSI layer 4) and has nothing to do with the full duplex capability of my NIC (OSI layer 1/2).</p><p>[edit]</p><p>The thing that goes saturated is sirq, which is not the NIC being at max but the CPU being not capable of handling more interrupts.</p>											<p class="post-edited">(Last edited by <strong>golialive</strong> on 12 Apr 2017, 12:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356160">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						13 Apr 2017, 10:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>golialive wrote:</cite><blockquote><p>[...]<br />@moeller0:</p><p>Nope, that&#039;s exactly what &quot;full dupplex&quot; means. 1GBit full duplex of a certain NIC means the very same NIC can handle 1GB in and 1GB out at the same time.<br />[...]</p></blockquote></div><p>Let&#039;s go through this again, slowly:</p><p>your sender sends over VLAN1 to the receiver, but the data first flows though the Router NIC&#039;s ingress side, where the VLAN is terinated and it is packed into VLAN2 and send on the egress side of the NIC, so this packet occupied both ingress and egress of NIC. Now let&#039;s assume that both VMs send at full blast to the other; still with me?<br />Now, if VM 1 sends at 1Gbps* it will fully saturate the NICs ingress AND egress bandwidth, leaving no space/time for the second VMs packets. So if both send at &quot;full blast&quot; each is only expected to get 500Mbps. If you had a half-duplex NIC you would obviously only achieve 250Mbps.<br />Now, I give you that for one sender you should be able to see throughput close to 1Gbps (baring all other obstacles), if you still disagree, please elucidate...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356161">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						13 Apr 2017, 10:37					</div>
				</div>
				<div class="post-content content">
					<p>Got it. So to clear things up:<br /></p><ul><li><p>I don&#039;t do full duplex data traffic, transmitting from VM1 to VM2 and from VM2 to VM1 with 1GBit at the same time and expect that to reach 1GBit.</p></li><li><p>I only do traffic from VM1 to VM2. VM1 goes vial VLAN1&nbsp; to the router, the router translates it to VLAN2 and sends the data to VM2.</p></li></ul><p>This of course should saturate both directions of the NIC of the router at 100% level as long as no other traffic is involved. And this is the situation where my Banana Pi caps at 400 to 600MBit (depending on settings) and my TP-Link at 350 to 400. Both limited by CPU.</p><p>So we&#039;re clearly on the same page, and probably were from the beginning.</p><p>Sorry for the confusion. I didn&#039;t even think about my explanation could be interpreted like that <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />.</p><p>Regards,<br />Stephan.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>