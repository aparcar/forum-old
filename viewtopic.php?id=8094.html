<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Can&#039;t connect with cable modem?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 11 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p36905">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						10 Nov 2006, 08:45					</div>
				</div>
				<div class="post-content content">
					<p>I have a WRTSL54GS, RC6 installed, and for some reason it won&#039;t sync up with my cable modem (Amit U10C003).&nbsp; I have an older router, works fine.&nbsp; I can power down the cable modem and plug my PowerBook in, bring it up, the PB works fine, so I know that plugging in something with a different MAC address will still get a DHCP address.</p><p>I plug the SL54 in, and the Internet light just blinks constantly, likewise the Ethernet light on the cable modem, and I never pick up an IP address.&nbsp; I can bring up my old router, hook the SL54 into that, gets an IP just fine.&nbsp; I&#039;ve also taken it to work and it&#039;s gotten an IP on the office LAN no problem, so everything works separately, just for some reason not together.</p><p>The last thing I could think of was that the ports weren&#039;t syncing up because of a speed or duplex issue, but I can&#039;t find any way to set the WAN port&#039;s settings in OpenWRT.&nbsp; I did try putting a hub between the cable modem and the SL54 to see if that helped, it didn&#039;t, and I really didn&#039;t expect that to work anyway.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36918">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						10 Nov 2006, 14:17					</div>
				</div>
				<div class="post-content content">
					<p>Have you power cycled your cable modem in-between? Mediacom out here in Iowa will give you only the number of IPs you paid for based on mac addresses- if you power cycle, it gets reset and assigns to new device(s). Some cable providers might require you to register the mac on some sort of a 10.0* page.</p>											<p class="post-edited">(Last edited by <strong>Loconut1389</strong> on 10 Nov 2006, 14:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36919">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						10 Nov 2006, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>Yes, the cable modem is getting power cycled.&nbsp; I can plug anything else I have here in and get it up and running, no MAC registration is needed.&nbsp; Only the SL54 isn&#039;t picking up an IP.</p><p>I may just try reflashing back to the factory firmware just to get OpenWRT out of the picture if nothing eles pops up in this thread today.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36945">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						10 Nov 2006, 22:28					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m more and more convinced that there is something going wrong with the autonegitiation between the router and the cable modem, causing the ports to flap.&nbsp; I&#039;ve found some similar threads here, but not much in the way of resolution:</p><p><a href="http://forum.openwrt.org/viewtopic.php?id=3488">http://forum.openwrt.org/viewtopic.php?id=3488</a></p><p><a href="http://forum.openwrt.org/viewtopic.php?id=3301">http://forum.openwrt.org/viewtopic.php?id=3301</a></p><p>I need to see if I can track down the mentioned robocfg utility...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36967">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						11 Nov 2006, 05:48					</div>
				</div>
				<div class="post-content content">
					<p>Found and installed robocfg, I seemed to be able to enable and disable ports, but I was unable to change the port speed or duplex on the wan port.&nbsp; Grrr...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36972">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						11 Nov 2006, 09:10					</div>
				</div>
				<div class="post-content content">
					<p>sorry i didnt have more info. i hope you figure it out.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p37004">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						12 Nov 2006, 05:43					</div>
				</div>
				<div class="post-content content">
					<p>Ok, new info.&nbsp; I reflashed back to the original Linksys firmware, plugged the router into the cable modem, restarted both, and I did in fact get a valid connection, surfed a few web pages to be sure, all looked good.&nbsp; So, I flashed back to to RC6, let the router restart, and had no connection.</p><p>Interestingly, The OpenWrt Admin web page for LAN did show a correct DNS server listed from my cable provider (could that have been saved from NVRAM?) but it did not show a WAN address under the WAN tab (correctly set for DHCP).&nbsp; So, something in RC6 is preventing a DHCP connection from taking place.&nbsp; Now I&#039;m really stumped...</p><br /><p>Reverting to RC5 made no difference.</p>											<p class="post-edited">(Last edited by <strong>JimWright</strong> on 12 Nov 2006, 06:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p37029">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">MarkMentovai</div>
					<div class="post-datetime">
						12 Nov 2006, 17:39					</div>
				</div>
				<div class="post-content content">
					<p>You can check to see if a DNS server is configured in NVRAM by SSHing to the router and typing <span class="bbu">nvram show | grep dns</span>.&nbsp; If you see something there that you want to get rid of, you can use, for example <span class="bbu">nvram unset wan_dns &amp;&amp; nvram commit</span>.</p><p>At this point, I think it might be wise to sniff a few packets.&nbsp; Get tcpdump installed on the unit - normally, this is as easy as <span class="bbu">ipkg install tcpdump</span> but you might need to fiddle a bit more as this depends on an Internet connection.&nbsp; SSH to the router and type <span class="bbu">ifdown wan</span>.&nbsp; Now, be sure you&#039;ve got a clean slate by removing power from your cable modem, waiting a few seconds, and then plugging it back in.&nbsp; Give it a minute or two to sync up.&nbsp; While you&#039;re waiting, fire up tcpdump on the router: <span class="bbu">tcpdump -i <em>eth1</em> -envvXs1536 port 67 or port 68</span>.&nbsp; (Replace <em>eth1</em> with whatever <span class="bbu">nvram get wan_ifname</span> tells you - I think this is eth1 on yours, but you should double-check.)&nbsp; When your cable modem&#039;s synced up and ready to go, open another SSH connection to your router and type <span class="bbu">ifup wan</span>.&nbsp; Now you can watch tcpdump to see the DHCP packets on the interface you asked for - the ones traveling between your router and cable modem.&nbsp; Is the router talking to the cable modem?&nbsp; Is it getting any responses?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p37042">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						12 Nov 2006, 23:12					</div>
				</div>
				<div class="post-content content">
					<p>I did have that DNS address stuck in the NVRAM, I cleared that out before taking the next steps listed.</p><br /><p>Taking the wan down then back up:</p><div class="codebox"><pre><code>root@OpenWrt:~# ifdown wan
root@OpenWrt:~# ifup wan
info, udhcpc (v0.9.9-pre) started
debug, Sending discover...
root@OpenWrt:~# debug, Sending discover...
debug, Sending discover...
info, No lease, forking to background.</code></pre></div><p>The tcpdump was quiet long, I&#039;m not sure which bits there were relative to this issue:</p><div class="codebox"><pre><code>root@OpenWrt:~# tcpdump -i eth1 -envvXs1536 port 67 or port 68
tcpdump: WARNING: eth1: no IPv4 address assigned
tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 1536 bytes
16:56:02.740466 00:90:4c:60:00:2b &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 590: (tos 0x0, ttl  64, id 0, offset 0, flags [none], proto: UDP (17), length: 576) 0.0.0.0.68 &gt; 255.255.255.255.67: [udp sum ok] BOOTP/DHCP, Request from 00:90:4c:60:00:2b, length: 548, xid:0xb963350f, flags: [none] (0x0000)
          Client Ethernet Address: 00:90:4c:60:00:2b
          Vendor-rfc1048:
            DHCP:DISCOVER
            CID:[ether]00:90:4c:60:00:2b
            VC:&quot;udhcp 0.9.9-pre&quot;
            PR:SM+DG+NS+HN+DN+BR

(hex code clipped)

16:56:07.432038 00:07:0d:ad:2c:54 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 354: (tos 0x0, ttl 255, id 49634, offset 0, flags [none], proto: UDP (17), length: 340) 10.34.32.1.67 &gt; 255.255.255.255.68: [udp sum ok] BOOTP/DHCP, Reply, length: 312, xid:0x3b38e91e, flags: [Broadcast] (0x8000)
          Your IP: 70.112.122.13
          Gateway IP: 10.34.32.1
          Client Ethernet Address: 00:07:e9:e5:d6:ca
          Vendor-rfc1048:
            DHCP:OFFER
            SID:10.34.32.1
            LT:78196
            SM:255.255.252.0
            DN:&quot;austin.rr.com&quot;
            DG:70.112.120.1
            NS:24.93.41.125,24.93.41.126
            RD:Y

(more hex code clipped)

16:56:07.456820 00:07:0d:ad:2c:54 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 370: (tos 0x0, ttl 255, id 49649, offset 0, flags [none], proto: UDP (17), length: 356) 10.34.32.1.67 &gt; 255.255.255.255.68: [udp sum ok] BOOTP/DHCP, Reply, length: 328, xid:0x3b38e91e, flags: [Broadcast] (0x8000)
          Your IP: 70.112.122.13
          Gateway IP: 10.34.32.1
          Client Ethernet Address: 00:07:e9:e5:d6:ca
          Vendor-rfc1048:
            DHCP:ACK
            SID:10.34.32.1
            LT:78196
            SM:255.255.252.0
            DN:&quot;austin.rr.com&quot;
            DG:70.112.120.1
            NS:24.93.41.125,24.93.41.126
            RD:Y
            FQDN:255/255/&quot;LIGHTHOUSE.&quot;

(more hex clipped)

16:56:07.500017 00:07:0d:ad:2c:54 &gt; ff:ff:ff:ff:ff:ff, ethertype IPv4 (0x0800), length 409: (tos 0x0, ttl 255, id 49703, offset 0, flags [none], proto: UDP (17), length: 395) 10.34.32.1.67 &gt; 255.255.255.255.68: [udp sum ok] BOOTP/DHCP, Reply, length: 367, xid:0x11765d40, flags: [Broadcast] (0x8000)
          Your IP: 10.34.49.135
          Server IP: 24.93.40.160
          Gateway IP: 10.34.32.1
          Client Ethernet Address: 00:d0:59:fa:a2:76
          file &quot;iselIP1BW1_1.bin@CiIxhwBCgIQ7PcQSurN84ASjUWpJjGpI&quot;
          Vendor-rfc1048:
            DHCP:OFFER
            SID:24.93.41.130
            LT:522347
            SM:255.255.224.0
            TZ:0
            DG:10.34.32.1
            TS:24.93.40.160
            LOG:24.93.35.114
            T177:17455920,774909488,774921472
            BF:&quot;iselIP1BW1_1.bin@CiIxhwBCgIQ7PcQSurN84ASjUWpJjGpI&quot;

(clip)

          Your IP: 10.34.49.135
          Server IP: 24.93.40.160
          Gateway IP: 10.34.32.1
          Client Ethernet Address: 00:d0:59:fa:a2:76
          file &quot;iselIP1BW1_1.bin@CiIxhyMXfLQDfpdnWobJeOKy67p4r17T&quot;
          Vendor-rfc1048:
            DHCP:ACK
            SID:24.93.41.130
            LT:522347
            SM:255.255.224.0
            TZ:0
            DG:10.34.32.1
            TS:24.93.40.160
            LOG:24.93.35.114
            T177:17455920,774909488,774921472
            BF:&quot;iselIP1BW1_1.bin@CiIxhyMXfLQDfpdnWobJeOKy67p4r17T&quot;</code></pre></div><p>Things went on in this manner for a while till I stopped the dump.&nbsp; I&#039;m not an expert, but I&#039;m seeing DHCP offers, followed by ACKs, then another offer/ack, repeatedly.&nbsp; Normally the IP picked up by my cable modem from RoadRunner is 70.123.x.x.</p>											<p class="post-edited">(Last edited by <strong>JimWright</strong> on 13 Nov 2006, 01:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p37177">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						14 Nov 2006, 21:30					</div>
				</div>
				<div class="post-content content">
					<p>Today&#039;s update...&nbsp; Went down to the local Roadrunner office, picked up a new cable modem, brought it home and swapped out the old one, absolutely no change at all.&nbsp; The WRTSL54GS still can&#039;t pick up a DHCP address while running OpenWRT.</p><p>There has to be some configuration option that&#039;s being set incorrectly from the original Linkys code...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p37217">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						15 Nov 2006, 08:29					</div>
				</div>
				<div class="post-content content">
					<p>After much more investigating tonight, I see that my dump above didn&#039;t include as much of the correct info as it should have, and the ACK that I was seeing apparently was going to another MAC address (correct MAC above is 00:90:4c:60:00:2b), and what I&#039;m actually seeing is just repeated DISCOVER attempts, and nothing back.&nbsp; This sounds very much like my packets are being discarded upstream, and I think I may have hit on the answer, this thread has the details:</p><p><a href="http://forum.bsr-clan.de/ftopic8253-0-asc-15.html">http://forum.bsr-clan.de/ftopic8253-0-asc-15.html</a></p><p>Put simply, udhcp is creating too large of a packet, and my ISP looks to be restricting the packet size allowed for DHCP requests.&nbsp; This would explain perfectly why the original Linksys firmware worked, but the OpenWRT code didn&#039;t.&nbsp; I don&#039;t know what packet size Linksys sends by default (D-Link apparently sends 342 bytes), and as can be seen from the above dump my packet size is 590 bytes, and a cutoff of 576 bytes seems to be common, or at least common enough to be a concern.</p><p>The thread above documented a fix to the udhcp code, and mentioned a workaround for dd-wrt but I can&#039;t see how to apply that here.&nbsp; I&#039;ve submitted bug report #962 for this, hopefully it will be something that can be fixed without too much difficulty.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p43947">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Darkstone</div>
					<div class="post-datetime">
						8 Mar 2007, 11:35					</div>
				</div>
				<div class="post-content content">
					<p>Can we get confirmation that this has been fixed? I&#039;ve run into the exact same problem last night (getting endless &quot;Sending discover ...&quot; messages), although I have not done tcpdump yet, since it was late last night when I upgraded the router. I&#039;m going to try resetting back to defaults and try configuring again, since a colleague of mine had this problem too and solved it that way. If that does not help, I can do the tcpdump, if it&#039;s going to help fix this problem.</p><p>I&#039;m running RC6 on WRT54GL v1.1.</p><p>Thanks in advance!</p>											<p class="post-edited">(Last edited by <strong>Darkstone</strong> on 8 Mar 2007, 11:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p43962">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Darkstone</div>
					<div class="post-datetime">
						8 Mar 2007, 21:02					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve tried resetting to defaults, but it didn&#039;t help. The moment I flashed the stock Linksys kernel, everything was OK again. I&#039;m going to try upgrading to OpenWrt again and see what happens.</p><p>(added by edit)</p><p>I believe I figured out what the problem was. Somehow, my version of udhcpc was 0.9.9-pre, which obviously suffered from this problem. When flashing to latest X-Wrt image, version 1.4.0 was installed and everything was OK. Just FYI for anyone who might run into the same problem.</p>											<p class="post-edited">(Last edited by <strong>Darkstone</strong> on 8 Mar 2007, 21:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p43993">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">JimWright</div>
					<div class="post-datetime">
						9 Mar 2007, 07:51					</div>
				</div>
				<div class="post-content content">
					<p>The Whiterussian releases are using Busybox 1.0, X-WRT and Kamikaze are using a later build which includes an improved udhcp routine.&nbsp; It&#039;s possible to add the newer busybox to Whiterussian, but it&#039;s easier to just install the latest X-WRT build and go from there, until Kamikaze is ready for prime time.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>