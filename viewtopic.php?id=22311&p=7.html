<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WNDR3700 exploration</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 1 Oct 2014 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 7 of 20</div><nav><ul><li><a href="viewtopic.php%3Fid=22311&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=22311&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=22311&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=20.html">20</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p101636">
				<div class="post-metadata">
					<div class="post-num">Post #151</div>
					<div class="post-author">enodiesop</div>
					<div class="post-datetime">
						28 Jan 2010, 20:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>essdz wrote:</cite><blockquote><div class="quotebox"><cite>enodiesop wrote:</cite><blockquote><div class="codebox"><pre><code>root@OpenWrt:/etc/config# wifi
PHY for wifi device radio0 not found
PHY for wifi device radio1 not found</code></pre></div></blockquote></div><p>I don&#039;t know what is included in the trunk snapshots by default, but did you use lsmod to confirm that the ath9k driver is loaded? If not, you&#039;ll need to install it with opkg.</p></blockquote></div><p>I used lsmod and the module is not loaded so I installed it with:<br />opkg install kmod-ath9k</p><p>Now I can see wlan0 and wlan1 in ifconfig but the file wireless has remained empty. If I try to configure it myself, the output of wifi is:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/etc/config# wifi
/sbin/wifi: eval: line 1: hostapd_set_bss_options: not found
/sbin/wifi: eval: line 1: hostapd: not found
Failed to start hostapd for phy0
/sbin/wifi: eval: line 1: hostapd_set_bss_options: not found
/sbin/wifi: eval: line 1: hostapd: not found
Failed to start hostapd for phy1</code></pre></div><p>I think is a good idea to build openwrt myself!</p><p>Thank you very much.<br />Daniele</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p101646">
				<div class="post-metadata">
					<div class="post-num">Post #152</div>
					<div class="post-author">essdz</div>
					<div class="post-datetime">
						28 Jan 2010, 23:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>enodiesop wrote:</cite><blockquote><p>Now I can see wlan0 and wlan1 in ifconfig but the file wireless has remained empty. If I try to configure it myself, the output of wifi is:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/etc/config# wifi
/sbin/wifi: eval: line 1: hostapd_set_bss_options: not found
/sbin/wifi: eval: line 1: hostapd: not found
Failed to start hostapd for phy0
/sbin/wifi: eval: line 1: hostapd_set_bss_options: not found
/sbin/wifi: eval: line 1: hostapd: not found
Failed to start hostapd for phy1</code></pre></div><p>I think is a good idea to build openwrt myself!</p></blockquote></div><p>Building OpenWRT yourself may be a good idea for other reasons, but perhaps not necessary here. I think the snapshot images are mostly OK, except that they include all components as modules rather than as built-in commands.</p><p>You can probably fix the above errors by using opkg to install hostapd-mini. On a side note, once the mac80211 and the ath9k kernel modules are installed, I think the system will auto-create an appropriate /etc/config/wireless template for your system the next time you run &quot;wifi&quot; (or maybe you have to reboot?). I believe it only does that if /etc/config/wireless does not exist, though.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p101659">
				<div class="post-metadata">
					<div class="post-num">Post #153</div>
					<div class="post-author">metamatt</div>
					<div class="post-datetime">
						29 Jan 2010, 02:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>enodiesop wrote:</cite><blockquote><p>Hello everyone, I am new in this forum and in openwrt.<br />This morning I installed the version that I found in <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">http://downloads.openwrt.org/snapshots/trunk/ar71xx/</a>.<br />I can&#039;t understand why the file /etc/config/wireless is EMPTY...</p></blockquote></div><p>I had a similar, possibly related problem with the first trunk build I tried 2 weeks ago. Make sure that the kmod-ath9k package is installed; it was missing from the build I tried, resulting in this problem. (You can check by: running &quot;lsmod | grep ath9k&quot;, or running &quot;opkg list-installed | grep ath9k&quot;).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p101660">
				<div class="post-metadata">
					<div class="post-num">Post #154</div>
					<div class="post-author">metamatt</div>
					<div class="post-datetime">
						29 Jan 2010, 02:47					</div>
				</div>
				<div class="post-content content">
					<p>Ah, I see essdz already pointed out that&#039;s the problem. Sorry; I was looking at page 6 of the thread and didn&#039;t realize there was already a page 7.</p><p>Anyway, comments 100, 107 and 109 from me in this thread list a bunch of packages I had to install to get the trunk build to work (including luci). Yeah, building yourself is a good idea (I didn&#039;t have these problems with kmod-ath9k and hostapd in the build I made, though luci was still mostly absent and required a lot of playing with opkg after install).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102083">
				<div class="post-metadata">
					<div class="post-num">Post #155</div>
					<div class="post-author">entee</div>
					<div class="post-datetime">
						3 Feb 2010, 22:36					</div>
				</div>
				<div class="post-content content">
					<p>So is there any news on the signal levels? I saw a ticket had been opened.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102113">
				<div class="post-metadata">
					<div class="post-num">Post #156</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						4 Feb 2010, 10:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>entee wrote:</cite><blockquote><p>So is there any news on the signal levels? I saw a ticket had been opened.</p></blockquote></div><p>Simple and easy: No.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102202">
				<div class="post-metadata">
					<div class="post-num">Post #157</div>
					<div class="post-author">essdz</div>
					<div class="post-datetime">
						5 Feb 2010, 14:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>whiskas wrote:</cite><blockquote><div class="quotebox"><cite>entee wrote:</cite><blockquote><p>So is there any news on the signal levels? I saw a ticket had been opened.</p></blockquote></div><p>Simple and easy: No.</p></blockquote></div><p>On a related note, does anyone have a copy of (or a pointer to) the corresponding AR9xxx data sheet? I wasn&#039;t able to find one with some cursory searching. It would be very helpful to look at configuration info for the radios so we can see if we&#039;re missing something!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102222">
				<div class="post-metadata">
					<div class="post-num">Post #158</div>
					<div class="post-author">enodiesop</div>
					<div class="post-datetime">
						5 Feb 2010, 18:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>essdz wrote:</cite><blockquote><div class="quotebox"><cite>whiskas wrote:</cite><blockquote><div class="quotebox"><cite>entee wrote:</cite><blockquote><p>So is there any news on the signal levels? I saw a ticket had been opened.</p></blockquote></div><p>Simple and easy: No.</p></blockquote></div><p>On a related note, does anyone have a copy of (or a pointer to) the corresponding AR9xxx data sheet? I wasn&#039;t able to find one with some cursory searching. It would be very helpful to look at configuration info for the radios so we can see if we&#039;re missing something!</p></blockquote></div><p>When I opened the router, I could see that one of the two wifi modules is AR9223 (the other one was not possible to discern, the message above is completely faded. Is it the AR9220 ??).<br />I have found this datasheet for a pci adapter which uses the same chip.<br /><a href="http://www.senao-me.ae/uploads/1237268820436.doc">http://www.senao-me.ae/uploads/1237268820436.doc</a><br />I hope this can help in development.</p><p>Daniele.</p>											<p class="post-edited">(Last edited by <strong>enodiesop</strong> on 5 Feb 2010, 18:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102231">
				<div class="post-metadata">
					<div class="post-num">Post #159</div>
					<div class="post-author">essdz</div>
					<div class="post-datetime">
						5 Feb 2010, 20:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>enodiesop wrote:</cite><blockquote><div class="quotebox"><cite>essdz wrote:</cite><blockquote><p>On a related note, does anyone have a copy of (or a pointer to) the corresponding AR9xxx data sheet? I wasn&#039;t able to find one with some cursory searching. It would be very helpful to look at configuration info for the radios so we can see if we&#039;re missing something!</p></blockquote></div><p>When I opened the router, I could see that one of the two wifi modules is AR9223 (the other one was not possible to discern, the message above is completely faded. Is it the AR9220 ??).<br />I have found this datasheet for a pci adapter which uses the same chip.<br /><a href="http://www.senao-me.ae/uploads/1237268820436.doc">http://www.senao-me.ae/uploads/1237268820436.doc</a></p></blockquote></div><p>Thanks--but unfortunately, this seems to be simply a datasheet for the module that *uses* the chip, so it doesn&#039;t include any information about the AR9223 itself. I think it would help the community if we could find the actual interface used by the chip! The datasheet I&#039;m hoping to find is likely to be a hundred pages or more...but maybe it&#039;s only available under NDA?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102499">
				<div class="post-metadata">
					<div class="post-num">Post #160</div>
					<div class="post-author">Fallen Kell</div>
					<div class="post-datetime">
						8 Feb 2010, 22:07					</div>
				</div>
				<div class="post-content content">
					<p>Any new information about new builds which might work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102516">
				<div class="post-metadata">
					<div class="post-num">Post #161</div>
					<div class="post-author">rbd</div>
					<div class="post-datetime">
						9 Feb 2010, 01:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Fallen Kell wrote:</cite><blockquote><p>Any new information about new builds which might work?</p></blockquote></div><p>AFAIK the latest trunk is working fine on WNDR3700.&nbsp; My main &quot;production&quot; home router is running a build I did maybe a week or so ago (not sure exactly when but at least after the switch to default to kernel 2.6.32, so pretty recent).&nbsp; I have not seen any changes go by that look like they would affect WNDR3700, so I haven&#039;t updated, but conversely a build of current trunk should be just as good as mine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102520">
				<div class="post-metadata">
					<div class="post-num">Post #162</div>
					<div class="post-author">essdz</div>
					<div class="post-datetime">
						9 Feb 2010, 02:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Fallen Kell wrote:</cite><blockquote><p>Any new information about new builds which might work?</p></blockquote></div><p>It depends on what you mean by &quot;might work&quot;. Excluding the signal strength issues, all of the recent builds have worked for me. (My most recent checkout was trunk r19503, for reference, and it worked fine.) If you plan to work in the same room as your router, the current builds should be all you need.</p><p>On the flip side, I have been watching checkins and I have not seen anything in OpenWRT that appears to impact the signal strength issue since my last checkout. Although compat-wireless was updated from 02-02 to 02-07 since then, I don&#039;t believe the ath9k developers have noticed the issue.</p><p>I did some playing with the stock NETGEAR firmware in the meantime, and it turns out that the four &quot;power saving modes&quot; mentioned in the product literature are apparently not doing anything fancy after all: when you adjust the power saving mode in the range of 25% to 100% through the web interface, they simply run scripts to adjust the radio txpower (in /etc/rc.d/rc.wlan). I verified through iwconfig that the four different power-saving modes simply result in reduced transmit power settings after they have been applied--so I think the culprit is something else.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102526">
				<div class="post-metadata">
					<div class="post-num">Post #163</div>
					<div class="post-author">essdz</div>
					<div class="post-datetime">
						9 Feb 2010, 03:47					</div>
				</div>
				<div class="post-content content">
					<p>I noticed that the NETGEAR factory GPL source releases come with a set of detailed release notes in docs/release_notes.tex, and these notes appear to have been kept up to date even in the most recent releases. I haven&#039;t looked through much of it, but there seems to be at least some marginally-interesting stuff in there.</p><p>For example, if you want to rebuild and upgrade a new copy of the U-Boot bootloader, the release notes provides specific instructions for manipulating the flash memory to do so, as follows:</p><div class="codebox"><pre><code>Please burn u-boot-wndr3700-dni6-V1.7.bin
Set up a tftp server on your PC, its ip address is 192.168.1.12.
Entering into boot loader
ag7100&gt; set serverip 192.168.1.12
ag7100&gt; tftp 0x80010000 u-boot-wndr3700-dni6-V1.7.bin
ag7100&gt; erase 0xbf000000 +0x70000
ag7100&gt; cp.b 0x80010000 0xbf000000 0x50000
ag7100&gt; reset
Entering into boot loader again
ag7100&gt;bootm
Then the device should be in tftp recovery mode. Please run the command
&quot;tftp -i 192.168.1.1 put WNDR3700U-V1.0.4.49.img&quot; on MS-DOS of your PC.</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102541">
				<div class="post-metadata">
					<div class="post-num">Post #164</div>
					<div class="post-author">rbd</div>
					<div class="post-datetime">
						9 Feb 2010, 06:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>essdz wrote:</cite><blockquote><p>On the flip side, I have been watching checkins and I have not seen anything in OpenWRT that appears to impact the signal strength issue since my last checkout. Although compat-wireless was updated from 02-02 to 02-07 since then, I don&#039;t believe the ath9k developers have noticed the issue.</p></blockquote></div><p>I agree -- I haven&#039;t seen any activity around wireless signal strength for WNDR3700.&nbsp; With that said, with the current trunk, the signal strength is sufficient that I get usable coverage over my whole house, so in my case at least, it&#039;s not *that* bad.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102558">
				<div class="post-metadata">
					<div class="post-num">Post #165</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						9 Feb 2010, 11:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rbd wrote:</cite><blockquote><p>[...] with the current trunk, the signal strength is sufficient that I get usable coverage over my whole house, so in my case at least, it&#039;s not *that* bad.</p></blockquote></div><p>Are you using 2,4GHz or 5GHz?<br />Only asking since my 2,4GHz performance is only few meters line of sight. 5GHz is far better.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102579">
				<div class="post-metadata">
					<div class="post-num">Post #166</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						9 Feb 2010, 17:48					</div>
				</div>
				<div class="post-content content">
					<p>@essdz,</p><p>How about enable u-boot bootloader to boot from USB?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102587">
				<div class="post-metadata">
					<div class="post-num">Post #167</div>
					<div class="post-author">rbd</div>
					<div class="post-datetime">
						9 Feb 2010, 19:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>whiskas wrote:</cite><blockquote><div class="quotebox"><cite>rbd wrote:</cite><blockquote><p>[...] with the current trunk, the signal strength is sufficient that I get usable coverage over my whole house, so in my case at least, it&#039;s not *that* bad.</p></blockquote></div><p>Are you using 2,4GHz or 5GHz?<br />Only asking since my 2,4GHz performance is only few meters line of sight. 5GHz is far better.</p></blockquote></div><p>Both work fine in my (small) house.&nbsp; Signal strength could be better but coverage is very usable on both 2.4GHz and 5GHz.&nbsp; I have seen issues when I enable 802.11n on the AP -- but I think those are actually bugs in the iwlagn driver I&#039;m running on my laptop.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102591">
				<div class="post-metadata">
					<div class="post-num">Post #168</div>
					<div class="post-author">TeeZee</div>
					<div class="post-datetime">
						9 Feb 2010, 20:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ratbug wrote:</cite><blockquote><p>@essdz,</p><p>How about enable u-boot bootloader to boot from USB?</p></blockquote></div><p>Now that would be an * Excellent!! * idea!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102606">
				<div class="post-metadata">
					<div class="post-num">Post #169</div>
					<div class="post-author">Dragon</div>
					<div class="post-datetime">
						9 Feb 2010, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>I note theres been an update in the trunk by juhosg claiming to work around the bad signal strength, anyone tested yet?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102613">
				<div class="post-metadata">
					<div class="post-num">Post #170</div>
					<div class="post-author">rbd</div>
					<div class="post-datetime">
						10 Feb 2010, 00:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dragon wrote:</cite><blockquote><p>I note theres been an update in the trunk by juhosg claiming to work around the bad signal strength, anyone tested yet?</p></blockquote></div><p>Yep, just saw that go by too.&nbsp; I just finished building it.</p><p>It seems to be a huge improvement for me -- on my 2.4 GHz network, in the worst spot in my house, I saw signal strength go from -86 dBm to -61 dBm, and my laptop went from struggling to hold a 12 Mb/sec data rate to having a solid 54 Mb/sec connection.&nbsp; I didn&#039;t do before and after numbers for 5 GHz, but in the same bad spot I see a -71 dBm signal, which seems pretty good.</p><p>I think it&#039;s definitely worth building the latest trunk if you&#039;ve been having signal strength problems with WNDR3700.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102622">
				<div class="post-metadata">
					<div class="post-num">Post #171</div>
					<div class="post-author">essdz</div>
					<div class="post-datetime">
						10 Feb 2010, 02:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rbd wrote:</cite><blockquote><div class="quotebox"><cite>Dragon wrote:</cite><blockquote><p>I note theres been an update in the trunk by juhosg claiming to work around the bad signal strength, anyone tested yet?</p></blockquote></div><p>Yep, just saw that go by too.&nbsp; I just finished building it.</p><p>It seems to be a huge improvement for me -- on my 2.4 GHz network, in the worst spot in my house, I saw signal strength go from -86 dBm to -61 dBm, and my laptop went from struggling to hold a 12 Mb/sec data rate to having a solid 54 Mb/sec connection.&nbsp; I didn&#039;t do before and after numbers for 5 GHz, but in the same bad spot I see a -71 dBm signal, which seems pretty good.</p><p>I think it&#039;s definitely worth building the latest trunk if you&#039;ve been having signal strength problems with WNDR3700.</p></blockquote></div><p>YES! I just built r19658 and I am seeing significant improvements in signal strength. The signal is not quite as good as the stock NETGEAR firmware for me, but it&#039;s definitely a lot more useable.</p><p>Compared to the previous OpenWRT release, I see a 16 dB (!) improvement in 2.4 GHz signal strength and a 6 dB improvement in 5 GHz signal strength.</p><p>RSSI at 2.4 GHz is still 6 dB lower than the default NETGEAR firmware, and 11 dB lower for 5 GHz, but as I wrote before, it&#039;s now useable. </p><p><a href="https://dev.openwrt.org/browser/trunk/package/mac80211/patches/409-ath9k-add-wndr3700-antenna-initialization.patch?rev=19565">Juhosg&#039;s patch from earlier today</a> indicates that it is selecting a fixed antenna group, so perhaps there is a little more tweaking to be done...but we&#039;re looking in pretty good shape overall, and now we know where to look.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102626">
				<div class="post-metadata">
					<div class="post-num">Post #172</div>
					<div class="post-author">essdz</div>
					<div class="post-datetime">
						10 Feb 2010, 03:42					</div>
				</div>
				<div class="post-content content">
					<p>Now that we&#039;ve got some useful signal strength, here are some patches to get a nice default LED configuration for both the wired and wireless parts of the device.</p><p>This patch adjusts the default /etc/config/network setup to set up your bicolor switch LEDs at boot. If you already have a customized network configuration, just copy and paste the relevant pieces. (The config is loaded automatically via UCI, so this means you don&#039;t have to run a special swconfig script to set up the LEDs.)</p><p><a href="http://pastebin.com/f6dff0914">http://pastebin.com/f6dff0914</a>&nbsp; (click &quot;download&quot;)</p><p>The following patch is a clean version of ase&#039;s earlier posting to enable the correct GPIO for the WLAN LEDs. This also leverages juhosg&#039;s recent checkin to determine whether or not the driver is running on the WNDR3700 in order to create a clean patch.</p><p><a href="http://pastebin.com/m76ad5c6f">http://pastebin.com/m76ad5c6f</a> (click &quot;download&quot;)</p><p>These changes work great for me, except that the WLAN LEDs are on solid and do not blink. I could have sworn that we had nice blinky LEDs in a previous trunk revision, so this warrants further investigation...although I don&#039;t think it&#039;s related to my patch.</p><p>If these work for other people, I will submit them for inclusion in the trunk.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102745">
				<div class="post-metadata">
					<div class="post-num">Post #173</div>
					<div class="post-author">ole.h</div>
					<div class="post-datetime">
						11 Feb 2010, 20:13					</div>
				</div>
				<div class="post-content content">
					<p>Thanks juhosg (Gabor Juhos) for fixing signal levels! </p><p>Works ok here, not perfect but a lot better than before.</p>											<p class="post-edited">(Last edited by <strong>ole.h</strong> on 11 Feb 2010, 23:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102847">
				<div class="post-metadata">
					<div class="post-num">Post #174</div>
					<div class="post-author">ase</div>
					<div class="post-datetime">
						13 Feb 2010, 10:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>essdz wrote:</cite><blockquote><p>Now that we&#039;ve got some useful signal strength, here are some patches to get a nice default LED configuration for both the wired and wireless parts of the device.</p><p>This patch adjusts the default /etc/config/network setup to set up your bicolor switch LEDs at boot. If you already have a customized network configuration, just copy and paste the relevant pieces. (The config is loaded automatically via UCI, so this means you don&#039;t have to run a special swconfig script to set up the LEDs.)</p><p><a href="http://pastebin.com/f6dff0914">http://pastebin.com/f6dff0914</a>&nbsp; (click &quot;download&quot;)</p><p>The following patch is a clean version of ase&#039;s earlier posting to enable the correct GPIO for the WLAN LEDs. This also leverages juhosg&#039;s recent checkin to determine whether or not the driver is running on the WNDR3700 in order to create a clean patch.</p><p><a href="http://pastebin.com/m76ad5c6f">http://pastebin.com/m76ad5c6f</a> (click &quot;download&quot;)</p><p>These changes work great for me, except that the WLAN LEDs are on solid and do not blink. I could have sworn that we had nice blinky LEDs in a previous trunk revision, so this warrants further investigation...although I don&#039;t think it&#039;s related to my patch.</p><p>If these work for other people, I will submit them for inclusion in the trunk.</p></blockquote></div><p>I&#039;ve tested these patches and they seem to work fine. Good job!</p><p>Could you include an example of configuring the wan led via the switch as well in the config file?</p><p>Also this is just a matter of opinion but I&#039;d personally change the green led default mode from 2 (always on and blinking) to 9 (on only when 10/100 mb/s connection and blinking). This way when using 1000 mb/s connection you wouldn&#039;t get both green and orange led on at the same time.</p><p>Please submit your patches for inclusion. Could you also submit my patch (or something similar) for toggling the wan led color from post #135 at the same time?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102938">
				<div class="post-metadata">
					<div class="post-num">Post #175</div>
					<div class="post-author">essdz</div>
					<div class="post-datetime">
						15 Feb 2010, 04:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ase wrote:</cite><blockquote><p>I&#039;ve tested these patches and they seem to work fine. Good job!</p><p>Could you include an example of configuring the wan led via the switch as well in the config file?</p></blockquote></div><p>OK--submitted. We&#039;ll see what happens. Thanks for all of your work on the switch driver and finding the WLAN LEDs!</p><p>I noticed that juhosg&#039;s antenna patch is toggling some GPIOs to select a fixed antenna group. I thought it might be interesting to play with some of the other settings on those GPIOs to see if any other antenna group(s) might work better and/or differently.</p><p>If you add the following code as package/mac80211/patches/590-wndr3700-antenna.patch, you can then adjust the value of those four GPIOs using module parameters:</p><div class="codebox"><pre><code>--- a/drivers/net/wireless/ath/ath9k/init.c    2010-01-18 14:11:59.943782130 -0200
+++ b/drivers/net/wireless/ath/ath9k/init.c    2010-01-18 14:12:59.015805947 -0200
@@ -32,6 +32,22 @@
 module_param_named(nohwcrypt, modparam_nohwcrypt, int, 0444);
 MODULE_PARM_DESC(nohwcrypt, &quot;Disable hardware encryption&quot;);
 
+static int modparam_as1 = 0;
+module_param_named(as1, modparam_as1, int, 0664);
+MODULE_PARM_DESC(as1, &quot;WNDR3700 antenna select 1&quot;);
+
+static int modparam_as2 = 1;
+module_param_named(as2, modparam_as2, int, 0664);
+MODULE_PARM_DESC(as2, &quot;WNDR3700 antenna select 2&quot;);
+
+static int modparam_as3 = 0;
+module_param_named(as3, modparam_as3, int, 0664);
+MODULE_PARM_DESC(as3, &quot;WNDR3700 antenna select 3&quot;);
+
+static int modparam_as4 = 1;
+module_param_named(as4, modparam_as4, int, 0664);
+MODULE_PARM_DESC(as4, &quot;WNDR3700 antenna select 4&quot;);
+
 /* We use the hw_value as an index into our private channel structure */
 
 #define CHAN2G(_freq, _idx)  { \
@@ -682,10 +698,14 @@
     ath9k_hw_cfg_output(ah, 9, AR_GPIO_OUTPUT_MUX_AS_OUTPUT);
 
     /* select the first antenna group */
-    ath9k_hw_set_gpio(ah, 6, 0);
-    ath9k_hw_set_gpio(ah, 7, 1);
-    ath9k_hw_set_gpio(ah, 8, 0);
-    ath9k_hw_set_gpio(ah, 9, 1);
+    ath9k_hw_set_gpio(ah, 6, modparam_as1);
+    ath9k_hw_set_gpio(ah, 7, modparam_as2);
+    ath9k_hw_set_gpio(ah, 8, modparam_as3);
+    ath9k_hw_set_gpio(ah, 9, modparam_as4);
+
+    ath_print(ath9k_hw_common(ah), ATH_DBG_FATAL,
+            &quot;WNDR3700 antenna configuration: %d %d %d %d\n&quot;,
+            modparam_as1, modparam_as2, modparam_as3, modparam_as4);
 }
 #else
 static inline void wndr3700_init_antenna(struct ath_hw *ah) {}</code></pre></div><p>After doing this, assuming that you built ath9k as a module, you can then edit /etc/modules.d/27-ath9k and adjust the file to look like this:</p><div class="codebox"><pre><code>ath9k_hw
ath9k_common
ath9k as1=0 as2=1 as3=0 as4=1</code></pre></div><p>You can then try varying the values of as1 through as4 to see what happens (with the above being the current default config). I was rebooting between changes--it should be testable, at least in theory, by doing rmmod followed by modprobe, but that seemed to confuse something in the wireless code--and you can confirm by looking for &quot;WNDR3700&quot; in dmesg to verify that your specified GPIOs were correctly configured.</p><p>I haven&#039;t had a lot of time to play with it yet, but if these settings turn out to do something useful that needs to be accessed from userspace, we could think about a /proc filesystem interface for it.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 7 of 20</div><nav><ul><li><a href="viewtopic.php%3Fid=22311&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=22311&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=22311&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=20.html">20</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>