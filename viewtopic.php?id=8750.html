<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> JTAG flashing</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p39631">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">simoor</div>
					<div class="post-datetime">
						27 Dec 2006, 14:01					</div>
				</div>
				<div class="post-content content">
					<p>Hello<br />(first: sorry for the english, but I&#039;m from Switzerland)</p><p>I got 2 killed WRT54GLs from a friend. He just bought them and tried to flash freifunk.<br />He didn&#039;t do anything like bootwait or so.</p><p>They only flash the power led. I did a JTAG, and i was able to flash a NVE.BIN, which i created via the &quot;Skynet Bootloader Creator 2.0&quot;<br />I used /fc:01<br />I am not sure if this was the right flash, but I think it was. It flashed without errors or stopping, about 12 Minutes.</p><p>I don&#039;t know what to do next. Should the Router answer at 192.168.1.1? It doesn&#039;t do that...</p><p>Does anyone has a WHOLEFLASH.BIN for me?<br />Or what shall I do next?</p><p>The Code on the Flash is: Samsung 628 K8D32160BC</p><p>Thanks for any help!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41103">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						20 Jan 2007, 14:14					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>which documentation do you use?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41138">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">simoor</div>
					<div class="post-datetime">
						20 Jan 2007, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;re absolutely tooooooo late!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41139">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Kevin</div>
					<div class="post-datetime">
						20 Jan 2007, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>if you flashed the bootloader, install the rest via tftp as most likely described in the install docs</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41156">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">haes</div>
					<div class="post-datetime">
						21 Jan 2007, 03:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br />I got my wrt54gs v1.1 complite dead with jtag cable alive skynet cfe bootloader ./wrt54g -erase:wholeflash /noemw and<br />./wrt54g -flash:cfe with skytnet cfe creator image then tftp -i 192.168.1.1 put openwrt-wrt54gs-squashfs.bin <br />some how i cannot work winxp giveio.sys do not work for me??<br />i use ubuntu <br />Hairymaids debrick utility<br />and rmmod lp<br />then modprobe parport<br />mknod /dev/parport c 99 0<br />hope this help</p>											<p class="post-edited">(Last edited by <strong>haes</strong> on 21 Jan 2007, 03:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41183">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						21 Jan 2007, 15:55					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the answers.</p><p>I am not sure which PINs I have to use on the WRT54GL. There are 10 and 12 PINs.<br />Which one I have to use?</p><p>On my wrt54g I have used the 12 PINs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41194">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">simoor</div>
					<div class="post-datetime">
						21 Jan 2007, 19:37					</div>
				</div>
				<div class="post-content content">
					<p>One is labeled serial and the other is labeled JTAG.<br />Guess which to use...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41207">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						21 Jan 2007, 21:20					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, but where can I see, which one is serial and which one is jtag?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41217">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">dicks</div>
					<div class="post-datetime">
						21 Jan 2007, 23:00					</div>
				</div>
				<div class="post-content content">
					<p>JTAG is the 12-pin header. Look here: <a href="http://wiki.openwrt.org/OpenWrtDocs/Customizing/Hardware/JTAG_Cable">http://wiki.openwrt.org/OpenWrtDocs/Cus … JTAG_Cable</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41284">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						22 Jan 2007, 21:04					</div>
				</div>
				<div class="post-content content">
					<p>Ok, thanks.</p><p>...but there is nothing about the modell WRT54GL. <br />Have I to care about it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41299">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">dicks</div>
					<div class="post-datetime">
						22 Jan 2007, 23:49					</div>
				</div>
				<div class="post-content content">
					<p>I just built that cable for my WRT54GL v1.1 and it works (the cable that is, my router is still bricked).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41301">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">haes</div>
					<div class="post-datetime">
						23 Jan 2007, 00:48					</div>
				</div>
				<div class="post-content content">
					<p>Skynet repair kits have WRT54GL CFE v1.0 an v1.1 and enter your mac to it and create CFE.BIN<br />Creator <a href="http://www.wlan-skynet.de/download/skynet_repairkit_1.3_setup.exe">http://www.wlan-skynet.de/download/skyn … _setup.exe</a><br />Hairymaids debrick utility move it with jtag cable to flash<br />move CFE.BIN Hairymaids debrick utility folder<br />./wrt54g backup:nvram<br />./wrt54g -erase:wholeflash /noemw <br />./wrt54g -flash:cfe /noemw<br />then tftp -i 192.168.1.1 put image.bin <br />ps. check that nvram is safe to empty.</p>											<p class="post-edited">(Last edited by <strong>haes</strong> on 24 Jan 2007, 02:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41378">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						23 Jan 2007, 22:39					</div>
				</div>
				<div class="post-content content">
					<p>Thanks.</p><p>Ok, I have the jtag-cable from my wrt54g which I had rescue with it.</p><p>@dicks: Do you have pictures of the jtag-interface on your router, the WRT54GL?<br />@haes: Sorry, but I use linux and can&#039;t use a .exe. Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41381">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">dicks</div>
					<div class="post-datetime">
						23 Jan 2007, 23:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Duff wrote:</cite><blockquote><p>@dicks: Do you have pictures of the jtag-interface on your router, the WRT54GL?</p></blockquote></div><p>Here are two pictures of the PCB in my WRT54GL v1.1 router, taken before I added the serial and JTAG headers:<br /><a href="http://www.xs4all.nl/~dicks/wrt54gl-1.jpg">http://www.xs4all.nl/~dicks/wrt54gl-1.jpg</a> (2.1Mb)<br /><a href="http://www.xs4all.nl/~dicks/wrt54gl-2.jpg">http://www.xs4all.nl/~dicks/wrt54gl-2.jpg</a> (2.3Mb)</p><p>Unfortunately, I couldn&#039;t revive my router with the JTAG cable. I can read/erase/write the flash, but it seems to hang very early on in the boot process, before the serial port and LAN ports are initialized. <a href="http://forum.openwrt.org/viewtopic.php?id=9046">Here</a> is the thread about my experiences.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41431">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						24 Jan 2007, 20:01					</div>
				</div>
				<div class="post-content content">
					<p>Thanks.</p><p>Ok, I think that I have to use the PINs below in the picture as the jtag interface.</p><p>I will trie it and post my result as soon as possible.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41433">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						24 Jan 2007, 20:19					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I don&#039;t have much luck by using the jtag-cable.</p><p>I get the following error:<br /></p><div class="codebox"><pre><code>daniel-laptop:/home/daniel/wrt54g/debrick/Linux# ./wrt54g -backup:nvram

====================================
WRT54G EJTAG DeBrick Utility v3.0
====================================

Probing bus...
CHIP ID: 00000101001101010010000101111111 (0535217F)
*** Unrecognized Chip ***
*** This is not a Broadcom BCM47XX chip ***
*** Possible Causes:
    1) WRT54G is not Connected.
    2) WRT54G is not Powered On.
    3) Improper JTAG Cable.
    4) Unrecognized Chip Version of WRT54G.</code></pre></div><p>I have the Broadcom chip BCM5352xxx on my WRT54GL and I think that this is the problem.<br />What do you think?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41440">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						24 Jan 2007, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>Ok, sorry. I have taken the wrong version of the utility.</p><p>If take the newest version I don&#039;t see anything in the shell.</p><p>I only see this:<br /></p><div class="codebox"><pre><code>daniel-laptop:/home/daniel/wrt54g/HairyDairyMaid_WRT54G_Debrick_Utility_v48# ./wrt54g -erase:cfe

====================================
WRT54G/GS EJTAG Debrick Utility v4.8
====================================

Probing bus ... Done

Instruction Length set to 8

CPU Chip ID: 00000101001101010010000101111111 (0535217F)
*** Found a Broadcom BCM5352 Rev 1 CPU chip ***

    - EJTAG IMPCODE ....... : 00000000100000000000100100000100 (00800904)
    - EJTAG Version ....... : 1 or 2.0
    - EJTAG DMA Support ... : Yes

Issuing Processor / Peripheral Reset ... Done</code></pre></div><p>I see also the same when I tried a -backup:nvram or -erase:nvram.</p><p>What the hell I am doing wrong???</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41460">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">haes</div>
					<div class="post-datetime">
						25 Jan 2007, 00:05					</div>
				</div>
				<div class="post-content content">
					<p>./wrt54g -probeonly</p><p>====================================<br />WRT54G/GS EJTAG Debrick Utility v4.8<br />====================================</p><p>Probing bus ... Done</p><p>Instruction Length set to 8</p><p>CPU Chip ID: 00010100011100010010000101111111 (1471217F)<br />*** Found a Broadcom BCM4712 Rev 1 CPU chip ***</p><p>&nbsp; &nbsp; - EJTAG IMPCODE ....... : 00000000100000000000100100000100 (00800904)<br />&nbsp; &nbsp; - EJTAG Version ....... : 1 or 2.0<br />&nbsp; &nbsp; - EJTAG DMA Support ... : Yes</p><p>Issuing Processor / Peripheral Reset ... Done<br />Enabling Memory Writes ... Done<br />Halting Processor ... &lt;Processor Entered Debug Mode!&gt; ... Done<br />Clearing Watchdog ... Done</p><p>Probing Flash at (Flash Window: 0x1fc00000) ... Done</p><p>Flash Vendor ID: 00000000000000000000000010001001 (00000089)<br />Flash Device ID: 00000000000000000000000000010111 (00000017)<br />*** Found a Intel 28F640J3 4Mx16&nbsp; &nbsp; &nbsp; &nbsp;(8MB) Flash Chip ***</p><p>&nbsp; &nbsp; - Flash Chip Window Start .... : 1c000000<br />&nbsp; &nbsp; - Flash Chip Window Length ... : 00800000<br />&nbsp; &nbsp; - Selected Area Start ........ : 00000000<br />&nbsp; &nbsp; - Selected Area Length ....... : 00000000</p><br /><br /><p> *** REQUESTED OPERATION IS COMPLETE ***</p><p>i have wrt54gs v1.1 and i see this on -probeonly <br />and <br />./wrt54 -backup:cfe <br />litle shorten ....</p><p>[ 99% Backed Up]&nbsp; &nbsp;1c03fe90: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03fea0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03feb0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03fec0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03fed0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03fee0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03fef0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff00: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff10: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff20: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff30: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff40: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff50: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff60: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff70: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff80: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ff90: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ffa0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ffb0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ffc0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ffd0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03ffe0: 00000000 00000000 00000000 00000000<br />[ 99% Backed Up]&nbsp; &nbsp;1c03fff0: 00000000 00000000 00000000 00000000<br />Done&nbsp; (CFE.BIN.SAVED_20070124_235507 saved to Disk OK)</p><p>bytes written: 262144<br />=========================<br />Backup Routine Complete<br />=========================<br />elapsed time: 81 seconds</p><br /><p> *** REQUESTED OPERATION IS COMPLETE ***</p>											<p class="post-edited">(Last edited by <strong>haes</strong> on 25 Jan 2007, 00:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41463">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">dicks</div>
					<div class="post-datetime">
						25 Jan 2007, 00:39					</div>
				</div>
				<div class="post-content content">
					<p>I used v45, but had to make the following changes to get it working:<br /></p><div class="codebox"><pre><code>--- orig/wrt54g.c    2006-02-11 12:43:34.000000000 +0100
+++ wrt54g.c    2007-01-24 23:33:46.000000000 +0100
@@ -354,7 +354,20 @@
 
          pfd = open(&quot;/dev/parport0&quot;, O_RDWR);
          if (pfd &lt; 0)   {   perror(&quot;Failed to open /dev/parport0&quot;);   exit(0);   }
-         if ((ioctl(pfd, PPEXCL) &lt; 0) || (ioctl(pfd, PPCLAIM) &lt; 0))   {   perror(&quot;Failed to lock /dev/parport0&quot;);   close(pfd);   exit(0);   }
+#if 0
+         if (ioctl(pfd, PPEXCL) &lt; 0)
+         {
+                perror(&quot;Failed to lock /dev/parport0&quot;);
+                close(pfd);
+                exit(1);
+         }
+#endif
+         if (ioctl(pfd, PPCLAIM) &lt; 0)
+         {
+                perror(&quot;Failed to claim /dev/parport0&quot;);
+                close(pfd);
+                exit(1);
+         }
 
       #endif
 
@@ -398,7 +411,11 @@
    #else   // ---- Compiler Specific Code ----
 
       data = (1 &lt;&lt; TDO) | (0 &lt;&lt; TCK) | (tms &lt;&lt; TMS) | (tdi &lt;&lt; TDI);
-      ioctl(pfd, PPWDATA, &amp;data);
+      if (ioctl(pfd, PPWDATA, &amp;data) &lt; 0)
+      {
+        perror(&quot;ioctl failed:&quot;);
+        exit(1);
+      }
 
       data = (1 &lt;&lt; TDO) | (1 &lt;&lt; TCK) | (tms &lt;&lt; TMS) | (tdi &lt;&lt; TDI);
       ioctl(pfd, PPWDATA, &amp;data);
@@ -1623,6 +1640,7 @@
     // Memory Protection bit only applies to EJTAG 2.0 based chips.
     if (ejtag_version != 0)  issue_enable_mw = 0;
     printf(&quot;Enabling Memory Writes ... &quot;);   
+    fflush(stdout);
     if (issue_enable_mw)
     {
          // Clear Memory Protection Bit in DCR</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41515">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">Duff</div>
					<div class="post-datetime">
						25 Jan 2007, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, but it doesn&#039;t work.</p><p>I always get this on my screen and nothing else is going on. </p><div class="codebox"><pre><code>shell:~&gt;wrt54g -probeonly
====================================
WRT54G/GS EJTAG Debrick Utility v4.8
====================================

Probing bus ... Done

Instruction Length set to 8

CPU Chip ID: 00000101001101010010000101111111 (0535217F)
*** Found a Broadcom BCM5352 Rev 1 CPU chip ***

    - EJTAG IMPCODE ....... : 00000000100000000000100100000100 (00800904)
    - EJTAG Version ....... : 1 or 2.0
    - EJTAG DMA Support ... : Yes

Issuing Processor / Peripheral Reset ... Done</code></pre></div><p>@dicks: What have I to change?<br />The wrt54g.c?</p><p>sorry (-;</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>