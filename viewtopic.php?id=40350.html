<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-MR3020 and 3G USB dongle over wireless</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 23 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p182468">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">javresistance</div>
					<div class="post-datetime">
						5 Nov 2012, 19:20					</div>
				</div>
				<div class="post-content content">
					<p>Hi, everyone. <br />I hope I can explain what my needs are correctly. I have OpenWRT installed and running on the TP-MR3020. Right now its connected to my ADSL modem/router for configuration. Switch is set to WISP and I can connect to the device via SSH and Luci without any problem. <br />I have a Huawei USB 3g dongle that I want to connect on the router and use the wireless internet true the MR3020. I&#039;ve already installed all the packets needed and the USB 3g dongle is communicating and running. The USB 3g dongle is only connecting to the MR3020 but I cannot access the USB 3g dongle via a wireless connection true the MR3020.</p><p>In Luci I have the following interfaces:</p><p><span class="postimg"><img src="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interfaces1.jpg" alt="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interfaces1.jpg" /></span></p><p>In Luci my WAN 3g in cofigured like this and running:</p><p><span class="postimg"><img src="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface2.jpg" alt="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface2.jpg" /></span></p><p>My WIFI interface is confugured like this:</p><p><span class="postimg"><img src="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface3.jpg" alt="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface3.jpg" /></span></p><p>I can see the MR3020 router in my wireless connection list on my Laptop but connection to it is unsuccessful.</p><p><span class="postimg"><img src="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface4.jpg" alt="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface4.jpg" /></span></p><p>Maybe I have some missing configurations? Any help would be highly appreciated. Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182474">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						5 Nov 2012, 20:06					</div>
				</div>
				<div class="post-content content">
					<p>Why Ad-hoc ??<br />Why don&#039;t you use AP mode ?</p><p>USB-3G as WAN, and enable Masquerading(it is enabled by default)<br />Wifi AP and eth0 as LAN.&nbsp; You don&#039;t need that separate &quot;WIFI&quot; interface.<br />Just bridge the AP and eth0 together, then enable DHCP on the &quot;LAN&quot; interface.<br />Something like that <span class="postimg"><img src="http://i46.tinypic.com/2ex0eph.jpg" alt="http://i46.tinypic.com/2ex0eph.jpg" /></span></p><p>Then wireless and wired connection will route to 3G to goto internet.</p><p>p.s. if you like to keep your settings that improper way, check the firewall settings.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182487">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">javresistance</div>
					<div class="post-datetime">
						5 Nov 2012, 22:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>johan666 wrote:</cite><blockquote><p>Why Ad-hoc ??<br />Why don&#039;t you use AP mode ?</p><p>USB-3G as WAN, and enable Masquerading(it is enabled by default)<br />Wifi AP and eth0 as LAN.&nbsp; You don&#039;t need that separate &quot;WIFI&quot; interface.<br />Just bridge the AP and eth0 together, then enable DHCP on the &quot;LAN&quot; interface.<br />Something like that <span class="postimg"><img src="http://i46.tinypic.com/2ex0eph.jpg" alt="http://i46.tinypic.com/2ex0eph.jpg" /></span></p><p>Then wireless and wired connection will route to 3G to goto internet.</p><p>p.s. if you like to keep your settings that improper way, check the firewall settings.</p></blockquote></div><p>Thanks for your reply Johan. Pardon my lack of networking I&#039;m learning as go along. Following your instructions I am able now to make a wireless connection to the MR3020. Though I still can manage to establish an internet connection. I&#039;ve unplugged the Ethernet cable going to my ADSL modem/router since right now I only want to connect to the internet via the 3g USB.</p><p><span class="postimg"><img src="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface7.jpg" alt="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface7.jpg" /></span></p><p>Here is how I have the Interfaces right now:</p><p><span class="postimg"><img src="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface8.jpg" alt="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface8.jpg" /></span></p><p>Also the DHCP and DNS tab:</p><p><span class="postimg"><img src="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface9.jpg" alt="http://i347.photobucket.com/albums/p450/resistancejav/TP%20Link/Interface9.jpg" /></span></p><p>Btw right now that I have Openwrt configured this way does the switch on the MR3020 make any effect when toggling between AP, WISP and 3G? I think not, right? They have to be configured, right?</p>											<p class="post-edited">(Last edited by <strong>javresistance</strong> on 5 Nov 2012, 22:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182489">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						5 Nov 2012, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>Mine</p><br /><br /><p><span class="postimg"><img src="http://img267.imageshack.us/img267/4316/configve.jpg" alt="http://img267.imageshack.us/img267/4316/configve.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>TheRaster</strong> on 5 Nov 2012, 22:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182498">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">javresistance</div>
					<div class="post-datetime">
						6 Nov 2012, 00:44					</div>
				</div>
				<div class="post-content content">
					<p>Ok it works. For information here is what I did to get the Huawei E353 working on the MR3020. </p><p>Re-installed OpenWRT.</p><p>Downloaded and installed the packages for the 3g dongle<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# opkg update
root@OpenWrt:~# opkg install comgt kmod-usb-serial kmod-usb-serial-option kmod-usb-acm usb-modeswitch luci-proto-3g usb-modeswitch-data
root@OpenWrt:~# reboot</code></pre></div><p>Went in Luci and followed TheRaster instructions</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182536">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						6 Nov 2012, 15:26					</div>
				</div>
				<div class="post-content content">
					<p>Glad you got it working. I use 3G as my main net....</p><p>So if you need more speed from your E353 look up Biquad antenna and make one for it. They work well!!!</p><p>One thing I will say is DONT cheep on the coax use LL200, LL400, LMR-200,LMR-240 or LMR-400 to connect to the antenna.</p><p>Depending on what network your using will depend on the size of the antenna needed. I use three.co.uk who run on 2100mhz</p><p>Size of biquad is ....</p><p>Emitter wire total length: 285.6mm<br />Emitter ’square’ side length: 35.7mm<br />Emitter offset from reflector: 17.85mm<br />Reflector width/height: 142.8mm<br />Reflector ‘lips’ height: 35.7mm</p><p>And the adapter needed for the E353 is called a CRC9. Be warned the antennas sold on eblag are not as good as they make out. and the gains are not as good as they say.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182542">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">javresistance</div>
					<div class="post-datetime">
						6 Nov 2012, 16:32					</div>
				</div>
				<div class="post-content content">
					<p>Yesterday I tested the USB dongle E353 and it worked fine. Today I put on the MR3020 with the USB 3g dongle connected, it connects and blue light is steady. After a few seconds the USB connection drops and the led flashes blue. When I take out the USB 3g dongle and reconnect it or reboot the MR3020 the USB 3g dongle reconnects again. Also I discovered when SSHing into the MR3020 the USB 3g dongle drops. Any thoughts on this issue? </p><p>One other question is there a way with this setup to broadcast info on an ordinary USB stick over wireless?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182549">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">javresistance</div>
					<div class="post-datetime">
						6 Nov 2012, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>Here is another thing that I&#039;ve tested twice with the E353 USB 3g dongle connected to the MR3020. On the website speedtest.net I&#039;ve tested the speed but it doesn&#039;t complete the whole download cycle as soon as it starts to download it drops in connectivity. And than I have to reboot the MR3020 again or unplug the USB 3g dongle and reconnect.<br />I have tested the dongle alone on the website and it is working fine.<br />Any thoughtswould be nice. Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182550">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						6 Nov 2012, 18:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi Javresistance,</p><p>We think its a bug and the coders are looking in to it. I can confirm that I have problems with speedtest.net and usb modems making the usb port drop out. Keep a eye on this topic <a href="https://forum.openwrt.org/viewtopic.php?id=39956">https://forum.openwrt.org/viewtopic.php?id=39956</a> They are working hard to fix it.</p><p>As for speedtesting download a program called JDautospeedtest <a href="http://www.gmwsoftware.co.uk/">http://www.gmwsoftware.co.uk/</a> and use that. Works fine for me. Needs .net 4 so its not going to help with speed testing over mobiles.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182580">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">javresistance</div>
					<div class="post-datetime">
						6 Nov 2012, 22:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>TheRaster wrote:</cite><blockquote><p>Hi Javresistance,</p><p>We think its a bug and the coders are looking in to it. I can confirm that I have problems with speedtest.net and usb modems making the usb port drop out. Keep a eye on this topic <a href="https://forum.openwrt.org/viewtopic.php?id=39956">https://forum.openwrt.org/viewtopic.php?id=39956</a> They are working hard to fix it.</p><p>As for speedtesting download a program called JDautospeedtest <a href="http://www.gmwsoftware.co.uk/">http://www.gmwsoftware.co.uk/</a> and use that. Works fine for me. Needs .net 4 so its not going to help with speed testing over mobiles.</p></blockquote></div><p>Hi, TheRaster thanks for your reply. </p><p>One favor I want to ask. Since you have experience with the TP-MR3020 and the Huawei E353, can you post your steps in making them work together with OpenWRT? Just to verify that I have everything correctly installed. </p><p>Also is there a way to use an ordinary USB stick to transmit data when needed true a wireless connection?(Like file sharing) I&#039;ve installed and tested the Piratebox setup yesterday it has these features but I can&#039;t use it to connect to the internet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182633">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">javresistance</div>
					<div class="post-datetime">
						7 Nov 2012, 15:01					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve noticed something, when I connect the 3g USB dongle directly to the MR3020 it gives the issue mensioned above. When I connect the 3g USB dongle with an extension it works longer and maybe not even drops. I don&#039;t know. Maybe its a power issue?&nbsp; <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182637">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						7 Nov 2012, 15:16					</div>
				</div>
				<div class="post-content content">
					<p>Sorry for the late reply,</p><p>Im still new to wrt myself only been playing for a fue weeks. I dont have the MR3020. But I started with the MR3420 that was giving me problems with the usb modems, I thought it was a problem with the router because it was doing it with stock FW as well as wrt.<br />So I got a 3600 that I am using now, Still have the same problems. weather its on a powered hub or not so dont go out and buy a powered hub like I did unless your wanting to move the modem away from the router because you will still have the same problems. I cant tell you what packs I installed off top of my head but I can give my my list of installed apps so you can compair with yours and install them then config the router with image I put above.</p><div class="codebox"><pre><code>     Package name    Version
Remove    6in4    11-1
Remove    base-files    117-r33883
Remove    busybox    1.19.4-5
Remove    chat    2.4.5-6
Remove    comgt    0.32-21
Remove    dnsmasq    2.62-2
Remove    dropbear    2011.54-2
Remove    firewall    2-53
Remove    hotplug2    1.0-beta-4
Remove    ip    3.3.0-1
Remove    ip6tables    1.4.10-4
Remove    iptables    1.4.10-4
Remove    iw    3.6-1
Remove    jshn    2012-07-08-cca2ed6c8cdb3555fea43ff63ba1c9905dd7a164
Remove    kernel    3.3.8-1-54676ff21e7e4e275e485bc50fb94fcb
Remove    kmod-ath    3.3.8+2012-09-07-3
Remove    kmod-ath9k    3.3.8+2012-09-07-3
Remove    kmod-ath9k-common    3.3.8+2012-09-07-3
Remove    kmod-cfg80211    3.3.8+2012-09-07-3
Remove    kmod-crypto-aes    3.3.8-1
Remove    kmod-crypto-arc4    3.3.8-1
Remove    kmod-crypto-core    3.3.8-1
Remove    kmod-gpio-button-hotplug    3.3.8-1
Remove    kmod-ip6tables    3.3.8-1
Remove    kmod-ipt-conntrack    3.3.8-1
Remove    kmod-ipt-core    3.3.8-1
Remove    kmod-ipt-nat    3.3.8-1
Remove    kmod-ipt-nathelper    3.3.8-1
Remove    kmod-iptunnel4    3.3.8-1
Remove    kmod-ipv6    3.3.8-1
Remove    kmod-leds-gpio    3.3.8-1
Remove    kmod-ledtrig-default-on    3.3.8-1
Remove    kmod-ledtrig-netdev    3.3.8-1
Remove    kmod-ledtrig-timer    3.3.8-1
Remove    kmod-ledtrig-usbdev    3.3.8-1
Remove    kmod-lib-crc-ccitt    3.3.8-1
Remove    kmod-mac80211    3.3.8+2012-09-07-3
Remove    kmod-nls-base    3.3.8-1
Remove    kmod-ppp    3.3.8-1
Remove    kmod-pppoe    3.3.8-1
Remove    kmod-pppox    3.3.8-1
Remove    kmod-sched    3.3.8-1
Remove    kmod-sched-core    3.3.8-1
Remove    kmod-scsi-core    3.3.8-1
Remove    kmod-scsi-generic    3.3.8-1
Remove    kmod-sit    3.3.8-1
Remove    kmod-usb-acm    3.3.8-1
Remove    kmod-usb-core    3.3.8-1
Remove    kmod-usb-net    3.3.8-1
Remove    kmod-usb-net-sierrawireless    3.3.8-1
Remove    kmod-usb-ohci    3.3.8-1
Remove    kmod-usb-serial    3.3.8-1
Remove    kmod-usb-serial-option    3.3.8-1
Remove    kmod-usb-serial-sierrawireless    3.3.8-1
Remove    kmod-usb-serial-wwan    3.3.8-1
Remove    kmod-usb-sierrawireless-directip    3.3.8-10
Remove    kmod-usb-uhci    3.3.8-1
Remove    kmod-usb2    3.3.8-1
Remove    kmod-wdt-ath79    3.3.8-1
Remove    libblobmsg-json    2012-07-08-cca2ed6c8cdb3555fea43ff63ba1c9905dd7a164
Remove    libc    0.9.33.2-1
Remove    libdaemon    0.14-2
Remove    libgcc    4.6-linaro-1
Remove    libip4tc    1.4.10-4
Remove    libip6tc    1.4.10-4
Remove    libiwinfo    35
Remove    libiwinfo-lua    35
Remove    libjson    0.9-2
Remove    liblua    5.1.4-8
Remove    libnl-tiny    0.1-3
Remove    libubox    2012-07-08-cca2ed6c8cdb3555fea43ff63ba1c9905dd7a164
Remove    libubus    2012-06-01-a62e2f8c15a65efb1a82404d8f31e3bfc1cbe7d9
Remove    libubus-lua    2012-06-01-a62e2f8c15a65efb1a82404d8f31e3bfc1cbe7d9
Remove    libuci    2012-03-28.1-1
Remove    libuci-lua    2012-03-28.1-1
Remove    libusb    0.1.12-3
Remove    libxtables    1.4.10-4
Remove    lua    5.1.4-8
Remove    luci    0.11+svn9402-1
Remove    luci-app-firewall    0.11+svn9402-1
Remove    luci-app-wshaper    0.11+svn9402-1
Remove    luci-i18n-english    0.11+svn9402-1
Remove    luci-lib-core    0.11+svn9402-1
Remove    luci-lib-ipkg    0.11+svn9402-1
Remove    luci-lib-lmo    0.11+svn9402-1
Remove    luci-lib-nixio    0.11+svn9402-1
Remove    luci-lib-sys    0.11+svn9402-1
Remove    luci-lib-web    0.11+svn9402-1
Remove    luci-mod-admin-core    0.11+svn9402-1
Remove    luci-mod-admin-full    0.11+svn9402-1
Remove    luci-proto-3g    0.11+svn9402-1
Remove    luci-proto-core    0.11+svn9402-1
Remove    luci-proto-ppp    0.11+svn9402-1
Remove    luci-sgi-cgi    0.11+svn9402-1
Remove    luci-theme-base    0.11+svn9402-1
Remove    luci-theme-openwrt    0.11+svn9402-1
Remove    mtd    18.1
Remove    netifd    2012-10-19-a9fd870450e82f31cba681651656276dfc1c39ac
Remove    opkg    618-2
Remove    ppp    2.4.5-6
Remove    ppp-mod-pppoe    2.4.5-6
Remove    radvd    1.9.1-2
Remove    sdparm    1.04-1
Remove    swconfig    10
Remove    tc    3.3.0-1
Remove    uboot-envtools    2012.04.01-1
Remove    ubus    2012-06-01-a62e2f8c15a65efb1a82404d8f31e3bfc1cbe7d9
Remove    ubusd    2012-06-01-a62e2f8c15a65efb1a82404d8f31e3bfc1cbe7d9
Remove    uci    2012-03-28.1-1
Remove    uhttpd    40
Remove    usb-modeswitch    1.2.3-2
Remove    usb-modeswitch-data    20120120-1
Remove    wpad-mini    20120910-1
Remove    wshaper    0.2-2</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>