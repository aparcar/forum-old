<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [SOLVED] samknows wdr3600 scp refused port 22</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p253692">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						9 Nov 2014, 09:08					</div>
				</div>
				<div class="post-content content">
					<p>Hi. I&#039;ve got a samknows whitebox. They cut my participation short after 2 weeks and didn&#039;t ask for the box back. So i wanted to install dd-wrt on it as i&#039;ve used dd-wrt before.</p><p>I&#039;ve been searching the interwebs and found this <br /><a href="http://wiki.openwrt.org/doc/howto/generic.failsafe#in.failsafe.mode">http://wiki.openwrt.org/doc/howto/gener … lsafe.mode</a><br /><a href="https://archive.org/details/EnterOpenwrtFailsafeModeAndReflashAFirmware">https://archive.org/details/EnterOpenwr … hAFirmware</a></p><p>I&#039;m normally using win7, but i got ubuntu sideloaded on my netbook. So i was good to go.<br />First failsafe mode. done.<br />setup lan ip 192.168.1.2. done.<br />connect via wan port. done.<br />telnet 192.168.1.1. done.<br />enter following cmd&#039;s.</p><p>mount_root<br />/etc/init.d/dropbear start<br />passwd</p><p>Then in second terminal window i do<br />scp /home/nicolaj/skrivebord/factory-to-ddwrt.bin root@192.168.1.1:/tmp/</p><p>ssh: conntion to host 192.168.1.1 port 22: conntion refused<br />lost connection.</p><p>Any ideas ?</p><br /><p>Edit: Step-by-step<br />In this case i&#039;m using ubuntu, which i have sideloaded with win7, if you want to do it the same way you can use a livecd from ubuntu, that way you won&#039;t have to install the OS.</p><p>1. Install Openssh-server. &quot;sudo apt-get install openssh-server&quot; (also works using a livecd)<br />2. Download the firmware file you need, you&#039;re going to be offline while doing this.<br />3. Unplug everything from the device.<br />4. Manually set your lan IP to 192.168.1.2<br />5. Putting device into failsafe mode. Turn device on and wait for the * icon to blink, then push the reset button and the * icon should start flashing rapidly. You&#039;re now in failsafe mode.<br />6. Connect via lan to lan port 1 on the device.<br />7. Open 2 terminal windows.<br />8. In window 1 write &quot;telnet 192.168.1.1&quot; some ASCII art should appear saying &quot;OpenWrt&quot;<br />9. Do the 3 commands.<br />- mount_root<br />- /etc/init.d/dropbear start<br />- passwd (changes password, it will warn you if it&#039;s too short or too weak, but it will still accept them)<br />10. change directory &quot;cd /tmp&quot;<br />11. Now transfer the firmware file by using the second terminal window you opened. &quot;scp /location/firmware.bin root@192.168.1.1:/tmp/&quot; (remember to change &quot;user, location &amp; filename&quot; to fit your scenario)<br />It will now ask for your password, this is for the computer, and not the router password entered earlier.<br />You&#039;ll see a line showing the filesize and transfer speed = success.<br />12. Back in the terminal window connected to the router we&#039;re now going to flash the firmware. &quot;mtd -r write /tmp/tplink.bin firmware&quot;<br />It should now say &quot;writing from /tmp/firmare.bin to firmware [w]</p><p>Now don&#039;t move or breath, just wait. When you see &quot;Rebooting...&quot; in the terminal window you can disconnect your lan cable and enabled wireless again on your computer.<br />After a min or so you should see a new SSID pop up.<br />Connect to it and set up your free router.</p><br /><p><span class="postimg"><img src="http://billedeupload.dk/images/Vql5F.jpg" alt="http://billedeupload.dk/images/Vql5F.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>nicolaj</strong> on 16 Nov 2014, 04:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253695">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						9 Nov 2014, 09:48					</div>
				</div>
				<div class="post-content content">
					<p>If you want to put dd-wrt on your router, maybe you should ask in a dd-wrt forum.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253716">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						9 Nov 2014, 16:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tmo26 wrote:</cite><blockquote><p>If you want to put dd-wrt on your router, maybe you should ask in a dd-wrt forum.</p></blockquote></div><p>And why would i do that when it&#039;s Openwrt that&#039;s the problem ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253724">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						9 Nov 2014, 18:00					</div>
				</div>
				<div class="post-content content">
					<p>What if you try the other way round: initiate scp on your router i/o on your pc?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253729">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						9 Nov 2014, 18:50					</div>
				</div>
				<div class="post-content content">
					<p>Just checked it out on my MR3020 in failsafe mode:</p><p>192.168.1.1 = MR3020<br />192.168.1.20 = Windows machine running Bitvise ssh server</p><p>- telnet to MR3020<br />- on MR3020:<br /></p><div class="codebox"><pre><code>root@(none):/# cd /tmp/
root@(none):/tmp# scp tmomas@192.168.1.20:C:/vcredist.bmp .
/usr/bin/dbclient: Warning: failed creating /root/.ssh: Read-only file system

Host &#039;192.168.1.20&#039; is not in the trusted hosts file.
(fingerprint md5 1f:a1:dd:83:8d:08:c6:5e:97:c7:61:43:0c:ec:0d:22)
Do you want to continue connecting? (y/n) y
tmomas@192.168.1.20&#039;s password:
vcredist.bmp                                  100% 5686     5.6KB/s   00:00
root@(none):/tmp#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253730">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						9 Nov 2014, 18:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tmo26 wrote:</cite><blockquote><p>What if you try the other way round: initiate scp on your router i/o on your pc?</p></blockquote></div><p>I&#039;m not sure i follow. You want me to do it from my desktop ?<br />I have both win7 and ubuntu on my netbook. My desktop is win7 only.</p><div class="quotebox"><cite>tmo26 wrote:</cite><blockquote><p>Just checked it out on my MR3020 in failsafe mode:</p><p>192.168.1.1 = MR3020<br />192.168.1.20 = Windows machine running Bitvise ssh server</p><p>- telnet to MR3020<br />- on MR3020:<br /></p><div class="codebox"><pre><code>root@(none):/# cd /tmp/
root@(none):/tmp# scp tmomas@192.168.1.20:C:/vcredist.bmp .
/usr/bin/dbclient: Warning: failed creating /root/.ssh: Read-only file system

Host &#039;192.168.1.20&#039; is not in the trusted hosts file.
(fingerprint md5 1f:a1:dd:83:8d:08:c6:5e:97:c7:61:43:0c:ec:0d:22)
Do you want to continue connecting? (y/n) y
tmomas@192.168.1.20&#039;s password:
vcredist.bmp                                  100% 5686     5.6KB/s   00:00
root@(none):/tmp#</code></pre></div></blockquote></div><br /><p>If i understand that correctly, it&#039;s being refused because the computer ip isn&#039;t in the trusted list ?<br />But isn&#039;t that a bit weird considering it&#039;s in failsafe mode, shouldn&#039;t it allow everything ?</p>											<p class="post-edited">(Last edited by <strong>nicolaj</strong> on 9 Nov 2014, 18:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253731">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						9 Nov 2014, 18:59					</div>
				</div>
				<div class="post-content content">
					<p>Currently you are trying<br /></p><div class="codebox"><pre><code>on your ubuntu pc:
scp /home/nicolaj/skrivebord/factory-to-ddwrt.bin root@192.168.1.1:/tmp/</code></pre></div><p>Instead, try the other way round:</p><div class="codebox"><pre><code>on your openwrt router in failsafe mode:
cd /tmp
scp user@your-ubuntu-host:/home/nicolaj/skrivebord/factory-to-ddwrt.bin .</code></pre></div><p>Sidenote: This was my 2^9th posting ;-)</p>											<p class="post-edited">(Last edited by <strong>tmo26</strong> on 9 Nov 2014, 19:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253733">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						9 Nov 2014, 19:16					</div>
				</div>
				<div class="post-content content">
					<p>Oh, i see where you&#039;re going with this. Ok so i just tried that.<br />mount_root<br />/etc/init.d/dropbear start<br />cd /tmp<br />/tmp# scp nicolaj@nicolaj-DOT-SE:/home/nicolaj/skrivebord/factory-to-ddwrt.bin</p><p>replies with<br />usage: scp [-1234BCpqrv] [-c cipher] etc....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253737">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						9 Nov 2014, 20:00					</div>
				</div>
				<div class="post-content content">
					<p>Every character of a command has it&#039;s meaning in linux, and be it oh so tiny like a &#039;.&#039;</p><p>-&gt; you forgot the . at the end of the scp command <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253738">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						9 Nov 2014, 20:02					</div>
				</div>
				<div class="post-content content">
					<p>Oh man, i thought that was just a misplaced punctuation.</p><p>Ok got a new reply.<br />/usr/bin/dbclient: excited: error resolving &#039;nicolaj-DOT-SE&#039; port &#039;22&#039;. name or service not known</p><p>And i typed it exactly as report in terminal &quot;nicolaj@nicolaj-DOT-SE:</p>											<p class="post-edited">(Last edited by <strong>nicolaj</strong> on 9 Nov 2014, 20:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253739">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						9 Nov 2014, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>Use scp with the IP i/o the name.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253740">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						9 Nov 2014, 20:06					</div>
				</div>
				<div class="post-content content">
					<p>ah so i just change it to. scp nicolaj@192.168.1.2:/home/nicolaj/skrivebord/factory-to-ddwrt.bin . &lt;- didn&#039;t forget it.</p>											<p class="post-edited">(Last edited by <strong>nicolaj</strong> on 9 Nov 2014, 20:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253742">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						9 Nov 2014, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>Reply from root@(none):/tmp# scp nicolaj@192.168.1.2:/home/nicolaj/skrivebord/factory-to-ddwrt.bin .<br />/usr/bin/dbclient: excited: error connection: connection refused</p><p>p.s. i just realized i could&#039;ve just edited to post above.</p>											<p class="post-edited">(Last edited by <strong>nicolaj</strong> on 9 Nov 2014, 20:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253942">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						11 Nov 2014, 17:22					</div>
				</div>
				<div class="post-content content">
					<p>Bump</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254210">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						13 Nov 2014, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>bump</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254460">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						15 Nov 2014, 19:22					</div>
				</div>
				<div class="post-content content">
					<p>bump</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254469">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						15 Nov 2014, 20:49					</div>
				</div>
				<div class="post-content content">
					<p>from win7 use winscp to put the ddwrt file in the timp dir. or look here <a href="https://archive.org/details/EnterOpenwrtFailsafeModeAndReflashAFirmware">https://archive.org/details/EnterOpenwr … hAFirmware</a></p><p>If stil no joy then try firstboot&nbsp; and flash from gui if luci is instaled</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254470">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						15 Nov 2014, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>Your PC has refused the connection, most likely because there is no SSH server running on it.&nbsp; Install openssh or similar and then test that you can scp to yourself with the PC command line.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254473">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						15 Nov 2014, 21:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tapper wrote:</cite><blockquote><p>from win7 use winscp to put the ddwrt file in the timp dir. or look here <a href="https://archive.org/details/EnterOpenwrtFailsafeModeAndReflashAFirmware">https://archive.org/details/EnterOpenwr … hAFirmware</a></p><p>If stil no joy then try firstboot&nbsp; and flash from gui if luci is instaled</p></blockquote></div><p>It&#039;s the same link that i link to, been through it several times.<br />I can give windows a try, but remember, there is no GUI.</p><div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>Your PC has refused the connection, most likely because there is no SSH server running on it.&nbsp; Install openssh or similar and then test that you can scp to yourself with the PC command line.</p></blockquote></div><p>I&#039;m using ubuntu.</p>											<p class="post-edited">(Last edited by <strong>nicolaj</strong> on 15 Nov 2014, 21:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254478">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						15 Nov 2014, 23:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nicolaj wrote:</cite><blockquote><p>I&#039;m using ubuntu.</p></blockquote></div><p>does it work for you to (on a terminal on Ubuntu):</p><p>ssh 192.168.1.2<br />-or-<br />ssh localhost</p><p>this will connect to your machine, if it is the first time you get the &quot;continue connecting&quot; prompt, answer yes-- then it will prompt you for your password and you are logged into your own machine.</p><p>If you get &quot;connection refused&quot; you have only the ssh client on your Ubuntu machine, not the server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254489">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						16 Nov 2014, 02:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><div class="quotebox"><cite>nicolaj wrote:</cite><blockquote><p>I&#039;m using ubuntu.</p></blockquote></div><p>does it work for you to (on a terminal on Ubuntu):</p><p>ssh 192.168.1.2<br />-or-<br />ssh localhost</p><p>this will connect to your machine, if it is the first time you get the &quot;continue connecting&quot; prompt, answer yes-- then it will prompt you for your password and you are logged into your own machine.</p><p>If you get &quot;connection refused&quot; you have only the ssh client on your Ubuntu machine, not the server.</p></blockquote></div><p>I think you&#039;re on to something.<br />Did &quot;ssh localhost&quot;<br />ssh: connect to localhost port 22: connection refused.</p><p>It wasn&#039;t available in the software center, so installed openssh-server. ssh connection to localhost seems to work now. I&#039;ll try the flash again.<br />Ok, getting some new feedback from the router.</p><p>scp nicolaj@192.168.1.2:/home/nicolaj/skrivebord/ddwrt.bin . &lt;- tried renaming it.<br />nicolaj@192.168.1.2&#039;s password<br />scp: /home/nicolaj/skrivebord/ddwrt.bin: no such file or directory</p><p>If i do it from the machine &quot;scp /home/nicolaj/skrivebord/ddwrt.bin root@192.168.1.1:/tmp/<br />i get ssh: connection to host 192.168.1.1 port 22: connection refused.</p>											<p class="post-edited">(Last edited by <strong>nicolaj</strong> on 16 Nov 2014, 03:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254492">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						16 Nov 2014, 03:07					</div>
				</div>
				<div class="post-content content">
					<p>From the router, you can ssh back to the Ubuntu and do a ls to make sure the file really exists where you think it is.</p><p>Try copying the file to the /tmp directory on the Ubuntu machine.&nbsp; This directory should be set with permissions so anyone can read it.&nbsp; Also make sure you are cd&#039;d to /tmp on the router.&nbsp; (or you can specify /tmp at the end of the scp command you run on the router instead of the dot which makes it use the current directory.)</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 16 Nov 2014, 03:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254494">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						16 Nov 2014, 03:39					</div>
				</div>
				<div class="post-content content">
					<p>Ok, i made a mistake that i&#039;ve overlooked the entire time.<br />The file is now written to the router.<br />On one site they use.<br />sysupgrade -n /tmp/ddwrt.bin</p><p>On another site they use<br />mtd -r write /tmp/ddwrt.bin firmware</p><p>I do not what the difference is or what would be best to use.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254496">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						16 Nov 2014, 03:50					</div>
				</div>
				<div class="post-content content">
					<p>I think they are the same.&nbsp; sysupgrade appears to be a higher level way to access mtd.</p><p>Either one is going to in some way wipe your firmware and replace it with the new file.</p><p>But that is more a question for the folks at dd-wrt who devised the process.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254497">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">nicolaj</div>
					<div class="post-datetime">
						16 Nov 2014, 04:02					</div>
				</div>
				<div class="post-content content">
					<p>I now have working dd-wrt on it!<br />Thanks a lot for everyone&#039;s help.</p><p>I&#039;m sure Openwrt is very good, but i&#039;m flashing dd-wrt because i have experience with it.</p><p>p.s. I&#039;ll edit the first post to included a step-by-step for others like me.</p>											<p class="post-edited">(Last edited by <strong>nicolaj</strong> on 16 Nov 2014, 04:19)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>