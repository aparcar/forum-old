<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> 32MB flash in TL-MR11U/AR9331-based HW</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Apr 2018 and 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=45219&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p211193">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">newtonliuwen</div>
					<div class="post-datetime">
						30 Aug 2013, 08:09					</div>
				</div>
				<div class="post-content content">
					<p>Hi gerritb,</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Did you met the issue reboot will hang using 32M flash?<br />&nbsp; &nbsp; &nbsp; &nbsp; <a href="https://forum.openwrt.org/viewtopic.php?id=46034">https://forum.openwrt.org/viewtopic.php?id=46034</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213910">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">kimstik</div>
					<div class="post-datetime">
						4 Oct 2013, 18:29					</div>
				</div>
				<div class="post-content content">
					<p>Congratulations!!<br />Excellent job!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214046">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">kimstik</div>
					<div class="post-datetime">
						6 Oct 2013, 00:36					</div>
				</div>
				<div class="post-content content">
					<p>I see that new SPI chips have Extended registers/ bank registers<br />like N25Q512A or spansion chips<br />potentially we can use some glue code to do hardware mapped memory access inside each 16M blocks with 24bit address mode</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251856">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">fonfonfml</div>
					<div class="post-datetime">
						24 Oct 2014, 07:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>otlabs wrote:</cite><blockquote><p>Here comes quilt patch with your changes against current trunk:<br /></p><div class="codebox"><pre><code>diff --git a/target/linux/ar71xx/patches-3.10/940-add-32mb-flash-support.patch b/target/linux/ar71xx/patches-3.10/940-add-32mb-flash-support.patch
new file mode 100644
index 0000000..7bca77e
--- /dev/null
+++ b/target/linux/ar71xx/patches-3.10/940-add-32mb-flash-support.patch
@@ -0,0 +1,31 @@
+--- a/drivers/mtd/devices/m25p80.c
++++ b/drivers/mtd/devices/m25p80.c
+@@ -1137,6 +1137,13 @@ static int m25p_remove(struct spi_device
+     struct m25p    *flash = dev_get_drvdata(&amp;spi-&gt;dev);
+     int        status;
+ 
++    const struct spi_device_id    *id = spi_get_device_id(spi);
++
++    struct flash_info *info = (void *)id-&gt;driver_data;
++    // return 3-byte address mode so harware FTLs do not get confused.
++
++    set_4byte(flash, info-&gt;jedec_id, 0);
++
+     /* Clean up MTD stuff. */
+     status = mtd_device_unregister(&amp;flash-&gt;mtd);
+     if (status == 0) {
+--- a/drivers/spi/spi-ath79.c
++++ b/drivers/spi/spi-ath79.c
+@@ -335,9 +335,9 @@ static int ath79_spi_setup_transfer(stru
+         return ret;
+ 
+     cdata = spi-&gt;controller_data;
+-    if (cdata-&gt;is_flash)
+-        sp-&gt;bitbang.txrx_bufs = ath79_spi_txrx_bufs;
+-    else
++    // if (cdata-&gt;is_flash)
++    //     sp-&gt;bitbang.txrx_bufs = ath79_spi_txrx_bufs;
++    // else
+         sp-&gt;bitbang.txrx_bufs = spi_bitbang_bufs;
+ 
+     return ret;</code></pre></div></blockquote></div><p>where do you quilt patch in？？</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264331">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						6 Feb 2015, 02:09					</div>
				</div>
				<div class="post-content content">
					<p>Guys, <br />I manage to get 32MB SPI chip recognize by openwrt.<br />However wireless init fail.<br />I have copied ART partition and locate it at the end of SPI address 0x000001ff0000-0x000002000000<br />Please help .... Anything I&#039;m missing here?</p><p>here is dmesg log<br />[&nbsp; &nbsp; 0.000000] Linux version 3.14.30 (user@ubuntu) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r43976) ) #3 Thu Feb 5 15:30:18 EST 2015<br />[&nbsp; &nbsp; 0.000000] MyLoader: sysp=2c00ff65, boardp=2820efff, parts=01247d74<br />[&nbsp; &nbsp; 0.000000] bootconsole [early0] enabled<br />[&nbsp; &nbsp; 0.000000] CPU0 revision is: 0001974c (MIPS 74Kc)<br />[&nbsp; &nbsp; 0.000000] SoC: Atheros AR9344 rev 2<br />[&nbsp; &nbsp; 0.000000] Determined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 08000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] Initrd not found or empty - disabling initrd<br />[&nbsp; &nbsp; 0.000000] Zone ranges:<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal&nbsp; &nbsp;[mem 0x00000000-0x07ffffff]<br />[&nbsp; &nbsp; 0.000000] Movable zone start for each node<br />[&nbsp; &nbsp; 0.000000] Early memory node ranges<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;node&nbsp; &nbsp;0: [mem 0x00000000-0x07ffffff]<br />[&nbsp; &nbsp; 0.000000] On node 0 totalpages: 32768<br />[&nbsp; &nbsp; 0.000000] free_area_init_node: node 0, pgdat 80336420, node_mem_map 81000000<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal zone: 256 pages used for memmap<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal zone: 0 pages reserved<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal zone: 32768 pages, LIFO batch:7<br />[&nbsp; &nbsp; 0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.<br />[&nbsp; &nbsp; 0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes<br />[&nbsp; &nbsp; 0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768<br />[&nbsp; &nbsp; 0.000000] pcpu-alloc: [0] 0 <br />[&nbsp; &nbsp; 0.000000] Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 32512<br />[&nbsp; &nbsp; 0.000000] Kernel command line:&nbsp; board=MYNET-N750 console=ttyS0,115200 mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,64k(devdata)ro,64k(devconf)ro,32256k(firmware),64k(radiocfg)ro rootfstype=squashfs,jffs2 noinitrd<br />[&nbsp; &nbsp; 0.000000] PID hash table entries: 512 (order: -1, 2048 bytes)<br />[&nbsp; &nbsp; 0.000000] Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)<br />[&nbsp; &nbsp; 0.000000] Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)<br />[&nbsp; &nbsp; 0.000000] Writing ErrCtl register=00000000<br />[&nbsp; &nbsp; 0.000000] Readback ErrCtl register=00000000<br />[&nbsp; &nbsp; 0.000000] Memory: 126116K/131072K available (2372K kernel code, 120K rwdata, 500K rodata, 200K init, 187K bss, 4956K reserved)<br />[&nbsp; &nbsp; 0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br />[&nbsp; &nbsp; 0.000000] NR_IRQS:51<br />[&nbsp; &nbsp; 0.000000] Clocks: CPU:560.000MHz, DDR:480.000MHz, AHB:240.000MHz, Ref:40.000MHz<br />[&nbsp; &nbsp; 0.000000] Calibrating delay loop... 278.93 BogoMIPS (lpj=1394688)<br />[&nbsp; &nbsp; 0.070000] pid_max: default: 32768 minimum: 301<br />[&nbsp; &nbsp; 0.070000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.080000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.080000] NET: Registered protocol family 16<br />[&nbsp; &nbsp; 0.090000] MIPS: machine is WD My Net N750<br />[&nbsp; &nbsp; 0.120000] registering PCI controller with io_map_base unset<br />[&nbsp; &nbsp; 0.360000] bio: create slab &lt;bio-0&gt; at 0<br />[&nbsp; &nbsp; 0.360000] PCI host bridge to bus 0000:00<br />[&nbsp; &nbsp; 0.370000] pci_bus 0000:00: root bus resource [mem 0x10000000-0x13ffffff]<br />[&nbsp; &nbsp; 0.370000] pci_bus 0000:00: root bus resource [io&nbsp; 0x0000]<br />[&nbsp; &nbsp; 0.380000] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]<br />[&nbsp; &nbsp; 0.380000] pci 0000:00:00.0: [168c:0030] type 00 class 0x028000<br />[&nbsp; &nbsp; 0.380000] pci 0000:00:00.0: invalid calibration data<br />[&nbsp; &nbsp; 0.390000] pci 0000:00:00.0: reg 0x10: [mem 0x00000000-0x0001ffff 64bit]<br />[&nbsp; &nbsp; 0.390000] pci 0000:00:00.0: reg 0x30: [mem 0x00000000-0x0000ffff pref]<br />[&nbsp; &nbsp; 0.390000] pci 0000:00:00.0: supports D1<br />[&nbsp; &nbsp; 0.390000] pci 0000:00:00.0: PME# supported from D0 D1 D3hot<br />[&nbsp; &nbsp; 0.390000] pci_bus 0000:00: busn_res: [bus 00-ff] end is updated to 00<br />[&nbsp; &nbsp; 0.390000] pci 0000:00:00.0: BAR 0: assigned [mem 0x10000000-0x1001ffff 64bit]<br />[&nbsp; &nbsp; 0.390000] pci 0000:00:00.0: BAR 6: assigned [mem 0x10020000-0x1002ffff pref]<br />[&nbsp; &nbsp; 0.400000] pci 0000:00:00.0: using irq 40 for pin 1<br />[&nbsp; &nbsp; 0.400000] Switched to clocksource MIPS<br />[&nbsp; &nbsp; 0.410000] NET: Registered protocol family 2<br />[&nbsp; &nbsp; 0.410000] TCP established hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.410000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.420000] TCP: Hash tables configured (established 1024 bind 1024)<br />[&nbsp; &nbsp; 0.430000] TCP: reno registered<br />[&nbsp; &nbsp; 0.430000] UDP hash table entries: 256 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.430000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.440000] NET: Registered protocol family 1<br />[&nbsp; &nbsp; 0.450000] PCI: CLS 0 bytes, default 32<br />[&nbsp; &nbsp; 0.450000] futex hash table entries: 256 (order: -1, 3072 bytes)<br />[&nbsp; &nbsp; 0.470000] squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />[&nbsp; &nbsp; 0.470000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.<br />[&nbsp; &nbsp; 0.490000] msgmni has been set to 246<br />[&nbsp; &nbsp; 0.490000] io scheduler noop registered<br />[&nbsp; &nbsp; 0.490000] io scheduler deadline registered (default)<br />[&nbsp; &nbsp; 0.500000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled<br />[&nbsp; &nbsp; 0.530000] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11, base_baud = 2500000) is a 16550A<br />[&nbsp; &nbsp; 0.530000] console [ttyS0] enabled<br />[&nbsp; &nbsp; 0.540000] bootconsole [early0] disabled<br />[&nbsp; &nbsp; 0.550000] m25p80 spi0.0: found mx25l25635e, expected m25p80<br />[&nbsp; &nbsp; 0.560000] m25p80 spi0.0: mx25l25635e (32768 Kbytes)<br />[&nbsp; &nbsp; 0.560000] 6 cmdlinepart partitions found on MTD device spi0.0<br />[&nbsp; &nbsp; 0.570000] Creating 6 MTD partitions on &quot;spi0.0&quot;:<br />[&nbsp; &nbsp; 0.580000] 0x000000000000-0x000000040000 : &quot;u-boot&quot;<br />[&nbsp; &nbsp; 0.580000] 0x000000040000-0x000000050000 : &quot;u-boot-env&quot;<br />[&nbsp; &nbsp; 0.590000] 0x000000050000-0x000000060000 : &quot;devdata&quot;<br />[&nbsp; &nbsp; 0.600000] 0x000000060000-0x000000070000 : &quot;devconf&quot;<br />[&nbsp; &nbsp; 0.600000] 0x000000070000-0x000001ff0000 : &quot;firmware&quot;<br />[&nbsp; &nbsp; 0.700000] 2 seama-fw partitions found on MTD device firmware<br />[&nbsp; &nbsp; 0.710000] 0x000000070000-0x0000001b0000 : &quot;kernel&quot;<br />[&nbsp; &nbsp; 0.720000] 0x0000001b0000-0x000001ff0000 : &quot;rootfs&quot;<br />[&nbsp; &nbsp; 0.720000] mtd: device 6 (rootfs) set to be root filesystem<br />[&nbsp; &nbsp; 0.730000] 1 squashfs-split partitions found on MTD device rootfs<br />[&nbsp; &nbsp; 0.740000] 0x000000390000-0x000001ff0000 : &quot;rootfs_data&quot;<br />[&nbsp; &nbsp; 0.740000] 0x000001ff0000-0x000002000000 : &quot;radiocfg&quot;<br />[&nbsp; &nbsp; 1.760000] switch0: Atheros AR8327 rev. 2 switch registered on ag71xx-mdio.0<br />[&nbsp; &nbsp; 1.820000] libphy: ag71xx_mdio: probed<br />[&nbsp; &nbsp; 3.410000] ag71xx ag71xx.0: connected to PHY at ag71xx-mdio.0:00 [uid=004dd033, driver=Atheros AR8216/AR8236/AR8316]<br />[&nbsp; &nbsp; 3.430000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:RGMII<br />[&nbsp; &nbsp; 3.430000] TCP: cubic registered<br />[&nbsp; &nbsp; 3.440000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 3.440000] 8021q: 802.1Q VLAN Support v1.8<br />[&nbsp; &nbsp; 3.460000] VFS: Mounted root (squashfs filesystem) readonly on device 31:6.<br />[&nbsp; &nbsp; 3.470000] Freeing unused kernel memory: 200K (8034e000 - 80380000)<br />[&nbsp; &nbsp; 6.440000] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 6.450000] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 6.450000] usbcore: registered new device driver usb<br />[&nbsp; &nbsp; 6.460000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp; 6.470000] ehci-platform: EHCI generic platform driver<br />[&nbsp; &nbsp; 6.480000] ehci-platform ehci-platform: EHCI Host Controller<br />[&nbsp; &nbsp; 6.480000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1<br />[&nbsp; &nbsp; 6.490000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000<br />[&nbsp; &nbsp; 6.520000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00<br />[&nbsp; &nbsp; 6.520000] hub 1-0:1.0: USB hub found<br />[&nbsp; &nbsp; 6.530000] hub 1-0:1.0: 1 port detected<br />[&nbsp; &nbsp; 6.850000] usb 1-1: new high-speed USB device number 2 using ehci-platform<br />[&nbsp; &nbsp; 7.010000] hub 1-1:1.0: USB hub found<br />[&nbsp; &nbsp; 7.010000] hub 1-1:1.0: 4 ports detected<br />[&nbsp; &nbsp; 7.440000] random: mktemp urandom read with 55 bits of entropy available<br />[&nbsp; &nbsp; 8.430000] eth0: link up (1000Mbps/Full duplex)<br />[&nbsp; &nbsp;10.430000] Atheros AR8216/AR8236/AR8316 ag71xx-mdio.0:00: Port 1 is up<br />[&nbsp; &nbsp;10.640000] eth0: link down<br />[&nbsp; &nbsp;12.980000] NET: Registered protocol family 10<br />[&nbsp; &nbsp;12.990000] ip6_tables: (C) 2000-2006 Netfilter Core Team<br />[&nbsp; &nbsp;13.000000] Loading modules backported from Linux version master-2014-11-04-0-gf3660a2<br />[&nbsp; &nbsp;13.010000] Backport generated by backports.git backports-20141023-2-g4ff890b<br />[&nbsp; &nbsp;13.020000] ip_tables: (C) 2000-2006 Netfilter Core Team<br />[&nbsp; &nbsp;13.040000] nf_conntrack version 0.5.0 (1973 buckets, 7892 max)<br />[&nbsp; &nbsp;13.080000] xt_time: kernel timezone is -0000<br />[&nbsp; &nbsp;13.110000] cfg80211: Calling CRDA to update world regulatory domain<br />[&nbsp; &nbsp;13.110000] cfg80211: World regulatory domain updated:<br />[&nbsp; &nbsp;13.120000] cfg80211:&nbsp; DFS Master region: unset<br />[&nbsp; &nbsp;13.120000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp), (dfs_cac_time)<br />[&nbsp; &nbsp;13.130000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)<br />[&nbsp; &nbsp;13.140000] cfg80211:&nbsp; &nbsp;(2457000 KHz - 2482000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)<br />[&nbsp; &nbsp;13.150000] cfg80211:&nbsp; &nbsp;(2474000 KHz - 2494000 KHz @ 20000 KHz), (N/A, 2000 mBm), (N/A)<br />[&nbsp; &nbsp;13.160000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 80000 KHz), (N/A, 2000 mBm), (N/A)<br />[&nbsp; &nbsp;13.160000] cfg80211:&nbsp; &nbsp;(5250000 KHz - 5330000 KHz @ 80000 KHz, 160000 KHz AUTO), (N/A, 2000 mBm), (0 s)<br />[&nbsp; &nbsp;13.170000] cfg80211:&nbsp; &nbsp;(5490000 KHz - 5730000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)<br />[&nbsp; &nbsp;13.180000] cfg80211:&nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 80000 KHz), (N/A, 2000 mBm), (N/A)<br />[&nbsp; &nbsp;13.190000] cfg80211:&nbsp; &nbsp;(57240000 KHz - 63720000 KHz @ 2160000 KHz), (N/A, 0 mBm), (N/A)<br />[&nbsp; &nbsp;13.260000] PPP generic driver version 2.4.2<br />[&nbsp; &nbsp;13.270000] NET: Registered protocol family 24<br />[&nbsp; &nbsp;13.320000] ath: phy0: Unable to initialize hardware; initialization status: -5<br />[&nbsp; &nbsp;13.320000] ath9k ar934x_wmac: failed to initialize device<br />[&nbsp; &nbsp;13.330000] ath9k: probe of ar934x_wmac failed with error -5<br />[&nbsp; &nbsp;13.340000] PCI: Enabling device 0000:00:00.0 (0000 -&gt; 0002)<br />[&nbsp; &nbsp;13.350000] ath: phy1: Unable to initialize hardware; initialization status: -5<br />[&nbsp; &nbsp;13.350000] ath9k 0000:00:00.0: Failed to initialize device<br />[&nbsp; &nbsp;13.360000] ath9k: probe of 0000:00:00.0 failed with error -5<br />[&nbsp; &nbsp;20.800000] jffs2_scan_eraseblock(): End of filesystem marker found at 0x0</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264337">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						6 Feb 2015, 05:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dony71 wrote:</cite><blockquote><div class="quotebox"><cite>gerritb wrote:</cite><blockquote><p>Alternatively, I merged the ART partition into the second sector of the flash so I could change the KSEG address to 0x101f1000.</p></blockquote></div><p>gerritb,<br />can you explain a bit details why change &quot;(u8 *) KSEG1ADDR(0x101f1000);&quot; instead of &quot;(u8 *) KSEG1ADDR(0x1fff1000);&quot; will solve this issue?<br />which physical address you locate ART partition in this case?</p></blockquote></div><p>Since no reply yet, I try to analyze this by put printk comment to check physical address<br />printk(KERN_DEBUG &quot;KSEG1ADDR(0x101f1000) = %0x8x \n&quot;,(u32)ee);</p><p>Strangely, no message dump out during boot up<br />check kernel config and already support printk<br />i guess, i&#039;m stuck now waiting for help</p>											<p class="post-edited">(Last edited by <strong>dony71</strong> on 7 Feb 2015, 02:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264552">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						7 Feb 2015, 20:55					</div>
				</div>
				<div class="post-content content">
					<p>- check your compilation settings / your Kernel commandline<br />KERN_DEBUG is probably only printed when there is a &quot;debug&quot; string in cmdline.<br />Either add sth. to that Kernel commandline (afaik somewhere in target/linux/&lt;arch&gt;/image/Makefile - look for the other components of the kernel cmdline (tty , boardname) // don&#039;t know if you can change the cmdline with some setting</p><p><strong>alternative:</strong><br />instead of DEBUG use INFO, WARN or ERROR </p><p>- regarding KSEG1 / address debugging<br /></p><div class="quotebox"><blockquote><p>This area is most often used for I/O addresses and boot ROM.</p></blockquote></div><p>notice some boot messages from multiple different MIPS based boards<br /></p><div class="quotebox"><blockquote><p>FLASH: 0xbf000000 - 0xbf7f0000, 128 blocks of 0x00010000 bytes each.<br />eth0: Atheros AG71xx at 0xb9000000, irq 4<br />..<br />ralink flash device: 0x1000000 at 0xbf000000<br />...<br />serial8250.0: ttyS0 at MMIO 0xb8020000 (irq = 19) is a 16550A</p></blockquote></div><p>A physical device like ethernet chip a flash chip is mapped to an address.<br />So reading from that address reads the Flash content.<br />You have a flash chip with addresses from 0... mapped to<br />some space in in 0xA000,0000 (KSEG1 start) -0xBFFF,FFFF (KSEG1 end)</p><p>Example: Carambola2 (mach-carambola2.c in build_dir/target.../linux-arch../linux-3.14.x/arch/mips/ath79/)<br />The KSEG1ADDR is a macro - afaik the address is<br />A000,0000+offset when KSEG1ADDR(offset) is used<br />using 1fff,000 means BFFF,0000<br />Now keep in mind - one msg from earlier - at mips the Flash is (always?/often) mapped at 0xbf00,0000 ....<br />so you have an remaining offset of 0xff,0000</p><p>Compare this to the art partition start on the wiki page: <a href="http://wiki.openwrt.org/toh/8devices/carambola2">http://wiki.openwrt.org/toh/8devices/carambola2</a></p><p>At least that how I understand this works. Feel free to correct <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />you can search with grep or for commit correcting WMAC/MAC detection or the different flavors of how the MAC/PCI init with KSEG1ADDR is done on the MIPS platform.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264568">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						7 Feb 2015, 23:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zloop wrote:</cite><blockquote><p>- check your compilation settings / your Kernel commandline<br />KERN_DEBUG is probably only printed when there is a &quot;debug&quot; string in cmdline.<br />Either add sth. to that Kernel commandline (afaik somewhere in target/linux/&lt;arch&gt;/image/Makefile - look for the other components of the kernel cmdline (tty , boardname) // don&#039;t know if you can change the cmdline with some setting</p><p><strong>alternative:</strong><br />instead of DEBUG use INFO, WARN or ERROR </p><p>- regarding KSEG1 / address debugging<br /></p><div class="quotebox"><blockquote><p>This area is most often used for I/O addresses and boot ROM.</p></blockquote></div><p>notice some boot messages from multiple different MIPS based boards<br /></p><div class="quotebox"><blockquote><p>FLASH: 0xbf000000 - 0xbf7f0000, 128 blocks of 0x00010000 bytes each.<br />eth0: Atheros AG71xx at 0xb9000000, irq 4<br />..<br />ralink flash device: 0x1000000 at 0xbf000000<br />...<br />serial8250.0: ttyS0 at MMIO 0xb8020000 (irq = 19) is a 16550A</p></blockquote></div><p>A physical device like ethernet chip a flash chip is mapped to an address.<br />So reading from that address reads the Flash content.<br />You have a flash chip with addresses from 0... mapped to<br />some space in in 0xA000,0000 (KSEG1 start) -0xBFFF,FFFF (KSEG1 end)</p><p>Example: Carambola2 (mach-carambola2.c in build_dir/target.../linux-arch../linux-3.14.x/arch/mips/ath79/)<br />The KSEG1ADDR is a macro - afaik the address is<br />A000,0000+offset when KSEG1ADDR(offset) is used<br />using 1fff,000 means BFFF,0000<br />Now keep in mind - one msg from earlier - at mips the Flash is (always?/often) mapped at 0xbf00,0000 ....<br />so you have an remaining offset of 0xff,0000</p><p>Compare this to the art partition start on the wiki page: <a href="http://wiki.openwrt.org/toh/8devices/carambola2">http://wiki.openwrt.org/toh/8devices/carambola2</a></p><p>At least that how I understand this works. Feel free to correct <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />you can search with grep or for commit correcting WMAC/MAC detection or the different flavors of how the MAC/PCI init with KSEG1ADDR is done on the MIPS platform.</p></blockquote></div><p>zloop,<br />thank&#039;s for explanation.<br />I understand for carambola example since flash map at 0xbf00,0000<br />so for getting art partition then needs KSEG1ADDR(0x1fff0000)<br />However for this TL-MR11U / TL-MR3040 device, my understanding flash map at 0x9f00,0000<br /><a href="http://wiki.openwrt.org/toh/tp-link/tl-mr3040">http://wiki.openwrt.org/toh/tp-link/tl-mr3040</a><br />You can see in link above when update openwrt will erase at 0x9f02,0000<br />but why for getting art partition needs KSEG1ADDR(0x1fff1000) ?</p><p>In this thread topic, flash upgraded to 32MB then mips comments<br /></p><div class="quotebox"><cite>mips wrote:</cite><blockquote><p>The &quot;(u8 *) KSEG1ADDR(0x1fff1000);&quot; will auto map to the end 64k of the flash,no matter your flash is 4M/8M/16M.but now it&#039;s not work.<br />When access flash more than 16M,you can&#039;t use this SoC aready mapped address.</p></blockquote></div><p>then gerritb said to have work-around this, to read art partition he change art location and change KSEG1ADDR like comment below<br /></p><div class="quotebox"><cite>gerritb wrote:</cite><blockquote><p>Alternatively, I merged the ART partition into the second sector of the flash so I could change the KSEG address to 0x101f1000.</p></blockquote></div><p>My understanding cannot follow this<br />If flash start map at 0x9f00,0000 then won&#039;t cover KSEG1 + 0x1fff,ffff<br />So if KSEG1ADDR(0x101f1000) where is art physical address located?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264588">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						8 Feb 2015, 02:52					</div>
				</div>
				<div class="post-content content">
					<p>for ramips there is <br />- <a href="https://dev.openwrt.org/browser/trunk/target/linux/ramips/patches-3.14/0004-MIPS-ralink-adds-a-bootrom-dumper-module.patch">https://dev.openwrt.org/browser/trunk/t … dule.patch</a></p><p>The difference between 0x9f.. &amp; 0x8f.. is according to documents if its cached or not cached.<br />( <a href="http://www.eecs.harvard.edu/~mdw/course/cs161/handouts/sys161/lb-cpu.html">http://www.eecs.harvard.edu/~mdw/course … b-cpu.html</a> )</p><p>The Flash can be mapped multiple times into RAM. </p><p>According to the &quot;AR9331 data sheet&quot;<br /></p><div class="quotebox"><blockquote><p>&quot;Upon reset, the CPU puts out an address of 0xBFC00000 which is mapped to the flash address space or internal ROM code, using an external pull up/down register to choose if the AR9331 will boot from<br />the Flash or internal ROM.</p></blockquote></div><p>regarding the addresses:<br />Check an u-boot partition dump - there is probably some string/u-boot-env mini settings partition <br />and offset 0x1,fc00 contains the MAC (use &quot;strings&quot; to check for readable string inside the dump)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264607">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						8 Feb 2015, 10:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zloop wrote:</cite><blockquote><p>According to the &quot;AR9331 data sheet&quot;<br /></p><div class="quotebox"><blockquote><p>&quot;Upon reset, the CPU puts out an address of 0xBFC00000 which is mapped to the flash address space or internal ROM code, using an external pull up/down register to choose if the AR9331 will boot from<br />the Flash or internal ROM.</p></blockquote></div></blockquote></div><p>Thank you again for details explanation.<br />I think I understand now this original memory map, but correct me if I&#039;m wrong.<br />By default re_map disable so flash address is 0xBFC00000 ~ 0xBFFFFFFF<br />That will give total flash space only 4MB .</p><p>In this topic flash chip modified to 32MB flash chip.<br />Originally to access ART partition (mtd4) which located in the last 64KB.<br />That&#039;s why the code to read this partition will be &quot;(u8 *) KSEG1ADDR(0x1fff1000);&quot;&nbsp; (KSEG1ADDR(0x1fff0000) + 0x1000 offset where radio wireless initialization parameter located).</p><p>The thing that I still don&#039;t understand when flash modified to 32MB, gerritb said :<br /></p><div class="quotebox"><cite>gerritb wrote:</cite><blockquote><p>Alternatively, I merged the ART partition into the second sector of the flash so I could change the KSEG address to 0x101f1000.</p></blockquote></div><p>He relocated ART partition to different address and to read this wireless initialization parameter, change the code to &quot;(u8 *) KSEG1ADDR(0x101f1000);&quot;.<br />This translate to KSEG1ADDR(0x101f0000) + 0x1000 offset where radio wireless initialization parameter located.<br />KSEG1ADDR(0x101f0000) translate to virtual address 0xB01F0000.<br />This is below where CPU starts to read 0xBFC00000 like mention in datasheet. This really puzzle me, where is this physical flash address located?</p><div class="quotebox"><cite>zloop wrote:</cite><blockquote><p>regarding the addresses:<br />Check an u-boot partition dump - there is probably some string/u-boot-env mini settings partition <br />and offset 0x1,fc00 contains the MAC (use &quot;strings&quot; to check for readable string inside the dump)</p></blockquote></div><p>I check u-boot dump binary and cannot find &quot;u-boot-env&quot; string. <br />Also u-boot-env.bin doesn&#039;t mention partition where MAC address located.<br />MAC offset location 0x1,FC00 translate to 127KB<br />Based on TL-MR3040 wiki, mtd size &gt; 127K only u-boot, kernel or rootfs,<br />so most likely MAC address in u-boot partition.<br />Does it mean KSEG1ADDR(0x101f0000) = u-boot partition?</p>											<p class="post-edited">(Last edited by <strong>dony71</strong> on 8 Feb 2015, 10:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264612">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						8 Feb 2015, 11:38					</div>
				</div>
				<div class="post-content content">
					<p>@dony71 AR9331 can map only 16 MB for FLASH in address space and because of that you have to reallocate ART partition, to be able to read data from it using direct access (mapped memory).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264617">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						8 Feb 2015, 12:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>@dony71 AR9331 can map only 16 MB for FLASH in address space and because of that you have to reallocate ART partition, to be able to read data from it using direct access (mapped memory).</p></blockquote></div><p>I know that<br />My question which address location of art did gerritb moved to?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264632">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						8 Feb 2015, 13:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dony71 wrote:</cite><blockquote><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>@dony71 AR9331 can map only 16 MB for FLASH in address space and because of that you have to reallocate ART partition, to be able to read data from it using direct access (mapped memory).</p></blockquote></div><p>I know that<br />My question which address location of art did gerritb moved to?</p></blockquote></div><p>U-Boot set bit REMAP_DISABLE to 1 in low level initialization stage, so whole 16 MB is accessible later.<br />Take a look here too: <a href="https://forum.openwrt.org/viewtopic.php?pid=193023#p193023">https://forum.openwrt.org/viewtopic.php … 23#p193023</a></p><p>As far as I understand, gerritb merged ART with second sector (every sector is 64 KB) in FLASH.<br /><span class="postimg"><img src="http://www.tech-blog.pl/wordpress/wp-content/uploads/2013/03/tl-mr3020_flash_layout.gif" alt="http://www.tech-blog.pl/wordpress/wp-content/uploads/2013/03/tl-mr3020_flash_layout.gif" /></span></p><p>MAC address in MR3020 (and in most of TP-Link devices) is stored in second sector too, at offset 0x1fc00 (from begin of FLASH) or at offset 0xfc00 (from begin of second sector), rest of the second sector is empty and not used. So, MAC address offset is:<br /></p><div class="codebox"><pre><code>u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);</code></pre></div><p>ART partition is always in last 64 KB sector (the following code maps always to last sector, no matter what FLASH size you have - you can use FLASH chip with 4, 8 or 16 MB, with ART partition in last sector and you won&#039;t need to change the code). Usable data starts inside ART partition at offset 0x1000, so we use the following offset:<br /></p><div class="codebox"><pre><code>u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);</code></pre></div><p>IMHO, if you merge ART data with second sector, address should look like:<br /></p><div class="codebox"><pre><code>u8 *ee = (u8 *) KSEG1ADDR(0x1f011000);</code></pre></div><p>I don&#039;t know why gerritb wrote about 0x101f1000 address.</p><p>Take a look also at <a href="https://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-dir-505-a1.c">DIR-505 initialization</a>, that device has ART partition in second sector, in FLASH:<br /></p><div class="codebox"><pre><code>[...]
#define DIR_505A1_ART_ADDRESS          0x1f010000
#define DIR_505A1_CALDATA_OFFSET       0x1000
[...]
u8 *art = (u8 *) KSEG1ADDR(DIR_505A1_ART_ADDRESS);
[...]
ath79_register_wmac(art + DIR_505A1_CALDATA_OFFSET, lan_mac);</code></pre></div><p>So, the final address is also KSEG1ADDR(0x1f011000).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264637">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						8 Feb 2015, 13:40					</div>
				</div>
				<div class="post-content content">
					<p>thanks pepe2k for that great writeup</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264667">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						8 Feb 2015, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>pepe2k,<br />you&#039;re the man !!<br />very well explanation clearing my confusion.<br />thank&#039;s very much for spending time to explain this in this great open forum community .</p><p>btw, i know you make U-Boot mod for routers with AR9331/AR9344 at<br /><a href="https://forum.openwrt.org/viewtopic.php?id=43237">https://forum.openwrt.org/viewtopic.php?id=43237</a><br />my understanding this mod doesn&#039;t support 32MB flash. <br />when i try to flash firmware in webfail-safe mode, my u-boot got corrupted.<br />can you give me some hints where in code to modify to support 32MB flash?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264673">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						8 Feb 2015, 19:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>pepe2k,<br />you&#039;re the man !!<br />very well explanation clearing my confusion.<br />thank&#039;s very much for spending time to explain this in this great open forum community .</p></blockquote></div><p>You&#039;re welcome <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>btw, i know you make U-Boot mod for routers with AR9331/AR9344 at<br /><a href="https://forum.openwrt.org/viewtopic.php?id=43237">https://forum.openwrt.org/viewtopic.php?id=43237</a><br />my understanding this mod doesn&#039;t support 32MB flash. <br />when i try to flash firmware in webfail-safe mode, my u-boot got corrupted.<br />can you give me some hints where in code to modify to support 32MB flash?</p></blockquote></div><p>How exactly your U-Boot got corrupted? FLASH related functions are here: <a href="https://github.com/pepe2k/u-boot_mod/blob/master/u-boot/board/ar7240/common/ar7240_flash.c">https://github.com/pepe2k/u-boot_mod/bl … 40_flash.c</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264855">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						10 Feb 2015, 04:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>pepe2k,<br />you&#039;re the man !!<br />very well explanation clearing my confusion.<br />thank&#039;s very much for spending time to explain this in this great open forum community .</p></blockquote></div><p>You&#039;re welcome <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>btw, i know you make U-Boot mod for routers with AR9331/AR9344 at<br /><a href="https://forum.openwrt.org/viewtopic.php?id=43237">https://forum.openwrt.org/viewtopic.php?id=43237</a><br />my understanding this mod doesn&#039;t support 32MB flash. <br />when i try to flash firmware in webfail-safe mode, my u-boot got corrupted.<br />can you give me some hints where in code to modify to support 32MB flash?</p></blockquote></div><p>How exactly your U-Boot got corrupted? FLASH related functions are here: <a href="https://github.com/pepe2k/u-boot_mod/blob/master/u-boot/board/ar7240/common/ar7240_flash.c">https://github.com/pepe2k/u-boot_mod/bl … 40_flash.c</a></p></blockquote></div><p>In fact region corrupted is more than uboot sector.<br />Flash 0 ~ 0x16,ffd0 corrupted.<br />I notice base address is 16M in ar7240_spi.c<br />I think there will be extensive code modification to support 32M, <br />which might be beyond my ability to tweak.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264972">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						10 Feb 2015, 19:56					</div>
				</div>
				<div class="post-content content">
					<p>I implement KSEG1ADDR(0x1f011000) like pepe2k suggestion and no problem anymore with wireless initialization. however i have another problem now.<br />when i do reboot either from openwrt gui or from ssh console, kernel will hang.<br />below is the&nbsp; kernel dump. anybody knows why?</p><div class="quotebox"><blockquote><p>root@MyNetN750:/# reboot<br />procd: - shutdown -<br />root@MyNetN750:/# [&nbsp; 227.160000] br-lan: port 3(wlan0) entered disabled state<br />[&nbsp; 227.160000] br-lan: port 2(wlan1) entered disabled state<br />[&nbsp; 227.170000] br-lan: port 1(eth0.2) entered disabled state<br />[&nbsp; 227.180000] device eth0.2 left promiscuous mode<br />[&nbsp; 227.190000] br-lan: port 1(eth0.2) entered disabled state<br />[&nbsp; 227.190000] IPv6: ADDRCONF(NETDEV_UP): eth0.2: link is not ready<br />[&nbsp; 227.210000] device wlan0 left promiscuous mode<br />[&nbsp; 227.210000] br-lan: port 3(wlan0) entered disabled state<br />[&nbsp; 227.220000] device wlan1 left promiscuous mode<br />[&nbsp; 227.220000] br-lan: port 2(wlan1) entered disabled state<br />[&nbsp; 227.590000] device eth0 left promiscuous mode<br />[&nbsp; 227.600000] eth0: link down<br />procd: - SIGTERM processes -<br />Feb&nbsp; 9 23:35:10 transmission-daemon[3075]: Couldn&#039;t save temporary file &quot;/overlay/transmission/settings.json.tmp.oolu9O&quot;: No such file or directory (variant.c:1227)<br />Feb&nbsp; 9 23:35:10 transmission-daemon[3075]: Closing session<br />procd:[&nbsp; 231.550000] Unhandled kernel unaligned access[#1]:<br />[&nbsp; 231.550000] CPU: 0 PID: 3375 Comm: procd Not tainted 3.14.30 #19<br />[&nbsp; 231.550000] task: 864d1320 ti: 87bd2000 task.ti: 87bd2000<br />[&nbsp; 231.550000] $ 0&nbsp; &nbsp;: 00000000 00000001 ffffff71 00000001<br />[&nbsp; 231.550000] $ 4&nbsp; &nbsp;: 8034fb58 87bd3b88 00000087 70000000<br />[&nbsp; 231.550000] $ 8&nbsp; &nbsp;: 00000001 0e000000 87854481 00000200<br />[&nbsp; 231.550000] $12&nbsp; &nbsp;: 10000000 20000000 40000000 02000000<br />[&nbsp; 231.550000] $16&nbsp; &nbsp;: 87913210 878c4900 80354304 803b0000<br />[&nbsp; 231.550000] $20&nbsp; &nbsp;: 80314c7c 80344e1c 803b0000 00000000<br />[&nbsp; 231.550000] $24&nbsp; &nbsp;: 04000000 08000000<br />[&nbsp; 231.550000] $28&nbsp; &nbsp;: 87bd2000 87bd3c00 7ff6e8a8 801b2210<br />[&nbsp; 231.550000] Hi&nbsp; &nbsp; : 0000028f<br />[&nbsp; 231.550000] Lo&nbsp; &nbsp; : 00000001<br />[&nbsp; 231.550000] epc&nbsp; &nbsp;: 801b2210 m25p_remove+0x2c/0x1a4<br />[&nbsp; 231.550000]&nbsp; &nbsp; &nbsp;Not tainted<br />[&nbsp; 231.550000] ra&nbsp; &nbsp; : 801b2210 m25p_remove+0x2c/0x1a4<br />[&nbsp; 231.550000] Status: 1100dc03 KERNEL EXL IE<br />[&nbsp; 231.550000] Cause : 00800010<br />[&nbsp; 231.550000] BadVA : ffffff91<br />[&nbsp; 231.550000] PrId&nbsp; : 0001974c (MIPS 74Kc)<br />[&nbsp; 231.550000] Modules linked in: ifb ath9k ath9k_common pppoe ppp_async iptable_nat ip6table_nat ath9k_hw ath pppox ppp_generic pl2303 nf_nat_pptp nf_nat_ipv6 nf_nat_ipv4 nf_nat_amanda nf_conntrack_pptp nf_conntrack_ipv6 nf_conntrack_ipv4 nf_conntrack_amanda mac80211 ftdi_sio cfg80211 xt_time xt_tcpudp xt_tcpmss xt_string xt_statistic xt_state xt_recent xt_quota xt_pkttype xt_owner xt_nat xt_multiport xt_mark xt_mac xt_limit xt_length xt_id xt_hl xt_helper xt_ecn xt_dscp xt_conntrack xt_connmark xt_connlimit xt_connbytes xt_comment xt_addrtype xt_TCPMSS xt_REDIRECT xt_NETMAP xt_LOG xt_HL xt_DSCP xt_CT xt_CLASSIFY usbserial ums_usbat ums_sddr55 ums_sddr09 ums_karma ums_jumpshot ums_isd200 ums_freecom ums_datafab ums_cypress ums_alauda ts_kmp ts_fsm ts_bm slhc nf_nat_tftp nf_nat_snmp_basic nf_nat_sip nf_nat_rtsp nf_nat_proto_gre nf_nat_irc nf_nat_h323 nf_nat_ftp nf_defrag_ipv6 nf_defrag_ipv4 nf_conntrack_tftp nf_conntrack_snmp nf_conntrack_sip nf_conntrack_rtsp nf_conntrack_rtcache nf_conntrack_proto_gre nf_conntrack_irc nf_conntrack_h323 nf_conntrack_ftp nf_conntrack_broadcast iptable_raw iptable_mangle iptable_filter ipt_REJECT ipt_MASQUERADE ipt_ECN ip_tables crc_ccitt compat fuse act_connmark act_skbedit act_mirred em_u32 cls_u32 cls_tcindex cls_flow cls_route cls_fw sch_hfsc sch_ingress ledtrig_usbdev ip6t_NPT ip6t_MASQUERADE nf_nat nf_conntrack ip6t_rt ip6t_frag ip6t_hbh ip6t_eui64 ip6t_mh ip6t_ah ip6t_ipv6header ip6t_REJECT ip6table_raw ip6table_mangle ip6table_filter ip6_tables x_tables nfsv3 nfs tun snd_compress snd_pcm_oss snd_mixer_oss snd_pcm snd_timer snd_rawmidi snd_seq_device snd_hwdep snd soundcore vfat fat lockd sunrpc cifs nls_utf8 nls_iso8859_1 nls_cp437 ipv6 sha256_generic md5 md4 hmac ecb des_generic arc4 crypto_blkcipher usb_storage ohci_platform ohci_hcd ehci_platform ehci_hcd sd_mod scsi_mod gpio_button_hotplug ext4 crc16 jbd2 mbcache usbcore nls_base usb_common crypto_hash [last unloaded: ifb]<br />[&nbsp; 231.550000] Process procd (pid: 3375, threadinfo=87bd2000, task=864d1320, tls=77496440)<br />[&nbsp; 231.550000] Stack : 80314c7c 80344e1c 87915630 80000000 87bd3c78 87bd3c40 80314c7c 80344e1c<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 803b0000 00000000 7ff6e8a8 8019d230 00000000 8019d8c0 879155a0 879155e8<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00000000 87bd3c44 87bd3c44 87915630 87911ee8 87915630 87911ee8 878c4900<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8034fbb4 80354304 803b0000 800df198 80354304 8012cfe8 00000000 878c4900<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8034fbb4 80354304 803b0000 8008d914 80344e1c 801a0a0c 80314c7c 80344e1c<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br />[&nbsp; 231.550000] Call Trace:<br />[&nbsp; 231.550000] [&lt;801b2210&gt;] m25p_remove+0x2c/0x1a4<br />[&nbsp; 231.550000] [&lt;8008d914&gt;] __device_release_driver+0x6c/0xd0<br />[&nbsp; 231.550000] [&lt;80113ccc&gt;] device_release_driver+0x28/0x40<br />[&nbsp; 231.550000] [&lt;800ee1f8&gt;] bus_remove_device+0xec/0x120<br />[&nbsp; 231.550000] [&lt;80113464&gt;] device_del+0x110/0x170<br />[&nbsp; 231.550000] [&lt;8011435c&gt;] device_unregister+0x14/0x28<br />[&nbsp; 231.550000] [&lt;800afdb8&gt;] __unregister+0x18/0x30<br />[&nbsp; 231.550000] [&lt;8011362c&gt;] device_for_each_child+0x84/0x94<br />[&nbsp; 231.550000] [&lt;80256c10&gt;] spi_unregister_master+0x8c/0xa4<br />[&nbsp; 231.550000] [&lt;80255788&gt;] spi_bitbang_stop+0x10/0x20<br />[&nbsp; 231.550000] [&lt;800ca3e0&gt;] ath79_spi_remove+0x20/0x58<br />[&nbsp; 231.550000] [&lt;801141e4&gt;] device_shutdown+0x100/0x158<br />[&nbsp; 231.550000] [&lt;8019ce04&gt;] kernel_restart+0x14/0x6c<br />[&nbsp; 231.550000] [&lt;80079504&gt;] SyS_reboot+0xf8/0x1d4<br />[&nbsp; 231.550000] [&lt;8006283c&gt;] handle_sys+0x11c/0x140<br />[&nbsp; 231.550000]<br />[&nbsp; 231.550000]<br />Code: 02202021&nbsp; 0c062a05&nbsp; 00408021 &lt;8c420020&gt; 240300c2&nbsp; 94420000&nbsp; 10430022&nbsp; 240300ef&nbsp; 10430020<br />[&nbsp; 231.950000] ---[ end trace 56a15f3fb72857dd ]---</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p265212">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						12 Feb 2015, 03:43					</div>
				</div>
				<div class="post-content content">
					<p>i&#039;m using macronix 32MB p/n: MX25L25635F<br />more information on this shutdown hang issue<br />any idea what is &quot;m25p80 spi0.0: error -143 reading SR&quot; ?</p><div class="quotebox"><blockquote><p>root@OpenWrt:/# reboot<br />procd: - shutdown -<br />root@OpenWrt:/# [&nbsp; 546.820000] br-lan: port 3(wlan1) entered disabled state<br />[&nbsp; 546.820000] br-lan: port 2(wlan0) entered disabled state<br />[&nbsp; 546.830000] br-lan: port 1(eth0.1) entered disabled state<br />[&nbsp; 546.840000] device eth0.1 left promiscuous mode<br />[&nbsp; 546.850000] br-lan: port 1(eth0.1) entered disabled state<br />[&nbsp; 546.860000] IPv6: ADDRCONF(NETDEV_UP): eth0.1: link is not ready<br />[&nbsp; 546.900000] device wlan0 left promiscuous mode<br />[&nbsp; 546.900000] br-lan: port 2(wlan0) entered disabled state<br />[&nbsp; 546.910000] device wlan1 left promiscuous mode<br />[&nbsp; 546.910000] br-lan: port 3(wlan1) entered disabled state<br />[&nbsp; 547.270000] device eth0 left promiscuous mode<br />[&nbsp; 547.280000] eth0: link down<br />procd: - SIGTERM processes -<br />procd:[&nbsp; 551.270000] m25p80 spi0.0: error -143 reading SR<br />[&nbsp; 551.270000] Removing MTD device #8 (rootfs_data) with use count 1<br />[&nbsp; 551.290000] reboot: Restarting system</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>dony71</strong> on 12 Feb 2015, 03:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p265314">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						12 Feb 2015, 22:01					</div>
				</div>
				<div class="post-content content">
					<p>activate debug level 4 shows this dump on reboot hang</p><div class="quotebox"><blockquote><p>root@OpenWrt:/# reboot<br />procd: signal_shutdown(51): Triggering reboot<br />procd: procd_shutdown(187): Shutting down system with event 1234567<br />procd: - shutdown -<br />procd: _rc(135): running /etc/rc.d/K* shutdown<br />procd: q_initd_run(71): start /etc/rc.d/K50dropbear shutdown<br />root@OpenWrt:/# procd: service_instance_update(62): Free instance dropbear::instance1<br />procd: q_initd_complete(101): stop /etc/rc.d/K50dropbear shutdown<br />procd: q_initd_run(71): start /etc/rc.d/K85odhcpd shutdown<br />procd: service_instance_update(62): Free instance odhcpd::instance1<br />procd: q_initd_complete(101): stop /etc/rc.d/K85odhcpd shutdown<br />procd: q_initd_run(71): start /etc/rc.d/K89log shutdown<br />procd: service_instance_update(62): Free instance log::instance1<br />procd: q_initd_complete(101): stop /etc/rc.d/K89log shutdown<br />procd: q_initd_run(71): start /etc/rc.d/K90network shutdown<br />procd: watch_notify_cb(107): Received ubus notify &#039;interface.down&#039;:<br />{&quot;interface&quot;:&quot;lan&quot;,&quot;up&quot;:false,&quot;pending&quot;:false,&quot;available&quot;:tr[&nbsp; &nbsp;31.980000] br-lan: port 3(wlan1) entered disabled state<br />ue,&quot;autostart&quot;:f[&nbsp; &nbsp;31.980000] br-lan: port 2(wlan0) entered disabled state<br />alse,&quot;proto&quot;:&quot;st[&nbsp; &nbsp;31.990000] br-lan: port 1(eth0.1) entered disabled state<br />atic&quot;,&quot;device&quot;:&quot;br-lan&quot;,&quot;data&quot;:{}}<br />[&nbsp; &nbsp;32.000000] device eth0.1 left promiscuous mode<br />[&nbsp; &nbsp;32.000000] br-lan: port 1(eth0.1) entered disabled state<br />[&nbsp; &nbsp;32.010000] IPv6: ADDRCONF(NETDEV_UP): eth0.1: link is not ready<br />procd: hotplug_handler_debug(404): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;[&nbsp; &nbsp;32.030000] device wlan0 left promiscuous mode<br />:&quot;\/devices\/vir[&nbsp; &nbsp;32.040000] br-lan: port 2(wlan0) entered disabled state<br />tual\/net\/eth0.1\/queues\/tx-0&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;[&nbsp; &nbsp;32.050000] device wlan1 left promiscuous mode<br />433&quot;}}<br />procd: h[&nbsp; &nbsp;32.050000] br-lan: port 3(wlan1) entered disabled state<br />otplug_handler_debug(404): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/virtual\/net<br />\/eth0.1&quot;,&quot;SUBSYSTEM&quot;:&quot;net&quot;,&quot;DEVTYPE&quot;:&quot;vlan&quot;,&quot;INTERFACE&quot;:&quot;eth0.1&quot;,&quot;IFINDEX&quot;:&quot;6&quot;,&quot;SEQNUM&quot;:&quot;434&quot;}}<br />procd: rule_handle_command(355): Command: execprocd: rule_handle_command(357):&nbsp; /sbin/hotplug-callprocd:<br />rule_handle_command(357):&nbsp; netprocd: rule_handle_command(358):<br />procd: rule_handle_command(360): Message:procd: rule_handle_command(362):&nbsp; ACTION=removeprocd: rule_handle_command(362): <br />DEVPATH=/devices/virtual/net/eth0.1procd: rule_handle_command(362):&nbsp; SUBSYSTEM=netprocd: rule_handle_command(362): <br />DEVTYPE=vlanprocd: rule_handle_command(362):&nbsp; INTERFACE=eth0.1procd: rule_handle_command(362):&nbsp; IFINDEX=6procd:<br />rule_handle_command(362):&nbsp; SEQNUM=434procd: rule_handle_command(363):<br />procd: queue_next(281): Launched hotplug exec instance, pid=1314<br />procd: hotplug_handler_debug(404): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/virtual\/net\/br-lan\/queues\/tx-<br />0&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;435&quot;}}<br />procd: hotplug_handler_debug(404): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/virtual\/net\/br-<br />lan&quot;,&quot;SUBSYSTEM&quot;:&quot;net&quot;,&quot;DEVTYPE&quot;:&quot;bridge&quot;,&quot;INTERFACE&quot;:&quot;br-lan&quot;,&quot;IFINDEX&quot;:&quot;5&quot;,&quot;SEQNUM&quot;:&quot;436&quot;}}<br />procd: rule_handle_command(355): Command: execprocd: rule_handle_command(357):&nbsp; /sbin/hotplug-callprocd:<br />rule_handle_command(357):&nbsp; netprocd: rule_handle_command(358):<br />procd: rule_handle_command(360): Message:procd: rule_handle_command(362):&nbsp; ACTION=removeprocd: rule_handle_command(362): <br />DEVPATH=/devices/virtual/net/br-lanprocd: rule_handle_command(362):&nbsp; SUBSYSTEM=netprocd: rule_handle_command(362): <br />DEVTYPE=bridgeprocd: rule_handle_command(362):&nbsp; INTERFACE=br-lanprocd: rule_handle_command(362):&nbsp; IFINDEX=5procd:<br />rule_handle_command(362):&nbsp; SEQNUM=436procd: rule_handle_command(363):<br />procd: watch_notify_cb(107): Received ubus notify &#039;interface.down&#039;:<br />{&quot;interface&quot;:&quot;loopback&quot;,&quot;up&quot;:false,&quot;pending&quot;:false,&quot;available&quot;:true,&quot;autostart&quot;:false,&quot;proto&quot;:&quot;static&quot;,&quot;device&quot;:&quot;lo&quot;,&quot;data<br />&quot;:{}}<br />procd: watch_notify_cb(107): Received ubus notify &#039;interface.down&#039;:<br />{&quot;interface&quot;:&quot;wan&quot;,&quot;up&quot;:false,&quot;pending&quot;:false,&quot;available&quot;:true,&quot;autostart&quot;:false,&quot;proto&quot;:&quot;dhcp&quot;,&quot;device&quot;:&quot;eth0.2&quot;,&quot;data&quot;:<br />{&quot;leasetime&quot;:691200,&quot;ntpserver&quot;:&quot;207.46.232.182 192.43.244.18&quot;}}<br />cat: can&#039;t open &#039;/sys/devices/virtual/ieee80211/phy*/name&#039;: No such file or directory<br />sh: remove: unknown operand<br />sh: remove: unknown operand<br />procd: queue_proc_cb(286): Finished hotplug exec instance, pid=1314<br />procd: queue_next(281): Launched hotplug exec instance, pid=1336<br />[&nbsp; &nbsp;32.400000] device eth0 left promiscuous mode<br />procd: hotplug_handler_debug(404): {{&quot;ACTION&quot;:&quot;r[&nbsp; &nbsp;32.410000] eth0: link down<br />emove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/virtual\/net\/eth0.2\/queues\/tx-0&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;437&quot;}}<br />procd: hotplug_handler_debug(404): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/virtual\/net<br />\/eth0.2&quot;,&quot;SUBSYSTEM&quot;:&quot;net&quot;,&quot;DEVTYPE&quot;:&quot;vlan&quot;,&quot;INTERFACE&quot;:&quot;eth0.2&quot;,&quot;IFINDEX&quot;:&quot;7&quot;,&quot;SEQNUM&quot;:&quot;438&quot;}}<br />procd: rule_handle_command(355): Command: execprocd: rule_handle_command(357):&nbsp; /sbin/hotplug-callprocd:<br />rule_handle_command(357):&nbsp; netprocd: rule_handle_command(358):<br />procd: rule_handle_command(360): Message:procd: rule_handle_command(362):&nbsp; ACTION=removeprocd: rule_handle_command(362): <br />DEVPATH=/devices/virtual/net/eth0.2procd: rule_handle_command(362):&nbsp; SUBSYSTEM=netprocd: rule_handle_command(362): <br />DEVTYPE=vlanprocd: rule_handle_command(362):&nbsp; INTERFACE=eth0.2procd: rule_handle_command(362):&nbsp; IFINDEX=7procd:<br />rule_handle_command(362):&nbsp; SEQNUM=438procd: rule_handle_command(363):<br />cat: can&#039;t open &#039;/sys/devices/virtual/ieee80211/phy*/name&#039;: No such file or directory<br />sh: remove: unknown operand<br />sh: remove: unknown operand<br />procd: queue_proc_cb(286): Finished hotplug exec instance, pid=1336<br />procd: queue_next(281): Launched hotplug exec instance, pid=1362<br />cat: can&#039;t open &#039;/sys/devices/virtual/ieee80211/phy*/name&#039;: No such file or directory<br />sh: remove: unknown operand<br />sh: remove: unknown operand<br />procd: queue_proc_cb(286): Finished hotplug exec instance, pid=1362<br />procd: q_initd_complete(101): stop /etc/rc.d/K90network shutdown<br />procd: q_initd_run(71): start /etc/rc.d/K98boot shutdown<br />procd: q_initd_complete(101): stop /etc/rc.d/K98boot shutdown<br />procd: q_initd_run(71): start /etc/rc.d/K99umount shutdown<br />procd: q_initd_complete(101): stop /etc/rc.d/K99umount shutdown<br />procd: procd_state_next(172): Change state 5 -&gt; 6<br />procd: - SIGTERM processes -<br />procd:[&nbsp; &nbsp;36.210000] Unhandled kernel unaligned access[#1]:<br />[&nbsp; &nbsp;36.210000] CPU: 0 PID: 1384 Comm: procd Not tainted 3.14.30 #32<br />[&nbsp; &nbsp;36.210000] task: 87bf44c8 ti: 87bea000 task.ti: 87bea000<br />[&nbsp; &nbsp;36.210000] $ 0&nbsp; &nbsp;: 00000000 00000001 ffffff71 00000001<br />[&nbsp; &nbsp;36.210000] $ 4&nbsp; &nbsp;: 8034bb40 87bebb88 00000087 70000000<br />[&nbsp; &nbsp;36.210000] $ 8&nbsp; &nbsp;: 00000001 0e000000 87854481 00000200<br />[&nbsp; &nbsp;36.210000] $12&nbsp; &nbsp;: 10000000 20000000 40000000 02000000<br />[&nbsp; &nbsp;36.210000] $16&nbsp; &nbsp;: 87913210 878c4900 803502ec 803b0000<br />[&nbsp; &nbsp;36.210000] $20&nbsp; &nbsp;: 803108bc 80340e1c 803b0000 00000000<br />[&nbsp; &nbsp;36.210000] $24&nbsp; &nbsp;: 04000000 08000000<br />[&nbsp; &nbsp;36.210000] $28&nbsp; &nbsp;: 87bea000 87bebc00 7fe577d8 801b1510<br />[&nbsp; &nbsp;36.210000] Hi&nbsp; &nbsp; : 0000028f<br />[&nbsp; &nbsp;36.210000] Lo&nbsp; &nbsp; : 00000001<br />[&nbsp; &nbsp;36.210000] epc&nbsp; &nbsp;: 801b1510 m25p_remove+0x2c/0x1a4<br />[&nbsp; &nbsp;36.210000]&nbsp; &nbsp; &nbsp;Not tainted<br />[&nbsp; &nbsp;36.210000] ra&nbsp; &nbsp; : 801b1510 m25p_remove+0x2c/0x1a4<br />[&nbsp; &nbsp;36.210000] Status: 1100dc03 KERNEL EXL IE<br />[&nbsp; &nbsp;36.210000] Cause : 00800010<br />[&nbsp; &nbsp;36.210000] BadVA : ffffff91<br />[&nbsp; &nbsp;36.210000] PrId&nbsp; : 0001974c (MIPS 74Kc)<br />[&nbsp; &nbsp;36.210000] Modules linked in: ath9k ath9k_common pppoe ppp_async iptable_nat ath9k_hw ath pppox ppp_generic<br />nf_nat_ipv4 nf_conntrack_ipv6 nf_conntrack_ipv4 mac80211 ipt_MASQUERADE cfg80211 xt_time xt_tcpudp xt_state xt_nat<br />xt_multiport xt_mark xt_mac xt_limit xt_id xt_conntrack xt_comment xt_TCPMSS xt_REDIRECT xt_LOG xt_CT slhc nf_nat_irc<br />nf_nat_ftp nf_nat nf_defrag_ipv6 nf_defrag_ipv4 nf_conntrack_rtcache nf_conntrack_irc nf_conntrack_ftp nf_conntrack<br />iptable_raw iptable_mangle iptable_filter ipt_REJECT ip_tables crc_ccitt compat ip6t_REJECT ip6table_raw ip6table_mangle<br />ip6table_filter ip6_tables x_tables ipv6 arc4 crypto_blkcipher ehci_platform ehci_hcd gpio_button_hotplug usbcore nls_base<br />usb_common<br />[&nbsp; &nbsp;36.210000] Process procd (pid: 1384, threadinfo=87bea000, task=87bf44c8, tls=77693440)<br />[&nbsp; &nbsp;36.210000] Stack : 803108bc 80340e1c 87915630 80000000 87bebc78 87bebc40 803108bc 80340e1c<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 803b0000 00000000 7fe577d8 8019c530 00000000 8019cbc0 879155a0 879155e8<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00000000 87bebc44 87bebc44 87915630 87911ee8 87915630 87911ee8 878c4900<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8034bb9c 803502ec 803b0000 800dee5c 803502ec 8012c670 00000000 878c4900<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8034bb9c 803502ec 803b0000 8008d8fc 80340e1c 8019fd0c 803108bc 80340e1c<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br />[&nbsp; &nbsp;36.210000] Call Trace:<br />[&nbsp; &nbsp;36.210000] [&lt;801b1510&gt;] m25p_remove+0x2c/0x1a4<br />[&nbsp; &nbsp;36.210000] [&lt;8008d8fc&gt;] __device_release_driver+0x6c/0xd0<br />[&nbsp; &nbsp;36.210000] [&lt;80113354&gt;] device_release_driver+0x28/0x40<br />[&nbsp; &nbsp;36.210000] [&lt;800edebc&gt;] bus_remove_device+0xec/0x120<br />[&nbsp; &nbsp;36.210000] [&lt;80112aec&gt;] device_del+0x110/0x170<br />[&nbsp; &nbsp;36.210000] [&lt;801139e4&gt;] device_unregister+0x14/0x28<br />[&nbsp; &nbsp;36.210000] [&lt;800afaac&gt;] __unregister+0x18/0x30<br />[&nbsp; &nbsp;36.210000] [&lt;80112cb4&gt;] device_for_each_child+0x84/0x94<br />[&nbsp; &nbsp;36.210000] [&lt;80255dd0&gt;] spi_unregister_master+0x8c/0xa4<br />[&nbsp; &nbsp;36.210000] [&lt;80254948&gt;] spi_bitbang_stop+0x10/0x20<br />[&nbsp; &nbsp;36.210000] [&lt;800ca0cc&gt;] ath79_spi_remove+0x20/0x58<br />[&nbsp; &nbsp;36.210000] [&lt;8011386c&gt;] device_shutdown+0x100/0x158<br />[&nbsp; &nbsp;36.210000] [&lt;8019c104&gt;] kernel_restart+0x14/0x6c<br />[&nbsp; &nbsp;36.210000] [&lt;80079504&gt;] SyS_reboot+0xf8/0x1d4<br />[&nbsp; &nbsp;36.210000] [&lt;8006283c&gt;] handle_sys+0x11c/0x140<br />[&nbsp; &nbsp;36.210000]<br />[&nbsp; &nbsp;36.210000]<br />Code: 02202021&nbsp; 0c0626c5&nbsp; 00408021 &lt;8c420020&gt; 240300c2&nbsp; 94420000&nbsp; 10430022&nbsp; 240300ef&nbsp; 10430020<br />[&nbsp; &nbsp;36.500000] ---[ end trace 3007a3e89cf3aab2 ]---</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>dony71</strong> on 13 Feb 2015, 00:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266316">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						20 Feb 2015, 21:17					</div>
				</div>
				<div class="post-content content">
					<p>earlier i&#039;m using trunk to patch this and it seems kernel is being changed in&nbsp; latest trunk chaos calmer made impossible this patch to work. reboot command will result always hang.<br />i verify the patch on barrier breaker and it works.<br />does anybody know how to apply this patch on current trunk?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266918">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						26 Feb 2015, 04:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>earlier i&#039;m using trunk to patch this and it seems kernel is being changed in&nbsp; latest trunk chaos calmer made impossible this patch to work. reboot command will result always hang.<br />i verify the patch on barrier breaker and it works.<br />does anybody know how to apply this patch on current trunk?</p></blockquote></div><p><a href="https://github.com/981213/openwrt/commit/1345c25fa6222337ccffa069653f22ea0647a177">https://github.com/981213/openwrt/commi … ea0647a177</a><br />This works.Just can not reboot from luci interface and reboot command from SSH.I hope you fix it and post here.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266932">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						26 Feb 2015, 07:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>axishero wrote:</cite><blockquote><div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>earlier i&#039;m using trunk to patch this and it seems kernel is being changed in&nbsp; latest trunk chaos calmer made impossible this patch to work. reboot command will result always hang.<br />i verify the patch on barrier breaker and it works.<br />does anybody know how to apply this patch on current trunk?</p></blockquote></div><p><a href="https://github.com/981213/openwrt/commit/1345c25fa6222337ccffa069653f22ea0647a177">https://github.com/981213/openwrt/commi … ea0647a177</a><br />This works.Just can not reboot from luci interface and reboot command from SSH.I hope you fix it and post here.</p></blockquote></div><p>This is exactly problem I reported earlier<br />As I mention high likely kernel issue<br />I already issue ticket for this</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267582">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						4 Mar 2015, 08:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dony71 wrote:</cite><blockquote><div class="quotebox"><cite>axishero wrote:</cite><blockquote><div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>earlier i&#039;m using trunk to patch this and it seems kernel is being changed in&nbsp; latest trunk chaos calmer made impossible this patch to work. reboot command will result always hang.<br />i verify the patch on barrier breaker and it works.<br />does anybody know how to apply this patch on current trunk?</p></blockquote></div><p><a href="https://github.com/981213/openwrt/commit/1345c25fa6222337ccffa069653f22ea0647a177">https://github.com/981213/openwrt/commi … ea0647a177</a><br />This works.Just can not reboot from luci interface and reboot command from SSH.I hope you fix it and post here.</p></blockquote></div><p>This is exactly problem I reported earlier<br />As I mention high likely kernel issue<br />I already issue ticket for this</p></blockquote></div><p>Where is&nbsp; the ticket</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267644">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						4 Mar 2015, 19:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Where is&nbsp; the ticket</p></blockquote></div><p><a href="https://dev.openwrt.org/ticket/18985">https://dev.openwrt.org/ticket/18985</a></p>											<p class="post-edited">(Last edited by <strong>dony71</strong> on 4 Mar 2015, 19:24)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=45219&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>