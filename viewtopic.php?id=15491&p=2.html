<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> AR430W Atheros AR2318 / AR2317 chipset support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 8 Feb 2018 and 27 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=15491&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=15491&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p71178">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						21 Jul 2008, 04:24					</div>
				</div>
				<div class="post-content content">
					<p>hi<br/>&nbsp; I have never used redboot.&nbsp; but won&#039;t mind reading up a bit...<br/>on the reference you posted, you said bdrestore erase fis info, and<br/>you need lots of fis command to restore a working fis directory<br/>do you mind tell me where to find reference for the fis directory.</p><p>Is this all I need<br/>-----------------<br/>bdrestore<br/>load -r -b %{FREEMEMLO} openwrt-atheros-2.6-vmlinux.lzma<br/>fis create -e 0x80041000 -r 0x80041000 vmlinux.bin.l7<br/>load -r -b %{FREEMEMLO} openwrt-atheros-2.6-root.squashfs<br/>fis create -l 0xLENGTH rootfs<br/>--------------------</p><p>I don&#039;t have a serial interface to this board...</p>											<p class="post-edited">(Last edited by <strong>cycrap</strong> on 21 Jul 2008, 04:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71181">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						21 Jul 2008, 06:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cycrap wrote:</cite><blockquote><p>hi<br/>Is this all I need<br/>-----------------<br/>bdrestore<br/>load -r -b %{FREEMEMLO} openwrt-atheros-2.6-vmlinux.lzma<br/>fis create -e 0x80041000 -r 0x80041000 vmlinux.bin.l7<br/>load -r -b %{FREEMEMLO} openwrt-atheros-2.6-root.squashfs<br/>fis create -l 0xLENGTH rootfs<br/>--------------------</p><p>I don&#039;t have a serial interface to this board...</p></blockquote></div><p>how do you plan to do the above then?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71184">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						21 Jul 2008, 08:14					</div>
				</div>
				<div class="post-content content">
					<p>here is what I did, and now opwnwrt is not booting (but dd-wrt redboot is okey)</p><p>-----------------------------<br/>== Executing boot script in 3.780 seconds - enter ^C to abort<br/>^C<br/>DD-WRT&gt; fis list<br/>Name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLASH addr&nbsp; Mem addr&nbsp; &nbsp; Length&nbsp; &nbsp; &nbsp; Entry point<br/>RedBoot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xBFC00000&nbsp; 0xBFC00000&nbsp; 0x00030000&nbsp; 0x00000000<br/>vmlinux.bin.l7&nbsp; &nbsp; 0xBFC30000&nbsp; 0x80041000&nbsp; 0x000B0000&nbsp; 0x80041000<br/>rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0xBFCE0000&nbsp; 0x80040800&nbsp; 0x00300000&nbsp; 0x80040800<br/>FIS directory&nbsp; &nbsp; &nbsp;0xBFFE0000&nbsp; 0xBFFE0000&nbsp; 0x0000F000&nbsp; 0x00000000<br/>RedBoot config&nbsp; &nbsp; 0xBFFEF000&nbsp; 0xBFFEF000&nbsp; 0x00001000&nbsp; 0x00000000<br/>DD-WRT&gt; bdrestore<br/>Board config&nbsp; found at 0xbfff0000<br/>Radio config&nbsp; found at 0xbfff00f8<br/>Starting sector program for 0xbffe0000! Please wait!<br/>Starting sector program for 0xbfff0000! Please wait!<br/>Restore completed successfully!!<br/>DD-WRT&gt; fis list<br/>Name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FLASH addr&nbsp; Mem addr&nbsp; &nbsp; Length&nbsp; &nbsp; &nbsp; Entry point<br/>&lt;Not a string: 0x80FF0000&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x41523533&nbsp; 0x31352064&nbsp; 0x65666175<br/>0x6C740000<br/>---------------------------------------------------------</p><p>so I restored the config file, and both redboot and openwrt is gone</p><p>---------------------------------------------<br/>DD-WRT&gt; load /tftproot/ap61.ram<br/>Using default protocol (TFTP)<br/>Entry point: 0x800410bc, address range: 0x80041000-0x800680d8<br/>DD-WRT&gt; go<br/>---------------------------------------------</p><p>then I reconnect to the router at 192.168.1.1</p><p>---------------------------------------------<br/>DD-WRT&gt; fconfig -i<br/>Initialize non-volatile configuration - continue (y/n)? y<br/>Run script at boot: false<br/>Use BOOTP for network configuration: true<br/>Default server IP address: 192.168.1.254<br/>Console baud rate: 9600<br/>GDB connection port: 9000<br/>Force console for special debug messages: false<br/>Network debug at boot time: false<br/>Update RedBoot non-volatile configuration - continue (y/n)? y<br/>... Erase from 0xbffe0000-0xbfff0000: .<br/>... Program from 0x80ff0000-0x81000000 at 0xbffe0000: .<br/>DD-WRT&gt; fis init<br/>About to initialize [format] FLASH image system - continue (y/n)? y<br/>*** Initialize FLASH Image System<br/>Relocating Board Data to new location.<br/>Found board data at 0xbffe0000.<br/>Found eeprom data at 0xbffef000.<br/>Failed to cache eeprom<br/>... Erase from 0xbffe0000-0xbfff0000: .<br/>... Program from 0x80ff0000-0x81000000 at 0xbffe0000: .<br/>DD-WRT&gt; ip_address -h 192.168.1.23<br/>IP: 192.168.1.1/255.255.255.0, Gateway: 0.0.0.0<br/>Default server: 192.168.1.23<br/>DD-WRT&gt; load -r -b %{FREEMEMLO} /tftproot/ap61.rom<br/>Using default protocol (TFTP)<br/>Raw file loaded 0x80080000-0x800a8717, assumed entry at 0x80080000<br/>DD-WRT&gt; fis create -l 0x30000 -e 0xbfc00000 RedBoot<br/>An image named &#039;RedBoot&#039; exists - continue (y/n)? y<br/>... Erase from 0xbfc00000-0xbfc30000: ...<br/>... Program from 0x80080000-0x800a8718 at 0xbfc00000: ...<br/>... Erase from 0xbffe0000-0xbfff0000: .<br/>... Program from 0x80ff0000-0x81000000 at 0xbffe0000: .<br/>DD-WRT&gt; reset<br/>--------------------------------------</p><p>only thing I saw is the &quot;Failed to cache eeprom<br/>now loading the openWrt part</p><p>--------------------------------------------------<br/>DD-WRT&gt; ip_address -h 192.168.1.23<br/>IP: 192.168.1.1/255.255.255.0, Gateway: 0.0.0.0<br/>Default server: 192.168.1.23<br/>DD-WRT&gt; load -r -b %{FREEMEMLO} /tftproot/test/openwrt-atheros-vmlinux.lzma<br/>Using default protocol (TFTP)<br/>Raw file loaded 0x80040800-0x800f07ff, assumed entry at 0x80040800<br/>DD-WRT&gt; fis init<br/>About to initialize [format] FLASH image system - continue (y/n)? y<br/>*** Initialize FLASH Image System<br/>... Erase from 0xbffe0000-0xbfff0000: .<br/>... Program from 0x80ff0000-0x81000000 at 0xbffe0000: .<br/>DD-WRT&gt; fis create -e 0x80041000 -r 0x80041000 vmlinux.bin.l7<br/>... Erase from 0xbfc30000-0xbfce0000: ...........<br/>... Program from 0x80040800-0x800f0800 at 0xbfc30000: ...........<br/>... Erase from 0xbffe0000-0xbfff0000: .<br/>... Program from 0x80ff0000-0x81000000 at 0xbffe0000: .<br/>DD-WRT&gt; fis free<br/>&nbsp; 0xBFCE0000 .. 0xBFFE0000<br/>&nbsp; DD-WRT&gt; load -r -b %{FREEMEMLO} /tftproot/test/openwrt-atheros-root.squashfs<br/>&nbsp; Using default protocol (TFTP)<br/>&nbsp; Raw file loaded 0x80040800-0x801807ff, assumed entry at 0x80040800<br/>&nbsp; DD-WRT&gt; fis create -l 0x00300000 rootfs<br/>&nbsp; ... Erase from 0xbfce0000-0xbffe0000:<br/>&nbsp; ................................................<br/>&nbsp; ... Program from 0x80040800-0x80180800 at 0xbfce0000: ....................<br/>&nbsp; ... Erase from 0xbffe0000-0xbfff0000: .<br/>&nbsp; ... Program from 0x80ff0000-0x81000000 at 0xbffe0000: .<br/>-------------------------------------------------------------</p><p>so openwrt is loaded and need to config now </p><p>----------------------------------------------------<br/>&nbsp; DD-WRT&gt; fconfig boot_script true<br/>&nbsp; boot_script: Setting to true<br/>&nbsp; Update RedBoot non-volatile configuration - continue (y/n)? n<br/>&nbsp; DD-WRT&gt; fconfig bootp false<br/>&nbsp; bootp: Setting to false<br/>&nbsp; Update RedBoot non-volatile configuration - continue (y/n)? n<br/>&nbsp; DD-WRT&gt; fconfig boot_script_timeout 5<br/>&nbsp; boot_script_timeout: Setting to 5<br/>&nbsp; Update RedBoot non-volatile configuration - continue (y/n)? n<br/>&nbsp; DD-WRT&gt; fconfig -l -n<br/>&nbsp; boot_script: true<br/>&nbsp; boot_script_data: <br/>&nbsp; boot_script_timeout: 5<br/>&nbsp; bootp: false<br/>&nbsp; bootp_my_gateway_ip: 0.0.0.0<br/>&nbsp; bootp_my_ip: 0.0.0.0<br/>&nbsp; bootp_my_ip_mask: 0.0.0.0<br/>&nbsp; bootp_server_ip: 192.168.1.254<br/>&nbsp; console_baud_rate: 9600<br/>&nbsp; gdb_port: 9000<br/>&nbsp; info_console_force: false<br/>&nbsp; net_debug: false<br/>&nbsp; DD-WRT&gt; fconfig<br/>&nbsp; Run script at boot: true<br/>&nbsp; Boot script: <br/>&nbsp; .. fis load -l vmlinux.bin.l7<br/>&nbsp; .. exec<br/>&nbsp; Enter script, terminate with empty line<br/>&nbsp; &gt;&gt; fis load -l vmlinux.bin.l7<br/>&nbsp; &gt;&gt; exec<br/>&nbsp; &gt;&gt; <br/>&nbsp; Boot script timeout (1000ms resolution): 5<br/>&nbsp; Use BOOTP for network configuration: false<br/>&nbsp; Gateway IP address: <br/>&nbsp; Local IP address: 192.168.1.1<br/>&nbsp; Local IP address mask: 255.255.255.0<br/>&nbsp; Default server IP address: 192.168.1.254<br/>&nbsp; Console baud rate: 9600<br/>&nbsp; GDB connection port: 9000<br/>&nbsp; Force console for special debug messages: false<br/>&nbsp; Network debug at boot time: false<br/>&nbsp; Update RedBoot non-volatile configuration - continue (y/n)? y<br/>&nbsp; ... Erase from 0xbffe0000-0xbfff0000: .<br/>&nbsp; ... Program from 0x80ff0000-0x81000000 at 0xbffe0000: .<br/>&nbsp; DD-WRT&gt; reset</p><p>---------------------------------</p><p>now the router is hanging after I boot up..<br/>I can still get into the DD-Wrt redboot. but if I wait and let the linux kernel boot, then I am getting 192.168.1.1 not reachable.&nbsp; the kernel image I am using is the same as the one I compiled that boots, but no wireless support...</p><p>please let me know if I am doing something wrong..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71221">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						21 Jul 2008, 20:12					</div>
				</div>
				<div class="post-content content">
					<p>I have a couple question about the procedure I performed</p><p>when I loaded the<br/>openwrt-atheros-vmlinux.lzma<br/>from the network, it says</p><p>----------------------------<br/>Using default protocol (TFTP)<br/>Raw file loaded 0x80040800-0x800f07ff, assumed entry at 0x80040800<br/>----------------------------</p><p>then in the instruction, it says after &quot;fis init&quot;, to do a &quot;fis create&quot; at</p><p>-------------------------------<br/>DD-WRT&gt; fis create -e 0x80041000 -r 0x80041000 vmlinux.bin.l7<br/>-------------------------------</p><p>should I make the -e and -r at 0x80040800?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71224">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						21 Jul 2008, 21:34					</div>
				</div>
				<div class="post-content content">
					<p>OK i don&#039;t want to wipe out my board so I can&#039;t really execute commands.<br/>But I think this is what I did.</p><div class="codebox"><pre><code># bdrestore
# fis init
# fis create -b 0x80041000 -l 0xc0000 -f 0xbfc30000 -e 0x80274000 -n linux
# fis create -b 0 -l 0x2f0000 -n rootfs 
# load -r -b 0x80050000 /tftp/openwrt-atheros-2.6-vmlinux.lzma
# fis write -b 0x80050000 -f 0xbfc30000 -l 0xc0000
# load -r -b 0x80050000 /tftp/openwrt-atheros-2.6-root.jffs2-64k
# fis write -b 0x80050000 -f 0xbfce0000 -l 0x1a0000
# fconfig 
&gt;&gt; fis load -l linux
&gt;&gt; go 0x80274000
&gt;&gt;</code></pre></div><p>I haven&#039;t really read the redboot help page to know what length and free_mem does. I can guess but I am not really interested in finding out. I guess I am becoming too old and tend to stick to the way I know.</p><p>I do manually calculate everything. In my shell I use <strong>ls -l --block-size=65536</strong> to find out what are each block size.</p><p>I guess having the kernel space before the rootfs is not really standard but that&#039;s what I&#039;ve been doing.</p><p>My fis list output is</p><div class="codebox"><pre><code>DD-WRT&gt; fis list                                                                
Name              FLASH addr  Mem addr    Length      Entry point               
RedBoot           0xBFC00000  0xBFC00000  0x00030000  0x00000000                
linux             0xBFC30000  0x80041000  0x000C0000  0x80050000                
rootfs            0xBFCF0000  0xBFCF0000  0x002F0000  0x80050000                
FIS directory     0xBFFE0000  0xBFFE0000  0x0000F000  0x00000000                
RedBoot config    0xBFFEF000  0xBFFEF000  0x00001000  0x00000000     

DD-WRT&gt; fconfig                                                                 
Run script at boot: true                                                        
Boot script:                                                                    
.. fis load -l -c linux                                                         
.. go 0x80274000                                                                
Enter script, terminate with empty line                                         
&gt;&gt; ^C                                                                           
DD-WRT&gt;</code></pre></div><p>Things to note.</p><p>Mem address should be 0x80041000 for the kernel unless you actually compile your linux with a different offset.<br/>On your System.map file you will see that the first symbol is defined at 0x80041000.</p><p>I also have &quot;entry&quot; alias to find out what the go address should be. </p><div class="codebox"><pre><code>alias entry=&#039;cat  build_*/linux-*/linux-*/System.map |grep &quot;kernel_entry&quot;&#039;</code></pre></div><p>I use that on either 7.09 or the latest trunk of the <strong>root kamikaze directory</strong> to find out what the kernel_entry address is.&nbsp; The kernel entry will move around if you reconfigure your kernel and add and remove features.</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 21 Jul 2008, 21:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71242">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						22 Jul 2008, 03:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>yoonix wrote:</cite><blockquote><div class="codebox"><pre><code># bdrestore
# fis init
# fis create -b 0x80041000 -l 0xc0000 -f 0xbfc30000 -e 0x80274000 -n linux
# fis create -b 0 -l 0x2f0000 -n rootfs 
# load -r -b 0x80050000 /tftp/openwrt-atheros-2.6-vmlinux.lzma
# fis write -b 0x80050000 -f 0xbfc30000 -l 0xc0000
# load -r -b 0x80050000 /tftp/openwrt-atheros-2.6-root.jffs2-64k
# fis write -b 0x80050000 -f 0xbfce0000 -l 0x1a0000
# fconfig 
&gt;&gt; fis load -l linux
&gt;&gt; go 0x80274000
&gt;&gt;</code></pre></div><p>I do manually calculate everything. In my shell I use <strong>ls -l --block-size=65536</strong> to find out what are each block size.</p><p>My fis list output is</p><div class="codebox"><pre><code>DD-WRT&gt; fis list                                                                
Name              FLASH addr  Mem addr    Length      Entry point               
RedBoot           0xBFC00000  0xBFC00000  0x00030000  0x00000000                
linux             0xBFC30000  0x80041000  0x000C0000  0x80050000                
rootfs            0xBFCF0000  0xBFCF0000  0x002F0000  0x80050000                
FIS directory     0xBFFE0000  0xBFFE0000  0x0000F000  0x00000000                
RedBoot config    0xBFFEF000  0xBFFEF000  0x00001000  0x00000000     

DD-WRT&gt; fconfig                                                                 
Run script at boot: true                                                        
Boot script:                                                                    
.. fis load -l -c linux                                                         
.. go 0x80274000                                                                
Enter script, terminate with empty line                                         
&gt;&gt; ^C                                                                           
DD-WRT&gt;</code></pre></div><p>Things to note.</p></blockquote></div><p>Hi!<br/>&nbsp; thanks a lot for this detailed instruction.&nbsp; I have a couple questions about this procedure and regarding how the address are calculated.</p><p>1. bdrestore, will that wipe out everything, ie, will I need to load redboot?&nbsp; I did bdrestore, then loaded the redboot. but from your description, I did not see this being done.&nbsp; should I start over from bdrestore, or just from &quot;fis create&quot; and reload the kernel?</p><p>2. <br/>fis create -b 0x80041000 -l 0xc0000 -f 0xbfc30000 -e 0x80274000 -n linux</p><p>the 0x80041000 comes from the first symbol of the image.<br/>how about 0xc0000? I am not getting how you get this<br/>if I did<br/></p><div class="codebox"><pre><code>ls -l --block-size=65536 openwrt-atheros-vmlinux.lzma</code></pre></div><p>and get 11 blocks<br/></p><div class="codebox"><pre><code>-rw-r--r-- 1 torus torus 11 Jul 18 11:48 openwrt-atheros-vmlinux.lzma</code></pre></div><p>would I use 11*65536 = 6BA896? this seems way off from what you have</p><p>3.<br/>fis write -b 0x80050000 -f 0xbfce0000 -l 0x1a0000<br/>how did you get 0x1a0000? did you get the number after &quot;load&quot; is complete, and took the 2 numbers and subtract?</p><p>4.<br/>how about -n? from the manual, it says <br/></p><div class="codebox"><pre><code>When set, no image data will be written to the flash. Only the FIS directory will be updated.</code></pre></div><p>so should I take it out?</p>											<p class="post-edited">(Last edited by <strong>cycrap</strong> on 22 Jul 2008, 05:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71247">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						22 Jul 2008, 05:47					</div>
				</div>
				<div class="post-content content">
					<p>ok, I think I mess the router up a little bit more.</p><p>when I did &quot;bdrestore&quot;, instead of getting</p><div class="codebox"><pre><code>Board config  found at 0xbfff0000
Radio config  found at 0xbfff00f8
Starting sector program for 0xbffe0000! Please wait!
Starting sector program for 0xbfff0000! Please wait!
Restore completed successfully!!</code></pre></div><p>like before, I get<br/></p><div class="codebox"><pre><code>Board config  found at 0xbff90000
no board config data found!</code></pre></div><p>so does that mean the wireless config. is gone?&nbsp; I do have another same router. is there a way I can retrieve the info. and somehow loaded into this one.</p><p>now when I do the <br/></p><div class="codebox"><pre><code>fis create -b 0x80041000 -l 0xc0000 -f 0xbfc30000 -e 0x8024f000 -n linux
fis create -b 0 -l 0x300000 -f 0xbfce0000 -n rootfs 
load -r -b 0x80050000 /tftproot/openwrt-atheros-vmlinux.lzma
fis write -b 0x80050000 -f 0xbfc30000 -l 0xc0000
load -r -b 0x80050000 /tftproot/openwrt-atheros-root.squashfs
fis write -b 0x80050000 -f 0xbfce0000 -l 0x13ffff</code></pre></div><p>the last &quot;fis write&quot;, I get an error<br/></p><div class="codebox"><pre><code>Can&#039;t program at region 0xbfe00000: unknown error</code></pre></div><p>could this be the problem of my bdrestore not restoring correctly?</p><p>also, I thought &quot;fis create -b 0x80041000 -l 0xc0000 -f 0xbfc30000 -e 0x8024f000 -n linux&quot; would make the linux at memory address 0x80041000.&nbsp; but when I did &quot;fis list&quot; after the above step is done, under memory address, I am getting 0xbfc30000 instead.</p><p>thanks</p>											<p class="post-edited">(Last edited by <strong>cycrap</strong> on 22 Jul 2008, 05:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71263">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						22 Jul 2008, 08:32					</div>
				</div>
				<div class="post-content content">
					<p>Ah so many questions.</p><p>First of all your board configuration is unique for each board, you maybe be able to use the other board configuration at least it will have a valid configuration may not maximize your radio. If you have JTAG you can get your configuration. If you actually did whole compact flash back up you might have the board configuration.</p><p>You have to use something like jtagspi or other jtag tools.</p><p>Now the size question 11 block is 65536 * 11. Mine was with some additional options it was 12 blocks which is 0xC0000. </p><p>11* 65536 should be 11 * 0x10000. </p><p>The file system for JFF format is 26 blocks which is 0x1a0000 in size</p><p>Remember all 0xbfxx0000 are your flash address. Your kernel will be loaded by the init script to 0x800410000 and execution will start from your entry. You store your compreesed image at 0xbf address.</p><p>Good luck</p><p>PS. I never used squash file format. Squash is read only file format and I don&#039;t use it.</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 22 Jul 2008, 08:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71310">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						23 Jul 2008, 00:06					</div>
				</div>
				<div class="post-content content">
					<p>okey, I think I found out what&#039;s going on with this thing<br/>my board info. got wipe out somehow...<br/>on the working router<br/></p><div class="codebox"><pre><code>dump -b 0xbfff0000 -l 0x7f</code></pre></div><p>I get some info about the board, ie, <br/></p><div class="codebox"><pre><code>5311.}..Atheros Ar5315 default.........</code></pre></div><p>and<br/></p><div class="codebox"><pre><code>dump -b 0xbfff00f8 -l 0x100</code></pre></div><p>has some weird text.&nbsp; and I am assuming this is the radio config. since originally radio_config was found here...</p><p>on the bad router, the same content is moved up to 0xbfff0000, which means the board config is gone...</p><p>Is there any way I can write back to this section of memory without JTAG?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71321">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						23 Jul 2008, 02:36					</div>
				</div>
				<div class="post-content content">
					<p>i don&#039;t think red boot allow you to edit the nvram area other than through bdrestore stuff.</p><p>you can try to copy the memory image to flash.. but i dont think that works well. redboot pretty much prevent you from overwriting the configuraiton.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71324">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						23 Jul 2008, 06:30					</div>
				</div>
				<div class="post-content content">
					<p>redboot won&#039;t let me write to nvram area...so any other suggestion? but if redboot won&#039;t let me write to that area, how did this happen in the first place?<br/>also, looking at the dmesg from the working one.&nbsp; <br/>radio_config was found actually on boot up...but madwifi still can&#039;t find the hardware. do you know a little bit about this hal stuff?&nbsp; thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71348">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						23 Jul 2008, 19:35					</div>
				</div>
				<div class="post-content content">
					<p>Do I know about the HAL stuff? Yes and No.</p><p>I know HAL used to fail on mine multiple times in different places until I programmed the last sector with this ROM from somewhere. And it magically fixed my problems. </p><p>If you look at my wiki remarks it does fail at the end of the boot. HAL STATUS 5. </p><p>I do not know any other way but to using JTAG. You maybe able to change the REDBOOT code to flash the last sector. I think Redboot deleted your Radio Config because somehow it knows how to reset but you may to change the source code to rewrite the configuration area if you don&#039;t want to use the JTAG. </p><p>Let me know how the progress is going.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71358">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						23 Jul 2008, 22:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>yoonix wrote:</cite><blockquote><p>I know HAL used to fail on mine multiple times in different places until I programmed the last sector with this ROM from somewhere. And it magically fixed my problems. </p><p>If you look at my wiki remarks it does fail at the end of the boot. HAL STATUS 5. </p><p>I do not know any other way but to using JTAG. You maybe able to change the REDBOOT code to flash the last sector. I think Redboot deleted your Radio Config because somehow it knows how to reset but you may to change the source code to rewrite the configuration area if you don&#039;t want to use the JTAG. </p><p>Let me know how the progress is going.</p></blockquote></div><p>thanks for all the help again.<br/>this ROM, I assume you are talking about&nbsp; ar2317-nvram.bin from your jtagspi package, right?<br/>I went back to read the discuss you had with zinbatsu, somewhere in there, I read someone says that the redboot from dd-wrt does not support ar2318, maybe that&#039;s how my board info got wiped.&nbsp; now the same post direct me to get a redboot_cobra, is that the one you used?</p><p>I can certainly modify redboot to write to the last section (seems to be an easy if check). but which, and where, should I get a reasonable easy to compile and recent redboot?&nbsp; thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71362">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						24 Jul 2008, 00:48					</div>
				</div>
				<div class="post-content content">
					<p>if you want to go down the path of modifying redboot, i have no clue how to do it. Ah i think i know where main is on redboot HAHAHAHA.<br/>does your kernel boot up at least with some file structure maybe informing that the hal is not found at the end?</p><p>you may look through redboot helps or someone here knows where to modify. i looked at a bit of redboot but it&#039;s just horrifying cause redboot is written on top of ecos.</p><p>blah.. i rather modify linux kernel than redboot after looking at the code.. linux kernel or madwifi patches are a lot cleaner than redboot source code imho. </p><p>good luck!</p><p>argh i eat my own word.</p><p>i just searched for redboot</p><p><a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Fon/Fonera#head-b4e0332b277a4538201eeaa8b83780d9e21847a9">http://wiki.openwrt.org/OpenWrtDocs/Har … d9e21847a9</a></p><p>try that link. there are couple of articles you might get about how to mod redboot source code.</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 24 Jul 2008, 01:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71376">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						24 Jul 2008, 07:36					</div>
				</div>
				<div class="post-content content">
					<p>I have several of this unit as I wanted to do WDS.</p><p>all 3 of them, after I installed redboot and openwrt, was working WITHOUT wireless.&nbsp; some where in the dmesg output, it says radio config. found, but HAL has a status 1, which is no hardware found. </p><p>so on one of these units, I did a bdrestore, and I think that&#039;s when the board_config is no longer there. thus, I can&#039;t even boot openwrt on this one, only redboot.&nbsp; that&#039;s why I am thinking about modifying redboot to let me write to the nvram area in redboot to just restore the board_config.</p><p>one quick question.&nbsp; On those unit with openwrt running, but no wireless, is there a way for me to write to the nvram? so I can just take the last sector of your board config. and write it to my machine.&nbsp; thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71409">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						25 Jul 2008, 00:40					</div>
				</div>
				<div class="post-content content">
					<p>a couple quick question<br/>1. how does the redboot knows the mac address of the board?<br/>I know if the board_config is not wiped, it&#039;s at offset 0x60 starting at 0xbfff000<br/>but on the one I had that has the board_config wiped, since I can get into redboot, redboot must contain the MAC address for the board...how did redboot find this?</p><p>thanks</p>											<p class="post-edited">(Last edited by <strong>cycrap</strong> on 25 Jul 2008, 01:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71410">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						25 Jul 2008, 00:48					</div>
				</div>
				<div class="post-content content">
					<p>if you look at the source code the way kernel detects the board configuration is by looking at 5133 or something like that ascii character at the beginning of the block.</p><p>if the kernel doesn&#039;t find that key it assumes there isn&#039;t any board configuration but redboot might detect it differently.</p><p>i don&#039;t have a really good environment for the redboot either. that&#039;s why i wouldn&#039;t go into developing the redboot. i will just build the jtag.. the whole environment and developing on redboot was a mess.</p><p>you might be able to ask more info on separate topic on the forum.. </p><p><a href="http://forum.openwrt.org/viewtopic.php?id=16403">http://forum.openwrt.org/viewtopic.php?id=16403</a> </p><p>flip through this one maybe? (ah i am asking you to cross post but well.)</p><p>good luck.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71413">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						25 Jul 2008, 02:08					</div>
				</div>
				<div class="post-content content">
					<p>Yoonix:</p><p>yeah, kernel is looking for 5311 {hex code 35 33 31 31}, which is at the beginning of 0xbfff0000, but my broken one has this over written by radio_config, which is usually found at 0xbfff00f8, that&#039;s why openwrt is not booting...but redboot can still boot, with ethernet support. what&#039;s what makes me wonder where it gets the MAC info, when 0xbfff0060 is already wiped...</p><p>Hur:</p><p>&nbsp; I am using the later release than 3314, mainly, madwifi-trunk-3776.&nbsp; I am not sure the difference between downloading madwifi directly and have openwrt download madwifi.&nbsp; is it possible for you do do a dump of the last sector of your flash.<br/>ie. if you are in redboot, do</p><p>dump -b 0xbfff0000 -l 0xf8 {this should be the board info}<br/>dump -b 0xbfff00f8 -l 0x200 {should be long enough to cover all the radio config}</p><p>thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71440">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						25 Jul 2008, 19:45					</div>
				</div>
				<div class="post-content content">
					<p>This is as far as I can tell looking at the code. I am sure someone can explain it better. I am not a developer merely a user. <br/>The original madwifi was written for the client side of wifi connection. Typically it will have a single connection and connected to main cpu by PCI.<br/>The openwrt one uses ABS (atheros bus system) and it has support for multiple connections and has the functionality of managing multiple connections.</p><p>That&#039;s what I&#039;ve learned while trying to apply patches to the later version of madwifi which I gave up cause some parts just didn&#039;t make sense.</p><p>cycrep, if your redboot still boots maybe the mac address is in redboot config as well instead of nvram only. i haven&#039;t looked at it but it&#039;s a possibility.</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 25 Jul 2008, 19:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71581">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						30 Jul 2008, 23:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br/>&nbsp; Did some of the reply got deleted?<br/>Hur posted his nvram data here last week...was busy and did not copy it down...now I can&#039;t find it.<br/>or was I dreaming?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71658">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						1 Aug 2008, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>ok, partial success and failure...</p><p>I revert back to the older redboot, using dir300redboot.rom, floating somewhere on dd-wrt for people to revert back to original redboot...</p><p>using that redboot, there is a fwrite command.&nbsp; not knowing what it does, I used it to write ar2317-nvram.bin to 0xbfff0000, with entry address set to 0x0</p><p>this went okey, except I think some of the fis structure is demaged....<br/>so I downloaded the official firmware from airlink, using the emergency http server from the original redboot, to load this firmware.&nbsp; and magically, I was able to go back to the airlink&#039;s firmware.</p><p>now I am back to square one...able to install dd-wrt redboot, and open-wrt... but still no wireless...</p><p>but I am finding something that I am not too sure...<br/>I put a printk to print out some info in the source file in linux kernel</p><p>linux-atheros/linux-2.6.23.17/arch/mips/atheros/board.c</p><p>somehow, in the section that says</p><p>ifdef CONFIG_ATHEROS_AR5315</p><p>I am getting Atheros AR2315, instead of AR2317 or AR2318</p><p>could this be any problem?</p>											<p class="post-edited">(Last edited by <strong>cycrap</strong> on 1 Aug 2008, 23:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71682">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">loswillios</div>
					<div class="post-datetime">
						2 Aug 2008, 13:01					</div>
				</div>
				<div class="post-content content">
					<p>Where is the serial located on these devices? <a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Airlink/ARxxxW">http://wiki.openwrt.org/OpenWrtDocs/Har … ink/ARxxxW</a><br/>Is it the three pins on the bottom right (JP1)? Which is GND, RX, TX?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71733">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">edmian</div>
					<div class="post-datetime">
						4 Aug 2008, 01:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>loswillios wrote:</cite><blockquote><p>Where is the serial located on these devices? <a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Airlink/ARxxxW">http://wiki.openwrt.org/OpenWrtDocs/Har … ink/ARxxxW</a><br/>Is it the three pins on the bottom right (JP1)? Which is GND, RX, TX?</p></blockquote></div><p>In this wiki page you have the pinout needed for the serial console on this board (It is in Spanish, but what you need is understandable)<br/><a href="http://wiki.buenosaireslibre.org/ConsolaSerieDir-300">http://wiki.buenosaireslibre.org/ConsolaSerieDir-300</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72750">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">cycrap</div>
					<div class="post-datetime">
						28 Aug 2008, 18:49					</div>
				</div>
				<div class="post-content content">
					<p>nearly a month after I recover the board information somehow...</p><p>After I recovered the board information, I just put on dd-wrt, and it worked fine..<br/>Yesterday, I decided to give open-wrt another shot, for some reason, the 7.09 installed, and I got my wireless...</p><p>then I turn off the router, turn it back on, and it won&#039;t boot into open-wrt. I can see that the router is trying to boot, (the light first come on, that&#039;s the redboot, then sits for 5 seconds, then all the lights comes on again, that&#039;s when linux is trying to boot)...then it just hung.</p><p>when trying to ping the router, I got </p><p>------------------------------------------------------------------------<br/>From 192.168.1.2 icmp_seq=1 Destination Host Unreachable<br/>------------------------------------------------------------------------</p><p>which I think, just indicates that the machine is not up since my routing take are okey, and I can telnet into the router at redboot fine..</p><p>I tried to install open-wrt again, and same error happens again...</p><p>so I change back to dd-wrt, which went fine <br/>once I boot into dd-wrt, I saw this in dmesg</p><p>---------------------------------------------------------<br/>&lt;5&gt;Creating 8 MTD partitions on &quot;spiflash&quot;:<br/>&lt;5&gt;0x00000000-0x00030000 : &quot;RedBoot&quot;<br/>&lt;5&gt;0x00030000-0x003d0000 : &quot;linux&quot;<br/>&lt;5&gt;0x00100000-0x003b0000 : &quot;rootfs&quot;<br/>&lt;5&gt;0x003b0000-0x003d0000 : &quot;ddwrt&quot;<br/>&lt;5&gt;0x003d0000-0x003e0000 : &quot;nvram&quot;<br/>&lt;5&gt;0x003e0000-0x003f0000 : &quot;FIS Directory&quot;<br/>&lt;5&gt;0x003f0000-0x00400000 : &quot;board_config&quot;<br/>&lt;5&gt;0x00030000-0x003e0000 : &quot;fullflash&quot;<br/>---------------------------------------------------------</p><p>seems like some of those are left over from openwrt, like the rootfs...</p><p>is the nvram part messed up again? how can that happen as I only boot into openwrt once without doing anything....</p><p>oh...and I saw this</p><p>----------------------------------------------------<br/>&lt;0&gt;scanning for root partition<br/>&lt;0&gt;[0x00000000]<br/>&lt;0&gt;[0x00010000]<br/>&lt;0&gt;[0x00020000]<br/>&lt;0&gt;[0x00030000]<br/>&lt;0&gt;[0x00040000]<br/>&lt;0&gt;[0x00050000]<br/>&lt;0&gt;[0x00060000]<br/>&lt;0&gt;[0x00070000]<br/>&lt;0&gt;[0x00080000]<br/>&lt;0&gt;[0x00090000]<br/>&lt;0&gt;[0x000A0000]<br/>&lt;0&gt;[0x000B0000]<br/>&lt;0&gt;[0x000C0000]<br/>&lt;0&gt;[0x000D0000]<br/>&lt;0&gt;[0x000E0000]<br/>&lt;0&gt;[0x000F0000]<br/>&lt;0&gt;[0x00100000]<br/>&lt;0&gt;<br/>&lt;4&gt;found squashfs at 100000<br/>&lt;0&gt;found RedBoot partition at [0xBFC00000]<br/>&lt;0&gt;found linux partition at [0xBFC30000]<br/>---------------------------------------------------------<br/>The squashfs rootfs was when I created and installed the rootfs in redboot...<br/>where does OpenWRT search for rootfs anyway?</p>											<p class="post-edited">(Last edited by <strong>cycrap</strong> on 28 Aug 2008, 19:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72794">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						29 Aug 2008, 23:35					</div>
				</div>
				<div class="post-content content">
					<p>hmm..... sorry you should email me i don&#039;t check forums as often as i used to anymore...<br/>is it possible your ip address is configured to openwrt default?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=15491&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=15491&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>