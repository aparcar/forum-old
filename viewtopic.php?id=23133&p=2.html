<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WAN port as LAN port</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 26 Apr 2018 and 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=23133&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p100340">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">cyrus_mc</div>
					<div class="post-datetime">
						13 Jan 2010, 06:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Void Main wrote:</cite><blockquote><p>Are you trying to say that you are unable to block traffic from your router to devices attached to your router with iptables because you certainly can do that. I am sure I am misunderstanding your statement though.</p></blockquote></div><p>No, I am not saying that. The whole issue started off where the original poster wanted to bridge his WAN and LAN port but is saying that the device connected to the WAN port doesn&#039;t get an IP and thus can&#039;t ping the rest of the hosts on the bridge. Another poster said that you had to enable forwarding between LAN and LAN to which I responded, no that isn&#039;t correct.</p><p>What I said you can&#039;t do is use iptables to control traffic that goes between devices connected to the same switch (ie: eth0). The reason for that is, in the standard setup, the traffic never gets to the firewall. Now, you can probably do some funky stuff where you set your routing table, etc so that traffic has to go through the router/firewall, but in the standard setup that is not the case. You can use ebtables I believe but I don&#039;t have experience with that.</p>											<p class="post-edited">(Last edited by <strong>cyrus_mc</strong> on 13 Jan 2010, 06:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100342">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						13 Jan 2010, 07:07					</div>
				</div>
				<div class="post-content content">
					<p>Oh yes, I did misunderstand. Carry on. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100360">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">pegasus</div>
					<div class="post-datetime">
						13 Jan 2010, 13:23					</div>
				</div>
				<div class="post-content content">
					<p>lan section<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;lan&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;macaddr&#039; &#039;&#039;
    option &#039;ipaddr&#039; &#039;192.168.1.20&#039;
    option &#039;ip6addr&#039; &#039;&#039;
    option &#039;ip6gw&#039; &#039;&#039;
    option &#039;gateway&#039; &#039;192.168.1.1&#039;
    option &#039;dns&#039; &#039; 192.168.1.1&#039;
    option &#039;ifname&#039; &#039;eth0 eth1&#039;</code></pre></div><p>I have disabled dhcp so I dn&#039;t think it will help. I assign the ip manually and then try to ping with no luck if and only if connected to WAN.</p>											<p class="post-edited">(Last edited by <strong>pegasus</strong> on 13 Jan 2010, 13:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100365">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						13 Jan 2010, 16:02					</div>
				</div>
				<div class="post-content content">
					<p>Someone mentioned that the auto-sensing behavior on that wan port may be different than the other ports. I&#039;m not familiar with these devices so I don&#039;t know if that is the case but if it is have you tried using a cross-over cable instead of a straight through (or the opposite depending on what you are using now) and have you tried forcing 10 or 100 full duplex, etc? Or have you verified that you were linked and both the port and the interface you plug into it are auto-negotiating properly?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100372">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">pegasus</div>
					<div class="post-datetime">
						13 Jan 2010, 17:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Void Main wrote:</cite><blockquote><p>Someone mentioned that the auto-sensing behavior on that wan port may be different than the other ports. I&#039;m not familiar with these devices so I don&#039;t know if that is the case but if it is have you tried using a cross-over cable instead of a straight through (or the opposite depending on what you are using now) and have you tried forcing 10 or 100 full duplex, etc? Or have you verified that you were linked and both the port and the interface you plug into it are auto-negotiating properly?</p></blockquote></div><p>Thanks for your reply:<br />- I have tried both cross and patch cable.<br />- No I don&#039;t. How do I force? Sorry but I have no idea on how to do it.<br />- Yes: everithing is properly configured. Infact when I unplug the cable from the WAN port and plug into the lan port, the pinged computer starts responding. Windows shows ethernet connection active in both configurations but only the LAN-port-connected one works.<br />Thank you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100374">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						13 Jan 2010, 17:52					</div>
				</div>
				<div class="post-content content">
					<p>I can&#039;t imagine it would be a duplex/speed negotiation issue so you can probably ignore that part, but I could see where it could have been a crossover vs strait through issue. On a Linux client you would use ethtool to turn off auto-negotiation set the speed/duplex manually, not sure how on other OSs (don&#039;t use them). Of course you would also have to set the duplex/speed manually on the switch side if you do it on the client side.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100378">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">mactalla</div>
					<div class="post-datetime">
						13 Jan 2010, 19:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cyrus_mc wrote:</cite><blockquote><div class="quotebox"><cite>cyrus_mc wrote:</cite><blockquote><div class="quotebox"><cite>mactalla wrote:</cite><blockquote><p>Have you checked your firewall?</p><p>With ethernet + wifi bridged, traffic still went through the firewall and I had to edit /etc/config/firewall and add<br /></p><div class="codebox"><pre><code>config &#039;forwarding&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;dest&#039; &#039;lan&#039;</code></pre></div><p>to communicate between machines.&nbsp; Perhaps you&#039;re hitting something similar with your WAN/LAN ports?</p></blockquote></div><p>I don&#039;t think what you have is required or makes any sense. If it is bridged, it is essentially a single switch and it never gets up to the firewall code.</p></blockquote></div><p>I did some experiments to verify what I said was correct. The way to look at it is like this. The firewall is 192.168.1.1. When you are communicating with devices connected via a switch (or bridge) you don&#039;t address the packet to the firewall IP, it just goes out on the wire with the IP of the destination host. Therefore, it is never picked up by the firewall for processing. Even if by some miracle it was picked up by the firewall it has no way of denying the traffic since it is not involved in the process of sending to the node.</p></blockquote></div><p>I agree it shouldn&#039;t be necessary (based on my rather limited understanding of networking).&nbsp; I got my information from here: <a href="https://forum.openwrt.org/viewtopic.php?pid=75046#p75046">https://forum.openwrt.org/viewtopic.php â€¦ 046#p75046</a></p><p>I don&#039;t know whether OP&#039;s problem is related to this, but I do know that the above solved my Wifi &lt;-&gt; wired communication and his symptoms appear similar.&nbsp; At least it&#039;s something that&#039;s quick and easy to test.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100712">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">metamatt</div>
					<div class="post-datetime">
						17 Jan 2010, 07:44					</div>
				</div>
				<div class="post-content content">
					<p>I got this to work before with whiterussian on an wrt54g -- on whiterussian, vlan0 is the lan and vlan1 is the wan, and I moved port 0 (the &quot;wan&quot; port on the hardware) from its default home of vlan1 over to vlan0, and it worked just fine as a lan port.</p><p>I don&#039;t yet know kamikaze well enough to say how to do the same thing (assuming that what it calls eth0 is the equivalent of the old vlan1 and what it calls eth1 is the equivalent of the old vlan0, what jow said in the first comment would be equivalent; and maybe the routerstation has something different about its hardware layout that matters), but I just wanted to give one data point where this was possible.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100740">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						17 Jan 2010, 16:22					</div>
				</div>
				<div class="post-content content">
					<p>There is definitely no problem using the wan port the same as any other port on any WRT I&#039;ve used, I do that all the time from pre White Russian versions all the way to 8.09.2. However, it looks like the switch still isn&#039;t fully supported on that Routerstation Pro hardware. Take a look at this thread:</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=100222">https://forum.openwrt.org/viewtopic.php?pid=100222</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100755">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">pegasus</div>
					<div class="post-datetime">
						17 Jan 2010, 22:43					</div>
				</div>
				<div class="post-content content">
					<p>I tryed everything you suggested without any luck. It should be due to the lacking rspro switch support. At least I think.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100771">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						18 Jan 2010, 07:24					</div>
				</div>
				<div class="post-content content">
					<p>I begin to suspect something... can you post the output of the following command?<br /></p><div class="codebox"><pre><code>sysctl net.bridge.bridge-nf-call-iptables</code></pre></div><p>~ JoW</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100874">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">pegasus</div>
					<div class="post-datetime">
						19 Jan 2010, 09:48					</div>
				</div>
				<div class="post-content content">
					<p>This is the output: it looks like an error:<br />root@OpenWrtRSP:~# sysctl net.bridge.bridge-nf-call-iptables<br />sysctl: error: &#039;net.bridge.bridge-nf-call-iptables&#039; is an unknown key</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=23133&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>