<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Problem with br-lan and DHCP</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p115823">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">shawnperkins</div>
					<div class="post-datetime">
						24 Aug 2010, 23:50					</div>
				</div>
				<div class="post-content content">
					<p>Hello Folks,</p><p>I am currently running Kamikaze 7.09 on a Asus WL-330gE. The unit contains the BCM-5354 SOC. The device has similar specs to the Asus WL-520gu, the main difference is that the 330gE only has one Ethernet port. I am trying to configure the unit with the following configuration:</p><p>1. Must run in Station mode and obtain an IP from the DHCP server<br />2. I want wl0, and eth0.0 to be part of my bridge, which is br-lan<br />3. When Ethernet is connected, I want the bridge to obtain an IP address from the DHCP server via eth0.0<br />4. When Ethernet is disconnected and wireless is enabled, I want the bridge to obtain an IP address via wl0<br />5. I want eth0.2 to have a static address on the 10.x.x.x network for management only </p><p>This works fine via wireless, but when I disable the wireless and connect to the DHCP server via Ethernet, no IP address is obtained. I am also running dhpcd from my custom-user-startup script as: dhcpcd br-lan &amp;</p><p>Any help would be greatly appreciated, my config files are listed below.</p><p>Thanks,<br />Shawn</p><br /><p>ifconfig</p><p>br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 90:E6:BA:43:67:F7&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.240&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:6 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:5 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1330 (1.2 KiB)&nbsp; TX bytes:868 (868.0 B)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 90:E6:BA:43:67:F7&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:82 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:45 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:17848 (17.4 KiB)&nbsp; TX bytes:6182 (6.0 KiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 </p><p>eth0.0&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 90:E6:BA:43:67:F7&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:6 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:952 (952.0 B)</p><p>eth0.2&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 90:E6:BA:6E:1F:85&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.254.254.200&nbsp; Bcast:10.254.254.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:71 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:44 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:10520 (10.2 KiB)&nbsp; TX bytes:5514 (5.3 KiB)</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:6 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:6 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:344 (344.0 B)&nbsp; TX bytes:344 (344.0 B)</p><p>wl0&nbsp; &nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 90:E6:BA:43:67:F7&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:6 errors:0 dropped:0 overruns:0 frame:76<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:7 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1414 (1.3 KiB)&nbsp; TX bytes:1172 (1.1 KiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:2 Base address:0x5000 </p><br /><p>/etc/config/network</p><p>config &#039;switch&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; option &#039;vlan0&#039; &#039;1 2 3 4 5*&#039;<br />&nbsp; &nbsp; option &#039;vlan1&#039; &#039;0 5&#039;<br />&nbsp; &nbsp; option &#039;vlan2&#039; &#039;0 1 2 3 4 5&#039;<br />&nbsp; &nbsp; <br />config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.0&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;</p><p>config &#039;interface&#039; &#039;management&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macaddr&#039; &#039;90:E6:BA:6E:1F:85&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;10.254.254.200&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;</p><br /><br /><p>/etc/config/network</p><p>config &#039;wifi-device&#039; &#039;wl0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;broadcom&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;maxassoc&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;agmode&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;distance&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;diversity&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;txantenna&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;rxantenna&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wl0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;bssid&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;server&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;port&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;txpower&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;bgscan&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;frag&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;rts&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key2&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key3&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key4&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;80211h&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;compression&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;bursting&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ff&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wmm&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;xr&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ar&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;turbo&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macpolicy&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wep__key&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hidden&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key1&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;isolate&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wds&#039; &#039;0&#039;</p>											<p class="post-edited">(Last edited by <strong>shawnperkins</strong> on 24 Aug 2010, 23:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115969">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						27 Aug 2010, 10:23					</div>
				</div>
				<div class="post-content content">
					<p>Please provide &quot;dmesg&quot; log. Have you changed the lan interface from eth0 to etn0.0?<br />You may want to enable stp in lan interface in case of connecting wire and wifi at the same time.</p><p><a href="https://wiki.openwrt.org/doc/recipes/bridgedclient">Bridged Client - OpenWrt Wiki</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117237">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">shawnperkins</div>
					<div class="post-datetime">
						15 Sep 2010, 22:20					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve changed the lan interface to eth0.0 within the /etc/config/network file, and my dmesg log is below. Also, thanks for the tip on the STP, I&#039;ll give that a try once I get this straightened out.</p><p>Thanks,<br />Shawn</p><br /><br /><p>CPU revision is: 00029029<br />Primary instruction cache 16kB, physically tagged, 4-way, linesize 16 bytes.<br />Primary data cache 16kB, 2-way, linesize 16 bytes.<br />Linux version 2.4.35.4 (shawn@control-1000) (gcc version 3.4.6 (OpenWrt-2.0)) #6 Fri Nov 21 21:36:25 EST 2008<br />Setting the PFC to its default value<br />Determined physical RAM map:<br /> memory: 01000000 @ 00000000 (usable)<br />On node 0 totalpages: 4096<br />zone(0): 4096 pages.<br />zone(1): 0 pages.<br />zone(2): 0 pages.<br />Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,115200<br />CPU: BCM5354 rev 3 at 240 MHz<br />Using 120.000 MHz high precision timer.<br />Calibrating delay loop... 237.56 BogoMIPS<br />Memory: 14284k/16384k available (1405k kernel code, 2100k reserved, 96k data, 84k init, 0k highmem)<br />Dentry cache hash table entries: 2048 (order: 2, 16384 bytes)<br />Inode cache hash table entries: 1024 (order: 1, 8192 bytes)<br />Mount cache hash table entries: 512 (order: 0, 4096 bytes)<br />Buffer cache hash table entries: 1024 (order: 0, 4096 bytes)<br />Page-cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Checking for &#039;wait&#039; instruction...&nbsp; unavailable.<br />POSIX conformance testing by UNIFIX<br />PCI: no core<br />PCI: Fixing up bus 0<br />Linux NET4.0 for Linux 2.4<br />Based upon Swansea University Computer Society NET3.039<br />Initializing RT netlink socket<br />Starting kswapd<br />Registering mini_fo version $Id$<br />devfs: v1.12c (20020818) Richard Gooch (rgooch@atnf.csiro.au)<br />devfs: boot_options: 0x1<br />JFFS2 version 2.1. (C) 2001 Red Hat, Inc., designed by Axis Communications AB.<br />squashfs: version 3.0 (2006/03/15) Phillip Lougher<br />pty: 256 Unix98 ptys configured<br />Serial driver version 5.05c (2001-07-08) with MANY_PORTS SHARE_IRQ SERIAL_PCI enabled<br />ttyS00 at 0xb8000300 (irq = 3) is a 16550A<br />ttyS01 at 0xb8000400 (irq = 3) is a 16550A<br />b44.c:v0.93 (Mar, 2004)<br />PCI: Setting latency timer of device 00:01.0 to 64<br />eth0: Broadcom 47xx 10/100BaseT Ethernet 90:e6:ba:43:67:f7<br />Physically mapped flash: Found an alias at 0x400000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x800000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0xc00000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x1000000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x1400000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x1800000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x1c00000 for the chip at 0x0<br /> Amd/Fujitsu Extended Query Table v1.1 at 0x0040<br />number of CFI chips: 1<br />cfi_cmdset_0002: Disabling fast programming due to code brokenness.<br />Flash device: 0x400000 at 0x1c000000<br />bootloader size: 131072<br />Physically mapped flash: Filesystem type: squashfs, size=0x115f2e<br />Creating 5 MTD partitions on &quot;Physically mapped flash&quot;:<br />0x00000000-0x00020000 : &quot;cfe&quot;<br />0x00020000-0x003f0000 : &quot;linux&quot;<br />0x00099400-0x001b0000 : &quot;rootfs&quot;<br />mtd: partition &quot;rootfs&quot; doesn&#039;t start on an erase block boundary -- force read-only<br />0x003f0000-0x00400000 : &quot;nvram&quot;<br />0x001b0000-0x003f0000 : &quot;rootfs_data&quot;<br />Initializing Cryptographic API<br />NET4: Linux TCP/IP 1.0 for NET4.0<br />IP Protocols: ICMP, UDP, TCP, IGMP<br />IP: routing cache hash table of 512 buckets, 4Kbytes<br />TCP: Hash tables configured (established 1024 bind 2048)<br />NET4: Unix domain sockets 1.0/SMP for Linux NET4.0.<br />NET4: Ethernet Bridge 008 for NET4.0<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Mounted root (squashfs filesystem) readonly.<br />Mounted devfs on /dev<br />Freeing unused kernel memory: 84k freed<br />Algorithmics/MIPS FPU Emulator v1.5<br />diag: Detected &#039;ASUS WL-500g Deluxe&#039;<br />b44: eth0: Link is up at 100 Mbps, full duplex.<br />b44: eth0: Flow control is off for TX and off for RX.<br />roboswitch: Probing device eth0: found!<br />mini_fo: using base directory: /<br />mini_fo: using storage directory: /jffs<br />jffs2.bbc: SIZE compression mode activated.<br />b44: eth0: Link is up at 100 Mbps, full duplex.<br />b44: eth0: Flow control is off for TX and off for RX.<br />eth0.0: add 01:00:5e:00:00:01 mcast address to master interface<br />eth0.2: add 01:00:5e:00:00:01 mcast address to master interface<br />eth0.0: dev_set_promiscuity(master, 1)<br />device eth0 entered promiscuous mode<br />device eth0.0 entered promiscuous mode<br />br-lan: port 1(eth0.0) entering learning state<br />br-lan: port 1(eth0.0) entering forwarding state<br />br-lan: topology change detected, propagating<br />eth0.2: del 01:00:5e:00:00:01 mcast address from vlan interface<br />eth0.2: del 01:00:5e:00:00:01 mcast address from master interface<br />eth0.2: Setting MAC address to&nbsp; 90 e6 ba 6e 1f 85.<br />eth0.2: add 01:00:5e:00:00:01 mcast address to master interface<br />PCI: Setting latency timer of device 00:05.0 to 64<br />PCI/DMA<br />wl0: wlc_attach: chiprev 3 coreunit 0 corerev 13 cccap 0x104007ea maccap 0x30482205 band 2.4G, phy_type 5 phy_rev 0 ana_rev 6<br />wl0: Broadcom BCM4318 802.11 Wireless Controller 4.150.10.5<br />br-lan: port 1(eth0.0) entering disabled state<br />br-lan: port 1(eth0.0) entering learning state<br />br-lan: port 1(eth0.0) entering forwarding state<br />br-lan: topology change detected, propagating<br />device wl0 entered promiscuous mode<br />wl0: attempt to add interface with same source address.<br />br-lan: port 2(wl0) entering learning state<br />br-lan: port 2(wl0) entering forwarding state<br />br-lan: topology change detected, propagating<br />root@Mistake:~#</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117579">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						20 Sep 2010, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>Can you upgrade Kamikaze to 8.09.2?<br /></p><div class="quotebox"><cite>shawnperkins wrote:</cite><blockquote><p>5. I want eth0.2 to have a static address on the 10.x.x.x network for management only</p></blockquote></div><p>There&#039;s no need to create vlan of eth0.2. Use &quot;alias&quot; instead.<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;lan&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;ifname&#039; &#039;eth0.0&#039;
    option &#039;proto&#039; &#039;dhcp&#039;
    option &#039;stp&#039; &#039;1&#039;

config &#039;alias&#039;
    option &#039;interface&#039; &#039;lan&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;10.254.254.200&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;</code></pre></div><p>Have you disabled the DHCP server in WL-330gE? Check /etc/config/dhcp.</p><p><a href="http://wiki.openwrt.org/doc/uci/dhcp">DNS and DHCP configuration - OpenWrt Wiki</a></p><p>Please provide the original &quot;/etc/config/network&quot; by accessing FailSafe Mode. Just run Wireshark or Packetyzer. Power cycle the WL-330gE and watch out for the first UDP packet sent from 192.168.1.1. Immediately press and hold the Reset button for 3-5 seconds. Telnet 192.168.1.1.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117705">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">shawnperkins</div>
					<div class="post-datetime">
						22 Sep 2010, 21:46					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I got it, thanks for pointing me in the right direction. I got rid of the other two VLANS, and made use of the alias configuration and most everything seems good. See my config below. However, when Ethernet and wireless are enabled (two route to the access point) it will send the access point in to a frenzy blasting some kind of data on both interfaces, causing the access point to slow to a crawl. Is there a way to correct this? I thought enabling STP would prevent this, but it doesn&#039;t seem to be working. My current configuration is below.....thanks.</p><br /><p>Current network configuration:</p><p>config &#039;switch&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;vlan0&#039; &#039;0 1 2 3 4 5*&#039;</p><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;stp&#039; &#039;1&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;stp&#039; &#039;1&#039;</p><p>config &#039;alias&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;10.254.254.200&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;</p><br /><p>root@Mistake:~# brctl show<br />bridge name&nbsp; &nbsp; bridge id&nbsp; &nbsp; &nbsp; &nbsp; STP enabled&nbsp; &nbsp; interfaces<br />br-lan&nbsp; &nbsp; &nbsp; &nbsp; 8000.90e6ba6e3015&nbsp; &nbsp; yes&nbsp; &nbsp; &nbsp; &nbsp; eth0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wl0</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117713">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">shawnperkins</div>
					<div class="post-datetime">
						22 Sep 2010, 23:21					</div>
				</div>
				<div class="post-content content">
					<p>Ok, some more info on this new issue. It seems that I&#039;m receiving a message in my dmesg logs that indicates what the problem may be:</p><p>eth0.0: received packet with&nbsp; own address as source address</p><p>This only occurs when both connections are active to the access point. It&#039;s not going to be possible to upgrade to a new version of firmware at the moment, hopefully it&#039;s not a bug in the kernel. </p><p>Below is the current dmesg log:</p><p>CPU revision is: 00029029<br />Primary instruction cache 16kB, physically tagged, 4-way, linesize 16 bytes.<br />Primary data cache 16kB, 2-way, linesize 16 bytes.<br />Linux version 2.4.35.4 (shawn@control-1000) (gcc version 3.4.6 (OpenWrt-2.0)) #6 Fri Nov 21 21:36:25 EST 2008<br />Setting the PFC to its default value<br />Determined physical RAM map:<br /> memory: 01000000 @ 00000000 (usable)<br />On node 0 totalpages: 4096<br />zone(0): 4096 pages.<br />zone(1): 0 pages.<br />zone(2): 0 pages.<br />Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,115200<br />CPU: BCM5354 rev 3 at 240 MHz<br />Using 120.000 MHz high precision timer.<br />Calibrating delay loop... 237.56 BogoMIPS<br />Memory: 14284k/16384k available (1405k kernel code, 2100k reserved, 96k data, 84k init, 0k highmem)<br />Dentry cache hash table entries: 2048 (order: 2, 16384 bytes)<br />Inode cache hash table entries: 1024 (order: 1, 8192 bytes)<br />Mount cache hash table entries: 512 (order: 0, 4096 bytes)<br />Buffer cache hash table entries: 1024 (order: 0, 4096 bytes)<br />Page-cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Checking for &#039;wait&#039; instruction...&nbsp; unavailable.<br />POSIX conformance testing by UNIFIX<br />PCI: no core<br />PCI: Fixing up bus 0<br />Linux NET4.0 for Linux 2.4<br />Based upon Swansea University Computer Society NET3.039<br />Initializing RT netlink socket<br />Starting kswapd<br />Registering mini_fo version $Id$<br />devfs: v1.12c (20020818) Richard Gooch (rgooch@atnf.csiro.au)<br />devfs: boot_options: 0x1<br />JFFS2 version 2.1. (C) 2001 Red Hat, Inc., designed by Axis Communications AB.<br />squashfs: version 3.0 (2006/03/15) Phillip Lougher<br />pty: 256 Unix98 ptys configured<br />Serial driver version 5.05c (2001-07-08) with MANY_PORTS SHARE_IRQ SERIAL_PCI enabled<br />ttyS00 at 0xb8000300 (irq = 3) is a 16550A<br />ttyS01 at 0xb8000400 (irq = 3) is a 16550A<br />b44.c:v0.93 (Mar, 2004)<br />PCI: Setting latency timer of device 00:01.0 to 64<br />eth0: Broadcom 47xx 10/100BaseT Ethernet 90:e6:ba:6e:30:15<br />Physically mapped flash: Found an alias at 0x400000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x800000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0xc00000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x1000000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x1400000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x1800000 for the chip at 0x0<br />Physically mapped flash: Found an alias at 0x1c00000 for the chip at 0x0<br /> Amd/Fujitsu Extended Query Table v1.1 at 0x0040<br />number of CFI chips: 1<br />cfi_cmdset_0002: Disabling fast programming due to code brokenness.<br />Flash device: 0x400000 at 0x1c000000<br />bootloader size: 131072<br />Physically mapped flash: Filesystem type: squashfs, size=0x115f2e<br />Creating 5 MTD partitions on &quot;Physically mapped flash&quot;:<br />0x00000000-0x00020000 : &quot;cfe&quot;<br />0x00020000-0x003f0000 : &quot;linux&quot;<br />0x00099400-0x001b0000 : &quot;rootfs&quot;<br />mtd: partition &quot;rootfs&quot; doesn&#039;t start on an erase block boundary -- force read-only<br />0x003f0000-0x00400000 : &quot;nvram&quot;<br />0x001b0000-0x003f0000 : &quot;rootfs_data&quot;<br />Initializing Cryptographic API<br />NET4: Linux TCP/IP 1.0 for NET4.0<br />IP Protocols: ICMP, UDP, TCP, IGMP<br />IP: routing cache hash table of 512 buckets, 4Kbytes<br />TCP: Hash tables configured (established 1024 bind 2048)<br />NET4: Unix domain sockets 1.0/SMP for Linux NET4.0.<br />NET4: Ethernet Bridge 008 for NET4.0<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Mounted root (squashfs filesystem) readonly.<br />Mounted devfs on /dev<br />Freeing unused kernel memory: 84k freed<br />Algorithmics/MIPS FPU Emulator v1.5<br />diag: Detected &#039;ASUS WL-500g Deluxe&#039;<br />b44: eth0: Link is up at 100 Mbps, full duplex.<br />b44: eth0: Flow control is off for TX and off for RX.<br />roboswitch: Probing device eth0: found!<br />mini_fo: using base directory: /<br />mini_fo: using storage directory: /jffs<br />jffs2.bbc: SIZE compression mode activated.<br />b44: eth0: Link is up at 100 Mbps, full duplex.<br />b44: eth0: Flow control is off for TX and off for RX.<br />eth0.0: add 01:00:5e:00:00:01 mcast address to master interface<br />eth0.0: dev_set_promiscuity(master, 1)<br />device eth0 entered promiscuous mode<br />device eth0.0 entered promiscuous mode<br />br-lan: port 1(eth0.0) entering learning state<br />br-lan: port 1(eth0.0) entering forwarding state<br />br-lan: topology change detected, propagating<br />PCI: Setting latency timer of device 00:05.0 to 64<br />PCI/DMA<br />wl0: wlc_attach: chiprev 3 coreunit 0 corerev 13 cccap 0x104007ea maccap 0x30482205 band 2.4G, phy_type 5 phy_rev 0 ana_rev 6<br />wl0: Broadcom BCM4318 802.11 Wireless Controller 4.150.10.5<br />br-lan: port 1(eth0.0) entering disabled state<br />device wl0 entered promiscuous mode<br />wl0: attempt to add interface with same source address.<br />br-lan: port 2(wl0) entering listening state<br />br-lan: port 1(eth0.0) entering listening state<br />br-lan: port 2(wl0) entering learning state<br />br-lan: port 2(wl0) entering forwarding state<br />br-lan: topology change detected, propagating<br />br-lan: port 1(eth0.0) entering learning state<br />eth0.0: received packet with&nbsp; own address as source address<br />br-lan: port 1(eth0.0) entering forwarding state<br />br-lan: topology change detected, propagating<br />eth0.0: received packet with&nbsp; own address as source address<br />eth0.0: received packet with&nbsp; own address as source address<br />eth0.0: received packet with&nbsp; own address as source address<br />eth0.0: received packet with&nbsp; own address as source address<br />eth0.0: received packet with&nbsp; own address as source address<br />eth0.0: received packet with&nbsp; own address as source address<br />eth0.0: received packet with&nbsp; own address as source address<br />eth0.0: received packet with&nbsp; own address as source address<br />eth0.0: received packet with&nbsp; own address as source address<br />NET: 1276 messages suppressed.<br />eth0.0: received packet with&nbsp; own address as source address</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117721">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						23 Sep 2010, 01:17					</div>
				</div>
				<div class="post-content content">
					<p>Try also enabling stp in AP.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117977">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">shawnperkins</div>
					<div class="post-datetime">
						27 Sep 2010, 19:39					</div>
				</div>
				<div class="post-content content">
					<p>That did it!</p><p>Thanks FYI for all of your help, I appreciate it greatly.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>