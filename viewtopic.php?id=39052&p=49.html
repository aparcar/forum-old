<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 49 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=47.html">47</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=48.html">48</a></li><li class="pagination-current"><span>49</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=50.html">50</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=51.html">51</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p268903">
				<div class="post-metadata">
					<div class="post-num">Post #1201</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						16 Mar 2015, 14:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmarlin wrote:</cite><blockquote><p>Hey Adze, the new marking bits you noted work much better with nodogsplash and qos-scripts. Thanks so much! I&#039;ve added both JohnV&#039;s findings and this latest issue to the wiki now.</p></blockquote></div><p>Nice to hear and thnx for reporting back!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p269285">
				<div class="post-metadata">
					<div class="post-num">Post #1202</div>
					<div class="post-author">fovecifer</div>
					<div class="post-datetime">
						20 Mar 2015, 06:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze! <br />Thank you for your great job!<br />I am using your mwan3 package in my OpenWRT router, and it works very well.</p><p>But I have a problem:<br />In my country, people could not access google or youtube or facebook( many websites ) directly. We need proxy or VPN to access this websites.<br />And I am using dnsmasq + ipset + iptables mark + OpenVPN in the router to let the network packets to google.com through VPN automatically.<br />1. Create ipset named vpn.<br />2. Add google.com into conf file of dnsmasq, so when I resolve this domain name, dnsmasq will add the ip into ipset vpn.<br />3. In iptables, if the target IP is in ipset vpn, then mark with 1<br />4. All packet which mark with 1 goto route table vpn<br />5. Set the route table vpn default rule go through OpenVPN.</p><p>It works very well in my WNDR 4300, but when I install your mwan3 package and configure to 2 wan load balance, it dose not work anymore.</p><p>So, I think there are some conflicts between mwan3 and my settings. And I could not find the conflict...<br />I have to use 2 routers, one UBNT edgerouter lite using your mwan3 and WNDR4300 using my setting.</p><p>Is possible to let mwan3 work with my setting together?</p><p>ps. sorry for my poor english.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p269295">
				<div class="post-metadata">
					<div class="post-num">Post #1203</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Mar 2015, 09:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi fovecifer,</p><div class="quotebox"><cite>fovecifer wrote:</cite><blockquote><p>In my country, people could not access google or youtube or facebook( many websites ) directly. We need proxy or VPN to access this websites.</p></blockquote></div><p>Booo to cencorship! Booo to the fascists in power, that think their moral compass is better then someone else, with their hunger for control!</p><p>What i would do to fix this, is to configure your OpenVPN tunnel also as a wan interface in mwan3. This way you will have three wan interfaces (2x real and 1x vpn). With the help of rules you can steer traffic out the right interface. So in summary:</p><p>1. Create 3 wan interfaces (2x real, 1x vpn)<br />2. Add google.com to ipset vpn into conf file of dnsmasq.<br />3. Create mwan3 rules with ipset vpn to traverse over wan vpn.</p><p>Done.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 20 Mar 2015, 09:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p269299">
				<div class="post-metadata">
					<div class="post-num">Post #1204</div>
					<div class="post-author">fovecifer</div>
					<div class="post-datetime">
						20 Mar 2015, 09:36					</div>
				</div>
				<div class="post-content content">
					<p>Thank you Adze! <br />I think your solution is perfect! I will change my setting when I back home. <br />Thank you again Adze! I am trying to fix this for several days.</p><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Booo to censorship! Booo to the fascists in power, that think their moral compass is better then someone else, with their hunger for control!</p></blockquote></div><p>I can&#039;t agree more!&nbsp; I love google services I hate censorship!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270081">
				<div class="post-metadata">
					<div class="post-num">Post #1205</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						27 Mar 2015, 00:48					</div>
				</div>
				<div class="post-content content">
					<p>Minor thing, and maybe I am missing something.</p><p>When I checkout for-14.07 branch from git the version of mwan is 1.5 r10.</p><p>When i checkout master from git the version of mwan is 1.5 r8.</p><p>Just a heads up to the maintainers as maybe master needs to be updated, or maybe the release difference is not important......</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270082">
				<div class="post-metadata">
					<div class="post-num">Post #1206</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						27 Mar 2015, 01:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>JohnV wrote:</cite><blockquote><p>Minor thing, and maybe I am missing something.</p><p>When I checkout for-14.07 branch from git the version of mwan is 1.5 r10.</p><p>When i checkout master from git the version of mwan is 1.5 r8.</p><p>Just a heads up to the maintainers as maybe master needs to be updated, or maybe the release difference is not important......</p></blockquote></div><p>It&#039;s more like we are just forgetting to update the other repository since it&#039;s not really as relevant as the OpenWrt Packages feed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270084">
				<div class="post-metadata">
					<div class="post-num">Post #1207</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						27 Mar 2015, 01:16					</div>
				</div>
				<div class="post-content content">
					<p>In the &quot;packages&quot; git repo:</p><p>I assumed the &quot;for-14.07&quot; is the feed (source) for BB.&nbsp; Or at least this is what one should use when building a custom BB image.</p><p>And &quot;master&quot; is the feed (source) for CC.&nbsp; I assumed that master should be used when building a custom CC image.</p><p>I build all my own images, so I don&#039;t really know how the pre-built stuff lines up, but (perhaps naively) assumed there would be packages of mwan3, one for BB and one for CC (and probably one for AA).</p><p>Am I wrong? A bit off-topic and I apologize.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270085">
				<div class="post-metadata">
					<div class="post-num">Post #1208</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						27 Mar 2015, 01:19					</div>
				</div>
				<div class="post-content content">
					<p>I just realized what you&#039;re talking about. The version in master is for trunk and supports features only available in trunk (for now.)</p><p>Master is 1.6-1<br />for-14.07 is 1.5-10</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 27 Mar 2015, 01:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270086">
				<div class="post-metadata">
					<div class="post-num">Post #1209</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						27 Mar 2015, 01:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>I just realized what you&#039;re talking about. The version in master is for trunk and supports features only available in trunk (for now.)</p><p>Master is 1.6-1<br />for-14.07 is 1.5-10</p></blockquote></div><p>You are correct, my mistake in my working copy form git.&nbsp; I apologize for wasting your time....</p><p>Still learning git.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270118">
				<div class="post-metadata">
					<div class="post-num">Post #1210</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						27 Mar 2015, 11:50					</div>
				</div>
				<div class="post-content content">
					<p>Hello. Thank for mwan3.</p><p>Right now we have working Linux-server (external IPs 1.1.1.1 and 2.2.2.2) with OpenVPN server and remote office with TP-Link MR-3420 with OpenWRT, mwan3, 3Gmodem (dynamic external IP), USBFlash, USBhub, wan-Internet-provider (external IP 9.9.9.1 gw 9.9.9.9 )</p><p>OpenVPN server ccd for MR-3420 client:<br />iroute 192.168.70.0 255.255.255.0<br />push &quot;redirect-gateway def1&quot;</p><p>OpenVPN client on MR-3420:<br />remote 1.1.1.1 1194<br />remote 2.2.2.2 1194<br />persist-key<br />;persist-tun</p><p>OpenVPN is the default route on MR-3420:<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.8.0.5&nbsp; &nbsp; &nbsp; &nbsp; 128.0.0.0&nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9.9.9.9&nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 pppoe-wan<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3g-wan2<br />10.8.0.0&nbsp; &nbsp; &nbsp; &nbsp; 10.8.0.5&nbsp; &nbsp; &nbsp; &nbsp; 255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />10.8.0.5&nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3g-wan2<br />9.9.9.9&nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 pppoe-wan<br />1.1.1.1&nbsp; &nbsp; 9.9.9.9&nbsp; 255.255.255.255 UGH&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 pppoe-wan<br />128.0.0.0&nbsp; &nbsp; &nbsp; &nbsp;10.8.0.5&nbsp; &nbsp; &nbsp; &nbsp; 128.0.0.0&nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />192.168.29.0&nbsp; &nbsp; &nbsp;10.8.0.5&nbsp; &nbsp; &nbsp; &nbsp; 255.255.0.0&nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />192.168.70.0&nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p><p>Can this work correct with mwan3 failover (wan 9.9.9.1 + wan2 3G)?<br />Will mwan3 tracking work with default gw set to OpenVPN?<br />How we can acces router (over 9.9.9.1) when default gw is OpenVPN (add ip rule add from 9.9.9.1 lookup 1)?<br />Can be tracking IPs the same for wan and wan2 for mwan3?</p><p>What else you can recomend to do with this configuration?</p><p>Thank you.</p>											<p class="post-edited">(Last edited by <strong>altuhovd</strong> on 27 Mar 2015, 11:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270120">
				<div class="post-metadata">
					<div class="post-num">Post #1211</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 Mar 2015, 11:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi altuhovd,</p><br /><p>mwan3 is compatible with openvpn tunnels, but you have to use 0.0.0.0/0 routes only. In your current output tun0 has no default route. There is more info on this in this thread.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270121">
				<div class="post-metadata">
					<div class="post-num">Post #1212</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						27 Mar 2015, 11:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi altuhovd,<br />mwan3 is compatible with openvpn tunnels, but you have to use 0.0.0.0/0 routes only. In your current output tun0 has no default route. There is more info on this in this thread.</p></blockquote></div><p>Thank you, I will read.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270132">
				<div class="post-metadata">
					<div class="post-num">Post #1213</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						27 Mar 2015, 14:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi altuhovd,</p><br /><p>mwan3 is compatible with openvpn tunnels, but you have to use 0.0.0.0/0 routes only. In your current output tun0 has no default route. There is more info on this in this thread.</p></blockquote></div><p>I found one problem:</p><p>1) I have wan = (wired) internet-provider with static IP 9.9.9.9 (gw 9.9.9.1) and wan2 = 3G-usb-modem with PPP<br />2) When wan is down (tracking down, not pinging) and wan2 is active I see this:<br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9.9.9.9&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3g-wan2<br />10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3g-wan2<br />9.9.9.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />192.168.70.0&nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />3) All trafic is going to gw 10.64.64.64 (3G modem). Internet working</p><p>4) But when I do /etc/init.d/openvpn start and starting OpenVPN&nbsp; tunnel with redirect-gateway def1 I see this:<br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.8.0.117&nbsp; &nbsp; &nbsp; 128.0.0.0&nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9.9.9.1&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3g-wan2<br />10.8.0.0&nbsp; &nbsp; &nbsp; &nbsp; 10.8.0.117&nbsp; &nbsp; &nbsp; 255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />10.8.0.117&nbsp; &nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3g-wan2<br />9.9.9.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />1.1.1.1&nbsp; &nbsp; 9.9.9.1&nbsp; &nbsp; &nbsp;255.255.255.255 UGH&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />128.0.0.0&nbsp; &nbsp; &nbsp; &nbsp;10.8.0.117&nbsp; &nbsp; &nbsp; 128.0.0.0&nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />192.168.0.0&nbsp; &nbsp; &nbsp;10.8.0.117&nbsp; &nbsp; &nbsp; 255.255.0.0&nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />192.168.70.0&nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p><p>After OpenVPN is started and connected to OpenVPN server (1.1.1.1) it change default gateway and add route to OpenVPN-server via prevous default gw, from OpenVPN man:<br />(1) Create a static route for the --remote address which forwards to the pre-existing default gateway. This is done so that (3) will not create a routing loop.</p><p>(2) Delete the default gateway route.</p><p>(3) Set the new default gateway to be the VPN endpoint address</p><p>What can I do when wan (gw 9.9.9.1) is not working and OpenVPN select this as prevous default gw?<br />Why OpenVPN-client may not select default route with metric 2 (currently active)?</p><p>Can mwan3 delete all default gateways (with metrics 1,2,3,...) and specify only one default gateway (with metric 0)?<br />Why we need many default gateways (with different metrics) instead of one default gw with metric 0? For pinging from wan and wan2 we can use ip rule add ... lookup ?</p>											<p class="post-edited">(Last edited by <strong>altuhovd</strong> on 27 Mar 2015, 14:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270133">
				<div class="post-metadata">
					<div class="post-num">Post #1214</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 Mar 2015, 14:21					</div>
				</div>
				<div class="post-content content">
					<p>Hi altuhovd,</p><br /><p>These openvpn routes result in that all traffic traverses tun0.</p><div class="codebox"><pre><code>0.0.0.0         10.8.0.117      128.0.0.0       UG    0      0        0 tun0
128.0.0.0       10.8.0.117      128.0.0.0       UG    0      0        0 tun0</code></pre></div><p>Do not use &quot;redirect-gateway def1&quot;, as it creates above routes.</p><p>Can you describe what you want to achieve? Maybe i can help you with that.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 27 Mar 2015, 14:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270138">
				<div class="post-metadata">
					<div class="post-num">Post #1215</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						27 Mar 2015, 14:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi altuhovd,</p><p>These openvpn routes result in that all traffic traverses tun0.</p><div class="codebox"><pre><code>0.0.0.0         10.8.0.117      128.0.0.0       UG    0      0        0 tun0
128.0.0.0       10.8.0.117      128.0.0.0       UG    0      0        0 tun0</code></pre></div><p>Do not use &quot;redirect-gateway def1&quot;, as it creates above routes.</p><p>Can you describe what you want to achieve? Maybe i can help you with that.</p></blockquote></div><p>I want two internet channes (wan=static IP + wan2=3G-modem) + OpenVPN client + route all traffic to OpenVPN server + mwan3 (failover internet-channels) on TP-Link MR-3420.</p><p>Ok. I can temporary disable redirect-gateway def1.<br />Now testing without it.<br />Switch to backup channel working fine (openvpn reconnects), but switching back to primary not working for established connections (like openvpn).<br />After primary channel is up, openvpn is still going to backup channel. And all established connection (lice icq, https) too.</p>											<p class="post-edited">(Last edited by <strong>altuhovd</strong> on 27 Mar 2015, 15:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270141">
				<div class="post-metadata">
					<div class="post-num">Post #1216</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 Mar 2015, 15:20					</div>
				</div>
				<div class="post-content content">
					<p>What i would do is setup mwan3 with 3 wan interfaces (2x real + 1x openvpn). Setup a rule for upd 1194 to use the real wans. Add a second rule that routes all traffic over OpenVPN tunnel. Done.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270174">
				<div class="post-metadata">
					<div class="post-num">Post #1217</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						27 Mar 2015, 19:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>What i would do is setup mwan3 with 3 wan interfaces (2x real + 1x openvpn). Setup a rule for upd 1194 to use the real wans. Add a second rule that routes all traffic over OpenVPN tunnel. Done.</p></blockquote></div><p>Thank you Adze. You helped so many peoples.</p><p>As I did not find such a simple solution, sorry. I will try it.</p><p>But why after switching from backup to primary channel some traffic (established) still going over backup channel (monitored by tcpdump)?<br />What manual should I read?</p>											<p class="post-edited">(Last edited by <strong>altuhovd</strong> on 27 Mar 2015, 19:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270175">
				<div class="post-metadata">
					<div class="post-num">Post #1218</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 Mar 2015, 19:31					</div>
				</div>
				<div class="post-content content">
					<p>When a primary link comes back, all already established sessions will continue to traverse the backup wan. Only new sessions will route over the primary wan. This works as designed, but maybe not what you want..</p><p>You can however create a custom script which kills all active sessions on the backup link if the primary comes back to life. Create a script in /etc/hotplug.d/iface. Name it something like 16-mwan3-kill-sessions. With conntrack tools you can terminate all udp 1194 sessions.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 27 Mar 2015, 19:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270184">
				<div class="post-metadata">
					<div class="post-num">Post #1219</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						27 Mar 2015, 20:08					</div>
				</div>
				<div class="post-content content">
					<p>First i need to work with OpenVPN and mwan3 is default route for tun0 (OpenVPN tunnel)</p><p>I fixed ccd-config on OpenVPN server:<br />#push &quot;redirect-gateway def1&quot;<br />push &quot;route 0.0.0.0 0.0.0.0 vpn_gateway 3&quot;</p><p>Now route table on router:<br /></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         9.9.9.1        0.0.0.0         UG    1      0        0 pppoe-wan
0.0.0.0         10.64.64.64     0.0.0.0         UG    2      0        0 3g-wan2
0.0.0.0         10.8.0.5        0.0.0.0         UG    3      0        0 tun0
10.8.0.0        10.8.0.5        255.255.255.0   UG    0      0        0 tun0
10.8.0.5        0.0.0.0         255.255.255.255 UH    0      0        0 tun0
10.64.64.64     0.0.0.0         255.255.255.255 UH    0      0        0 3g-wan2
9.9.9.1        0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan
192.168.0.0     10.8.0.5        255.255.0.0     UG    0      0        0 tun0
192.168.66.0    0.0.0.0         255.255.255.0   U     0      0        0 br-lan</code></pre></div><p>But will it work? Right now I see, that ovpn interface (OpenVPN tunnel) is up and tracking active, but in mwan3 LuCI configuration:<br />MWAN Interface Configuration - ovpn<br />WARNING: this interface has no metric configured in /etc/config/network!</p><p>Do I need specify metric for ovpn interface in /etc/config/network? Current protocol is &quot;none&quot; for ovpn.</p>											<p class="post-edited">(Last edited by <strong>altuhovd</strong> on 27 Mar 2015, 21:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270188">
				<div class="post-metadata">
					<div class="post-num">Post #1220</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 Mar 2015, 20:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi altuhovd,</p><br /><p>Your routing table looks ok to me! The warning will go away when you configure the openvpn (tun0) interface in /etc/config/network.</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;openvpn&#039;
        option &#039;proto&#039; &#039;none&#039;
        option &#039;ifname&#039; &#039;tun0&#039;
        option &#039;metric&#039; &#039;3&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270189">
				<div class="post-metadata">
					<div class="post-num">Post #1221</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						27 Mar 2015, 21:07					</div>
				</div>
				<div class="post-content content">
					<p>Fixed. Current mwan3 status (except know networks):<br /></p><div class="codebox"><pre><code>Interface status:
Interface wan is online (tracking active)
Interface wan2 is online (tracking active)
Interface ovpn is online (tracking active)

Policy balanced:
 wan2 (40%)
 wan (60%)

Policy wan2_only:
 wan2 (100%)

Policy wan2_wan:
 wan2 (100%)

Policy wan_only:
 wan (100%)

Policy wan_wan2:
 wan (100%)

Active rules:
source             destination        proto  src-port      dest-port     policy          hits     
--------------------------------------------------------------------------------------------------
0.0.0.0/0          0.0.0.0/0          udp    0:65535       1194          wan_wan2        0        
0.0.0.0/0          0.0.0.0/0          all                                wan_wan2        14</code></pre></div><p>&quot;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp&nbsp; &nbsp; 0:65535&nbsp; &nbsp; &nbsp; &nbsp;1194&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan_wan2&nbsp; &nbsp; &nbsp; &nbsp; 0&quot; = zero (0) hits on OpenVPN tunnel it because it&#039;s already established, i&#039;m think. Will try to restart. If hits will grow, then I will fix 0.0.0.0/0 rule (ovpn-&gt;wan-wan2 failover)</p><p>(sorry for bad English)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270304">
				<div class="post-metadata">
					<div class="post-num">Post #1222</div>
					<div class="post-author">walkingman</div>
					<div class="post-datetime">
						28 Mar 2015, 18:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze<br />I don&#039;t want to be pushy, but have had a chance to look at the quota option yet..<br />Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270478">
				<div class="post-metadata">
					<div class="post-num">Post #1223</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						30 Mar 2015, 10:37					</div>
				</div>
				<div class="post-content content">
					<p>Testing mwan3 over OpenVPN-&gt;WAN-&gt;WAN2</p><p>1) Right now all working fine from LAN at router (192.168.70.0/24).<br />Can ping any host.</p><p>2) But not working at router itself (can not ping any host, nslookup not working).<br />from router I can not ping 8.8.8.8, but can ping IPs in OpenVPN (LAN at office).</p><p>3) Should interface metrics at &quot;MWAN Interface Configuration&quot; page be the same as at &quot;MWAN Member Configuration&quot; page?<br />At the &quot;MWAN Interface Configuration&quot; page metrics is:<br />wan = 1<br />wan2 = 2<br />ovpn =3 </p><p>At &quot;MWAN Member Configuration&quot; page metrics:<br />wan = 10<br />wan2 = 20<br />ovpn = 9</p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         9.9.9.1     0.0.0.0         UG    1      0        0 eth0
0.0.0.0         10.64.64.64     0.0.0.0         UG    2      0        0 3g-wan2
0.0.0.0         10.8.0.117      0.0.0.0         UG    3      0        0 tun0
10.8.0.0        10.8.0.117      255.255.255.0   UG    0      0        0 tun0
10.8.0.117      0.0.0.0         255.255.255.255 UH    0      0        0 tun0
10.64.64.64     0.0.0.0         255.255.255.255 UH    0      0        0 3g-wan2
9.9.9.0     0.0.0.0         255.255.255.0   U     1      0        0 eth0
192.168.0.0     10.8.0.117      255.255.0.0     UG    0      0        0 tun0
192.168.70.0    0.0.0.0         255.255.255.0   U     0      0        0 br-lan

0:      from all lookup local
1001:   from all iif eth0 lookup main
1002:   from all iif 3g-wan2 lookup main
1003:   from all iif tun0 lookup main
2001:   from all fwmark 0x100/0xff00 lookup 1
2002:   from all fwmark 0x200/0xff00 lookup 2
2003:   from all fwmark 0x300/0xff00 lookup 3
2253:   from all fwmark 0xfd00/0xff00 blackhole
2254:   from all fwmark 0xfe00/0xff00 unreachable
32766:  from all lookup main
32767:  from all lookup default

Interface status:
Interface wan is online (tracking active)
Interface wan2 is online (tracking active)
Interface ovpn is online (tracking active)

Policy balanced:
 wan2 (40%)
 wan (60%)

Policy ovpn_wan2_wan:
 ovpn (100%)

Policy wan2_only:
 wan2 (100%)

Policy wan2_wan:
 wan2 (100%)

Policy wan_only:
 wan (100%)

Policy wan_wan2:
 wan (100%)

Active rules:
source             destination        proto  src-port      dest-port     policy          hits
--------------------------------------------------------------------------------------------------
0.0.0.0/0          0.0.0.0/0          udp    0:65535       1197          wan_wan2        0
0.0.0.0/0          0.0.0.0/0          all                                ovpn_wan2_wan   1139</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270480">
				<div class="post-metadata">
					<div class="post-num">Post #1224</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						30 Mar 2015, 11:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>altuhovd wrote:</cite><blockquote><p>2) But not working at router itself (can not ping any host, nslookup not working).<br />from router I can not ping 8.8.8.8, but can ping IPs in OpenVPN (LAN at office).</p></blockquote></div><p>Probably because replies are not routed back over openvpn tunnel <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. If you ping from router, your router will create an ip packet based on main routing table. So if you ping 8.8.8.8, it will create an icmp packet with source 9.9.9.9 (ip address on interface eth0) and destination 8.8.8.8, which will be routed over OpenVPN tunnel. Please try &quot;ping -I tun0 8.8.8.8&quot; to confirm.</p><div class="quotebox"><cite>altuhovd wrote:</cite><blockquote><p>3) Should interface metrics at &quot;MWAN Interface Configuration&quot; page be the same as at &quot;MWAN Member Configuration&quot; page?<br />At the &quot;MWAN Interface Configuration&quot; page metrics is:<br />wan = 1<br />wan2 = 2<br />ovpn =3 </p><p>At &quot;MWAN Member Configuration&quot; page metrics:<br />wan = 10<br />wan2 = 20<br />ovpn = 9</p></blockquote></div><p>Whut ?? mwan3 interfaces configuration has no metric config options ?? If you mean general network config, then no, they serve a different purpose and don&#039;t have to be the same.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 30 Mar 2015, 11:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270491">
				<div class="post-metadata">
					<div class="post-num">Post #1225</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						30 Mar 2015, 13:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>What i would do is setup mwan3 with 3 wan interfaces (2x real + 1x openvpn). Setup a rule for upd 1194 to use the real wans. Add a second rule that routes all traffic over OpenVPN tunnel. Done.</p></blockquote></div><p>I&#039;d like to replicate altuhovd&#039;s setup, but it doesn&#039;t seem to work for me. Here are excerpts from my config files:</p><p>/etc/config/network<br /></p><div class="codebox"><pre><code>config interface &#039;vpn1&#039;
        option ifname &#039;tun1&#039;
        option proto &#039;none&#039;
        option metric &#039;110&#039;</code></pre></div><p>/etc/config/mwan3<br /></p><div class="codebox"><pre><code>config interface &#039;vpn1&#039;
        option enabled &#039;1&#039;
#       list track_ip &#039;10.99.99.1&#039;
        option reliability &#039;1&#039;
        option count &#039;1&#039;
        option timeout &#039;4&#039;
        option interval &#039;5&#039;
        option down &#039;3&#039;
        option up &#039;8&#039;

config member &#039;vpn1_m1_w2&#039;
        option interface &#039;vpn1&#039;
        option metric &#039;1&#039;
        option weight &#039;2&#039;

config policy &#039;vpn1_only&#039;
        list use_member &#039;vpn1_m1_w2&#039;

config rule &#039;vpn_endpoint1&#039;
        option dest_ip &#039;remote_ovpn_server_ip&#039;
        option dest_port &#039;1194&#039;
        option proto &#039;udp&#039;
        option use_policy &#039;wan2_wan&#039;

config rule &#039;vpn_pbr1&#039;
        option dest_ip &#039;172.21.22.0/255.255.255.0&#039;
        option use_policy &#039;vpn1_only&#039;

config rule &#039;vpn_pbr2&#039;
        option dest_ip &#039;192.168.101.0/255.255.255.0&#039;
        option use_policy &#039;vpn1_only&#039;</code></pre></div><p>I used openvpn&#039;s route-nopull to ignored any routes pushed by the OpenVPN server and manually added policy-based routing (vpn_pbrX) rules.</p><p>However, mwan3 complains that vpn1/tun1 doesn&#039;t have a default route. I tried a separate &quot;config route ...&quot; in /etc/config/network, but it didn&#039;t seem to work either. Any suggestions ?</p><p>PS: One use scenario would be to send all traffic of an internal LAN IP via the VPN tunnel, to overcome geo-ip limitations (e.g. watch BBC news videos by tunneling all traffic via a UK-based VPN server)</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 49 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=47.html">47</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=48.html">48</a></li><li class="pagination-current"><span>49</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=50.html">50</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=51.html">51</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>