<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> DHCP Relay Agent</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p294942">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">tuxmartin</div>
					<div class="post-datetime">
						6 Oct 2015, 14:43					</div>
				</div>
				<div class="post-content content">
					<p>I have Ubuntu server connected to internet. On Ubuntu server is ISC-DHCP server.<br />Next two OpenWrt routers are connected to central ubuntu server.<br />I need to use central DHCP server for all LANs (DHCP Relay Agent).<br />my network topology: <span class="postimg"><img src="https://dl.dropboxusercontent.com/u/6943408/OpenWrt%20dhcp%20relay.png" alt="https://dl.dropboxusercontent.com/u/6943408/OpenWrt%20dhcp%20relay.png" /></span></p><p>How can I do it on OpenWrt?<br />I found <a href="https://forum.openwrt.org/viewtopic.php?id=44690">howto in forum</a>, but in OpenWrt 15.05 package &quot;dhcrelay&quot; doesn&#039;t exist.<br />OpenWrt 14.07 has package &quot;isc-dhcp-relay-ipv4_4.2.4&quot; but in &quot;oldpackage&quot; section : <a href="https://downloads.openwrt.org/barrier_breaker/14.07/x86/generic/packages/oldpackages/isc-dhcp-relay-ipv4_4.2.4-3_x86.ipk">https://downloads.openwrt.org/barrier_b … -3_x86.ipk</a></p><p>I found &quot;--dhcp-relay&quot; option in dnsmasq man page:<br /></p><div class="codebox"><pre><code>--dhcp-relay=&lt;local address&gt;,&lt;server address&gt;[,&lt;interface]
Configure dnsmasq to do DHCP relay. The local address is an address allocated to an interface on the host running dnsmasq. All DHCP requests arriving on that interface will we relayed to a remote DHCP server at the server address. It is possible to relay from a single local address to multiple remote servers by using multiple dhcp-relay configs with the same local address and different server addresses. A server address must be an IP literal address, not a domain name. In the case of DHCPv6, the server address may be the ALL_SERVERS multicast address, ff05::1:3. In this case the interface must be given, not be wildcard, and is used to direct the multicast to the correct interface to reach the DHCP server.
Access control for DHCP clients has the same rules as for the DHCP server, see --interface, --except-interface, etc. The optional interface name in the dhcp-relay config has a different function: it controls on which interface DHCP replies from the server will be accepted. This is intended for configurations which have three interfaces: one being relayed from, a second connecting the DHCP server, and a third untrusted network, typically the wider internet. It avoids the possibility of spoof replies arriving via this third interface.

It is allowed to have dnsmasq act as a DHCP server on one set of interfaces and relay from a disjoint set of interfaces. Note that whilst it is quite possible to write configurations which appear to act as a server and a relay on the same interface, this is not supported: the relay function will take precedence.

Both DHCPv4 and DHCPv6 relay is supported. It&#039;s not possible to relay DHCPv4 to a DHCPv6 server or vice-versa.</code></pre></div><p>How can I use it? Clean /etc/config dhcp and add &quot;--dhcp-relay&quot; to /etc/dnsmasq.conf?</p><p>-------------------------------------------<br />UPDATE:<br />* dnsmasq ---- do not work</p><p>* isc dhcp relay - package is not present in new openwrt 15.05 and in 14.07 is on oldpackeage section. Relay agent forward client request to dhcp server (i see it in log), but not forward reply to client - <a href="https://forum.openwrt.org/viewtopic.php?pid=229170#p229170">https://forum.openwrt.org/viewtopic.php … 70#p229170</a> and <a href="https://lists.isc.org/pipermail/dhcp-users/2014-April/017829.html">https://lists.isc.org/pipermail/dhcp-us … 17829.html</a> ---- do not work</p>											<p class="post-edited">(Last edited by <strong>tuxmartin</strong> on 9 Oct 2015, 00:04)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>