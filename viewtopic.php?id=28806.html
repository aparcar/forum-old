<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to truly boot from a USB flash drive?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p129423">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jtara</div>
					<div class="post-datetime">
						25 Feb 2011, 04:09					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve done a lot of searching for an answer to what ought to be an easily-answered question: is there a way to truly boot from a USB flash drive?</p><p>I&#039;ve read a lot of detailed tutorials on how to use an external USB drive as the root filesystem, but all seem to leave me uncertain where the kernel is being booted from.</p><p>What I would like to be able to do is to make a backup copy of the flash drive (say, by copying it to another flash drive using my computer.) If the system becomes corrupted somehow (I seem to have temporarily bricked my router several times during initial setup, though that hasn&#039;t happened recently) I can just plug in the backup. As well, I am apprehensive about updating. I&#039;m on 10.03.1RC4 because of some features needed to support my specific router, and I&#039;m going to want to update to the next official release. I dread the thought. It would be much better if I could make a backup, then update the backup using opkg. Ditto for installing new packages. I&#039;m reluctant to do so because I have done so in the past resulting in the router becoming unusable until it was re-flashed.</p><p>I&#039;m OK with a 2-step boot process: boot into OpenWrt from the internal flash. Mount the external drive. Re-boot from the external drive. I&#039;d want it to load the kernel present on the external USB drive upon the second boot. I wouldn&#039;t anticipate that there would be much opportunity, then, for the internal flash to become corrupted or unusable, since it would only be used for the first boot. Nor would I anticipate a need to update the kernel on the internal flash: if it can boot from the USB drive, it can boot from the USB drive, and that&#039;s all I require it to do. Can&#039;t see much reason to ever update it. Essentially, I would be using OpenWrt as a bootloader, since the router&#039;s bootloader doesn&#039;t support this, and we don&#039;t have Grub, LILO, etc.</p><p>Is this possible? Can somebody point me to a tutorial and/or a backgrounder on this?</p><p>If it matters, my router is a D-link DIR-825.</p><p>Thanks.</p>											<p class="post-edited">(Last edited by <strong>jtara</strong> on 25 Feb 2011, 04:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129458">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						25 Feb 2011, 16:25					</div>
				</div>
				<div class="post-content content">
					<p>take a look at kexec-tools:</p><p>CONFIG_PACKAGE_kexec-tools: <br />kexec is a set of systems call that allows you to load&nbsp; <br />another kernel from the currently executing Linux kernel.&nbsp; &nbsp; &nbsp; <br /><a href="http://kernel.org/pub/linux/kernel/people/horms/kexec-tools/">http://kernel.org/pub/linux/kernel/peop â€¦ xec-tools/</a>&nbsp; </p><p>with this packages it should be possible. </p><p>You build an openwrt for the flash which has usb-support, fs-support (ext4 for your usbstick-rootfs) and the kexec-tools installed, which will work as &quot;second bootloader&quot;. If this works, there is no need to update this system/kernel again. </p><p>and than you build your actual openwrt-system for the usbdrive. <br />I remember that there were some issuse with accessing the rootfs on some plattforms (broadcom?), but you should check the forum for this.<br />In the buildroot you can select creating a ext4-rootfs.&nbsp; (Target Images). I&#039;m not sure if the kernel will be included, or if you have to add it yourself. </p><p>But I think kexec is the way to go. In this forum I read a post of a guy who tries to get usb-support in uboot, but kexec seems more promising.</p>											<p class="post-edited">(Last edited by <strong>eleon216</strong> on 25 Feb 2011, 16:27)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>