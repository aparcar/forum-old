<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT in Metarouter (RB4xx of Mikrotik) - problem with passwd</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p89709">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nik247</div>
					<div class="post-datetime">
						11 Jun 2009, 16:08					</div>
				</div>
				<div class="post-content content">
					<p>Same days ago Mikrotik annonced support OpenWRT in Metarouter (virtualizaion on routeboards RB4XX on mips platform)<br />and public how-to on own wiki: <a href="http://wiki.mikrotik.com/wiki/Metarouter#OpenWRT_as_virtual_machine">http://wiki.mikrotik.com/wiki/Metaroute … al_machine</a><br />You can download ready image and patch for rebuild from trunk.</p><p><strong>I tried original image from MT (<a href="http://www.mikrotik.com/download/openwrt-metarouter-rootfs.tgz">http://www.mikrotik.com/download/openwr … rootfs.tgz</a>) on RB450G (512M flash and 256M RAM) and have one problem -&nbsp; passwd don&#039;t work.</strong></p><p>BusyBox v1.11.3 (2009-05-22 14:09:05 EEST) built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>_______ ________ __<br />| |.-----.-----.-----.| | | |.----.| |_<br />| - || _ | -__| || | | || _|| _|<br />|_______|| __|_____|__|__||________||__| |____|<br />|__| W I R E L E S S F R E E D O M<br />KAMIKAZE (bleeding edge, r15956) -------------------<br />* 10 oz Vodka Shake well with ice and strain<br />* 10 oz Triple sec mixture into 10 shot glasses.<br />* 10 oz lime juice Salute!<br />---------------------------------------------------<br />root@OpenWrt:/# passwd<br />Changing password for root<br />New password:<br />Retype password:<br />passwd: warning: cannot create backup copy &#039;/etc/passwd-&#039;: Operation not permitted<br />passwd: cannot update password file /etc/passwd<br />root@OpenWrt:/# </p><p><strong>Then I rebuild to latest trunk (r16316) with many extra packages (like asterisk14, asterisk16, snort, nmap, openser, X-wrt, tcpdump and many other - about 150), but with same result: 8-( </strong></p><p>BusyBox v1.13.4 (2009-06-04 08:24:42 EEST) built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>_______ ________ __<br />| |.-----.-----.-----.| | | |.----.| |_<br />| - || _ | -__| || | | || _|| _|<br />|_______|| __|_____|__|__||________||__| |____|<br />|__| W I R E L E S S F R E E D O M<br />KAMIKAZE (bleeding edge, r16316) -------------------<br />* 10 oz Vodka Shake well with ice and strain<br />* 10 oz Triple sec mixture into 10 shot glasses.<br />* 10 oz lime juice Salute!<br />---------------------------------------------------<br />root@OpenWrt:/# device eth0 entered promiscuous mode<br />br-lan: topology change detected, propagating<br />br-lan: port 1(eth0) entering forwarding state<br />PPP generic driver version 2.4.2<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />nf_conntrack version 0.5.0 (1024 buckets, 4096 max)<br />CONFIG_NF_CT_ACCT is deprecated and will be removed soon. Plase use<br />nf_conntrack.acct=1 kernel paramater, acct=1 nf_conntrack module option or<br />sysctl net.netfilter.nf_conntrack_acct=1 to enable it.<br />IMQ driver loaded successfully.<br />Hooking IMQ before NAT on PREROUTING.<br />Hooking IMQ after NAT on POSTROUTING.<br />root@OpenWrt:/# passwd<br />Changing password for root<br />New password:<br />Retype password:<br />passwd: warning: cannot create backup copy &#039;/etc/passwd-&#039;: Operation not permitted<br />passwd: cannot update password file /etc/passwd<br />root@OpenWrt:/#</p><p><strong>Yesterday I rebuild to latest trunk and apply patch for build busybox 1.14.1 (passwd is a util from it) - but result the same again:</strong></p><p>BusyBox v1.14.1 (2009-06-10 18:41:12 EEST) built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> KAMIKAZE (bleeding edge, r16396) -------------------<br />&nbsp; * 10 oz Vodka&nbsp; &nbsp; &nbsp; &nbsp;Shake well with ice and strain<br />&nbsp; * 10 oz Triple sec&nbsp; mixture into 10 shot glasses.<br />&nbsp; * 10 oz lime juice&nbsp; Salute!<br /> ---------------------------------------------------<br />root@OpenWrt:/# passwd <br />Changing password for root<br />New password:<br />Bad password: too weak<br />Retype password:<br />passwd: warning: can&#039;t create backup copy &#039;/etc/passwd-&#039;: Operation not permitted<br />passwd: Invalid argument<br />passwd: cannot update password file /etc/passwd<br />root@OpenWrt:/# </p><br /><p><strong>Extra info for all images:</strong></p><p>root@OpenWrt:/# uname -a<br />Linux OpenWrt 2.6.27.21 #9 Wed Jun 10 18:51:41 EEST 2009 mips GNU/Linux</p><p>root@OpenWrt:/# mount <br />rootfs on / type rootfs (rw)<br />/dev/root on / type metafs (rw)<br />proc on /proc type proc (rw)<br />sysfs on /sys type sysfs (rw)<br />tmpfs on /tmp type tmpfs (rw,nosuid,nodev,size=6932k)<br />tmpfs on /dev type tmpfs (rw,size=512k)<br />devpts on /dev/pts type devpts (rw,mode=600)</p><p>root@OpenWrt:/# ls -l /etc/pass* <br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 119 May 26&nbsp; 2009 /etc/passwd</p><p><strong>P.S. </strong><br />I can manual edit passwd file and past hash of password, but I prefer use passwd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89713">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">szemo77</div>
					<div class="post-datetime">
						11 Jun 2009, 17:14					</div>
				</div>
				<div class="post-content content">
					<p>You have read only partition. Use the same method to flash like in <a href="http://oldwiki.openwrt.org/OpenWrtDocs(2f)Hardware(2f)Mikrotik(2f)RB100.html">RB150 (works on RB4xx)</a></p><p>I give you some tips, how make partitions:<br /></p><div class="codebox"><pre><code>mount /dev/mtdblock1 /mnt/
mv /tmp/openwrt-ar71xx-vmlinux.elf /mnt/kernel
ls /mnt
umount  /mnt/

mount /dev/mtdblock2 /mnt
cd /mnt
tar xzvf /tmp/openwrt-ar71xx-rootfs.tgz
cd /
umount /mnt</code></pre></div><p>Mikrotik give people Bull sheet!! <br />Simply use in trunk target for r71xx. I don&#039;t use any patches form MT, just Patrick <a href="http://inst.eecs.berkeley.edu/~pathorn/ip175c/">switch patch</a>.</p>											<p class="post-edited">(Last edited by <strong>szemo77</strong> on 11 Jun 2009, 17:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89715">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nik247</div>
					<div class="post-datetime">
						11 Jun 2009, 17:44					</div>
				</div>
				<div class="post-content content">
					<p>to szemo77</p><p>May be you don&#039;t understand my post.<br />I don&#039;t try install OpenWRT on RB450G - i try install OpenWRT in Metarouter of RB450G.<br />Metarouter is virtualisation for RB4xx platform (like xen for x86)<br />Mikrotik public patch for kernel 2.6.27.21 for support Metarouter in OpenWRT.</p><p><strong>Why you write? </strong> - You have read only partition. </p><p>I can write any on / partition. I can install and remove exta pkg.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89721">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">szemo77</div>
					<div class="post-datetime">
						11 Jun 2009, 19:03					</div>
				</div>
				<div class="post-content content">
					<p>Can you add other users?<br />Ok. I don&#039;t use Metarouter yet but if you can&#039;t use passwd always was the problem with right parttition for rootfs or no rootfs_data. <br />List partitions. Give us some more logs, etc.. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89784">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nik247</div>
					<div class="post-datetime">
						12 Jun 2009, 14:23					</div>
				</div>
				<div class="post-content content">
					<p><strong> 1) dmesg</strong><br />Linux version 2.6.27.21 (nik@nik-dom0) (gcc version 4.1.2) #9 Wed Jun 10 18:51:41 EEST 2009<br />CPU revision is: 0001800a (MIPS 4Kc)<br />Determined physical RAM map:<br />User-defined physical RAM map:<br /> memory: 01000000 @ 00000000 (usable)<br />Initrd not found or empty - disabling initrd<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00001000<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0: 0x00000000 -&gt; 0x00001000<br />On node 0 totalpages: 4096<br />free_area_init_node: node 0, pgdat c032cd60, node_mem_map c036f000<br />&nbsp; Normal zone: 4064 pages, LIFO batch:0<br />Built 1 zonelists in Zone order, mobility grouping off.&nbsp; Total pages: 4064<br />Kernel command line: init=/etc/preinit console=hvc0 board=vm mem=16M <br />Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.<br />Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes<br />PID hash table entries: 64 (order: 6, 256 bytes)<br />Console: colour dummy device 80x25<br />console [hvc0] enabled<br />Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />Memory: 12712k/16384k available (1939k kernel code, 3672k reserved, 289k data, 124k init, 0k highmem)<br />Calibrating delay loop... 369.66 BogoMIPS (lpj=739328)<br />Mount-cache hash table entries: 512<br />net_namespace: 592 bytes<br />NET: Registered protocol family 16<br />NET: Registered protocol family 2<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 512 (order: 0, 4096 bytes)<br />TCP bind hash table entries: 512 (order: -1, 2048 bytes)<br />TCP: Hash tables configured (established 512 bind 512)<br />TCP reno registered<br />NET: Registered protocol family 1<br />MFS init<br />squashfs: version 3.0 (2006/03/15) Phillip Lougher<br />Registering mini_fo version $Id$<br />msgmni has been set to 24<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />TCP westwood registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Mounted root (metafs filesystem) readonly.<br />Freeing unused kernel memory: 124k freed<br />Please be patient, while OpenWrt loads ...<br />Algorithmics/MIPS FPU Emulator v1.5<br />device eth0 entered promiscuous mode<br />br-lan: topology change detected, propagating<br />br-lan: port 1(eth0) entering forwarding state<br />PPP generic driver version 2.4.2<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />nf_conntrack version 0.5.0 (1024 buckets, 4096 max)<br />CONFIG_NF_CT_ACCT is deprecated and will be removed soon. Plase use<br />nf_conntrack.acct=1 kernel paramater, acct=1 nf_conntrack module option or<br />sysctl net.netfilter.nf_conntrack_acct=1 to enable it.<br />IMQ driver loaded successfully.<br />&nbsp; &nbsp; &nbsp; &nbsp; Hooking IMQ before NAT on PREROUTING.<br />&nbsp; &nbsp; &nbsp; &nbsp; Hooking IMQ after NAT on POSTROUTING.<br />root@OpenWrt:/# </p><p><strong>1) add user</strong></p><p>I manual chached file /etc/passwd to:</p><p>root@OpenWrt:/# cat /etc/passwd<br />root:$1$8PdvdwlZ$NfvLlnxRnNpf9GkAH4ajU1:0:0:root:/root:/bin/ash<br />nobody:*:65534:65534:nobody:/var:/bin/false<br />daemon:*:65534:65534:daemon:/var:/bin/false<br />nik:$1$8PdvdwlZ$NfvLlnxRnNpf9GkAH4ajU1:1001:0:test user:/tmp:/bin/ash<br />root@OpenWrt:/# </p><p>and /etc/group:<br />root@OpenWrt:/# cat /etc/group <br />root:x:0:1001:<br />nogroup:x:65534:<br />nik:x:1001:</p><p>After it I can login root to ssh with password &quot;123&quot;, <br />but with user login &quot;nik&quot; I can&#039;t login&nbsp; (I tried with own group and root group):<br />Jan&nbsp; 1 00:09:36 OpenWrt authpriv.info dropbear[1973]: Child connection from 192.168.1.47:1320<br />Jan&nbsp; 1 00:09:41 OpenWrt authpriv.notice dropbear[1973]: password auth succeeded for &#039;nik&#039; from 192.168.1.47:1320<br />Jan&nbsp; 1 00:09:41 OpenWrt authpriv.info dropbear[1974]: exit after auth (nik): error changing directory<br />Jan&nbsp; 1 00:09:41 OpenWrt authpriv.info dropbear[1973]: exit after auth (nik): Exited normally</p><p><strong> 3) output logread </strong><br />root@OpenWrt:/# logread <br />Jan&nbsp; 1 00:00:03 OpenWrt syslog.info syslogd started: BusyBox v1.14.1<br />Jan&nbsp; 1 00:00:03 OpenWrt user.notice kernel: klogd started: BusyBox v1.14.1 (2009-06-10 18:41:12 EEST)<br />Jan&nbsp; 1 00:00:06 kernel: device eth0 entered promiscuous mode<br />Jan&nbsp; 1 00:00:06 kernel: br-lan: topology change detected, propagating<br />Jan&nbsp; 1 00:00:06 kernel: br-lan: port 1(eth0) entering forwarding state<br />Jan&nbsp; 1 00:00:07 OpenWrt user.info kernel: PPP generic driver version 2.4.2<br />Jan&nbsp; 1 00:00:07 kernel: ip_tables: (C) 2000-2006 Netfilter Core Team<br />Jan&nbsp; 1 00:00:07 OpenWrt user.warn kernel: nf_conntrack version 0.5.0 (1024 buckets, 4096 max)<br />Jan&nbsp; 1 00:00:07 OpenWrt user.warn kernel: CONFIG_NF_CT_ACCT is deprecated and will be removed soon. Plase use<br />Jan&nbsp; 1 00:00:07 OpenWrt user.warn kernel: nf_conntrack.acct=1 kernel paramater, acct=1 nf_conntrack module option or<br />Jan&nbsp; 1 00:00:07 OpenWrt user.warn kernel: sysctl net.netfilter.nf_conntrack_acct=1 to enable it.<br />Jan&nbsp; 1 00:00:10 kernel: IMQ driver loaded successfully.<br />Jan&nbsp; 1 00:00:10 kernel:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hooking IMQ before NAT on PREROUTING.<br />Jan&nbsp; 1 00:00:10 kernel:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hooking IMQ after NAT on POSTROUTING.<br />Jan&nbsp; 1 00:00:13 OpenWrt user.info sysinit: Loading defaults<br />Jan&nbsp; 1 00:00:14 OpenWrt user.info sysinit: Loading synflood protection<br />Jan&nbsp; 1 00:00:14 OpenWrt user.info sysinit: Adding custom chains<br />Jan&nbsp; 1 00:00:14 OpenWrt user.info sysinit: Loading zones<br />Jan&nbsp; 1 00:00:15 OpenWrt user.info sysinit: Loading forwarding<br />Jan&nbsp; 1 00:00:15 OpenWrt user.info sysinit: Loading redirects<br />Jan&nbsp; 1 00:00:16 OpenWrt user.info sysinit: Loading rules<br />Jan&nbsp; 1 00:00:16 OpenWrt user.info sysinit: Loading includes<br />Jan&nbsp; 1 00:00:17 OpenWrt user.notice root: adding lan (br-lan) to firewall zone lan<br />Jan&nbsp; 1 00:00:18 OpenWrt cron.err crond[1674]: crond (busybox 1.14.1) started, log level 5<br />Jan&nbsp; 1 00:00:18 OpenWrt authpriv.info dropbear[1681]: Running in background<br />Jan&nbsp; 1 00:00:18 OpenWrt daemon.info init: starting pid 1267, tty &#039;/dev/hvc0&#039;: &#039;/bin/ash --login&#039;<br />Jan&nbsp; 1 00:00:23 OpenWrt user.info sysinit: cat: can&#039;t open &#039;/proc/mtd&#039;: No such file or directory<br />Jan&nbsp; 1 00:09:36 OpenWrt authpriv.info dropbear[1973]: Child connection from 192.168.1.47:1320<br />Jan&nbsp; 1 00:09:41 OpenWrt authpriv.notice dropbear[1973]: password auth succeeded for &#039;nik&#039; from 192.168.1.47:1320<br />Jan&nbsp; 1 00:09:41 OpenWrt authpriv.info dropbear[1974]: exit after auth (nik): error changing directory<br />Jan&nbsp; 1 00:09:41 OpenWrt authpriv.info dropbear[1973]: exit after auth (nik): Exited normally<br />Jan&nbsp; 1 00:13:12 OpenWrt auth.err passwd: warning: can&#039;t create backup copy &#039;/etc/passwd-&#039;: Operation not permitted<br />Jan&nbsp; 1 00:13:12 OpenWrt auth.err passwd: Invalid argument<br />Jan&nbsp; 1 00:13:12 OpenWrt auth.err passwd: cannot update password file /etc/passwd<br />root@OpenWrt:/# </p><p>I don&#039;t way get list partitions 8-(</p>											<p class="post-edited">(Last edited by <strong>nik247</strong> on 12 Jun 2009, 14:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89934">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nik247</div>
					<div class="post-datetime">
						15 Jun 2009, 22:47					</div>
				</div>
				<div class="post-content content">
					<p>Problem with &quot;passwd&quot; on Metarouter fixed.<br />Today Mikrotik released ROS v. 3.25, where fixed problem with hardlinks on Metarouter and public new patch.<br /><a href="http://forum.mikrotik.com/viewtopic.php?f=15&amp;t=32187">Here</a> thread about this problem with OpenWrt on Metarouter.</p><p>BusyBox v1.13.4 (2009-06-13 19:49:09 EEST) built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>_______ ________ __<br />| |.-----.-----.-----.| | | |.----.| |_<br />| - || _ | -__| || | | || _|| _|<br />|_______|| __|_____|__|__||________||__| |____|<br />|__| W I R E L E S S F R E E D O M<br />KAMIKAZE (bleeding edge, r16453) -------------------<br />* 10 oz Vodka Shake well with ice and strain<br />* 10 oz Triple sec mixture into 10 shot glasses.<br />* 10 oz lime juice Salute!<br />---------------------------------------------------<br />root@Metarouter:/# passwd <br />Changing password for root<br />New password:<br />Retype password:<br />Password for root changed by root<br />root@Metarouter:/#</p><p>You can try my last trunk (r16453) image <a href="http://openwrt.pantele.com.ua/trunk/metarouter/openwrt-metarouter-rootfs.tgz">here</a>.<br />Many extra packages for Metarouter <a href="http://openwrt.pantele.com.ua/trunk/metarouter/packages/">here</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>