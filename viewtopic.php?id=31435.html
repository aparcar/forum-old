<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> The best place to preconfigure wifi</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p141622">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kirelagin</div>
					<div class="post-datetime">
						18 Aug 2011, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I&#039;m building a custom firmware to make it easier to deploy routers.<br />I need to preconfigure wifi (that is SSID and encryption). How am I supposed to do this?</p><p>The problem is that wireless configuration is detected during first boot, so I can&#039;t just create &#039;files/etc/config/wireless&#039;. &#039;uci-default&#039; won&#039;t help either because those defaults are applyed in &#039;boot&#039; init script, before wifi was detected (in &#039;network&#039; init script).</p><p>I see two solutions: modifing default network settings in &#039;/lib/wifi/blabla.sh&#039; (&#039;detect_*&#039; function) or putting a script in &#039;rc.local&#039; which will preconfigure wifi on first boot and remove itself.</p><p>What are your ideas?</p><p>P.S. I was surprised when couldn&#039;t find anything about this.</p>											<p class="post-edited">(Last edited by <strong>kirelagin</strong> on 18 Aug 2011, 14:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141629">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">philchetcuti</div>
					<div class="post-datetime">
						18 Aug 2011, 16:14					</div>
				</div>
				<div class="post-content content">
					<p>I just created a default wireless file which I edit adding the mac address. In my case I also make edits for an ap/sta configuration.<br />Then I place it in package/base-files/files/etc/config and then build my firmware.</p><p>In my case I do need to edit the network file after first boot since I need static routing for the ap/sta. What I do is create a package/base-files/files/backup folder and place my version of network in there. I also include a small script in there called setup that performs a few &quot;first boot&quot; routines I need done which also includes a simple cp /backup/network /etc/config/network.</p><p>After flashing the unit I log in via ssh, run the setup script and then have a little peek around, make sure all is well.</p><p>Your idea of using rc.local is a good idea but if you do some examining of the boot process I think you&#039;ll find that rc.local can complete before the init boot process is fully complete, that leaves me a little unsure of what happened when. I like the idea of logging in once and running setup to ensure I have the results I want.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141638">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">samcrawford</div>
					<div class="post-datetime">
						18 Aug 2011, 17:26					</div>
				</div>
				<div class="post-content content">
					<p>I too vote for putting it in rc.local (or actually creating an init script for it). You&#039;ll just need to set it to a relatively high startup number, as you&#039;ll want the wireless auto-detect to have taken place already.</p><p>Thanks,</p><p>Sam</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141639">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">kirelagin</div>
					<div class="post-datetime">
						18 Aug 2011, 17:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>samcrawford wrote:</cite><blockquote><p>(or actually creating an init script for it)</p></blockquote></div><p>Yeah, I thought about creating separate init script, but, IMHO, rc.local actually IS kind of user-configurable init script, so it suits better for this purpose.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>