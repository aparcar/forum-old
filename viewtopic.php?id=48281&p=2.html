<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Linksys WRT300N-V1.1 Support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 16 Apr 2018 and 20 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=48281&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p230067">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						13 Apr 2014, 13:03					</div>
				</div>
				<div class="post-content content">
					<p>So we have to focus on b53 and GPIO number it uses. By default b53 takes a GPIO number from the nvram looking for &quot;gpioN=robo_reset&quot;. This is the first weird thing. In the output of &quot;nvram show&quot; you provided I can&#039;t see such nvram entry <img src="https://forum.openwrt.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /> It means that<br /></p><ol class="decimal"><li><p>bcm47xx_nvram_gpio_pin should return -ENOENT</p></li><li><p>b53_switch_get_reset_gpio should return -ENOENT</p></li><li><p>dev-&gt;reset_gpio should be set to -ENOENT</p></li><li><p>b53_switch_reset_gpio should never touch gpio because of dev-&gt;reset_gpio being negative number</p></li></ol><p>I&#039;ve also checked default NVRAM generated by CFE (I found WRT300Nv11-cfe.bin) and it also doesn&#039;t contain &quot;gpioN=robo_reset&quot;. Maybe there was such entry earlier (only in &quot;nvram&quot; partition), but you or DD-WRT cleared the nvram? Or maybe there is some bug in b53/bcm47xx I can&#039;t notice? <img src="https://forum.openwrt.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /></p><p>Anyway, according to the CFE logs this router uses (for real) GPIO 8 to reset switch:</p><div class="codebox"><pre><code>Reset switch via GPIO 8 ...</code></pre></div><p>For years OpenWrt was using GPIO 2 to reset switch on WRT300N V1.1 (see <a href="https://dev.openwrt.org/changeset/18921">r18921</a>). Hauke in his patch simply copied that to b53. It appears to be wrong. My guess is that GPIO 2 reboots device as well. It was never triggered by broadcom-diag, because it didn&#039;t try to reset switch for the second time.</p><p>P.S.<br />I&#039;ve temporary removed &quot;gpio7=robo_reset&quot; from my device and b53 stopped touching GPIOs. So I think there had to be some wrong entry in your nvram before installing DD-WRT.</p>											<p class="post-edited">(Last edited by <strong>Zajec</strong> on 13 Apr 2014, 13:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230070">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						13 Apr 2014, 13:30					</div>
				</div>
				<div class="post-content content">
					<p>@boblfoot: there is my final try. I&#039;m not sure if you still have Hauke&#039;s patch applied or not, so I&#039;ll just describe how you should proceed.</p><p>Please open file target/linux/generic/files/drivers/net/phy/b53/b53_priv.h and replace first &quot;b53_switch_get_reset_gpio&quot; function with the following code:</p><div class="codebox"><pre><code>static inline int b53_switch_get_reset_gpio(struct b53_device *dev)
{
    enum bcm47xx_board board = bcm47xx_board_get();

    switch (board) {
    case BCM47XX_BOARD_LINKSYS_WRT300NV11:
        pr_info(&quot;[%s] providing switch reset GPIO: %d\n&quot;, __FUNCTION__, 8);
        return 8;
    case BCM47XX_BOARD_LINKSYS_WRT310NV1:
        return 8;
    default:
        return bcm47xx_nvram_gpio_pin(&quot;robo_reset&quot;);
    }
}</code></pre></div><p>Then recompile OpenWrt with tg3 enabled (you can use &quot;Broadcom SoC, all Ethernet, No WiFi&quot; for example).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p231260">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						25 Apr 2014, 12:56					</div>
				</div>
				<div class="post-content content">
					<p>@boblfoot: hey, did you have a moment to test code from my last post?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p239453">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						6 Jul 2014, 14:41					</div>
				</div>
				<div class="post-content content">
					<p>This should be fixed in <a href="https://dev.openwrt.org/changeset/41526">https://dev.openwrt.org/changeset/41526</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=48281&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>