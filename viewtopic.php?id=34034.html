<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> is the .config used to build an openwrt firmware included in it?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p153824">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dlang</div>
					<div class="post-datetime">
						11 Jan 2012, 14:00					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to do a custom build for my wndr3700v2 APs (from trunk) , but the builds that I am making do not appear to be working, but the snapshot images are working for me.</p><p>I&#039;m assuming that it&#039;s something that I am doing wrong in my .config (no compile errors, just that the result is not pingable after being flashed). Is the .config used to compile a firmware image included anywhere in it so that i can grab a known-good config and try to compile it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153830">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						11 Jan 2012, 14:19					</div>
				</div>
				<div class="post-content content">
					<p>You can find the build .config in the corresponding download folders.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153847">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dlang</div>
					<div class="post-datetime">
						11 Jan 2012, 20:00					</div>
				</div>
				<div class="post-content content">
					<p>I may be looking in the wrong place, but looking in <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">http://downloads.openwrt.org/snapshots/trunk/ar71xx/</a> I am not seeing anything that looks like a config file. what am I missing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153854">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						12 Jan 2012, 00:22					</div>
				</div>
				<div class="post-content content">
					<p>I guess it&#039;s only relevant for the stable backfire release:</p><p><a href="http://backfire.openwrt.org/10.03.1/ar71xx/">http://backfire.openwrt.org/10.03.1/ar71xx/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153892">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						12 Jan 2012, 08:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dlang wrote:</cite><blockquote><p>I&#039;m trying to do a custom build for my wndr3700v2 APs (from trunk) , but the builds that I am making do not appear to be working, but the snapshot images are working for me.</p><p>I&#039;m assuming that it&#039;s something that I am doing wrong in my .config (no compile errors, just that the result is not pingable after being flashed). Is the .config used to compile a firmware image included anywhere in it so that i can grab a known-good config and try to compile it?</p></blockquote></div><p>Config file is built automatically for you with &#039;make menuconfig&#039;, where you make selections. So it is not anywhere in the sources. (Pieces of are scattered around, as it is parsed from default &amp; device-specific scripts after you select your device).</p><p>If you want a working wndr3700 .config as a template, you might grab my or Arokh&#039;s config from the Community release section of the forum.</p><p>The .config from my last well-working stable trunk build: <a href="http://koti.welho.com/hnyman1/Openwrt/trunk-r29701-2012-01-09/WNDR3700-trunk-r29701-2012-01-09-1853.config">http://koti.welho.com/hnyman1/Openwrt/t … 853.config</a><br />Backfire config: <a href="http://koti.welho.com/hnyman1/Openwrt/backfire-r29665-2012-01-05/WNDR3700-backfire-r29665-2012-01-05-2003.config">http://koti.welho.com/hnyman1/Openwrt/b … 003.config</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 12 Jan 2012, 11:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153894">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">dlang</div>
					<div class="post-datetime">
						12 Jan 2012, 08:58					</div>
				</div>
				<div class="post-content content">
					<p>I knew that .config is created by make *config, my question was if the resulting .config file gets stored in the resulting firmware .img or .bin file.</p><p>the idea is that if you find a build that does almost what you want, you don&#039;t have to try to recreate it from scratch, you can grab the file from the image (or from the router with the image installed), put in in your build tree and do make oldconfig to get it up to date and go from there. (or if you loose the config file you used to create a firmware image, but still have a router running it :-)</p><p>I think I&#039;ve found one at this point, but I think it would be a good option (and pretty cheap space wise) to have it included in the final firmware if it&#039;s not already an option.</p><p>the kernel has the option to include the config in the resulting kernel (it&#039;s available as /proc/config.gz with the option set) and is very useful to have.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153912">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						12 Jan 2012, 10:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dlang wrote:</cite><blockquote><p>the idea is that if you find a build that does almost what you want, you don&#039;t have to try to recreate it from scratch, you can grab the file from the image (or from the router with the image installed), put in in your build tree and do make oldconfig to get it up to date</p></blockquote></div><p>The .config file is rather large and will take some precious bytes in the image, so that will most likely not be part of the default build. (Wndr3700v2 has so large flash that it is not a problem.)</p><p>However, you can easily add a step to your build script to &#039;cp .config files/etc/.config&#039; between &#039;make menuconfig&#039; and final &#039;make world&#039;. Then the file will get included in your image as /etc/.config.&nbsp; (The files stored in &lt;buildroot&gt;/files do get included in the image.)</p><p>EDIT: <br />Another smaller alternative would be to create a seed .config file, which can be blown to full .config with &#039;make defconfig&#039;. I have a 40-lines .config.init, which I copy as .config, run &#039;make defconfig&#039; and get the full .config out of it. (All other config lines are created from defaults by defconfig.) Including that .config.init in build would only take a few kilobytes.</p><p>See <a href="https://forum.openwrt.org/viewtopic.php?pid=147078#p147078">https://forum.openwrt.org/viewtopic.php … 78#p147078</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 12 Jan 2012, 19:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153913">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						12 Jan 2012, 10:42					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s not that large, 20kb gzipped. I include them in my builds.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153979">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">dlang</div>
					<div class="post-datetime">
						12 Jan 2012, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not saying it should be default on all builds (if you are tight on space you trim everything), but having it as a standard option would let it be part of the defaults on the larger routers. At 20K gzipped and 120K native it&#039;s not _that_ large, if you are running luci on a system you probably have that much to spare.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153984">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						12 Jan 2012, 19:43					</div>
				</div>
				<div class="post-content content">
					<p>Snapshot builds are simple:</p><div class="codebox"><pre><code>./scripts/feeds update
./scripts/feeds install -a

cat &lt;&lt;EOT &gt; .config
CONFIG_TARGET_foo=y
CONFIG_ALL=y
# CONFIG_PACKAGE_ebtables is not set
EOT

make defconfig
make V=99 IGNORE_ERRORS=m</code></pre></div><p>No magic involved. Though the .configs generated in such a way are mostly useless, nobody really wants to build everything.</p><p>Also I think that embedding full .config files is a waste of space, several dozens of kilobytes just to list what is not enabled.<br />If at all you should embed the scripts/diffconfig.sh output and let make defconfig inflate it on a build, that also helps to avoid<br />issues like the shadow password debacle.</p><p>Finally there is no gurantee that .configs remain compatible - if you&#039;d try to compile current trunk with a .config from a few<br />months ago it&#039;ll most likely just fail.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>