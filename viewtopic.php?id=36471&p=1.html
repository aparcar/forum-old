<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> (TL-WR703n / GPIO / Misc) AR9331 pinouts?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Oct 2014 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 6</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=36471&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=6.html">6</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p165827">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">zzfish</div>
					<div class="post-datetime">
						26 Apr 2012, 07:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Curious if anyone has AR9331 pinouts and/or a list of available on-chip peripherals.&nbsp; I&#039;m hoping to be able to add some sensors, and possibly make use of some of the un-connected peripherals in the &#039;9331 (I&#039;m hoping there might even be a second SPI port that could be enabled, though I&#039;m guessing that&#039;s not the case).</p><p>from a bit of probing &amp; playing with the GPIO sysfs interface, it looks like there are at least 2 useable GPIOs next to the serial RX/TX pins, and 7 next to the ethernet pins -- I&#039;m guessing 4 of those could be configured as the second ethernet port some of the similar devices have, though haven&#039;t tried loading one of their kernels. </p><p>Also, curious if the AR9331 requires some GPIOs to be set to specific states for boot configuration (a number of the GPIOs are connected to VCC/GND via ~10k resistors -- I&#039;m guessing that&#039;s so a single kernel can be used for multiple routers, and it&#039;s basically &quot;hard coding&quot; the states of switches that are available on other models, though would like to be sure).</p><br /><p>As a sidenote, if anyone has a toasted WR703n that they wouldn&#039;t mind either sending to me, or desoldering the CPU and sending some nice pictures of the board underneath, that&#039;d also be appreciated.</p><br /><p>the larger hope here is to be able to throw on an SD card via SPI, and to be able to interface with assorted sensors without tapping into the USB bus... </p><br /><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166130">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">red_mamba</div>
					<div class="post-datetime">
						30 Apr 2012, 11:04					</div>
				</div>
				<div class="post-content content">
					<p>You won&#039;t be able to get datasheet for the chip.</p><p>Your best bet is to search &amp;| guess for pinout on a broken hardware. That&#039;s what I did on a broadcom router <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166279">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Bombyx</div>
					<div class="post-datetime">
						2 May 2012, 03:49					</div>
				</div>
				<div class="post-content content">
					<p>You must be right, red_mamba. However, it would be great if the community could centralize such pieces of information. It seems that quite a few people buy the TL-WR703N (or the TL-MR3020) with the purpose of tinkering with it, so any information about the AR9331 pinout would be very helpful.</p><p>For example, I would love to add a second RJ45 port to my WR703N. Some other pocket routers like the Planex <a href="http://www.planex.co.jp/product/router/mzk-rp150n/">MZK-RP150N</a> or the Zuni <a href="http://www.zunidigital.com/?page_id=220">ZR301</a> have two ports. This is very handy in the common situation where you have a computer connected to the internet through an ethernet cable. You can disconnect the cable from the computer, connect the cable to the pocket router, and connect the pocket router to the computer. This gets you a wireless internet access (e.g. for your smartphone) without losing it on the computer. You cannot do that with the WR703N.</p><p>Since the AR9331 is supposed to integrate an ethernet switch, adding a second port should not be that difficult...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166529">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zzfish</div>
					<div class="post-datetime">
						4 May 2012, 19:56					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll try to convert my assorted notes to something others can use... right now i&#039;ve got the 703 on hold as i work on a couple of other projects...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166682">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">imperfect</div>
					<div class="post-datetime">
						7 May 2012, 03:09					</div>
				</div>
				<div class="post-content content">
					<p>I have been messed the whole day with the multimeter and soldering iron and found something interesting!<br />There is at least 3 spare gpios on the board we can access:<br />1) Near the quarz crystal find resistance R4 (10.1 KOhm). It&#039;s gpio0. Unsolder the resistan?e and you ca easily acces the pin<br />2) Find resistance R15 near the tin dot right from the USB socket. It&#039;s gpio7 connected to ground.<br />3) The same for R17, it&#039;s gpio29.</p><p>The pins mentioned are unused by the system (as I suppose), there is no effect on functionality when you access them. Another gpios can be found on the other side of the board (for ex. gpio1 is connected to R2), they are controllable from userspace but unsoldering them causes boot failure (maybe there is a way to modify u-boot?). I&#039;m pretty sure you can find more with a bit of luck.</p><p>Now I&#039;m planning to test i2c bitbang driver (kmod-i2c-gpio-custom) with some bunch of sensors</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166689">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Bombyx</div>
					<div class="post-datetime">
						7 May 2012, 05:58					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for sharing, these are great findings. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166716">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">imperfect</div>
					<div class="post-datetime">
						7 May 2012, 14:17					</div>
				</div>
				<div class="post-content content">
					<p>If someone else wants to try, here is my notes:<br />1) GPIOs 1 and 2 are connected to the group of resistances at the bottom of the board (R2 R14). Not sure if they are usable, they can be nesassary for the DRAM initialization<br />2) The contact group near R57 R60 and R62 is SPI. 10.1KOhm pull-ups are used for SPI lines, so need to check if i2c will work with the same pull-up. <br />3) GPIO6 is connected to the voltage regulator U6 (R110, R107). Not sure about it&#039;s functions, but changing it&#039;s state doesn&#039;t affect USB functionality. Maybe it&#039;s an overcurrent interrupt?</p>											<p class="post-edited">(Last edited by <strong>imperfect</strong> on 7 May 2012, 14:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166881">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">imperfect</div>
					<div class="post-datetime">
						9 May 2012, 14:10					</div>
				</div>
				<div class="post-content content">
					<p>Yeahhh! Software i2c works flawlessly on pins 7,29! I used 10K pullups and 3.3V lines from the router (convenient place to take 3.3V is a soldering pad near C113 capacitor). PCF8574 io expander and ADXL345 accelerometer live fine from that source. So, now we have a way to make some embedded devices/robotics with full blown linux and WIFI/USB for 22$ <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> (not waiting for a raspberry pi <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p><p>Does anyone know how to test the speed of the software i2c bus? Is it 100 or 400 Khz?</p>											<p class="post-edited">(Last edited by <strong>imperfect</strong> on 9 May 2012, 14:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166915">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						9 May 2012, 21:48					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>echo pcf8574 0x38 &gt; /sys/bus/i2c/devices/i2c-0/new_device</code></pre></div><p>I think accelerometer drivers are still in staging.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166962">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">red_mamba</div>
					<div class="post-datetime">
						10 May 2012, 10:56					</div>
				</div>
				<div class="post-content content">
					<p>I wanted to build my own router with BCM5453. But quite a few people told me that Atheros is a better idea because it has much better driver support.</p><p>So I might start reverse engineering AR9331 pins. <br />Can anyone suggest a AR9331 based router with lots of flash, ram and USB port?<br />So I can reverse engineer all at once.</p><p>If any one has a bricked or broken router that can be donated for science let me know.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167016">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						10 May 2012, 21:14					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/?do=search&amp;id=ar9331">http://wiki.openwrt.org/?do=search&amp;id=ar9331</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167672">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">scerpio</div>
					<div class="post-datetime">
						18 May 2012, 18:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>imperfect wrote:</cite><blockquote><p>Yeahhh! Software i2c works flawlessly on pins 7,29! I used 10K pullups and 3.3V lines from the router (convenient place to take 3.3V is a soldering pad near C113 capacitor). PCF8574 io expander and ADXL345 accelerometer live fine from that source. So, now we have a way to make some embedded devices/robotics with full blown linux and WIFI/USB for 22$ <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> (not waiting for a raspberry pi <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p><p>Does anyone know how to test the speed of the software i2c bus? Is it 100 or 400 Khz?</p></blockquote></div><p>I&#039;d like to use i2c on a couple of IO expanders.&nbsp; Do you have any picture of your soldered wires?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168247">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">imperfect</div>
					<div class="post-datetime">
						27 May 2012, 01:49					</div>
				</div>
				<div class="post-content content">
					<p>As I received a lot of questions via PM, here are some pictures..<br /><a href="http://imgur.com/a/V3WXb#1">http://imgur.com/a/V3WXb#1</a></p><p>you need to remove resistances as I wrote (they are pulling gpios to ground) and add 10K resistances to +3.3 (it&#039;s a standard for I2C bus, else it won&#039;t work).<br />a place to take +3.3 are spare pads near C113. Actually, it&#039;s a line from the voltage regulator and you can draw ~200 mA from there, but don&#039;t connect it to anything more hungry.<br />remember that tracks on the circuit board are very subtle and can be lifted easily. You need to reliable fix all the wires.</p>											<p class="post-edited">(Last edited by <strong>imperfect</strong> on 27 May 2012, 01:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168431">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">msam</div>
					<div class="post-datetime">
						29 May 2012, 15:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>imperfect wrote:</cite><blockquote><p>As I received a lot of questions via PM, here are some pictures..<br /><a href="http://imgur.com/a/V3WXb#1">http://imgur.com/a/V3WXb#1</a></p><p>you need to remove resistances as I wrote (they are pulling gpios to ground) and add 10K resistances to +3.3 (it&#039;s a standard for I2C bus, else it won&#039;t work).<br />a place to take +3.3 are spare pads near C113. Actually, it&#039;s a line from the voltage regulator and you can draw ~200 mA from there, but don&#039;t connect it to anything more hungry.<br />remember that tracks on the circuit board are very subtle and can be lifted easily. You need to reliable fix all the wires.</p></blockquote></div><p>Imperfect , I look your pictures.Problably you are using 2 GPIO pins connected to&nbsp; R15 and R17 ok ?<br />But I can&#039;t find the GPIO number for this pins.Can you share information about this pins ?<br />Thanks a lot</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168455">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">imperfect</div>
					<div class="post-datetime">
						29 May 2012, 21:41					</div>
				</div>
				<div class="post-content content">
					<p>it&#039;s gpio7 ang gpio29, read my first post</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168533">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">msam</div>
					<div class="post-datetime">
						30 May 2012, 13:52					</div>
				</div>
				<div class="post-content content">
					<p>My picture showing&nbsp; some TL-WR703 GPIO pins.<br /><a href="http://www.flickr.com/photos/26336260@N03/7294963232/">http://www.flickr.com/photos/26336260@N03/7294963232/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168693">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">HKairpost</div>
					<div class="post-datetime">
						31 May 2012, 14:38					</div>
				</div>
				<div class="post-content content">
					<p>Hello there, congrats on the GPIO work.<br />Anyone knows if there are pins to connect a second USB port ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169900">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">imperfect</div>
					<div class="post-datetime">
						13 Jun 2012, 13:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Anyone knows if there are pins to connect a second USB port ?</p></blockquote></div><p>No, only single USB port. You need to use usb hub</p><p>For those who really wants to use their wr703n in some homemade electronic projects.<br />I&#039;ve managed to control another 2 gpios, located just near gpio0. It&#039;s 2 pads with resistors R11 and R12 on them (gpio14 and gpio15 according to kernel).<br />However, it required me to modify kernel sources and set some values on the GPIO_FUNCTION register of the AR9331. And it was not possible without a datasheet, of course <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />If there is some interest in it, I can try to prepare patches (never did it before).<br />As for other functionality, AR9331 has I2S support, GPIO edge/level interrupt support, 4 general purpose timers, subscriber line interface card (SLIC) support<br />Most of it is not implemented in the current kernel</p>											<p class="post-edited">(Last edited by <strong>imperfect</strong> on 13 Jun 2012, 13:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170042">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">Sunny_Jerry</div>
					<div class="post-datetime">
						15 Jun 2012, 09:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>imperfect wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Anyone knows if there are pins to connect a second USB port ?</p></blockquote></div><p>No, only single USB port. You need to use usb hub</p><p>For those who really wants to use their wr703n in some homemade electronic projects.<br />I&#039;ve managed to control another 2 gpios, located just near gpio0. It&#039;s 2 pads with resistors R11 and R12 on them (gpio14 and gpio15 according to kernel).<br />However, it required me to modify kernel sources and set some values on the GPIO_FUNCTION register of the AR9331. And it was not possible without a datasheet, of course <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />If there is some interest in it, I can try to prepare patches (never did it before).<br />As for other functionality, AR9331 has I2S support, GPIO edge/level interrupt support, 4 general purpose timers, subscriber line interface card (SLIC) support<br />Most of it is not implemented in the current kernel</p></blockquote></div><p>Please do it and appreciate for your great work!</p><p>PS:Can I use GPIOs to connect a micro-SD to expand the flash and swap partition?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171017">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">Schtz</div>
					<div class="post-datetime">
						26 Jun 2012, 20:58					</div>
				</div>
				<div class="post-content content">
					<p>I`ve killed the wr703N router by wrong flash image (with mtd write). How can i restore the functionality of my router?<br />Tried to connect with ca42 cable to the serial bus, but its output is empty. Should i reflash it over i2c or gpio? Advices are welcome.</p>											<p class="post-edited">(Last edited by <strong>Schtz</strong> on 26 Jun 2012, 21:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171021">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						26 Jun 2012, 21:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Schtz wrote:</cite><blockquote><p>Tried to connect with ca42 cable to the serial bus, but its output is empty.</p></blockquote></div><p>If you really used mtd, you should be able to recover with serial in u-boot. Maybe you will be more successful with a dku5 cable. Search for both cable types here in the forum, some people reported their experiences.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171055">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">Schtz</div>
					<div class="post-datetime">
						27 Jun 2012, 10:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>MBS wrote:</cite><blockquote><p>If you really used mtd, you should be able to recover with serial in u-boot. Maybe you will be more successful with a dku5 cable. Search for both cable types here in the forum, some people reported their experiences.</p></blockquote></div><p>Thx for advice, doesn`t mtd break u-boot?<br />Where can i read the information about this chip`s architecture or internal organization?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171066">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						27 Jun 2012, 11:38					</div>
				</div>
				<div class="post-content content">
					<p>normally, the u-boot partition is write-protected - and mtd should respect that. but that&#039;s just what i read here and there, i haven&#039;t had the balls to proof it ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171420">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">mayor</div>
					<div class="post-datetime">
						3 Jul 2012, 13:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>imperfect wrote:</cite><blockquote><p>I have been messed the whole day with the multimeter and soldering iron and found something interesting!<br />There is at least 3 spare gpios on the board we can access:<br />1) Near the quarz crystal find resistance R4 (10.1 KOhm). It&#039;s gpio0. Unsolder the resistan?e and you ca easily acces the pin<br />2) Find resistance R15 near the tin dot right from the USB socket. It&#039;s gpio7 connected to ground.<br />3) The same for R17, it&#039;s gpio29.</p><p>The pins mentioned are unused by the system (as I suppose), there is no effect on functionality when you access them. Another gpios can be found on the other side of the board (for ex. gpio1 is connected to R2), they are controllable from userspace but unsoldering them causes boot failure (maybe there is a way to modify u-boot?). I&#039;m pretty sure you can find more with a bit of luck.</p><p>Now I&#039;m planning to test i2c bitbang driver (kmod-i2c-gpio-custom) with some bunch of sensors</p></blockquote></div><p>This is great. Are you saying gpio7/R15 and gpio29/R17 have no effect on boot? Is the other end of these resistors grounded/0Ohm?</p><p>Also.. is there any easy way to access these (like LED IO) without recompiling?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171478">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">mayor</div>
					<div class="post-datetime">
						4 Jul 2012, 04:08					</div>
				</div>
				<div class="post-content content">
					<p>I tried them out. I had sucess with gpio29/R17 - no need to remove the resistor. Gpio7 did not work for me.<br />Was able to simply echo 1 or 0 into the /sys/..../gpio27/value file<br />High was 3.3V, Low is 0.6V... though there may be a problem with the ground I am using</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 6</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=36471&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=6.html">6</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>