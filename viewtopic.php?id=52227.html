<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN - different behaviour on different networks</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p243998">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						16 Aug 2014, 01:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I have recently set up OpenVPN server on my router, and I connect to it from my Android phone and also sometimes a Win 8.1 tablet. On my Android phone, I&#039;m using this app:</p><p><a href="https://play.google.com/store/apps/details?id=de.blinkt.openvpn">https://play.google.com/store/apps/deta … kt.openvpn</a></p><p>I&#039;ve configured the app to send all traffic through the VPN, and I&#039;ve also set up the server to push itself as the DNS (to resolve my local network names). Usually, everything works as expected, but on some networks it seems that even if the connection is successfully negotiated, I&#039;m still not able to reach my home network properly. That is, I can always ping my home router (through the tunnel, not the WAN IP), but not my devices behind it. I&#039;m at a complete loss why this is happening. As long as the connection is successfully negotiated, I don&#039;t get why it still seems to not work the same on any host network.</p><p>This is (part of) a sample log from a connection I made with my phone (log is from the phone app) through a public free wifi on an airport:</p><div class="codebox"><pre><code>2014-08-13 18:15:47 MANAGEMENT: &gt;STATE:1407946547,GET_CONFIG,,,
2014-08-13 18:15:49 SENT CONTROL [oeksvpnsrv]: &#039;PUSH_REQUEST&#039; (status=1)
2014-08-13 18:15:49 PUSH: Received control message: &#039;PUSH_REPLY,comp-lzo adaptive,dhcp-option DNS 192.168.12.1,route 10.8.0.1,topology net30,ping 10,ping-restart 120,ifconfig 10.8.0.6 10.8.0.5&#039;
2014-08-13 18:15:49 OPTIONS IMPORT: timers and/or timeouts modified
2014-08-13 18:15:49 OPTIONS IMPORT: --ifconfig/up options modified
2014-08-13 18:15:49 OPTIONS IMPORT: route options modified
2014-08-13 18:15:49 Got interface information 10.8.0.6 and 10.8.0.5, assuming second address is peer address of remote. Using /32 netmask for local IP. Mode given by OpenVPN is &quot;net30&quot;.
2014-08-13 18:15:49 OPTIONS IMPORT: --ip-win32 and/or --dhcp-option options modified
2014-08-13 18:15:49 ROUTE_GATEWAY 195.69.48.4/255.255.240.0 IFACE=wlan0 HWADDR=88:30:8a:4e:b8:b1
2014-08-13 18:15:49 do_ifconfig, tt-&gt;ipv6=0, tt-&gt;did_ifconfig_ipv6_setup=0
2014-08-13 18:15:49 MANAGEMENT: &gt;STATE:1407946549,ASSIGN_IP,,10.8.0.6,
2014-08-13 18:15:49 MANAGEMENT: CMD &#039;needok &#039;IFCONFIG&#039; ok&#039;
2014-08-13 18:15:49 MANAGEMENT: &gt;STATE:1407946549,ADD_ROUTES,,,
2014-08-13 18:15:49 MANAGEMENT: CMD &#039;needok &#039;ROUTE&#039; ok&#039;
2014-08-13 18:15:49 MANAGEMENT: CMD &#039;needok &#039;ROUTE&#039; ok&#039;
2014-08-13 18:15:49 MANAGEMENT: CMD &#039;needok &#039;ROUTE&#039; ok&#039;
2014-08-13 18:15:49 MANAGEMENT: CMD &#039;needok &#039;ROUTE&#039; ok&#039;
2014-08-13 18:15:49 MANAGEMENT: CMD &#039;needok &#039;DNSSERVER&#039; ok&#039;
2014-08-13 18:15:49 MANAGEMENT: CMD &#039;needok &#039;PERSIST_TUN_ACTION&#039; OPEN_BEFORE_CLOSE&#039;
2014-08-13 18:15:49 Opening tun interface:
2014-08-13 18:15:49 Local IPv4: 10.8.0.6/32 IPv6: null MTU: 1500
2014-08-13 18:15:49 DNS Server: 192.168.12.1, Domain: null
2014-08-13 18:15:49 Routes: 0.0.0.0/0, 10.8.0.1/32, 195.69.48.0/21, 195.69.56.0/21
2014-08-13 18:15:49 Routes excluded: 
2014-08-13 18:15:49 VpnService routes installed: 0.0.0.0/0, 10.8.0.1/32, 195.69.48.0/21, 195.69.56.0/21
2014-08-13 18:15:49 MANAGEMENT: CMD &#039;needok &#039;OPENTUN&#039; ok&#039;
2014-08-13 18:15:49 Initialization Sequence Completed
2014-08-13 18:15:49 MANAGEMENT: &gt;STATE:1407946549,CONNECTED,SUCCESS,10.8.0.6,xxx.xxx.xxx.xxx</code></pre></div><p>I&#039;ve masked out my external IP address, no need to post that online. :-)<br />There is nothing special here, the connection is successfully established, but in this particular case, I was unable to reach my home devices (except the router itself, which I could both ping and connect to via the web interface).</p><p>What could be the problem here? Given that it works perfectly on many/most host networks, what could cause it to (partially) fail on a few? It is really annoying, and I need to figure out why this happens.</p>											<p class="post-edited">(Last edited by <strong>mroek</strong> on 16 Aug 2014, 01:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244022">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">johan81</div>
					<div class="post-datetime">
						16 Aug 2014, 11:53					</div>
				</div>
				<div class="post-content content">
					<p>Are you using tun or tap? Tun will surely give you problems, posting your openvpn config server and client would be helpful as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244028">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						16 Aug 2014, 14:08					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m using tun (the Android app I&#039;m using doesn&#039;t support tap), but I still don&#039;t see how different host networks could cause the VPN to partially fail even though the connection is successfully established.</p><p>Here&#039;s the server config:</p><div class="codebox"><pre><code>config openvpn &#039;oeksvpn&#039;
        option enabled &#039;1&#039;
        option dev &#039;tun&#039;
        option proto &#039;udp&#039;
        option verb &#039;3&#039;
        option ca &#039;/etc/openvpn/ca.crt&#039;
        option cert &#039;/etc/openvpn/oeksvpnsrv.crt&#039;
        option key &#039;/etc/openvpn/oeksvpnsrv.key&#039;
        option server &#039;10.8.0.0 255.255.255.0&#039;
        option port &#039;1194&#039;
        option keepalive &#039;10 120&#039;
        option dh &#039;/etc/openvpn/dh2048.pem&#039;
        option comp_lzo &#039;adaptive&#039;
        option fast_io &#039;on&#039;
        option persist_tun &#039;1&#039;
        option persist_key &#039;1&#039;
        option duplicate_cn &#039;1&#039;
        list push &#039;comp-lzo adaptive&#039;
        list push &#039;dhcp-option DNS 192.168.12.1&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244029">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">johan81</div>
					<div class="post-datetime">
						16 Aug 2014, 14:29					</div>
				</div>
				<div class="post-content content">
					<p>tun gives all kinds of problems when you want to reach windows shares, it is a layer 3 connection and therefor doesn&#039;t work well with windows shares. Read here if you want to know more<br /><a href="https://openvpn.net/index.php/open-source/documentation/howto.html">https://openvpn.net/index.php/open-sour … howto.html</a></p>											<p class="post-edited">(Last edited by <strong>johan81</strong> on 19 Aug 2014, 11:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244030">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						16 Aug 2014, 14:35					</div>
				</div>
				<div class="post-content content">
					<p>I am aware of that, but this isn&#039;t really about windows shares. It affects a lot of things, and as mentioned I can&#039;t even ping any other devices than the router itself.</p><p>But even if tun might give various known issues, these issues should be independant of the host network used to establish the tunnel, as long as the tunnel is actually successfully established.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244189">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						19 Aug 2014, 02:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>johan81 wrote:</cite><blockquote><p>tun gives all kinds of problems when you want to reach windows shares, it is a layer 2 connection and therefor doesn&#039;t work well with windows shares. Read here if you want to know more<br /><a href="https://openvpn.net/index.php/open-source/documentation/howto.html">https://openvpn.net/index.php/open-sour … howto.html</a></p></blockquote></div><p>Tun is layer 3...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244191">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						19 Aug 2014, 02:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mroek wrote:</cite><blockquote><p>But even if tun might give various known issues, these issues should be independant of the host network used to establish the tunnel, as long as the tunnel is actually successfully established.</p></blockquote></div><p>What is the IP/subnet of your router/network? I don&#039;t see any routes being added for your home network in the connection log.</p><p>Sounds like the problem is a simple IP clash between your host network and your home network.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 19 Aug 2014, 02:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244195">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						19 Aug 2014, 02:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><div class="quotebox"><cite>mroek wrote:</cite><blockquote><p>But even if tun might give various known issues, these issues should be independant of the host network used to establish the tunnel, as long as the tunnel is actually successfully established.</p></blockquote></div><p>What is the IP/subnet of your router/network? I don&#039;t see any routes being added for your home network in the connection log.</p><p>Sounds like the problem is a simple IP clash between your host network and your home network.</p></blockquote></div><p>My home network is 192.168.12.0/24 (router is at .1), and as you can see in the log the host network is different.<br />And regarding routes, I have chosen (withing the app) that I want all traffic to go through the VPN, which I guess is accomplished by the app setting the default route (0.0.0.0/0).</p><p>Unfortunately this isn&#039;t easy to test, because on many host networks there are no issues, and whenever I find a host network which causes issues I am unsure how to troubleshoot...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244197">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						19 Aug 2014, 02:35					</div>
				</div>
				<div class="post-content content">
					<p>0.0.0.0/0 is not how Openvpn normally remaps the default gateway, but then you are using an unofficial third-party client instead of the real Openvpn client so it&#039;s hard to judge how it should be behaving.</p><p>The output of the &#039;route&#039; command would be a useful start. And a list of what IPs you can and can&#039;t ping.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244202">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						19 Aug 2014, 02:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>0.0.0.0/0 is not how Openvpn normally remaps the default gateway, but then you are using an unofficial third-party client instead of the real Openvpn client so it&#039;s hard to judge how it should be behaving.</p><p>The output of the &#039;route&#039; command would be a useful start. And a list of what IPs you can and can&#039;t ping.</p></blockquote></div><p>Thanks for your help. I&#039;ll try to test more extensively next time I come across a host network that casues issues.</p><p>It may be that the official app is a better choice, not really sure why I chose the 3rd-party app. I guess I could try the official app too.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>