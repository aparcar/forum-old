<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> where to find docs for &quot;robocfg&quot; / restricting lan-port speed?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 23 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p11793">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						7 Sep 2005, 11:30					</div>
				</div>
				<div class="post-content content">
					<p>Hi.</p><p>What I&#039;m trying to do is to restrict the lan-port speed of the 4 lan ports (of my WRT54Gv2.2 with WR RC2) to 2MBit.<br />As far as I read therefor I need robocfg.</p><p>Is there any documentation/HowTo for robocfg? I couldn&#039;t find anything helpful...</p><p>And might it be possible to use robocfg for separating the 4 lan ports (like I tried here <a href="http://forum.openwrt.org/viewtopic.php?id=2407">http://forum.openwrt.org/viewtopic.php?id=2407</a> without success)?</p><p>Thanks a lot!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12188">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						16 Sep 2005, 10:29					</div>
				</div>
				<div class="post-content content">
					<p>Sorry for reactivating this old thread but I still did not find any useful information about <strong>robocfg</strong>.<br />What I found about lan-port speed: <a href="http://forum.openwrt.org/viewtopic.php?id=1540">http://forum.openwrt.org/viewtopic.php?id=1540</a>. Is it integrated now?</p><p>Isn&#039;t there a HowTo?? How do all the others know how to configure robocfg?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12193">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dl</div>
					<div class="post-datetime">
						16 Sep 2005, 11:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Netzfetz wrote:</cite><blockquote><p>How do all the others know how to configure robocfg?</p></blockquote></div><p>The help (robocfg with no args) + trial and error. I&#039;d suggest leaving one of the ports on vlan0 during t/e so you have a way in if you fu.</p><p>&gt; use robocfg for separating the 4 lan ports </p><p>Put them on different vlans using nvram variables. Startup will use robocfg accordingly, but note that if you want to specify tagging you&#039;ll have to do it yourself in a startup script as I don&#039;t see anyway to spec this in vlanXports (would be nice). You might also need to create appropriate bridges or routes in your startup script so traffic flows.</p><p>- DL</p>											<p class="post-edited">(Last edited by <strong>dl</strong> on 16 Sep 2005, 11:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12251">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						17 Sep 2005, 18:45					</div>
				</div>
				<div class="post-content content">
					<p>OK, so the worst case.<br />But it seems with robocfg the minimum transfer rate I can set is 10MBit HD. I&#039;d need way less, like 1 or 2 MBit.<br />As far as I can remember with DD-WRT it was possible to set the rate down to about 0.5MBit.</p><p>Isn&#039;t that possible with OpenWRT?? (I really can&#039;t believe! <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12253">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dl</div>
					<div class="post-datetime">
						17 Sep 2005, 19:10					</div>
				</div>
				<div class="post-content content">
					<p>I recently flashed over my last dd-wrt box so can&#039;t check, but I don&#039;t recall any speed controls on ethernet beyond perhaps 10/100 hd/fd (if that). I would be surprised if the chip even has that capability but have not looked up the datasheet. Maybe you just need a traffic shaper?</p><p>- DL</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12270">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						18 Sep 2005, 01:53					</div>
				</div>
				<div class="post-content content">
					<p>OK, then: How can I limit the bandwidth of the lan-ports (below 10MBit)?</p><p>Is there a script? A tool? A special option? Something I could look for?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12390">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hitek146</div>
					<div class="post-datetime">
						20 Sep 2005, 04:10					</div>
				</div>
				<div class="post-content content">
					<p>I have written some basic documentation for robocfg, in an attempt to better spell out the functionality of robocfg in more clear of a manner.</p><p>First draft docs are in section 2.2.2 of the OpenWRT configuration guide:</p><p><a href="http://openwrt.org/OpenWrtDocs/Configuration">http://openwrt.org/OpenWrtDocs/Configuration</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12399">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						20 Sep 2005, 11:18					</div>
				</div>
				<div class="post-content content">
					<p>GREAT work!!!<br />Thank you so much. I&#039;ll try that out as soon as I can.<br />Hopefully this will be a starting point for others to spread their knowledge about that too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12482">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">doddel</div>
					<div class="post-datetime">
						21 Sep 2005, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>also have a look at tc; am using it here to limit uplink speed of the adsl modem to not overload the 256kbps limit.</p><p>line is a startup script in my case:<br />/rom/usr/sbin/tc qdisc add dev $IFNAME root tbf rate 226kbit latency 50ms burst 2048</p><p>where $IFNAME is the interface.</p><p>Copied it from another thread on openwrt, so check tc docs for adaptation to your case</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14469">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						29 Oct 2005, 00:08					</div>
				</div>
				<div class="post-content content">
					<p>OK, after some time (;)) I could figure out what tc, qdisc and tbf do.</p><p>But what I would need to do:<br />Limit upload bandwidth to 100kbit/s and download bandwidth to 1000kbit/s.<br />That means: two different speeds, depending on the &#039;direction&#039;.<br />Is that possible? And how?</p><p>For each lan port I set up a different vlan, so it should be possible to set different upload/download-speeds for every lan port, right?</p><p>What did you do to just limit UPlink speed?:<br /></p><div class="quotebox"><cite>doddel wrote:</cite><blockquote><p>/rom/usr/sbin/tc qdisc add dev $IFNAME root tbf rate 226kbit latency 50ms burst 2048</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14475">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						29 Oct 2005, 01:24					</div>
				</div>
				<div class="post-content content">
					<p>Once you&#039;ve got the vlans set up with robocfg you can do some simple traffic shaping on the interfaces.&nbsp; See my recent posts in this thread for some samples....</p><p><a href="http://forum.openwrt.org/viewtopic.php?id=1809">http://forum.openwrt.org/viewtopic.php?id=1809</a></p><p>Greg</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14499">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						29 Oct 2005, 15:43					</div>
				</div>
				<div class="post-content content">
					<p>Hmm, but how do I limit the <strong>INCOMING</strong> traffic (=incoming to the lan interface = outgoing to the Internet = &quot;upload bandwidth&quot;)?</p><p>All I could read about TBF was only dealing with traffic going <strong>OUT</strong> if the interface. Isn&#039;t it possible to simply limit <strong>in</strong>coming traffic??<br />I really don&#039;t need dynamic shaping, only a fixed rate/bandwidth...</p><p>And additionally: is it possible to set the maximum number of open connections per interface?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14516">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						29 Oct 2005, 23:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Netzfetz wrote:</cite><blockquote><p>Hmm, but how do I limit the INCOMING traffic (=incoming to the lan interface = outgoing to the Internet = &quot;upload bandwidth&quot;)?</p><p>All I could read about TBF was only dealing with traffic going OUT if the interface. Isn&#039;t it possible to simply limit incoming traffic??</p></blockquote></div><p>Sure.&nbsp; But let&#039;s make sure we&#039;re talking about the same thing, because it&#039;s not clear to me at least, that we are.&nbsp; Your sentence confuses me because you say &quot;INCOMING traffic&quot;, but then in the same sentence you say &quot;outgoing to the Internet = upload bandwidth&quot;.&nbsp; So assuming you&#039;re talking about throttling the inbound traffic coming from the Internet, through the WRT into the LAN, that&#039;s described <a href="http://lartc.org/howto/lartc.adv-filter.policing.html">here</a> and an example is at the very bottom of <a href="http://brewer123.home.comcast.net/openwrt/S46qos">this</a> configuration.&nbsp; The tc folks call it &quot;policing&quot; which is more an ATM term than an IP term in my opinion, but I digress... :-)&nbsp; </p><p>If you&#039;re instead talking about controlling outbound traffic coming from your LAN, through the WRT, going to the Internet, that&#039;s what I described in the other thread from my previous message, and what most people do to prioritize traffic for applications like VOIP (i.e. traffic shaping).&nbsp; You still use tc, but it requires a little more work for you to determine how you&#039;d like to prioritize your traffic.&nbsp; I suppose you could just rate limit all traffic with equal priority, (i.e. egress filtering) but that doesn&#039;t really buy you much...</p><div class="quotebox"><cite>Netzfetz wrote:</cite><blockquote><p>And additionally: is it possible to set the maximum number of open connections per interface?</p></blockquote></div><p>I think this is possible with ip_conntrack, but I not sure what you mean by &quot;open connections&quot;.&nbsp; &nbsp;Are you talking about simultaneous TCP sessions through a particular interface, or number of IP addresses connected at one time, or what?&nbsp; &nbsp;What exactly are you trying to do?</p><p>Greg</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14527">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						30 Oct 2005, 02:00					</div>
				</div>
				<div class="post-content content">
					<p>First of all: yes AND no. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>For each lan port I have set up a different vlan (=Interface), so the lan ports are totally independent from each other.</p><p>What I need to do: regulate the traffic for each lan port SEPARATELY, so e.g.: 100k UP 1000k DOWN for lan port 1, 200k UP 1200k DOWN for lan port 2, etc.<br />Since each lan port is virtually a different interface this should work with TC and TBF.</p><p>When I write &quot;upload bandwidth&quot; I mean traffic going out of a PC to one lan port of the WRT. From the WRT&#039;s point of view that is INcoming traffic (coming IN through a lan port / Interface).<br />&quot;Download&quot; is vice versa = OUTgoing traffic from the lan-interface&#039;s point of view.</p><p>I hope now it&#039;s clear <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>As far as I know ip_conntrack only handles the overall number of connections, right?<br />What I want is to adjust it for each interface separately.<br />E.g. if someone uses BitTorrent on one lan port this incredibly slows down the whole system even with the best traffic shaper. If I could restrict the maximum number of simultaneous connections for that port, only this particular port would slow down and all other lans would have enough resources left to run smoothly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14551">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						30 Oct 2005, 16:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Netzfetz wrote:</cite><blockquote><p>For each lan port I have set up a different vlan (=Interface), so the lan ports are totally independent from each other.</p><p>What I need to do: regulate the traffic for each lan port SEPARATELY, so e.g.: 100k UP 1000k DOWN for lan port 1, 200k UP 1200k DOWN for lan port 2, etc.<br />Since each lan port is virtually a different interface this should work with TC and TBF.</p></blockquote></div><p>Ok.&nbsp; This is clear, but I never done this exact setup before.&nbsp; I&#039;ll take a stab at it anyway.&nbsp; :-)</p><div class="quotebox"><cite>Netzfetz wrote:</cite><blockquote><p>When I write &quot;upload bandwidth&quot; I mean traffic going out of a PC to one lan port of the WRT. From the WRT&#039;s point of view that is INcoming traffic (coming IN through a lan port / Interface).<br />&quot;Download&quot; is vice versa = OUTgoing traffic from the lan-interface&#039;s point of view.</p></blockquote></div><p>Ok, I understand the point you&#039;re making, but iptables doesn&#039;t &quot;know&quot; which interface is connected to the Internet.&nbsp; iptables simply cares about inbound and outbound traffic on an interface, and what you want to do with it.&nbsp; So you can still shape traffic on each of the vlans with the same concepts I listed in the other thread, only it gets a little more complicated.&nbsp; The reason being because I assume you want to throttle traffic going between any given vlan and the Internet, but not throttle traffic between two internal vlans (i.e. what&#039;s the point in having 100Mbit full duplex if you throttle it? :-)</p><p>So, I&#039;d say you can do ingress filtering on each vlan port to 100kbps (controlling upstream traffic), and egress filtering on each vlan port to 1000kbps (controlling downstream traffic) but only where the source or destination isn&#039;t within your private address range.&nbsp; So to fit that last statement in, you&#039;d have to do part of it on the PREROUTING chain of the mangle table.&nbsp; This rules out using the classify module, because classify only works on the POSTROUTING chain.&nbsp; This means you need to do marks with iptables and use tc to pick up those marks.&nbsp; (or do it all with tc and fight through the arcane sentax)&nbsp; A bit more cumbersome, but it works as shown in the <a href="http://lartc.org/howto/lartc.cookbook.fullnat.intro.html">lartc guide</a>.&nbsp; Something like this might work:</p><p>iptables -t mangle -A PREROUTING -i vlan0 -p tcp -m tcp -d ! 192.168.0.0/16 --sport 22 -j MARK --set-mark 0x1</p><p>so this would set marks on all packets not bound for this class B private address range coming in on vlan0.&nbsp; You&#039;d do similar things with the other vlans.&nbsp; You&#039;d obviously need to have classes set up with tc and check for the marks with tc.</p><p>outbound postrouting on vlan0 you could probably use the classify module if you want, or stick with tc if you want to be consistent.</p><p>And of course, you can include using the ipp2p modules into the logic to pick up bittorrent traffic and whatnot since that seems to be what you&#039;re after.</p><p>I think this would work, but like I said I&#039;m just brainstorming here, because I never done this kind of setup on a WRT, but the theory still applies.&nbsp; It just need to be thought out more.&nbsp; It gets complicated when you&#039;ve created all the vlans.&nbsp; &nbsp;Maybe someone else can think of a more elegant way to do it?</p><p>Greg</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14865">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Netzfetz</div>
					<div class="post-datetime">
						5 Nov 2005, 00:33					</div>
				</div>
				<div class="post-content content">
					<p>Thanks!!<br />Yes, I think now it&#039;s clear <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>bluesguy wrote:</cite><blockquote><p>The reason being because I assume you want to throttle traffic going between any given vlan and the Internet, but not throttle traffic between two internal vlans</p></blockquote></div><p>The traffic between the vlans doesn&#039;t care. It&#039;s blocked. The ports are &#039;separated&#039;. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>What I&#039;d prefer is the most simple solution using the least &#039;computing power&#039;.</p><p>I simply want to HARD CUT the traffic-bandwidth, no special dynamic shaping or anything like that.<br />So the line </p><div class="codebox"><pre><code>tc qdisc add dev $IFNAME root tbf rate 200kbit latency 50ms burst 1054</code></pre></div><p>seemed to be what I was looking for (short, simple and effective), but I don&#039;t know how to use that line to handle traffic going the other way.</p><p>I&#039;d prefer not to use iptables if it could work with a simple &#039;tc&#039; command like the above.</p><p>Any idea to do that this way?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p14961">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						6 Nov 2005, 15:40					</div>
				</div>
				<div class="post-content content">
					<p>Sure, you can do it all with tc, but the syntax is a PITA.</p><p>Here&#039;s an SSH marking example from <a href="http://www.knowplace.org/shaper/examples.html">http://www.knowplace.org/shaper/examples.html</a></p><p>&quot;Creates a filter that classifies SSH packets:<br />tc filter add dev eth0 protocol ip parent 1:0 prio 1 u32\<br />match ip dport 22 0xfffe flowid 1:10&quot;</p><p>So you&#039;d need to set up a class for each vlan, and 4 classes for your external interface.&nbsp; Then tag all traffic outbound on each each vlan interface (inbound to your network) to each class for that vlan.&nbsp; And tag all traffic outbound on your external interface (outbound to the internet) where the source ip is from one particular vlan subnet, to it&#039;s appropriate class.&nbsp; Each class is throttled as you described, so the vlan classes have a ceiling of 1000kpbs, because outbound on those interfaces is really inbound traffic to your network, and the 4 classes on your external interface have a ceiling of 100 kpbs, because that&#039;s outbound traffic from the vlans to the internet.&nbsp; Quite simple, really, since you&#039;ve said that all vlan&#039;s are 100% separate and there&#039;s no routing between them.</p><p>There&#039;s information on tc throughout the lartc guide, but I think you&#039;re looking for this section:</p><p><a href="http://lartc.org/howto/lartc.adv-filter.html">http://lartc.org/howto/lartc.adv-filter.html</a></p><p>Another good webpage here:</p><p><a href="http://www.rns-nis.co.yu/~mps/linux-tc.html">http://www.rns-nis.co.yu/~mps/linux-tc.html</a></p><p>The documentation on tc is somewhat incomplete, which is why most people use iptables...</p><br /><p>Greg</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>