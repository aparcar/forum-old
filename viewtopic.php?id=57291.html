<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> unbrick using serial</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p275936">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">phantanphu</div>
					<div class="post-datetime">
						11 May 2015, 14:43					</div>
				</div>
				<div class="post-content content">
					<p>All led of my Tp-link Wr-741nd v4 blink slowly forever when i power on it. I try to unbricck using serial. I open case, connect the USB to ttl successfully. LAN ip of computer is 192.168.0.5. I have tftpd32.exe running. Setevn command is unknow like this:</p><div class="codebox"><pre><code>In:    serial
Out:   serial
Err:   serial
Net:   ag7240_enet_initialize...
No valid address in Flash. Using fixed address
No valid address in Flash. Using fixed address
: cfg1 0x5 cfg2 0x7114
eth0: 00:03:7f:09:0b:ad
ag7240_phy_setup
eth0 up
: cfg1 0xf cfg2 0x7214
eth1: 00:03:7f:09:0b:ad
athrs26_reg_init_lan
ATHRS26: resetting s26
ATHRS26: s26 reset done
ag7240_phy_setup
eth1 up
eth0, eth1
auto update firmware: is_auto_upload_firmware = 0!
Autobooting in 1 seconds
## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... ERROR: LzmaDecode.c, 543

Decoding error = 1
LZMA ERROR 1 - must RESET

U-Boot 1.1.4 (Apr 10 2014 - 16:02:22)

AP121 (ar9330) U-boot

DRAM:  32 MB
led turning on for 1s...
id read 0x100000ff
flash size 4194304, sector count = 64
Flash:  4 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag7240_enet_initialize...
No valid address in Flash. Using fixed address
No valid address in Flash. Using fixed address
: cfg1 0x5 cfg2 0x7114
eth0: 00:03:7f:09:0b:ad
ag7240_phy_setup
eth0 up
: cfg1 0xf cfg2 0x7214
eth1: 00:03:7f:09:0b:ad
athrs26_reg_init_lan
ATHRS26: resetting s26
ATHRS26: s26 reset done
ag7240_phy_setup
eth1 up
eth0, eth1
auto update firmware: is_auto_upload_firmware = 0!
Autobooting in 1 seconds
hornet&gt; setevn ipaddr 192.168.0.1
Unknown command &#039;setevn&#039; - try &#039;help&#039;
hornet&gt; setevn serverip 192.168.0.5
Unknown command &#039;setevn&#039; - try &#039;help&#039;
hornet&gt;</code></pre></div><p>How to make setevn command work?</p>											<p class="post-edited">(Last edited by <strong>phantanphu</strong> on 11 May 2015, 14:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275938">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						11 May 2015, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>Try setenv</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276034">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">phantanphu</div>
					<div class="post-datetime">
						12 May 2015, 08:56					</div>
				</div>
				<div class="post-content content">
					<p>Unknow command &quot;setevn&quot;<br />It seem i login as &quot;hornet&quot;, not &quot;ar7xxx&quot; as usual.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276072">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">phantanphu</div>
					<div class="post-datetime">
						12 May 2015, 15:14					</div>
				</div>
				<div class="post-content content">
					<p>There was an error:</p><div class="codebox"><pre><code> Uncompressing Kernel Image ... ERROR: LzmaDecode.c, 543

Decoding error = 1
LZMA ERROR 1 - must RESET</code></pre></div><p>How to fix this error?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276096">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">rolf2</div>
					<div class="post-datetime">
						12 May 2015, 18:59					</div>
				</div>
				<div class="post-content content">
					<p>you have typo in &quot;setenv&quot; command</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276098">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						12 May 2015, 19:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phantanphu wrote:</cite><blockquote><p>There was an error:<br /></p><div class="codebox"><pre><code> Uncompressing Kernel Image ... ERROR: LzmaDecode.c, 543

Decoding error = 1
LZMA ERROR 1 - must RESET</code></pre></div><p>How to fix this error?</p></blockquote></div><p>Two things:</p><p>1)<br />You have a typo (not setevn but setenv) that is faulty in your recovery attempt. But that might be a minor side story...</p><p>2)<br />Your actual error about kernel image decoding (ERROR: LzmaDecode.c, 543, error 1) might be rather serious. <br />I and some other wndr3700 users ran into some unexplained boot errors two years ago. Finally the serial bootlog revealed lzmadecode line 547 error 1, so rather near your error... :-(&nbsp; &nbsp;The reason was that if the &quot;lzma dictionary&quot; used in compressing the firmware is too big, the lzma decoding functionality in u-boot may break and may lead to error 1. The fix for wndr3700 was to limit dictionary size to 20 bits (1 MB) instead of default 23 bits ( 8MB). Developers included that in the Openwrt sources. <br />Story at <a href="https://dev.openwrt.org/ticket/12454#comment:12">https://dev.openwrt.org/ticket/12454#comment:12</a> and <br /><a href="https://forum.openwrt.org/viewtopic.php?id=40565">https://forum.openwrt.org/viewtopic.php?id=40565</a></p><p>It is possible that your new firmware is hitting similar lzma decompressing bug. The only cures are to use a known good firmware or to recompile with smaller dictionary size.</p><p>When you try to recover (with setenv etc...), flash with a firmware that you know to be good.</p><p>EDIT:<br />you are not alone: <a href="https://forum.openwrt.org/viewtopic.php?id=53865">https://forum.openwrt.org/viewtopic.php?id=53865</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 12 May 2015, 19:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276154">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						13 May 2015, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>You can also use &quot;printenv&quot; to see where the bootloader expects the TFTP server to be, then change your PC to match that.</p><p>The error means that the lzma decoder is unable to extract the firmware kernel-- the data is corrupt and you need to flash a new firmware.&nbsp; Booting occurs by extracting the entire kernel from flash into RAM, lzma decompressing in the process, and then jumping to the extracted code in RAM where the kernel actually runs.&nbsp; (In general nothing is executed direct from flash other than the very very first part of the bootloader which sets up the RAM chip and controller then copies the rest of the bootloader to RAM where it then runs)</p><p>Like hnyman said I would go to a &quot;known good&quot; firmware to rule out hardware problems, the obvious choice being TP-Link stock (which you may have to doctor up to flash directly).</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 13 May 2015, 02:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276161">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">phantanphu</div>
					<div class="post-datetime">
						13 May 2015, 05:39					</div>
				</div>
				<div class="post-content content">
					<p>I make a typo mistake: &quot;setenv&quot; not &quot;setevn&quot;. The Lzma error is no problem. I unbricked my router succecssfully. I think lzma error is no problem in serial console. Thanks for help. Solve lzma error is so far for my experrience. Sorry for poor English.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>