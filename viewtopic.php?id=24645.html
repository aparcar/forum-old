<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> What network settings for OpenWRT router sitting behind an ADSL modem?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 9 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p108635">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">DarrenD</div>
					<div class="post-datetime">
						6 May 2010, 01:12					</div>
				</div>
				<div class="post-content content">
					<p>I have the following setup</p><p>&nbsp; &nbsp;ADSL line<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp;ADSL modem (PPPoA,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WAN=IP via ISP, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LAN=static 192.168.0.3,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DHCP server,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DNS via ISP)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp;Wireless router (WAN=dynamic via ADSL modem DHCP [192.168.0.x],<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LAN=static 192.168.1.2,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DHCP server,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DNS=static 208.67.222.222 [OpenDNS])<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;. wireless laptops connect at this point (IP=dynamic via wireless router DHCP [192.168.1.x])<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp;OpenWRT Wired router (VLAN0=ports 0 1 2 3 4 5 network type=lan,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LAN=static 192.168.1.1,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;type=bridged,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gateway=192.168.1.2,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DNS=static 208.67.222.222 [OpenDNS])<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br />&nbsp; &nbsp;My wired PC (IP=dynamic via wireless router DHCP [192.168.1.x])<br />&nbsp; &nbsp;My wired other PC (IP=dynamic via wireless router DHCP [192.168.1.x])</p><p>I can use PuTTY to SSH into my OpenWRT router (a Netgear WGT634U) and enter<br />&nbsp; &nbsp;root@OpenWrt:~# arp -a<br />fine and get the results<br />&nbsp; &nbsp;IP address&nbsp; &nbsp; &nbsp; &nbsp;HW type&nbsp; &nbsp; &nbsp;Flags&nbsp; &nbsp; &nbsp; &nbsp;HW address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Mask&nbsp; &nbsp; &nbsp;Device<br />&nbsp; &nbsp;192.168.1.2&nbsp; &nbsp; &nbsp; 0x1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1C:AF:F7:45:B5:44&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; br-lan<br />&nbsp; &nbsp;192.168.1.26&nbsp; &nbsp; &nbsp;0x1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00:13:D3:66:03:93&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; br-lan</p><p>However, if I enter<br />&nbsp; &nbsp;root@OpenWrt:~# ping <a href="http://www.google.co.uk">www.google.co.uk</a><br />I finally get [after minutes]<br />&nbsp; &nbsp;ping: bad address &#039;<a href="http://www.google.co.uk">www.google.co.uk</a>&#039;</p><p>However, if I enter the IP address for <a href="http://www.google.co.uk">www.google.co.uk</a> directly as<br />&nbsp; &nbsp;root@OpenWrt:~# ping <a href="http://www.google.co.uk">www.google.co.uk</a><br />I get the following immediately<br />&nbsp; &nbsp;PING 208.69.34.230 (208.69.34.230): 56 data bytes<br />And then [after minutes - I had to press Ctrl+C]<br />&nbsp; &nbsp;--- 208.69.34.230 ping statistics ---<br />&nbsp; &nbsp;358 packets transmitted, 0 packets received, 100% packet loss</p><p>Can someone please tell me what I have got wrong in my OpenWRT settings? My problem with this failure is that I cannot get the correct time for my router. This is important as I use a USB disk off the router so date/time is important.</p><p>I am using the ADSL modem on 192.168.0.x so that it ONLY deals with ADSL. The rest of my network is 192.168.1.x (including wireless laptops that connect via the wireless router). I am hoping this setup allows all my laptops to see the desktops and at the same time keeps the modem separate.</p><p>Thanks<br />Darren</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108678">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">zorxd</div>
					<div class="post-datetime">
						6 May 2010, 18:58					</div>
				</div>
				<div class="post-content content">
					<p>So basically your internet works from everywhere, including you laptops and your wired PCs, but not from your OpenWRT router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108684">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">DarrenD</div>
					<div class="post-datetime">
						6 May 2010, 20:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zorxd wrote:</cite><blockquote><p>So basically your internet works from everywhere, including you laptops and your wired PCs, but not from your OpenWRT router?</p></blockquote></div><p>Yes that&#039;s right.</p><p>The laptops connect to the internet fine (via the wireless router --&gt; ADSL modem). The laptops have 192.168.1.x IP addresses and can also print to my printer (connected to the OpenWRT wired router using p910d - which was the main reason for OpenWRT).</p><p>The PCs connect to the internet fine (via the OpenWRT wired router). The PCs have 192.168.1.x IP addresses and can also print to my printer.</p><p>The OpenWRT wired router just can&#039;t ping <a href="http://www.google.co.uk">www.google.co.uk</a> and so can&#039;t get the time. I am actually using X-Wrt but it is essentially the same as OpenWRT. The X-Wrt has a webpage that tests ping but I also used PuTTY to SSH into the router itself and it still could not ping from there either.</p><p>Since raising the original post I have altered my setup slightly in that the ADSL modem is now in bridged mode with the wireless router set to PPPoE. This now means the 192.168.0.x IP addresses from the ADSL modem to the wireless router no longer exist and the wireless router WAN side now has the dynamic IP address given by my ISP rather than 192.168.0.x given by the ADSL modem&#039;s DHCP server. This change did not solve my problem as the problem is with the OpenWRT wired router.</p><p>I had an e-mail from admin at openwrt dot org (not sure why it is not here in this thread). They said </p><p>&nbsp; &nbsp;You have configured it in wrong way. Non of the router interfaces is in the 192.168.0.0/24 network, so no communication with the ADSL modem can be done. To be precise, your router is not a router anymore - just an AP+Switch... </p><p>&nbsp; &nbsp;1. Leave the vlans as they were by default, connect the ADSL modem to router WAN port.<br />&nbsp; &nbsp;2. Assign the wan address by DHCP - it should get 192.168.0.xxx assigned. </p><p>&nbsp; &nbsp; It should work after that.</p><p>Now I am not an expert on networks but I believe that I had already done what was suggested, i.e. my wireless router was connected at its WAN port to the ADSL modem and did get 192.168.0.x via the ADSL modem&#039;s DHCP. I had left the vlans as they were by default as this is the wireless router that does not have OpenWRT. My problem is that the OpenWRT wired router needs to be part of the same network address 192.168.1.x (to make one simple/flat-structured home network) as the wireless router hence I should not use the OpenWRT&#039;s WAN port (actually I do but I had set all 5 ports as LAN by deleting the WAN network).</p><p>I will attempt to recreate the WAN network on my OpenWRT wired router but not plug anything into it so I have my wireless router LAN output plugged into a LAN input on my OpenWRT wired router and my 2 PCs also connected to the LAN ports on my OpenWRT wired router.</p><p>If I plugged the wireless router LAN output into the WAN port on my OpenWRT wired router will that create 2 networks, i.e. 192.168.1.x on the wireless router and 192.168.2.x on the OpenWRT router (I would then have to turn on DHCP on the OpenWRT)? I would expect that this would allow me to ping OK and get the time on the OpenWRT router but I am not sure how Windows would view the 2 networks 192.168.1.x and 192.168.2.x with regards to file sharing and access to the printer. This is where my network understanding is weak.</p><p>More advice would be appreciated and thanks for the advice already given.<br />Thanks<br />Darren</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108717">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">grogi</div>
					<div class="post-datetime">
						7 May 2010, 11:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>DarrenD wrote:</cite><blockquote><p>I will attempt to recreate the WAN network on my OpenWRT wired router but not plug anything into it so I have my wireless router LAN output plugged into a LAN input on my OpenWRT wired router and my 2 PCs also connected to the LAN ports on my OpenWRT wired router.</p></blockquote></div><p>Don&#039;t - your configuration looks ok. It was me that typed that, but after a moment I realized I have skipped one of your boxes in the network, so I have removed the post.</p><p>Paste here the output of <strong>ip -4 route</strong> executed on the OpenWRT. Show the <strong>/etc/config/network</strong> too.</p>											<p class="post-edited">(Last edited by <strong>grogi</strong> on 7 May 2010, 11:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108721">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 May 2010, 13:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>DarrenD wrote:</cite><blockquote><p>The laptops connect to the internet fine (via the wireless router --&gt; ADSL modem). The laptops have 192.168.1.x IP addresses and can also print to my printer (connected to the OpenWRT wired router using p910d - which was the main reason for OpenWRT).</p></blockquote></div><p>Sounded like your aDSL modem is configured with a NAT/Firewall option enabled. If you attached another router behind this aDSL modem, anything attached to this router will connect to Internet with a double NAT/Firewall which may cause some problems. You can either configure your aDSL or router (not both) with a transparent bridge (no NAT/Firewall). In this case, my preference is to configure the aDSL modem with a transparent bridge and let the OpenWRT router to do all the NAT/Firewall. If you go this route, you may also want to disable the WiFi feature on the aDSL modem and let the OpenWRT router to handle the WiFi connection.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108734">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">DarrenD</div>
					<div class="post-datetime">
						7 May 2010, 17:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>grogi wrote:</cite><blockquote><div class="quotebox"><cite>DarrenD wrote:</cite><blockquote><p>I will attempt to recreate the WAN network on my OpenWRT wired router but not plug anything into it so I have my wireless router LAN output plugged into a LAN input on my OpenWRT wired router and my 2 PCs also connected to the LAN ports on my OpenWRT wired router.</p></blockquote></div><p>Don&#039;t - your configuration looks ok. It was me that typed that, but after a moment I realized I have skipped one of your boxes in the network, so I have removed the post.</p><p>Paste here the output of <strong>ip -4 route</strong> executed on the OpenWRT. Show the <strong>/etc/config/network</strong> too.</p></blockquote></div><p>I used PuTTY to SSH into the OpenWRT router and enter &quot;ip -4 route&quot; but I got<br />&nbsp; &nbsp;-ash: ip: not found</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108735">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">DarrenD</div>
					<div class="post-datetime">
						7 May 2010, 17:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><div class="quotebox"><cite>DarrenD wrote:</cite><blockquote><p>The laptops connect to the internet fine (via the wireless router --&gt; ADSL modem). The laptops have 192.168.1.x IP addresses and can also print to my printer (connected to the OpenWRT wired router using p910d - which was the main reason for OpenWRT).</p></blockquote></div><p>Sounded like your aDSL modem is configured with a NAT/Firewall option enabled. If you attached another router behind this aDSL modem, anything attached to this router will connect to Internet with a double NAT/Firewall which may cause some problems. You can either configure your aDSL or router (not both) with a transparent bridge (no NAT/Firewall). In this case, my preference is to configure the aDSL modem with a transparent bridge and let the OpenWRT router to do all the NAT/Firewall. If you go this route, you may also want to disable the WiFi feature on the aDSL modem and let the OpenWRT router to handle the WiFi connection.</p></blockquote></div><p>I now have the ADSL modem bridged to the wireless router (D-LINK DIR-615) which is set to PPPoE mode with the settings that I used to enter in the ADSL modem. I believe this means the ADSL modem is now out of the equation as it only transfers the ethernet signals from the DIR-615 WAN port into ADSL telephone signals. The DIR-615 is now effectively the first part of my setup to hit the internet. This wireless router has DHCP, NAT, firewall, wireless and all the other stuff turned on. My OpenWRT wired router (Netgear WGT634U) is hanging off the D-LINK via LAN ports only (WAN disabled on the Netgear). So I have done the first part of your &quot;my preference is...&quot; but can&#039;t do the second as the OpenWRT router is not directly connected to the ADSL modem (it is connected to the D-LINK which is then directly connected to the ADSL modem).</p><p>Note, I have this 2 stage router setup as the D-LINK needs to be near the ADSL modem to get a good wireless signal and the OpenWRT router is near my PC and printer as the printer is shared over the network as the Netgear has a USB port.</p><p>Thanks for your suggestions and keep them coming<br />Darren</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108737">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 May 2010, 18:28					</div>
				</div>
				<div class="post-content content">
					<p>Currently, I have two Netgear WGT634U (flashed with a self-built OpenWRT SVN firmware) connected to my main WRT54GS v3 NAT/Firewall router (flashed with a DD-WRT v24sp1 firmware) and they all work with no problems. One WGT634U is in production to host my Asterisk PBX system while the other is used to host FreeSwitch for learning/testings. On each WGT634U device, I have several ATA devices registered to it and have no problem to call from one ATA connected to one WGT634U to another ATA connected to the other WGT634U. Each WGT634U unit has no problem to access the Internet, i.e. <em>ping <a href="http://www.google.co.uk">www.google.co.uk</a></em> has responses. That said, what happens if you perform a factory reset on the WGT634U device? Will this resolve the issue? If no, wny not try to reflash your WGT634U with the latest OpenWRT firmware and see if that will resolve the issue.</p><p>I used the following hack to turn one of my WGT634U units as a bridge:<br /></p><div class="codebox"><pre><code>config &#039;switch&#039; &#039;eth0&#039;

config &#039;interface&#039; &#039;loopback&#039;
      option &#039;ifname&#039; &#039;lo&#039;
      option &#039;proto&#039; &#039;static&#039;
      option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
      option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
      option &#039;ifname&#039; &#039;eth0.0&#039;
      option &#039;proto&#039; &#039;static&#039;
      option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
      option &#039;gateway&#039; &#039;192.168.1.2&#039;
      option &#039;netmask&#039; &#039;255.255.255.0&#039;
      option &#039;dns&#039; &#039;192.168.1.2&#039;

config &#039;switch_vlan&#039; &#039;eth0_0&#039;
      option &#039;device&#039; &#039;eth0&#039;
      option &#039;vlan&#039; &#039;0&#039;
      option &#039;ports&#039; &#039;0 1 2 3 4 5</code></pre></div><p>If you have two routers configured with the above scheme and they are configured on the same subnet bridge, chances are your main router will encouter some issues to route packets from one device connected to one router to the other.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108738">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">DarrenD</div>
					<div class="post-datetime">
						7 May 2010, 18:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>DarrenD wrote:</cite><blockquote><div class="quotebox"><cite>grogi wrote:</cite><blockquote><div class="quotebox"><cite>DarrenD wrote:</cite><blockquote><p>I will attempt to recreate the WAN network on my OpenWRT wired router but not plug anything into it so I have my wireless router LAN output plugged into a LAN input on my OpenWRT wired router and my 2 PCs also connected to the LAN ports on my OpenWRT wired router.</p></blockquote></div><p>Don&#039;t - your configuration looks ok. It was me that typed that, but after a moment I realized I have skipped one of your boxes in the network, so I have removed the post.</p><p>Paste here the output of <strong>ip -4 route</strong> executed on the OpenWRT. Show the <strong>/etc/config/network</strong> too.</p></blockquote></div><p>I used PuTTY to SSH into the OpenWRT router and enter &quot;ip -4 route&quot; but I got<br />&nbsp; &nbsp;-ash: ip: not found</p></blockquote></div><p>Whoops, I forgot the network info you also asked for. Here it is</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/network

config &#039;switch&#039; &#039;eth0&#039;
        option &#039;vlan0&#039; &#039;0 1 2 3 4 5&#039;
        option &#039;vlan1&#039; &#039;&#039;

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;ifname&#039; &#039;eth0.0&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;macaddr&#039; &#039;&#039;
        option &#039;ip6addr&#039; &#039;&#039;
        option &#039;ip6gw&#039; &#039;&#039;
        option &#039;gateway&#039; &#039;192.168.1.2&#039;
        option &#039;dns&#039; &#039; 192.168.1.2&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108763">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">grogi</div>
					<div class="post-datetime">
						8 May 2010, 15:13					</div>
				</div>
				<div class="post-content content">
					<p>I personally use the following config:</p><div class="codebox"><pre><code>config &#039;switch&#039; &#039;eth0&#039;
        option &#039;vlan0&#039; &#039;0 1 2 3 5*&#039;
        option &#039;vlan1&#039; &#039;4 5&#039;

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;type&#039;           bridge
        option &#039;proto&#039;          static
        option &#039;netmask&#039;        255.255.255.0
        option &#039;ipaddr&#039;         192.168.1.1
        option &#039;gateway&#039;        192.168.1.2
        option &#039;ifname&#039;         eth0.0 eth0.1
        option &#039;dns&#039;            192.168.1.2</code></pre></div><p>And it works... </p><p>So, first try removing the <strong>macaddr</strong> and ipv6 related options from your config, I guess it is causing the problem. I use different vlan configuration, but that shouldn&#039;t be a problem.</p><p>-- edit</p><p>You can print the routing table by executing just <strong>route</strong>.</p>											<p class="post-edited">(Last edited by <strong>grogi</strong> on 8 May 2010, 15:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108764">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">grogi</div>
					<div class="post-datetime">
						8 May 2010, 15:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>Sounded like your aDSL modem is configured with a NAT/Firewall option enabled.</p></blockquote></div><p>aDSL might be in bridge mode, and 192.168.0.x router does PPPoE and NAT. </p><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>If you attached another router behind this aDSL modem, anything attached to this router will connect to Internet with a double NAT/Firewall which may cause some problems.</p></blockquote></div><p>Not every router does NAT - have this in mind. Internet itself consists of hundreds of networks connected with routers, non of which does NAT. NAT is a very nasty hack designed as short term defense before we run out of IPv4 addresses.</p><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>You can either configure your aDSL or router (not both) with a transparent bridge (no NAT/Firewall). In this case, my preference is to configure the aDSL modem with a transparent bridge and let the OpenWRT router to do all the NAT/Firewall.</p></blockquote></div><p>What do you mean by &quot;transparent bridge&quot;? A switch? </p><p>As mentioned before, it is always possible to configure a device as ordinary routers, without NAT. I don&#039;t see any problem with that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108767">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">DarrenD</div>
					<div class="post-datetime">
						8 May 2010, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>OK guys I made the changes suggested and here are some results of IPTABLES, ROUTE and PING.</p><p>I have the cable from the DIR-615 plugged into the OpenWRT port 3 (according to the front LEDs on my WGT634U) and my PC plugged into port 2&nbsp; (according to the front LEDs on my WGT634U) with nothing else plugged into it.</p><div class="codebox"><pre><code>root@OpenWrt:~# iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
DROP       all  --  anywhere             anywhere            state INVALID
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED
ACCEPT     all  --  anywhere             anywhere
syn_flood  tcp  --  anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN
input_rule  all  --  anywhere             anywhere
input      all  --  anywhere             anywhere

Chain FORWARD (policy DROP)
target     prot opt source               destination
zone_wan_MSSFIX  all  --  anywhere             anywhere
DROP       all  --  anywhere             anywhere            state INVALID
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED
forwarding_rule  all  --  anywhere             anywhere
forward    all  --  anywhere             anywhere
reject     all  --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
DROP       all  --  anywhere             anywhere            state INVALID
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED
ACCEPT     all  --  anywhere             anywhere
output_rule  all  --  anywhere             anywhere
output     all  --  anywhere             anywhere

Chain forward (1 references)
target     prot opt source               destination
zone_lan_forward  all  --  anywhere             anywhere

Chain forwarding_lan (1 references)
target     prot opt source               destination

Chain forwarding_rule (1 references)
target     prot opt source               destination

Chain forwarding_wan (1 references)
target     prot opt source               destination

Chain input (1 references)
target     prot opt source               destination
zone_lan   all  --  anywhere             anywhere

Chain input_lan (1 references)
target     prot opt source               destination

Chain input_rule (1 references)
target     prot opt source               destination

Chain input_wan (1 references)
target     prot opt source               destination

Chain output (1 references)
target     prot opt source               destination
zone_lan_ACCEPT  all  --  anywhere             anywhere
zone_wan_ACCEPT  all  --  anywhere             anywhere

Chain output_rule (1 references)
target     prot opt source               destination

Chain reject (3 references)
target     prot opt source               destination
REJECT     tcp  --  anywhere             anywhere            reject-with tcp-reset
REJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable

Chain syn_flood (1 references)
target     prot opt source               destination
RETURN     tcp  --  anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN limit: avg 25/sec burst 50
DROP       all  --  anywhere             anywhere

Chain zone_lan (1 references)
target     prot opt source               destination
input_lan  all  --  anywhere             anywhere
zone_lan_ACCEPT  all  --  anywhere             anywhere

Chain zone_lan_ACCEPT (2 references)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere

Chain zone_lan_DROP (0 references)
target     prot opt source               destination
DROP       all  --  anywhere             anywhere
DROP       all  --  anywhere             anywhere

Chain zone_lan_MSSFIX (0 references)
target     prot opt source               destination
TCPMSS     tcp  --  anywhere             anywhere            tcp flags:SYN,RST/SYN TCPMSS clamp to PMTU

Chain zone_lan_REJECT (1 references)
target     prot opt source               destination
reject     all  --  anywhere             anywhere
reject     all  --  anywhere             anywhere

Chain zone_lan_forward (1 references)
target     prot opt source               destination
zone_wan_ACCEPT  all  --  anywhere             anywhere
forwarding_lan  all  --  anywhere             anywhere
zone_lan_REJECT  all  --  anywhere             anywhere

Chain zone_wan (0 references)
target     prot opt source               destination
ACCEPT     udp  --  anywhere             anywhere            udp dpt:68
input_wan  all  --  anywhere             anywhere
zone_wan_REJECT  all  --  anywhere             anywhere

Chain zone_wan_ACCEPT (2 references)
target     prot opt source               destination

Chain zone_wan_DROP (0 references)
target     prot opt source               destination

Chain zone_wan_MSSFIX (1 references)
target     prot opt source               destination

Chain zone_wan_REJECT (2 references)
target     prot opt source               destination

Chain zone_wan_forward (0 references)
target     prot opt source               destination
forwarding_wan  all  --  anywhere             anywhere
zone_wan_REJECT  all  --  anywhere             anywhere
root@OpenWrt:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.1.0     *               255.255.255.0   U     0      0        0 br-lan
default         192.168.1.2     0.0.0.0         UG    0      0        0 br-lan
root@OpenWrt:~# cat /etc/config/network

config &#039;switch&#039; &#039;eth0&#039;
        option &#039;vlan0&#039; &#039;0 1 2 3 4 5*&#039;
        option &#039;vlan1&#039; &#039;4 5&#039;

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;ifname&#039; &#039;eth0.0 eth0.1&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;gateway&#039; &#039;192.168.1.2&#039;
        option &#039;dns&#039; &#039; 192.168.1.2&#039;

root@OpenWrt:~# ping -c 4 -s 32 -4 192.168.1.26
PING 192.168.1.26 (192.168.1.26): 32 data bytes
40 bytes from 192.168.1.26: seq=0 ttl=128 time=1.243 ms
40 bytes from 192.168.1.26: seq=1 ttl=128 time=1.294 ms
40 bytes from 192.168.1.26: seq=2 ttl=128 time=1.296 ms
40 bytes from 192.168.1.26: seq=3 ttl=128 time=1.157 ms

--- 192.168.1.26 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max = 1.157/1.247/1.296 ms
root@OpenWrt:~# ping -c 4 -s 32 -4 192.168.1.1
PING 192.168.1.1 (192.168.1.1): 32 data bytes
40 bytes from 192.168.1.1: seq=0 ttl=64 time=1.444 ms
40 bytes from 192.168.1.1: seq=1 ttl=64 time=1.152 ms
40 bytes from 192.168.1.1: seq=2 ttl=64 time=1.155 ms
40 bytes from 192.168.1.1: seq=3 ttl=64 time=1.150 ms

--- 192.168.1.1 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max = 1.150/1.225/1.444 ms
root@OpenWrt:~# ping -c 4 -s 32 -4 192.168.1.2
PING 192.168.1.2 (192.168.1.2): 32 data bytes

--- 192.168.1.2 ping statistics ---
4 packets transmitted, 0 packets received, 100% packet loss
root@OpenWrt:~#</code></pre></div><p>Note, the router is pinging firstly my PC (pings OK), then itself (pings OK), then the DIR-615 (ping timeout)<br />Note, on my PC under a CMD window the PC can successfully ping the DIR-615 and <a href="http://www.google.co.uk">www.google.co.uk</a> as can be seen below</p><div class="codebox"><pre><code>C:\Users\Parents&gt;ping 192.168.1.1

Pinging 192.168.1.1 with 32 bytes of data:
Reply from 192.168.1.1: bytes=32 time&lt;1ms TTL=64
Reply from 192.168.1.1: bytes=32 time&lt;1ms TTL=64
Reply from 192.168.1.1: bytes=32 time&lt;1ms TTL=64
Reply from 192.168.1.1: bytes=32 time&lt;1ms TTL=64

Ping statistics for 192.168.1.1:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms

C:\Users\Parents&gt;ping 192.168.1.2

Pinging 192.168.1.2 with 32 bytes of data:
Reply from 192.168.1.2: bytes=32 time&lt;1ms TTL=64
Reply from 192.168.1.2: bytes=32 time&lt;1ms TTL=64
Reply from 192.168.1.2: bytes=32 time&lt;1ms TTL=64
Reply from 192.168.1.2: bytes=32 time&lt;1ms TTL=64

Ping statistics for 192.168.1.2:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms

C:\Users\Parents&gt;ping www.google.co.uk

Pinging www-tmmdi.l.google.com [66.102.9.105] with 32 bytes of data:
Reply from 66.102.9.105: bytes=32 time=63ms TTL=51
Reply from 66.102.9.105: bytes=32 time=46ms TTL=51
Reply from 66.102.9.105: bytes=32 time=54ms TTL=51
Reply from 66.102.9.105: bytes=32 time=51ms TTL=51

Ping statistics for 66.102.9.105:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 46ms, Maximum = 63ms, Average = 53ms

C:\Users\Parents&gt;ipconfig/all

Windows IP Configuration

   Host Name . . . . . . . . . . . . : Win7-PC
   Primary Dns Suffix  . . . . . . . :
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : &lt;removed&gt;

Ethernet adapter Local Area Connection:

   Connection-specific DNS Suffix  . : &lt;removed&gt;
   Description . . . . . . . . . . . : NVIDIA nForce Networking Controller
   Physical Address. . . . . . . . . : &lt;removed&gt;
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 192.168.1.26(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Lease Obtained. . . . . . . . . . : 08 May 2010 12:26:23
   Lease Expires . . . . . . . . . . : 15 May 2010 13:45:50
   Default Gateway . . . . . . . . . : 192.168.1.2
   DHCP Server . . . . . . . . . . . : 192.168.1.2
   DNS Servers . . . . . . . . . . . : 192.168.1.2
   NetBIOS over Tcpip. . . . . . . . : Enabled

C:\Users\Parents&gt;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108888">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">DarrenD</div>
					<div class="post-datetime">
						11 May 2010, 02:09					</div>
				</div>
				<div class="post-content content">
					<p>Guys, firstly thanks for all your help. I have now found the solution...it was the DIR-615 all the time!<br />I just happened to be in the web-pages for the DIR-615 (wireless router) and I noticed the log file with some strange entries in it. I cleared the log file and then tried to ping 192.168.1.2 (the DIR-615) from my OpenWRT router. As before I got a timeout, however, in the DIR-615 log file I found the entry...</p><div class="codebox"><pre><code>Drop ICMP packet from LAN (src:192.168.1.1:, dst:192.168.1.2:) by MAC filter rule.</code></pre></div><p>So I disabled the MAC filtering (this lists all allowed PCs, my PC and my daughters&#039; laptops which get kicked off the LAN late at night). When it was disabled I could ping 192.168.1.2 from my OpenWRT router. Also rebooting the OpenWRT router got me the correct time again. Result.</p><p>Turning the MAC filtering back on I get back to my no ping problem. This time, trying to ping <a href="http://www.google.co.uk">www.google.co.uk</a> I got different log entries...</p><div class="codebox"><pre><code>Drop UDP packet from LAN (src:192.168.1.1:56135, dst:192.168.1.2:53) by MAC filter rule.</code></pre></div><p>I suppose the UDP packets are because I used <a href="http://www.google.co.uk">www.google.co.uk</a> rather than 192.168.1.2 (which drops ICMP packets).</p><p>Anyway, the problem is not with OpenWRT but my DIR-615 router. After a little bit of thought I realised what I had done wrong. I had not put the MAC address of the OpenWRT router into the list of allowed PCs for the DIR-615 MAC filtering. I had not appreciated this because I originally populated the MAC list from computer names identifier via DHCP. As the OpenWRT had been setup with a static IP address it never appeared in the list of computer names. Simply putting the OpenWRT&#039;s MAC address into the list fixed everything. I found the MAC address of the OpenWRT router via the command &quot;ifconfig&quot;.</p><p>Thanks for all your efforts guys. Hopefully someone else might find this solution useful.<br />Sorry for my incompetence<br />Darren</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>