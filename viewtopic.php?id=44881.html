<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Getting errors when installing software!</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p205327">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">zzz2002</div>
					<div class="post-datetime">
						22 Jun 2013, 14:57					</div>
				</div>
				<div class="post-content content">
					<p>I am getting errors when installing software, does not matter if I use opkg directly or through LuCI.<br />I have opened a ticket, but does anybody know of a work around/fix?</p><div class="codebox"><pre><code>Configuring kmod-sched-core.
Configuring kmod-ipt-conntrack-extra.
Configuring kmod-sched-connmark.
Configuring kmod-lib-textsearch.
Configuring kmod-ipt-filter.
Configuring kmod-iptunnel4.
Configuring kmod-sit.
Configuring tc.
Configuring kmod-ifb.
Configuring iptables-mod-filter.
Configuring kmod-ipt-ipopt.
Configuring iptables-mod-ipopt.
Configuring iptables-mod-conntrack-extra.
Configuring qos-scripts.
Configuring luci-app-qos.

//usr/lib/opkg/info/kmod-sched-core.postinst: line 4: load_modules: not found
//usr/lib/opkg/info/kmod-ipt-conntrack-extra.postinst: line 4: load_modules: not found
//usr/lib/opkg/info/kmod-sched-connmark.postinst: line 4: load_modules: not found
//usr/lib/opkg/info/kmod-lib-textsearch.postinst: line 4: load_modules: not found
//usr/lib/opkg/info/kmod-ipt-filter.postinst: line 4: load_modules: not found
//usr/lib/opkg/info/kmod-iptunnel4.postinst: line 4: load_modules: not found
//usr/lib/opkg/info/kmod-sit.postinst: line 4: load_modules: not found
//usr/lib/opkg/info/kmod-ifb.postinst: line 4: load_modules: not found
//usr/lib/opkg/info/kmod-ipt-ipopt.postinst: line 4: load_modules: not found
Collected errors:
 * pkg_run_script: package &quot;kmod-sched-core&quot; postinst script returned status 127.
 * opkg_configure: kmod-sched-core.postinst returned 127.
 * pkg_run_script: package &quot;kmod-ipt-conntrack-extra&quot; postinst script returned status 127.
 * opkg_configure: kmod-ipt-conntrack-extra.postinst returned 127.
 * pkg_run_script: package &quot;kmod-sched-connmark&quot; postinst script returned status 127.
 * opkg_configure: kmod-sched-connmark.postinst returned 127.
 * pkg_run_script: package &quot;kmod-lib-textsearch&quot; postinst script returned status 127.
 * opkg_configure: kmod-lib-textsearch.postinst returned 127.
 * pkg_run_script: package &quot;kmod-ipt-filter&quot; postinst script returned status 127.
 * opkg_configure: kmod-ipt-filter.postinst returned 127.
 * pkg_run_script: package &quot;kmod-iptunnel4&quot; postinst script returned status 127.
 * opkg_configure: kmod-iptunnel4.postinst returned 127.
 * pkg_run_script: package &quot;kmod-sit&quot; postinst script returned status 127.
 * opkg_configure: kmod-sit.postinst returned 127.
 * pkg_run_script: package &quot;kmod-ifb&quot; postinst script returned status 127.
 * opkg_configure: kmod-ifb.postinst returned 127.
 * pkg_run_script: package &quot;kmod-ipt-ipopt&quot; postinst script returned status 127.
 * opkg_configure: kmod-ipt-ipopt.postinst returned 127.</code></pre></div>											<p class="post-edited">(Last edited by <strong>zzz2002</strong> on 22 Jun 2013, 14:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205332">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						22 Jun 2013, 15:57					</div>
				</div>
				<div class="post-content content">
					<p>Try<br /></p><div class="codebox"><pre><code>echo &quot;load_modules() { :; }&quot; &gt;&gt; /lib/functions.sh</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205414">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">zzz2002</div>
					<div class="post-datetime">
						23 Jun 2013, 17:06					</div>
				</div>
				<div class="post-content content">
					<p>OK did that! Different error but still not working.<br />The results below</p><div class="codebox"><pre><code>//usr/lib/opkg/info/kmod-sched-core.postinst: line 4: {:: not found
//usr/lib/opkg/info/kmod-ipt-conntrack-extra.postinst: line 4: {:: not found
//usr/lib/opkg/info/kmod-sched-connmark.postinst: line 4: {:: not found
//usr/lib/opkg/info/kmod-lib-textsearch.postinst: line 4: {:: not found
//usr/lib/opkg/info/kmod-ipt-filter.postinst: line 4: {:: not found
//usr/lib/opkg/info/kmod-iptunnel4.postinst: line 4: {:: not found
//usr/lib/opkg/info/kmod-sit.postinst: line 4: {:: not found
//usr/lib/opkg/info/kmod-ifb.postinst: line 4: {:: not found
//usr/lib/opkg/info/kmod-ipt-ipopt.postinst: line 4: {:: not found
Collected errors:
 * pkg_run_script: package &quot;kmod-sched-core&quot; postinst script returned status 127.
 * opkg_configure: kmod-sched-core.postinst returned 127.
 * pkg_run_script: package &quot;kmod-ipt-conntrack-extra&quot; postinst script returned status 127.
 * opkg_configure: kmod-ipt-conntrack-extra.postinst returned 127.
 * pkg_run_script: package &quot;kmod-sched-connmark&quot; postinst script returned status 127.
 * opkg_configure: kmod-sched-connmark.postinst returned 127.
 * pkg_run_script: package &quot;kmod-lib-textsearch&quot; postinst script returned status 127.
 * opkg_configure: kmod-lib-textsearch.postinst returned 127.
 * pkg_run_script: package &quot;kmod-ipt-filter&quot; postinst script returned status 127.
 * opkg_configure: kmod-ipt-filter.postinst returned 127.
 * pkg_run_script: package &quot;kmod-iptunnel4&quot; postinst script returned status 127.
 * opkg_configure: kmod-iptunnel4.postinst returned 127.
 * pkg_run_script: package &quot;kmod-sit&quot; postinst script returned status 127.
 * opkg_configure: kmod-sit.postinst returned 127.
 * pkg_run_script: package &quot;kmod-ifb&quot; postinst script returned status 127.
 * opkg_configure: kmod-ifb.postinst returned 127.
 * pkg_run_script: package &quot;kmod-ipt-ipopt&quot; postinst script returned status 127.
 * opkg_configure: kmod-ipt-ipopt.postinst returned 127.</code></pre></div>											<p class="post-edited">(Last edited by <strong>zzz2002</strong> on 23 Jun 2013, 17:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205424">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						23 Jun 2013, 19:40					</div>
				</div>
				<div class="post-content content">
					<p>Looks to me like you copied the command wrongly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205466">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">pdinoto</div>
					<div class="post-datetime">
						24 Jun 2013, 05:35					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I had the same error when installing &quot;multiwan&quot; package in r37008.</p><p>The actual packages that fail are dependencies of multiwan: <br />&nbsp; iptables-mod-conntrack-extra and<br />&nbsp; iptables-mod-ipopt</p><p>Adding that line to the /lib/functions.sh does avoid that error, and allow the package to install.</p><p>Thanks a lot,<br />///Pablo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205596">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">zzz2002</div>
					<div class="post-datetime">
						25 Jun 2013, 02:21					</div>
				</div>
				<div class="post-content content">
					<p>Here is my functions.sh</p><div class="codebox"><pre><code>#!/bin/sh
# Copyright (C) 2006-2013 OpenWrt.org
# Copyright (C) 2006 Fokus Fraunhofer &lt;carsten.tittel@fokus.fraunhofer.de&gt;
# Copyright (C) 2010 Vertical Communications


debug () {
    ${DEBUG:-:} &quot;$@&quot;
}

# newline
N=&quot;
&quot;

_C=0
NO_EXPORT=1
LOAD_STATE=1
LIST_SEP=&quot; &quot;

hotplug_dev() {
    env -i ACTION=$1 INTERFACE=$2 /sbin/hotplug-call net
}

append() {
    local var=&quot;$1&quot;
    local value=&quot;$2&quot;
    local sep=&quot;${3:- }&quot;

    eval &quot;export ${NO_EXPORT:+-n} -- \&quot;$var=\${$var:+\${$var}\${value:+\$sep}}\$value\&quot;&quot;
}

list_contains() {
    local var=&quot;$1&quot;
    local str=&quot;$2&quot;
    local val

    eval &quot;val=\&quot; \${$var} \&quot;&quot;
    [ &quot;${val%% $str *}&quot; != &quot;$val&quot; ]
}

list_remove() {
    local var=&quot;$1&quot;
    local remove=&quot;$2&quot;
    local val

    eval &quot;val=\&quot; \${$var} \&quot;&quot;
    val1=&quot;${val%% $remove *}&quot;
    [ &quot;$val1&quot; = &quot;$val&quot; ] &amp;&amp; return
    val2=&quot;${val##* $remove }&quot;
    [ &quot;$val2&quot; = &quot;$val&quot; ] &amp;&amp; return
    val=&quot;${val1## } ${val2%% }&quot;
    val=&quot;${val%% }&quot;
    eval &quot;export ${NO_EXPORT:+-n} -- \&quot;$var=\$val\&quot;&quot;
}

config_load() {
    [ -n &quot;$IPKG_INSTROOT&quot; ] &amp;&amp; return 0
    uci_load &quot;$@&quot;
}

reset_cb() {
    config_cb() { return 0; }
    option_cb() { return 0; }
    list_cb() { return 0; }
}
reset_cb

package() {
    return 0
}

config () {
    local cfgtype=&quot;$1&quot;
    local name=&quot;$2&quot;

    export ${NO_EXPORT:+-n} CONFIG_NUM_SECTIONS=$(($CONFIG_NUM_SECTIONS + 1))
    name=&quot;${name:-cfg$CONFIG_NUM_SECTIONS}&quot;
    append CONFIG_SECTIONS &quot;$name&quot;
    [ -n &quot;$NO_CALLBACK&quot; ] || config_cb &quot;$cfgtype&quot; &quot;$name&quot;
    export ${NO_EXPORT:+-n} CONFIG_SECTION=&quot;$name&quot;
    export ${NO_EXPORT:+-n} &quot;CONFIG_${CONFIG_SECTION}_TYPE=$cfgtype&quot;
}

option () {
    local varname=&quot;$1&quot;; shift
    local value=&quot;$*&quot;

    export ${NO_EXPORT:+-n} &quot;CONFIG_${CONFIG_SECTION}_${varname}=$value&quot;
    [ -n &quot;$NO_CALLBACK&quot; ] || option_cb &quot;$varname&quot; &quot;$*&quot;
}

list() {
    local varname=&quot;$1&quot;; shift
    local value=&quot;$*&quot;
    local len

    config_get len &quot;$CONFIG_SECTION&quot; &quot;${varname}_LENGTH&quot; 0
    [ $len = 0 ] &amp;&amp; append CONFIG_LIST_STATE &quot;${CONFIG_SECTION}_${varname}&quot;
    len=$(($len + 1))
    config_set &quot;$CONFIG_SECTION&quot; &quot;${varname}_ITEM$len&quot; &quot;$value&quot;
    config_set &quot;$CONFIG_SECTION&quot; &quot;${varname}_LENGTH&quot; &quot;$len&quot;
    append &quot;CONFIG_${CONFIG_SECTION}_${varname}&quot; &quot;$value&quot; &quot;$LIST_SEP&quot;
    list_cb &quot;$varname&quot; &quot;$*&quot;
}

config_rename() {
    local OLD=&quot;$1&quot;
    local NEW=&quot;$2&quot;
    local oldvar
    local newvar

    [ -n &quot;$OLD&quot; -a -n &quot;$NEW&quot; ] || return
    for oldvar in `set | grep ^CONFIG_${OLD}_ | \
        sed -e &#039;s/\(.*\)=.*$/\1/&#039;` ; do
        newvar=&quot;CONFIG_${NEW}_${oldvar##CONFIG_${OLD}_}&quot;
        eval &quot;export ${NO_EXPORT:+-n} \&quot;$newvar=\${$oldvar}\&quot;&quot;
        unset &quot;$oldvar&quot;
    done
    export ${NO_EXPORT:+-n} CONFIG_SECTIONS=&quot;$(echo &quot; $CONFIG_SECTIONS &quot; | sed -e &quot;s, $OLD , $NEW ,&quot;)&quot;

    [ &quot;$CONFIG_SECTION&quot; = &quot;$OLD&quot; ] &amp;&amp; export ${NO_EXPORT:+-n} CONFIG_SECTION=&quot;$NEW&quot;
}

config_unset() {
    config_set &quot;$1&quot; &quot;$2&quot; &quot;&quot;
}

config_clear() {
    local SECTION=&quot;$1&quot;
    local oldvar

    list_remove CONFIG_SECTIONS &quot;$SECTION&quot;
    export ${NO_EXPORT:+-n} CONFIG_SECTIONS=&quot;${SECTION:+$CONFIG_SECTIONS}&quot;

    for oldvar in `set | grep ^CONFIG_${SECTION:+${SECTION}_} | \
        sed -e &#039;s/\(.*\)=.*$/\1/&#039;` ; do
        unset $oldvar
    done
}

# config_get &lt;variable&gt; &lt;section&gt; &lt;option&gt; [&lt;default&gt;]
# config_get &lt;section&gt; &lt;option&gt;
config_get() {
    case &quot;$3&quot; in
        &quot;&quot;) eval echo &quot;\${CONFIG_${1}_${2}:-\${4}}&quot;;;
        *)  eval export ${NO_EXPORT:+-n} -- &quot;${1}=\${CONFIG_${2}_${3}:-\${4}}&quot;;;
    esac
}

# config_get_bool &lt;variable&gt; &lt;section&gt; &lt;option&gt; [&lt;default&gt;]
config_get_bool() {
    local _tmp
    config_get _tmp &quot;$2&quot; &quot;$3&quot; &quot;$4&quot;
    case &quot;$_tmp&quot; in
        1|on|true|enabled) _tmp=1;;
        0|off|false|disabled) _tmp=0;;
        *) _tmp=&quot;$4&quot;;;
    esac
    export ${NO_EXPORT:+-n} &quot;$1=$_tmp&quot;
}

config_set() {
    local section=&quot;$1&quot;
    local option=&quot;$2&quot;
    local value=&quot;$3&quot;
    local old_section=&quot;$CONFIG_SECTION&quot;

    CONFIG_SECTION=&quot;$section&quot;
    option &quot;$option&quot; &quot;$value&quot;
    CONFIG_SECTION=&quot;$old_section&quot;
}

config_foreach() {
    local ___function=&quot;$1&quot;
    [ &quot;$#&quot; -ge 1 ] &amp;&amp; shift
    local ___type=&quot;$1&quot;
    [ &quot;$#&quot; -ge 1 ] &amp;&amp; shift
    local section cfgtype

    [ -z &quot;$CONFIG_SECTIONS&quot; ] &amp;&amp; return 0
    for section in ${CONFIG_SECTIONS}; do
        config_get cfgtype &quot;$section&quot; TYPE
        [ -n &quot;$___type&quot; -a &quot;x$cfgtype&quot; != &quot;x$___type&quot; ] &amp;&amp; continue
        eval &quot;$___function \&quot;\$section\&quot; \&quot;\$@\&quot;&quot;
    done
}

config_list_foreach() {
    [ &quot;$#&quot; -ge 3 ] || return 0
    local section=&quot;$1&quot;; shift
    local option=&quot;$1&quot;; shift
    local function=&quot;$1&quot;; shift
    local val
    local len
    local c=1

    config_get len &quot;${section}&quot; &quot;${option}_LENGTH&quot;
    [ -z &quot;$len&quot; ] &amp;&amp; return 0
    while [ $c -le &quot;$len&quot; ]; do
        config_get val &quot;${section}&quot; &quot;${option}_ITEM$c&quot;
        eval &quot;$function \&quot;\$val\&quot; \&quot;\$@\&quot;&quot;
        c=&quot;$(($c + 1))&quot;
    done
}

include() {
    local file

    for file in $(ls $1/*.sh 2&gt;/dev/null); do
        . $file
    done
}

find_mtd_index() {
    local PART=&quot;$(grep &quot;\&quot;$1\&quot;&quot; /proc/mtd | awk -F: &#039;{print $1}&#039;)&quot;
    local INDEX=&quot;${PART##mtd}&quot;

    echo ${INDEX}
}

find_mtd_part() {
    local INDEX=$(find_mtd_index &quot;$1&quot;)
    local PREFIX=/dev/mtdblock

    [ -d /dev/mtdblock ] &amp;&amp; PREFIX=/dev/mtdblock/
    echo &quot;${INDEX:+$PREFIX$INDEX}&quot;
}

find_mtd_chardev() {
    local INDEX=$(find_mtd_index &quot;$1&quot;)
    local PREFIX=/dev/mtd

    [ -d /dev/mtd ] &amp;&amp; PREFIX=/dev/mtd/
    echo &quot;${INDEX:+$PREFIX$INDEX}&quot;
}

mtd_get_mac_ascii()
{
    local mtdname=&quot;$1&quot;
    local key=&quot;$2&quot;
    local part
    local mac_dirty

    . /lib/functions.sh

    part=$(find_mtd_part &quot;$mtdname&quot;)
    if [ -z &quot;$part&quot; ]; then
        echo &quot;mtd_get_mac_ascii: partition $mtdname not found!&quot; &gt;&amp;2
        return
    fi

    mac_dirty=$(strings &quot;$part&quot; | sed -n &#039;s/&#039;&quot;$key&quot;&#039;=//p&#039;)
    # &quot;canonicalize&quot; mac
    printf &quot;%02x:%02x:%02x:%02x:%02x:%02x&quot; 0x${mac_dirty//:/ 0x}
}

mtd_get_mac_binary() {
    local mtdname=&quot;$1&quot;
    local offset=&quot;$2&quot;
    local part

    part=$(find_mtd_part &quot;$mtdname&quot;)
    if [ -z &quot;$part&quot; ]; then
        echo &quot;mtd_get_mac_binary: partition $mtdname not found!&quot; &gt;&amp;2
        return
    fi

    dd bs=1 skip=$offset count=6 if=$part 2&gt;/dev/null | hexdump -v -n 6 -e &#039;5/1 &quot;%02x:&quot; 1/1 &quot;%02x&quot;&#039;
}

macaddr_add() {
    local mac=$1
    local val=$2
    local oui=${mac%:*:*:*}
    local nic=${mac#*:*:*:}

    nic=$(printf &quot;%06x&quot; $((0x${nic//:/} + $val &amp; 0xffffff)) | sed &#039;s/^\(.\{2\}\)\(.\{2\}\)\(.\{2\}\)/\1:\2:\3/&#039;)
    echo $oui:$nic
}

macaddr_setbit_la()
{
    local mac=$1

    printf &quot;%02x:%s&quot; $((0x${mac%%:*} | 0x02)) ${mac#*:}
}

macaddr_2bin()
{
    local mac=$1

    echo -ne \\x${mac//:/\\x}
}

strtok() { # &lt;string&gt; { &lt;variable&gt; [&lt;separator&gt;] ... }
    local tmp
    local val=&quot;$1&quot;
    local count=0

    shift

    while [ $# -gt 1 ]; do
        tmp=&quot;${val%%$2*}&quot;

        [ &quot;$tmp&quot; = &quot;$val&quot; ] &amp;&amp; break

        val=&quot;${val#$tmp$2}&quot;

        export ${NO_EXPORT:+-n} &quot;$1=$tmp&quot;; count=$((count+1))
        shift 2
    done

    if [ $# -gt 0 -a -n &quot;$val&quot; ]; then
        export ${NO_EXPORT:+-n} &quot;$1=$val&quot;; count=$((count+1))
    fi

    return $count
}


jffs2_mark_erase() {
    local part=&quot;$(find_mtd_part &quot;$1&quot;)&quot;
    [ -z &quot;$part&quot; ] &amp;&amp; {
        echo Partition not found.
        return 1
    }
    echo -e &quot;\xde\xad\xc0\xde&quot; | mtd -qq write - &quot;$1&quot;
}

uci_apply_defaults() {
    cd /etc/uci-defaults || return 0
    files=&quot;$(ls)&quot;
    [ -z &quot;$files&quot; ] &amp;&amp; return 0
    mkdir -p /tmp/.uci
    for file in $files; do
        ( . &quot;./$(basename $file)&quot; ) &amp;&amp; rm -f &quot;$file&quot;
    done
    uci commit
}

group_add() {
    local name=&quot;$1&quot;
    local gid=&quot;$2&quot;
    local rc
    [ -f &quot;${IPKG_INSTROOT}/etc/group&quot; ] || return 1
    [ -n &quot;$IPKG_INSTROOT&quot; ] || lock /var/lock/group
    echo &quot;${name}:x:${gid}:&quot; &gt;&gt; ${IPKG_INSTROOT}/etc/group
    rc=$?
    [ -n &quot;$IPKG_INSTROOT&quot; ] || lock -u /var/lock/group
    return $rc
}

group_exists() {
    grep -qs &quot;^${1}:&quot; ${IPKG_INSTROOT}/etc/group
}

user_add() {
    local name=&quot;${1}&quot;
    local uid=&quot;${2}&quot;
    local gid=&quot;${3:-$2}&quot;
    local desc=&quot;${4:-$1}&quot;
    local home=&quot;${5:-/var/run/$1}&quot;
    local shell=&quot;${6:-/bin/false}&quot;
    local rc
    [ -f &quot;${IPKG_INSTROOT}/etc/passwd&quot; ] || return 1
    [ -n &quot;$IPKG_INSTROOT&quot; ] || lock /var/lock/passwd
    echo &quot;${name}:x:${uid}:${gid}:${desc}:${home}:${shell}&quot; &gt;&gt; ${IPKG_INSTROOT}/etc/passwd
    echo &quot;${name}:x:0:0:99999:7:::&quot; &gt;&gt; ${IPKG_INSTROOT}/etc/shadow
    rc=$?
    [ -n &quot;$IPKG_INSTROOT&quot; ] || lock -u /var/lock/passwd
    return $rc
}

user_exists() {
    grep -qs &quot;^${1}:&quot; ${IPKG_INSTROOT}/etc/passwd
}


pi_include() {
    if [ -f &quot;/tmp/overlay/$1&quot; ]; then
        . &quot;/tmp/overlay/$1&quot;
    elif [ -f &quot;$1&quot; ]; then
        . &quot;$1&quot;
    elif [ -d &quot;/tmp/overlay/$1&quot; ]; then
        if [ -n &quot;$(ls /tmp/overlay/$1/*.sh 2&gt;/dev/null)&quot; ]; then
            for src_script in /tmp/overlay/$1/*.sh; do
                . &quot;$src_script&quot;
            done
        fi
    elif [ -d &quot;$1&quot; ]; then
        if [ -n &quot;$(ls $1/*.sh 2&gt;/dev/null)&quot; ]; then
            for src_script in $1/*.sh; do
                . &quot;$src_script&quot;
            done
        fi
    else
        echo &quot;WARNING: $1 not found&quot;
        return 1
    fi
    return 0
}

boot_hook_splice_start() {
    export -n PI_HOOK_SPLICE=1
}

boot_hook_splice_finish() {
    local hook
    for hook in $PI_STACK_LIST; do
        local v; eval &quot;v=\${${hook}_splice:+\$${hook}_splice }$hook&quot;
        export -n &quot;${hook}=${v% }&quot;
        export -n &quot;${hook}_splice=&quot;
    done
    export -n PI_HOOK_SPLICE=
}

boot_hook_init() {
    local hook=&quot;${1}_hook&quot;
    export -n &quot;PI_STACK_LIST=${PI_STACK_LIST:+$PI_STACK_LIST }$hook&quot;
    export -n &quot;$hook=&quot;
}

boot_hook_add() {
    local hook=&quot;${1}_hook${PI_HOOK_SPLICE:+_splice}&quot;
    local func=&quot;${2}&quot;

    [ -n &quot;$func&quot; ] &amp;&amp; {
        local v; eval &quot;v=\$$hook&quot;
        export -n &quot;$hook=${v:+$v }$func&quot;
    }
}

boot_hook_shift() {
    local hook=&quot;${1}_hook&quot;
    local rvar=&quot;${2}&quot;

    local v; eval &quot;v=\$$hook&quot;
    [ -n &quot;$v&quot; ] &amp;&amp; {
        local first=&quot;${v%% *}&quot;

        [ &quot;$v&quot; != &quot;${v#* }&quot; ] &amp;&amp; \
            export -n &quot;$hook=${v#* }&quot; || \
            export -n &quot;$hook=&quot;

        export -n &quot;$rvar=$first&quot;
        return 0
    }

    return 1
}

boot_run_hook() {
    local hook=&quot;$1&quot;
    local func

    while boot_hook_shift &quot;$hook&quot; func; do
        local ran; eval &quot;ran=\$PI_RAN_$func&quot;
        [ -n &quot;$ran&quot; ] || {
            export -n &quot;PI_RAN_$func=1&quot;
            $func &quot;$1&quot; &quot;$2&quot;
        }
    done
}

jffs2_ready() {
    mtdpart=&quot;$(find_mtd_part rootfs_data)&quot;
    [ -z &quot;$mtdpart&quot; ] &amp;&amp; return 1
    magic=$(hexdump $mtdpart -n 4 -e &#039;4/1 &quot;%02x&quot;&#039;)
    [ &quot;$magic&quot; != &quot;deadc0de&quot; ]
}

dupe() { # &lt;new_root&gt; &lt;old_root&gt;
    cd $1
    echo -n &quot;creating directories... &quot;
    {
        cd $2
        find . -xdev -type d
        echo &quot;./dev ./overlay ./mnt ./proc ./tmp&quot;
        # xdev skips mounted directories
        cd $1
    } | xargs mkdir -p
    echo &quot;done&quot;

    echo -n &quot;setting up symlinks... &quot;
    for file in $(cd $2; find . -xdev -type f;); do
        case &quot;$file&quot; in
        ./rom/note) ;; #nothing
        ./etc/config*|\
        ./usr/lib/opkg/info/*) cp -af $2/$file $file;;
        *) ln -sf /rom/${file#./*} $file;;
        esac
    done
    for file in $(cd $2; find . -xdev -type l;); do
        cp -af $2/${file#./*} $file
    done
    echo &quot;done&quot;
}

pivot() { # &lt;new_root&gt; &lt;old_root&gt;
    mount -o noatime,move /proc $1/proc &amp;&amp; \
    pivot_root $1 $1$2 &amp;&amp; {
        mount -o noatime,move $2/dev /dev
        mount -o noatime,move $2/tmp /tmp
        mount -o noatime,move $2/sys /sys 2&gt;&amp;-
        mount -o noatime,move $2/overlay /overlay 2&gt;&amp;-
        return 0
    }
}

fopivot() { # &lt;rw_root&gt; &lt;ro_root&gt; &lt;dupe?&gt;
    root=$1
    {
        if grep -q overlay /proc/filesystems; then
            mount -o noatime,lowerdir=/,upperdir=$1 -t overlayfs &quot;overlayfs:$1&quot; /mnt &amp;&amp; root=/mnt
        elif grep -q mini_fo /proc/filesystems; then
            mount -t mini_fo -o noatime,base=/,sto=$1 &quot;mini_fo:$1&quot; /mnt 2&gt;&amp;- &amp;&amp; root=/mnt
        else
            mount --bind -o noatime / /mnt
            mount --bind -o noatime,union &quot;$1&quot; /mnt &amp;&amp; root=/mnt
        fi
    } || {
        [ &quot;$3&quot; = &quot;1&quot; ] &amp;&amp; {
        mount | grep &quot;on $1 type&quot; 2&gt;&amp;- 1&gt;&amp;- || mount -o noatime,bind $1 $1
        dupe $1 $rom
        }
    }
    pivot $root $2
}

ramoverlay() {
    mkdir -p /tmp/root
    mount -t tmpfs -o noatime,mode=0755 root /tmp/root
    fopivot /tmp/root /rom 1
}

[ -z &quot;$IPKG_INSTROOT&quot; -a -f /lib/config/uci.sh ] &amp;&amp; . /lib/config/uci.sh
load_modules() {:;}</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205608">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">pdinoto</div>
					<div class="post-datetime">
						25 Jun 2013, 04:55					</div>
				</div>
				<div class="post-content content">
					<p>I am not an expert in bash scripting, but in my opinion the lack of space surrounding the { and } is causing the error.<br />Try to add spaces to leave the empty function :; separated from the curly braces.</p><p>By the way, I already have MultiWan3 working thanks to that change.</p><p>Hope this help!<br />///Pablo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205703">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">zzz2002</div>
					<div class="post-datetime">
						26 Jun 2013, 06:16					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, I missed the &quot;spaces&quot; amazing what nothing will do.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p322893">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">imic</div>
					<div class="post-datetime">
						7 May 2016, 18:24					</div>
				</div>
				<div class="post-content content">
					<p>This hadn&#039;t helped me, but this helps:<br />Copy function &quot;default_postinst()&quot;&nbsp; from trunk or 15.05.1 (as I did) to /lib/functions.sh on your router.<br />It looks like it&#039;s better to make this in advance, cause otherwise some files mentioned in &lt;package_name&gt;.ipk/control/postinst-pkg could not be copied and you will have to do it manualy (keeping access rights for them as they were in package), afterthat &quot;opkg configure&quot; works without errors.</p><p>P.S. Altough opkg errors gone away (e.g. for adblock and luci-app-adblock), I&#039;m not confident that this is the right way for old | nontrunk firmware (in my case 12.09 ramips)</p><div class="codebox"><pre><code>default_postinst() {
    local pkgname rusers
    pkgname=$(basename ${1%.*})
    rusers=$(grep &quot;Require-User:&quot; ${IPKG_INSTROOT}/usr/lib/opkg/info/${pkgname}.control)
    [ -n &quot;$rusers&quot; ] &amp;&amp; {
        local user group uid gid
        for a in $(echo $rusers | sed &quot;s/Require-User://g&quot;); do
            user=&quot;&quot;
            group=&quot;&quot;
            for b in $(echo $a | sed &quot;s/:/ /g&quot;); do
                local ugname ugid

                ugname=$(echo $b | cut -d= -f1)
                ugid=$(echo $b | cut -d= -f2)

                [ -z &quot;$user&quot; ] &amp;&amp; {
                    user=$ugname
                    uid=$ugid
                    continue
                }

                gid=$ugid
                [ -n &quot;$gid&quot; ] &amp;&amp; {
                    group_exists $ugname || group_add $ugname $gid
                }

                [ -z &quot;$gid&quot; ] &amp;&amp; {
                    group_add_next $ugname
                    gid=$?
                }

                [ -z &quot;$group&quot; ] &amp;&amp; {
                    user_exists $user || user_add $user &quot;$uid&quot; $gid
                    group=$ugname
                    continue
                }

                group_add_user $ugname $user
            done
        done
    }

    [ -f ${IPKG_INSTROOT}/usr/lib/opkg/info/${pkgname}.postinst-pkg ] &amp;&amp; ( . ${IPKG_INSTROOT}/usr/lib/opkg/info/${pkgname}.postinst-pkg )
    [ -n &quot;${IPKG_INSTROOT}&quot; ] || rm -f /tmp/luci-indexcache 2&gt;/dev/null

    [ &quot;$PKG_UPGRADE&quot; = &quot;1&quot; ] || for i in `cat ${IPKG_INSTROOT}/usr/lib/opkg/info/${pkgname}.list | grep &quot;^/etc/init.d/&quot;`; do
        [ -n &quot;${IPKG_INSTROOT}&quot; ] &amp;&amp; $(which bash) ${IPKG_INSTROOT}/etc/rc.common ${IPKG_INSTROOT}$i enable; \
        [ -n &quot;${IPKG_INSTROOT}&quot; ] || {
            $i enable
            $i start
        }
    done
    return 0
}</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>