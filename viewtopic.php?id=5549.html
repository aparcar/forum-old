<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SD Card Mod - The Definitive Guide (for v2.2 hardware)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p26468">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Toril</div>
					<div class="post-datetime">
						3 May 2006, 04:00					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I&#039;ve had a 2nd WRT54G (v2.2) for quite some time with the SD Card mod done... and it&#039;s perfect.&nbsp; I&#039;ve tested all the connection points, and with a multimeter, and with the gpio utility.&nbsp; I still get errors ... at this point, this isn&#039;t one of those &quot;I don&#039;t know what I&#039;ve done worng someone please help me&quot; posts.&nbsp; </p><p> I want input from people who&#039;ve successfully done it.&nbsp; And with specifics.&nbsp; After doing some research, I think my manufacturer of SD card might be at fault.&nbsp; </p><p> Here&#039;s my details:</p><p> - I ordered two of the SD sockets from sparkfun.&nbsp; They&#039;re great.&nbsp; I mounted the SD card inside the top of the case, with velcro.&nbsp; I&#039;m not concerned with external access as I want to leave it in there as a &quot;mini hard drive&quot; for the router.</p><p> - I used cat5 wire because it&#039;s small and thin ... it can support up to 48v (POE anyone?) so I know it can handle 3.3v that the gpio pins use.&nbsp; I&#039;ve also verified voltages with a multimeter.</p><p> - I have a 128 meg Sandisk SD card (one of the blue &amp; orange ones I believe).&nbsp; Some research has led me to believe that the manufacturer of the card is important.&nbsp; Someone actually said these don&#039;t work so well.&nbsp; I have a 512 meg &quot;kingsmax&quot; in a pda of mine, and a 1 gig &quot;trancsend&quot; on order (for $20, check out the deal, while supplies last: <a href="http://www.newegg.com/Product/Product.asp?Item=N82E16820208042">http://www.newegg.com/Product/Product.a … 6820208042</a> )&nbsp; I&#039;ve also heard the larger chips have multiple partitions, which may cause issues.&nbsp; I also have another Sandisk (blue) transflash, 128meg but I feel this may be identical to the first one I have anyhow.</p><p> - I chose ext2 as my filesystem instead of vfat.&nbsp; I understand the logic, plug the SD card in, it&#039;s default filesystem is fat32, and it will work.&nbsp; But seeing as my main workstation is linux, it was easier and more convenient for me to use ext2.&nbsp; And I have that module.&nbsp; Besides, the errors I&#039;m getting are from the driver... a lower level than the filesystem.</p><p>- I&#039;ve also tried different variants of the module source code.&nbsp; I have the toolchain installed on my main linux workstation.&nbsp; I&#039;ve been trying to get this mod done for the last few rc revisions of OpenWRT!</p><p> I&#039;m an experienced sys admin with a background in electronics as well.&nbsp; (Coincidentally, my wife was also into electronics, she&#039;s doublechecked my work in our basement workshop).&nbsp; I&#039;d just like to know other people&#039;s success stories ... revision of hardware, manufacturer of SD card and size, and filesystem type.&nbsp; Any quirky details would be appreciated as well.&nbsp; If anything else, you&#039;ve made it farther than I have, so brag!&nbsp; I&#039;m sure eventually someone will mention something, and it will cause me to stumble upon what my real issue is. </p><p> Even if you have a different revision of hardware, put your info here, if you could.&nbsp; I may run out and buy a new revision of the router ... I&#039;ve been (trying) to do this since v2.2&#039;s were the newest thing!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26483">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">gunni</div>
					<div class="post-datetime">
						3 May 2006, 17:02					</div>
				</div>
				<div class="post-content content">
					<p>Did youe even try fat as filesystem, so that you can be shure its not the reason?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26486">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">minus1</div>
					<div class="post-datetime">
						3 May 2006, 17:36					</div>
				</div>
				<div class="post-content content">
					<p>What are the errors that you get?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26518">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">TemplaraPhoenix</div>
					<div class="post-datetime">
						4 May 2006, 09:31					</div>
				</div>
				<div class="post-content content">
					<p>I did mine with a V1.0 WRT54GS. I used the ribbon cable from an IDE drive, though I&#039;m sure CAT5 would work as well. If you have access to an oscilloscope, try debugging your soldering with that. Originally I didn&#039;t solder my connections well enough (the V1.0 GS requires a number of tricky solder points) and was getting good results on my multimeter (0V then 3.3V), but poor results when using an oscilloscope (i.e. the square wave was too rounded and there was interference due to unwanted line capacitance). It took a couples of times before I got good clean waveforms, even though the soldering looked almost identical on the surface, it had different electrical properties. This is most likely your source of error.</p><p>I also used an SD kit, from The Workbench, <a href="http://www.compsys1.com/workbench/On_top_of_the_Bench/MMC_Project/mmc_project.html">http://www.compsys1.com/workbench/On_to … oject.html</a> , the MMSD9K which is basically an SD card slot, a PCB so I could use IDC 0.1&quot; pins to interface it to the WRT and some pullup resistors. Maybe for some cards the pullup resistors are more necessary than others or they help limit signal noise? I know many people have done this mod without them, so in most cases they shouldn&#039;t be needed. I know I get 250KB/s transfer rates, slightly higher than most, this may be due to my combined testing and the resistors. </p><p>Also, read this thread <a href="http://forum.openwrt.org/viewtopic.php?id=2475">http://forum.openwrt.org/viewtopic.php?id=2475</a> . Its rather long, but in there (second page) is some modified mmc.c driver code that waits longer than normal for the card to register. Some bigger/ slower cards need the driver to wait longer before being detected. This is a known issue and card specific. If you think your connection is perfect, but have a bad card, this may help. There is also a speedier driver hack, which you way want to play with later. These, however, will probably require you to have the buildroot system setup on another Linux box, its helpful to have anyway to compile things for your OpenWRT system. I changed the GPIO assignments on mine to make connection easier and so it won&#039;t mess with any LEDs, so I had to use buildroot. Buildroot is a 1.7 MB download of scripts which will install roughly 1.5GB of files when done making the OpenWRT images, so make sure you have room if you need to do this.</p><p>As far as multiple partitions, etc. I doubt that has anything to do with your problem. I&#039;m assuming that you don&#039;t see something like:</p><p>mmc Hardware init<br />mmc Card init<br />mmc Card init *1*<br />Size = 1006080, hardsectsize = 512, sectors = 2012160<br />mmca: p1 p2 </p><p>when you insmod mcc and check dmesg | tail.&nbsp; (Note: the following is just an example from the thread, your message will probably be somewhat different)</p><p>vs the following when it doesn&#039;t work:</p><p>mmc Hardware init<br />mmc Card init<br />mmc Card init *1*<br />mmc Card init<br />mmc Card init *1*<br />mmc: error in mmc_card_init (2)<br />mmc: error in mmc_init (-1)</p><p>Either that or you may be trying to mount /dev/mmc/disc0/part0? I have a 1GB SanDisk SD that detects two partitions, part1 is the fat32 one, I don&#039;t know what part0 is, but assume it is some low-level I/O partition or some other system partition. As far as multiple partitions for larger cards, I also have a couple 4GB TOPRAM SDs and I can have the same 2 partition scheme as on my 1GB, the part0 (which is system) and part1 which is roughly 4GB fat32. If your driver is working, but mount isn&#039;t, try reformatting in fat32 as previously suggested.</p><p>Sorry for being long, hope I was of some help.</p>											<p class="post-edited">(Last edited by <strong>TemplaraPhoenix</strong> on 4 May 2006, 09:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p43611">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dj50459</div>
					<div class="post-datetime">
						3 Mar 2007, 12:06					</div>
				</div>
				<div class="post-content content">
					<p>hi i have a problem to format sd card through embedded linux<br />can any body knows a solution to it</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>