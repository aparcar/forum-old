<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Cannot access Internet in a Mesh</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 12 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p20115">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">little_indian</div>
					<div class="post-datetime">
						3 Feb 2006, 13:20					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><br /><p>I am runninng&nbsp; olsr on openwrt rc4 with WEP every things on lan works firm there are about 4 WRT nodes and 20 computers can easily connect to it and play multiplayer games etc.</p><p>But the main is none can access the internet only one main node (node_1) connects to the internet via WAN port <br />the router connecting to the internet that is node one can ping to the internet sites etc and also all the computers connected can ping to the wan port ip address.<br />But none of the computers can connect to the internet <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> .</p><p>I have disabled firewall.</p><p>Below is some relevnt data do tell me if any other info is required :-</p><br /><p>&nbsp; &nbsp;1.<br />&nbsp; &nbsp; &nbsp; -------------------------------------------------------<br />&nbsp; &nbsp;2.<br />&nbsp; &nbsp; &nbsp; IPTABLES<br />&nbsp; &nbsp;3.<br />&nbsp; &nbsp; &nbsp; -------------------------------------------------------<br />&nbsp; &nbsp;4.</p><div class="codebox"><pre><code>       
   5.
       
   6.
      root@Node_1:/# iptables -t nat -L
   7.
      Chain PREROUTING (policy ACCEPT)
   8.
      target     prot opt source               destination
   9.
       
  10.
      Chain POSTROUTING (policy ACCEPT)
  11.
      target     prot opt source               destination
  12.
       
  13.
      Chain OUTPUT (policy ACCEPT)
  14.
      target     prot opt source               destination
  15.
       
  16.
       
  17.</code></pre></div><p>18.<br />&nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 19.<br />&nbsp; &nbsp; &nbsp; -------------------------------------------------------------------<br />&nbsp; 20.<br />&nbsp; &nbsp; &nbsp; FROM THE ROUTER<br />&nbsp; 21.<br />&nbsp; &nbsp; &nbsp; -------------------------------------------------------------------<br />&nbsp; 22.<br />&nbsp; &nbsp;<br /></p><div class="codebox"><pre><code>    
  23.
      root@Node_1:/# ping www.google.com
  24.
      PING www.l.google.com (66.102.7.147): 56 data bytes
  25.
      64 bytes from 66.102.7.147: icmp_seq=0 ttl=237 time=258.1 ms
  26.
      64 bytes from 66.102.7.147: icmp_seq=1 ttl=237 time=260.2 ms
  27.
      64 bytes from 66.102.7.147: icmp_seq=2 ttl=237 time=286.0 ms
  28.
      64 bytes from 66.102.7.147: icmp_seq=3 ttl=237 time=258.3 ms
  29.
      64 bytes from 66.102.7.147: icmp_seq=4 ttl=237 time=258.7 ms
  30.
       
  31.
      --- www.l.google.com ping statistics ---
  32.
      5 packets transmitted, 5 packets received, 0% packet loss
  33.
      round-trip min/avg/max = 258.1/264.2/286.0 ms
  34.
      root@Node_1:/# ping 192.168.20.131
  35.
      PING 192.168.20.131 (192.168.20.131): 56 data bytes
  36.
      64 bytes from 192.168.20.131: icmp_seq=0 ttl=128 time=3.9 ms
  37.
      64 bytes from 192.168.20.131: icmp_seq=1 ttl=128 time=1.5 ms
  38.
      64 bytes from 192.168.20.131: icmp_seq=2 ttl=128 time=1.4 ms
  39.
      64 bytes from 192.168.20.131: icmp_seq=3 ttl=128 time=2.0 ms
  40.
      64 bytes from 192.168.20.131: icmp_seq=4 ttl=128 time=1.8 ms
  41.
       
  42.
      --- 192.168.20.131 ping statistics ---
  43.
      5 packets transmitted, 5 packets received, 0% packet loss
  44.
       
  45.
       
  46.</code></pre></div><p>47.<br />&nbsp; &nbsp; &nbsp; --------------------------------------------------------------------<br />&nbsp; 48.<br />&nbsp; &nbsp; &nbsp; FROM MY COMPUTER<br />&nbsp; 49.<br />&nbsp; &nbsp; &nbsp; --------------------------------------------------------------------<br />&nbsp; 50.</p><div class="codebox"><pre><code>       
  51.
      C:\Documents and Settings\Comp17&gt;ping www.google.com
  52.
       
  53.
      Pinging www.l.google.com [66.102.7.147] with 32 bytes of data:
  54.
       
  55.
      Request timed out.
  56.
       
  57.
      Ping statistics for 66.102.7.147:
  58.
          Packets: Sent = 1, Received = 0, Lost = 1 (100% loss),
  59.
       
  60.
       
  61.
      C:\Documents and Settings\Comp17&gt;ping 192.168.20.1
  62.
       
  63.
      Pinging 192.168.20.1 with 32 bytes of data:
  64.
       
  65.
      Reply from 192.168.20.1: bytes=32 time=4ms TTL=63
  66.
      Reply from 192.168.20.1: bytes=32 time=3ms TTL=63
  67.
      Reply from 192.168.20.1: bytes=32 time=3ms TTL=63
  68.
       
  69.
      Ping statistics for 192.168.20.1:
  70.
          Packets: Sent = 3, Received = 3, Lost = 0 (0% loss),
  71.
      Approximate round trip times in milli-seconds:
  72.
          Minimum = 3ms, Maximum = 4ms, Average = 3ms
  73.
       
  74.      ------------------------------------------------------------</code></pre></div><p>ROUTEs</p><div class="codebox"><pre><code>root@Node_1:/# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.20.0    0.0.0.0         255.255.255.0   U     0      0        0 eth1
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 vlan0
60.254.58.0     0.0.0.0         255.255.254.0   U     0      0        0 vlan1
0.0.0.0         60.254.58.1     0.0.0.0         UG    0      0        0 vlan1
0.0.0.0         192.168.1.1     0.0.0.0         UG    0      0        0 vlan0</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20121">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">little_indian</div>
					<div class="post-datetime">
						3 Feb 2006, 14:56					</div>
				</div>
				<div class="post-content content">
					<p>Ok that last route was worng so i removed it and now the new route table is :</p><div class="codebox"><pre><code>root@Node_1:/# route -n
Kernel IP routing table
Destination      Gateway         Genmask         Flags    Metric Ref    Use Iface
192.168.20.0    0.0.0.0         255.255.255.0   U           0      0        0    eth1
192.168.1.0      0.0.0.0         255.255.255.0   U           0      0        0    vlan0
60.254.58.0      0.0.0.0         255.255.254.0   U           0      0        0    vlan1
0.0.0.0           60.254.58.1    0.0.0.0             UG         0      0         0   vlan1</code></pre></div><p>Still i cant connect to the internet nor ping to the gateway ip 60.254.58.1 form my computer.<br />while things are fine with router.<br />I am using DHCP ip for computer</p>											<p class="post-edited">(Last edited by <strong>little_indian</strong> on 3 Feb 2006, 15:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20122">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jochen</div>
					<div class="post-datetime">
						3 Feb 2006, 15:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>little_indian wrote:</cite><blockquote><p>But none of the computers can connect to the internet <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> .</p><p>I have disabled firewall.</p></blockquote></div><p>This is a really bad idea. The firewall script also sets up the dynamic SNAT to your provider IP address which is absolutely required in your setup.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20250">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">little_indian</div>
					<div class="post-datetime">
						6 Feb 2006, 11:16					</div>
				</div>
				<div class="post-content content">
					<p>Oh now i have reset the route and done things all over again.firewall on dnsmasq on.</p><p>But i now can only access the internet when i have a wired connection to the node_1 which is the router with direct connection to internet.</p><p>Also i noticed that my internet stops working when i have seperated lan and wifi and&nbsp; olsr is not running else things are fine</p><p>nvram get lan_ifname<br />vlan0</p><p>nvram get wifi_ifname<br />eth1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20257">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jochen</div>
					<div class="post-datetime">
						6 Feb 2006, 13:48					</div>
				</div>
				<div class="post-content content">
					<p>If you seperate LAN from WIFI, you have to add some rules to /etc/firewall.user like:</p><div class="codebox"><pre><code>#!/bin/sh

WIFI=$(nvram get wifi_ifname)

iptables -A forwarding_rule -i $WIFI -o $WAN -j ACCEPT</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20346">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">little_indian</div>
					<div class="post-datetime">
						7 Feb 2006, 07:30					</div>
				</div>
				<div class="post-content content">
					<p>Hey Thanks jochen,</p><p>That really fixed the issue with node_1 now i am trying with node_2 (router) i guess something similar has to e done there too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20353">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">little_indian</div>
					<div class="post-datetime">
						7 Feb 2006, 09:33					</div>
				</div>
				<div class="post-content content">
					<p>If i add my Node_1 ipaddr as the gatway in the subsequent nodes then the subequent nodes can access the <br />internet.</p><p>But if olsr is running is this necessary shouldent the routes be auto configured?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148765">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">jackii</div>
					<div class="post-datetime">
						16 Nov 2011, 19:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jochen wrote:</cite><blockquote><div class="quotebox"><cite>little_indian wrote:</cite><blockquote><p>But none of the computers can connect to the internet <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> .</p><p>I have disabled firewall.</p></blockquote></div><p>This is a really bad idea. The firewall script also sets up the dynamic SNAT to your provider IP address which is absolutely required in your setup.</p></blockquote></div><p>oh man this post is really help full for us do it i also did it</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>