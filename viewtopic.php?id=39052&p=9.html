<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 9 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
						<div class="notice">
				<p>Sorry, posts 201 to 201 are missing from our archive.</p>
			</div>
		
		
		
			<article class="post" id="p199596">
				<div class="post-metadata">
					<div class="post-num">Post #202</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						25 Apr 2013, 11:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>What&#039;s the highest number that will be used for ip rules? I want the troubleshooting page to show them all. Is it 1020 or higher?</p></blockquote></div><p>IP rules 1001 till 1015 are used for the interfaces. Rules 1016 till 1127 are used for policies.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199603">
				<div class="post-metadata">
					<div class="post-num">Post #203</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						25 Apr 2013, 11:58					</div>
				</div>
				<div class="post-content content">
					<p>Adze, I need to write a script and need info on WAN status. Is checking the existence of 1001 and 1002 for WAN1 and WAN2 reliable? What would you suggest?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199605">
				<div class="post-metadata">
					<div class="post-num">Post #204</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						25 Apr 2013, 12:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Adze, I need to write a script and need info on WAN status. Is checking the existence of 1001 and 1002 for WAN1 and WAN2 reliable? What would you suggest?</p></blockquote></div><p>This is currently the only method of determining a link&#039;s status. It of course requires that the interface be configured with track IPs otherwise the ip rule will be permanently there regardless of link state.</p><p>I&#039;m working on a script for you...</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 25 Apr 2013, 15:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199626">
				<div class="post-metadata">
					<div class="post-num">Post #205</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						25 Apr 2013, 17:43					</div>
				</div>
				<div class="post-content content">
					<p>Arfett, wow thank you.. I actually had created a topic for this:</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=199593#p199593">https://forum.openwrt.org/viewtopic.php?pid=199593#p199593</a></p><p>I&#039;ve done some bash scripting and I was given some direction in that topic so I should be ok. Can&#039;t be that hard right? if grep 1001 echo up ELSE down. hehe.</p><p>Do work on completing the overview page primarily first! My WDR3600 should arrive tomorrow, so I hope to use the latest ui changes right away.. but of course you need not rush for me personally. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>My preliminary tests on 1043ND with mwan3 went well, so I&#039;ll setup the WDR3600 right away and immediately put it to production use.</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 25 Apr 2013, 17:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199627">
				<div class="post-metadata">
					<div class="post-num">Post #206</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						25 Apr 2013, 18:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Arfett, wow thank you.. I actually had created a topic for this:</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=199593#p199593">https://forum.openwrt.org/viewtopic.php?pid=199593#p199593</a></p><p>I&#039;ve done some bash scripting and I was given some direction in that topic so I should be ok. Can&#039;t be that hard right? if grep 1001 echo up ELSE down. hehe.</p><p>Do work on completing the overview page primarily first! My WDR3600 should arrive tomorrow, so I hope to use the latest ui changes right away.. but of course you need not rush for me personally. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>My preliminary tests on 1043ND with mwan3 went well, so I&#039;ll setup the WDR3600 right away and immediately put it to production use.</p></blockquote></div><p>This assumes your WAN interfaces are named wan1, wan2, ..., wan15</p><p>Replace INTERVAL, WANFIRST, WANLAST with your desired settings.<br/>You can easily change it so only offline WANs are entered into the RESULT variable. That way you can have the final if/then perform an action if offline WANS are detected.</p><div class="codebox"><pre><code>#!/bin/sh

# set your preferences here
INTERVAL=&quot;10&quot;
WANFIRST=&quot;1&quot;
WANLAST=&quot;15&quot;

# leave alone
[ &quot;$(echo &quot;$WANFIRST&quot; | wc -c)&quot; == &quot;2&quot; ] &amp;&amp; RULEFIRST=&quot;100$WANFIRST&quot; || RULEFIRST=&quot;10$WANFIRST&quot;
[ &quot;$(echo &quot;$WANLAST&quot; | wc -c)&quot; == &quot;2&quot; ] &amp;&amp; RULELAST=&quot;100$WANLAST&quot; || RULELAST=&quot;10$WANLAST&quot;

while true; do

    RESULT=&quot;&quot;
    WANF=&quot;$WANFIRST&quot;
    IPRULE=&quot;$(ip rule show | awk -F: &#039;{ print $1 }&#039; | awk -v R1=&quot;$RULEFIRST&quot; -v R2=&quot;$RULELAST&quot; &#039;$1&gt;=R1 &amp;&amp; $1&lt;=R2&#039;)&quot;

    # find any downed WANs
    if [ -n &quot;$IPRULE&quot; ]; then
        while [ &quot;$WANF&quot; -le &quot;$WANLAST&quot; ]; do
            # set rule number to search for
            if [ &quot;$(echo &quot;$WANF&quot; | wc -c)&quot; == &quot;2&quot; ]; then
                WANSRCH=&quot;100$WANF&quot;
            else
                WANSRCH=&quot;10$WANF&quot;
            fi

            # search for rule and mark any offline WANs
            if [ $(echo &quot;$IPRULE&quot; | grep -q &quot;$WANSRCH&quot;; echo $?) -eq 0 ]; then
                RESULT=&quot;&quot;$RESULT&quot; wan&quot;$WANF&quot;=online&quot; #comment this line to only record offline WANs
                let WANF++
            else
                RESULT=&quot;&quot;$RESULT&quot; wan&quot;$WANF&quot;=offline&quot;
                let WANF++
            fi
        done
    else
        # all WANs are down
        while [ &quot;$WANF&quot; -le &quot;$WANLAST&quot; ]; do
            RESULT=&quot;&quot;$RESULT&quot; wan$WANF=down&quot;
            let WANF++
        done
    fi

    if [ &quot;$RESULT&quot; ]; then
        # remove leading spaces and insert newlines
        RESULT=&quot;$(echo &quot;$RESULT&quot; | sed -e &#039;s/^[[:space:]]*//&#039; -e &#039;s/ /\n/g&#039;)&quot;
echo &quot;$RESULT&quot;
        # put whatever code you want to report online/offline interfaces here
        # variable RESULT stores the test results of configured search

    fi

    sleep &quot;$INTERVAL&quot;

done</code></pre></div>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 25 Apr 2013, 18:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199630">
				<div class="post-metadata">
					<div class="post-num">Post #207</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						25 Apr 2013, 18:25					</div>
				</div>
				<div class="post-content content">
					<p>OK thank you so much! Will give it a test tomorrow.</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 25 Apr 2013, 18:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199633">
				<div class="post-metadata">
					<div class="post-num">Post #208</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						25 Apr 2013, 18:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Arfett, wow thank you.. <br/>OK thank you so much! Will give it a test tomorrow.</p></blockquote></div><p>No prob. You think you could remove the code quote from your post to save some forum space and also I may throw a few modifications in the original post if others want to use it. Quotes don&#039;t update if the quoted material is changed.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 25 Apr 2013, 18:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199636">
				<div class="post-metadata">
					<div class="post-num">Post #209</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						25 Apr 2013, 19:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>What&#039;s the highest number that will be used for ip rules? I want the troubleshooting page to show them all. Is it 1020 or higher?</p></blockquote></div><p>IP rules 1001 till 1015 are used for the interfaces. Rules 1016 till 1127 are used for policies.</p></blockquote></div><p>Is there a maximum number of policies which can be created? If so I&#039;ll document on the GUI.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199649">
				<div class="post-metadata">
					<div class="post-num">Post #210</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						25 Apr 2013, 20:39					</div>
				</div>
				<div class="post-content content">
					<p>Thomymaster wrote:</p><p>&nbsp; &nbsp; -By the way, is there a possibility that if mwan3 switches to a fail-over connection (and later fail-back) to send me an email?</p><p>&nbsp; &nbsp; -Is there a possibility (i have a static ip for my main adsl line and an umts backup) to trigger a dyndns-client update once the connection is failed-over to umts?</p><p>&nbsp; &nbsp; Both solutions would be very great.</p><p>&nbsp; &nbsp; Cheers</p><p>&nbsp; &nbsp; Thomy</p><p>A quick fix: make a script in /etc/hotplug.d/iface to call your email/ddns app on certain interface up/down events.</p><br/><p>Hey guys</p><p>How do i accomplish this? This is very important for me, maybe there is also a way to integrate this into the UI (not into mwan3 i think this doesn&#039;t make sense)?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199657">
				<div class="post-metadata">
					<div class="post-num">Post #211</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						25 Apr 2013, 21:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>Thomymaster wrote:</p><p>&nbsp; &nbsp; -By the way, is there a possibility that if mwan3 switches to a fail-over connection (and later fail-back) to send me an email?</p><p>&nbsp; &nbsp; -Is there a possibility (i have a static ip for my main adsl line and an umts backup) to trigger a dyndns-client update once the connection is failed-over to umts?</p><p>&nbsp; &nbsp; Both solutions would be very great.</p><p>&nbsp; &nbsp; Cheers</p><p>&nbsp; &nbsp; Thomy</p><p>A quick fix: make a script in /etc/hotplug.d/iface to call your email/ddns app on certain interface up/down events.</p><br/><p>Hey guys</p><p>How do i accomplish this? This is very important for me, maybe there is also a way to integrate this into the UI (not into mwan3 i think this doesn&#039;t make sense)?</p></blockquote></div><p>I would imagine that in order to send out mail, sendmail must be installed. Since hotplug events trigger mwan3 scripts, then the mwan3 script could also be made to call other scripts. Here, we can see the possibility of arfett writing another tab in his luci-mwan3 to specify custom commands that links to the custom script file. so if a shell script could be written to show WAN status (which arfett has for me), we just need to call this each time mwan3 script is called... and all we must do is channel the output somewhere (email, file, ftp, whatever..). this could also help me in notification when a line goes up or down, although in my own manner</p><p>But then I&#039;m no professional in this, it could work, or it could otherwise simply be fantasy gibberish.</p><p>What do you think arfett/adze?</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 25 Apr 2013, 23:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199669">
				<div class="post-metadata">
					<div class="post-num">Post #212</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						26 Apr 2013, 00:45					</div>
				</div>
				<div class="post-content content">
					<p>Yes this approach would make very much sense. So a tab in the LuCi mwan3 config:</p><br/><p>- where you can specify one or more interfaces (like wan or wwan in my case)</p><p>and specify a script to call for each:</p><p>-interface goes up<br/>-interfaces goes down</p><p>or just one script which is invoked every time mwan3 script is started (in this case when something changes).</p><p>And this script will mail the output (i can take care of this myself).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199670">
				<div class="post-metadata">
					<div class="post-num">Post #213</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						26 Apr 2013, 00:47					</div>
				</div>
				<div class="post-content content">
					<p>Adze,<br/>Perhaps we could provide some links to some possibly useful scripts like the one I wrote last night in the OP? Not really offering support of course. There&#039;s a big wide forum for help with shell scripting.</p><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>What do you think arfett/adze?</p></blockquote></div><p>Sounds like a lot of work and user-error is abound. I&#039;d say this falls outside the scope of what I imagine Adze wants to get into and what I want to. Not that it would be difficult to add that.</p><p>I will be happy to give you a brief overview of making your own hotplug script. Also have you considered configuring a syslog server somewhere? OpenWRT has the option to send syslog data to a remote server on the System-&gt;System tab in the System Properties-&gt;Logging subtab.</p><p>I&#039;ll make an example hotplug script for you to use as a template.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199671">
				<div class="post-metadata">
					<div class="post-num">Post #214</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						26 Apr 2013, 00:50					</div>
				</div>
				<div class="post-content content">
					<p>Yes then please give me a template and ill try what i can do and post the results of course <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199672">
				<div class="post-metadata">
					<div class="post-num">Post #215</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						26 Apr 2013, 01:02					</div>
				</div>
				<div class="post-content content">
					<p>This is likely to be one of the last scripts I provide unless an interesting/challenging issue comes up. You guys should start learning from the plethora of examples how to make your own page/script modifications.</p><p>/etc/hotplug.d/iface/ has a lot of scripts to look at and it should be pretty clear what they are doing if you have any knowledge of shell scripting basics.</p><p>/usr/lib/lua/luci/controller/ and /usr/lib/lua/luci/model/cbi/ is where the LuCI files are stored. The controller file is like a general overview of what is going to go on the page and the cbi files are the actual values that go on. It shouldn&#039;t take you more than about 5 seconds to see how to add your own tab to the MWAN3 or any other page. Also just browse around the files for existing pages that already do what you want and you can sort of copy/paste and edit to do precisely what you want. This is how I got into making LuCI pages and eventually you might learn some LUA scripting which is pretty handy.</p><div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>Yes then please give me a template and ill try what i can do and post the results of course <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p></blockquote></div><div class="codebox"><pre><code>#!/bin/sh

# place in /etc/hotplug.d/iface and name 19-mymwancustom
# make executable with &#039;chmod +x 19-mymwancustom&#039;
#
# available variables:
# $ACTION is the hotplug event
# $INTERFACE is the interface name (wan1, wan2, etc.)
# $DEVICE the device name attached to the interface (eth0.1, eth1, etc.)

case &quot;$ACTION&quot; in
    ifup)
        # run this code or additional function added to this script
        # if any interface comes online

        # if you want to limit it to certain interfaces you can do
        #if [ &quot;$INTERFACE&quot; == &quot;wan1&quot; ]; then
            # run this code
        #fi
    ;;

    ifdown)
        # run this code or additional function added to this script
        # if any interface goes offline
    ;;
esac</code></pre></div>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 26 Apr 2013, 01:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199693">
				<div class="post-metadata">
					<div class="post-num">Post #216</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						26 Apr 2013, 09:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>This is likely to be one of the last scripts I provide unless an interesting/challenging issue comes up. You guys should start learning from the plethora of examples how to make your own page/script modifications.</p></blockquote></div><p>Yes but thank you for helping us here, I guess it&#039;s my inexperience and not knowing what/where to modify that puts me off. Then again that&#039;s every reason to begin learning.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199708">
				<div class="post-metadata">
					<div class="post-num">Post #217</div>
					<div class="post-author">frunzie</div>
					<div class="post-datetime">
						26 Apr 2013, 11:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>Thank You for great app. Working great on 2x 3g-wan&#039;s, well almost... My main goal is to direct all traffic thru 1st wan, and only dst_port 8080 thru 2nd wan, its working but when 1st wan disconnects, load is redirect to 2nd wan! Is it normal? </p><p>Please help</p>											<p class="post-edited">(Last edited by <strong>frunzie</strong> on 26 Apr 2013, 22:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199711">
				<div class="post-metadata">
					<div class="post-num">Post #218</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						26 Apr 2013, 11:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>frunzie wrote:</cite><blockquote><p>My main goal is to direct all traffic thru 1st wan, and only dst_port 8080 thru 2nd wan, its working but when 1st wan disconnects, load is redirect to 2nd wan! Is it normal?</p></blockquote></div><br/><p>Hi,</p><br/><p>Yes this is normal. As 1st wan is down and traffic can&#039;t be routed over 1st wan, the main routing table is used. As it still has an entry of second wan, it will route through 2nd wan. A sollution to this would be to add some firewall rules, or use the loopback route trick (explained in first post).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199715">
				<div class="post-metadata">
					<div class="post-num">Post #219</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						26 Apr 2013, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>Adze, I was wondering.. with regards to above, what would happen if the mwan3 script is re-written in a way that:</p><p>When hotplug is triggered (due to line up/down) .. instead of recreating ip rule show. (if we make 1001, 1002 permanent) and instead change mwan3_rules in iptables only: say (port 1234 route to wan2_pri_wan1_sec) to (wan1_only if wan2 dies)</p><p>Would it work?</p><p>Also, i&#039;d like to know - each time mwan3 script is called, is the entire iptables refreshed/restarted?</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 26 Apr 2013, 13:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199781">
				<div class="post-metadata">
					<div class="post-num">Post #220</div>
					<div class="post-author">mvilera</div>
					<div class="post-datetime">
						26 Apr 2013, 20:50					</div>
				</div>
				<div class="post-content content">
					<p>Hey there,</p><p>I&#039;m trying to configure my WR941ND to use 2 WANs and following this script walkthrough says that before installing this I should have both WANs working, i&#039;m new to openwrt/linux-like methods and sadly I have found a issue (probably easily resolved) that can&#039;t tackle myself, have been looking for this specific router help/guides about multiwan setups but information it&#039;s quite lackluster. </p><p>My brand new installed openwrt network config looks like this:</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fdf4:e59f:3b71::/48&#039;

config interface &#039;eth&#039;
        option ifname &#039;eth0&#039;
        option proto &#039;none&#039;

config interface &#039;lan&#039;
        option ifname &#039;lan1 lan2 lan3 lan4&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;

config interface &#039;wan&#039;
        option ifname &#039;wan&#039;
        option proto &#039;dhcp&#039;

config interface &#039;wan6&#039;
        option ifname &#039;@wan&#039;
        option proto &#039;dhcpv6&#039;</code></pre></div><p>As i have seen in most tutorials/guides I should separate my ports into several vlans in order to assign specific behaviours to this vlans, as WAN1, WAN2, etc.</p><p>What I don&#039;t understand on how to do with this router is that most guides calls &#039;option ports 1 2 3 4&#039; on vlans or eth0, and in this specific router this ports are binded directly to lan interface using ifname lan1 lan2 lan3 lan4. Don&#039;t know if i change this to &#039;option ports&#039; will brick my router, and since i lack any modding skill to attach a serial device, probably will not be able to recover it.</p><p>If anyone can guide me a bit through this to then proceed and install this script would be awesome, please excuse me for my poor spelling, my english is quite bad.</p><p>P.S: I created a topic about this <a href="https://forum.openwrt.org/viewtopic.php?id=43797,">https://forum.openwrt.org/viewtopic.php?id=43797,</a> and then after looking for an answer found this topic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199786">
				<div class="post-metadata">
					<div class="post-num">Post #221</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						26 Apr 2013, 21:20					</div>
				</div>
				<div class="post-content content">
					<p>where is your gateway metric? your config file is a bit strange to me though. but maybe you should read up on creating vlans.</p>											<p class="post-edited">(Last edited by <strong>biatche</strong> on 26 Apr 2013, 21:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199790">
				<div class="post-metadata">
					<div class="post-num">Post #222</div>
					<div class="post-author">mvilera</div>
					<div class="post-datetime">
						26 Apr 2013, 21:54					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>root@OpenWrt:/# ifconfig
br-lan    Link encap:Ethernet  HWaddr 90:F6:52:B0:0B:30
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fdf4:e59f:3b71::1/60 Scope:Global
          inet6 addr: fe80::92f6:52ff:feb0:b30/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:881645 errors:0 dropped:6899 overruns:0 frame:0
          TX packets:858336 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:211693242 (201.8 MiB)  TX bytes:599432279 (571.6 MiB)

eth0      Link encap:Ethernet  HWaddr 90:F6:52:B0:0B:30
          inet6 addr: fe80::92f6:52ff:feb0:b30/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1615264 errors:0 dropped:0 overruns:34 frame:0
          TX packets:1519874 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:821585025 (783.5 MiB)  TX bytes:656056834 (625.6 MiB)
          Interrupt:4

lan1      Link encap:Ethernet  HWaddr 90:F6:52:B0:0B:30
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

lan2      Link encap:Ethernet  HWaddr 90:F6:52:B0:0B:30
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

lan3      Link encap:Ethernet  HWaddr 90:F6:52:B0:0B:30
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:767744 errors:0 dropped:41 overruns:0 frame:0
          TX packets:717328 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:203269053 (193.8 MiB)  TX bytes:434848148 (414.7 MiB)

lan4      Link encap:Ethernet  HWaddr 90:F6:52:B0:0B:30
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:757 errors:0 dropped:0 overruns:0 frame:0
          TX packets:757 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:118227 (115.4 KiB)  TX bytes:118227 (115.4 KiB)

wan       Link encap:Ethernet  HWaddr 90:F6:52:B0:0B:30
          inet addr:1xx.xxx.xxx.xxx  Bcast:1xx.xxx.xxx.xxx  Mask:255.255.224.0
          inet6 addr: fe80::92f6:52ff:feb0:b30/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:847519 errors:0 dropped:0 overruns:0 frame:0
          TX packets:802538 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:589241160 (561.9 MiB)  TX bytes:210721323 (200.9 MiB)

wlan0     Link encap:Ethernet  HWaddr 90:F6:52:B0:0B:30
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:156808 errors:0 dropped:0 overruns:0 frame:0
          TX packets:225949 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:19622032 (18.7 MiB)  TX bytes:181538436 (173.1 MiB)</code></pre></div><p>This is my ifconfig output, not sure if you refer to this text.</p><p>I have readed that creating vlans on this router is a bit different, they should be defined in a startup file, i&#039;ll look for it when arrive home, but still have the same issue regarding my network config structure.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199791">
				<div class="post-metadata">
					<div class="post-num">Post #223</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						26 Apr 2013, 21:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>frunzie wrote:</cite><blockquote><p>my configs:</p></blockquote></div><p>That is a mess to read. Can you please edit your post and change it to the output of &#039;cat /etc/config/mwan3&#039;</p><p>And no it is not normal the traffic should be blackholed if a rule matching the traffic can not be used. Only traffic which no rule matches falls through to the main routing table.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 26 Apr 2013, 22:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199793">
				<div class="post-metadata">
					<div class="post-num">Post #224</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						26 Apr 2013, 22:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mvilera wrote:</cite><blockquote><p>I have readed that creating vlans on this router is a bit different, they should be defined in a startup file, i&#039;ll look for it when arrive home, but still have the same issue regarding my network config structure.</p></blockquote></div><p>If you want to let me take a peek at this over teamviewer I&#039;ll see what I can do.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199794">
				<div class="post-metadata">
					<div class="post-num">Post #225</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						26 Apr 2013, 22:11					</div>
				</div>
				<div class="post-content content">
					<p>First step is to get your WAN&#039;s running without mwan3. If you read the first post, you&#039;ll need to be able to &quot;ping -I WAN_interface whatever_ip&quot;. Without this, there&#039;s no use proceeding to mwan3. And if you can&#039;t get your WAN&#039;s up because of lack of VLAN, then you need to find a way to create those VLANs</p><p>Im no expert here but that&#039;s what I would do.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 9 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>