<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN Server / Client on OpenWRT ???</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p52465">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">noelbou</div>
					<div class="post-datetime">
						17 Jul 2007, 21:14					</div>
				</div>
				<div class="post-content content">
					<p>Hello All,</p><p>Following on my experiments to setup an openVPN Server and client on 2 OpenWrt routers.<br />Using Whiterussian 0.9 on WRT54GS and WRTSL54GS ...</p><p>The client now seems to connect to the Server but i am just unsure if it works properly ...<br />... using iptraf on the server side (WRTSL54GS) i see that no data seems to transit on the tap0 interface ...<br />but strangely the data transitioning on eth2 (wlan on WRTSL54GS) seem to go trough tap0 (the packet counts match in iptraf)<br />.. and there is no tun0 interface displayed on the client although the log and Status / OpenVPN webif page show it&#039;s there)</p><p>Also the log on the server show that the openVPN seems to restart (inactivity timer) every 2 minutes and then the server side seems to <br />disconnect (?):</p><p>+----------------------------------------------------------------+</p><p>Server traces:</p><p>Jul 17 13:43:19 (none) kern.notice openvpn[2140]: OpenVPN 2.0.9 mipsel-linux [SSL] [LZO] [EPOLL] built on Feb 13 2007<br />Jul 17 13:43:19 (none) kern.warn openvpn[2140]: WARNING: file &#039;/etc/openvpn/shared.key&#039; is group or others accessible<br />Jul 17 13:43:19 (none) kern.notice openvpn[2140]: Static Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 17 13:43:19 (none) kern.notice openvpn[2140]: Static Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 17 13:43:19 (none) kern.notice openvpn[2140]: Static Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 17 13:43:19 (none) kern.notice openvpn[2140]: Static Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 17 13:43:19 (none) kern.notice openvpn[2140]: TUN/TAP device tap0 opened<br />Jul 17 13:43:19 (none) kern.notice openvpn[2140]: Data Channel MTU parms [ L:1576 D:1450 EF:44 EB:4 ET:32 EL:0 ]<br />Jul 17 13:43:19 (none) kern.notice openvpn[2140]: Local Options hash (VER=V4): &#039;8b888ddc&#039;<br />Jul 17 13:43:19 (none) kern.notice openvpn[2140]: Expected Remote Options hash (VER=V4): &#039;8b888ddc&#039;<br />Jul 17 13:43:19 (none) kern.notice openvpn[2148]: UDPv4 link local (bound): [undef]:1194<br />Jul 17 13:43:19 (none) kern.notice openvpn[2148]: UDPv4 link remote: [undef]<br />Jul 17 13:43:53 (none) kern.notice openvpn[2148]: Peer Connection Initiated with 66.36.152.25:1031<br />Jul 17 13:43:53 (none) kern.notice openvpn[2148]: Initialization Sequence Completed<br /> ... 2 minutes after (</p><p>Jul 17 13:45:55 (none) kern.notice openvpn[2148]: Inactivity timeout (--ping-restart), restarting<br />Jul 17 13:45:55 (none) kern.notice openvpn[2148]: TCP/UDP: Closing socket<br />Jul 17 13:45:55 (none) kern.notice openvpn[2148]: Closing TUN/TAP interface<br />Jul 17 13:45:55 (none) kern.notice openvpn[2148]: SIGUSR1[soft,ping-restart] received, process restarting<br />Jul 17 13:45:55 (none) kern.notice openvpn[2148]: Restart pause, 2 second(s)<br />...<br />Jul 17 13:45:55 (none) kern.notice openvpn[2148]: UDPv4 link local (bound): [undef]:1194<br />Jul 17 13:45:55 (none) kern.notice openvpn[2148]: UDPv4 link remote: [undef]</p><br /><p>Also the tap0 interface show (almost) no packets received ...<br />tap0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:FF:56:FA:12:85<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING PROMISC MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:11 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:929 errors:0 dropped:15 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:100<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:198 (198.0 B)&nbsp; TX bytes:262697 (256.5 KiB)</p><p>Client:</p><p>Jul 17 13:34:44 (none) kern.notice openvpn[2122]: OpenVPN 2.0.9 mipsel-linux [SSL] [LZO] [EPOLL] built on Feb 13 2007<br />Jul 17 13:34:44 (none) kern.warn openvpn[2122]: WARNING: file &#039;/etc/openvpn/shared.key&#039; is group or others accessible<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: Static Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: Static Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: Static Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: Static Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: LZO compression initialized<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: TUN/TAP device tun0 opened<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: Data Channel MTU parms [ L:1545 D:1450 EF:45 EB:135 ET:0 EL:0 AF:3/1 ]<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: Local Options hash (VER=V4): &#039;62cf4b05&#039;<br />Jul 17 13:34:44 (none) kern.notice openvpn[2122]: Expected Remote Options hash (VER=V4): &#039;62cf4b05&#039;<br />Jul 17 13:34:44 (none) kern.notice openvpn[2128]: UDPv4 link local: [undef]<br />Jul 17 13:34:44 (none) kern.notice openvpn[2128]: UDPv4 link remote: 216.239.76.188:1194</p><br /><p>and the client tun0 interface (via webif Status / OpenVPN or or cat /proc/net/dev) shows all zeros ... </p><p>tun0&nbsp; &nbsp; &nbsp; Link encap:UNSPEC&nbsp; HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; POINTOPOINT NOARP MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:100 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>+------------------------------------------------------------------------------------+</p><p>relevant Configs:<br />Server:</p><p>/etc/openvpn/server.ovpn</p><p>keepalive 10 120<br />comp-lzo<br />persist-key<br />persist-tun<br />status /tmp/openvpn-status.log<br />verb 3<br />#Static Key<br />secret /etc/openvpn/shared.key</p><p>I have the openvpnbridge file in /etc/openvpn set as in the OpenVPN Server Howto ... <a href="http://wiki.openwrt.org/OpenVPNHowTo?highlight=%28HowTo%29">http://wiki.openwrt.org/OpenVPNHowTo?hi â€¦ 28HowTo%29</a><br />I have added the entries to the firewall script for the tap / tun interface (as in howto).</p><p>Client:<br />root@OpenWrt:~$ nvram show | grep openvpn | sort<br />size: 8864 bytes (23904 left)<br />openvpn_cli=1<br />openvpn_cli_auth=psk<br />openvpn_cli_port=1194<br />openvpn_cli_proto=udp<br />openvpn_cli_server=&lt;my-openvpn-server&gt;.dyndns.org</p><p>+---------------------------------------------+</p><p>Questions ?</p><p>1 - I setup properly, all trafic in between client / server should got trough the tap0 / tun0 inteface.&nbsp; Right ???<br />... and be displayed by iptraf under the tap0 interface (right ?)</p><p>2- Why no tun0 interface displays on client with ifconfig ? (bug ?)</p><p>3- Anyone has succesfully setup an openVPN client server between 2 openWRT ystems ?</p><p>It would be nice if we could setup the openVPN as a server trough the Webif2 interface ... It currently only support <br />openVPN client config. </p><p>Any help would be appreciated ...</p><p>Noel</p>											<p class="post-edited">(Last edited by <strong>noelbou</strong> on 17 Jul 2007, 21:17)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>