<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-LINK WDR4300 ( wan speed problems on BB and CC ) ok on AA</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 12 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p289029">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ygor.almeida</div>
					<div class="post-datetime">
						24 Aug 2015, 18:03					</div>
				</div>
				<div class="post-content content">
					<p>Hi Guys </p><p>I need some help, i got an TP-LINK WDR4300 to use on my home ( i&#039;m brazil with Vivo Fibra &quot;Optical fiber connection&quot;) with 200/100Mb plan ... ( about 50 dollars per month ) thats nice. </p><p>Because of the way they prepared the network is a PPPoE - with VLAN 10 to network, and 20 to IPTV ( that i don&#039;t have ) normally i should you their router - a bad dlink device. But i&#039;m lucky openwrt can replace it and everything should work well.</p><p>... I&#039;ve flashed AA 12.09 final build on my router, created the correct vlan - created the pppoe connection - and vualáaaa - its working ( playin on speedtest i have my connection with full capacity ) 200/100 - and that&#039;s great.</p><p>I just tried out the new builds to test and have all new patches and features ... using the BB 14.07 - from scratch ... when i test the speed test - i only get 110/100 - in CC 15.03 ( i&#039;ve tried custom patches from forum, the superwrt, the @mk13139 build, the RC3 ) i can get 125/100 ...</p><p>Even if i put original tp-link firmware ... malasian ( unify/maxifiber ) that supports vlan - i have 200/100 ...</p><p>I&#039;m not sure if it&#039;s a bug or not ... but WAN/LAN using BB,CC are half of the speed for me while checking against AA.</p><p>Didn&#039;t tried Gargoyle as no vlan ( gui on interface and didn&#039;t played with uci to create it ) but ... is this normal ?? </p><p>Can anyone help me ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289035">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						24 Aug 2015, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>Are you open to try my optimized builds?<br />Source is provided linked if you want to build it yourself.<br /><a href="https://forum.openwrt.org/viewtopic.php?id=45515">https://forum.openwrt.org/viewtopic.php?id=45515</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289037">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ygor.almeida</div>
					<div class="post-datetime">
						24 Aug 2015, 19:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>Are you open to try my optimized builds?<br />Source is provided linked if you want to build it yourself.<br /><a href="https://forum.openwrt.org/viewtopic.php?id=45515">https://forum.openwrt.org/viewtopic.php?id=45515</a></p></blockquote></div><p>I&#039;ve tried it also ... so far the best i can get it 150/100 with your build ... on 12.09 oficial i got the correct speed without problem.</p><p>I&#039;ve read something about Routing Cache Patch ... that BB and CC does not come with it ... </p><p>Does your builds come with it? can i have one to test !?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289052">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						24 Aug 2015, 21:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ygor.almeida wrote:</cite><blockquote><div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>Are you open to try my optimized builds?<br />Source is provided linked if you want to build it yourself.<br /><a href="https://forum.openwrt.org/viewtopic.php?id=45515">https://forum.openwrt.org/viewtopic.php?id=45515</a></p></blockquote></div><p>I&#039;ve tried it also ... so far the best i can get it 150/100 with your build ... on 12.09 oficial i got the correct speed without problem.</p><p>I&#039;ve read something about Routing Cache Patch ... that BB and CC does not come with it ... </p><p>Does your builds come with it? can i have one to test !?</p></blockquote></div><p>My BB has it but I don&#039;t think CC is stable enough for use has LuCI stability issues.<br />With or without SQM?<br />You can also overclock your router to boost performance, AR9344 can potentially hit 720MHZ.<br />Best to start with lower clock and raise it gradually.<br />Btw when testing your performance remember NOT TO OPEN LUCI.<br />Reason is that LuCI uses JavaScript, when the LuCI tries to update your web browser it contends for the use of the CPU hence Routing throughput is disrupted.</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 24 Aug 2015, 21:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289071">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">ygor.almeida</div>
					<div class="post-datetime">
						24 Aug 2015, 23:38					</div>
				</div>
				<div class="post-content content">
					<p>@ alphasparc</p><p>I will give another try soon ... on my office i&#039;m running it BB build from august 2015 - so far no problems ( with Cable Modem Docsis 3 - but there the speed is only 60/3 ) i&#039;m not sure if it&#039;s affected by this problem or not ... ( i need to do jperf test ... or bring it to house to test it ... )</p><p>Huuum, i&#039;ve tried to overclock ( at last i flashed <a href="https://github.com/gwlim/Openwrt_Firmware/blob/master/TP-Link_TL-WDR3500-3600-43XX-WM4350R/TP-Link_TL-WDR3500-3600-43XX-WM4350R_Overclock_Section/openwrt-ar71xx-generic-tl-wdr4300-v1-squashfs-factory_uboot_unlocked.bin">https://github.com/gwlim/Openwrt_Firmwa … locked.bin</a> ) </p><p>and then ...</p><div class="codebox"><pre><code>Find out which mtd partition is the u-boot partition:

root@OpenWrt:/tmp/uboot-work# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00020000 00010000 &quot;u-boot&quot;
Transfer the new U-Boot image to the device:

me@laptop:~# scp uboot_for_tp-link_tl-wdr3600-43x0_oc_600_450_225.bin root@192.168.1.1:/tmp/
uboot_for_tp-link_tl-wdr3600-43x0_oc_600_450_225.bin            100%   64KB  64.0KB/s   00:00

Take a backup of the current u-boot partition (mtd0):

root@OpenWrt:/tmp# dd if=/dev/mtd0 of=uboot_orig.bin
256+0 records in
256+0 records out

Transfer the backup off the device and to a safe place:

me@laptop:~# scp root@192.168.1.1:/tmp/uboot_orig.bin .
uboot_orig.bin                                100%  128KB 128.0KB/s   00:00

root@OpenWrt:/tmp# cp uboot_orig.bin uboot_new.bin
root@OpenWrt:/tmp# dd if=uboot_for_tp-link_tl-wdr3600-43x0_oc_600_450_225.bin of=uboot_new.bin conv=notrunc
128+0 records in
128+0 records out

Now, to actually flash the new image, run:

root@OpenWrt:/tmp# mtd write uboot_new.bin &quot;u-boot&quot;
Unlocking u-boot ...

Writing from uboot_new.bin to u-boot ...

To verify that the image was flashed correctly, you should verify it:

root@OpenWrt:/tmp# mtd verify uboot_new.bin &quot;u-boot&quot;
Verifying u-boot against uboot_new.bin ...
a80c3a8683345a3fb311555c5d4194c5 - u-boot
a80c3a8683345a3fb311555c5d4194c5 - uboot_new.bin
Success

To restart with the new bootloader, reboot the router:

root@OpenWrt:/tmp# reboot</code></pre></div><p>It fails while compare the <br />mtd verify uboot_new.bin &quot;u-boot&quot;<br />Verifying u-boot against uboot_new.bin ...<br />FAIL - cannot verify - wrong flash</p><p>... I&#039;m not sure what i did wrong ... but <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>btw, how to know if SQM is enable or not ... ( i think i&#039;m noob here ) </p><p>... I will add a fixed serial cable to deal with flash and test more things ... anyway my unit are different versions each other ... one is 1.1 the other 1.6 ( does it matter ?? )</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289204">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ygor.almeida</div>
					<div class="post-datetime">
						26 Aug 2015, 00:17					</div>
				</div>
				<div class="post-content content">
					<p>@alphasparc - would you mind to help me ??? - i will try to replicate the settings again this weekend ... and let you know what is the problem ok.</p><p>If you have any clue about overclock and uboot, ... thanks too</p>											<p class="post-edited">(Last edited by <strong>ygor.almeida</strong> on 26 Aug 2015, 00:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289216">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						26 Aug 2015, 03:09					</div>
				</div>
				<div class="post-content content">
					<p>That is the correct step never seen the cannot verify message before.<br />Just make sure the final uboot is your original uboot with the first half overwritten by the overclocked uboot</p><p>You can redo as many times as you want as long as you have the original uboot copy</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 26 Aug 2015, 03:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289768">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ygor.almeida</div>
					<div class="post-datetime">
						30 Aug 2015, 22:39					</div>
				</div>
				<div class="post-content content">
					<p>... And so ...</p><p>I&#039;ve tested yesterday my 4300 - with you last build BB again ( with luci closed ) and original uboot so far 150Mbp/s from wan to lan on speedtest.</p><p>Using the serial cable i&#039;ve manage to load the uboot with 680mhz ... again with your BB build, 178Mbp/s.</p><p>I&#039;ve reverted back to AA original with the same uboot with 680mhz ... and 237Mbp/s ( when it starts i can hit 380Mbp/s ).</p><p>The best result so far ... AA 12.09 with this uboot 680.</p><p>... but even using serial cable ( i&#039;ve killed the other 4300 snif snif snif ) i&#039;ve followed the same process i did on my first device, to load the uboot - everything looks fine, then i restart the device ( exactly like i did 1 hour before ) ... i have half blue leds very light ... and no console output nothing ... the unit is dead ( i will need rma somehow ) </p><p>Anyway don&#039;t know why but ... any other configuration different from AA 12.09 i loose half or more the speed from my ONT FTTH</p><p>FYI ... original malay fw from tp-link with vlan support also does hit 210 ~ 220Mpb/s when used as stock</p><p>... just to remember.</p><p>my isp needs vlan 10 and 20 ( 10 for pppoe ) ok ... and 20 ( i don&#039;t have and don&#039;t use for iptv ) </p><p>Anyclue !?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289825">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">vilpalu</div>
					<div class="post-datetime">
						31 Aug 2015, 09:54					</div>
				</div>
				<div class="post-content content">
					<p>stock firmware russian version has 802q support (if you intend to use tagged iptv). I have the same problem with speed. In some case I can hit only ~200Mbps. Without hw nat this device cant hit 200+mbps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289853">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ygor.almeida</div>
					<div class="post-datetime">
						31 Aug 2015, 16:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vilpalu wrote:</cite><blockquote><p>stock firmware russian version has 802q support (if you intend to use tagged iptv). I have the same problem with speed. In some case I can hit only ~200Mbps. Without hw nat this device cant hit 200+mbps.</p></blockquote></div><p>I don&#039;t have iptv yet ...</p><p>But stock or AA 12.09 - does give me the full power of the connection ( just like original ftth router ( a d-link modified unit ) ... but BB or CC half of the speed.</p><p>The question is ... what was changed in code for that ?? why ?! can&#039;t it be implemented on newer builds ??</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>