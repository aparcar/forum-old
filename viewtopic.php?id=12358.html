<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Support for Marvell 88F5xx81 based routers</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 18 Jan 2014 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 46</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p54998">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						3 Sep 2007, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>I <a href="http://forum.openwrt.org/viewtopic.php?id=11911">have a WRT350N v2</a> which is based on a Marvell 88F5181 SOC with an Atheros AR5008 for the wireless. <a href="http://www.linksysbycisco.com/EU/en/supportgplcode">GPL source</a> is available, and the same chip is used in the D-Link <a href="http://wiki.dns323.info/">DNS-323</a> which is a low-end NAS, and the <a href="http://www.vonwentzel.net/ABS/Dissection-Extreme-n/">Airport Extreme</a>. A slightly different chip is used in some Buffalo Linkstations, and the <a href="http://buffalo.nas-central.org/wiki/Buffalo_ARM9_Kernel_Port">community is working</a> to clean up the released code (which is 2.6.12) for submission to the mainline kernel.</p><p>They ship hostapd, with a binary libwsc.so that&#039;s got something to do with 802.1x or EAP. They also ship what appear to be precompiled versions of ip_nat_ipsec, ip_conntrack_ipsec and mv88f5181, as well as binary atheros drivers and wsc_daemon.ko. The bootloader is U-Boot1.1.1 (Marvell version 1.7.3), which is shipped as a binary without any source. The toolchain is arm-linux-uclibc and is also shipped as binary without any source.</p><p>So, how can I help get OpenWRT ported to this architecture? I&#039;m not afraid of bricking it as I have friends who&#039;ve done JTAG reprogramming before.</p><p><strong>Update 2009-08-31</strong>: Firstly, the thread title is wrong, should be 88Fxx81, and this thread is mostly about the WRT350N v2. Secondly, thanks to the work of mindbender, Kaloz, Davidkra, maddes.b, dirkNL, StrikerNL, relghuar, buytenh (apologies if I&#039;ve missed anyone) there&#039;s now an image available for testing - see <a href="https://forum.openwrt.org/viewtopic.php?id=12358&amp;p=16">page 16</a> and on.</p><p><strong>Update 2010-04-04</strong>: The Linksys WRT350N v2 is fully supported by <a href="http://downloads.openwrt.org/backfire/">Backfire 10.03</a>, using the image in the orion directory. openwrt-wrt350nv2-squashfs-webupgrade.img can be used to flash from the original firmware, and openwrt-wrt350nv2-squashfs.img with sysupgrade. The Netgear WNR854T also works, except for the wireless card which does not have drivers yet. One option is to replace it with a card that does, see the thread for more details.</p><p><a href="http://wiki.openwrt.org/toh/linksys/wrt350nv2">WRT350Nv2 wiki page</a></p>											<p class="post-edited">(Last edited by <strong>Watha</strong> on 26 May 2010, 12:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p57502">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						15 Oct 2007, 09:14					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I&#039;ve connected to the serial port (it&#039;s the same as the <a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Linksys/WRT300N">WRT300N</a>&#039;s) and got a U-Boot console, next step is to try compiling the linkstationwiki 2.6.22 and netbooting it.</p>											<p class="post-edited">(Last edited by <strong>Watha</strong> on 15 Oct 2007, 09:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p57510">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Kaloz</div>
					<div class="post-datetime">
						15 Oct 2007, 11:21					</div>
				</div>
				<div class="post-content content">
					<p>The &quot;linkstation kernel&quot; won&#039;t work.</p><p>88F5181 - Orion 1<br />88F5182 - Orion NAS<br />88F5281 - Orion 2</p><p>The &quot;linkstation kernel&quot; is for the 88F5182, and there are upstream patches for 88F5281. For the Orion 1, there is no other sources then the Linkys/Netgear ones.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60273">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						11 Dec 2007, 15:21					</div>
				</div>
				<div class="post-content content">
					<p>you guys should watch this closely:<br /><a href="http://git.kernel.org/?p=linux/kernel/git/nico/orion.git;a=summary">http://git.kernel.org/?p=linux/kernel/g … ;a=summary</a><br /><a href="http://news.gmane.org/gmane.linux.ports.arm.kernel">http://news.gmane.org/gmane.linux.ports.arm.kernel</a></p><p>orion 1 example - dns323: <br /><a href="http://git.kernel.org/?p=linux/kernel/git/nico/orion.git;a=commit;h=762a21b9a98760f2b51ab459918d3e10c9de6a68">http://git.kernel.org/?p=linux/kernel/g … 10c9de6a68</a></p><p>OrionNas: <br /><a href="http://git.kernel.org/?p=linux/kernel/git/nico/orion.git;a=commit;h=ed7b7414585336a5bf34552a44482ff6b1929dd0">http://git.kernel.org/?p=linux/kernel/g … f6b1929dd0</a></p><p>Orion 2 devboard: <br /><a href="http://git.kernel.org/?p=linux/kernel/git/nico/orion.git;a=commit;h=afe8ae1ad2c522f4846900aec758a8fcb9a2d7e5">http://git.kernel.org/?p=linux/kernel/g … fcb9a2d7e5</a></p><p>tzachi perelstein, nicolas pitre and Lennert Buytenhek from Marvell are working on this.</p><p>actually this is also your chance to create some patches for direct support in the mainline kernel.<br />as you see there are already some working on getting support for some NAS-boxes directly into the kernel (byron bradley, herbert valerio, martin michlmayr)....there are quite many NAS-devices that use that architecture:<br /><a href="http://nas-central.org/ALL_COMMUNITIES/Collection_of_NAS-Hacking_communities.html#Marvell%20Orion%201%20based%20NAS%20devices">http://nas-central.org/ALL_COMMUNITIES/ … %20devices</a></p><p>i encourage you to do the same. i know openwrt.org has several kernel hacking guys....</p><p>i am not that familiar how many routers use that marvel design...</p>											<p class="post-edited">(Last edited by <strong>mindbender</strong> on 11 Dec 2007, 15:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60299">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mwt</div>
					<div class="post-datetime">
						12 Dec 2007, 09:21					</div>
				</div>
				<div class="post-content content">
					<p>i have problems to get the openwrt-ixp4xx-squashfs.img to working.<br />is there an easy way to convert it to u-boots uImage?<br />Would be kind if anyone can help me...</p><p>Some infos about this nice router:</p><p>WRT-300N v2 Serial Console<br />The serial console (JP5) is just above the flash chip on the same side as the antennas. Console speed is 115200, 8n1.<br /> * () Vcc () RX () TX () GND<br />&gt;picocom -b 115200 /dev/ttyUSB0<br />The console connector for the WRT350N v2 uses TTL voltage. Thus it cannot be directly connected to a PC via RS232 port. It requires level shifting.</p><div class="codebox"><pre><code>        __  __                      _ _
        |  \/  | __ _ _ ____   _____| | |
        | |\/| |/ _` | &#039;__\ \ / / _ \ | |
        | |  | | (_| | |   \ V /  __/ | |
        |_|  |_|\__,_|_|    \_/ \___|_|_|
 _   _     ____              _
| | | |   | __ )  ___   ___ | |_ 
| | | |___|  _ \ / _ \ / _ \| __| 
| |_| |___| |_) | (_) | (_) | |_ 
 \___/    |____/ \___/ \___/ \__|  ** LOADER **
 ** MARVELL BOARD: RD-88F5181L-VOIP-GE LE 

U-Boot 1.1.1 (Dec 12 2006 - 16:12:22) Marvell version: 1.7.3

DRAM CS[0] base 0x00000000   size  32MB 
DRAM Total size  32MB 
Flash: mvFlashInit base 0xff800000 devW 1 busW 1
Flash: flashStructGet manu 0xec id 0xe0 
Flash: flashStructGet flash is supported.
FLASH: initFlashSecs TOP Sector Type 
Flash: flashSecsInit main sector loop 0 - 127 
[8192kB@ff800000] Flash:  8 MB
Addresses 20M - 0M are saved for the U-Boot usage.
Mem malloc Initialization (20M - 16M): Done
*** Warning - bad CRC, using default environment

Soc: MV88F5181 Rev 9
CPU: ARM926 (Rev 0) running @ 500Mhz 
SysClock = 166Mhz , TClock = 166Mhz 

USB 0: host mode
PCI 0: PCI Express Root Complex Interface
PCI 1: Conventional PCI, speed = 33000000
Net:   mvEgigaLoad: egiga0 load ok
egiga0 [PRIME]

***************DRIVER INFO*****************

DRIVER BUILD DATA: Jan  9 2007 at 18:25:44
DRIVER VERSION 1.06

*******************************************
dbSign is:65:52:63:4f:6d:4d
mac address in flash is:XX
have eRcOmM 
Hit ENTER to stop autoboot:  0 
copy kernel from 0xff800000 to 0x400000 with size 0x200000
## Booting image at 00400000 ...
   Image Name:   Linux-2.6.12-arm1
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    1511464 Bytes =  1.4 MB
   Load Address: 00008000
   Entry Point:  00008000
   Verifying Checksum ... OK
OK

Starting kernel ...

Uncompressing Linux................................................................................................... done, booting the kernel.
Linux version 2.6.12-arm1 (Terry@9TerryLiu2) (gcc version 3.4.4 (release) (CodeSourcery ARM 2005q3-2)) #1 Sun Apr 8 20:47:27 CST 2007
CPU: ARM926EJ-Sid(wb) [41069260] revision 0 (ARMv5TEJ)
CPU0: D VIVT write-back cache
CPU0: I cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
CPU0: D cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
Machine: MV-88fxx81
Using UBoot passing parameters structure
Sys Clk = 166000000, Tclk = 166000000
Memory policy: ECC disabled, Data cache writeback
Built 1 zonelists
Kernel command line: console=ttyS0,115200 root=/dev/mtdblock1 rw
PID hash table entries: 256 (order: 8, 4096 bytes)
Console: colour dummy device 80x30
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 32MB 0MB 0MB 0MB = 32MB total
Memory: 28928KB available (2497K code, 880K data, 100K init)
Mount-cache hash table entries: 512
CPU: Testing write buffer coherency: ok
NET: Registered protocol family 16
Flash bankwidth 1, base f4000000, size 800000

  Marvell Development Board (LSP Version 1.8.5)-- RD-88F5181L-VOIP-GE 

 Detected Tclk 166000000 and SysClk 166000000 
Marvell USB EHCI Host controller #0: c03fcb00
pexBarOverlapDetect: winNum 2 overlap current 0
mvPexInit:Warning :Bar 2 size is illigal
it will be disabled
please check Pex and CPU windows configuration
PCI: bus0: Fast back to back transfers enabled
PCI: bus1: Fast back to back transfers enabled
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
pci access ctrl reg 0x31e00&#039;s value = 0x00000a01
pci access ctrl size reg 0x31e08&#039;s value = 0x07fff000
SCSI subsystem initialized
Linux Kernel Card Services
  options:  [pci]
usbcore: registered new driver usbfs
usbcore: registered new driver hub
TWSI: twsiAddr7BitSet ERROR - Addr (7 Bit) int TimeOut.
TWSI: mvTwsiStopBitSet ERROR - Stop bit TimeOut .
TWSI: mvTwsiStartBitSet ERROR - Start Clear bit TimeOut .
TWSI: mvTwsiStopBitSet ERROR - Stop bit TimeOut .
TWSI: mvTwsiStartBitSet ERROR - Start Clear bit TimeOut .
TWSI: mvTwsiStopBitSet ERROR - Stop bit TimeOut .
TWSI: mvTwsiStartBitSet ERROR - Start Clear bit TimeOut .
TWSI: mvTwsiStopBitSet ERROR - Stop bit TimeOut .
TWSI: mvTwsiStartBitSet ERROR - Start Clear bit TimeOut .
TWSI: mvTwsiStopBitSet ERROR - Stop bit TimeOut .
TWSI: mvTwsiStartBitSet ERROR - Start Clear bit TimeOut .
TWSI: mvTwsiStopBitSet ERROR - status 8 after Stop Bit. 
TWSI: mvTwsiStartBitSet ERROR - Start Clear bit TimeOut .
TWSI: mvTwsiStopBitSet ERROR - Stop bit TimeOut .
use IDMA acceleration in copy to/from user buffers. used channels 2 and 3 
Done. 
Fast Floating Point Emulator V0.9 (c) Peter Teichmann.
squashfs: version 3.0 (2006/03/15) Phillip Lougher
JFFS2 version 2.2. (C) 2001-2003 Red Hat, Inc.
Initializing Cryptographic API
HDLC line discipline: version $Revision: 1.1.1.1 $, maxframe=4096
N_HDLC line discipline registered.
Serial: 8250/16550 driver $Revision: 1.1.1.1 $ 4 ports, IRQ sharing disabled
ttyS0 at MMIO 0x0 (irq = 3) is a 16550A
io scheduler noop registered
io scheduler anticipatory registered
io scheduler deadline registered
io scheduler cfq registered
loop: loaded (max 8 devices)
Loading Marvell Gatway Driver:
multi queue enabled
prioritizing ToS 0xA0
eth0: 00:00:00:00:51:81, group-id 0x100, group-members are port-CPU port-1 port-2 port-3 port-4 
eth1: 00:00:00:00:51:82, group-id 0x200, group-members are port-CPU port-0 
init switch layer... gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
done
init gigabit layer... done
loading network interfaces: eth0 eth1 
PPP generic driver version 2.4.2
PPP Deflate Compression module registered
PPP BSD Compression module registered
NET: Registered protocol family 24
SLIP: version 0.8.4-NET3.019-NEWTTY (dynamic channels, max=256).
STRIP: Version 1.3A-STUART.CHESHIRE (unlimited channels)
physmap flash device: 800000 at f4000000
phys_mapped_flash: Found 1 x16 devices at 0x0 in 8-bit bank
 Amd/Fujitsu Extended Query Table at 0x0040
phys_mapped_flash: Swapping erase regions for broken CFI table.
number of CFI chips: 1
cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
Using physmap partition definition
Creating 5 MTD partitions on &quot;phys_mapped_flash&quot;:
0x00000000-0x00760000 : &quot;kernel&quot; 
0x001a0000-0x00760000 : &quot;rootfs&quot; 
0x00760000-0x007a0000 : &quot;lang&quot; 
0x007a0000-0x007c0000 : &quot;nvram&quot; 
0x007c0000-0x00800000 : &quot;u-boot&quot; 
ehci_platform ehci_platform.4523: EHCI Host Controller
ehci_platform ehci_platform.4523: new USB bus registered, assigned bus number 1
ehci_platform ehci_platform.4523: irq 17, io mem 0x00000000
ehci_platform ehci_platform.4523: park 0
ehci_platform ehci_platform.4523: USB 0.0 initialized, EHCI 1.00, driver 10 Dec 2004
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
USB Universal Host Controller Interface driver v2.2
Initializing USB Mass Storage driver...
usbcore: registered new driver usb-storage
USB Mass Storage support registered.
mice: PS/2 mouse device common for all mice
u32 classifier
    OLD policer on 
NET: Registered protocol family 2
IP: routing cache hash table of 512 buckets, 4Kbytes
/proc/eth1_tm created
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
TCP: Hash tables configured (established 2048 bind 2048)
ip_conntrack version 2.1 (256 buckets, 2048 max) - 268 bytes per conntrack
ip_conntrack_rtsp v0.6.21 loading
ip_nat_rtsp v0.6.21 loading
ip_tables: (C) 2000-2002 Netfilter core team
netfilter PSD loaded - (c) astaro AG
ipt_random match loaded
ip_conntrack_pptp version 3.0 loaded
ip_nat_pptp version 3.0 loaded
NET: Registered protocol family 1
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
VFS: Mounted root (squashfs filesystem) readonly.
Freeing init memory: 100K
init started:  BusyBox v1.1.0 (2007.04.08-13:18+0000) multi-call binary
init started:  BusyBox v1.1.0 (2007.04.08-13:18+0000) multi-call binary
Starting pid 203, console /dev/console: &#039;/etc/rcS&#039;
ipt_webstr: module license &#039;unspecified&#039; taints kernel.
ufsd: driver loaded
UFSD version 5.28 (Nov  8 2006, 21:54:59)
NTFS read/write support included

ufsd: address 0xbf030538
mv_gateway: starting eth0
mv_gateway: starting eth1
V2.00.10
device eth0 entered promiscuous mode
ap_name=(null),action=start
rc_start: ap-&gt;name = lan
br0: port 1(eth0) entering learning state
br0: topology change detected, propagating
br0: port 1(eth0) entering forwarding state
rc_start: ap-&gt;name = printk
start printk...
rc_start: ap-&gt;name = wlan
start wifi
/sbin/brctl addif br0 ath0
ath0
Interface doesn&#039;t accept private ioctl...
maccmd (8BE0): Invalid argument
wlan up!!
rc_start: ap-&gt;name = syslogd
start syslog...
syslog_cmd=-R 192.168.1.100:514
rc_start: ap-&gt;name = httpd
start httpd...
tar: Short read
rc_start: ap-&gt;name = dhcpd
start dhcpd...
rc_start: ap-&gt;name = ntp
rc_start: ap-&gt;name = route
rc_start: ap-&gt;name = ripd
rc_start: ap-&gt;name = wscupnp
killall: wscupnpd: no process killed
rc_start: ap-&gt;name = ftpd
killall: bftpd: no process killed
open /proc/wps_button
mac = NOT NULL
mac = XXXXXXXXXX
mac = NOT NULL
mac = XXXXXXXXXX
ap_name=firewall,action=stop
rc_stop: ap-&gt;name = firewall
/usr/sbin/fw-scripts/firewall: .: 19: Can&#039;t open /tmp/firewall.conf
killall: reaim: no process killed
killall: IGMPProxy: no process killed
mac = NOT NULL
mac = XXXXXXXXXX
mac = NOT NULL
mac = XXXXXXXXXX
Configuration file: /tmp/madwifi.conf
RTNETLINK answers: No such file or directory
Configure bridge br0 for EAPOL traffic.
RTNETLINK answers: No such file or directory
madwifi_set_iface_flags: dev_up=0
Using interface ath0 with hwaddr 00:1a:70:a0:36:68 and ssid &#039;linksys&#039;
Flushing old station entries
Deauthenticate all stations
l2_packet_receive - recv: Network is down
/etc/rcS: /etc/rcS: 83: cannot create /proc/sys/vm/pagetable_cache: Directory nonexistent
ap_name=wan_basic,action=stop
rc_stop: ap-&gt;name = wan_basic
kernel call WSC_STA_CALLBACK
[## WSCDEBUG ##] [FUNC]:wsc_staAssocCallback [LINE]:4047 MAC :radioIndex=6

        00 13 02 0B 98 0D 
[## WSCDEBUG ##] [FUNC]:createWsccb [LINE]:338
pWsccb-&gt;wscIe = 0
Wireless event: cmd=0x8c03 len=20
ath0: STA XX:XX:XX:XX:XX:XX IEEE 802.11: associated
  New STA
ath0: STA XX:XX:XX:XX:XX:XX WPA: event 1 notification
ap_name=mediaserver,action=start
rc_start: ap-&gt;name = mediaserver
ap_name=upnp,action=start
rc_start: ap-&gt;name = upnp
killall: upnpd: no process killed
route: SIOC[ADD|DEL]RT: File exists
UPnP Initialized
Intialized UPnP 
        with fullurl=http://192.168.1.1:49152/gateway.xml
                     ipaddress=192.168.1.1 port=49152
             web_dir_path=/usr/upnp/
             desc_doc_url=http://192.168.1.1:49152
Specifying the webserver root directory -- /usr/upnp/
Registering the RootDevice
RootDevice Registered
Initializing State Table
fullurl http://192.168.1.1:49152/gateway.xml 
Advertisements Sent
ap_name=wscupnp,action=start
rc_start: ap-&gt;name = wscupnp
mac = NOT NULL
mac = XXXXXXXXX
wsc_uuid=e7fe1b91-8cd5-0310-98dd-001a70a03668

Please press Enter to activate this console.</code></pre></div><p>Flash information<br /></p><div class="codebox"><pre><code>Marvell&gt;&gt; flinfo

Bank # 1: SAMSUNG SAMSUNG_FID_K8D6316T (8 Mbit, top boot sector)
Size:  8 MB,Bus Width: 1, device Width: 1.
Flash base: 0xff800000,Number of Sectors: 135 Type: TOP.
  Sector Start Addresses:
    00000000      00010000      00020000      00030000      00040000     
    00050000      00060000      00070000      00080000      00090000     
    000a0000      000b0000      000c0000      000d0000      000e0000     
    000f0000      00100000      00110000      00120000      00130000     
    00140000      00150000      00160000      00170000      00180000     
    00190000      001a0000      001b0000      001c0000      001d0000     
    001e0000      001f0000      00200000      00210000      00220000     
    00230000      00240000      00250000      00260000      00270000     
    00280000      00290000      002a0000      002b0000      002c0000     
    002d0000      002e0000      002f0000      00300000      00310000     
    00320000      00330000      00340000      00350000      00360000     
    00370000      00380000      00390000      003a0000      003b0000     
    003c0000      003d0000      003e0000      003f0000      00400000     
    00410000      00420000      00430000      00440000      00450000     
    00460000      00470000      00480000      00490000      004a0000     
    004b0000      004c0000      004d0000      004e0000      004f0000     
    00500000      00510000      00520000      00530000      00540000     
    00550000      00560000      00570000      00580000      00590000     
    005a0000      005b0000      005c0000      005d0000      005e0000     
    005f0000      00600000      00610000      00620000      00630000     
    00640000      00650000      00660000      00670000      00680000     
    00690000      006a0000      006b0000      006c0000      006d0000     
    006e0000      006f0000      00700000      00710000      00720000     
    00730000      00740000      00750000      00760000      00770000     
    00780000      00790000      007a0000      007b0000      007c0000 (RO)
    007d0000 (RO) 007e0000 (RO) 007f0000 (RO) 007f2000 (RO) 007f4000 (RO)
    007f6000 (RO) 007f8000 (RO) 007fa000 (RO) 007fc000 (RO) 007fe000 (RO)

Bank # 2: missing or unknown FLASH type
Marvell&gt;&gt;</code></pre></div><p>U-Boot User Environment variables<br /></p><div class="codebox"><pre><code>Marvell&gt;&gt; printenv
bootcmd=scload; bootm 0x400000
baudrate=115200
loads_echo=0
ipaddr=172.21.5.10
serverip=172.21.5.30
rootpath=/mnt/ARM_FS/
stdin=serial
stdout=serial
stderr=serial
cpuName=926
CASset=min
enaMonExt=no
enaFlashBuf=yes
enaCpuStream=no
MALLOC_len=4
ethprime=egiga0
bootargs_root=root=/dev/nfs rw
bootargs_end=:::DB88FXX81:eth0:none
image_name=uImage
bootdelay=3
disaMvPnp=no
ethaddr=00:00:00:00:51:81
overEthAddr=no
usb0Mode=host
ethact=egiga0

Environment size: 439/8188 bytes</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60321">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						12 Dec 2007, 15:45					</div>
				</div>
				<div class="post-content content">
					<p>the openwrt-ixp4xx-squashfs.img and the uboot uImages are 2 total different things. Generally a uImage is a kernel wrapped into the uboot format. an initrd or a filesystem on flash/hdd is needed as a kernel itself might load, but it cannot boot without a rootfs.</p><p>i personally do not know openwrt too much but squashfs is a flash filesystem. so most likely the kernel and the rootfs is stored inside this FS. i am sure you could mount it on a linux workstation (loop mount maybe) and look inside, but i think this might be rather useless for you.</p><p>ixp4xx is a different arm cpu than the arm926ej-s and i am quite sure most things are missing that are needed to get the kernel inside working with this orion-based-router.</p><p>actually i think the best approach to get things a little more pushed would be&nbsp; if you tried to load the following uImage via tftp:<br /><a href="http://downloads.foonas.org/foonas-em/beta4/lsarm/uImage_2.6.24">http://downloads.foonas.org/foonas-em/b … age_2.6.24</a></p><p>uboot is able to load uImages via tftp....actually ipaddr &amp; serverip are allready set to some strange ips....</p><p>you could just use:<br />tftpboot [your_workstation_ip] uImage_2.6.24<br />if you serve the ip from your local workstation via tftp....you might have to change the ipaddr (this is the local ip of the router) in the uboot enviroment...<br /><a href="http://www.denx.de/wiki/view/DULG/UBootCmdGroupDownload#Section_5.9.5.6">http://www.denx.de/wiki/view/DULG/UBoot … on_5.9.5.6</a>.</p><p>why do i tell you that?<br />this uImage use a known to work rootfs inside....it uses foonas-em (which itself is compiled from openembedded) and is stored INSIDE the kernel as a initramfs.</p><p>when booted up your router will ironically search for a dhcp server (as foonas-em was designed for nas-systems) but it should fallback to 192.168.11.150 if there is none.</p><p>at least trying to boot via tftp might reveal some things that might be good to report to the marvell guys....<br />in case it works you should be able to ssh or telnet into the box...and even a webserver should be running.</p><p>good luck.</p>											<p class="post-edited">(Last edited by <strong>mindbender</strong> on 12 Dec 2007, 15:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60325">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						12 Dec 2007, 17:02					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I can download the kernel via tftp and boot it, but it hangs after<br /></p><div class="codebox"><pre><code>Marvell&gt;&gt; bootm 0x400000
## Booting image at 00400000 ...
   Image Name:   Linux-2.6.24-rc3
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    6240212 Bytes =  6 MB
   Load Address: 00008000
   Entry Point:  00008000
   Verifying Checksum ... OK
OK

Starting kernel ...

Uncompressing Linux.........................</code></pre></div><p>Do I need to specify the initramfs location or set it to use the serial console or something else? The serial console is running at 115200bps, does that image assume some other speed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60330">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						12 Dec 2007, 17:34					</div>
				</div>
				<div class="post-content content">
					<p>to be honest i don`t know. if i load the uImage via tftp on my LS Pro the same way it works.</p><p>all orion boards we encountered so far use the same baudrate (115200bps) as they all use the same special marvell uboot BSP (on many NAS boxes they used the marvell bsp 1.7.3)....i think it is more likely that the uImage that i pointed you to is too old...it might not have the needed things for orion 2 inside. it was compiled and uploaded on the 2nd december 07....which was before several changes were made in the git repo at <a href="http://git.kernel.org/?p=linux/kernel/git/nico/orion.git;a=summary">http://git.kernel.org/?p=linux/kernel/g … ;a=summary</a></p><p>i am quite sure that a new foonas-em will be available soon (foonas-em beta 5)...you could try it then.</p><p>anyway, i think this still is a good place to start.</p>											<p class="post-edited">(Last edited by <strong>mindbender</strong> on 12 Dec 2007, 17:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60333">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						12 Dec 2007, 18:30					</div>
				</div>
				<div class="post-content content">
					<p>Hah, I left it for a while and a login prompt appeared. What&#039;s the root password? Oh, and the WRT350N (which is what I have) is Orion 1:</p><div class="codebox"><pre><code>Soc: MV88F5181 Rev 9
CPU: ARM926 (Rev 0) running @ 500Mhz 
SysClock = 166Mhz , TClock = 166Mhz</code></pre></div>											<p class="post-edited">(Last edited by <strong>Watha</strong> on 12 Dec 2007, 18:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60334">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						12 Dec 2007, 18:45					</div>
				</div>
				<div class="post-content content">
					<p>its: hydr0g3n</p><p>is the webserver serving something btw?</p><p>pingable?</p>											<p class="post-edited">(Last edited by <strong>mindbender</strong> on 12 Dec 2007, 18:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60337">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						12 Dec 2007, 18:53					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, that password works. It&#039;s got no network - ifconfig reports no eth0, just lo.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60338">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						12 Dec 2007, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>but still cool <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60339">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						12 Dec 2007, 18:58					</div>
				</div>
				<div class="post-content content">
					<p>post dmesg here</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60340">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						12 Dec 2007, 19:01					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>foonas-em$ dmesg
&lt;5&gt;Linux version 2.6.24-rc3 (ole@mediapc) (gcc version 4.2.1) #1 PREEMPT Sun Dec 2 16:26:45 GMT 2007
&lt;4&gt;CPU: Feroceon [41069260] revision 0 (ARMv5TEJ), cr=a0053177
&lt;4&gt;Machine: Buffalo/Revogear Kurobox Pro
&lt;4&gt;Ignoring unrecognised tag 0x41000403
&lt;4&gt;Memory policy: ECC disabled, Data cache writeback
&lt;7&gt;On node 0 totalpages: 8192
&lt;7&gt;  DMA zone: 64 pages used for memmap
&lt;7&gt;  DMA zone: 0 pages reserved
&lt;7&gt;  DMA zone: 8128 pages, LIFO batch:0
&lt;7&gt;  Normal zone: 0 pages used for memmap
&lt;7&gt;  Movable zone: 0 pages used for memmap
&lt;4&gt;CPU0: D VIVT write-back cache
&lt;4&gt;CPU0: I cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
&lt;4&gt;CPU0: D cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
&lt;4&gt;Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
&lt;5&gt;Kernel command line: 
&lt;4&gt;PID hash table entries: 128 (order: 7, 512 bytes)
&lt;4&gt;Console: colour dummy device 80x30
&lt;6&gt;console [tty0] enabled
&lt;6&gt;Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
&lt;6&gt;Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
&lt;6&gt;Memory: 32MB = 32MB total
&lt;5&gt;Memory: 24140KB available (3896K code, 248K data, 4156K init)
&lt;7&gt;Calibrating delay loop... 332.59 BogoMIPS (lpj=1662976)
&lt;4&gt;Mount-cache hash table entries: 512
&lt;6&gt;CPU: Testing write buffer coherency: ok
&lt;6&gt;net_namespace: 64 bytes
&lt;6&gt;NET: Registered protocol family 16
&lt;6&gt;Orion ID: MV88F5181-Rev-Unsupported. TCLK=166666667.
&lt;7&gt;PCI: Scanning bus 0000:00
&lt;7&gt;PCI: Fixups for bus 0000:00
&lt;6&gt;PCI: bus0: Fast back to back transfers enabled
&lt;7&gt;PCI: Bus scan for 0000:00 returning with max=00
&lt;5&gt;SCSI subsystem initialized
&lt;6&gt;usbcore: registered new interface driver usbfs
&lt;6&gt;usbcore: registered new interface driver hub
&lt;6&gt;usbcore: registered new device driver usb
&lt;6&gt;NET: Registered protocol family 2
&lt;6&gt;Time: orion_clocksource clocksource has been installed.
&lt;7&gt;Switched to high resolution mode on CPU 0
&lt;6&gt;IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
&lt;6&gt;TCP established hash table entries: 1024 (order: 1, 8192 bytes)
&lt;6&gt;TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
&lt;6&gt;TCP: Hash tables configured (established 1024 bind 1024)
&lt;6&gt;TCP reno registered
&lt;6&gt;JFFS2 version 2.2. (NAND) ï¿½Â© 2001-2006 Red Hat, Inc.
&lt;6&gt;SGI XFS with no debug enabled
&lt;6&gt;io scheduler noop registered
&lt;6&gt;io scheduler anticipatory registered
&lt;6&gt;io scheduler deadline registered
&lt;6&gt;io scheduler cfq registered (default)
&lt;6&gt;Serial: 8250/16550 driver $Revision: 1.90 $ 2 ports, IRQ sharing disabled
&lt;6&gt;serial8250.0: ttyS0 at MMIO 0xf1012000 (irq = 3) is a 16550A
&lt;6&gt;serial8250.0: ttyS1 at MMIO 0xf1012100 (irq = 4) is a 16550A
&lt;4&gt;RAMDISK driver initialized: 3 RAM disks of 32768K size 1024 blocksize
&lt;6&gt;loop: module loaded
&lt;5&gt;MV-643xx 10/100/1000 Ethernet Driver
&lt;6&gt;$Id: ftl.c,v 1.59 2005/11/29 14:48:31 gleixner Exp $
&lt;6&gt;NFTL driver: nftlcore.c $Revision: 1.98 $, nftlmount.c $Revision: 1.41 $
&lt;5&gt;physmap platform flash device: 00040000 at f4000000
&lt;6&gt;physmap-flash.0: Found 1 x16 devices at 0x0 in 8-bit bank
&lt;4&gt;NOR chip too large to fit in mapping. Attempting to cope...
&lt;4&gt; Amd/Fujitsu Extended Query Table at 0x0040
&lt;3&gt;  Unknown Amd/Fujitsu Extended Query version 0.0.
&lt;4&gt;gen_probe: No supported Vendor Command Set found
&lt;7&gt;JEDEC: Found no physmap-flash.0 device at location zero
&lt;3&gt;physmap-flash physmap-flash.0: map_probe failed
&lt;4&gt;No NAND device found!!!
&lt;6&gt;orion-ehci orion-ehci.0: Marvell Orion EHCI
&lt;6&gt;orion-ehci orion-ehci.0: new USB bus registered, assigned bus number 1
&lt;6&gt;orion-ehci orion-ehci.0: irq 17, io base 0xf1050000
&lt;6&gt;orion-ehci orion-ehci.0: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004
&lt;6&gt;usb usb1: configuration #1 chosen from 1 choice
&lt;6&gt;hub 1-0:1.0: USB hub found
&lt;6&gt;hub 1-0:1.0: 1 port detected
&lt;7&gt;ohci_hcd: 2006 August 04 USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
&lt;6&gt;USB Universal Host Controller Interface driver v3.0
&lt;6&gt;sl811: driver sl811-hcd, 19 May 2005
&lt;6&gt;usbcore: registered new interface driver usblp
&lt;6&gt;Initializing USB Mass Storage driver...
&lt;6&gt;usbcore: registered new interface driver usb-storage
&lt;6&gt;USB Mass Storage support registered.
&lt;6&gt;mice: PS/2 mouse device common for all mice
&lt;7&gt;i2c-core: driver [rtc-rs5c372] registered
&lt;7&gt;i2c-core: driver [rtc-s35390a] registered
&lt;6&gt;i2c /dev entries driver
&lt;7&gt;i2c-core: driver [dev_driver] registered
&lt;7&gt;i2c-adapter i2c-0: adapter [mv64xxx_i2c adapter] registered
&lt;7&gt;i2c-adapter i2c-0: client [rs5c372a] registered with bus id 0-0032
&lt;7&gt;i2c 0-0032: uevent
&lt;7&gt;rtc-rs5c372 0-0032: probe
&lt;7&gt;rtc-rs5c372 0-0032: rs5c372_probe
&lt;7&gt;i2c-adapter i2c-0: master_xfer[0] R, addr=0x32, len=17
&lt;7&gt;&lt;NULL&gt;: can&#039;t read registers
&lt;4&gt;rtc-rs5c372: probe of 0-0032 failed with error -5
&lt;7&gt;i2c-dev: adapter [mv64xxx_i2c adapter] registered as minor 0
&lt;6&gt;TCP cubic registered
&lt;6&gt;NET: Registered protocol family 1
&lt;6&gt;NET: Registered protocol family 17
&lt;6&gt;RPC: Registered udp transport module.
&lt;6&gt;RPC: Registered tcp transport module.
&lt;6&gt;VFP support v0.3: not present
&lt;4&gt;drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
&lt;6&gt;Freeing init memory: 4156K</code></pre></div><p>I wonder if <a href="http://git.kernel.org/?p=linux/kernel/git/nico/orion.git;a=commit;h=1c4b5f55ab46915df5eaefe2fcd28ebb7b949478">Orion: common platform setup for Gigabit Ethernet port</a> will enable the ethernet. In /sys there&#039;s devices/platform/mv643xx_eth.0 and mv643xx_eth_shared.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60341">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						12 Dec 2007, 19:11					</div>
				</div>
				<div class="post-content content">
					<p>well, nice starting point now isn`t it?</p><p>maybe you get in direct contact with the marvell guys from the mailing list. i am sure they can tell you what to do....i mean...they ported the kernel to the board of the router in the first place for the GPL sources. if you show them that there is interest they might even code some additional patches.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60342">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						12 Dec 2007, 19:15					</div>
				</div>
				<div class="post-content content">
					<p>you need to obtain some more information about the box....the kernel you just booted was compiled for a completely different device...thats why the flash map for example does not fit at all.</p><p>i think there is a command in uboot to get some more info about the flash map....wasn`t it fliinfo? just enter &quot;help&quot; in the uboot console to see the available commands.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60343">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						12 Dec 2007, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>I can&#039;t get to <a href="http://lists.arm.linux.org.uk/mailman/listinfo/">http://lists.arm.linux.org.uk/mailman/listinfo/</a> to subscribe to the mailing list (it just times out), I&#039;ll have to look into using gmane I think.</p><div class="codebox"><pre><code>Marvell&gt;&gt; flinfo 

Bank # 1: SAMSUNG SAMSUNG_FID_K8D6316T (8 Mbit, top boot sector)
Size:  8 MB,Bus Width: 1, device Width: 1.
Flash base: 0xff800000,Number of Sectors: 135 Type: TOP.
  Sector Start Addresses:
    00000000      00010000      00020000      00030000      00040000     
    00050000      00060000      00070000      00080000      00090000     
    000a0000      000b0000      000c0000      000d0000      000e0000     
    000f0000      00100000      00110000      00120000      00130000     
    00140000      00150000      00160000      00170000      00180000     
    00190000      001a0000      001b0000      001c0000      001d0000     
    001e0000      001f0000      00200000      00210000      00220000     
    00230000      00240000      00250000      00260000      00270000     
    00280000      00290000      002a0000      002b0000      002c0000     
    002d0000      002e0000      002f0000      00300000      00310000     
    00320000      00330000      00340000      00350000      00360000     
    00370000      00380000      00390000      003a0000      003b0000     
    003c0000      003d0000      003e0000      003f0000      00400000     
    00410000      00420000      00430000      00440000      00450000     
    00460000      00470000      00480000      00490000      004a0000     
    004b0000      004c0000      004d0000      004e0000      004f0000     
    00500000      00510000      00520000      00530000      00540000     
    00550000      00560000      00570000      00580000      00590000     
    005a0000      005b0000      005c0000      005d0000      005e0000     
    005f0000      00600000      00610000      00620000      00630000     
    00640000      00650000      00660000      00670000      00680000     
    00690000      006a0000      006b0000      006c0000      006d0000     
    006e0000      006f0000      00700000      00710000      00720000     
    00730000      00740000      00750000      00760000      00770000     
    00780000      00790000      007a0000      007b0000      007c0000 (RO)
    007d0000 (RO) 007e0000 (RO) 007f0000 (RO) 007f2000 (RO) 007f4000 (RO)
    007f6000 (RO) 007f8000 (RO) 007fa000 (RO) 007fc000 (RO) 007fe000 (RO)

Bank # 2: missing or unknown FLASH type</code></pre></div>											<p class="post-edited">(Last edited by <strong>Watha</strong> on 12 Dec 2007, 19:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60346">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						12 Dec 2007, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>look inside the GPL kernel sources and the uboot sources...there the flash map should be defined.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60371">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">Kaloz</div>
					<div class="post-datetime">
						13 Dec 2007, 12:50					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll have time to work on it next week / during the holidays.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60387">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">bbradley</div>
					<div class="post-datetime">
						13 Dec 2007, 22:53					</div>
				</div>
				<div class="post-content content">
					<p>To get this working properly (and ready to submit to mainline) you will need to create a new board setup file and register a new mach-type (<a href="http://www.arm.linux.org.uk/developer/machines/">http://www.arm.linux.org.uk/developer/machines/</a>). The dmesg posted from the stock kernel shows the NOR flash setup so you can just copy that into your setup file. </p><div class="codebox"><pre><code>Creating 5 MTD partitions on &quot;phys_mapped_flash&quot;:
0x00000000-0x00760000 : &quot;kernel&quot; 
0x001a0000-0x00760000 : &quot;rootfs&quot; 
0x00760000-0x007a0000 : &quot;lang&quot; 
0x007a0000-0x007c0000 : &quot;nvram&quot; 
0x007c0000-0x00800000 : &quot;u-boot&quot;</code></pre></div><p>The MV88F5182 has just one gigabit MAC with an external PHY, I&#039;ve managed to find a photo of the top of the WRT350Nv2 but it wasn&#039;t very high quality, I can see that it has an 88E6131 (8-Port GE Switch w/ Integrated GE PHYs). The stock dmesg shows two network adapters so you&#039;ll need to find out if those are both in the SoC or if there is an external device on the board (try lspci but remember that it won&#039;t work on stock kernels and won&#039;t work on the new kernel unless PCI is properly initialised). A problem we have had with some NAS devices is the MAC address not being set properly and this will stop networking from working. You can see eth[01] being set to 00:00:00:00:51:8[12] and then presumably changed later in the boot process.</p><p>You will have to work out the correct assignment of the multiplexing pins on the router. Without documentation from Linksys the easiest way to find these is probably to recompile the stock kernel and get it to dump the MPP values. These multiplexing pins allow you to switch certain pins between being GPIOs, SATA, UART, NAND, etc. Things such as the PCI slot offset and the PCI IRQs will probably also have to be changed as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60532">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						17 Dec 2007, 10:27					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve managed to build a kernel using foonas/openembedded/bitbake, so I can now test patches.&nbsp; The SoC rev on my WRT350N v2 is also 88F5181L A1 aka RD-88F5181L-VOIP-GE , so it has the crypto engine. arch/arm/mach-mv88fxx81/mv88f5181/mvSysHwConfig.h has a bunch of config stuff, like</p><div class="codebox"><pre><code>/* PCI0: IO and memory space */
#define PCI0_MEM_BASE  0xe8000000
#define PCI0_MEM_SIZE  _128M

#define PCI0_IO_BASE    0xf2100000
#define PCI0_IO_SIZE    _1M

/* IRQ numbers */
#ifndef ETH_PORT0_IRQ_NUM
# define ETH_PORT0_IRQ_NUM  21
#endif

/* MAC */
#ifndef CONFIG_ETH_0_MACADDR
# define CONFIG_ETH_0_MACADDR    &quot;000000000050&quot;
#endif
#ifndef CONFIG_ETH_1_MACADDR
# define CONFIG_ETH_1_MACADDR    &quot;000000000051&quot;
#endif
#ifndef CONFIG_ETH_2_MACADDR
# define CONFIG_ETH_2_MACADDR    &quot;000000000052&quot;
#endif</code></pre></div><p>and Board/boardEnv/DB_88FXX81/mvBoardEnvSpec.h has</p><div class="codebox"><pre><code>#define RD_88F5181L_VOIP_GE_INFO    {                                           \
                                                                                \
    &quot;RD-88F5181L-VOIP-GE&quot;,                  /* boardName[MAX_BOARD_NAME_LEN] */ \
                                                                                \
    {RD_88F5181L_VOIP_GE_MPP0_7,            /* mpp0_7 */                        \
    RD_88F5181L_VOIP_GE_MPP8_15,            /* mpp8_15 */                       \
    RD_88F5181L_VOIP_GE_MPP16_23,           /* mpp16_23 */                      \
    RD_88F5181L_VOIP_GE_MPP_DEV},           /* mppDev */                        \
                                                                                \
    ((1&lt;&lt;4)|(1 &lt;&lt; 5)|(1&lt;&lt;8)),               /* intsGppMask */                   \
                                                                                \
    /*{params, devType, devWidth}*/         /* devCsInfo[MV_BOARD_MAX_DEV] */   \
                                                                                \
    {{ N_A, N_A, N_A},                      /* devCs0 */                        \
     { N_A, N_A, N_A},                          /* devCs1 */                    \
     { N_A, N_A, N_A},                          /* devCs2/flashCs */            \
     { 0x8fcfffff, BOARD_DEV_NOR_FLASH, 8}},    /* bootCs */                    \
                                                                                \
    /*pciBoardIf[MV_BOARD_MAX_PCI_IF];*/                                        \
                                                                                \
    {{0x7,                                  /* firstSlotDevNum */               \
    1,                                      /* pciSlotsNum */                   \
                                                                                \
    /*pciSlot[MV_BOARD_MAX_PCI_SLOTS]*/                                         \
    /* {{intAGppPin, intBGppPin, intCGppPin, intDGppPin}} */                    \
                                                                                \
    {{ {4, 10, N_A, N_A}},              /* pciSlot0 */                          \
     { {N_A, N_A, N_A, N_A}},           /* pciSlot1 */                          \
     { {N_A, N_A, N_A, N_A}}}}},        /* pciSlot2 */                          \
                                                                                \
    0x68,                                   /* rtcTwsiAddr */                   \
    ADDR7_BIT,                              /* rtcTwsiAddrType */               \
    N_A,                                    /* pexPciBridgeTwsiAddr */          \
    N_A,                                    /* pexPciBridgeTwsiAddrType */      \
                                                                                \
    {0x0},                                  /* ethPhyAddr[MV_BOARD_MAX_PORTS] */\
                                                                                \
    5,                                      /* rtcIntPin */                     \
    N_A,                                    /* switchIntPin */                  \
    {N_A,N_A},                      /* vbusUsbGppPin[MV_BOARD_MAX_USB_IF] */    \
                                                                                \
    3,                                      /* activeLedsNumber */              \
                                                                                \
    {1,                                     /* led0GppPin */                    \
    2,                                      /* led1GppPin */                    \
    3,                                      /* led2GppPin */                    \
    N_A,                                    /* led3GppPin */                    \
    N_A,                                    /* led4GppPin */                    \
    N_A,                                    /* led5GppPin */                    \
    N_A,                                    /* led6GppPin */                    \
    N_A},                                   /* led7GppPin */                    \
    0,                                      /* ledsPolarity */                  \
    N_A                                     /* refClkGppPin */                  \
}</code></pre></div><p>Stock kernel /proc/interrupts:</p><div class="codebox"><pre><code>~ # cat /proc/interrupts 
           CPU0
  0:       3047   Mv Timer Tick
  3:        315   serial
 17:          0   ehci_hcd:usb1
 21:         35   mv_gateway
 36:        814   wifi0</code></pre></div><p>/proc/bus/pci only reports <a href="http://pci-ids.ucw.cz/iii/?i=168c">168c0023</a>, which is the AR5416 802.11a/b/g/n Wireless PCI Adapter, so both ethernet interfaces are onboard. Looking at the traces, all the external ethernet ports go to the switch (which has a heatsink on it), and I can tftp with any of them.</p>											<p class="post-edited">(Last edited by <strong>Watha</strong> on 17 Dec 2007, 11:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60760">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						22 Dec 2007, 02:47					</div>
				</div>
				<div class="post-content content">
					<p>any updates?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60764">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">Watha</div>
					<div class="post-datetime">
						22 Dec 2007, 08:14					</div>
				</div>
				<div class="post-content content">
					<p>I posted most of the above to linux-arm, but no response.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60856">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						25 Dec 2007, 16:26					</div>
				</div>
				<div class="post-content content">
					<p>in case anyone has time, bbradley has written a short article about what to do to get support for a orion based device into the main kernel<br /><a href="http://nas-central.org/index.php/Orion_NAS_customisation_guide">http://nas-central.org/index.php/Orion_ … tion_guide</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61603">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						11 Jan 2008, 23:23					</div>
				</div>
				<div class="post-content content">
					<p>actually these guys from the mailing list won`t create the patches themselves. but they surely will review submitted patches.</p><p>as i know that there are at least some orion based routers (most likely they are storage enabled over usb), i recommend to get the GPL source for this routers and then you should read the orion guide which i linked in the post above again. </p><p>i am quite sure that 99 % is already done and that:</p><p>1) the mach types need to be registered<br />2) extract the info about the flash map (already done in this thread for one router) and the GPIO stuff <br />3) start a new setup file....outlined here: <a href="http://nas-central.org/index.php/Orion_NAS_customisation_guide#Board_Setup">http://nas-central.org/index.php/Orion_ … oard_Setup</a><br />(use the flash map already posted here in this thread and implement the GPIO stuff....you will also get the info from the GPL sources)</p><p>the main problem is that we from <a href="http://nas-central.org">http://nas-central.org</a> do not own an orion-based router so we cannot test ourselves (hey we hack NAS-devices already, you guys should hack the router part <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> ), so i encourage you to give it a look. as you guys already had a kernel booting you are already very far....finish it.</p>											<p class="post-edited">(Last edited by <strong>mindbender</strong> on 11 Jan 2008, 23:24)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 46</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>