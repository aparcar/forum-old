<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to upgrade just the kernel?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 14 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p256244">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">bytefire</div>
					<div class="post-datetime">
						2 Dec 2014, 09:39					</div>
				</div>
				<div class="post-content content">
					<p>The Chaos Calmer I&#039;m using has kernel version 3.10. I want kernel version 3.16 because an opkg package requires that.</p><p>Is there a way to upgrade just the Linux kernel without doing a sysupgrade?</p><p>Thanks!<br />------------------------------------</p><p>Here&#039;s the output:</p><p>root@OpenWrt:~# opkg install kmod-fs-cifs<br />Installing kmod-fs-cifs (3.14.25-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/base/kmod-fs-cifs_3.14.25-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ â€¦ r71xx.ipk.</a><br />Multiple packages (kmod-nls-base and kmod-nls-base) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-arc4 and kmod-crypto-arc4) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Multiple packages (kmod-crypto-core and kmod-crypto-core) providing same name marked HOLD or PREFER. Using latest.<br />Collected errors:<br /> * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-fs-cifs:<br /> * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * &nbsp; &nbsp; kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * kernel (= 3.14.25-1-79a167992252c6e7c1581c7763d1313a) * <br /> * opkg_install_cmd: Cannot install package kmod-fs-cifs.</p><p>-------------------------------------<br />CORRECTION ABOVE: It&#039;s Chaos Calmer that I am using, and not Barrier Breaker as posted earlier.</p>											<p class="post-edited">(Last edited by <strong>bytefire</strong> on 2 Dec 2014, 21:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256245">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						2 Dec 2014, 10:12					</div>
				</div>
				<div class="post-content content">
					<p>What package is that? There aren&#039;t any targets using 3.16 from what I know, there is no 3.16 support in target/linux/generic in either BB or trunk/CC.</p><p>Anyway, in-place kernel upgrades aren&#039;t supported. If you manage to do it, expect problems and, depending on your device, to run out of space, because of SquashFS.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256248">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">bytefire</div>
					<div class="post-datetime">
						2 Dec 2014, 10:25					</div>
				</div>
				<div class="post-content content">
					<p>Ah I see...</p><p>Well, it&#039;s kmod-fs-cifs package. On my system, it fails to install and comes back with a message about the missing dependency, kernel v 3.16. I can&#039;t post the exact message as I don&#039;t have access to the system at the moment. But I can do that later today.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256292">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						2 Dec 2014, 16:59					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;re using the wrong package repository.&nbsp; There is a 3.10 compile of kmod-fs-cifs under Barrier Breaker which will match your kernel.&nbsp; kmod packages must match the kernel version exactly, so they are usually compiled at the same time.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 2 Dec 2014, 17:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256317">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">bytefire</div>
					<div class="post-datetime">
						2 Dec 2014, 21:08					</div>
				</div>
				<div class="post-content content">
					<p>Thans mk24. Btw, it&#039;s Chaos Calmer that I&#039;m using and not Barrier Breaker. Please see the update on original post. I&#039;ve also posted the output.</p><p>How do can I ensure that I&#039;m using the correct package repository?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256324">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						2 Dec 2014, 21:33					</div>
				</div>
				<div class="post-content content">
					<p>You are using the correct repository. When kernel changes are made in trunk, the kernel packages have a config hash value in the version number, to prevent people from mixing incompatible kernel packages by accident. You can try installing with:<br /></p><div class="codebox"><pre><code>opkg --force-depends install ...</code></pre></div><p>It will bypass the version dependency, and install the package. Depending on how old your current kernel is it may work just fine. It may also not work at all, and in that case a sysupgrade is the only recommendable option.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256328">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">bytefire</div>
					<div class="post-datetime">
						2 Dec 2014, 22:09					</div>
				</div>
				<div class="post-content content">
					<p>makro, with --force-depends, it managed to a get a bit farther by installing severalother packages but in the end, still gave the same &quot;Cannot satisfy following dependencies&quot; message. However, when I ran `opkg list-installed` it showed kmod-fs-cifs as installed. But then when I tried to run insmod using this command: </p><p>`insmod /lib/modules/3.14.25/cifs.ko`</p><p>it failed. Following is the output from logread:</p><p>Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.900000] cifs: Unknown symbol kfree_put_link (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.900000] cifs: Unknown symbol __test_set_page_writeback (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.910000] cifs: Unknown symbol prepare_to_wait_event (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.920000] cifs: Unknown symbol crypto_shash_setkey (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.920000] cifs: Unknown symbol crypto_shash_update (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.930000] cifs: Unknown symbol crypto_shash_final (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.930000] cifs: Unknown symbol lockref_get (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.940000] cifs: Unknown symbol __fdget (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 kern.warn kernel: [1504576.940000] cifs: Unknown symbol crypto_alloc_shash (err 0)<br />Tue Dec&nbsp; 2 20:05:32 2014 user.err syslog: failed to insert /lib/modules/3.14.25/cifs.ko</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256329">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						2 Dec 2014, 22:31					</div>
				</div>
				<div class="post-content content">
					<p>Like makro said, your best option now is to sysupgrade to a new snapshot.&nbsp; The .opkg that you need no longer exists on the server.</p><p>You should also download the whole package tree of the snapshot, then in the future you will can always install a matching package from your local copy.&nbsp; wget or curl should work as an automated way to do that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256337">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mattventura</div>
					<div class="post-datetime">
						2 Dec 2014, 23:18					</div>
				</div>
				<div class="post-content content">
					<p>Kernel upgrades are ugly but possible. </p><p>The main thing is to remember that you&#039;ll need to compile and install completely new kernel modules as well. </p><p>If you&#039;re trying to do this without compiling your own build, you should probably stop and just sysupgrade. If you&#039;re using the builder, then you would compile the kernel, install it however your bootloader expects it to be installed, and then install your new kmod-*.ipk files. Keep in mind that they&#039;ll uninstall the old ones so you have to make a leap of faith to the new kernel or back up the old module files. Even then, it&#039;s not completely guaranteed to work perfectly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256339">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						2 Dec 2014, 23:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>You should also download the whole package tree of the snapshot, then in the future you will can always install a matching package from your local copy.&nbsp; wget or curl should work as an automated way to do that.</p></blockquote></div><p>The Imagebuilder file has all the compiled packages in it, so just download that and unpack it if needed. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257516">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">bytefire</div>
					<div class="post-datetime">
						12 Dec 2014, 22:33					</div>
				</div>
				<div class="post-content content">
					<p>Thanks everyone. From the suggestions given above, I resolved the issue by using a stable release. As a side note, there was another problem with limited memory. So I used Image Builder as described here <a href="http://wiki.openwrt.org/doc/howto/obtain.firmware.generate">http://wiki.openwrt.org/doc/howto/obtai â€¦ e.generate</a> to get rid of the packages I didn&#039;t need and to add the ones I did need.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>