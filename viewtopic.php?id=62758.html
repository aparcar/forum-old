<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Intercepting HTTPS/SSL with eBlocker?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p311458">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						15 Feb 2016, 07:19					</div>
				</div>
				<div class="post-content content">
					<p>I was browsing Kickstarter web-site earlier and stumbled upon the &quot;eblocker&quot; which is a closed source, subscription-based custom firmware for raspberry/banana pi featuring adblocker, cookie cutter and Tor. </p><p>What surprised me tho was the last Q&amp;A in their FAQ (<a href="https://www.eblocker.com/en/frequently-asked-questions-faq/">https://www.eblocker.com/en/frequently- â€¦ tions-faq/</a>) announcing that HTTPS/SSL support is coming in Spring 2016. </p><p>I thought the whole point of the HTTPS/SSL is that it guards you against MitM attack which essentially what eBlocker is planning to start doing in spring 2016. How is that possible?</p><p>PS. If you have a Raspberry Pi or Banana Pi you can download their image from <a href="https://www.eblocker.com/en/download/">https://www.eblocker.com/en/download/</a> and test-drive it for free until end of March.</p><p>PPS. Seems to be debian-based with hardcoded root password.</p>											<p class="post-edited">(Last edited by <strong>stangri</strong> on 15 Feb 2016, 08:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311498">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						15 Feb 2016, 12:21					</div>
				</div>
				<div class="post-content content">
					<p>You can intercept HTTPS traffic, as long as the client browser accepts your certificate, and you can do that in a controlled environment.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311506">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">augustus_meyer</div>
					<div class="post-datetime">
						15 Feb 2016, 13:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><p>I thought the whole point of the HTTPS/SSL is that it guards you against MitM attack which essentially what eBlocker is planning to start doing in spring 2016. How is that possible?</p></blockquote></div><p>It depends on, WHAT do you want to do with the https stream. <br />eduperez solution is the &quot;complete&quot; one. <br />There are other, much more limited solutions as well.<br />No need to ask for details, as I work on a commercial implementation :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311514">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">KHAN85</div>
					<div class="post-datetime">
						15 Feb 2016, 15:09					</div>
				</div>
				<div class="post-content content">
					<p>There are only 2 solutions available and NO more.</p><p>1. The solution what eduperez said. You can intercept https with mitm using SquidCache.</p><p>2. Without MITM, SSL/TLS implementation of browsers send domain in plain text when connect. The field is called SNI. <a href="https://en.wikipedia.org/wiki/Server_Name_Indication">https://en.wikipedia.org/wiki/Server_Name_Indication</a></p><p>I guess eBlock will use the solution #2.</p>											<p class="post-edited">(Last edited by <strong>KHAN85</strong> on 15 Feb 2016, 15:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311571">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						15 Feb 2016, 22:07					</div>
				</div>
				<div class="post-content content">
					<p>Either way, the certificate presented to the consumer will not be signed by recognized CA and will require either manually adding a new CA to the system once or confirmation to proceed despite unauthenticated certificate for each HTTPS visit, right?</p>											<p class="post-edited">(Last edited by <strong>stangri</strong> on 15 Feb 2016, 22:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311587">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">KHAN85</div>
					<div class="post-datetime">
						16 Feb 2016, 00:17					</div>
				</div>
				<div class="post-content content">
					<p>If you do a MITM, you need to install a fake CA or manually accept every fake cert in the browser. You can do a MITM with this <a href="http://wiki.squid-cache.org/Features/SslBump">http://wiki.squid-cache.org/Features/SslBump</a></p><p>If you only want the domain (SNI field), no warning will appear to the user, because SNI field is not encrypted.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311670">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						16 Feb 2016, 15:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><p>Either way, the certificate presented to the consumer will not be signed by recognized CA and will require either manually adding a new CA to the system once or confirmation to proceed despite unauthenticated certificate for each HTTPS visit, right?</p></blockquote></div><p>Yes, exactly; that is why I mentioned that the client browser must accept your certificate, and you need a &quot;controlled environment&quot;. If you do that at home, you can tell all your family members to accept the certificate; if you do that at a company, you can distribute and install the certificate in all computers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311733">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						16 Feb 2016, 21:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KHAN85 wrote:</cite><blockquote><p>If you only want the domain (SNI field), no warning will appear to the user, because SNI field is not encrypted.</p></blockquote></div><p>Please elaborate on that. So if I have a page served over HTTPS which includes ads content (also HTTPS) you&#039;d be able to serve a hidden pixel instead of the ads and no warning will appear to the user?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311793">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						17 Feb 2016, 10:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><div class="quotebox"><cite>KHAN85 wrote:</cite><blockquote><p>If you only want the domain (SNI field), no warning will appear to the user, because SNI field is not encrypted.</p></blockquote></div><p>Please elaborate on that. So if I have a page served over HTTPS which includes ads content (also HTTPS) you&#039;d be able to serve a hidden pixel instead of the ads and no warning will appear to the user?</p></blockquote></div><p>If you could do that, then HTTPS would be worthless... you can know the destination of a certain connection, but you cannot tamper with it. For a domain-based filter, you can just configure the DNS in your network to answer wrong IP addresses for blacklisted domains (search for &quot;dnsmasq adblock&quot; around here for more info).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311820">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">KHAN85</div>
					<div class="post-datetime">
						17 Feb 2016, 13:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><div class="quotebox"><cite>KHAN85 wrote:</cite><blockquote><p>If you only want the domain (SNI field), no warning will appear to the user, because SNI field is not encrypted.</p></blockquote></div><p>Please elaborate on that. So if I have a page served over HTTPS which includes ads content (also HTTPS) you&#039;d be able to serve a hidden pixel instead of the ads and no warning will appear to the user?</p></blockquote></div><p>No, SNI field tells you the domain of https connection, nothing more. You can view this field with a network sniffer, like wireshark. You can block the connection of ADS, but there&#039;s no way to modify the content of a https connection without install a fake CA or accept a fake cert warning. i.e: no hidden pixel will appear, just ads connections are blocked.</p><p>I guess eBlocker just block connections of ads domains.</p><p>Like eduperez said, you can block connections by domain using dns, in OpenWRT dnsmasq will use /etc/host file to load a list of domains, you can force dns use to dnsmasq with a iptables rule in OpenWRT, there is a lot of information about that in this forum.</p><p>By the other side SNI field will tell you the domain of https (only) connections, if you want to block https connections and no all connections to a domain you can code a soft that it reads SNI field and close unwanted connections, I guess eBlocker use this to block connections over https.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311936">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						18 Feb 2016, 06:46					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for replies you guys, I&#039;m familiar with dnsmasq-based adblocking. </p><p>So I take it that without messing up with the certs, they can&#039;t tamper the traffic stream and best they can do is to drop certain domain-based requests which would result in &quot;broken images&quot; instead of the ads on the pages.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>