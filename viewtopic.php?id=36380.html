<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> DNSCrypt setup — securing DNS communications</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 29 Mar 2018 and 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 6</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=36380&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=36380&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=36380&amp;p=6.html">6</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p165418">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						22 Apr 2012, 14:56					</div>
				</div>
				<div class="post-content content">
					<p>OpenDNS, the free DNS provider, offers new way to protect clients against attacks related to modification and manipulation of DNS traffic — DNSCrypt. The main objectives of DNSCrypt is full encryption of the communication channel between the client (you) and server (OpenDNS) — roughly as SSL is used to encrypt HTTP traffic. <a href="http://wiki.openwrt.org/inbox/dnscrypt">read more »</a></p><br /><p><strong>INSTALLATION FOR DESIGNATED DRIVER</strong><br />Simply use:<br /></p><div class="codebox"><pre><code>opkg update
opkg install dnscrypt-proxy</code></pre></div><br /><p><strong>INSTALLATION FOR CHAOS CALMER 15.05 AND BARRIER BREAKER 14.07</strong><br />See README: <a href="https://github.com/black-roland/exOpenWrt#chaos-calmer">https://github.com/black-roland/exOpenWrt#chaos-calmer</a></p><br /><p><strong>CONFIGURATION</strong><br />Information about configuration can be found on the wiki page: <a href="http://wiki.openwrt.org/inbox/dnscrypt#configuration">http://wiki.openwrt.org/inbox/dnscrypt#configuration</a></p><br /><p><strong>BUILDING FROM SOURCE (EXOPENWRT)</strong><br />Using <a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence">OpenWrt Buildroot – Installation</a> complete these steps:<br />Prepare Buildroot<br /></p><div class="codebox"><pre><code>$ mkdir ~/openwrt
$ cd ~/openwrt
$ svn co svn://svn.openwrt.org/openwrt/trunk/
$ cd trunk</code></pre></div><p>Using <a href="http://wiki.openwrt.org/doc/devel/feeds">OpenWrt Feeds</a> add a new source to your feeds.conf:<br /></p><div class="codebox"><pre><code>$ echo &quot;src-git exopenwrt https://github.com/black-roland/exOpenWrt.git&quot; &gt;&gt; feeds.conf</code></pre></div><p>Download and install feeds:<br /></p><div class="codebox"><pre><code>$ ./scripts/feeds update -a
$ ./scripts/feeds install dnscrypt-proxy</code></pre></div><p>Configure target system:<br /></p><div class="codebox"><pre><code>make menuconfig</code></pre></div><p>Select Target System and Target Profile, for example:<br /></p><div class="codebox"><pre><code>Target System (Atheros AR7xxx/AR9xxx)  ---&gt;
    (X) Atheros AR7xxx/AR9xxx
Target Profile (TP-LINK TL-MR3220)  ---&gt;
    (X) TP-LINK TL-MR3220</code></pre></div><p>Select dnscrypt-proxy and hostip (optionaly), exit and save changes:<br /></p><div class="codebox"><pre><code>Network  ---&gt;
    IP Addresses and Names  ---&gt;
        &lt;*&gt; dnscrypt-proxy
        &lt;*&gt; hostip</code></pre></div><p>Now compile tools and toolchain<br /></p><div class="codebox"><pre><code>$ make tools/install
$ make toolchain/install</code></pre></div><p>Finally compile dnscrypt-proxy package:<br /></p><div class="codebox"><pre><code>$ make V=s package/feeds/exopenwrt/dnscrypt-proxy/{clean,compile}</code></pre></div><p>Compiled <em>dnscrypt-proxy_***_ar71xx.ipk</em> package can be found in <em>~/openwrt/trunk/bin</em>.</p><br /><p><em>See also</em><br /><a href="http://wiki.openwrt.org/inbox/dnscrypt">DNSCrypt on wiki</a><br /><a href="http://wiki.openwrt.org/doc/uci/dhcp">DNS and DHCP configuration</a><br /><a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence/">OpenWrt Buildroot – Installation</a><br /><a href="http://wiki.openwrt.org/doc/howtobuild/single.package/">How to Build a Single Package</a><br /><a href="http://wiki.openwrt.org/doc/devel/feeds">OpenWrt Feeds</a></p><p><em>Links</em><br /><a href="https://github.com/black-roland/exOpenWrt">My OpenWrt repo on GitHub</a><br /><a href="https://www.opendns.com/technology/dnscrypt/">Introducing DNSCrypt</a><br /><a href="https://github.com/jedisct1/dnscrypt-proxy">dnscrypt-proxy project on GitHub</a><br /><a href="https://github.com/Entware/rtndev">Original Makefile</a> (Thanks to ryzhovau)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167252">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						13 May 2012, 17:28					</div>
				</div>
				<div class="post-content content">
					<p>-</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167679">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Rabbit99</div>
					<div class="post-datetime">
						18 May 2012, 19:03					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m using this package and it appears to be working well plus it was easy to install and configure.</p><p>Can it be made an &quot;official&quot; OpenWRT package?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167769">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">lagonauta</div>
					<div class="post-datetime">
						20 May 2012, 05:04					</div>
				</div>
				<div class="post-content content">
					<p>Great How-To, but it seems that it has some memory leak, this is what happened after lots of requests: (15k?) (this is my entire kernel log from luci)</p><p>Well, for some time I will keep it disabled.</p><div class="codebox"><pre><code>[14074.160000] ath: skbuff alloc of size 1926 failed
[14074.160000] dnscrypt-proxy: page allocation failure: order:0, mode:0x4020
[14074.160000] Call Trace:[&lt;802663e8&gt;] 0x802663e8
[14074.160000] [&lt;802663e8&gt;] 0x802663e8
[14074.160000] [&lt;800ad368&gt;] 0x800ad368
[14074.160000] [&lt;800af668&gt;] 0x800af668
[14074.160000] [&lt;802d0000&gt;] 0x802d0000
[14074.160000] [&lt;800d2e60&gt;] 0x800d2e60
[14074.160000] [&lt;80071ca4&gt;] 0x80071ca4
[14074.160000] [&lt;80267834&gt;] 0x80267834
[14074.160000] [&lt;800721e0&gt;] 0x800721e0
[14074.160000] [&lt;800d4838&gt;] 0x800d4838
[14074.160000] [&lt;801d6c44&gt;] 0x801d6c44
[14074.160000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14074.160000] [&lt;801d6be8&gt;] 0x801d6be8
[14074.160000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14074.160000] [&lt;81fa6d4c&gt;] 0x81fa6d4c
[14074.160000] [&lt;8008e064&gt;] 0x8008e064
[14074.160000] [&lt;8009659c&gt;] 0x8009659c
[14074.160000] [&lt;81fa4318&gt;] 0x81fa4318
[14074.160000] [&lt;80076300&gt;] 0x80076300
[14074.160000] [&lt;80076824&gt;] 0x80076824
[14074.160000] [&lt;80076a30&gt;] 0x80076a30
[14074.160000] [&lt;80089360&gt;] 0x80089360
[14074.160000] [&lt;80076c64&gt;] 0x80076c64
[14074.160000] [&lt;80062d2c&gt;] 0x80062d2c
[14074.160000] 
[14074.160000] Mem-Info:
[14074.160000] Normal per-cpu:
[14074.160000] CPU    0: hi:    0, btch:   1 usd:   0
[14074.160000] active_anon:614 inactive_anon:18 isolated_anon:0
[14074.160000]  active_file:1164 inactive_file:1399 isolated_file:0
[14074.160000]  unevictable:0 dirty:0 writeback:0 unstable:0
[14074.160000]  free:68 slab_reclaimable:371 slab_unreclaimable:2725
[14074.160000]  mapped:473 shmem:56 pagetables:85 bounce:0
[14074.160000] Normal free:272kB min:720kB low:900kB high:1080kB active_anon:2456kB inactive_anon:72kB active_file:4656kB inactive_file:5596kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:32512kB mlocked:0kB dirty:0kB writeback:0kB mapped:1892kB shmem:224kB slab_reclaimable:1484kB slab_unreclaimable:10900kB kernel_stack:368kB pagetables:340kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no
[14074.160000] lowmem_reserve[]: 0 0
[14074.160000] Normal: 54*4kB 1*8kB 1*16kB 1*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 272kB
[14074.160000] 2619 total pagecache pages
[14074.160000] 0 pages in swap cache
[14074.160000] Swap cache stats: add 0, delete 0, find 0/0
[14074.160000] Free swap  = 0kB
[14074.160000] Total swap = 0kB
[14074.160000] 8192 pages RAM
[14074.160000] 820 pages reserved
[14074.160000] 2465 pages shared
[14074.160000] 6165 pages non-shared
[14074.160000] SLUB: Unable to allocate memory on node -1 (gfp=0x20)
[14074.160000]   cache: kmalloc-4096, object size: 4096, buffer size: 4096, default order: 3, min order: 0
[14074.160000]   node 0: slabs: 0, objs: 0, free: 0
[14074.390000] ath: skbuff alloc of size 1926 failed
[14074.400000] dnscrypt-proxy: page allocation failure: order:0, mode:0x4020
[14074.400000] Call Trace:[&lt;802663e8&gt;] 0x802663e8
[14074.400000] [&lt;802663e8&gt;] 0x802663e8
[14074.400000] [&lt;800ad368&gt;] 0x800ad368
[14074.400000] [&lt;800af668&gt;] 0x800af668
[14074.400000] [&lt;80194714&gt;] 0x80194714
[14074.400000] [&lt;802d0000&gt;] 0x802d0000
[14074.400000] [&lt;800d2e60&gt;] 0x800d2e60
[14074.400000] [&lt;80267834&gt;] 0x80267834
[14074.400000] [&lt;800721e0&gt;] 0x800721e0
[14074.400000] [&lt;80072200&gt;] 0x80072200
[14074.400000] [&lt;800d4838&gt;] 0x800d4838
[14074.400000] [&lt;801d6c44&gt;] 0x801d6c44
[14074.400000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14074.400000] [&lt;801d6be8&gt;] 0x801d6be8
[14074.400000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14074.400000] [&lt;81fa6d4c&gt;] 0x81fa6d4c
[14074.400000] [&lt;8008e064&gt;] 0x8008e064
[14074.400000] [&lt;8009659c&gt;] 0x8009659c
[14074.400000] [&lt;81fa4318&gt;] 0x81fa4318
[14074.400000] [&lt;80076300&gt;] 0x80076300
[14074.400000] [&lt;80076824&gt;] 0x80076824
[14074.400000] [&lt;80076a30&gt;] 0x80076a30
[14074.400000] [&lt;80089360&gt;] 0x80089360
[14074.400000] [&lt;80076c64&gt;] 0x80076c64
[14074.400000] [&lt;80062d2c&gt;] 0x80062d2c
[14074.400000] 
[14074.400000] Mem-Info:
[14074.400000] Normal per-cpu:
[14074.400000] CPU    0: hi:    0, btch:   1 usd:   0
[14074.400000] active_anon:614 inactive_anon:18 isolated_anon:0
[14074.400000]  active_file:1164 inactive_file:1399 isolated_file:0
[14074.400000]  unevictable:0 dirty:0 writeback:0 unstable:0
[14074.400000]  free:68 slab_reclaimable:371 slab_unreclaimable:2725
[14074.400000]  mapped:473 shmem:56 pagetables:85 bounce:0
[14074.400000] Normal free:272kB min:720kB low:900kB high:1080kB active_anon:2456kB inactive_anon:72kB active_file:4656kB inactive_file:5596kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:32512kB mlocked:0kB dirty:0kB writeback:0kB mapped:1892kB shmem:224kB slab_reclaimable:1484kB slab_unreclaimable:10900kB kernel_stack:368kB pagetables:340kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no
[14074.400000] lowmem_reserve[]: 0 0
[14074.400000] Normal: 54*4kB 1*8kB 1*16kB 1*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 272kB
[14074.400000] 2619 total pagecache pages
[14074.400000] 0 pages in swap cache
[14074.400000] Swap cache stats: add 0, delete 0, find 0/0
[14074.400000] Free swap  = 0kB
[14074.400000] Total swap = 0kB
[14074.400000] 8192 pages RAM
[14074.400000] 820 pages reserved
[14074.400000] 2465 pages shared
[14074.400000] 6165 pages non-shared
[14074.400000] SLUB: Unable to allocate memory on node -1 (gfp=0x20)
[14074.400000]   cache: kmalloc-4096, object size: 4096, buffer size: 4096, default order: 3, min order: 0
[14074.400000]   node 0: slabs: 0, objs: 0, free: 0
[14074.640000] ath: skbuff alloc of size 1926 failed
[14074.640000] dnscrypt-proxy: page allocation failure: order:0, mode:0x4020
[14074.640000] Call Trace:[&lt;802663e8&gt;] 0x802663e8
[14074.640000] [&lt;802663e8&gt;] 0x802663e8
[14074.640000] [&lt;800ad368&gt;] 0x800ad368
[14074.640000] [&lt;800af668&gt;] 0x800af668
[14074.640000] [&lt;802d0000&gt;] 0x802d0000
[14074.640000] [&lt;800d2e60&gt;] 0x800d2e60
[14074.640000] [&lt;80071ca4&gt;] 0x80071ca4
[14074.640000] [&lt;80267834&gt;] 0x80267834
[14074.640000] [&lt;800721e0&gt;] 0x800721e0
[14074.640000] [&lt;800d4838&gt;] 0x800d4838
[14074.640000] [&lt;801d6c44&gt;] 0x801d6c44
[14074.640000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14074.640000] [&lt;801d6be8&gt;] 0x801d6be8
[14074.640000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14074.640000] [&lt;81fa6d4c&gt;] 0x81fa6d4c
[14074.640000] [&lt;8008e064&gt;] 0x8008e064
[14074.640000] [&lt;8009659c&gt;] 0x8009659c
[14074.640000] [&lt;81fa4318&gt;] 0x81fa4318
[14074.640000] [&lt;80076300&gt;] 0x80076300
[14074.640000] [&lt;80076824&gt;] 0x80076824
[14074.640000] [&lt;80076a30&gt;] 0x80076a30
[14074.640000] [&lt;80089360&gt;] 0x80089360
[14074.640000] [&lt;80076c64&gt;] 0x80076c64
[14074.640000] [&lt;80062d2c&gt;] 0x80062d2c
[14074.640000] 
[14074.640000] Mem-Info:
[14074.640000] Normal per-cpu:
[14074.640000] CPU    0: hi:    0, btch:   1 usd:   0
[14074.640000] active_anon:614 inactive_anon:18 isolated_anon:0
[14074.640000]  active_file:1164 inactive_file:1399 isolated_file:0
[14074.640000]  unevictable:0 dirty:0 writeback:0 unstable:0
[14074.640000]  free:68 slab_reclaimable:371 slab_unreclaimable:2725
[14074.640000]  mapped:473 shmem:56 pagetables:85 bounce:0
[14074.640000] Normal free:272kB min:720kB low:900kB high:1080kB active_anon:2456kB inactive_anon:72kB active_file:4656kB inactive_file:5596kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:32512kB mlocked:0kB dirty:0kB writeback:0kB mapped:1892kB shmem:224kB slab_reclaimable:1484kB slab_unreclaimable:10900kB kernel_stack:368kB pagetables:340kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no
[14074.640000] lowmem_reserve[]: 0 0
[14074.640000] Normal: 54*4kB 1*8kB 1*16kB 1*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 272kB
[14074.640000] 2619 total pagecache pages
[14074.640000] 0 pages in swap cache
[14074.640000] Swap cache stats: add 0, delete 0, find 0/0
[14074.640000] Free swap  = 0kB
[14074.640000] Total swap = 0kB
[14074.640000] 8192 pages RAM
[14074.640000] 820 pages reserved
[14074.640000] 2465 pages shared
[14074.640000] 6165 pages non-shared
[14074.640000] SLUB: Unable to allocate memory on node -1 (gfp=0x20)
[14074.640000]   cache: kmalloc-4096, object size: 4096, buffer size: 4096, default order: 3, min order: 0
[14074.640000]   node 0: slabs: 0, objs: 0, free: 0
[14074.880000] ath: skbuff alloc of size 1926 failed
[14074.880000] dnscrypt-proxy: page allocation failure: order:0, mode:0x4020
[14074.880000] Call Trace:[&lt;802663e8&gt;] 0x802663e8
[14074.880000] [&lt;802663e8&gt;] 0x802663e8
[14074.880000] [&lt;800ad368&gt;] 0x800ad368
[14074.880000] [&lt;800af668&gt;] 0x800af668
[14074.880000] [&lt;802d0000&gt;] 0x802d0000
[14074.880000] [&lt;800d2e60&gt;] 0x800d2e60
[14074.880000] [&lt;80071ca4&gt;] 0x80071ca4
[14074.880000] [&lt;80267834&gt;] 0x80267834
[14074.880000] [&lt;800721e0&gt;] 0x800721e0
[14074.880000] [&lt;800d4838&gt;] 0x800d4838
[14074.880000] [&lt;801d6c44&gt;] 0x801d6c44
[14074.880000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14074.880000] [&lt;801d6be8&gt;] 0x801d6be8
[14074.880000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14074.880000] [&lt;81fa6d4c&gt;] 0x81fa6d4c
[14074.880000] [&lt;8008e064&gt;] 0x8008e064
[14074.880000] [&lt;8009659c&gt;] 0x8009659c
[14074.880000] [&lt;81fa4318&gt;] 0x81fa4318
[14074.880000] [&lt;80076300&gt;] 0x80076300
[14074.880000] [&lt;80076824&gt;] 0x80076824
[14074.880000] [&lt;80076a30&gt;] 0x80076a30
[14074.880000] [&lt;80089360&gt;] 0x80089360
[14074.880000] [&lt;80076c64&gt;] 0x80076c64
[14074.880000] [&lt;80062d2c&gt;] 0x80062d2c
[14074.880000] 
[14074.880000] Mem-Info:
[14074.880000] Normal per-cpu:
[14074.880000] CPU    0: hi:    0, btch:   1 usd:   0
[14074.880000] active_anon:614 inactive_anon:18 isolated_anon:0
[14074.880000]  active_file:1164 inactive_file:1399 isolated_file:0
[14074.880000]  unevictable:0 dirty:0 writeback:0 unstable:0
[14074.880000]  free:68 slab_reclaimable:371 slab_unreclaimable:2725
[14074.880000]  mapped:473 shmem:56 pagetables:85 bounce:0
[14074.880000] Normal free:272kB min:720kB low:900kB high:1080kB active_anon:2456kB inactive_anon:72kB active_file:4656kB inactive_file:5596kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:32512kB mlocked:0kB dirty:0kB writeback:0kB mapped:1892kB shmem:224kB slab_reclaimable:1484kB slab_unreclaimable:10900kB kernel_stack:368kB pagetables:340kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no
[14074.880000] lowmem_reserve[]: 0 0
[14074.880000] Normal: 54*4kB 1*8kB 1*16kB 1*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 272kB
[14074.880000] 2619 total pagecache pages
[14074.880000] 0 pages in swap cache
[14074.880000] Swap cache stats: add 0, delete 0, find 0/0
[14074.880000] Free swap  = 0kB
[14074.880000] Total swap = 0kB
[14074.880000] 8192 pages RAM
[14074.880000] 820 pages reserved
[14074.880000] 2465 pages shared
[14074.880000] 6165 pages non-shared
[14074.880000] SLUB: Unable to allocate memory on node -1 (gfp=0x20)
[14074.880000]   cache: kmalloc-4096, object size: 4096, buffer size: 4096, default order: 3, min order: 0
[14074.880000]   node 0: slabs: 0, objs: 0, free: 0
[14075.120000] ath: skbuff alloc of size 1926 failed
[14075.120000] dnscrypt-proxy: page allocation failure: order:0, mode:0x4020
[14075.120000] Call Trace:[&lt;802663e8&gt;] 0x802663e8
[14075.120000] [&lt;802663e8&gt;] 0x802663e8
[14075.120000] [&lt;800ad368&gt;] 0x800ad368
[14075.120000] [&lt;800af668&gt;] 0x800af668
[14075.120000] [&lt;802d0000&gt;] 0x802d0000
[14075.120000] [&lt;800d2e60&gt;] 0x800d2e60
[14075.120000] [&lt;80071ca4&gt;] 0x80071ca4
[14075.120000] [&lt;80267834&gt;] 0x80267834
[14075.120000] [&lt;800721e0&gt;] 0x800721e0
[14075.120000] [&lt;800d4838&gt;] 0x800d4838
[14075.120000] [&lt;801d6c44&gt;] 0x801d6c44
[14075.120000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14075.120000] [&lt;801d6be8&gt;] 0x801d6be8
[14075.120000] [&lt;814bc0c0&gt;] 0x814bc0c0
[14075.120000] [&lt;81fa6d4c&gt;] 0x81fa6d4c
[14075.120000] [&lt;8008e064&gt;] 0x8008e064
[14075.120000] [&lt;8009659c&gt;] 0x8009659c
[14075.120000] [&lt;8006da01&gt;] 0x8006da01
[14075.120000] [&lt;81fa4318&gt;] 0x81fa4318
[14075.120000] [&lt;80076300&gt;] 0x80076300
[14075.120000] [&lt;80076824&gt;] 0x80076824
[14075.120000] [&lt;80076a30&gt;] 0x80076a30
[14075.120000] [&lt;80089360&gt;] 0x80089360
[14075.120000] [&lt;80076c64&gt;] 0x80076c64
[14075.120000] [&lt;80062d2c&gt;] 0x80062d2c
[14075.120000] 
[14075.120000] Mem-Info:
[14075.120000] Normal per-cpu:
[14075.120000] CPU    0: hi:    0, btch:   1 usd:   0
[14075.120000] active_anon:614 inactive_anon:18 isolated_anon:0
[14075.120000]  active_file:1164 inactive_file:1399 isolated_file:0
[14075.120000]  unevictable:0 dirty:0 writeback:0 unstable:0
[14075.120000]  free:68 slab_reclaimable:371 slab_unreclaimable:2725
[14075.120000]  mapped:473 shmem:56 pagetables:85 bounce:0
[14075.120000] Normal free:272kB min:720kB low:900kB high:1080kB active_anon:2456kB inactive_anon:72kB active_file:4656kB inactive_file:5596kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:32512kB mlocked:0kB dirty:0kB writeback:0kB mapped:1892kB shmem:224kB slab_reclaimable:1484kB slab_unreclaimable:10900kB kernel_stack:368kB pagetables:340kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no
[14075.120000] lowmem_reserve[]: 0 0
[14075.120000] Normal: 54*4kB 1*8kB 1*16kB 1*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 272kB
[14075.120000] 2619 total pagecache pages
[14075.120000] 0 pages in swap cache
[14075.120000] Swap cache stats: add 0, delete 0, find 0/0
[14075.120000] Free swap  = 0kB
[14075.120000] Total swap = 0kB
[14075.120000] 8192 pages RAM
[14075.120000] 820 pages reserved
[14075.120000] 2465 pages shared
[14075.120000] 6165 pages non-shared
[14075.120000] SLUB: Unable to allocate memory on node -1 (gfp=0x20)
[14075.120000]   cache: kmalloc-4096, object size: 4096, buffer size: 4096, default order: 3, min order: 0
[14075.120000]   node 0: slabs: 0, objs: 0, free: 0
[14075.360000] ath: skbuff alloc of size 1926 failed
[14075.360000] ath: skbuff alloc of size 1926 failed
[14075.370000] ath: skbuff alloc of size 1926 failed
[14075.370000] ath: skbuff alloc of size 1926 failed
[14075.380000] ath: skbuff alloc of size 1926 failed
[14075.380000] ath: skbuff alloc of size 1926 failed
[14075.390000] ath: skbuff alloc of size 1926 failed
[14075.390000] ath: skbuff alloc of size 1926 failed
[14075.400000] ath: skbuff alloc of size 1926 failed
[14075.400000] ath: skbuff alloc of size 1926 failed
[14075.410000] ath: skbuff alloc of size 1926 failed
[14075.410000] ath: skbuff alloc of size 1926 failed
[14075.420000] ath: skbuff alloc of size 1926 failed
[14075.420000] ath: skbuff alloc of size 1926 failed
[14075.420000] ath: skbuff alloc of size 1926 failed
[14075.430000] ath: skbuff alloc of size 1926 failed
[14075.430000] ath: skbuff alloc of size 1926 failed
[14075.440000] ath: skbuff alloc of size 1926 failed
[14075.440000] ath: skbuff alloc of size 1926 failed
[14075.450000] ath: skbuff alloc of size 1926 failed
[14075.450000] ath: skbuff alloc of size 1926 failed
[14075.460000] ath: skbuff alloc of size 1926 failed
[14075.460000] ath: skbuff alloc of size 1926 failed
[14075.470000] ath: skbuff alloc of size 1926 failed
[14075.470000] ath: skbuff alloc of size 1926 failed
[14075.480000] ath: skbuff alloc of size 1926 failed
[14075.480000] ath: skbuff alloc of size 1926 failed
[14075.490000] ath: skbuff alloc of size 1926 failed
[14075.490000] ath: skbuff alloc of size 1926 failed
[14075.500000] ath: skbuff alloc of size 1926 failed
[14075.500000] ath: skbuff alloc of size 1926 failed
[14075.500000] ath: skbuff alloc of size 1926 failed
[14075.510000] ath: skbuff alloc of size 1926 failed
[14075.510000] ath: skbuff alloc of size 1926 failed
[14075.520000] eth1: out of memory</code></pre></div><p>System log:</p><div class="codebox"><pre><code>May 19 22:50:09 OpenWrt kern.info kernel: emory on node -1 (gfp=0x20)
May 19 22:50:09 OpenWrt kern.warn kernel: [14073.920000]   cache: kmalloc-4096, object size: 4096, buffer size: 4096, default order: 3, min order: 0
May 19 22:50:09 OpenWrt kern.warn kernel: [14073.920000]   node 0: slabs: 0, objs: 0, free: 0
May 19 22:50:09 OpenWrt kern.err kernel: [14074.160000] ath: skbuff alloc of size 1926 failed
May 19 22:50:09 OpenWrt kern.warn kernel: [14074.160000] dnscrypt-proxy: page allocation failure: order:0, mode:0x4020
May 19 22:50:09 OpenWrt kern.warn kernel: [14074.160000] Call Trace:[&lt;802663e8&gt;] 0x802663e8
May 19 22:50:09 OpenWrt kern.warn kernel: [14074.160000] [&lt;802663e8&gt;] 0x802663e8
May 19 22:50:09 OpenWrt kern.warn kernel: [14074.160000] [&lt;800ad368&gt;] 0x800ad368
May 19 22:50:09 OpenWrt kern.warn kernel: [14074.160000] [&lt;800af668&gt;] 0x800af668
May 19 22:50:09 OpenWrt kern.warn kernel: [14074.160000] [&lt;802d0000&gt;] 0x802d0000
May 19 22:50:09 OpenWrt kern.warn kernel: [14074.160000] [&lt;800d2e60&gt;] 0x800d2e60
May 19 22:50:09 OpenWrt kern.warn kernel: [14074.160000] [&lt;80071ca4&gt;] 0x80071ca4</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167771">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						20 May 2012, 06:06					</div>
				</div>
				<div class="post-content content">
					<p><strong>lagonauta</strong>, I also noticed an increase of VSZ after several incorrect certificate requests. I&#039;ll try write a bug report to the author.<br />How much memory is available on your router (run <em>free</em> command)?</p><p><a href="https://github.com/opendns/dnscrypt-proxy/issues/8">https://github.com/opendns/dnscrypt-proxy/issues/8</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167781">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">lagonauta</div>
					<div class="post-datetime">
						20 May 2012, 16:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Black Roland wrote:</cite><blockquote><p><strong>lagonauta</strong>, I also noticed an increase of VSZ after several incorrect certificate requests. I&#039;ll try write a bug report to the author.<br />How much memory is available on your router (run <em>free</em> command)?</p><p><a href="https://github.com/opendns/dnscrypt-proxy/issues/8">https://github.com/opendns/dnscrypt-proxy/issues/8</a></p></blockquote></div><p>Here it is: (with dnscrypt disabled)</p><div class="codebox"><pre><code>             total         used         free       shared      buffers
Mem:         29488        26684         2804            0         2160
-/+ buffers:              24524         4964
Swap:            0            0            0</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167839">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						21 May 2012, 11:27					</div>
				</div>
				<div class="post-content content">
					<p><strong>lagonauta</strong>, Try with <em>--max-active-requests=64</em> option. Please test using a different values (less than 64).<br />Sample init script (/etc/init.d/dnscrypt-proxy):<br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common
# Copyright (C) 2006-2012 OpenWrt.org

START=50

LISTEN_ADDR=127.0.0.1
LISTEN_PORT=2053

start() {
    service_start /usr/sbin/dnscrypt-proxy -d \
        -a $LISTEN_ADDR \
        -P $LISTEN_PORT \
        --max-active-requests=64 \
        -u nobody
}

stop() {
    service_stop /usr/sbin/dnscrypt-proxy
}</code></pre></div><p>On my router after &gt;1000 queries the memory does not increase.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167890">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">lagonauta</div>
					<div class="post-datetime">
						22 May 2012, 05:29					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, I will test tomorrow <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>But won&#039;t this hinder the performance?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167896">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						22 May 2012, 07:39					</div>
				</div>
				<div class="post-content content">
					<p><strong>lagonauta</strong>, Insignificantly. If you are single router user, the performance will not change. For me benchmark test are similar.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167897">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ryzhov_al</div>
					<div class="post-datetime">
						22 May 2012, 07:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Black Roland wrote:</cite><blockquote><p><strong>lagonauta</strong>, Insignificantly. If you are single router user, the performance will not change. For me benchmark test are similar.</p></blockquote></div><p>Yes. It does not matter whether we like it or not, it depends on available RAM on a router. Let me <a href="https://github.com/opendns/dnscrypt-proxy/issues/8#issuecomment-5812212">quote</a> DNSCrypt&#039;s author:<br /></p><div class="quotebox"><cite>jedisct1 wrote:</cite><blockquote><p>Also, by default, dnscrypt accepts and processes up to 250 parallel connections. That can take up to 15 Mb RAM.</p><p>If this is way too much for your device, lower this value to something more reasonable (each connection needs 64 Kb) with --max-active-requests=...</p></blockquote></div><p>PS Glad my package is useful for someone.<br />PPS Package updated to v0.9.4. Is it better to link it with a nacl library from packages instead of bundled one? Or it may causes performance decrease?</p>											<p class="post-edited">(Last edited by <strong>ryzhov_al</strong> on 22 May 2012, 09:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167915">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">lagonauta</div>
					<div class="post-datetime">
						22 May 2012, 15:37					</div>
				</div>
				<div class="post-content content">
					<p>Here it is like seven router users, hehe. Will test anyway <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>EDIT:</p><p>It seems that after some time the process just kills itself o.O<br />I couldn&#039;t find it with the command top, and my browser was resolving the names. But according to OpenDNS website I wasn&#039;t using it!</p><p>I have nothing on my log about that, it was full of wireless authentications.<br />Will keep monitoring.</p><p>EDIT2:</p><p>Just confirmed: it is killing itself and not writing anything on the log.<br />I am using latest version here, and I compiled it myself.</p>											<p class="post-edited">(Last edited by <strong>lagonauta</strong> on 23 May 2012, 02:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168267">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						27 May 2012, 12:06					</div>
				</div>
				<div class="post-content content">
					<p><strong>lagonauta</strong>, I thought this problem only for me <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> It is segmentation fault error. I don&#039;t know reason of this, but I try to test latest git version. P.S. 0.9.3 version works fine: <a href="http://bit.ly/LtkQxE">http://bit.ly/LtkQxE</a></p><p>UPD<br />I think this bug in libuv, but I don&#039;t know how to fix it. PC version works good.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169428">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">ryzhov_al</div>
					<div class="post-datetime">
						8 Jun 2012, 15:48					</div>
				</div>
				<div class="post-content content">
					<p><strong>Black Roland</strong>, please test last version with <a href="http://pastebin.com/hdiK5C1t">my patch</a>.</p><p>I suspect it&#039;s my fault initially. I turned off&nbsp; <strong>-fstack-protector</strong> but forgot about <strong>-D_FORTIFY_SOURCE=2</strong>, also removed some weird linker flags.</p><p>dnscrypt-proxy 0.9.5 tested for two days under quite heavy load (~8000 DNS names resolved) and there is no sign of memleak (under Valgrind too). Memory heap <a href="http://pastebin.com/uUqvSd0p">raised</a> from 60 to 600Kb and stops growing at this point.</p>											<p class="post-edited">(Last edited by <strong>ryzhov_al</strong> on 8 Jun 2012, 16:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169433">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						8 Jun 2012, 17:25					</div>
				</div>
				<div class="post-content content">
					<p><strong>ryzhov_al</strong>, Without any changes <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Makefile:<br /></p><div class="quotebox"><blockquote><p>#<br /># Copyright (C) 2006-2012 OpenWrt.org<br />#<br /># This is free software, licensed under the GNU General Public License v2.<br /># See /LICENSE for more information.<br />#</p><p>include $(TOPDIR)/rules.mk</p><p>PKG_NAME:=dnscrypt-proxy<br />PKG_VERSION:=0.9.5<br />PKG_RELEASE:=1</p><p>PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.bz2<br />PKG_SOURCE_URL:=https://github.com/opendns/dnscrypt-proxy/downloads<br />PKG_MD5SUM:=446c3063bcc5af09e94d2d686781592a<br />PKG_INSTALL:=1</p><p>include $(INCLUDE_DIR)/package.mk</p><p>define Package/dnscrypt-proxy<br />&nbsp; SECTION:=net<br />&nbsp; CATEGORY:=Network<br />&nbsp; SUBMENU:=IP Addresses and Names<br />&nbsp; DEPENDS:= +libpthread<br />&nbsp; TITLE:=A tool for securing DNS requests<br />&nbsp; URL:=http://www.opendns.com/technology/dnscrypt<br />endef</p><p>define Package/dnscrypt-proxy/description<br />dnscrypt-proxy is a slight variation on DNSCurve.<br />DNSCurve improves the confidentiality and integrity of DNS requests using <br />high-speed high-security elliptic-curve cryptography. Best of all, DNSCurve <br />has very low overhead and adds virtually no latency to queries.<br />endef</p><p>define Package/dnscrypt-proxy/install<br />&nbsp; &nbsp; $(INSTALL_DIR) $(1)/usr/sbin<br />&nbsp; &nbsp; $(CP) $(PKG_INSTALL_DIR)/usr/sbin/dnscrypt-proxy $(1)/usr/sbin/<br />&nbsp; &nbsp; $(INSTALL_DIR) $(1)/etc/init.d<br />&nbsp; &nbsp; $(INSTALL_BIN) ./files/dnscrypt-proxy.init $(1)/etc/init.d/dnscrypt-proxy<br />endef</p><p>$(eval $(call BuildPackage,dnscrypt-proxy))</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169449">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">ryzhov_al</div>
					<div class="post-datetime">
						8 Jun 2012, 19:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Black Roland wrote:</cite><blockquote><p>Without any changes <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></blockquote></div><p>It crashed in a <strong>one hour</strong>? Leaks out and die?<br />Please, put a line in cron&#039;s job for a while:<br /></p><div class="codebox"><pre><code> $ cat /proc/`pidof dnscrypt-proxy`/smaps | awk &#039;NR%8==1,NR%8==3 &gt;&gt; /tmp/dnscrypt-memusage.log</code></pre></div><p>We must show to Frank Denis how it leaks (if it really leaks).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170265">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						18 Jun 2012, 13:37					</div>
				</div>
				<div class="post-content content">
					<p><strong>ryzhov_al</strong>, ? ???? ????????? ?????? ??? ?????? ??? ????? ? ????? (? ?? VSZ). ?? ??????? ?????? ? <strong>lagonauta</strong> ????? (????? ?????? ?????? ?? ???????). ?????? ????????? ?????? ??????, ???????????.</p><p>English: nothing interesting <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170269">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">ryzhov_al</div>
					<div class="post-datetime">
						18 Jun 2012, 14:01					</div>
				</div>
				<div class="post-content content">
					<p>Yes, there is libuv memory leak fix <a href="https://github.com/joyent/libuv/commit/2c983fb99489383e12b046a5682b5b12b00d9d19">commit</a>, but it useless:</p><p>- Dnscrypt-proxy 0.9.5 + new libuv (with leak fix) - <a href="http://pastebin.com/jDQFRZNn">leaks</a>!<br />- Dnscrypt-proxy 0.9.5 + old libuv (like in 0.9.3) - <a href="http://pastebin.com/uwv9whDa">leaks</a>!</p><p>Now we may drop libuv-driven version because there is libevent-driven version <a href="https://github.com/opendns/dnscrypt-proxy/commit/d33ce14302c828c8ea283b5c4b0a3860f4ba14be">released</a>. We tested it, looks cool:</p><p>- <a href="http://pastebin.com/mw6d2wTj">no leaks</a>!<br />- 20% smaller binary size,<br />- less RAM consumption.</p><p>Makefiles <a href="http://wl500g-repo.googlecode.com/svn/feeds/rtndev/dnscrypt-proxy/">here</a>.</p>											<p class="post-edited">(Last edited by <strong>ryzhov_al</strong> on 18 Jun 2012, 15:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170290">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						18 Jun 2012, 17:30					</div>
				</div>
				<div class="post-content content">
					<p>Added latest Git version: 1e7edae (<a href="https://dl.dropbox.com/u/22711927/Temporary/dnscrypt-proxy.tar.gz">Makefile</a>) (<a href="https://dl.dropbox.com/u/22711927/Temporary/dnscrypt-proxy_2012-06-18-git_ar71xx.ipk">ipk</a>) (<a href="https://github.com/opendns/dnscrypt-proxy/blob/9a042ed0d6c76643babc57db8e74990e9f4d6112/ChangeLog">Changelog</a>)<br />Please test with <em>-u nobody</em> option</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170308">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">buffl</div>
					<div class="post-datetime">
						18 Jun 2012, 21:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Black Roland wrote:</cite><blockquote><p>Added latest Git version: 1e7edae (<a href="https://dl.dropbox.com/u/22711927/Temporary/dnscrypt-proxy.tar.gz">Makefile</a>) (<a href="https://dl.dropbox.com/u/22711927/Temporary/dnscrypt-proxy_2012-06-18-git_ar71xx.ipk">ipk</a>) (<a href="https://github.com/opendns/dnscrypt-proxy/blob/9a042ed0d6c76643babc57db8e74990e9f4d6112/ChangeLog">Changelog</a>)<br />Please test with <em>-u nobody</em> option</p></blockquote></div><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common

START=50

LISTEN_ADDR=127.0.0.1
LISTEN_PORT=2053

start() {
        /usr/sbin/dnscrypt-proxy -d \
                -a $LISTEN_ADDR \
                -P $LISTEN_PORT \
                -n 64
                -u nobody
}

stop() {
        /usr/sbin/dnscrypt-proxy
}

~
~
~
~
root@OpenWrt:/# /etc/init.d/dnscrypt-proxy stop
[INFO] Generating a new key pair
[ERROR] Unable to bind: 127.0.0.1:53 (TCP)
root@OpenWrt:/# /etc/init.d/dnscrypt-proxy start
/etc/rc.common: line 78: -u: not found
root@OpenWrt:/# /etc/init.d/dnscrypt-proxy stop
[INFO] Generating a new key pair
[ERROR] Unable to bind: 127.0.0.1:53 (TCP)
root@OpenWrt:/# /etc/init.d/dnscrypt-proxy start
/etc/rc.common: line 78: -u: not found
root@OpenWrt:/#</code></pre></div>											<p class="post-edited">(Last edited by <strong>buffl</strong> on 18 Jun 2012, 21:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170348">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						19 Jun 2012, 06:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>buffl wrote:</cite><blockquote><p>…<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -n 64<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -u nobody<br />…</p></blockquote></div><p>You missed &quot;\&quot; symbol, please try this init-script:<br /></p><div class="quotebox"><blockquote><p># cat /etc/init.d/dnscrypt-proxy <br />#!/bin/sh /etc/rc.common<br /># Copyright (C) 2006-2012 OpenWrt.org</p><p>START=50</p><p>LISTEN_ADDR=127.0.0.1<br />LISTEN_PORT=2053</p><p>start() {<br />&nbsp; &nbsp; service_start /usr/sbin/dnscrypt-proxy -d \<br />&nbsp; &nbsp; &nbsp; &nbsp; -a $LISTEN_ADDR \<br />&nbsp; &nbsp; &nbsp; &nbsp; -P $LISTEN_PORT \<br />&nbsp; &nbsp; &nbsp; &nbsp; -n 64 <span style="color: red">\</span><br />&nbsp; &nbsp; &nbsp; &nbsp; -u nobody<br />}</p><p>stop() {<br />&nbsp; &nbsp; service_stop /usr/sbin/dnscrypt-proxy<br />}</p></blockquote></div><p>or this command:<br /></p><div class="quotebox"><blockquote><p># dnscrypt-proxy -P 2053 -u nobody</p></blockquote></div><p>It is for me:<br /></p><div class="quotebox"><blockquote><p># dnscrypt-proxy -P 2053 -u nobody<br />[INFO] Generating a new key pair<br />[INFO] Stopping proxy<br />[INFO] TCP listener shut down<br />Segmentation fault<br /># dmesg | tail -1<br />[&nbsp; 110.370000] warning: process `dnscrypt-proxy&#039; used the deprecated sysctl system call with 1.40.6.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170359">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						19 Jun 2012, 09:44					</div>
				</div>
				<div class="post-content content">
					<p>I can&#039;t bring up dnscrypt at boot.Notice these in system log:<br />Jun 19 06:21:12 OpenWrt daemon.info dnscrypt-proxy[1172]: Generating a new key pair<br />Jun 19 06:21:13 OpenWrt daemon.err dnscrypt-proxy[1172]: Unable to bind [127.0.0.1] (TCP)<br />Full log is here:<br /><a href="http://pastebin.com/bGt1e4Hi">http://pastebin.com/bGt1e4Hi</a></p><p>Anyone kind enough to help?</p><p>Sorry for my english,too:)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170361">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						19 Jun 2012, 10:08					</div>
				</div>
				<div class="post-content content">
					<p><strong>axishero</strong>, 0.9.3 version with standard init.d/dnscrypt-proxy script? I think 2053 port is already in use (<em># netstat&nbsp; -a -n</em> for check), or permissions denied.<br />In /etc/init.d/dncrypt-proxy try to change LISTEN_PORT to any another more than 1024 (and in /etc/config/dhcp too) or change dnscrypt-proxy arguments (remove <em>-u nobody</em>):<br /></p><div class="quotebox"><blockquote><p>#!/bin/sh /etc/rc.common<br /># Copyright (C) 2006-2012 OpenWrt.org</p><p>START=50</p><p>LISTEN_ADDR=127.0.0.1<br />LISTEN_PORT=7953</p><p>start() {<br /><strong>&nbsp; &nbsp; &nbsp; &nbsp; service_start /usr/sbin/dnscrypt-proxy -d \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -a $LISTEN_ADDR \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -P $LISTEN_PORT \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -n 64</strong><br />}</p><p>stop() {<br />&nbsp; &nbsp; &nbsp; &nbsp; service_stop /usr/sbin/dnscrypt-proxy<br />}</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170388">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">buffl</div>
					<div class="post-datetime">
						19 Jun 2012, 15:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Black Roland wrote:</cite><blockquote><p>It is for me:<br /># dnscrypt-proxy -P 2053 -u nobody<br />[INFO] Generating a new key pair<br />[INFO] Stopping proxy<br />[INFO] TCP listener shut down<br />Segmentation fault<br /># dmesg | tail -1<br />[&nbsp; 110.370000] warning: process `dnscrypt-proxy&#039; used the deprecated sysctl system call with 1.40.6.</p></blockquote></div><p>corrected </p><div class="codebox"><pre><code>root@OpenWrt:/# dnscrypt-proxy -P 2053 -u nobody
[INFO] Generating a new key pair
[ERROR] Unable to bind: 127.0.0.1:2053 (TCP)
root@OpenWrt:/# dmesg | tail -1
ar71xx-wdt: enabling watchdog timer</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170396">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">Black Roland</div>
					<div class="post-datetime">
						19 Jun 2012, 16:08					</div>
				</div>
				<div class="post-content content">
					<p><strong>buffl</strong>, It works normal with error? O_o<br /></p><div class="quotebox"><cite>buffl wrote:</cite><blockquote><p>[ERROR] Unable to bind: 127.0.0.1:2053 (TCP)</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170406">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						19 Jun 2012, 16:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Black Roland wrote:</cite><blockquote><p><strong>axishero</strong>, 0.9.3 version with standard init.d/dnscrypt-proxy script? I think 2053 port is already in use (<em># netstat&nbsp; -a -n</em> for check), or permissions denied.</p></blockquote></div><p>I am using the init script from your #1 post.<br />Dnscrypt can&#039;t be up at boot.But it can be up by ssh into and &#039;/etc/init.d/dnscrypt-proxy start&#039; after boot.For this case,it&#039;s running on tplink wr1041n which has only one switch named eth0 divided into eth0.1 and eth0.2 as wan and lan.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 6</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=36380&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=36380&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=36380&amp;p=6.html">6</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>