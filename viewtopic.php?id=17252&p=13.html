<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT Kamikaze on TP-link tl-wa501g?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 31 Aug 2014 and 5 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 13 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=17252&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=17252&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=14.html">14</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p268046">
				<div class="post-metadata">
					<div class="post-num">Post #301</div>
					<div class="post-author">wawszczak</div>
					<div class="post-datetime">
						7 Mar 2015, 23:28					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,</p><p>I would like to bump up the question of Tolyan about the 16 bytes on the beginning of bin file for flashing Via TP-Link WEB gui.<br />I already noticed that first 4 bytes are the size of &quot;source rom&quot; file, but next 16 bytes looks as random. It would be some Checksum, but the MD5 is not matching...</p><p>Dear XSSA,<br />As You already have done some TP-Link WEB GUI Compatible bin files, could you share the hashing algorithm it uses?</p><p>Thanks for all your contribution!<br />Stanislaw Wawszczak</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271329">
				<div class="post-metadata">
					<div class="post-num">Post #302</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						5 Apr 2015, 13:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xssa wrote:</cite><blockquote><p>First of all you need to flash Redboot to first 64kB of your new 64Mbit chip and flash boardconfig from last 128 kB from old chip to last 128 kB of your new chip. Then solder your new chip onto bard and cross your fingers looking to serial console on booting. Meaning RedBoot will recognise your chip properly.</p></blockquote></div><p>Thx! Well done!</p><p>My T-LINK TL-WR340GD ver 3.1 <a href="https://www.dropbox.com/s/ocnb58o7pth4agf/wl-wr340gd_fullflash.7z?dl=0">fullflash</a>, original 16Mbits and new 64Mbits with RedBoot.</p><p><a href="https://www.dropbox.com/s/7ojmrwu4vihrg8l/wl-wr340gd-v3_1-uart.jpg?dl=0">Two jumpers to enable UART</a> (115200 8n1)</p><div class="codebox"><pre><code> MicroRedBoot v1.4, (c) 2009 DD-WRT.COM (Mar 29 2010 REVISION 14131)
keep the reset button pushed to enter redboot!
CPU Type: Atheros AR2315/6/7/8
CPU Clock: 184Mhz
Found Flash device SIZE=0x00800000 SECTORSIZE=0x00010000 FLASHBASE=0xA8000000
no bootable image found, try default location 0xA8010000
Booting Linux
loading
data corrupted!
switching to recovery RedBoot
loading.....No board config data found!
+</code></pre></div><p>What&#039;s next?</p>											<p class="post-edited">(Last edited by <strong>Delfer</strong> on 5 Apr 2015, 13:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272930">
				<div class="post-metadata">
					<div class="post-num">Post #303</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						18 Apr 2015, 11:12					</div>
				</div>
				<div class="post-content content">
					<p>Linux from wr340v5_linux.bin loads<br /></p><div class="codebox"><pre><code>BusyBox v1.15.3 (2010-04-26 19:06:00 EEST) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 Backfire (10.03, r20974) --------------------------
  * 1/3 shot Kahlua    In a shot glass, layer Kahlua 
  * 1/3 shot Bailey&#039;s  on the bottom, then Bailey&#039;s, 
  * 1/3 shot Vodka     then Vodka.
 ---------------------------------------------------
root@(none):/#</code></pre></div><p>But MicroRedBoot recovery (with reset button) - not<br /></p><div class="codebox"><pre><code>MicroRedBoot v1.4, (c) 2009 DD-WRT.COM (Mar 29 2010 REVISION 14131)
keep the reset button pushed to enter redboot!
CPU Type: Atheros AR2315/6/7/8
CPU Clock: 184Mhz
Found Flash device SIZE=0x00800000 SECTORSIZE=0x00010000 FLASHBASE=0xA8000000
Reset Button triggered
Booting Recovery RedBoot
loading.....


юNo radio config data found!
+CPU 0 Unable to handle kernel paging request at virtual address c03e0000, epc == 8000f60c, ra == 800171c4
Oops[#1]:
Cpu 0
$ 0   : 00000000 00000010 ffffffff 807f0000
$ 4   : 807f0000 c03e0000 0000ffff c03e0000
$ 8   : 00000000 80020000 80020000 00000100
$12   : 8071101c 000000a0 00000001 94437da1
$16   : 80020000 8000f0f8 80020000 3ebcab7b
$20   : 7bdbff4f 00000001 fffffffd 7b0413eb
$24   : fcb3fb8b e355e1d3                  
$28   : 80026390 8001f3d0 4fd4f517 800171c4
Hi    : 00000000
Lo    : 00010000
epc   : 8000f60c 0x8000f60c
    Not tainted
ra    : 800171c4 0x800171c4
Status: 10000002    KERNEL EXL 
Cause : 50008008
BadVA : c03e0000
PrId  : 00019064 (MIPS 4KEc)
CPU 0 Unable to handle kernel paging request at virtual address 0000100e, epc == 8013be80, ra == 8013cbfc
Oops[#2]:
Cpu 0
$ 0   : 00000000 10000000 00000000 0000100e
$ 4   : 0000100e ffffffff 0000100e 00000004
$ 8   : 00000020 00000030 0000002d ffffffff
$12   : ffffffff 000000a0 00000001 94437da1
$16   : 80372c86 0000100e ffffffff 00000000
$20   : 80373048 00000000 00000000 80373048
$24   : 00000010 80166ea8                  
$28   : 8001e000 8001f010 ffffffff 8013cbfc
Hi    : 00000000
Lo    : 0000005b
epc   : 8013be80 0x8013be80
    Not tainted
ra    : 8013cbfc 0x8013cbfc
Status: 10000002    KERNEL EXL 
Cause : 50008008
BadVA : 0000100e
PrId  : 00019064 (MIPS 4KEc)
Modules linked iModules linked i paging request at virtual add iMo ules linked by a non-GPL module, which will not be allowed in the future

Process Board Data is already relocated(1)!
 (pid: 1718183712, threadinfo= 8001e000, task= 8001aa38, tls=00000000)
Stack : 00000009 802240b8 00000021 80373048 8001f1f0 00000000 80372c86 8001f1ec
        00000004 8013d7b8 00000020 00000021 00000004 00000004 00000000 ffffffff
        0000000a ffffffff ffffffff 8001f220 00000004 00000000 ffffffff 0000000a
        ffffffff ffffffff 80378bd4 801678f0 0000000a ffffffff ffffffff 0000000a
        80378bd4 801678d0 80378bd4 801678f0 ffffffff ffffffff 00000011 80167de0
        ...
Call Trace:[&lt; 0008013d7b8&gt;] 0x000000000000000000000000000000000</code></pre></div><p>Now my router works with ESMT M12L64164-7 RAM (4 banks x 1M x 16 bits @ 143Mhz) <br />Can I swap it to Hynix HY5DU121622CTP-4 (4 banks x 8M x 16 bits @ 250Mhz)?<br /><a href="https://www.dropbox.com/s/oj3of26mysb2pyp/ar2317_datasheet.pdf?dl=0">Atheros AR2317 datasheet</a><br /><strong>UPD. </strong> HY5DU121622CTP - no chance, not compitable by package.<br />Old chinese <a href="https://cloud.mail.ru/public/5Vx57M57wDCE/DSC_1698.JPG">TWIN 133 724A120</a> (128 Mbit) also failed - router does&#039;t start.</p>											<p class="post-edited">(Last edited by <strong>Delfer</strong> on 24 Apr 2015, 21:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275877">
				<div class="post-metadata">
					<div class="post-num">Post #304</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						10 May 2015, 21:18					</div>
				</div>
				<div class="post-content content">
					<p><strong>xssa</strong>, now I have router with 8Mb rom and 32Mb ram. redboot_ap61_32M_8M_marvell.rom loaded perfect, but ar8236... How to enable it?<br /></p><div class="codebox"><pre><code>MicroRedBoot v1.4, (c) 2009 DD-WRT.COM (Jul  8 2012 REVISION 18550M)
keep the reset button pushed to enter redboot!
CPU Type: Atheros AR2315/6/7/8
CPU Clock: 184Mhz
Found Flash device SIZE=0x00800000 SECTORSIZE=0x00010000 FLASHBASE=0xA8000000
Reset Button triggered
Booting Recovery RedBoot
loading.....

▒+Couldn&#039;t find valid MAC address for enet0. Using default!
Ethernet eth0: MAC address 00:03:7f:e0:02:bf
IP: 192.168.0.251, Default server: 192.168.0.3

RedBoot(tm) bootstrap and debug environment [RAM]
Non-certified release, version UNKNOWN - built 18:15:53, Jul  8 2012

Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.
Copyright (C) 2009 NewMedia-NET GmbH

Board: ap61
RAM: 0x80000000-0x82000000, [0x80031380-0x81fed000] available
FLASH: 0xa8000000 - 0xa87f0000, 128 blocks of 0x00010000 bytes each.
RedBoot&gt;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275935">
				<div class="post-metadata">
					<div class="post-num">Post #305</div>
					<div class="post-author">xssa</div>
					<div class="post-datetime">
						11 May 2015, 14:42					</div>
				</div>
				<div class="post-content content">
					<p>ar8236 is a quite undocumented chip so when time comes and Tp-link made new revision and change marvel switch to ar8236 i did some workarounds. There is Z-modem enabled MicroRedBoot and modified Linux phy driver which can correctly initialize this switch in tl-wr340 board.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275947">
				<div class="post-metadata">
					<div class="post-num">Post #306</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						11 May 2015, 17:16					</div>
				</div>
				<div class="post-content content">
					<p>I found U-Boot what support AR2317 + 88E6060, AR8236, ADM6996 <a href="http://www.right.com.cn/forum/thread-136444-1-1.html">here</a>. <a href="https://www.dropbox.com/s/y0odntcqhyzh0e4/u-boot-ar2317.bin?dl=0">u-boot-ar2317.bin on my Dropbox</a>.<br />It pretty good. Work fine with my board, correctly detects RAM and FLASH and with Web console. I like it.<br />So, I combined it with barrier breaker <a href="https://downloads.openwrt.org/barrier_breaker/14.07/atheros/generic/openwrt-atheros-vmlinux.lzma">kernel</a> and <a href="https://downloads.openwrt.org/barrier_breaker/14.07/atheros/generic/openwrt-atheros-root.squashfs">rootfs</a>. FIS edited manually.<br />It starts and works, detects switch:<br /></p><div class="codebox"><pre><code>[    2.980000] eth0: Atheros AR231x: 0e:b2:6d:46:9f:dd, irq 4
[    3.140000] switch0: Atheros AR8236 rev. 1 switch registered on 0
[    3.290000] libphy: ar231x_eth_mii: probed
[    4.470000] eth0: attached PHY driver [Atheros AR8216/AR8236/AR8316] (mii_bus:phy_addr=0:00)</code></pre></div><p>But still have no any connections over lan. What to do?</p><p>&#039;swconfig dev switch0 show&#039; - shows our switch, correct status of each port, but counters for port 0 (CPU) everytime are 0.<br />And I can &#039;bridge&#039; LAN ports using commands:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# swconfig dev switch0 vlan 0 set ports &#039;0 1 2 3 4 5&#039;
root@OpenWrt:/# swconfig dev switch0 set apply</code></pre></div><p>But I can not connect to router.</p>											<p class="post-edited">(Last edited by <strong>Delfer</strong> on 11 May 2015, 22:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275996">
				<div class="post-metadata">
					<div class="post-num">Post #307</div>
					<div class="post-author">xssa</div>
					<div class="post-datetime">
						11 May 2015, 22:51					</div>
				</div>
				<div class="post-content content">
					<p>It is difficult to figure out what goes wrong with ar8236 w/o documentation. The way this switch is initialized by the stock linux driver for this board is wrong. It needs another magic to be written to its config registers. I reversed this magic from stock tp-link firmware and it works for me. I think this is about MII - RMII , but without docs who knows? I will look to my modified sources to help you, i need few days to access it.<br />As i understand ar8236 works fine with this u-boot.<br />If you have sources for this u-boot it can give more light.</p>											<p class="post-edited">(Last edited by <strong>xssa</strong> on 11 May 2015, 22:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275997">
				<div class="post-metadata">
					<div class="post-num">Post #308</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						11 May 2015, 23:03					</div>
				</div>
				<div class="post-content content">
					<p>I have only <a href="https://www.dropbox.com/s/n1qkquc7aw4b52z/ATHEROS--AR8236.pdf?dl=0">AR8236 Six-Port Fast Ethernet Switch Data Sheet</a>. I think it works as &quot;5 port 10/100 UTP + 1 port MII MAC&quot;. <br />Can you share you magic? How to let this switch works? Just like a hub.<br />I do not have U-Boot sources, but I am trying to contact to its developer.</p>											<p class="post-edited">(Last edited by <strong>Delfer</strong> on 12 May 2015, 10:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276214">
				<div class="post-metadata">
					<div class="post-num">Post #309</div>
					<div class="post-author">xssa</div>
					<div class="post-datetime">
						13 May 2015, 23:28					</div>
				</div>
				<div class="post-content content">
					<p>The magic is:<br /></p><div class="codebox"><pre><code>priv-&gt;write(priv, 0x78, 0x1f0); // cpu port register, </code></pre></div><p>You can check this image <a href="https://www.dropbox.com/s/ioy1qxnzefd8k3i/wr340v3_linux.bin?dl=0">wr340v3_linux.bin</a> if it works for you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276290">
				<div class="post-metadata">
					<div class="post-num">Post #310</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						14 May 2015, 16:24					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>priv-&gt;write(priv, 0x78, 0x1f0); // cpu port register, </code></pre></div><p>According AR2316 datasheet that&#039;s meens:<br />3:0 - reserved - no care<br />7:4 - MIRROR_PORT_NUM - no mirror port connected to switch<br />8&nbsp; &nbsp; - CPU_PORT_EN - enable CPU port<br />In this chip CPU port disabled by default. Your code enables it.<br />I found some code in OpenWRT repo:<br /><a href="https://github.com/openwrt-mirror/openwrt/blob/94c327c7c703c54841e92e9c4be2ebbc0f8810a5/target/linux/generic/files/drivers/net/phy/ar8216.h">ar8216.h</a><br /></p><div class="codebox"><pre><code>#define AR8216_REG_GLOBAL_CPUPORT        0x0078
#define   AR8216_GLOBAL_CPUPORT_MIRROR_PORT    BITS(4, 4)
#define   AR8216_GLOBAL_CPUPORT_MIRROR_PORT_S    4</code></pre></div><p><a href="https://github.com/openwrt-mirror/openwrt/blob/94c327c7c703c54841e92e9c4be2ebbc0f8810a5/target/linux/generic/files/drivers/net/phy/ar8216.c">ar8216.c</a><br /></p><div class="codebox"><pre><code>/* reset all mirror registers */
    ar8xxx_rmw(priv, AR8216_REG_GLOBAL_CPUPORT,
           AR8216_GLOBAL_CPUPORT_MIRROR_PORT,
           (0xF &lt;&lt; AR8216_GLOBAL_CPUPORT_MIRROR_PORT_S));
...
ar8xxx_rmw(priv, AR8216_REG_GLOBAL_CPUPORT,
           AR8216_GLOBAL_CPUPORT_MIRROR_PORT,
           (priv-&gt;monitor_port &lt;&lt; AR8216_GLOBAL_CPUPORT_MIRROR_PORT_S));</code></pre></div><p>They uses this port, but only to enable mirroring, not to enable CPU port.<br />I think, following function can be updated<br /></p><div class="codebox"><pre><code>static void
ar8236_init_globals(struct ar8xxx_priv *priv)
{
    /* enable jumbo frames */
    ar8xxx_rmw(priv, AR8216_REG_GLOBAL_CTRL,
           AR8316_GCTRL_MTU, 9018 + 8 + 2);

    /* enable cpu port to receive arp frames */
    ar8xxx_reg_set(priv, AR8216_REG_ATU_CTRL,
           AR8236_ATU_CTRL_RES);

    /* enable cpu port to receive multicast and broadcast frames */
    ar8xxx_reg_set(priv, AR8216_REG_FLOOD_MASK,
           AR8236_FM_CPU_BROADCAST_EN | AR8236_FM_CPU_BCAST_FWD_EN);

    /* Enable MIB counters */
    ar8xxx_rmw(priv, AR8216_REG_MIB_FUNC, AR8216_MIB_FUNC | AR8236_MIB_EN,
           (AR8216_MIB_FUNC_NO_OP &lt;&lt; AR8216_MIB_FUNC_S) |
           AR8236_MIB_EN);
}</code></pre></div><p>Call ar8xxx_write(priv, 0x78, 0xc00001f0); would be enough. What do you think?<br />Like here:<br /></p><div class="codebox"><pre><code>static void
ar8216_init_globals(struct ar8xxx_priv *priv)
{
    /* standard atheros magic */
    ar8xxx_write(priv, 0x38, 0xc000050e);

    ar8xxx_rmw(priv, AR8216_REG_GLOBAL_CTRL,
           AR8216_GCTRL_MTU, 1518 + 8 + 2);
}</code></pre></div>											<p class="post-edited">(Last edited by <strong>Delfer</strong> on 16 May 2015, 11:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276476">
				<div class="post-metadata">
					<div class="post-num">Post #311</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						16 May 2015, 12:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xssa wrote:</cite><blockquote><p>The magic is:<br />You can check this image <a href="https://www.dropbox.com/s/ioy1qxnzefd8k3i/wr340v3_linux.bin?dl=0">wr340v3_linux.bin</a> if it works for you.</p></blockquote></div><p>I&#039;ve got bootloop<br /></p><div class="codebox"><pre><code>loading.MicroRedBoot v1.4, (c) 2009 DD-WRT.COM (Jul 12 2011 REVISION 14131M)
keep the reset button pushed to enter redboot!
CPU Type: Atheros AR2315/6/7/8
CPU Clock: 184Mhz
Found Flash device SIZE=0x00800000 SECTORSIZE=0x00010000 FLASHBASE=0xA8000000
no bootable image found, try default location 0xA8010000
Booting Linux
loading.MicroRedBoot v1.4, (c) 2009 DD-WRT.COM (Jul 12 2011 REVISION 14131M)</code></pre></div><p>Recovery fails<br /></p><div class="codebox"><pre><code>MicroRedBoot v1.4, (c) 2009 DD-WRT.COM (Jul 12 2011 REVISION 14131M)
keep the reset button pushed to enter redboot!
CPU Type: Atheros AR2315/6/7/8
CPU Clock: 184Mhz
Found Flash device SIZE=0x00800000 SECTORSIZE=0x00010000 FLASHBASE=0xA8000000
Reset Button triggered
Booting Recovery RedBoot
loading.....

▒No board config data found!
+</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276493">
				<div class="post-metadata">
					<div class="post-num">Post #312</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						16 May 2015, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve got it!<br /></p><div class="codebox"><pre><code>--- openwrt/target/linux/generic/files/drivers/net/phy/ar8216.h
2015-05-17 16:08:32.940737618 +0100
+++ openwrt-clean/target/linux/generic/files/drivers/net/phy/ar8216.h
2015-05-17 12:54:50.411390834 +0100
@@ -37,21 +37,9 @@
 #define   AR8216_CTRL_VERSION_S 8
 #define   AR8216_CTRL_RESET BIT(31)

-#define AR8236_REG_PORT0_PAD_MODE_CTRL 0x0004
-#define   AR8236_PORT0_MII_MAC BIT(2)
-#define   AR8236_PORT0_MII_MAC_S 2
-#define   AR8236_PORT0_MII_PHY BIT(10)
-#define   AR8236_PORT0_MII_PHY_S 10
-#define   AR8236_PORT0_RMII BIT(17)
-#define   AR8236_PORT0_RMII_S 17
-
 #define AR8216_REG_FLOOD_MASK 0x002C
 #define   AR8216_FM_UNI_DEST_PORTS BITS(0, 6)
-#define   AR8216_FM_UNI_DEST_PORTS_S 0
 #define   AR8216_FM_MULTI_DEST_PORTS BITS(16, 6)
-#define   AR8216_FM_MULTI_DEST_PORTS_S 16
-#define   AR8236_FM_BROAD_DEST_PORTS BITS(25, 6)
-#define   AR8236_FM_BROAD_DEST_PORTS_S 25

 #define AR8216_REG_GLOBAL_CTRL 0x0030
 #define   AR8216_GCTRL_MTU BITS(0, 11)
@@ -120,8 +108,6 @@
 #define AR8216_REG_GLOBAL_CPUPORT 0x0078
 #define   AR8216_GLOBAL_CPUPORT_MIRROR_PORT BITS(4, 4)
 #define   AR8216_GLOBAL_CPUPORT_MIRROR_PORT_S 4
-#define   AR8236_GLOBAL_CPUPORT_CPU_PORT_EN BIT(8)
-#define   AR8236_GLOBAL_CPUPORT_CPU_PORT_EN_S 8

 #define AR8216_PORT_OFFSET(_i) (0x0100 * (_i + 1))
 #define AR8216_REG_PORT_STATUS(_i) (AR8216_PORT_OFFSET(_i) + 0x0000)

--- openwrt/target/linux/generic/files/drivers/net/phy/ar8216.c
2015-05-17 13:34:30.000000000 +0100
+++ openwrt-clean/target/linux/generic/files/drivers/net/phy/ar8216.c
2015-05-17 12:54:50.411390834 +0100
@@ -855,23 +855,6 @@ ar8236_hw_init(struct ar8xxx_priv *priv)
 static void
 ar8236_init_globals(struct ar8xxx_priv *priv)
 {
- /* enable CPU port */
- ar8xxx_rmw(priv, AR8216_REG_GLOBAL_CPUPORT,
-   AR8236_GLOBAL_CPUPORT_CPU_PORT_EN,
-   (0b1 &lt;&lt; AR8236_GLOBAL_CPUPORT_CPU_PORT_EN_S));
-
- /* set MII interface PHY mode on port 0 */
- ar8xxx_rmw(priv, AR8236_REG_PORT0_PAD_MODE_CTRL,
-   AR8236_PORT0_MII_PHY,
-   (0b1 &lt;&lt; AR8236_PORT0_MII_PHY_S));
-
- /* transmit uni flood, multi flood, broadcast to all ports */
- ar8xxx_rmw(priv, AR8216_REG_FLOOD_MASK,
-   AR8216_FM_UNI_DEST_PORTS | AR8216_FM_MULTI_DEST_PORTS |
AR8236_FM_BROAD_DEST_PORTS,
-   (0b111111 &lt;&lt; AR8216_FM_UNI_DEST_PORTS_S) |
-   (0b111111 &lt;&lt; AR8216_FM_MULTI_DEST_PORTS_S) |
-   (0b111111 &lt;&lt; AR8236_FM_BROAD_DEST_PORTS_S) );
-
  /* enable jumbo frames */
  ar8xxx_rmw(priv, AR8216_REG_GLOBAL_CTRL,
    AR8316_GCTRL_MTU, 9018 + 8 + 2);</code></pre></div>											<p class="post-edited">(Last edited by <strong>Delfer</strong> on 17 May 2015, 19:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276776">
				<div class="post-metadata">
					<div class="post-num">Post #313</div>
					<div class="post-author">daniel.boyles</div>
					<div class="post-datetime">
						19 May 2015, 21:29					</div>
				</div>
				<div class="post-content content">
					<p>wow. this thread has been going for a while and I haven&#039;t read the whole thing (yet).</p><p>I&#039;ve got a TP Link WA500G which I would like to flash with (minimal) OpenWrt.</p><p>Hardware version is v1 081530EF (as reported by the status page on the router&#039;s web interface)</p><p>Hardware inside is (apparantly the difference is the Flash &amp; Ram):</p><p>Flash : <a href="http://www.marikodistribuzione.it/media/blfa_files/25X16AVSIG.pdf">Winbond 25X16AVSIG</a><br />Ram : <a href="http://wiki.openwrt.org/_media/toh/us.robotics/em638165ts_v23.pdf">EtronTech EM638165TS-6G</a></p><p>and the seemingly usual Atheros AR2317 + Realtek RTL8201CP</p><p>Are there any images around that should work via web interface upgrade?<br />Is VxKiller stiil the most promising route and would i follow the steps outlined on the wiki <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr542g">TL WR542G</a> page?</p><p>Thanks in advance for any pointers.</p><p>Edit: when I say &#039;minimal OpenWrt:<br />I would like to have both ethernet and wifi working, no need for web interface, ideally ssh or at least telnet &amp; tftp.<br />I do realise that the flash is too small to support much more than that.</p>											<p class="post-edited">(Last edited by <strong>daniel.boyles</strong> on 19 May 2015, 21:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277101">
				<div class="post-metadata">
					<div class="post-num">Post #314</div>
					<div class="post-author">xssa</div>
					<div class="post-datetime">
						21 May 2015, 23:58					</div>
				</div>
				<div class="post-content content">
					<p>There is no hardware to debug redboot on ar2317 + rtl8201cp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277348">
				<div class="post-metadata">
					<div class="post-num">Post #315</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						23 May 2015, 21:59					</div>
				</div>
				<div class="post-content content">
					<p>RTL8201CP is not a problem, I think. It can work as general phy. Real problem - memory. Minimal for OpenWrt Barrier Breaker is 16Mb RAM and 4Mb Flash. Your device have 8Mb RAM and 2Mb Flash. If you can upgrade you device hardware, you will can path OpenWrt to support your phy.<br />But network in bootloader... I don&#039;t know.</p>											<p class="post-edited">(Last edited by <strong>Delfer</strong> on 23 May 2015, 22:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285196">
				<div class="post-metadata">
					<div class="post-num">Post #316</div>
					<div class="post-author">luisandresco</div>
					<div class="post-datetime">
						27 Jul 2015, 23:07					</div>
				</div>
				<div class="post-content content">
					<p>Regards ...<br />I plan to set up three teams TL-WR340G V 2.2 AP mesh and openwrt want to do it, I&#039;ve seen that because the issue is old equipment even forgotten the link to the wiki says that there is no longer that content.<br />I appreciate any advice to get information about the configuration of this equipment?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285629">
				<div class="post-metadata">
					<div class="post-num">Post #317</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						30 Jul 2015, 17:23					</div>
				</div>
				<div class="post-content content">
					<p><strong>luisandresco</strong>, at first you must enlarge RAM and flash.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302648">
				<div class="post-metadata">
					<div class="post-num">Post #318</div>
					<div class="post-author">ESonya</div>
					<div class="post-datetime">
						6 Dec 2015, 21:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Delfer wrote:</cite><blockquote><p>I&#039;ve got it!</p></blockquote></div><p>Hi!<br />I have a router TL-WR340G+ V4.0 (chinese version).<br />I upgraded it hardware and now it have:<br />CPU &nbsp; &nbsp; Atheros AR2317 rev 0<br />RAM &nbsp; &nbsp; 32MB SDRAM<br />Flash &nbsp; &nbsp; Winbond W25Q32 @ 23MHz (4MB)<br />Ethernet &nbsp; &nbsp; Atheros AR8236 rev 1<br />Clocks &nbsp; &nbsp; CPU: 184MHz, SDR: 184MHz, AMBA: 92MHz, Ref: 40MHz</p><p>I&#039;m not smart enough to compile the OpenWRT firmware for it.<br />Can you help me and share ready firmware?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302721">
				<div class="post-metadata">
					<div class="post-num">Post #319</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						7 Dec 2015, 12:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ESonya wrote:</cite><blockquote><p>I upgraded it hardware</p></blockquote></div><p>Have you flash it with u-boot?</p>											<p class="post-edited">(Last edited by <strong>Delfer</strong> on 7 Dec 2015, 12:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302723">
				<div class="post-metadata">
					<div class="post-num">Post #320</div>
					<div class="post-author">ESonya</div>
					<div class="post-datetime">
						7 Dec 2015, 12:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Delfer wrote:</cite><blockquote><p>Have you flash it with u-boot?</p></blockquote></div><p>Yes, I flashing u-boot from hackpascal.</p><p>Да, я залил загрузчик u-boot от hackpascal. Осталось дело за малым, найти рабочую прошивку. Я брал этот роутер в расчёте залить туда прошивку от ubiquiti nanostation, она в принципе залилась, но из-за другой микросхемы свича, сети нет.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303545">
				<div class="post-metadata">
					<div class="post-num">Post #321</div>
					<div class="post-author">gaucho</div>
					<div class="post-datetime">
						13 Dec 2015, 23:16					</div>
				</div>
				<div class="post-content content">
					<p>when i try to flash the XSSA VxKiller i receive the following error message: &quot;Upgrade unsuccessfully because the version of the upgraded file was incorrect. Please check the file name&quot;</p><p>Today I connected the serial console to the pc, and i discovered that, when i try to flash the firmware from the webpage, on the serial console it is printed the following error:<br />r4xx: incorrect software version 0x0, should be 0x542a!<br />tftp: firmware version check failed</p><p>can you help me?</p><p>Now i will detail to you the important remaining details: the router is TP-Link TL-WR542G <br />I would like to flash openWrt on the TP-Link TL-WR542G . This device has the same hardware of the WR340G according to this page: <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr542g">http://wiki.openwrt.org/toh/tp-link/tl-wr542g</a><br />on the linked page i can read that the VxKiller&nbsp; firmware should work without problems.</p><p>the firmware actually loaded on the router is this one: <a href="http://tplink.com/resources/software/201112710571818.zip">http://tplink.com/resources/software/20 … 571818.zip</a></p><p>when i power on the device i can read on the serial console the following text:</p><p>AR2315 rev 0x00000090 startup...<br />Attached TCP/IP interface to ae unit 0<br />Attaching interface lo0...done<br />dsInit 1<br />wlanBridgeInit(): ucGetOpMode() 1<br />wireless access point starting...<br />Auto Channel Scan selected 2462 MHz, channel 11<br />wlan0 Ready<br />TDDP</p><br /><p> Software Platform for ARM<br /> Copyright(C) 2001-2004 by TP-LINK TECHNOLOGIES CO., LTD.<br /> Creation date: Dec 3 2010, 11:44:18</p><p> Press CTRL-B to enter bootmenu...</p><p> Boot Menu:<br /> 1: Download application program<br /> 2: Modify Bootrom password<br /> 3: Exit the menu<br /> 4: Reboot<br /> 5: User commond line<br /> Enter your choice(1-4):</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303846">
				<div class="post-metadata">
					<div class="post-num">Post #322</div>
					<div class="post-author">Delfer</div>
					<div class="post-datetime">
						16 Dec 2015, 12:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ESonya wrote:</cite><blockquote><div class="quotebox"><cite>Delfer wrote:</cite><blockquote><p>Have you flash it with u-boot?</p></blockquote></div><p>Yes, I flashing u-boot from hackpascal.</p></blockquote></div><p>Share your fullflash and I will try to modify it with OpenWRT kernel and rootfs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311156">
				<div class="post-metadata">
					<div class="post-num">Post #323</div>
					<div class="post-author">feche1320</div>
					<div class="post-datetime">
						12 Feb 2016, 17:55					</div>
				</div>
				<div class="post-content content">
					<p>Any way to return to stock firmware?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311412">
				<div class="post-metadata">
					<div class="post-num">Post #324</div>
					<div class="post-author">xssa</div>
					<div class="post-datetime">
						15 Feb 2016, 00:08					</div>
				</div>
				<div class="post-content content">
					<p>Do you mean to return to vxworks? There is in this topic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p312783">
				<div class="post-metadata">
					<div class="post-num">Post #325</div>
					<div class="post-author">1307862086</div>
					<div class="post-datetime">
						27 Feb 2016, 16:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Delfer wrote:</cite><blockquote><div class="quotebox"><cite>ESonya wrote:</cite><blockquote><div class="quotebox"><cite>Delfer wrote:</cite><blockquote><p>Have you flash it with u-boot?</p></blockquote></div><p>Yes, I flashing u-boot from hackpascal.</p></blockquote></div><p>Share your fullflash and I will try to modify it with OpenWRT kernel and rootfs.</p></blockquote></div><p>Hi!<br />It seems you have run openwrt on ar2317 + ar8236 successfully？I have a router mercury MW54R, it has the same hardware with tl-wr340gd. I swaped the SPI flash to 64Mbit(8MB) W25Q64 too, and the RAM swaped to 32MB as well. Hackpascal&#039;s uboot has installed already. Could you share your binary firmware or source code？THX !<br />This forum can not send private message, you can contact me: xuexi8848@qq.com</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 13 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=17252&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=17252&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=14.html">14</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>