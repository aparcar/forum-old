<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> qos-script slows Kamikaze down to a crawl (whole system, not just WAN)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p120645">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						9 Nov 2010, 02:07					</div>
				</div>
				<div class="post-content content">
					<p>When I install qos-script (1.2.1-2) plus its dependencies on an otherwise mint installation of Kamikaze (8.09.2, kernel 2.4 with X-WRT built in) on either a Linksys WRT54GL v1.1 or a WRT54G v3.1 the whole system repeatedly becomes extremely laggy. The webinterface takes forever to load, ssh connections timeout from time to time and surfing the web (WAN port connected to my main LAN) is next to impossible.</p><p>I know people are moving towards non-Broadcom hardware but the WRT54G*-series of routers must still be in wide use. That&#039;s why I&#039;m very surprised I wasn&#039;t able to find anything about this problem on these forums. Would you be so kind to point me in the right direction? Thanks in advance!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120689">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						9 Nov 2010, 18:41					</div>
				</div>
				<div class="post-content content">
					<p>Though not an answer to your question, would you like to try <a href="http://www.gargoyle-router.com">Gargoyle</a>?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120711">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Nilfred</div>
					<div class="post-datetime">
						10 Nov 2010, 03:09					</div>
				</div>
				<div class="post-content content">
					<p>Uninstalll kmod-imq-queue</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120739">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						10 Nov 2010, 16:14					</div>
				</div>
				<div class="post-content content">
					<p>Well, there is no &quot;kmod-imq-queue&quot; on my system. (The only package named somewhat similar is &quot;kmod-ipt-imq&quot;. I don&#039;t know what it does exactly but qos-script depends on it through iptables-mod-imq.)</p><p>Here&#039;s a complete list of packages after qos-script (and its dependencies) have been added on an otherwise mint installation of Kamikaze 8.09.2 brcm-2.4 with X-WRT built in:</p><div class="codebox"><pre><code>base-files-brcm-2.4 - 14.3-r18961 -
bridge - 1.0.6-1 -
busybox - 1.11.2-2.2 -
dnsmasq - 2.47-3.3 -
dropbear - 0.51-2 -
firewall - 1-1.2 -
haserl - 0.9.24-1 -
iptables - 1.3.8-4.1 -
iptables-mod-conntrack - 1.3.8-4.1 -
iptables-mod-conntrack-extra - 1.3.8-4.1 -
iptables-mod-filter - 1.3.8-4.1 -
iptables-mod-imq - 1.3.8-4.1 -
iptables-mod-ipopt - 1.3.8-4.1 -
iptables-mod-nat - 1.3.8-4.1 -
kernel - 2.4.35.4-brcm-2.4-1 -
kmod-brcm-wl - 2.4.35.4+4.150.10.5.3-brcm-2.4-3.2 -
kmod-diag - 2.4.35.4-brcm-2.4-4.2 -
kmod-ipt-conntrack - 2.4.35.4-brcm-2.4-1 -
kmod-ipt-conntrack-extra - 2.4.35.4-brcm-2.4-1 -
kmod-ipt-core - 2.4.35.4-brcm-2.4-1 -
kmod-ipt-filter - 2.4.35.4-brcm-2.4-1 -
kmod-ipt-imq - 2.4.35.4-brcm-2.4-1 -
kmod-ipt-ipopt - 2.4.35.4-brcm-2.4-1 -
kmod-ipt-nat - 2.4.35.4-brcm-2.4-1 -
kmod-ipt-nathelper - 2.4.35.4-brcm-2.4-1 -
kmod-ppp - 2.4.35.4-brcm-2.4-1 -
kmod-pppoe - 2.4.35.4-brcm-2.4-1 -
kmod-sched - 2.4.35.4-brcm-2.4-1 -
kmod-switch - 2.4.35.4-brcm-2.4-1.1 -
kmod-wlcompat - 2.4.35.4+4.150.10.5.3-brcm-2.4-3.2 -
libgcc - 3.4.6-14.3 -
libuci - 0.7.3-1 -
mtd - 8.2 -
nas - 4.150.10.5.3-3.2 -
nvram - 1 -
opkg - 4564-3.1 -
ppp - 2.4.3-11.2 -
ppp-mod-pppoe - 2.4.3-11.2 -
qos-scripts - 1.2.1-2 -
tc - 2.6.25-1 -
uci - 0.7.3-1 -
uclibc - 0.9.29-14.3 -
webif - 0.3-4838 -
wireless-tools - 29-2 -
wlc - 4.150.10.5.3-3.2 -</code></pre></div><p>@fyi concerning Gargoyle:<br />Thanks for bringing Gargoyle to my attention! It looks quite interesting indeed. Are you using Gargoyle yourself? Can you still go ahead and edit all of Kamikaze&#039;s config files manually without throwing Gargoyle off track?<br />BTW, for me the single most useful feature in X-WRT is the ability to edit any text file directly through its web interface and then to save a whole bunch of them in one fell swoop once you&#039;re done. I find this a lot more comfortable than editing through ssh.</p>											<p class="post-edited">(Last edited by <strong>penkert</strong> on 10 Nov 2010, 16:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120742">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						10 Nov 2010, 16:27					</div>
				</div>
				<div class="post-content content">
					<p>I just found <a href="http://forum.x-wrt.org/index.php/topic,1419.0.html">this thread</a> from Febuary 2010 on the X-WRT forums. It&#039;s about Kamikaze 8.09.2 (not just brcm-2.4) with X-WRT paired with qos-script. The symptoms described vary and are not identical to mine but symptoms might depend on platform and/or configuration. <em>thepeople</em> makes it sound like the Kamikaze code is to blame instead of X-WRT&#039;s. Unfortunately no more information is given.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120743">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">KanjiMonster</div>
					<div class="post-datetime">
						10 Nov 2010, 16:40					</div>
				</div>
				<div class="post-content content">
					<p>Just to make sure, you did install <em>and</em> <a href="http://wiki.openwrt.org/doc/uci/qos">configure</a> QoS? It is known to cause slow connections when left with default values. </p><p>KM</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120745">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						10 Nov 2010, 17:04					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I did play around with QoS settings at first but I didn&#039;t touch them (or anything else) on that mint test installation I mentioned above. Please note that I&#039;m not talking about slow WAN traffic. Among other things, services like ssh and webif on the LAN (!!!) are ridiculously slow or time out altogether even though the LAN shouldn&#039;t be effected at all by QoS.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120834">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						11 Nov 2010, 19:05					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I&#039;m running Gargoyle v1.2.5 (Kamikaze 8.09.2) on Fonera+ and it&#039;s still OpenWrt. I run the followings to let X-Wrt WebifÂ² co-exist with Gargoyle.<br /></p><div class="quotebox"><blockquote><p><a href="http://wiki.x-wrt.org/index.php/Kamikaze_Installation#Changing_opkg.conf">Changing opkg.conf</a><br />opkg update<br />opkg -nodeps install webif<br />opkg install webif<br />Modify /etc/init.d/httpd_gargoyle:<br /></p><div class="codebox"><pre><code>#    rc_httpd=$(ls /etc/rc.d/*httpd 2&gt;/dev/null)
#    if [ -n &quot;rc_httpd&quot; ] ; then
#        /etc/init.d/httpd stop 2&gt;/dev/null
#        /etc/init.d/httpd disable 2&gt;/dev/null
#    fi</code></pre></div><p>Modify /etc/config/httpd_gargoyle<br /></p><div class="codebox"><pre><code>    option &#039;web_protocol&#039; &#039;https&#039;</code></pre></div><p>/etc/init.d/httpd_gargoyle enable<br />/etc/init.d/httpd enable</p></blockquote></div><p>Now access Gargoyle webif with ssl and X-Wrt webif without ssl.</p><p>Don&#039;t worry. Gargoyle also supports backup / restore configuration.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120887">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						12 Nov 2010, 13:30					</div>
				</div>
				<div class="post-content content">
					<p>OK, the qos-scripts issues described above are not present in pure Kamikaze 8.09.2 brcm-2.4 without X-WRT. I haven&#039;t tried installing X-WRT through packages though, so I can&#039;t say if X-WRT itself or just the compilation of the pre-built X-WRT image is to blame.</p><p>I also tried out Gargoyle on a different router. Quite promising. The looks could use some polishing but that&#039;s true for luci as well. I love that it uses the uci system even for its own setting and stores everything in /etc/config files. I still prefer to edit all of those files by hand though----it&#039;s quicker and makes for cleaner results. For me the real benefits of a web interface lie in statistical analysis and there&#039;s some great stuff in Gargoyle. I still miss X-WRT&#039;s text editor but I can live with nano even though some things (like deleting larger blocks of text) are a pain in the butt. I&#039;m not planning on going back to X-WRT any time soon because of the qos-scripts conflicts I experienced. But thanks for the suggestion of running X-WRT and Gargoyle in parallel and, as always, thanks for your help!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120902">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						12 Nov 2010, 16:21					</div>
				</div>
				<div class="post-content content">
					<p>Please try Midnight Commander (mc).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120932">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						12 Nov 2010, 21:52					</div>
				</div>
				<div class="post-content content">
					<p>Wow, I didn&#039;t know there&#039;s a file editor built into mc. That does make things&nbsp; easier. Thanks a lot, fyi!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120938">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						12 Nov 2010, 22:58					</div>
				</div>
				<div class="post-content content">
					<p>But since I&#039;m not a linux guru, I&#039;d prefer WinSCP. You might also want Screen so you can open several ssh sessions at the same time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p121024">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						13 Nov 2010, 19:14					</div>
				</div>
				<div class="post-content content">
					<p>WinSCP is an interesting concept, I&#039;ll give it a try in a short while. But why would I want screen? AFAIK the purpose of screen is to share the SAME ssh session among several clients while it&#039;s quite possible to have several independent and yet simultaneous sessions without screen, right?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>