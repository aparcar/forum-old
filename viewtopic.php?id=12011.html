<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> openssh vs dropbear</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p53640">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						9 Aug 2007, 22:49					</div>
				</div>
				<div class="post-content content">
					<p>hey all, I&#039;ve got a question about keyfiles produced by dropbear (eck!).&nbsp; </p><p>I have openwrt 0.9 installed with all the latest packages I can find.&nbsp; I also have an off-site server that employs the rsync utility under windows to upload data.&nbsp; I&#039;ve created rsa keyfiles and successfully automated my backups by adding their keys to the authorized_keys file on the off-site server.&nbsp; However, when attempting to add the dropbear keyfile, it&#039;s not in the right format.&nbsp; It doesn&#039;t produce a usable keyfile with the openssh system the rsync server uses.</p><p>So I&#039;ve battled back and forth with this for a while, trying to use dropbearconvert, copying the text output to a .txt file and using</p><p>cat untitled.txt &gt;&gt; authorized_keys</p><p>To no avail.&nbsp; I&#039;m almost about to give up hope that this is possible with the fact openwrt uses dropbear instead of openssh.&nbsp; Does anyone know how to get this to work or perhaps has had an experience similar to mine? (Or for that matter, know of a forum somewhere where there is a solution?)</p><p>i&#039;ve googled this and come up with nothing, maybe it was my keywords...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53649">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						9 Aug 2007, 23:47					</div>
				</div>
				<div class="post-content content">
					<p>It also could be that I don&#039;t have my keyfile created by dropbear in the right place! Where do I need to place the keyfile on my end for this to work without me having to enter a password to login every time?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53689">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						10 Aug 2007, 19:59					</div>
				</div>
				<div class="post-content content">
					<p>I feel like this topic is a shunned subject.&nbsp; I can&#039;t find anything related to what I&#039;m trying to do in the forums or googled, this seems to be an on-going error other people have posted about before but no one has resolved.&nbsp; I am trying to ssh to my router from my pc, then *from* the router to another off-site server that uses openssh.&nbsp; The reason behind this is I need to fingerprint my router so it can login to the off-site without the need for a password, similar to how you would if you wanted to login to the router from your pc.</p><p>I have no /etc/ssh folder, /etc/dropbear has some files in it that I&#039;m not sure how to modify or even use for that matter...</p><p>I&#039;ve installed the openssh packages but found no documentation as to where they create files, what utilities are inside the package, etc.<br />Obviously I&#039;m new to this whole idea of packages.&nbsp; Could anyone point me in the right direction? Anyone?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53693">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">evilghost</div>
					<div class="post-datetime">
						10 Aug 2007, 20:42					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/DropbearPublicKeyAuthenticationHowto">http://wiki.openwrt.org/DropbearPublicK â€¦ ationHowto</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53694">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						10 Aug 2007, 21:22					</div>
				</div>
				<div class="post-content content">
					<p>Correct me if I&#039;m wrong, but that appears to be a documentation file on how to login to your *router* from your *pc* without a password...</p><p>I&#039;m not trying to connect to my router without a password, I&#039;m trying to connect from the router to another server off-site.</p><p>Alright, so normally this is what I would do on a Windows machine so I can clarify a little better (this is directly from the server&#039;s documentation):</p><p>1. Log in, on your local system, AS THE USER you wish to make passwordless ssh connections</p><p>2. run the following:</p><p>&nbsp; &nbsp; ssh-keygen -t rsa</p><p>&nbsp; &nbsp; Accept the defaults - do not change the filenames or file locations<br />&nbsp; &nbsp; It is very important that the resultant private and public keys reside in your<br />&nbsp; &nbsp; home directories .ssh directory, or ~/.ssh (which is the default)</p><p>&nbsp; &nbsp; DO NOT enter a passphrase - just hit enter twice, leaving an empty passphrase.</p><p>3. Upload your public key to your rsync.net filesystem:</p><p>&nbsp; &nbsp; scp ~/.ssh/id_rsa.pub 1234@usw-s017.rsync.net:.ssh/authorized_keys</p><p>&nbsp; &nbsp; DO NOT change the permissions on the uploaded file, before or after the upload<br />&nbsp; &nbsp; DO NOT change the permissions on your home directory, or your .ssh directory<br />&nbsp; &nbsp; NOTE: 1234@usw-s017 is most certainly NOT your login ID or hostname - please change them.</p><p>4. Test that your key works by ssh&#039;ing to your rsync.net filesystem (from your local system, as the<br />&nbsp; &nbsp;user who created/uploaded the key):</p><p>&nbsp; &nbsp; ssh 1234@usw-s017.rsync.net</p><p>&nbsp; &nbsp; You should not be asked for a password<br />-------------------------------------------------------------------</p><p>Now, this has worked flawlessly for every Windows machine I&#039;ve done this on.&nbsp; However, my company utilizes smaller scale lighttpd servers and we wish to back up the web files to our rsync.net file server.&nbsp; Unfortunately, they use openssh and openwrt comes with the default of dropbear (eck).&nbsp; The above steps are used for the first public key added, and below here is where they talk about multiple keys.</p><p>1. For the first user on the first computer system, follow the instructions above exactly.</p><p>2. For each subsequent user (possibly on different computer systems), replace step #3 above with<br />&nbsp; &nbsp;this instead:</p><p>&nbsp; &nbsp; Download the authorized_keys file from your rsync.net account to the system you are working on:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; scp 1234@usw-s017.rsync.net:.ssh/authorized_keys ~/.ssh</p><p>&nbsp; &nbsp; APPEND your newly created public key to the just-downloaded authorized_keys file:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</p><p>&nbsp; &nbsp; Re-upload the authorized_keys file to your rsync.net account:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; scp ~/.ssh/authorized_keys 1234@usw-s017.rsync.net:.ssh/authorized_keys</p><p>&nbsp; &nbsp; Optionally, you may now delete the local copy of authorized_keys you just downloaded:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; rm -rf ~/.ssh/authorized_keys</p><p>&nbsp; &nbsp; This will overwrite the remote copy with the new, just-appended copy.&nbsp; At this point you<br />&nbsp; &nbsp; may also safely delete the authorized_keys file on your local system, as it is not needed.</p><p>3. Repeat this process for each user until you have a fully populated authorized_keys file in your rsync.net<br />&nbsp; &nbsp;account.</p><p>-----------------------------------------------------------------</p><p>Since I&#039;ve already said I&#039;m not savvy with keyfiles and don&#039;t understand much more than how to follow these directions here... dropbearconvert seems to produce unusable ssh keyfiles and dropbearkey only creates a private keyfile while outputting the public on the screen (stupid IMO), I&#039;m stuck.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53700">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						10 Aug 2007, 22:12					</div>
				</div>
				<div class="post-content content">
					<p>So for future reference in case anyone else comes across this same problem, this is what I&#039;ve done:</p><p>I&#039;ve used dropbearkey -t rsa -f id_rsa to create a dropbearkey.&nbsp; It prints the public key on the screen instead of in another file (stupid, IMO).&nbsp; I copy the public key with CTRL+C, paste it into a .txt file in Windows (because openwrt does not support pasting into an open vi session).&nbsp; I used cat txt.txt &gt;&gt; authorized_keys (from the server in question), used winscp to upload the authorized_keys file to the server, and then used dropbearconvert to convert the private key to openssh format.</p><p>I have the private key in /etc/.ssh/ because I don&#039;t know where else to put it, and it still fails to accept my connection without prompting me for a password.&nbsp; I&#039;ve tried to -NOT- use dropbearconvert, I&#039;ve tried creating a key on my windows machine (which wouldn&#039;t work, but nothing else did) and catting it, etc. following the whole process, I&#039;ve tried using DSA instead of RSA (which wouldn&#039;t work).</p><p>So, it seems as if connecting to an openssh server from an openwrt router without being prompted for a password just isn&#039;t possible.&nbsp; I&#039;ve contacted the server and inquired as to how to do this, and they&#039;ve never had issues with someone using dropbear before.&nbsp; They asked me whether or not I could use an openssh utility to create my keyfile, and I said I don&#039;t know -- the packages don&#039;t come with a manual or anything and the scripts/programs I&#039;ve found on my router by cd&#039;ing into every directory seem to lack any sort of keygen utility.&nbsp; </p><p>Oh, and uninstalling dropbear locked me out of my router, causing me to reflash due to a port 22 refusal when I ssh in.&nbsp; Telnet did not work, neither did RAW.&nbsp; I -DID- have web admin console access, and that&#039;s the only reason I was able to still re-flash.</p><p>So I guess my final questions before I give up this project are:</p><p>(1) Do I have my private keyfile in the correct spot? (/etc/.ssh/)<br />(2) IS there a keygen utility inside the ipkg &#039;openssh-client-utils&#039; that will create a keyfile?<br />(3) Is there any manual page besides the wiki linked above that details the contents of these openssh packages available? </p><p>Thank you for your time, obviously I&#039;m hitting my head on the wall and its starting to get bloody.<br /><span class="postimg"><img src="http://i54.photobucket.com/albums/g94/delaran/251981614_l.gif" alt="http://i54.photobucket.com/albums/g94/delaran/251981614_l.gif" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53704">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						10 Aug 2007, 22:26					</div>
				</div>
				<div class="post-content content">
					<p>So I&#039;ve converted my dropbear_rsa_host_key inside the /etc/dropbear/ folder to openssh which didn&#039;t do squat.&nbsp; I removed it and replaced it with the generated id_rsa file from earlier (converted from dropbear format), renamed it and still have the same problem.</p><p>I tried using ssh -i id_rsa root@host like was mentioned in a previous thread, tried making an alias for it and still get absolutely no changes in what is happening.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53705">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						10 Aug 2007, 22:45					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve got my private keyfile (openssh format) in these locations:</p><p>/.ssh<br />/etc/.ssh<br />/etc/ssh<br />/etc/dropbear</p><p>Still nothing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53745">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">rhashimoto</div>
					<div class="post-datetime">
						11 Aug 2007, 19:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>OpenWrter wrote:</cite><blockquote><p>I tried using ssh -i id_rsa root@host like was mentioned in a previous thread, tried making an alias for it and still get absolutely no changes in what is happening.</p></blockquote></div><p>Here&#039;s what works for me on RC5:</p><p>- Use dropbearkey to generate a key:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# dropbearkey -t rsa -f id_rsa
Will output 1024 bit rsa secret key to &#039;id_rsa&#039;
Generating key, this may take a while...
Public key portion is:
ssh-rsa AAAAB3Nza[...]
Fingerprint: md5 ca:e8:f0:b7:f6:7b:c2:b6:b9:71:e4:45:86:a9:ff:b8</code></pre></div><p>- Copy and paste the key (I left off the fingerprint) on the server into ~/.ssh/authorized_keys.&nbsp; Make sure this is a single line in this file, i.e. your editor does not automatically insert a line break.<br />- From the router, ssh with -i:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ssh -i id_rsa roy@192.168.1.11
Last login: Sat Aug 11 09:49:26 2007 from 192.168.1.3

roy@localhost ~
$</code></pre></div><p>Roy</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53828">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						13 Aug 2007, 21:02					</div>
				</div>
				<div class="post-content content">
					<p>Yeah, that worked.&nbsp; I had tried this before but must have had the id_rsa file in the wrong place.</p><p>For anyone who&#039;s having the same problem that I&#039;ve had above, rhash has the right idea.&nbsp; Copy and paste the printed ssh-rsa key into your authorized_keys file (on whatever box you want, could be windows, could be linux), re-upload it to the openssh server and use</p><p>ssh -i id_rsa root@host</p><p>to login.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>