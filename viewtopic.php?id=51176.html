<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Using ipset-dns to selectively cache (typically large) OS updates</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 15 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p237246">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						18 Jun 2014, 21:49					</div>
				</div>
				<div class="post-content content">
					<p>With the recent addition of the ipset option to dnsmasq, here is an idea about taking advantage of it :</p><p>Background: Anyone who operates a public/semi-public Wifi network (e.g. school / university, hotel, airport, exhibition fair etc) could potentially save many GBytes of WAN traffic just from caching OS updates (iOS, Windows, Android). If we make Squid cache ALL web traffic of a large heterogenous user population, we&#039;d need a much beefier hardware yet it would probably yield minimal benefits, since the Squid cache&#039;s &quot;hit rate&quot; will be low, as every user in e.g. an airport would probably be visiting different websites.</p><p>We can try to reduce WAN traffic by selectively caching OS updates by Apple, Microsoft and Android (which are typically quite large, ranging from several 100MBs to over a GByte in size). In such a scenario, we could use dnsmasq&#039;s ipset-dns feature to &quot;populate&quot; ipsets with the IPs of the domains used by Apple/MS/Google to host their OS updates and then use OpenWRT&#039;s firewall to selectively redirect only that HTTP traffic to a Squid box.</p><p>Has anyone used such a setup ? (please feel free to offer comments/suggestions/flames)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237254">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						18 Jun 2014, 22:15					</div>
				</div>
				<div class="post-content content">
					<p>Generally pointless because most updates are delivered over SSL/TLS nowadays, deliberately to stop people doing things like this.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 18 Jun 2014, 22:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237260">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						18 Jun 2014, 22:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>Generally pointless because most updates are delivered over SSL/TLS nowadays, deliberately to stop people doing things like this.</p></blockquote></div><p>Obviously it won&#039;t work If they&#039;ve switched over to using HTTPS instead of HTTP, but I was under the impression that at least Windows and Apple were still mostly using HTTP for OS updates ... ? (admittedly I haven&#039;t checked it in several years, but the respective Squid wiki page don&#039;t mention any switch from http to https)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>