<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT on Vocore2 with Huawei E3372 not workign</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 23 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p351686">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">onno</div>
					<div class="post-datetime">
						11 Feb 2017, 20:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;m running into a problem getting an E3372 dongle working with OpenWrt Chaos Calmer 15.05.1 r49378;<br />root@OpenWrt:~# uname -a<br />Linux OpenWrt 3.18.29 #5 Sat Feb 11 17:28:43 UTC 2017 mips GNU/Linux</p><p>The device seems at least to be detected:<br />[&nbsp; 501.930000] usb 1-1: new high-speed USB device number 2 using ehci-platform<br />[&nbsp; 502.080000] usb 1-1: no of_node; not parsing pinctrl DT<br />[&nbsp; 502.120000] usb-storage 1-1:1.0: no of_node; not parsing pinctrl DT<br />[&nbsp; 502.120000] usb-storage 1-1:1.0: USB Mass Storage device detected<br />[&nbsp; 502.150000] scsi host0: usb-storage 1-1:1.0<br />[&nbsp; 502.490000] usb 1-1: USB disconnect, device number 2</p><p>root@OpenWrt:~# lsusb<br />Bus 001 Device 006: ID 12d1:1f01 Huawei Technologies Co., Ltd. <br />Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub<br />Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</p><p>But gets disconnected really quick. Then it &#039;connects&#039; again.</p><p>According to this post at protyposis.net using hi-link dongle with openwrt, it should/could work almost right away. However I&#039;m not that lucky ;o)</p><p>I believe I installed all the needed modules:<br />root@OpenWrt:~# lsmod |grep usb<br />ledtrig_usbdev&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1936&nbsp; 0 <br />mii&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3528&nbsp; 1 usbnet<br />scsi_mod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;85655&nbsp; 2 usb_storage<br />usb_common&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1740&nbsp; 1 usbcore<br />usb_storage&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 37263&nbsp; 0 <br />usbcore&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;117364 12 cp210x<br />usbnet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16982&nbsp; 2 cdc_ncm<br />usbserial&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 18059&nbsp; 1 cp210x</p><p>root@OpenWrt:~# lsmod |grep ether<br />cdc_ether&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3420&nbsp; 0 </p><p>root@OpenWrt:~# lsmod |grep cdc<br />cdc_ether&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3420&nbsp; 0 <br />cdc_ncm&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11333&nbsp; 0 <br />usbnet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16982&nbsp; 2 cdc_ncm</p><p>I even tried the huawei_cdc_ncm module, but it still briefly connects and then disconnects:</p><p>root@OpenWrt:~# dmesg | tail<br />[ 1323.000000] usbcore: registered new interface driver cdc_wdm<br />[ 1327.400000] usbcore: registered new interface driver huawei_cdc_ncm<br />[ 1587.280000] usb 1-1: new high-speed USB device number 8 using ehci-platform<br />[ 1587.430000] usb 1-1: no of_node; not parsing pinctrl DT<br />[ 1587.500000] usb-storage 1-1:1.0: no of_node; not parsing pinctrl DT<br />[ 1587.500000] usb-storage 1-1:1.0: USB Mass Storage device detected<br />[ 1587.510000] scsi host3: usb-storage 1-1:1.0<br />[ 1587.870000] usb 1-1: USB disconnect, device number 8</p><p>Anyone an idea on how to get this dongle working?<br />Or is there a list with (confirmed) supported/working dongles? However I believe the E3372 is supported ...</p><p>KR,<br />Onno.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351701">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">JonnyM</div>
					<div class="post-datetime">
						12 Feb 2017, 00:52					</div>
				</div>
				<div class="post-content content">
					<p>Check your log for more occurrences of&nbsp; &quot;usb 1-1: USB disconnect, device number&quot;. <br />It should only happen once and that is when usbmode switches the E3372 from install mode to usable mode, if it happens more then it is likely that Vocore2 can not provide enough usb power to keep E3372 running.<br />A separately powered usb hub in between&nbsp; will solve that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351703">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">onno</div>
					<div class="post-datetime">
						12 Feb 2017, 01:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi Johnny,</p><p>Thanks for your reply. I thought that also could be the issue, however I hooked it up to a 5v/2A adapter so I thought it should not be the problem. Will try with an USB powered hub as soon as I&#039;ve got one ;o)</p><p>Will update this topic with the results.</p><p>KR.<br />Onno</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351737">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">onno</div>
					<div class="post-datetime">
						12 Feb 2017, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>To bad. I hooked up another 5v/2A power supply to power the USB, but still the same.<br />[&nbsp; 855.120000] usb 1-1: new high-speed USB device number 11 using ehci-platform<br />[&nbsp; 855.270000] usb 1-1: no of_node; not parsing pinctrl DT<br />[&nbsp; 855.320000] usb-storage 1-1:1.0: no of_node; not parsing pinctrl DT<br />[&nbsp; 855.320000] usb-storage 1-1:1.0: USB Mass Storage device detected<br />[&nbsp; 855.340000] scsi host9: usb-storage 1-1:1.0<br />[&nbsp; 855.710000] usb 1-1: USB disconnect, device number 11</p><p>Then I also tried to run usbmode manually, as soon as the green led on the huawei started to blink. Running it multiple times I sometimes manage to get output, so it seems to recognise something:<br />root@OpenWrt:/etc# &quot;/sbin/usbmode&quot; -l<br />Found device: 12d1:1f01 (Manufacturer: &quot;HUAWEI_MOBILE&quot;, Product: &quot;HUAWEI_MOBILE&quot;, Serial: &quot;0123456789ABCDEF&quot;)</p><p>The usbmode.json does have an entry for the device:<br />&quot;12d1:1f01&quot;: {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;*&quot;: {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;t_vendor&quot;: 4817,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;t_product&quot;: [ 5339, 5340 ],&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;mode&quot;: &quot;HuaweiNew&quot;,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;no_driver&quot;: true,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;msg&quot;: [&nbsp; ]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />},</p><p>And even one time it seems to succesfully switch, until the device gets disconnected again:<br />[&nbsp; 795.000000] usb 1-1: new high-speed USB device number 6 using ehci-platform<br />[&nbsp; 795.150000] usb 1-1: no of_node; not parsing pinctrl DT<br />[&nbsp; 795.260000] cdc_ether 1-1:1.0: no of_node; not parsing pinctrl DT<br />[&nbsp; 795.310000] cdc_ether 1-1:1.0 eth1: register &#039;cdc_ether&#039; at usb-101c0000.ehci-1, CDC Ethernet Device, 0c:5b:8f:27:9a:64<br />[&nbsp; 795.340000] usb-storage 1-1:1.2: no of_node; not parsing pinctrl DT<br />[&nbsp; 795.340000] usb-storage 1-1:1.2: USB Mass Storage device detected<br />[&nbsp; 795.350000] scsi host4: usb-storage 1-1:1.2<br />[&nbsp; 795.410000] usb 1-1: USB disconnect, device number 6<br />[&nbsp; 795.420000] cdc_ether 1-1:1.0 eth1: unregister &#039;cdc_ether&#039; usb-101c0000.ehci-1, CDC Ethernet Device</p><p>USB Debug also shows the device, when I&#039;m fast enough before it gets disconnected again:<br />root@OpenWrt:~# cat /sys/kernel/debug/usb/devices</p><p>T:&nbsp; Bus=02 Lev=00 Prnt=00 Port=00 Cnt=00 Dev#=&nbsp; 1 Spd=12&nbsp; &nbsp;MxCh= 1<br />B:&nbsp; Alloc=&nbsp; 0/900 us ( 0%), #Int=&nbsp; 0, #Iso=&nbsp; 0<br />D:&nbsp; Ver= 1.10 Cls=09(hub&nbsp; ) Sub=00 Prot=00 MxPS=64 #Cfgs=&nbsp; 1<br />P:&nbsp; Vendor=1d6b ProdID=0001 Rev= 3.18<br />S:&nbsp; Manufacturer=Linux 3.18.29 ohci_hcd<br />S:&nbsp; Product=Generic Platform OHCI controller<br />S:&nbsp; SerialNumber=101c1000.ohci<br />C:* #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=&nbsp; 0mA<br />I:* If#= 0 Alt= 0 #EPs= 1 Cls=09(hub&nbsp; ) Sub=00 Prot=00 Driver=hub<br />E:&nbsp; Ad=81(I) Atr=03(Int.) MxPS=&nbsp; &nbsp;2 Ivl=255ms</p><p>T:&nbsp; Bus=01 Lev=00 Prnt=00 Port=00 Cnt=00 Dev#=&nbsp; 1 Spd=480&nbsp; MxCh= 1<br />B:&nbsp; Alloc=&nbsp; 0/800 us ( 0%), #Int=&nbsp; 0, #Iso=&nbsp; 0<br />D:&nbsp; Ver= 2.00 Cls=09(hub&nbsp; ) Sub=00 Prot=00 MxPS=64 #Cfgs=&nbsp; 1<br />P:&nbsp; Vendor=1d6b ProdID=0002 Rev= 3.18<br />S:&nbsp; Manufacturer=Linux 3.18.29 ehci_hcd<br />S:&nbsp; Product=EHCI Host Controller<br />S:&nbsp; SerialNumber=101c0000.ehci<br />C:* #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=&nbsp; 0mA<br />I:* If#= 0 Alt= 0 #EPs= 1 Cls=09(hub&nbsp; ) Sub=00 Prot=00 Driver=hub<br />E:&nbsp; Ad=81(I) Atr=03(Int.) MxPS=&nbsp; &nbsp;4 Ivl=256ms</p><p>T:&nbsp; Bus=01 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#= 48 Spd=480&nbsp; MxCh= 0<br />D:&nbsp; Ver= 2.10 Cls=00(&gt;ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs=&nbsp; 1<br />P:&nbsp; Vendor=12d1 ProdID=1f01 Rev= 1.02<br />S:&nbsp; Manufacturer=HUAWEI_MOBILE<br />S:&nbsp; Product=HUAWEI_MOBILE<br />S:&nbsp; SerialNumber=0123456789ABCDEF<br />C:* #Ifs= 1 Cfg#= 1 Atr=80 MxPwr=&nbsp; 2mA<br />I:* If#= 0 Alt= 0 #EPs= 2 Cls=08(stor.) Sub=06 Prot=50 Driver=usb-storage<br />E:&nbsp; Ad=81(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=01(O) Atr=02(Bulk) MxPS= 512 Ivl=125us</p><p>Any(one) idea&#039;s?<br />Or should I just go with another dongle? Any recommendations?</p><p>KR,<br />Onno.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351784">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">JonnyM</div>
					<div class="post-datetime">
						13 Feb 2017, 04:18					</div>
				</div>
				<div class="post-content content">
					<p>usbmode has switched the device and you have got cdc_ether to bind to the two first interfaces (0 and 1) and the storage driver to bind on interface 2 which is for the built in tf/sd-card reader.<br />Then it falls off the usb bus....<br />This is very likely a power problem or a power glitch which occurs when the dongle registers to the mobile network (it starts its transmitter and that increases the current consumption).</p><p>There is nothing in your log showing something strange from system side.</p><p>Your listing of usb devices shows the dongle in initial mode (not switched) after it has fallen off the usb bus.<br />Only a power drop or physical removal of the dongle can reset it back to initial mode.</p>											<p class="post-edited">(Last edited by <strong>JonnyM</strong> on 13 Feb 2017, 04:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p352112">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">onno</div>
					<div class="post-datetime">
						16 Feb 2017, 21:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi Jonny,</p><p>Ok, so I bought a ms-tech mini usb hub with external power.. now the dongle gets recognized correctly and I get an extra interface.. all seems indeed power issue then.<br />Still strange as 2Amps should be way enough for all components. I guess something is drawing more power than the datasheets say it does. Even with a separate power supply for the USB port, it was still not working, while the power supply supplied with the usb hub also has the same ratings. :s</p><p>I&#039;ll be looking into this a bit more, but for now thank you very much for your time and looking into this. Much appreciated.</p><p>KR,<br />Onno.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>