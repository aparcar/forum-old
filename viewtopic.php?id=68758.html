<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Huawei E3372 aka Telekom Speedstick LTE V setup problems</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p345314">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">hmdev</div>
					<div class="post-datetime">
						30 Nov 2016, 16:21					</div>
				</div>
				<div class="post-content content">
					<p>Hello all,</p><p>I have a problem getting a Huawei E3372 aka Telekom Speedstick LTE V to work with OpenWrt (Chaos Calmer 15.05.1).</p><p>I have searched the forum and the internet for several hours now and tried out all kind of installation steps. So far to no avail. </p><p>This (protyposis.net/blog/using-the-huawei-e3372-hi-link-lte-dongle-with-openwrt/) states it should easily work, however it does not work for me. I also tried to follow these two tutorials (wiki.openwrt.org/doc/recipes/ltedongle and wiki.openwrt.org/doc/recipes/3gdongle) and the further links given there.</p><p>Possibly the modem is in a wrong mode, however I cant figure out which mode would be the right one and how to get there.</p><p>Currently the modem reports on lsusb as:<br />ID 12d1:1c05 Huawei Technologies Co., Ltd. E173s 3G broadband stick (modem on)</p><p>It also provides two USB serial devices (/dev/ttyUSB0 and 1) with kmod-usb-serial-option and kmod-usb-serial installed.</p><p>/sys/kernel/debug/usb/devices lists the following</p><p>T:&nbsp; Bus=01 Lev=02 Prnt=02 Port=00 Cnt=01 Dev#=&nbsp; 5 Spd=480&nbsp; MxCh= 0<br />D:&nbsp; Ver= 2.10 Cls=00(&gt;ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs=&nbsp; 1<br />P:&nbsp; Vendor=12d1 ProdID=1c05 Rev= 1.02<br />S:&nbsp; Manufacturer=HUAWEI_MOBILE<br />S:&nbsp; Product=HUAWEI_MOBILE<br />C:* #Ifs= 3 Cfg#= 1 Atr=80 MxPwr=&nbsp; 2mA<br />I:* If#= 0 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=ff Prot=ff Driver=option<br />E:&nbsp; Ad=81(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=01(O) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />I:* If#= 1 Alt= 0 #EPs= 2 Cls=08(stor.) Sub=06 Prot=50 Driver=usb-storage<br />E:&nbsp; Ad=82(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=02(O) Atr=02(Bulk) MxPS= 512 Ivl=125us<br />I:* If#= 2 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=ff Prot=ff Driver=option<br />E:&nbsp; Ad=83(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=03(O) Atr=02(Bulk) MxPS= 512 Ivl=0ms</p><p>Maybe someone can point me to into the right direction.<br />Thanks,<br />Holger</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345317">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						30 Nov 2016, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>Looks like so far, so good.&nbsp; The option driver has worked to link the USB bus to one or more ttyUSB devices.&nbsp; Does you log list any ppp activity?&nbsp; After the serial ports are created, the ppp driver should take them and attempt to &quot;dial&quot; a connection to the Internet.</p><p>Always a good idea to test the dongle on a desktop / laptop to make sure it is properly activated with the wireless company.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 30 Nov 2016, 16:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345323">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hmdev</div>
					<div class="post-datetime">
						30 Nov 2016, 17:54					</div>
				</div>
				<div class="post-content content">
					<p>No, I don&#039;t see any ppp activity in the logs.</p><p>I&#039;m not even sure whether the modem currently supports ppp.<br />It seems it can be in either one of three different modes,<br />1. HiLink/router-mode<br />2. stick/modem-mode (native NCM)<br />3. legacy PPP</p><p>It is supposed to be in either mode one or two. The problem is, I have no indication in which mode it is or how to find it out.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345374">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						1 Dec 2016, 04:09					</div>
				</div>
				<div class="post-content content">
					<p>The ltedongle recipe talks about one kind of mode control using AT^SETPORT.&nbsp; The picocom package lets you open ttyUSB ports with the command line and manually enter AT commands.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345415">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hmdev</div>
					<div class="post-datetime">
						1 Dec 2016, 19:41					</div>
				</div>
				<div class="post-content content">
					<p>I tried picocom on ttyUSB0 and ttyUSB1. ttyUSB0 does not reply to anything, while ttyUSB1 returns &#039;~L~&#039; for every character I type. I have tried all baud rates 300, 1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200, 230400, 460800 and 921600, same result. No reply to an AT command. Seems the serial ports are not really active.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345419">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						1 Dec 2016, 20:04					</div>
				</div>
				<div class="post-content content">
					<p>The baud rate setting is not relevant, the driver just ignores it since there is no physical wire moving async bits in a system like this.&nbsp; It does sound like your dongle is misconfigured.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348888">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hmdev</div>
					<div class="post-datetime">
						9 Jan 2017, 21:54					</div>
				</div>
				<div class="post-content content">
					<p>I finally got a new stick (same model) which seems to behave better.</p><p>lsusb is now:<br />Bus 001 Device 007: ID 12d1:1506 Huawei Technologies Co., Ltd. E398 LTE/UMTS/GSM Modem/Networkcard</p><p>/sys/kernel/debug/usb/devices lists the following<br />T:&nbsp; Bus=01 Lev=02 Prnt=02 Port=00 Cnt=01 Dev#=&nbsp; 7 Spd=480&nbsp; MxCh= 0<br />D:&nbsp; Ver= 2.10 Cls=00(&gt;ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs=&nbsp; 1<br />P:&nbsp; Vendor=12d1 ProdID=1506 Rev= 1.02<br />S:&nbsp; Manufacturer=HUAWEI_MOBILE<br />S:&nbsp; Product=HUAWEI_MOBILE<br />C:* #Ifs= 5 Cfg#= 1 Atr=80 MxPwr=&nbsp; 2mA<br />I:* If#= 0 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=02 Prot=12 Driver=option<br />E:&nbsp; Ad=82(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=02(O) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />I:* If#= 1 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=02 Prot=01 Driver=option<br />E:&nbsp; Ad=84(I) Atr=03(Int.) MxPS=&nbsp; 10 Ivl=32ms<br />E:&nbsp; Ad=83(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=03(O) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />I:* If#= 2 Alt= 0 #EPs= 1 Cls=ff(vend.) Sub=02 Prot=16 Driver=(none)<br />E:&nbsp; Ad=86(I) Atr=03(Int.) MxPS=&nbsp; 16 Ivl=2ms<br />I:&nbsp; If#= 2 Alt= 1 #EPs= 3 Cls=ff(vend.) Sub=02 Prot=16 Driver=(none)<br />E:&nbsp; Ad=86(I) Atr=03(Int.) MxPS=&nbsp; 16 Ivl=2ms<br />E:&nbsp; Ad=85(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=04(O) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />I:* If#= 3 Alt= 0 #EPs= 2 Cls=08(stor.) Sub=06 Prot=50 Driver=usb-storage<br />E:&nbsp; Ad=87(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=05(O) Atr=02(Bulk) MxPS= 512 Ivl=125us<br />I:* If#= 4 Alt= 0 #EPs= 2 Cls=08(stor.) Sub=06 Prot=50 Driver=usb-storage<br />E:&nbsp; Ad=88(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms<br />E:&nbsp; Ad=06(O) Atr=02(Bulk) MxPS= 512 Ivl=125us</p><p>There are two USB serial devices (/dev/ttyUSB0 and 1) with kmod-usb-serial-option and kmod-usb-serial installed.</p><p>Both react to sending the AT command with OK and to AT^SETPORT with ^SETPORT:A1,A2;12,1,16,A1,A2</p><p>ttyUSB0 also spits out ^RSSI:xx (xx=some value) and ^HCSQ:&quot;LTE&quot;,...</p><p>The firmware version is reported (AT+CGMR) as: 21.315.01.00.55</p><p>I will now try to get this one up and running.<br />Thanks for your help so far mk24.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348969">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">hmdev</div>
					<div class="post-datetime">
						10 Jan 2017, 15:29					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I got it to work now. Thanks again mk24.</p><p>For everyone with similar problems:<br />From the output of AT^SETPORT the modem supports 3g_modem and ncm protocol.</p><p>(from pastebin.com/YrS4Nkq2)<br />^SETPORT:A1,A2;12,1,16,A1,A2<br />17.WCDMA: huawei,,pcui:0,3g_modem:1,ncm:2,mass:3,mass_two:4</p><br /><p>After trying the 3g protocol connection first, which was not successful, I tried the ncm protocol and after some playing arround, installing the required packages and finding the right ttyUSB for the configuration, the following settings in /etc/config/network work:</p><p>config interface &#039;wwan0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option auto &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option pincode &#039;xxxx&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;/dev/ttyUSB0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option apn &#039;internet.t-mobile&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option username &#039;t-mobile&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option password &#039;tm&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;ncm&#039;</p><p>Then a simple &quot;ifup wwan0&quot; starts the LTE connection</p><p>The required packages are:<br />kmod-usb-net-cdc-ncm<br />kmod-usb-net-huawei-cdc-ncm<br />comgt-ncm</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>