<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> D-Link DIR-615 HW rev C1 USB</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 9 Apr 2018 and 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 5</div><nav><ul><li><a href="viewtopic.php%3Fid=19948&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=19948&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=19948&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=19948&amp;p=5.html">5</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p129380">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">ldpinney</div>
					<div class="post-datetime">
						24 Feb 2011, 16:05					</div>
				</div>
				<div class="post-content content">
					<p>Thanks regressor for the fine tutorial!<br />Reference : <a href="http://wiki.openwrt.org/toh/d-link/dir-615/c2-usb">http://wiki.openwrt.org/toh/d-link/dir-615/c2-usb</a></p><p>Software : Latest trunk build with mach-dir-615-c1.c Gives the following error:<br />-------------------------------------------------------------------------------------------------------------<br />arch/mips/ar71xx/mach-dir-615-c1.c:23:21: error: dev_usb.h: No such file or directory<br />arch/mips/ar71xx/mach-dir-615-c1.c: In function &#039;dir_615c1_setup&#039;:<br />arch/mips/ar71xx/mach-dir-615-c1.c:151: error: implicit declaration of function &#039;ar71xx_add_device_usb&#039;<br />make[6]: *** [arch/mips/ar71xx/mach-dir-615-c1.o] Error 1<br />make[5]: *** [arch/mips/ar71xx] Error 2<br />--------------------------------------------------------------------------------------------------------<br />So it seems dev_usb.h file is missing or is not in the location required.<br />Where can I find the proper dev_usb.h and place it before building again?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129388">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						24 Feb 2011, 17:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ldpinney wrote:</cite><blockquote><p>Thanks regressor for the fine tutorial!<br />Reference : <a href="http://wiki.openwrt.org/toh/d-link/dir-615/c2-usb">http://wiki.openwrt.org/toh/d-link/dir-615/c2-usb</a></p><p>Software : Latest trunk build with mach-dir-615-c1.c Gives the following error:<br />-------------------------------------------------------------------------------------------------------------<br />arch/mips/ar71xx/mach-dir-615-c1.c:23:21: error: dev_usb.h: No such file or directory<br />arch/mips/ar71xx/mach-dir-615-c1.c: In function &#039;dir_615c1_setup&#039;:<br />arch/mips/ar71xx/mach-dir-615-c1.c:151: error: implicit declaration of function &#039;ar71xx_add_device_usb&#039;<br />make[6]: *** [arch/mips/ar71xx/mach-dir-615-c1.o] Error 1<br />make[5]: *** [arch/mips/ar71xx] Error 2<br />--------------------------------------------------------------------------------------------------------<br />So it seems dev_usb.h file is missing or is not in the location required.<br />Where can I find the proper dev_usb.h and place it before building again?</p></blockquote></div><p>You did install packages kmod-usb-core, kmod-usb2, kmod-usb-storage, etc... right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129389">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">ldpinney</div>
					<div class="post-datetime">
						24 Feb 2011, 18:21					</div>
				</div>
				<div class="post-content content">
					<p>No I&#039;m trying to keep the build small and intended to install these &quot;options&quot; as packages after flashing. <br />Because if I compile in &quot;all what you want&quot; I know it won&#039;t fit in 4MB <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />I&#039;ll try it again WITH kmods-usb-xxx as modules<br />Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129414">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						24 Feb 2011, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>@ldpinney</p><p>You&#039;ll actually save space by including your required packages in your build because it will go into the squashfs (compressed)... that is, your packages will be smaller in squashfs vs jffs.&nbsp; And kmod-usb-core is not optional if you plan on using USB... you should build it into your image, which I think will solve your dependency on &#039;dev_usb.h&#039; and &#039;ar71xx_add_device_usb&#039;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129514">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">tuckata</div>
					<div class="post-datetime">
						26 Feb 2011, 11:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ldpinney wrote:</cite><blockquote><p>Thanks regressor for the fine tutorial!<br />Reference : <a href="http://wiki.openwrt.org/toh/d-link/dir-615/c2-usb">http://wiki.openwrt.org/toh/d-link/dir-615/c2-usb</a></p><p>Software : Latest trunk build with mach-dir-615-c1.c Gives the following error:<br />-------------------------------------------------------------------------------------------------------------<br />arch/mips/ar71xx/mach-dir-615-c1.c:23:21: error: dev_usb.h: No such file or directory<br />arch/mips/ar71xx/mach-dir-615-c1.c: In function &#039;dir_615c1_setup&#039;:<br />arch/mips/ar71xx/mach-dir-615-c1.c:151: error: implicit declaration of function &#039;ar71xx_add_device_usb&#039;<br />make[6]: *** [arch/mips/ar71xx/mach-dir-615-c1.o] Error 1<br />make[5]: *** [arch/mips/ar71xx] Error 2<br />--------------------------------------------------------------------------------------------------------<br />So it seems dev_usb.h file is missing or is not in the location required.<br />Where can I find the proper dev_usb.h and place it before building again?</p></blockquote></div><p>Idpinney, <a href="https://dev.openwrt.org/browser/branches/backfire/target/linux/ar71xx/files/arch/mips/ar71xx/dev-usb.h">dev_usb.h</a> should be in the same directory as <a href="https://dev.openwrt.org/browser/branches/backfire/target/linux/ar71xx/files/arch/mips/ar71xx/mach-dir-615-c1.c">mach-dir-615-c1.c</a> is. If it is there, then maybe something is wrong with the include directive, </p><div class="codebox"><pre><code>#include &quot;dev_usb.h&quot;</code></pre></div><p>searches for the header file in the same directory and </p><div class="codebox"><pre><code>#include &lt;dev_usb.h&gt;</code></pre></div><p>searches in the include path and it does not necessarily include the current directory. Hope this helps, but I guess you&#039;ve solved it already.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129518">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">regressor</div>
					<div class="post-datetime">
						26 Feb 2011, 13:19					</div>
				</div>
				<div class="post-content content">
					<p>I downloaded latest trunk code and checked for dev_usb.h<br />Sorry. My fault. I changed it allready with #include <span style="color: blue">&quot;dev-usb.h&quot;</span> in this thread and in wiki page.</p>											<p class="post-edited">(Last edited by <strong>regressor</strong> on 26 Feb 2011, 13:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129624">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">ldpinney</div>
					<div class="post-datetime">
						27 Feb 2011, 23:58					</div>
				</div>
				<div class="post-content content">
					<p>Success! It&#039;s up and running the latest Kamikaze.<br />Thanks again regressor <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Yes the dev_usb files were not included (on a fresh build)<br />SO...I built &quot;fresh&quot; firmware for my DIR-825 and that put the files in...<br />Then built for the DIR-615 and it works fine....I&#039;ll give it some more testing later....</p><p>This will make a fine &quot;back-up&quot; router while I transform my 825 into a home server <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Actually the 615 is also a place to hone my skills ... before I hack up the more expensive 825.<br />So I&#039;ll try to do the 64M upgrade next <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>ldpinney</strong> on 28 Feb 2011, 00:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129672">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">ldpinney</div>
					<div class="post-datetime">
						28 Feb 2011, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>Seems to work OK.... However I&#039;m getting the following (from dmesg)<br />ath: Failed to stop TX DMA in 100 msec after killing last frame<br />ath: DMA failed to stop in 10 ms AR_CR=0x00000024 AR_DIAG_SW=0x42000020<br />ath: Could not stop RX, we could be confusing the DMA engine when we start RX up<br />AND<br />ath: Failed to stop TX DMA in 100 msec after killing last frame<br />ath: Failed to stop TX DMA!<br />Both are repetitive </p><p>Googling reveals it&#039;s a common problem although I haven&#039;t found the solution...YET<br />If someone here already knows the solution...I would appreciate the help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130119">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">sint</div>
					<div class="post-datetime">
						7 Mar 2011, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi ldpinney and all,</p><p>Would it be possible for you to put the firmware on your dropbox <a href="http://www.dropbox.com">www.dropbox.com</a> ?</p><p>(Any file you put in the public folder gets its own Internet link.)</p><p>I am a newbie with compiling. My DIR-615C1 is my main and only router right now and I would like to do this mod in the next few weeks. Now I have the solder and the lead <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> .</p><p>Thank you so much for your help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130188">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">ldpinney</div>
					<div class="post-datetime">
						8 Mar 2011, 19:33					</div>
				</div>
				<div class="post-content content">
					<p>I now believe the previously mentioned the dmesg error is hardware not software related?? <br />As my soldering skills may not be so good on things this small.<br />So my router reboots repeatedly but only when the radio is in use.....only the wired connections are usable at this time. <br />@ sint I don&#039;t have a dropbox account ...perhaps I should ? You can PM or e-mail me and I&#039;ll e-mail you my copy of the USB enabled DIR-615C1 firmware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130556">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">zhongderong</div>
					<div class="post-datetime">
						12 Mar 2011, 15:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ldpinney wrote:</cite><blockquote><p>I now believe the previously mentioned the dmesg error is hardware not software related?? <br />As my soldering skills may not be so good on things this small.<br />So my router reboots repeatedly but only when the radio is in use.....only the wired connections are usable at this time. <br />@ sint I don&#039;t have a dropbox account ...perhaps I should ? You can PM or e-mail me and I&#039;ll e-mail you my copy of the USB enabled DIR-615C1 firmware.</p></blockquote></div><p>Would you mind send one for me? My e-mail address is: zdrzero@gmail.com. thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130590">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">tuckata</div>
					<div class="post-datetime">
						12 Mar 2011, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys,</p><p>I&#039;ve uploaded precompiled images of the OpenWRT Backfire 10.03.1-rc4 (the last official 10.03.1 prerelease) with USB support enabled for DIR-615 C1, TL-WR941ND and TL-WR740N:</p><p><a href="https://sites.google.com/site/tuckata/downloads/openwrt-ar71xx-dir-615-c1-squashfs.zip">openwrt-ar71xx-dir-615-c1-squashfs.zip</a><br /><a href="https://sites.google.com/site/tuckata/downloads/openwrt-ar71xx-tl-wr941nd-v3-squashfs.zip">openwrt-ar71xx-tl-wr941nd-v3-squashfs.zip</a><br /><a href="https://sites.google.com/site/tuckata/downloads/openwrt-ar71xx-tl-wr740n-v1-squashfs.zip">openwrt-ar71xx-tl-wr740n-v1-squashfs.zip</a></p><p>It is preconfigured to fetch packages from the correct url (<a href="http://downloads.openwrt.org/backfire/10.03.1-rc4/ar71xx/packages/">http://downloads.openwrt.org/backfire/1 … /packages/</a>).</p><p>For USB storage you should install the following packages:<br /></p><div class="codebox"><pre><code>opkg update
opkg install kmod-usb-core kmod-usb2 kmod-usb-storage kmod-fs-vfat kmod-nls-cp437 kmod-nls-iso8859-1</code></pre></div><p>For TL-WR740N kmod-usb-ohci instead of kmod-usb2 should be installed.</p><p>As the flash space is very confined the filesystem can be extended on external flashdrive by installing packages block-extroot and kmod-fs-ext3 for external ext3 volume and modify /etc/config/fstab, just enable the option is_rootfs. It would be good to mount the filesystem by label as if there is more than one device there might be a confusion. Here is mine /etc/config/fstab:<br /></p><div class="codebox"><pre><code>config global automount
        option from_fstab 1
        option anon_mount 1

config global autoswap
        option from_fstab 1
        option anon_swap 0

config mount
        option target   /home
#       option device   /dev/sda1
        option label    nilinux
        option fstype   ext3
        option options  rw,sync
        option enabled  1
        option enabled_fsck 1
        option is_rootfs 1

config swap
#       option device   /dev/sda2
        option label    niswap
        option enabled  0

config mount
        option target   /home
#       option device   /dev/sdb1
        option label    felinux
        option fstype   ext3
        option options  rw,sync
        option enabled  1
        option enabled_fsck 1
        option is_rootfs 0

        config swap
#       option device   /dev/sdb2
        option label    feswap
        option enabled  1</code></pre></div><p>With this release of Backfire fstab is moved as a service so to do a second permanent mount (not extroot) you should first enable the service:<br /></p><div class="codebox"><pre><code>/etc/init.d/fstab enable
reboot</code></pre></div><p>I&#039;ve installed also USB printer, 3g modem, USB soundcard, samba share on a external harddrive. I&#039;ve also installed Debian/mips with debootstrap and (!)KDE. It did work (with external X server), but it was awfully slow because of the low amount of RAM (32MB). On 64MB mod it should run smoothly :) I may write my USB adventures but it&#039;s getting late now.</p><p>You could give it a try and give feedback.</p><p>Cheers</p>											<p class="post-edited">(Last edited by <strong>tuckata</strong> on 13 Mar 2011, 14:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p132302">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">amendajoe5555</div>
					<div class="post-datetime">
						5 Apr 2011, 07:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>melodic wrote:</cite><blockquote><p>I think usb mod is possible because many devices on AR9130 and USB onboard exist such as Linksys E2100L, Linksys WRT160NL, Alfa Networks AIP-W502U. But all of those have 8 Mb of flash memory.</p><p>I have made this mod but it is not working. (</p></blockquote></div><p>ya i have heard about inksys E2100L, Linksys WRT160NL that they are 8 MB of flash memory but..! i have never heard about Alfa Networks AIP-W502U that it would have the same as you are talking about??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136628">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">jasonsmr</div>
					<div class="post-datetime">
						7 Jun 2011, 06:09					</div>
				</div>
				<div class="post-content content">
					<p>HELLO ;&nbsp; I am very interested in what &#039;tuckata&#039; did with his external root (extroot) I would like&nbsp; to hear more about what it is that he liked about this particular setup from him.</p><p>AND if anyone else has similar types of mounts in their setups, then to help me realize the usage that is going on here?</p><p>BTW .. I am currently getting the precomputed ones also, and I like their basic packaging, I was fed up with compiling bin images that were too large. </p><p>I want to use an external root for basically all things, besides preinit. I want to re-create a preinit on the device with a minimal footprint , then ether do a pivotroot or what tuckata seems to have done cleverly.</p><p>IM Currently doing a nbd block mount it works great , but the second non is_root is confusing to me , in what way does this help create a permanency? do I create a mirror or te nilinux at felinux on my nbd-block server and give this back to the openwrt? or will felinux be somehow different, and in what little ways is it better from other methods?, and what specific ways is the two blocks&nbsp; different</p><p>thanks for any help</p><p>jason</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136630">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">tuckata</div>
					<div class="post-datetime">
						7 Jun 2011, 08:26					</div>
				</div>
				<div class="post-content content">
					<p>Hi Jason,</p><p>In your configuration you would only need one ext_root (nilinux in my config) and probably one swap (niswap in my config). In my setup there are two external storage devices plugged in a hub - a flash drive and an usb hard drive. The idea is that the external root filesystem is on the flash drive (mounted on /) and a home directory (the second mount) which is on the hard drive is mounted on /home. The access time to the flash drive is quick and to the hard drive is slower but the storage capacity is much larger. So, the firmware is extended on the external root on the flash drive and is accessed quick. On the hard drive there is a larger storage SAMBA share which is visible on the LAN. It doesn&#039;t have to be quick. Please note that the first ext_root flash drive mount nilinux is mounted on &#039;/&#039; because of the option &quot;is_rootfs 1&quot; and the option &quot;target /home&quot; in this case is ignored! I also have swaps on the two drives. For the experiments I&#039;ve done I badly needed a swap but generally to have a swap on a flash drive is not preferable - it would wear out eventually. Another thing for this config - all mounts are mounted by label - and because of this it doesn&#039;t matter in what order they are plugged in the hub. In your configuration you wouldn&#039;t need labels. I have tried root and swap over nbd in a different environment and it is really great, you are on the right track!</p><p>tuckata</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136642">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">swiftik</div>
					<div class="post-datetime">
						7 Jun 2011, 13:34					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://d1.ourdev.cn/bbs_upload603362/files_36/ourdev_614687P5MT8O.pdf">http://d1.ourdev.cn/bbs_upload603362/fi … P5MT8O.pdf</a><br />This should help to make all mod <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p>											<p class="post-edited">(Last edited by <strong>swiftik</strong> on 7 Jun 2011, 13:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138377">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">jasonsmr</div>
					<div class="post-datetime">
						3 Jul 2011, 02:47					</div>
				</div>
				<div class="post-content content">
					<p>Thanks tuckata on the clarification, I want to do what your doing now that I think about it your way seems more NAS using my method , I had to load certain modules into the flash then clone over to the ext again then preform various time consuming upgrades, I had to do this several times before I go it just right, and I still get the occasional error and Segfaults many actually on writes and reads.</p><p>The idea of having root in use on a flash seems ideal, I wonder how your achievement into actually getting that abstraction that you have now working? or rather does it work well? I see that is some achievement.</p><p>I have seen other mods for a serial to usb in this device , something that powers a drive though would need a real usb? or a converter is still a converter isnt it and not true usb.</p><p>In my attempt to make the mod I was a bit clumsy I soldered the bottom of the PBC where the 472 resister needs to go near the processor, however I accidentally removed the smaller resistor just below it, (just plain black with no markings) It the driver didnt work with the kernel -2.6.32.27 or rather I couldn&#039;t figure out how to make it work yet. </p><p>The plan was to plug the usb into a hub that carried a mini-drive slot and various other card slots. (note that all these newer devices have a serial to usb interface in the chip, but I guess making the usb connection is far easier that manually attempting to configure a serial connection through the mini drives various directives.)</p><p>I dont know about debugging though , Im using a all linux/Unix system and have yet set up a serial port to receive the Dlink dir-615c1 Rev ::A3 serial</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138393">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">tuckata</div>
					<div class="post-datetime">
						3 Jul 2011, 17:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi Jason,</p><p>The firmware extension on ext_root on external USB flash drive is working pretty stable.</p><p>I see you&#039;ve been fighting with the hardware for a while. What point you have reached with the software, have you installed an USB enabled firmware?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138441">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">tuckata</div>
					<div class="post-datetime">
						4 Jul 2011, 23:05					</div>
				</div>
				<div class="post-content content">
					<p>Hey, Jason,</p><p>Sorry, I&#039;ve read your post again and obviously you&#039;ve installed software. You&#039;ve described in detail what you&#039;ve done with the hardware but please also describe what you&#039;ve done with the software.</p><p>The hardware mod is more simple, (just USB_RREF 4.7 Kohm, and two 22 ohm impedance matching resistors are more than enough), so I think you should focus on the software and be (almost) sure that it is working as expected.</p><p>Don&#039;t bother with that small black resistor, if you look at the schematic provided by swiftik R11/R13 form some (in my opinion not important) EJTAG_SEL bootstrap jumper. Just any resistor (1 Kohm, 4.7 kOhm, etc...) should work.</p><p>By the way, about the hardware, as the 5 volt DC-DC converter is not installed on board, I&#039;ve used one from <a href="http://www.dealextreme.com/p/car-cigarette-powered-1000ma-usb-adapter-charger-white-dc-12v-40469">Car Cigarette Powered 1000mA USB Adapter/Charger</a>. I&#039;m more than happy with it, it draws 1A(!) and it is much more than the USB spec (500 mA). And also, not least, it glows in the dark <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> (not that I see it under the hood) <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Also about hardware, now there are cheap routers with USB 2.0 mounted on board, like TP-LINK TL-MR3420, so next time I may get such one.</p><p>I suppose you&#039;ve used trunk, I&#039;ve also started with one. And I had some strange experiences with it. I can&#039;t remember which build was it, but after everything was OK with the USB, if I&#039;ve tried to execute file on USB file system it crashed with SIGSEGV and SIGILL. Eventually, it turned out that it was a bug in the file system code which didn&#039;t manage correctly the data cache page flush, and, it affected only filesystems other than the embedded (squashfs and jffs were not affected, ext2/3 and vfat were!). There was no trace of this bug in the next trunk releases. I&#039;ve decided not to use trunk, but a more predictable backfire release and I&#039;ve compiled backfire 10.03.1-rc4 with USB support. The benefit would be that it is known stable version, and, one could use all the precompiled packages available for download, and, in this version ext_root is supported natively - no need to explicitly recompile the firmware because of it. I&#039;ve done that and now the bluetooth driver and the tun driver (used by OpenVPN) are buggy - the kernel oopses <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> I do not have much time to play with the router now so I plan to recompile and install the next stable version, when it comes out.</p><p>Now, about the USB software side. When you add the &quot;ar71xx_add_device_usb();&quot; line to mach-dir-615-c1.c, when the ehci module ehci-hcd.ko is inserted in the kernel the following is seen in the syslog (dmesg):<br /></p><div class="codebox"><pre><code>ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
ar71xx-ehci ar71xx-ehci: Atheros AR91xx built-in EHCI controller
ar71xx-ehci ar71xx-ehci: new USB bus registered, assigned bus number 1
ar71xx-ehci ar71xx-ehci: irq 3, io mem 0x1b000000
ar71xx-ehci ar71xx-ehci: USB 2.0 started, EHCI 1.00</code></pre></div><p>If you see this you are (almost) there! The USB_PLL has to be initialized, and if it is not, you won&#039;t see anything in the syslog, but nevertheless there will still be no USB communication. This is done usually in the boot loader (u-boot) in routers in which the USB is used, but is omitted in routers like D-LINK DIR-615 C1&amp;C2 and TP-LINK TL-WR941ND, where the USB port is there but is officially not used. So, to do this you could add another line to the kernel patch or just to try it you could initialize it by hand on the u-boot command line prompt by<br /></p><div class="codebox"><pre><code>mw.l b8050008 1030; boot</code></pre></div><p>Also, if you want just to play something without flashing the router you could use initramfs firmware image.</p><p>OK, that&#039;s it, focus on the software and when you are (almost) sure it should work grab the soldering iron and solder all around <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138709">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">jasonsmr</div>
					<div class="post-datetime">
						8 Jul 2011, 09:02					</div>
				</div>
				<div class="post-content content">
					<p>tuckata, hey; </p><p>I will do what you suggest and solder later, I hope that the RC-5 hats out has some good code and stable* enough.</p><p>1.) first, Ill download it then follow the directions found at the top here&gt;&gt; <a href="http://wiki.openwrt.org/toh/d-link/dir-615/c2-usb">http://wiki.openwrt.org/toh/d-link/dir-615/c2-usb</a></p><p>2.)Second Ill re-read what you said, and make certian that things are rolling <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> with the aformentioned checkpoint you gave me, let me say that I have gotten that far allready, and I thought that the RC-5 may allready have this mod?? guess not, I can see it loading with devise usb and it actualy mounts a none on usbfs /proc/usb (not exact location but thats the idea anyway)</p><p>it did not show this last time &gt;&gt;<br />ar71xx-ehci ar71xx-ehci: irq 3, io mem 0x1b000000<br />ar71xx-ehci ar71xx-ehci: USB 2.0 started, EHCI 1.00</p><p>so Im guessing the mod will complete when that codes finished right, im off</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140380">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">johnisaacson</div>
					<div class="post-datetime">
						1 Aug 2011, 09:07					</div>
				</div>
				<div class="post-content content">
					<p>First of all I gotta thank every one who contributed on this thread. It&#039;s allowed me to try a bunch of things I haven&#039;t done before.</p><p>I have modded a DIR-615 C1 (flea market special $2.69) as per previous details. I got Openwrt mounted on it and booting from an external 2 GB USB flash drive.</p><p>Filesystem Mount Point Available Used <br />&nbsp; &nbsp; <br />/dev/root&nbsp; &nbsp; &nbsp;/rom&nbsp; &nbsp; &nbsp;0.00 B / 1.38 MB&nbsp; &nbsp; &nbsp;100% (1.38 MB)&nbsp; &nbsp; &nbsp;<br />tmpfs&nbsp; &nbsp; &nbsp;/tmp&nbsp; &nbsp; &nbsp;12.98 MB / 14.41 MB&nbsp; &nbsp; &nbsp;10% (1.43 MB)&nbsp; &nbsp; &nbsp;<br />tmpfs&nbsp; &nbsp; &nbsp;/dev&nbsp; &nbsp; &nbsp;512.00 KB / 512.00 KB&nbsp; &nbsp; &nbsp;0% (0.00 B)&nbsp; &nbsp; &nbsp;<br />/dev/sda1&nbsp; &nbsp; &nbsp;/overlay&nbsp; &nbsp; &nbsp;732.39 MB / 795.21 MB&nbsp; &nbsp; &nbsp;3% (22.42 MB)&nbsp; &nbsp; &nbsp;<br />mini_fo:/overlay&nbsp; &nbsp; &nbsp;/&nbsp; &nbsp; &nbsp;0.00 B / 1.38 MB&nbsp; &nbsp; &nbsp;100% (1.38 MB)&nbsp; &nbsp; &nbsp;<br />/dev/sda2&nbsp; &nbsp; &nbsp;/mnt/sda2&nbsp; &nbsp; &nbsp;1.07 GB / 1.07 GB&nbsp; &nbsp; &nbsp;0% (4.00 KB)&nbsp; &nbsp; &nbsp;</p><p>I used tuckata&#039;s &quot;openwrt-ar71xx-dir-615-c1-squashfs.zip&quot; (thanks tuckata!) as a first go and it&#039;s running fine.</p><p>I have not managed to get&nbsp; a build on Backfire-rc5 or Trunk to install.<br />I followed regressor&#039;s (post #37) instructions and the build goes (no error messages V=99) ok but it will not install properly.</p><p>Has any one had a similar experience?</p><p>~john</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140554">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">johnisaacson</div>
					<div class="post-datetime">
						3 Aug 2011, 22:21					</div>
				</div>
				<div class="post-content content">
					<p>I now have build this mod on trunk and working on extroot.</p><p>~john</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140586">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">Farshid.T</div>
					<div class="post-datetime">
						4 Aug 2011, 12:02					</div>
				</div>
				<div class="post-content content">
					<p>My DIR-615 modem has the USB port (!!) however it can&#039;t be used by default.<br />This modem is branded for an ISP.</p><p><span class="postimg"><img src="http://i51.tinypic.com/dfk4nl.png" alt="http://i51.tinypic.com/dfk4nl.png" /></span><br /><span class="postimg"><img src="http://i53.tinypic.com/1e9s1v.png" alt="http://i53.tinypic.com/1e9s1v.png" /></span></p><p>Do you think I can get it worked using the software modifications in the wiki ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140609">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">johnisaacson</div>
					<div class="post-datetime">
						4 Aug 2011, 18:51					</div>
				</div>
				<div class="post-content content">
					<p>I see it is a version G1 . I don&#039;t have any experience with this version.</p><p>The unit I have is C1.</p><p>Based on this wiki <a href="http://wiki.openwrt.org/toh/d-link/dir-615">http://wiki.openwrt.org/toh/d-link/dir-615</a> I don&#039;t see any support for it yet.</p><p>~john</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144023">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">jasonsmr</div>
					<div class="post-datetime">
						20 Sep 2011, 02:54					</div>
				</div>
				<div class="post-content content">
					<p>regressor, are you still around this forum?</p><p>READING an earlier post you made, you suggested that you had an innuendo to make a custom U-boot, bootloader? </p><p>How did that work out, I am scowering the internet looking for a way to access this u-boot on this hardware, it, What you suggested would require changing the NAND in the device) I was told*&nbsp; by u-boot iirc that the openwrt dosent touch the factory u-boot image and that it is setup to only load what it needs to do.</p><p>So why not find out how to load a new image from the existing u-boot? Thats what I suggest anyway, </p><p>I have a question of my own &gt; How can I actually access this type of loading in this same router dir-615 rev c2 to chain boot via the u-boot? to another kernel (not openwrt)</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 3 of 5</div><nav><ul><li><a href="viewtopic.php%3Fid=19948&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=19948&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=19948&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=19948&amp;p=5.html">5</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>