<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> LuCI run with standard user (not root)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p92059">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ksin</div>
					<div class="post-datetime">
						29 Jul 2009, 21:32					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I would like to run LuCI with ordinary user (not root user). I read the documentation, but without success.<br />I add a new user with busybox adduser function but unfortunately I can&#039;t access with this user (no problem with root)<br />Does anybody make something like that ?<br />Thanks in advance for your answer.</p><p>ksin</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92060">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kupesoft</div>
					<div class="post-datetime">
						29 Jul 2009, 22:27					</div>
				</div>
				<div class="post-content content">
					<p>Without some serious hacking, I think you&#039;re out of luck. OpenWrt and LuCI are pretty much designed to have all configuration modified by the root user.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92078">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">DCRoss</div>
					<div class="post-datetime">
						30 Jul 2009, 04:53					</div>
				</div>
				<div class="post-content content">
					<p>This is a bit old, but here is the &quot;serious hacking&quot; that was required to add additional user support to the old web interface:</p><div class="codebox"><pre><code># cat /etc/httpd.conf
/:root:$p$root
/:admin:$p$root
/:myusername:$p$myusername
/:anotherusername:$p$anotherusername
.asp:text/html
.svg:image/svg+xml
.png:image/png
.gif:image/gif
.jpg:image/jpg
.js:application/x-javascript</code></pre></div><p>All I had to do was add the third and fourth lines so that I could have two non-root users log in and have full control over the webif.</p><p>I don&#039;t have a working build with LuCI right now and I&#039;m not entirely clear on what you want to do with it, but this may be a start.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92079">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">kupesoft</div>
					<div class="post-datetime">
						30 Jul 2009, 05:07					</div>
				</div>
				<div class="post-content content">
					<p>DCRoss: <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /> -- I thought he meant a different user in /etc/passwd, I swear</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92095">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">ksin</div>
					<div class="post-datetime">
						30 Jul 2009, 12:34					</div>
				</div>
				<div class="post-content content">
					<p>Yes Kupesoft, you are right, <br />I would like to add a new user but only for display and not modification.<br />Do you confirm it&#039;s a lot of work ?</p><p>Ksin</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117349">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jalbert</div>
					<div class="post-datetime">
						17 Sep 2010, 06:04					</div>
				</div>
				<div class="post-content content">
					<p>Does anyone have an update on this?&nbsp; I am running luci on 8.09.&nbsp; I can login with a non root user, but all I get is a white screen.&nbsp; Any help?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123387">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">monkey</div>
					<div class="post-datetime">
						17 Dec 2010, 12:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jalbert wrote:</cite><blockquote><p>I can login with a non root user, but all I get is a white screen.</p></blockquote></div><p>same here. If it is not working throuhg the /etc/passwd, maybe there is a way of just authenticating to the web-server (with an htpasswd-file or something like that). </p><p>I need an admin-user just for logging in to the luci webinterface. The Services can remain in running as root-user.... Does anyone have a clue how to realize this? I think changes need to be made in luci to get this working. Im running an older version of luci-0.9 (revision 6122)....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123405">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						17 Dec 2010, 16:09					</div>
				</div>
				<div class="post-content content">
					<p>Beeing a configuration UI, LuCI is designed to run as root. Even if you allow another user to login he gains full root right through the ui and can for example just change the root password and take over the device.<br />Until LuCI gains acl management on a per-page basis there will be no true multiuser support.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123631">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">monkey</div>
					<div class="post-datetime">
						21 Dec 2010, 15:25					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your answer jow. I think I need to be more conkrete on my issue:</p><p>We are delivering OpenWrt-based routers to our customers. When they run into trouble they give us a call and we are connecting to the box using ssh. Now we need the root-password to be able to login/configure their system. It happens to often that the customer who is calling, does not know the password. So we thought about using the root-user for remote maintenance, and creating an admin-user for our customers.</p><p>At the moment I added an admin-user in /etc/passwd which has the same uid and gid as root. Now Im able to login using admin and do all the stuff that root can do. This works fine for me, but Ive been told to switch these usernames. So I need to make admin the user for our customers to login (on LuCI), and root the user for remote access (ssh).</p><p>Can you tell me what needs to be done to login as admin on LuCI?</p><p>Monkey</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123644">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">towolf</div>
					<div class="post-datetime">
						21 Dec 2010, 20:03					</div>
				</div>
				<div class="post-content content">
					<p>Just put a public key for SSH into /etc/dropbear/authorized_keys and bake that into the image.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123754">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">0xception</div>
					<div class="post-datetime">
						23 Dec 2010, 01:03					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m also attempting to set up a multi user system. I would like to have the standard root user w/ ssh access and then either and admin or some sort of restricted access web UI interface for the other user login. </p><p>Everything seems to work okay if you setup the system w/ multi user via ssh. I can simply restrict access and control via the normal unix permission settings. But luci is a different beast, I tried to change the group w/ rw access on all the luci and lua files needed but i still get the blank white page on login w/ a non root user.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126562">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">a2group</div>
					<div class="post-datetime">
						26 Jan 2011, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>it is possible to webif2 X-wrt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182570">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">NielsvA</div>
					<div class="post-datetime">
						6 Nov 2012, 21:15					</div>
				</div>
				<div class="post-content content">
					<p>As this thread somehow always comes up in Google instead of the solution thread, this post has the answer for Luci users on Kamikaze 10.3.1<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=163013#p163013">https://forum.openwrt.org/viewtopic.php … 13#p163013</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225553">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">nachoparker</div>
					<div class="post-datetime">
						17 Feb 2014, 13:59					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I submitted a patch to this forums to achieve the following:</p><p>- Disable &#039;root&#039; login in the web interface, so that we make a distinction between system and web interface administration. SSH/telnet interface still functional for &#039;root&#039; user, but not for &#039;webadmin&#039; user.</p><p>- Allow a new user &quot;webadmin&quot; full control of the web interface</p><p>- Disable web interface access to any system user other than &#039;webadmin&#039;. Currently, any system user is able to input user/password and get a blank page if that user is not &#039;root&#039; (or whatever sysauth is set to).</p><p>See <a href="https://forum.openwrt.org/viewtopic.php?pid=225552#p225552">https://forum.openwrt.org/viewtopic.php … 52#p225552</a></p>											<p class="post-edited">(Last edited by <strong>nachoparker</strong> on 17 Feb 2014, 13:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230053">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">hostle19</div>
					<div class="post-datetime">
						13 Apr 2014, 05:22					</div>
				</div>
				<div class="post-content content">
					<p>Not necro this thread but I am working on a project that requires non root user access to the luci web ui as well. I am very close to working multi user hack for luci but i need a little help to finish it off</p><p>To allow multi user login (as root) is a very simple hack and requires one edit to the .. luci/dispatcher.lua file</p><div class="codebox"><pre><code>function authenticator.htmlauth(validator, accs, default)
    local user = luci.http.formvalue(&quot;username&quot;)
    local pass = luci.http.formvalue(&quot;password&quot;)

    if user and validator(user, pass) then
        user = &quot;root&quot;  &lt;---#### if user/pass check grant root access ####
        return user
    end

    require(&quot;luci.i18n&quot;)
    require(&quot;luci.template&quot;)
    context.path = {}
    luci.template.render(&quot;sysauth&quot;, {duser=default, fuser=user})
    return false

end</code></pre></div><p>of course you need to add the users using a shell script or by copiling with adduser support.</p><p>Now to only 1 non root user is very simple aswell and requires 2 edits ...3 to prevent the user from setting root passwd from ui</p><p>1. edit the .. luci/controller/admin/index.lua as follows ...</p><div class="codebox"><pre><code>function index()
    local root = node()
    if not root.target then
        root.target = alias(&quot;admin&quot;)
        root.index = true
    end    
    local page   = node(&quot;admin&quot;)
    page.target  = firstchild()
    page.title   = _(&quot;Administration&quot;)
    page.order   = 10
    page.sysauth =  &quot;root&quot;  &lt;--#### change username ####
    page.sysauth_authenticator = &quot;htmlauth&quot;
    page.ucidata = true
    page.index = true

    -- Empty services menu to be populated by addons
    entry({&quot;admin&quot;, &quot;services&quot;}, firstchild(), _(&quot;Services&quot;), 40)
end</code></pre></div><p>2. edit the&nbsp; .. luci/controller/admin/servicectl.lua as follows ..</p><div class="codebox"><pre><code>## and again change the &quot;root&quot;  to non root username ##

function index()
   entry({&quot;servicectl&quot;}, alias(&quot;servicectl&quot;, &quot;status&quot;)).sysauth = &quot;root&quot; 
   entry({&quot;servicectl&quot;, &quot;status&quot;}, call(&quot;action_status&quot;)).leaf = true
   entry({&quot;servicectl&quot;, &quot;restart&quot;}, call(&quot;action_restart&quot;)).leaf = true
end</code></pre></div><p>3. and to prevent the user from setting the root password from the ui you edit the .. luci/controller/admin/system.lua&nbsp; and change the &quot;root&quot; in the set_passwd function to the non root username or add a conditon to only so if user is root .</p><p>you may also need to remove the /tmp/indexcache file from the changes to take effect ...if you were already loggeed in before making the cahnges.</p><p>I have tested this and it works 100% ... this allows a non root user to log in with non root users privileges. However since these variable are currently hard coded after making the changes only the non root user can log in, all other users receive the &quot;CGI failed to produce response ..&quot; error. including root</p><p>So to complete this hack, these three variables must be set to the&nbsp; username entered by the user at login ...if the user/pass checks out. I have tried using a function to provided the name enterd by the user to the locations needed but i seem to be having some problems with the plumbing lol</p><p>Hopefully Jow or someone with more knowledge of the luci system can help to allow setting these variables at login and complete the multi user hack for luci. One can easily add conditons using the username or user privi&#039;s to prevent non root users from accessing the parts of the web ui that allow them to set root passwds, firewall settings, network settings,&nbsp; ssh settings...etc</p>											<p class="post-edited">(Last edited by <strong>hostle19</strong> on 13 Apr 2014, 06:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230104">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">hostle19</div>
					<div class="post-datetime">
						13 Apr 2014, 21:22					</div>
				</div>
				<div class="post-content content">
					<p>ok so for a simple test, i had the htmlauth store the username provided by the username in the global table. Then tried to access it for the index sysauth vaule but it is not accesable to inside of index however it can be accessed from the from the page once it has loaded . So it would seem that index is parsed before the username is ever submited from the login ..??</p><p>just trying to get a grapse on what is going on here</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230164">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">zopico</div>
					<div class="post-datetime">
						14 Apr 2014, 12:35					</div>
				</div>
				<div class="post-content content">
					<p>What about a person who wants to login via ssh as a normal user. For instance I have tried to set this up but I had trouble doing this because the documentation that I was following requested me to create a user on the filesystem like so:</p><p>mkdir /home/user</p><p>That does not seem to work on my openwrt installation. I did not find any other documentation that would show me how else to do this.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230178">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">hostle19</div>
					<div class="post-datetime">
						14 Apr 2014, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>users can be added very with a simple sh script.&nbsp; Here is the one i use</p><p>USE AT YOUR OWN RISK !!</p><p>name: adduser</p><div class="codebox"><pre><code>#!/bin/sh

## VARIABLES ##
login=$1
uid=$2

passwdf=&quot;/etc/passwd&quot;
passwdfmin=&quot;/etc/passwd-&quot;
shadowf=&quot;/etc/shadow&quot;
shadowfmin=&quot;/etc/shadow-&quot;
groupf=&quot;/etc/group&quot;
homerootdir=&quot;/home&quot;
shell=&quot;/bin/ash&quot;

## START ##
echo &quot;Add a new user:&quot;
if [ &quot;$1&quot; != &quot;&quot; ] ; then
  login=$1
else
  echo -n &quot;login: &quot; ; read login
fi

username=`grep $login $passwdf|awk -F : &#039;{print $1}&#039;`
if [ &quot;$username&quot; = &quot;$login&quot; ]; then                               
  echo &quot;ERROR: The user $login already exists, so please use a different login name.&quot;
  exit 1
else
  echo &quot;using username: $login&quot;
fi
          
if expr &quot;$2&quot; : &#039;-\?[0-9]\+$&#039; &gt;/dev/null ; then
  uid=$2
else
  uid=&quot;$(awk -F: &#039;{ if (big &lt; $3 &amp;&amp; $3 &lt; 5000) big=$3 } END { print big + 1 }&#039; $passwdf)&quot;
  if [ $uid -lt 1000 ] ; then
    uid=1000
  fi
fi

userid=`grep $uid $passwdf|awk -F : &#039;{print $1}&#039;`
if [ &quot;$userid&quot; = &quot;$uid&quot; ]; then
  echo &quot;ERROR: The userid $uid already exists, so please use a different userid.&quot;
  exit 1
else
  echo &quot;using uid/guid: $uid&quot;
fi
                              
homedir=$homerootdir/$login
                              
# gid=uid as in Fedora
gid=$uid

# echo ${login}:x:${uid}:${gid}:${fullname}:${homedir}:$shell &gt;&gt; $passwdf                      
echo ${login}:x:${uid}:${gid}:${login}:${homedir}:$shell &gt;&gt; $passwdf
echo ${login}:*:${uid}:${gid}:${login}:${homedir}:$shell &gt;&gt; $passwdfmin
echo ${login}:*:11647:0:99999:7::: &gt;&gt; $shadowf
echo ${login}:*:11647:0:99999:7::: &gt;&gt; $shadowfmin
echo &quot;${login}:x:${gid}:$login&quot; &gt;&gt; $groupf
                                
if [ ! -d &quot;$homerootdir&quot; ]; then
  mkdir  $homerootdir
fi

if [ ! -d &quot;$homedir&quot; ]; then
  mkdir $homedir
fi
                                    
#cp -R /etc/skel/.[a-zA-Z]* $homedir
chmod 755 $homedir
find $homedir -print | xargs chown ${login}:$login
passwd $login
                                    
exit 0</code></pre></div><p>To set uid/guid you must supply it as second argument to the script..</p><p>usage: adduser &lt;new username&gt; &lt;uid&gt;&nbsp; </p><p>ie ... adduser Frank 500</p><p>if no args are provided then you will be prompt to enter user name and uid/guid will automatically be set start at 1000 and incremented +1 per new user.</p><p>after runing the script you should be able to log on via ssh with the new user/pass combo.</p><p>##UPDATE ##</p><p>there was a error in the script above, {fullname} is no logger a variable as in is the same as {login} so it was redundant and I removed it but for got to replace it in the script. I have made the edit to the script, it should was as desired now</p>											<p class="post-edited">(Last edited by <strong>hostle19</strong> on 16 Apr 2014, 19:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230542">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">hostle19</div>
					<div class="post-datetime">
						17 Apr 2014, 18:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zopico wrote:</cite><blockquote><p>What about a person who wants to login via ssh as a normal user. For instance I have tried to set this up but I had trouble doing this because the documentation that I was following requested me to create a user on the filesystem like so:</p><p>mkdir /home/user</p><p>That does not seem to work on my openwrt installation. I did not find any other documentation that would show me how else to do this.</p></blockquote></div><p>I should also point out the error in your syntax so you understand why the cmd you entered did not work.</p><p>you are correct when you say that openwrt does not contain the /home directory natively ( openwrt was designed as a single user system so there is only root user ...no need for home directory) how ever you can easily add it from the cmd line if you use the right syntax. The reason it would not work the way you entered it is ...</p><div class="codebox"><pre><code>mkdir /home/user </code></pre></div><p>this is telling the shell to add the directory &quot;user&quot; to the &quot;/home&quot; directory, but there is no home directory ..yet </p><p>so you first need to create the &quot;/home&quot; directory before you can add the &quot;user&quot; directory to it </p><p>ie ..&nbsp; </p><div class="codebox"><pre><code> mkdir /home </code></pre></div><p>then you can add the /user directory to it..</p><p>ie&nbsp; </p><div class="codebox"><pre><code>mkdir /home/user </code></pre></div><p>jsyn&nbsp; <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256227">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">maplewang</div>
					<div class="post-datetime">
						2 Dec 2014, 07:02					</div>
				</div>
				<div class="post-content content">
					<p>Is there any lua page can adduser?</p><br /><div class="quotebox"><cite>hostle19 wrote:</cite><blockquote><p>users can be added very with a simple sh script.&nbsp; Here is the one i use</p><p>USE AT YOUR OWN RISK !!</p><br /><p>name: adduser</p><div class="codebox"><pre><code>#!/bin/sh

## VARIABLES ##
login=$1
uid=$2

passwdf=&quot;/etc/passwd&quot;
passwdfmin=&quot;/etc/passwd-&quot;
shadowf=&quot;/etc/shadow&quot;
shadowfmin=&quot;/etc/shadow-&quot;
groupf=&quot;/etc/group&quot;
homerootdir=&quot;/home&quot;
shell=&quot;/bin/ash&quot;

## START ##
echo &quot;Add a new user:&quot;
if [ &quot;$1&quot; != &quot;&quot; ] ; then
  login=$1
else
  echo -n &quot;login: &quot; ; read login
fi

username=`grep $login $passwdf|awk -F : &#039;{print $1}&#039;`
if [ &quot;$username&quot; = &quot;$login&quot; ]; then                               
  echo &quot;ERROR: The user $login already exists, so please use a different login name.&quot;
  exit 1
else
  echo &quot;using username: $login&quot;
fi
          
if expr &quot;$2&quot; : &#039;-\?[0-9]\+$&#039; &gt;/dev/null ; then
  uid=$2
else
  uid=&quot;$(awk -F: &#039;{ if (big &lt; $3 &amp;&amp; $3 &lt; 5000) big=$3 } END { print big + 1 }&#039; $passwdf)&quot;
  if [ $uid -lt 1000 ] ; then
    uid=1000
  fi
fi

userid=`grep $uid $passwdf|awk -F : &#039;{print $1}&#039;`
if [ &quot;$userid&quot; = &quot;$uid&quot; ]; then
  echo &quot;ERROR: The userid $uid already exists, so please use a different userid.&quot;
  exit 1
else
  echo &quot;using uid/guid: $uid&quot;
fi
                              
homedir=$homerootdir/$login
                              
# gid=uid as in Fedora
gid=$uid

# echo ${login}:x:${uid}:${gid}:${fullname}:${homedir}:$shell &gt;&gt; $passwdf                      
echo ${login}:x:${uid}:${gid}:${login}:${homedir}:$shell &gt;&gt; $passwdf
echo ${login}:*:${uid}:${gid}:${login}:${homedir}:$shell &gt;&gt; $passwdfmin
echo ${login}:*:11647:0:99999:7::: &gt;&gt; $shadowf
echo ${login}:*:11647:0:99999:7::: &gt;&gt; $shadowfmin
echo &quot;${login}:x:${gid}:$login&quot; &gt;&gt; $groupf
                                
if [ ! -d &quot;$homerootdir&quot; ]; then
  mkdir  $homerootdir
fi

if [ ! -d &quot;$homedir&quot; ]; then
  mkdir $homedir
fi
                                    
#cp -R /etc/skel/.[a-zA-Z]* $homedir
chmod 755 $homedir
find $homedir -print | xargs chown ${login}:$login
passwd $login
                                    
exit 0</code></pre></div><p>To set uid/guid you must supply it as second argument to the script..</p><p>usage: adduser &lt;new username&gt; &lt;uid&gt;&nbsp; </p><p>ie ... adduser Frank 500</p><p>if no args are provided then you will be prompt to enter user name and uid/guid will automatically be set start at 1000 and incremented +1 per new user.</p><p>after runing the script you should be able to log on via ssh with the new user/pass combo.</p><p>##UPDATE ##</p><p>there was a error in the script above, {fullname} is no logger a variable as in is the same as {login} so it was redundant and I removed it but for got to replace it in the script. I have made the edit to the script, it should was as desired now</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256894">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">hostle19</div>
					<div class="post-datetime">
						7 Dec 2014, 18:48					</div>
				</div>
				<div class="post-content content">
					<p>working on a full blown multi-user setup for openwrt, stay tuned as i am almost complete <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262372">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">carmine</div>
					<div class="post-datetime">
						22 Jan 2015, 01:03					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s awesome, as I would like for my roommates to be able to check the graphs, logs and firewall stats by themselves without giving them root access (and better yet the possibility to change the configuration at all) <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p280760">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">fred3398</div>
					<div class="post-datetime">
						20 Jun 2015, 02:52					</div>
				</div>
				<div class="post-content content">
					<p>I tried this hack with admin instead of root.</p><p>Add admin with : useradd -M -u 1000 -g 1000 -s /bin/false<br />Create ssh key for root and disable ssh password login<br />Modify files like here =&gt; <a href="https://forum.openwrt.org/viewtopic.php?pid=230053#p230053">https://forum.openwrt.org/viewtopic.php … 53#p230053</a></p><p>It works good. I can access luci inteface with admin user and ssh with root and ssh key.<br />In luci interface, login with root give me a blank page, so I have modified /usr/lib/lua/luci/sys.lua like this :</p><p>function user.checkpasswd(username, pass)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; if username ~= &quot;root&quot; then&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; local pwh, pwe = user.getpasswd(username)&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if pwe then&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return (pwh == nil or nixio.crypt(pass, pwh) == pwh)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; end&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; return false&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />end</p><p>Now, every username in luci other than admin return to luci interface.</p>											<p class="post-edited">(Last edited by <strong>fred3398</strong> on 20 Jun 2015, 02:56)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>