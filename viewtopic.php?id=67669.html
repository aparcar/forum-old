<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Slow LAN Speed between two OpenWRT Router</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p338844">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Paraffine</div>
					<div class="post-datetime">
						21 Sep 2016, 23:16					</div>
				</div>
				<div class="post-content content">
					<p>Hello there<br />As the title says I&#039;m having connection speed issues between two OpenWRT Routers connected with gigabit. I&#039;ve tested them with Iperf3. <br />Both router are TP-Link WR1043NDs, &quot;MainRouter&quot; is a v2, &quot;NetworkExtender&quot; is a v1, both updated to Chaos Calmer&nbsp; 15.05.1, settings are pretty default, only installed iperf and set up a bridge between wan, lan and wifi on Main, shut down firewall and DHCP server functionality on exteder. Main router Wan uses a different subnet and the DHCP server is the modem (another machine without OpenWRT due to my ISP limitations). Both share the same Wireless Name, password and security, but they shouldn&#039;t be bridged (they are both set as Access Point)<br />and here&#039;s the results<br /></p><div class="quotebox"><blockquote><p>root@NetworkExtender:~# iperf3 -s<br />-----------------------------------------------------------<br />Server listening on [A Port]<br />-----------------------------------------------------------<br />Accepted connection from [Main Router IP], port [Another Port]<br />[&nbsp; 5] local [Netowrk Extender IP] port [A Port] connected to [Main Router IP] port [Another Port+1]<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth<br />[&nbsp; 5]&nbsp; &nbsp;0.00-1.00&nbsp; &nbsp;sec&nbsp; 17.3 MBytes&nbsp; &nbsp;145 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;1.00-2.00&nbsp; &nbsp;sec&nbsp; 17.6 MBytes&nbsp; &nbsp;147 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;2.00-3.00&nbsp; &nbsp;sec&nbsp; 17.5 MBytes&nbsp; &nbsp;147 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;3.00-4.00&nbsp; &nbsp;sec&nbsp; 18.2 MBytes&nbsp; &nbsp;152 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;4.00-5.00&nbsp; &nbsp;sec&nbsp; 18.4 MBytes&nbsp; &nbsp;155 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;5.00-6.00&nbsp; &nbsp;sec&nbsp; 18.9 MBytes&nbsp; &nbsp;158 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;6.00-7.00&nbsp; &nbsp;sec&nbsp; 18.6 MBytes&nbsp; &nbsp;156 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;7.00-8.00&nbsp; &nbsp;sec&nbsp; 18.9 MBytes&nbsp; &nbsp;158 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;8.00-9.00&nbsp; &nbsp;sec&nbsp; 18.7 MBytes&nbsp; &nbsp;157 Mbits/sec<br />[&nbsp; 5]&nbsp; &nbsp;9.00-10.00&nbsp; sec&nbsp; 18.9 MBytes&nbsp; &nbsp;158 Mbits/sec<br />- - - - - - - - - - - - - - - - - - - - - - - - -<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth&nbsp; &nbsp; &nbsp; &nbsp;Retr<br />[&nbsp; 5]&nbsp; &nbsp;0.00-10.00&nbsp; sec&nbsp; &nbsp;183 MBytes&nbsp; &nbsp;153 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sender<br />[&nbsp; 5]&nbsp; &nbsp;0.00-10.00&nbsp; sec&nbsp; &nbsp;183 MBytes&nbsp; &nbsp;153 Mbits/sec&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; receiver</p></blockquote></div><br /><div class="quotebox"><blockquote><p>root@MainRouter:~#&nbsp; iperf3 -c [Network Extender IP]<br />Connecting to host [Netowrk Extender IP], port [A Port]<br />[&nbsp; 4] local [Main Router IP] port [Another Port+1] connected to [Netowrk Extender IP] port [A Port]<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth&nbsp; &nbsp; &nbsp; &nbsp;Retr&nbsp; Cwnd<br />[&nbsp; 4]&nbsp; &nbsp;0.00-1.00&nbsp; &nbsp;sec&nbsp; 17.3 MBytes&nbsp; &nbsp;145 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;24.0 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;1.00-2.00&nbsp; &nbsp;sec&nbsp; 17.6 MBytes&nbsp; &nbsp;147 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;24.0 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;2.00-3.00&nbsp; &nbsp;sec&nbsp; 17.5 MBytes&nbsp; &nbsp;147 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;28.3 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;3.00-4.00&nbsp; &nbsp;sec&nbsp; 18.2 MBytes&nbsp; &nbsp;152 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;29.7 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;4.00-5.00&nbsp; &nbsp;sec&nbsp; 18.4 MBytes&nbsp; &nbsp;155 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;31.1 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;5.00-6.00&nbsp; &nbsp;sec&nbsp; 18.8 MBytes&nbsp; &nbsp;158 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;31.1 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;6.00-7.00&nbsp; &nbsp;sec&nbsp; 18.6 MBytes&nbsp; &nbsp;156 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;31.1 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;7.00-8.00&nbsp; &nbsp;sec&nbsp; 18.9 MBytes&nbsp; &nbsp;158 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;31.1 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;8.00-9.00&nbsp; &nbsp;sec&nbsp; 18.7 MBytes&nbsp; &nbsp;157 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;31.1 KBytes<br />[&nbsp; 4]&nbsp; &nbsp;9.00-10.00&nbsp; sec&nbsp; 18.9 MBytes&nbsp; &nbsp;158 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp;32.5 KBytes<br />- - - - - - - - - - - - - - - - - - - - - - - - -<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth&nbsp; &nbsp; &nbsp; &nbsp;Retr<br />[&nbsp; 4]&nbsp; &nbsp;0.00-10.00&nbsp; sec&nbsp; &nbsp;183 MBytes&nbsp; &nbsp;153 Mbits/sec&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sender<br />[&nbsp; 4]&nbsp; &nbsp;0.00-10.00&nbsp; sec&nbsp; &nbsp;183 MBytes&nbsp; &nbsp;153 Mbits/sec&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; receiver</p><p>iperf Done.</p></blockquote></div><p>How can I ensure that the packets are taveling via gigabit interface?</p><p>how can I improve the performance so they are in par with the gigabit speed? (or at least come a little bit closer, a tenth seems really too low)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338853">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">azapfig</div>
					<div class="post-datetime">
						22 Sep 2016, 01:00					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;re measuring your router&#039;s CPU so the numbers are ok as they isn&#039;t fast enough to deliver gigabit rates. Just connect two fast machines with ethernet and do the test again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338860">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						22 Sep 2016, 01:51					</div>
				</div>
				<div class="post-content content">
					<p>I use (on Windows) LanSpeedTest 1.3.1.<br /><a href="http://totusoft.com/downloads/">http://totusoft.com/downloads/</a></p><p>It will send a file of size you determine across to another PC and then read it back.&nbsp; Can&#039;t get more real than that.</p><p>Just runs, no installer</p>											<p class="post-edited">(Last edited by <strong>RangerZ</strong> on 22 Sep 2016, 01:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338862">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Paraffine</div>
					<div class="post-datetime">
						22 Sep 2016, 02:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>I use (on Windows) LanSpeedTest 1.3.1.</p><p>It will send a file of size you determine across to another PC and then read it back.&nbsp; Can&#039;t get more real than that.</p><p>Just runs, no installer</p></blockquote></div><p>I guess that if CPU usage is the problem that would only confirm the problem, because that router is the one that connects my computer, the nas and staff to the rest of the network</p><div class="quotebox"><cite>azapfig wrote:</cite><blockquote><p>You&#039;re measuring your router&#039;s CPU so the numbers are ok as they isn&#039;t fast enough to deliver gigabit rates. Just connect two fast machines with ethernet and do the test again.</p></blockquote></div><p>Is there a way to reduce CPU usage, the router (v1) behaves like a kind of dumb switch, is there any way to reduce CPU usage accordingly? All the advanced and routing/dhcp/stuff features I guess could/should be managed from the main router (v2). The only other thing v1 should be is grant wifi connection like an AP</p>											<p class="post-edited">(Last edited by <strong>Paraffine</strong> on 22 Sep 2016, 02:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338905">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						22 Sep 2016, 14:56					</div>
				</div>
				<div class="post-content content">
					<p>Do not worry, cpu is only not fast enough to run iperf ;-) If you are not doing nat between them, packets are not going over the cpu. And yes, you can configure your router as dumb switch, which bridges all interfaces, so it won&#039;t go over cpu even when connected to the wan interface. Google for the dumb ap recipe.</p>											<p class="post-edited">(Last edited by <strong>nozombian</strong> on 22 Sep 2016, 14:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338920">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Paraffine</div>
					<div class="post-datetime">
						22 Sep 2016, 19:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Paraffine wrote:</cite><blockquote><div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>I use (on Windows) LanSpeedTest 1.3.1.</p><p>It will send a file of size you determine across to another PC and then read it back.&nbsp; Can&#039;t get more real than that.</p><p>Just runs, no installer</p></blockquote></div><p>I guess that if CPU usage is the problem that would only confirm the problem, because that router is the one that connects my computer, the nas and staff to the rest of the network</p><div class="quotebox"><cite>azapfig wrote:</cite><blockquote><p>You&#039;re measuring your router&#039;s CPU so the numbers are ok as they isn&#039;t fast enough to deliver gigabit rates. Just connect two fast machines with ethernet and do the test again.</p></blockquote></div><p>Is there a way to reduce CPU usage, the router (v1) behaves like a kind of dumb switch, is there any way to reduce CPU usage accordingly? All the advanced and routing/dhcp/stuff features I guess could/should be managed from the main router (v2). The only other thing v1 should be is grant wifi connection like an AP</p></blockquote></div><p>Does that mean that the bottleneck in my network file transfer resides elsewhere? How can I test the connection between those two routers without the CPU bias?</p>											<p class="post-edited">(Last edited by <strong>Paraffine</strong> on 22 Sep 2016, 19:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338923">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						22 Sep 2016, 20:28					</div>
				</div>
				<div class="post-content content">
					<p>What you have been told is that running iperf on the router is using the routers CPU and that impacts your results.&nbsp; test running iperf or lanspeed test on the end points and unload the CPU</p><p>If you have any NICs in your PCs or switches that are not GB that could be an issue.&nbsp; </p><p>My router is 100Mbps, but all my switches and cables are GB and cat6.&nbsp; I get speeds of 650Mbps or better routinely.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339069">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Paraffine</div>
					<div class="post-datetime">
						24 Sep 2016, 14:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>What you have been told is that running iperf on the router is using the routers CPU and that impacts your results.&nbsp; test running iperf or lanspeed test on the end points and unload the CPU</p><p>If you have any NICs in your PCs or switches that are not GB that could be an issue.&nbsp; </p><p>My router is 100Mbps, but all my switches and cables are GB and cat6.&nbsp; I get speeds of 650Mbps or better routinely.</p></blockquote></div><p>I&#039;ve no FE NICs in my PCs nor switches, the only FE port I have is the WAN port of the router.</p><p>There&#039;s a way to make iperf show results for &quot;nodes&quot; between endpoints? Otherwise it would defeat the point of debugging &quot;nodes&quot; separately to know where the bottleneck is (I don&#039;t know if nodes is the correct term, I hope you got what i meant with it)</p>											<p class="post-edited">(Last edited by <strong>Paraffine</strong> on 24 Sep 2016, 14:26)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>