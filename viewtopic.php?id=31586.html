<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Modifying the uboot environemt from OpenWrt</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p142297">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						27 Aug 2011, 15:36					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/doc/techref/bootloader/uboot.config#modifying.variables.from.openwrt">http://wiki.openwrt.org/doc/techref/boo … om.openwrt</a></p><p>Can somebody help to finish this?</p><p>I don&#039;t know how to configure&nbsp; uboot-envtools.<br />/etc/fw_env.config</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142352">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						28 Aug 2011, 06:56					</div>
				</div>
				<div class="post-content content">
					<p>Neither do I.</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=28454">OpenWrt / uboot fw_env.config ???</a><br /><a href="http://wiki.openwrt.org/doc/techref/bootloader/uboot.config">U-Boot Environment - OpenWrt Wiki</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142612">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						31 Aug 2011, 16:31					</div>
				</div>
				<div class="post-content content">
					<p>I think this could be due to the OLD version of U-Boot TP-Link is using.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142649">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hutchman</div>
					<div class="post-datetime">
						31 Aug 2011, 22:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Orca wrote:</cite><blockquote><p><a href="http://wiki.openwrt.org/doc/techref/bootloader/uboot.config#modifying.variables.from.openwrt">http://wiki.openwrt.org/doc/techref/boo … om.openwrt</a></p><p>Can somebody help to finish this?</p><p>I don&#039;t know how to configure&nbsp; uboot-envtools.<br />/etc/fw_env.config</p></blockquote></div><p>I think you need to read the wiki ... sorry, I couldn&#039;t resist <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />&nbsp; This fine page from Wolfgang <a href="http://www.denx.de/wiki/view/DULG/HowCanIAccessUBootEnvironmentVariablesInLinux">http://www.denx.de/wiki/view/DULG/HowCa … lesInLinux</a></p><p>You only need to mess with fw_env.config if you are trying to mess with u-boot environment variables from Linux.</p><p>Do you have a need to do this vs using the serial console?</p><p>Regards,</p><p>Brian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142655">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						31 Aug 2011, 22:21					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t have a serial console. If only.</p><p>Also, I do not require this. It&#039;s simply something I wanted to have.</p><p>I always wanted to open my Router, and solder a serial header to the PCB and do stuff, but I never had to, because OpenWrt simply fucking works for me.<br />I am so bored. I envy the people who have trouble and have to solder stuff and so on.</p><p>The same happend to me with Windows XP. I installed it once &quot;myway&quot; and since then it simply works. Boring. The people with the Virus-Scanners and the Flashplugin have all the fun, install their stuff every three month and me? So unfair.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142656">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hutchman</div>
					<div class="post-datetime">
						31 Aug 2011, 22:32					</div>
				</div>
				<div class="post-content content">
					<p>If you don&#039;t have a serial console then I would advise that you don&#039;t mess with trying to change u-boot env. vars from Linux or you will step on yourself.</p><p>Besides, to set the fw_env up you need to know how big and where the u-boot env. section is.&nbsp; If you have the u-boot source it is easy to determine and you simply fill out fw_env with the offsets required to mimic what u-boot is doing.&nbsp; All this is doing is creating an overlay of the MTD env partition.&nbsp; </p><p>The difference between changing env. in u-boot vs linux (unless something has changed recently) is with u-boot you can change a bunch of variables at a time and then do saveenv and only one write to flash happens.&nbsp; When you do it from Linux, if you change one thing, the entire environment variable section is re-written to flash.</p><p>Regards,</p><p>Brian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142657">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hutchman</div>
					<div class="post-datetime">
						31 Aug 2011, 22:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Orca wrote:</cite><blockquote><p>...</p><p>Also, I do not require this. It&#039;s simply something I wanted to have.</p></blockquote></div><p>If you want to learn u-boot, I suggest you get something more friendly like a BeagleBoard.&nbsp; Set it up to boot from SDCard and when you hose it up you just put it in your PC and fix it.</p><p>Regards,</p><p>Brian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142659">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						31 Aug 2011, 22:46					</div>
				</div>
				<div class="post-content content">
					<p>Did you find out where U-Boot stores the environment variables?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142660">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						31 Aug 2011, 22:52					</div>
				</div>
				<div class="post-content content">
					<p>No, I checked the sources from TP-link but found nothing. Then I stumbled upon something, and it occured to me, the tp-link uboot fork is very old. And back then, they did this different then described in the article, because I based my description on current code. And then I tried different values and it didn&#039;t help.</p><p><a href="http://wiki.openwrt.org/doc/techref/bootloader/uboot.config#determine.config_env_offset.and.config_env_size">http://wiki.openwrt.org/doc/techref/boo … g_env_size</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142661">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">hutchman</div>
					<div class="post-datetime">
						31 Aug 2011, 23:01					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve used the fw_printenv method since back in 1.1.6 (2005 or 2006 vintage if I can remember right) with a 2.6.18 kernel.&nbsp; I haven&#039;t tried it with any of my new board that are running U-Boot 2010.06 but I probably will in the next few weeks when I get the &quot;boot count&quot; feature going on our board.</p><p>Regards,</p><p>Brian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142663">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hutchman</div>
					<div class="post-datetime">
						31 Aug 2011, 23:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Orca wrote:</cite><blockquote><p>No, I checked the sources from TP-link but found nothing. Then I stumbled upon something, and it occured to me, the tp-link uboot fork is very old. And back then, they did this different then described in the article, because I based my description on current code. And then I tried different values and it didn&#039;t help.</p><p><a href="http://wiki.openwrt.org/doc/techref/bootloader/uboot.config#determine.config_env_offset.and.config_env_size">http://wiki.openwrt.org/doc/techref/boo … g_env_size</a></p></blockquote></div><p>Can you not reverse engineer it?&nbsp; U-boot typically has been around 160-170KB so it is usually in the first one or two flash sectors and the env. is usually the very next sector after u-boot.</p><p>Can you open up the unit and find the flash and get the part number off of it.&nbsp; Then look up the datasheet to see how big a flash it is and what the sector sizes are.&nbsp; You could probably figure it out that way unless they are trying to do security through obscurity.</p><p>Can you do cat /proc/mtd?</p><p>Can you do a dmesg and see any bootargs?&nbsp; Knowing the MTD of the rootfs could be a clue.&nbsp; The kernel usually has a MTD map that also knows where u-boot and the u-boot env is.&nbsp; In new kernels this map is in the &quot;board&quot; file but in older versions it was hard coded somewhere under drivers/mtd.</p><p>Regards,</p><p>Brian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142672">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						1 Sep 2011, 04:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Orca wrote:</cite><blockquote><p>No, I checked the sources from TP-link but found nothing.</p></blockquote></div><p>Can you copy and compare /dev/mtd0 before and after modifying any environment variable from serial console?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142702">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						1 Sep 2011, 15:11					</div>
				</div>
				<div class="post-content content">
					<p>This is my device: <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr1043nd">http://wiki.openwrt.org/toh/tp-link/tl-wr1043nd</a>&nbsp; I could do a <a href="http://wiki.openwrt.org/doc/howto/generic.backup">http://wiki.openwrt.org/doc/howto/generic.backup</a> and look with a hex-editor in the dump.</p><p>But this is not very elegant, is it?</p><p>I encountered bootloaders you can connect to via telnet or ftp and do pretty much everything without the need of a serial cable! Then there is the uboot of the dockstar, which&#039;s ENV could easily be changed from Linux (I use Debian on it). Maybe I should just accept, that this is not possible with the uboot implementation of the WR1043ND.</p><p>I got everything running, I really do not require this, I was just curious.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142704">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">hutchman</div>
					<div class="post-datetime">
						1 Sep 2011, 15:30					</div>
				</div>
				<div class="post-content content">
					<p>You can do u-boot console over network too.&nbsp; Support for it has to be turned on and the PC has some setup but it is possible to do it although you don&#039;t see it very often.</p><p>Comes in handy when you have a unit in a place that isn&#039;t exactly easy to get to (on a tower).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142707">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						1 Sep 2011, 15:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hutchman wrote:</cite><blockquote><p>You can do u-boot console over network too.&nbsp; Support for it has to be turned on and the PC has some setup but it is possible to do it although you don&#039;t see it very often.</p><p>Comes in handy when you have a unit in a place that isn&#039;t exactly easy to get to (on a tower).</p></blockquote></div><p>Exactly, and thus I would have expected that! But found only descriptions for procedures over UART :-(</p><p>&quot;Wouldn&#039;t it be nice to have this information in the wiki?&quot;</p><br /><p><a href="http://docs.blackfin.uclinux.org/doku.php?id=bootloaders:u-boot:netconsole">http://docs.blackfin.uclinux.org/doku.p … netconsole</a><br /><a href="http://forum.doozan.com/read.php?3,14,14">http://forum.doozan.com/read.php?3,14,14</a><br /><a href="http://buffalo.nas-central.org/index.php/U-boot_bootloader#Install_nc">http://buffalo.nas-central.org/index.ph … Install_nc</a></p>											<p class="post-edited">(Last edited by <strong>Orca</strong> on 1 Sep 2011, 15:58)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>