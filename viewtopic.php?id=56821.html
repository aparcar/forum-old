<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to make my network adapter BCM57780 useable</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p272405">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">charles417</div>
					<div class="post-datetime">
						14 Apr 2015, 05:04					</div>
				</div>
				<div class="post-content content">
					<p>I downloaded OpenWrt BarrierBreaker 14.07 x86 named openwrt-x86-generic-combined-ext4.img.gz in <a href="http://downloads.openwrt.org/barrier_breaker/14.07/,">http://downloads.openwrt.org/barrier_breaker/14.07/,</a> and installed it into my pc, but the network is not available. my network adapter is bcm57780. I found a driver in openwrt called &quot;tg3&quot; but it was not in using, and I replaced a &quot;tg3&quot; driver downloaded from broadcom to openwrt system, it did not work.<br />how to use this network adapter? this pc have none PCI or PCI-E slot, and I don&#039;t want to use a usb adapter.</p>											<p class="post-edited">(Last edited by <strong>charles417</strong> on 29 Apr 2015, 04:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273445">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">stevie7303215</div>
					<div class="post-datetime">
						22 Apr 2015, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>hi Charles, I am doing the same thing and not much luck either.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273813">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">stevie7303215</div>
					<div class="post-datetime">
						24 Apr 2015, 21:24					</div>
				</div>
				<div class="post-content content">
					<p>I finally got it working, its not fully supported by openwrt as of yet.&nbsp; The tg3 driver actually covers quite a few different devices. If you go to their website you will see card specific drivers so having a generic name is quite silly thanks broadcom!! and confuses the linux comunity. So depending which driver has been officially compiled is the one that will be offered to everyone. The catch with the TG3 driver for the openwrt community and other smaller devices is the driver from broadcom has actually to be cross compiled on the device. and the make file then creates a custom image for your device.&nbsp; I have managed to crosscompile the driver but as it wasnt from my router, so fails to load on boot up. With a few small mods in the bootup sequence it loads up and runs quite fast.</p><p>[&nbsp; &nbsp; 2.595952] tg3.c:v3.132 (May 21, 2013)<br />[&nbsp; &nbsp; 2.601053] libphy: tg3 mdio bus: probed<br />[&nbsp; &nbsp; 2.604804] tg3 0000:05:00.0: No PHY devices<br />[&nbsp; &nbsp; 2.608668] tg3 0000:05:00.0: Problem fetching invariants of chip, aborting</p><p>Then during the bootup period it switches to my driver</p><p>pcieport 0000:00:1c.5: eth2: Tigon3 [partno(BCM57780) rev 778000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1] (PCI Express) MAC address 3c:4axxxxx<br />pcieport 0000:00:1c.5: eth2: attached PHY is 57780 (10/100/1000Base-T Ethernet) (WireSpeed[1], EEE[0])&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />pcieport 0000:00:1c.5: eth2: RXcsums[1] LinkChgREG[0] MIirq[0] AS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; F[0] TSOcap[1]<br />pcieport 0000:00:1c.5: eth2: dma_rwctrl[76180000] dma_mask[64-bit </p><br /><p>lspci</p><p>05:00.0 Ethernet controller [0200]: Broadcom Corporation NetLink BCM57780 Gigabit Ethernet PCIe [14e4:1692] (rev 01)<br />&nbsp; &nbsp; &nbsp; &nbsp; Subsystem: Broadcom Corporation Device [14e4:9692]<br />&nbsp; &nbsp; &nbsp; &nbsp; Flags: bus master, fast devsel, latency 0, IRQ 17<br />&nbsp; &nbsp; &nbsp; &nbsp; Memory at febf0000 (64-bit, non-prefetchable) [size=64K]<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [48] Power Management version 3<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [60] Vendor Specific Information: Len=6c &lt;?&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [50] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [cc] Express Endpoint, MSI 00<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [100] Advanced Error Reporting<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [13c] Virtual Channel<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [160] Device Serial Number 3c-4a-92-ff-fe-d3-f7-d0<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [16c] Power Budgeting &lt;?&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; Kernel driver in use: tg3</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273877">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						25 Apr 2015, 09:59					</div>
				</div>
				<div class="post-content content">
					<p>You encountered a missing module/hardware support in OpenWrt.</p><p>add the following to package/kernel/linux/modules/netdevices.mk<br /></p><div class="codebox"><pre><code>define KernelPackage/phy-broadcom
  SUBMENU:=$(NETWORK_DEVICES_MENU)
  TITLE:=Broadcom PHY support
  KCONFIG:=CONFIG_BROADCOM_PHY
  DEPENDS:=+kmod-libphy
  FILES:=$(LINUX_DIR)/drivers/net/phy/broadcom.ko
  AUTOLOAD:=$(call AutoLoad,15,broadcom)
endef

define KernelPackage/phy-broadcom/description
  Currently supports the BCM5411, BCM5421, BCM5461, BCM5464, BCM5481,
  BCM5482 and BCM57780 PHYs.
endef

$(eval $(call KernelPackage,phy-broadcom))</code></pre></div><p>You should see a new entry in kernel modules network device section.</p><p>it should build a module (broadcom.ko) that should be loaded before tg3 so your card will work with tg3 then. Found via <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1039231">redhat bugzilla</a></p><p>If it works it can be submitted to OpenWrt and included in later releases.</p>											<p class="post-edited">(Last edited by <strong>zloop</strong> on 25 Apr 2015, 10:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274028">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">stevie7303215</div>
					<div class="post-datetime">
						26 Apr 2015, 20:26					</div>
				</div>
				<div class="post-content content">
					<p>thanks zloop I will try on my next build. I did see the broadcom issue on the forums, I assumed that it was for wifi modules where people had laptops, I have a thin pci I thought it didnt apply.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274037">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">stevie7303215</div>
					<div class="post-datetime">
						26 Apr 2015, 21:55					</div>
				</div>
				<div class="post-content content">
					<p>still no go, it does load up the driver from openwrt but doesnt find my card. So i changed the tg3 and loaded my custom one and wouldnt boot up with it. saying errors in hwmon. The issue still lies in the binary from openwrt, there are a few missing .c and .h files which i noticed after I compiled using buildroot. My card should be detected as a pcie not as the router chipset types. The package from broadcom&nbsp; specifies the installation has to be from a working machine as during the install it detects this and installs&nbsp; to suit ur architecture. So during a cross compile using the openwrt kernal it detects no working hwmon and ptp. and this is the issue I have when I bootup my machine having hwmon errors. I have put in a request for a pcie version with openwrt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274426">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">charles417</div>
					<div class="post-datetime">
						29 Apr 2015, 13:29					</div>
				</div>
				<div class="post-content content">
					<p>I tried this, but it didn&#039;t work.<br /></p><div class="quotebox"><cite>zloop wrote:</cite><blockquote><p>You encountered a missing module/hardware support in OpenWrt.</p><p>add the following to package/kernel/linux/modules/netdevices.mk<br /></p><div class="codebox"><pre><code>define KernelPackage/phy-broadcom
  SUBMENU:=$(NETWORK_DEVICES_MENU)
  TITLE:=Broadcom PHY support
  KCONFIG:=CONFIG_BROADCOM_PHY
  DEPENDS:=+kmod-libphy
  FILES:=$(LINUX_DIR)/drivers/net/phy/broadcom.ko
  AUTOLOAD:=$(call AutoLoad,15,broadcom)
endef

define KernelPackage/phy-broadcom/description
  Currently supports the BCM5411, BCM5421, BCM5461, BCM5464, BCM5481,
  BCM5482 and BCM57780 PHYs.
endef

$(eval $(call KernelPackage,phy-broadcom))</code></pre></div><p>You should see a new entry in kernel modules network device section.</p><p>it should build a module (broadcom.ko) that should be loaded before tg3 so your card will work with tg3 then. Found via <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1039231">redhat bugzilla</a></p><p>If it works it can be submitted to OpenWrt and included in later releases.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274427">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">charles417</div>
					<div class="post-datetime">
						29 Apr 2015, 13:34					</div>
				</div>
				<div class="post-content content">
					<p>I tried it today, and it doesn&#039;t work. I have only an usb keyboard, but it can&#039;t use in openwrt, so I can&#039;t login to system with keyboard. I just can&#039;t open a web interface or ssh.<br /></p><div class="quotebox"><cite>stevie7303215 wrote:</cite><blockquote><p>still no go, it does load up the driver from openwrt but doesnt find my card. So i changed the tg3 and loaded my custom one and wouldnt boot up with it. saying errors in hwmon. The issue still lies in the binary from openwrt, there are a few missing .c and .h files which i noticed after I compiled using buildroot. My card should be detected as a pcie not as the router chipset types. The package from broadcom&nbsp; specifies the installation has to be from a working machine as during the install it detects this and installs&nbsp; to suit ur architecture. So during a cross compile using the openwrt kernal it detects no working hwmon and ptp. and this is the issue I have when I bootup my machine having hwmon errors. I have put in a request for a pcie version with openwrt</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274431">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">charles417</div>
					<div class="post-datetime">
						29 Apr 2015, 14:35					</div>
				</div>
				<div class="post-content content">
					<p>I recorded boot screen, it said &quot;tg3 0000:02:00.0: no PHY devices&quot; </p><div class="quotebox"><cite>zloop wrote:</cite><blockquote><p>You encountered a missing module/hardware support in OpenWrt.</p><p>add the following to package/kernel/linux/modules/netdevices.mk<br /></p><div class="codebox"><pre><code>define KernelPackage/phy-broadcom
  SUBMENU:=$(NETWORK_DEVICES_MENU)
  TITLE:=Broadcom PHY support
  KCONFIG:=CONFIG_BROADCOM_PHY
  DEPENDS:=+kmod-libphy
  FILES:=$(LINUX_DIR)/drivers/net/phy/broadcom.ko
  AUTOLOAD:=$(call AutoLoad,15,broadcom)
endef

define KernelPackage/phy-broadcom/description
  Currently supports the BCM5411, BCM5421, BCM5461, BCM5464, BCM5481,
  BCM5482 and BCM57780 PHYs.
endef

$(eval $(call KernelPackage,phy-broadcom))</code></pre></div><p>You should see a new entry in kernel modules network device section.</p><p>it should build a module (broadcom.ko) that should be loaded before tg3 so your card will work with tg3 then. Found via <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1039231">redhat bugzilla</a></p><p>If it works it can be submitted to OpenWrt and included in later releases.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278164">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">stevie7303215</div>
					<div class="post-datetime">
						30 May 2015, 13:58					</div>
				</div>
				<div class="post-content content">
					<p>thanks for the help, still doesnt work.<br />The buildroot is still missing the compat files that come with original driver</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278429">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">stevie7303215</div>
					<div class="post-datetime">
						1 Jun 2015, 14:27					</div>
				</div>
				<div class="post-content content">
					<p>zloop you are the man!!<br />finally working, the below script just didnt add a symlink from modules.boot.d to modules.d with the broadcom phy.</p><p>it now boots up and works perfectly.</p><p>-------------------------------------------------<br />[&nbsp; &nbsp; 1.913649] tg3.c:v3.137 (May 11, 2014)<br />[&nbsp; &nbsp; 1.919219] libphy: tg3 mdio bus: probed<br />[&nbsp; &nbsp; 2.023319] tg3 0000:05:00.0 eth0: Tigon3 [partno(BCM57780) rev 57780001] (PCI Express) MAC address 3c:4a:92:d3:f7:d0<br />[&nbsp; &nbsp; 2.027626] tg3 0000:05:00.0 eth0: attached PHY driver [Broadcom BCM57780] (mii_bus:phy_addr=500:01)<br />[&nbsp; &nbsp; 2.031986] tg3 0000:05:00.0 eth0: RXcsums[1] LinkChgREG[0] MIirq[0] ASF[0] TSOcap[1]<br />[&nbsp; &nbsp; 2.036313] tg3 0000:05:00.0 eth0: dma_rwctrl[76180000] dma_mask[64-bit]<br />------------------------------------------------</p><br /><br /><div class="quotebox"><cite>zloop wrote:</cite><blockquote><p>You encountered a missing module/hardware support in OpenWrt.</p><p>add the following to package/kernel/linux/modules/netdevices.mk<br /></p><div class="codebox"><pre><code>define KernelPackage/phy-broadcom
  SUBMENU:=$(NETWORK_DEVICES_MENU)
  TITLE:=Broadcom PHY support
  KCONFIG:=CONFIG_BROADCOM_PHY
  DEPENDS:=+kmod-libphy
  FILES:=$(LINUX_DIR)/drivers/net/phy/broadcom.ko
  AUTOLOAD:=$(call AutoLoad,15,broadcom)
endef

define KernelPackage/phy-broadcom/description
  Currently supports the BCM5411, BCM5421, BCM5461, BCM5464, BCM5481,
  BCM5482 and BCM57780 PHYs.
endef

$(eval $(call KernelPackage,phy-broadcom))</code></pre></div><p>You should see a new entry in kernel modules network device section.</p><p>it should build a module (broadcom.ko) that should be loaded before tg3 so your card will work with tg3 then. Found via <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1039231">redhat bugzilla</a></p><p>If it works it can be submitted to OpenWrt and included in later releases.</p></blockquote></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>