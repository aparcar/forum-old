<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> U-Boot mod for routers with AR9331/AR9344</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 3 Apr 2015 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 9 of 25</div><nav><ul><li><a href="viewtopic.php%3Fid=43237&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=25.html">25</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p218920">
				<div class="post-metadata">
					<div class="post-num">Post #201</div>
					<div class="post-author">netcas</div>
					<div class="post-datetime">
						1 Dec 2013, 04:35					</div>
				</div>
				<div class="post-content content">
					<p>Excellent and brilliant work!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219057">
				<div class="post-metadata">
					<div class="post-num">Post #202</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						3 Dec 2013, 00:49					</div>
				</div>
				<div class="post-content content">
					<p>Just a small sneak peak from upcoming, new version:</p><div class="codebox"><pre><code>*********************************************
*        U-Boot 1.1.4  (Dec  1 2013)        *
*********************************************

AP121 (AR9331) U-Boot for TL-MR3020

DRAM:   64 MB DDR 16-bit
FLASH:  Winbond W25Q128 (16 MB)
CLOCKS: 400/400/200/33 MHz (CPU/RAM/AHB/SPI)

LED on during eth initialization...

Hit any key to stop autobooting:  0

uboot&gt; printclocks
Current clocks (approximated):
- CPU: 400 MHz
- RAM: 400 MHz
- AHB: 200 MHz
- SPI:  33 MHz

Clocks configuration stored in FLASH (approximated):
- CPU: 200 MHz
- RAM: 200 MHz
- AHB: 200 MHz
- SPI:  33 MHz

Reference clock: 25 MHz
uboot&gt; help setclocks
setclocks range refdiv divint outdiv cpu_div ram_div ahb_div spi_div
        - calculates and stores CPU_PLL_CONFIG and CLOCK_CONTROL registers in FLASH
        - default configuration for 400/400/200/33 MHz:
          0 1 32 1 1 1 2 3 (25 MHz ref, PLL -&gt; ((25 / 1) * 32) / (1 / 2 ^ 1) = 400 MHz)
          0 1 20 1 1 1 2 3 (40 MHz ref, PLL -&gt; ((40 / 1) * 20) / (1 / 2 ^ 1) = 400 MHz)

        - formulas for PLL and clocks calculations:
          PLL = ((ref / refdiv) * divint) / (1 / (2 ^ outdiv))
          CPU = PLL / cpu_div
          RAM = PLL / ram_div
          AHB = PLL / ahb_div
          SPI = AHB / (2 * spi_div)

          *ref - reference clock (25 or 40 MHz)</code></pre></div><p>New functionalities:<br />- O/C recovery mode (press and hold reset button during power up == boot with default clocks)<br />- configuration for CPU/RAM/AHB and SPI clocks can be stored in FLASH and changed in U-Boot console<br />- more commands for compressed U-Boot images<br />- solved: OFW kernel loading bug<br />- solved: setmac command<br />- AR9341 support<br />- etc.</p><p><img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219360">
				<div class="post-metadata">
					<div class="post-num">Post #203</div>
					<div class="post-author">zhouchangsoul</div>
					<div class="post-datetime">
						7 Dec 2013, 13:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi，pepe2k<br />Can I ask you some questions?Why when I make uboot will appear some mistake.<br />This error is：<br /> Makefile:203: warning: overriding commands for target `board/ar7240/ap121/libap121.a&#039;<br />Makefile:174: warning: ignoring old commands for target `board/ar7240/ap121/libap121.a&#039;<br />Makefile:203: warning: overriding commands for target `cpu/mips/libmips.a&#039;<br />Makefile:174: warning: ignoring old commands for target `cpu/mips/libmips.a&#039;<br />Makefile:203: warning: overriding commands for target `cpu/mips/ar7240/libar7240.a&#039;<br />Makefile:174: warning: ignoring old commands for target `cpu/mips/ar7240/libar7240.a&#039;<br />Is that where there is a problem?Can you tell me what reason be? Thank you！</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219362">
				<div class="post-metadata">
					<div class="post-num">Post #204</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						7 Dec 2013, 14:36					</div>
				</div>
				<div class="post-content content">
					<p>These are not errors, just warnings from Makefile.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219363">
				<div class="post-metadata">
					<div class="post-num">Post #205</div>
					<div class="post-author">zhouchangsoul</div>
					<div class="post-datetime">
						7 Dec 2013, 15:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>These are not errors, just warnings from Makefile.</p></blockquote></div><p>Thank you!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219366">
				<div class="post-metadata">
					<div class="post-num">Post #206</div>
					<div class="post-author">zhouchangsoul</div>
					<div class="post-datetime">
						7 Dec 2013, 15:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Just a small sneak peak from upcoming, new version:</p><div class="codebox"><pre><code>*********************************************
*        U-Boot 1.1.4  (Dec  1 2013)        *
*********************************************

AP121 (AR9331) U-Boot for TL-MR3020

DRAM:   64 MB DDR 16-bit
FLASH:  Winbond W25Q128 (16 MB)
CLOCKS: 400/400/200/33 MHz (CPU/RAM/AHB/SPI)

LED on during eth initialization...

Hit any key to stop autobooting:  0

uboot&gt; printclocks
Current clocks (approximated):
- CPU: 400 MHz
- RAM: 400 MHz
- AHB: 200 MHz
- SPI:  33 MHz

Clocks configuration stored in FLASH (approximated):
- CPU: 200 MHz
- RAM: 200 MHz
- AHB: 200 MHz
- SPI:  33 MHz

Reference clock: 25 MHz
uboot&gt; help setclocks
setclocks range refdiv divint outdiv cpu_div ram_div ahb_div spi_div
        - calculates and stores CPU_PLL_CONFIG and CLOCK_CONTROL registers in FLASH
        - default configuration for 400/400/200/33 MHz:
          0 1 32 1 1 1 2 3 (25 MHz ref, PLL -&gt; ((25 / 1) * 32) / (1 / 2 ^ 1) = 400 MHz)
          0 1 20 1 1 1 2 3 (40 MHz ref, PLL -&gt; ((40 / 1) * 20) / (1 / 2 ^ 1) = 400 MHz)

        - formulas for PLL and clocks calculations:
          PLL = ((ref / refdiv) * divint) / (1 / (2 ^ outdiv))
          CPU = PLL / cpu_div
          RAM = PLL / ram_div
          AHB = PLL / ahb_div
          SPI = AHB / (2 * spi_div)

          *ref - reference clock (25 or 40 MHz)</code></pre></div><p>New functionalities:<br />- O/C recovery mode (press and hold reset button during power up == boot with default clocks)<br />- configuration for CPU/RAM/AHB and SPI clocks can be stored in FLASH and changed in U-Boot console<br />- more commands for compressed U-Boot images<br />- solved: OFW kernel loading bug<br />- solved: setmac command<br />- AR9341 support<br />- etc.</p><p><img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Can you give me the uboot image download link?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219705">
				<div class="post-metadata">
					<div class="post-num">Post #207</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						11 Dec 2013, 12:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zhouchangsoul wrote:</cite><blockquote><p>Can you give me the uboot image download link?</p></blockquote></div><p>I haven&#039;t yet made new release with these changes. You can download sources and compile the code.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219762">
				<div class="post-metadata">
					<div class="post-num">Post #208</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						12 Dec 2013, 01:48					</div>
				</div>
				<div class="post-content content">
					<p>Is AR9341 supported?<br />I checked the makefile and it doesn&#039;t seem to be there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219776">
				<div class="post-metadata">
					<div class="post-num">Post #209</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						12 Dec 2013, 10:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>Is AR9341 supported?<br />I checked the makefile and it doesn&#039;t seem to be there.</p></blockquote></div><p>Will be in next commit.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222625">
				<div class="post-metadata">
					<div class="post-num">Post #210</div>
					<div class="post-author">Mark_V</div>
					<div class="post-datetime">
						14 Jan 2014, 00:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi pepe2k</p><p>I just wanted to thank you for your work on the modification from U-boot.</p><p>I&#039;m only playing with a wr703 for two weeks now, before i had one i figured out that<br />the version off the original bootloader was very critical and you need a serial connection<br />to fix things if something went wrong, not a thing i want to do.</p><p>So i made a &#039;roadmap&#039; on how to program my new 16mb flash with U-boot (yours), MAC<br />data (what a waste of flash a whole 64kb block gone for just a few MAC adress bytes), <br />firmware (OpenWRT) and ART data.</p><p>After programming my flash and soldering it back in i noticed that my editor had changed <br />all 0x00 in 0x20 in the ART section, damm no wifi.</p><p>So i made a new ART 64kb block, booted the wr703 with a 3sec hold on the reset switch,<br />and was able to upload the new ART block throught a normal web gui...</p><p>Wow!, this is super! user friendly, it looks that if you use your modified U-boot there is almost<br />no way to brick your router...</p><p>Grtzz&nbsp; Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222628">
				<div class="post-metadata">
					<div class="post-num">Post #211</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						14 Jan 2014, 00:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Mark_V wrote:</cite><blockquote><p>Hi pepe2k</p><p>I just wanted to thank you for your work on the modification from U-boot.</p><p>I&#039;m only playing with a wr703 for two weeks now, before i had one i figured out that<br />the version off the original bootloader was very critical and you need a serial connection<br />to fix things if something went wrong, not a thing i want to do.</p><p>So i made a &#039;roadmap&#039; on how to program my new 16mb flash with U-boot (yours), MAC<br />data (what a waste of flash a whole 64kb block gone for just a few MAC adress bytes), <br />firmware (OpenWRT) and ART data.</p><p>After programming my flash and soldering it back in i noticed that my editor had changed <br />all 0x00 in 0x20 in the ART section, damm no wifi.</p><p>So i made a new ART 64kb block, booted the wr703 with a 3sec hold on the reset switch,<br />and was able to upload the new ART block throught a normal web gui...</p><p>Wow!, this is super! user friendly, it looks that if you use your modified U-boot there is almost<br />no way to brick your router...</p><p>Grtzz&nbsp; Mark</p></blockquote></div><p>Hello Mark!</p><p>I&#039;m glad that you like it!<br />Have you tried O/C already (this functionality is available only in source, but if you want I can build an image for you)? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222706">
				<div class="post-metadata">
					<div class="post-num">Post #212</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						14 Jan 2014, 16:19					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://Censored">Censored</a><br />datasheet</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222708">
				<div class="post-metadata">
					<div class="post-num">Post #213</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						14 Jan 2014, 16:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p><a href="http://Censored">Censored</a><br />datasheet</p></blockquote></div><p>Great! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Any others... e.g. QCA9558, QCA9533, QCA9531? <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222715">
				<div class="post-metadata">
					<div class="post-num">Post #214</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						14 Jan 2014, 17:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p><a href="http://Censored">Censored</a><br />datasheet</p></blockquote></div><p>lol</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222723">
				<div class="post-metadata">
					<div class="post-num">Post #215</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						14 Jan 2014, 17:51					</div>
				</div>
				<div class="post-content content">
					<p>Luckily I grabbed a copy... LOL</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222769">
				<div class="post-metadata">
					<div class="post-num">Post #216</div>
					<div class="post-author">Mark_V</div>
					<div class="post-datetime">
						15 Jan 2014, 01:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Hello Mark!</p><p>I&#039;m glad that you like it!<br />Have you tried O/C already (this functionality is available only in source, but if you want I can build an image for you)? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards!</p></blockquote></div><p>No i had no time to play with it and i still have to install a toolchain first, one of the first things i want to<br />try is to run Oscam on my wr703<br />But if you could make an Uboot image with o/c functionality i would be glad to test, how can i set frequency&#039;s?<br />or is this set during compile? if so could you set the maximum stable settings...</p><p>dziękuję&nbsp; Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222774">
				<div class="post-metadata">
					<div class="post-num">Post #217</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						15 Jan 2014, 02:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Mark_V wrote:</cite><blockquote><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Hello Mark!</p><p>I&#039;m glad that you like it!<br />Have you tried O/C already (this functionality is available only in source, but if you want I can build an image for you)? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards!</p></blockquote></div><p>No i had no time to play with it and i still have to install a toolchain first, one of the first things i want to<br />try is to run Oscam on my wr703<br />But if you could make an Uboot image with o/c functionality i would be glad to test, how can i set frequency&#039;s?<br />or is this set during compile? if so could you set the maximum stable settings...</p><p>dziękuję&nbsp; Mark</p></blockquote></div><p>Today I pushed new functionality for PLL/clocks changing, with predefined list of available configurations.<br />Just run &quot;setclocks&quot; command and you will see something like this:</p><div class="codebox"><pre><code>uboot&gt; setcl
Current clocks (approximated):
- CPU: 400 MHz
- RAM: 400 MHz
- AHB: 200 MHz
- SPI:  33 MHz
- REF:  25 MHz

Available PLL and clocks configurations: 23

      | CPU | RAM | AHB | SPI | [ ]
  ---------------------------------
   1. | 200 | 200 | 100 |  25 | [ ]
   2. | 200 | 200 | 200 |  33 | [ ]
   3. | 225 | 225 | 112 |  28 | [ ]
   4. | 225 | 225 | 225 |  28 | [ ]
   5. | 250 | 250 | 125 |  31 | [ ]
   6. | 250 | 250 | 250 |  31 | [ ]
   7. | 300 | 300 | 150 |  25 | [ ]
   8. | 325 | 325 | 162 |  27 | [ ]
   9. | 350 | 350 | 175 |  29 | [ ]
  10. | 360 | 360 | 180 |  30 | [ ]
  11. | 400 | 400 | 200 |  33 | [ ]
  12. | 412 | 412 | 206 |  34 | [ ]
  13. | 425 | 425 | 212 |  35 | [ ]
  14. | 437 | 437 | 218 |  27 | [ ]
  15. | 450 | 450 | 225 |  28 | [ ]
  16. | 460 | 460 | 230 |  29 | [ ]
  17. | 475 | 475 | 237 |  30 | [ ]
  18. | 487 | 487 | 243 |  30 | [ ]
  19. | 500 | 500 | 250 |  31 | [ ]
  20. | 500 | 250 | 250 |  31 | [ ]
  21. | 525 | 262 | 131 |  33 | [ ]
  22. | 560 | 280 | 140 |  35 | [ ]
  23. | 600 | 300 | 200 |  33 | [ ]

[*] = currently selected profile (stored in FLASH).
All clocks in MHz, run &#039;setclocks X&#039; to choose one.

** Notice:
   you should always make a backup of your device
   entire FLASH content before making any changes</code></pre></div><p>Using &quot;setclocks X&quot; you can choose profile and save it in FLASH. After reboot, the device will use new clocks configuration.</p><p>If something goes wrong (e.g. device won&#039;t start)... there is a recovery mode: remove power cable, push and hold the &quot;reset&quot; button and plug the power cable again (still holding reset button). The device will start with default clocks (400/400/200 MHz) and you will be able to remove (&quot;clearclocks&quot;) or choose other configuration.</p><p>And here is an image for WR703N (tested): <a href="http://www.tech-blog.pl/pliki/u-boot_mod_wr703n_15012014.rar">http://www.tech-blog.pl/pliki/u-boot_mo … 012014.rar</a></p><p>Have a nice... overclocking time! <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222776">
				<div class="post-metadata">
					<div class="post-num">Post #218</div>
					<div class="post-author">googn</div>
					<div class="post-datetime">
						15 Jan 2014, 03:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>Mark_V wrote:</cite><blockquote><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Hello Mark!</p><p>I&#039;m glad that you like it!<br />Have you tried O/C already (this functionality is available only in source, but if you want I can build an image for you)? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards!</p></blockquote></div><p>No i had no time to play with it and i still have to install a toolchain first, one of the first things i want to<br />try is to run Oscam on my wr703<br />But if you could make an Uboot image with o/c functionality i would be glad to test, how can i set frequency&#039;s?<br />or is this set during compile? if so could you set the maximum stable settings...</p><p>dziękuję&nbsp; Mark</p></blockquote></div><p>Today I pushed new functionality for PLL/clocks changing, with predefined list of available configurations.<br />Just run &quot;setclocks&quot; command and you will see something like this:</p><div class="codebox"><pre><code>uboot&gt; setcl
Current clocks (approximated):
- CPU: 400 MHz
- RAM: 400 MHz
- AHB: 200 MHz
- SPI:  33 MHz
- REF:  25 MHz

Available PLL and clocks configurations: 23

      | CPU | RAM | AHB | SPI | [ ]
  ---------------------------------
   1. | 200 | 200 | 100 |  25 | [ ]
   2. | 200 | 200 | 200 |  33 | [ ]
   3. | 225 | 225 | 112 |  28 | [ ]
   4. | 225 | 225 | 225 |  28 | [ ]
   5. | 250 | 250 | 125 |  31 | [ ]
   6. | 250 | 250 | 250 |  31 | [ ]
   7. | 300 | 300 | 150 |  25 | [ ]
   8. | 325 | 325 | 162 |  27 | [ ]
   9. | 350 | 350 | 175 |  29 | [ ]
  10. | 360 | 360 | 180 |  30 | [ ]
  11. | 400 | 400 | 200 |  33 | [ ]
  12. | 412 | 412 | 206 |  34 | [ ]
  13. | 425 | 425 | 212 |  35 | [ ]
  14. | 437 | 437 | 218 |  27 | [ ]
  15. | 450 | 450 | 225 |  28 | [ ]
  16. | 460 | 460 | 230 |  29 | [ ]
  17. | 475 | 475 | 237 |  30 | [ ]
  18. | 487 | 487 | 243 |  30 | [ ]
  19. | 500 | 500 | 250 |  31 | [ ]
  20. | 500 | 250 | 250 |  31 | [ ]
  21. | 525 | 262 | 131 |  33 | [ ]
  22. | 560 | 280 | 140 |  35 | [ ]
  23. | 600 | 300 | 200 |  33 | [ ]

[*] = currently selected profile (stored in FLASH).
All clocks in MHz, run &#039;setclocks X&#039; to choose one.

** Notice:
   you should always make a backup of your device
   entire FLASH content before making any changes</code></pre></div><p>Using &quot;setclocks X&quot; you can choose profile and save it in FLASH. After reboot, the device will use new clocks configuration.</p><p>If something goes wrong (e.g. device won&#039;t start)... there is a recovery mode: remove power cable, push and hold the &quot;reset&quot; button and plug the power cable again (still holding reset button). The device will start with default clocks (400/400/200 MHz) and you will be able to remove (&quot;clearclocks&quot;) or choose other configuration.</p><p>And here is an image for WR703N (tested): <a href="http://www.tech-blog.pl/pliki/u-boot_mod_wr703n_15012014.rar">http://www.tech-blog.pl/pliki/u-boot_mo … 012014.rar</a></p><p>Have a nice... overclocking time! <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>Great job！</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222810">
				<div class="post-metadata">
					<div class="post-num">Post #219</div>
					<div class="post-author">fjorger</div>
					<div class="post-datetime">
						15 Jan 2014, 14:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>Mark_V wrote:</cite><blockquote><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Hello Mark!</p><p>I&#039;m glad that you like it!<br />Have you tried O/C already (this functionality is available only in source, but if you want I can build an image for you)? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards!</p></blockquote></div><p>No i had no time to play with it and i still have to install a toolchain first, one of the first things i want to<br />try is to run Oscam on my wr703<br />But if you could make an Uboot image with o/c functionality i would be glad to test, how can i set frequency&#039;s?<br />or is this set during compile? if so could you set the maximum stable settings...</p><p>dziękuję&nbsp; Mark</p></blockquote></div><p>Today I pushed new functionality for PLL/clocks changing, with predefined list of available configurations.<br />Just run &quot;setclocks&quot; command and you will see something like this:</p><div class="codebox"><pre><code>uboot&gt; setcl
Current clocks (approximated):
- CPU: 400 MHz
- RAM: 400 MHz
- AHB: 200 MHz
- SPI:  33 MHz
- REF:  25 MHz

Available PLL and clocks configurations: 23

      | CPU | RAM | AHB | SPI | [ ]
  ---------------------------------
   1. | 200 | 200 | 100 |  25 | [ ]
   2. | 200 | 200 | 200 |  33 | [ ]
   3. | 225 | 225 | 112 |  28 | [ ]
   4. | 225 | 225 | 225 |  28 | [ ]
   5. | 250 | 250 | 125 |  31 | [ ]
   6. | 250 | 250 | 250 |  31 | [ ]
   7. | 300 | 300 | 150 |  25 | [ ]
   8. | 325 | 325 | 162 |  27 | [ ]
   9. | 350 | 350 | 175 |  29 | [ ]
  10. | 360 | 360 | 180 |  30 | [ ]
  11. | 400 | 400 | 200 |  33 | [ ]
  12. | 412 | 412 | 206 |  34 | [ ]
  13. | 425 | 425 | 212 |  35 | [ ]
  14. | 437 | 437 | 218 |  27 | [ ]
  15. | 450 | 450 | 225 |  28 | [ ]
  16. | 460 | 460 | 230 |  29 | [ ]
  17. | 475 | 475 | 237 |  30 | [ ]
  18. | 487 | 487 | 243 |  30 | [ ]
  19. | 500 | 500 | 250 |  31 | [ ]
  20. | 500 | 250 | 250 |  31 | [ ]
  21. | 525 | 262 | 131 |  33 | [ ]
  22. | 560 | 280 | 140 |  35 | [ ]
  23. | 600 | 300 | 200 |  33 | [ ]

[*] = currently selected profile (stored in FLASH).
All clocks in MHz, run &#039;setclocks X&#039; to choose one.

** Notice:
   you should always make a backup of your device
   entire FLASH content before making any changes</code></pre></div><p>Using &quot;setclocks X&quot; you can choose profile and save it in FLASH. After reboot, the device will use new clocks configuration.</p><p>If something goes wrong (e.g. device won&#039;t start)... there is a recovery mode: remove power cable, push and hold the &quot;reset&quot; button and plug the power cable again (still holding reset button). The device will start with default clocks (400/400/200 MHz) and you will be able to remove (&quot;clearclocks&quot;) or choose other configuration.</p><p>And here is an image for WR703N (tested): <a href="http://www.tech-blog.pl/pliki/u-boot_mod_wr703n_15012014.rar">http://www.tech-blog.pl/pliki/u-boot_mo … 012014.rar</a></p><p>Have a nice... overclocking time! <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><br /><p>Hello Pepe2K</p><p>Thanks for compiling the lastest version for us <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Altough I already &quot;compiled&quot; some full OpenWRT firmware with the modules I needed, it&#039;s not an easy task and not free from possible errors. Thus your image was really great; safe and secure way for me to try.</p><p>It worked really well (I tried overclocking to 15 &quot;450Mhz&quot;) and no problems, then I got back to normal (using 11 - assuming this is the correct and default speed).</p><br /><p>Boot:</p><br /><p>*********************************************<br />*&nbsp; &nbsp; &nbsp; &nbsp; U-Boot 1.1.4&nbsp; (Jan 15 2014)&nbsp; &nbsp; &nbsp; &nbsp; *<br />*********************************************</p><p>AP121 (AR9331) U-Boot for TL-WR703N</p><p>DRAM:&nbsp; &nbsp;64 MB DDR 16-bit<br />FLASH:&nbsp; Macronix MX25L128 (16 MB)<br />CLOCKS: 400/400/200/33 MHz (CPU/RAM/AHB/SPI)</p><p>LED on during eth initialization...</p><p>Hit any key to stop autobooting:&nbsp; 0</p><p>Booting image at: 0x9F020000</p><p>&nbsp; &nbsp;Image name:&nbsp; &nbsp;OpenWrt r39076<br />&nbsp; &nbsp;Image type:&nbsp; &nbsp;MIPS Linux Kernel Image (lzma compressed)<br />&nbsp; &nbsp;Data size:&nbsp; &nbsp; 1026636 Bytes = 1002.6 kB<br />&nbsp; &nbsp;Load address: 0x80060000<br />&nbsp; &nbsp;Entry point:&nbsp; 0x80060000</p><p>Uncompressing kernel image... OK!<br />Starting kernel...</p><p>[&nbsp; &nbsp; 0.000000] Linux version 3.10.24 (user@mint12) (gcc version 4.6.4 (OpenWrt/Linaro GCC 4.6-2013.05 r39055) ) #3 Tue Dec 17 11:50:44 PST 2013<br />[&nbsp; &nbsp; 0.000000] bootconsole [early0] enabled<br />[&nbsp; &nbsp; 0.000000] CPU revision is: 00019374 (MIPS 24Kc)<br />[&nbsp; &nbsp; 0.000000] SoC: Atheros AR9330 rev 1<br />[&nbsp; &nbsp; 0.000000] Clocks: CPU:400.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz<br />[&nbsp; &nbsp; 0.000000] Determined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 04000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] Initrd not found or empty - disabling initrd</p><br /><br /><br /><p>Thanks for all your help,</p><p>I hope I collect some courage to build the other u-boot images (from your source code) for 710/720 and 3600/4300 later on.</p><p>Keep up your outstanding work.<br />Regards,</p><p>FJorgeR.</p><p>PS: My 703N has 64MB ram and 16MB of Flash (thanks to slboat) <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222886">
				<div class="post-metadata">
					<div class="post-num">Post #220</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						16 Jan 2014, 10:59					</div>
				</div>
				<div class="post-content content">
					<p>By using instructions found in the ar7242-manual, now i can make my device changing pll clocks without rebooting device, in real time!<br />without error in kernel also with working wifi(or ethernet) connection(via putty and io tool) <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>The secret is simple, no need to immediately set the required frequency to CPU!<br />You just need to gently (bit by bit) to switch to the target PLL value.</p><p>for example default value for 400_400_200(ar724x):<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# io -4 0x18050000
18050000:  00040828
root@OpenWrt:~#
root@OpenWrt:~# time sleep 1 &lt;= Feels Like, one seconds has passed
real    0m 1.00s
user    0m 0.00s
sys     0m 0.00s
root@OpenWrt:~#</code></pre></div><p>try to downgrade the pll(gently):<br /></p><div class="codebox"><pre><code>#!/bin/sh
io -4 0x18050000 0x50828 &amp;&amp; \ &lt;= base value 0x40828 swith to Bypass PLL(bit16) 400_400_200
io -4 0x18050000 0x50827 &amp;&amp; \
io -4 0x18050000 0x50826 &amp;&amp; \
io -4 0x18050000 0x50825 &amp;&amp; \
io -4 0x18050000 0x50824 &amp;&amp; \
io -4 0x18050000 0x50823 &amp;&amp; \
io -4 0x18050000 0x50822 &amp;&amp; \
io -4 0x18050000 0x50821 &amp;&amp; \
io -4 0x18050000 0x50820 &amp;&amp; \
io -4 0x18050000 0x5081f &amp;&amp; \
io -4 0x18050000 0x5081e &amp;&amp; \
io -4 0x18050000 0x5081d &amp;&amp; \
io -4 0x18050000 0x5081c &amp;&amp; \
io -4 0x18050000 0x5081b &amp;&amp; \
io -4 0x18050000 0x5081a &amp;&amp; \
io -4 0x18050000 0x50819 &amp;&amp; \
io -4 0x18050000 0x50818 &amp;&amp; \
io -4 0x18050000 0x50817 &amp;&amp; \
io -4 0x18050000 0x50816 &amp;&amp; \
io -4 0x18050000 0x50815 &amp;&amp; \
io -4 0x18050000 0x50814 &amp;&amp; \
io -4 0x18050000 0x50813 &amp;&amp; \
io -4 0x18050000 0x50812 &amp;&amp; \
io -4 0x18050000 0x50811 &amp;&amp; \
io -4 0x18050000 0x50810 &amp;&amp; \ &lt;=160_160_80
io -4 0x18050000 0x5080f      &lt;= unknown, minimum for me, if less - CPU will reboot

#===overclocking===
#io -4 0x18050000 0x50829 &amp;&amp; \
#io -4 0x18050000 0x5082a &amp;&amp; \
#io -4 0x18050000 0x5082b &amp;&amp; \
#io -4 0x18050000 0x5082c &amp;&amp; \
#io -4 0x18050000 0x5082d &amp;&amp; \
#io -4 0x18050000 0x5082e &amp;&amp; \
#io -4 0x18050000 0x5082f &amp;&amp; \
#io -4 0x18050000 0x50830 &amp;&amp; \
#io -4 0x18050000 0x50831      &lt;= 487_487_243 maximum for me, if more - CPU will reboot</code></pre></div><p>test sleep command(with minimum pll = 0x5080f):<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# time sleep 1 &lt;= Feels Like,!three! seconds has passed
real    0m 1.00s
user    0m 0.00s
sys     0m 0.00s
root@OpenWrt:~#</code></pre></div><p>now we need to do something with the kernel, also desync the speed on UART...<br />probably kernel does not support overclocking in real time<br /><img src="https://forum.openwrt.org/img/smilies/lol.png" width="15" height="15" alt="lol" /></p>											<p class="post-edited">(Last edited by <strong>Dioptimizer</strong> on 16 Jan 2014, 11:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222891">
				<div class="post-metadata">
					<div class="post-num">Post #221</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						16 Jan 2014, 11:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>By using instructions found in the ar7242-manual, now i can make my device changing pll clocks without rebooting device, in real time!<br />without error in kernel also with working wifi(or ethernet) connection(via putty and io tool) <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>[...]</p><p>now we need to do something with the kernel, also desync the speed on UART...<br />probably kernel does not support overclocking in real time<br /><img src="https://forum.openwrt.org/img/smilies/lol.png" width="15" height="15" alt="lol" /></p></blockquote></div><p>Good job, but there are a lot of things to consider with that approach:<br />- SPI clock/divider in some configuration also should/need to be changed<br />- you should check if the PLL has locked at a new configuration and if not, back to previous settings<br />- what about DDR parameters (most of all: timings)<br />- time synchronization in kernel (with higher clocks our routers will be in future...)<br />- UART (you wrote it already)<br />- what will happen if you try to change DDR clock and at the same time when some process tries to write/read from memory?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222960">
				<div class="post-metadata">
					<div class="post-num">Post #222</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						17 Jan 2014, 08:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>By using instructions found in the ar7242-manual, now i can make my device changing pll clocks without rebooting device, in real time!<br />without error in kernel also with working wifi(or ethernet) connection(via putty and io tool) <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>The secret is simple, no need to immediately set the required frequency to CPU!<br />You just need to gently (bit by bit) to switch to the target PLL value.</p><p>for example default value for 400_400_200(ar724x):<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# io -4 0x18050000
18050000:  00040828
root@OpenWrt:~#
root@OpenWrt:~# time sleep 1 &lt;= Feels Like, one seconds has passed
real    0m 1.00s
user    0m 0.00s
sys     0m 0.00s
root@OpenWrt:~#</code></pre></div><p>try to downgrade the pll(gently):<br /></p><div class="codebox"><pre><code>#!/bin/sh
io -4 0x18050000 0x50828 &amp;&amp; \ &lt;= base value 0x40828 swith to Bypass PLL(bit16) 400_400_200
io -4 0x18050000 0x50827 &amp;&amp; \
io -4 0x18050000 0x50826 &amp;&amp; \
io -4 0x18050000 0x50825 &amp;&amp; \
io -4 0x18050000 0x50824 &amp;&amp; \
io -4 0x18050000 0x50823 &amp;&amp; \
io -4 0x18050000 0x50822 &amp;&amp; \
io -4 0x18050000 0x50821 &amp;&amp; \
io -4 0x18050000 0x50820 &amp;&amp; \
io -4 0x18050000 0x5081f &amp;&amp; \
io -4 0x18050000 0x5081e &amp;&amp; \
io -4 0x18050000 0x5081d &amp;&amp; \
io -4 0x18050000 0x5081c &amp;&amp; \
io -4 0x18050000 0x5081b &amp;&amp; \
io -4 0x18050000 0x5081a &amp;&amp; \
io -4 0x18050000 0x50819 &amp;&amp; \
io -4 0x18050000 0x50818 &amp;&amp; \
io -4 0x18050000 0x50817 &amp;&amp; \
io -4 0x18050000 0x50816 &amp;&amp; \
io -4 0x18050000 0x50815 &amp;&amp; \
io -4 0x18050000 0x50814 &amp;&amp; \
io -4 0x18050000 0x50813 &amp;&amp; \
io -4 0x18050000 0x50812 &amp;&amp; \
io -4 0x18050000 0x50811 &amp;&amp; \
io -4 0x18050000 0x50810 &amp;&amp; \ &lt;=160_160_80
io -4 0x18050000 0x5080f      &lt;= unknown, minimum for me, if less - CPU will reboot

#===overclocking===
#io -4 0x18050000 0x50829 &amp;&amp; \
#io -4 0x18050000 0x5082a &amp;&amp; \
#io -4 0x18050000 0x5082b &amp;&amp; \
#io -4 0x18050000 0x5082c &amp;&amp; \
#io -4 0x18050000 0x5082d &amp;&amp; \
#io -4 0x18050000 0x5082e &amp;&amp; \
#io -4 0x18050000 0x5082f &amp;&amp; \
#io -4 0x18050000 0x50830 &amp;&amp; \
#io -4 0x18050000 0x50831      &lt;= 487_487_243 maximum for me, if more - CPU will reboot</code></pre></div><p>test sleep command(with minimum pll = 0x5080f):<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# time sleep 1 &lt;= Feels Like,!three! seconds has passed
real    0m 1.00s
user    0m 0.00s
sys     0m 0.00s
root@OpenWrt:~#</code></pre></div><p>now we need to do something with the kernel, also desync the speed on UART...<br />probably kernel does not support overclocking in real time<br /><img src="https://forum.openwrt.org/img/smilies/lol.png" width="15" height="15" alt="lol" /></p></blockquote></div><p>Nice find, I will be trying this on my own device!<br />Btw what about USB stability test?<br />The max O/C should be based on how everything is still functional when the clocks are exceeded.</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 17 Jan 2014, 08:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223032">
				<div class="post-metadata">
					<div class="post-num">Post #223</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						18 Jan 2014, 00:15					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://www.mediafire.com/download/mcbf4ugcv5q7ndc/20140117_0536_57.zip">http://www.mediafire.com/download/mcbf4 … 536_57.zip</a> tried SPI clock control in real time <br /><a href="http://www.mediafire.com/download/mcbf4ugcv5q7ndc/20140117_0536_57.zip">http://www.mediafire.com/download/mcbf4 … 536_57.zip</a> tried PLL clock control in real time and read data from /tmp (ram)</p>											<p class="post-edited">(Last edited by <strong>Dioptimizer</strong> on 18 Jan 2014, 00:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223035">
				<div class="post-metadata">
					<div class="post-num">Post #224</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						18 Jan 2014, 01:03					</div>
				</div>
				<div class="post-content content">
					<p>Are you following the instruction from page 51 (below) or 22... or do you make only one write to the CPU_PLL_CONFIG register (0x18050000)?<br /></p><div class="codebox"><pre><code>To update the PLL, following is an example:
Set RESET[25] = 1, BYPASS[16] = 1, required frequency set DIV[9:0] = 0x28 (for 400 MHz operation), write 0x2090828 to register 0x1805000
Take it out of reset, write 0x00090828 to register 0x18050000
Take it out of bypass, write 0x00000828 to register 0x18050000</code></pre></div><p>Are you checking/polling bit &quot;UPDATING&quot; during this process? There is also a statement that CPU resets during switch from REF_CLK to clock from PLL (page 22).</p><p>With BYPASS bit set, the CPU, DDR and AHB get clocks only from REF_CLK, not from PLL block (it&#039;s bypassed, from page 22: &quot;All [clocks] operate at REF_CLK in PLL bypass mode&quot;). I can see that in your previous post, all hex values for CPU_PLL_CONFIG register have BYPASS bit set to 1, was it a mistake?</p>											<p class="post-edited">(Last edited by <strong>pepe2k</strong> on 18 Jan 2014, 01:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223166">
				<div class="post-metadata">
					<div class="post-num">Post #225</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						19 Jan 2014, 15:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Are you following the instruction from page 51 (below) or 22... or do you make only one write to the CPU_PLL_CONFIG register (0x18050000)?</p></blockquote></div><p>Yes, was changed only DIV (0:9) value</p><div class="quotebox"><blockquote><p>To update the PLL, following is an example:<br />...</p></blockquote></div><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Are you checking/polling bit &quot;UPDATING&quot; during this process? There is also a statement that CPU resets during switch from REF_CLK to clock from PLL (page 22).</p></blockquote></div><p>I suspect that it is just starting initialization of CPU, divider DIV can be changed in real time - which in itself is news (at least for me).<br />But in any case, to check state of this bit need have directly acces (read) to the register CPU_PLL_CONFIG (0x18050000) and read the value in a single cycle, like uboot does it:<br /></p><div class="codebox"><pre><code>wait_for_pll_update:

    pll_get(PLL_CONFIG_PLL_UPDATE_MASK, PLL_CONFIG_PLL_UPDATE_SHIFT, t6)
    bne zero, t6, wait_for_pll_update

    nop</code></pre></div><p>(io-utility is not suitable for this purpose, it has no direct access to this register (only through the kernel) and even more so, it is not able to read the necessary registers in such a short cycle.</p><br /><p>Or you think that the changed value DIV in real time - is not the best choice due to the possible instability of a given frequency?<br /></p><div class="quotebox"><cite>AR7242manual wrote:</cite><blockquote><p>0 CLOCK_SWITCH Clock switch enables switching from the basic REF_CLK to the CPU_PLL <br />clock <strong><span class="bbu">after the CPU_PLL clock is stable</span></strong></p></blockquote></div><p>(i.e. you suspect that changing DIV value I do CPU_PLL clock is <strong><span class="bbu">unstable</span></strong>?)</p><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>I can see that in your previous post, all hex values for CPU_PLL_CONFIG register have BYPASS bit set to 1, was it a mistake?</p></blockquote></div><p>I was just experimenting, it does not matter <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>update:<br />Any factory u-boot bootloader supported changing PLL-clocks after reboot device!<br />It is much easier than with a device to flash a special loader or change the kernel. <br />Just need to write a special program like <strong>io</strong>, which will have direct access to registers 0x18050000 and 0x18050008.</p><p>For example, i tried to use this rule(on page 22):<br /></p><div class="quotebox"><cite>AR7242manual wrote:</cite><blockquote><p>If the CPU_CLOCK_CONTROL register bit <br />RESET_SWITCH (bit [1]) is set to 1, jump <br />directly to Step 5.</p></blockquote></div><p>- it works, it realised in factory uboot!<br /></p><div class="codebox"><pre><code>mw 0x18050000 0x40827; mw 0x18050008 0x2; go 0x9f000000</code></pre></div><p>more in my <a href="http://www.mediafire.com/download/fdcznzniqvdqq1f/logs.zip">logs (6.6k)</a><br />(by the way, is there a trick with restarting the device to the specified frequency using RESET_SWITCH bit)</p>											<p class="post-edited">(Last edited by <strong>Dioptimizer</strong> on 19 Jan 2014, 15:33)</p>
									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 226 to 225 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 9 of 25</div><nav><ul><li><a href="viewtopic.php%3Fid=43237&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=25.html">25</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>