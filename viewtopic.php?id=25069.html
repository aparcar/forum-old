<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> I&#039;ve screwed up badly, help please?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p110377">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">davidork</div>
					<div class="post-datetime">
						2 Jun 2010, 01:07					</div>
				</div>
				<div class="post-content content">
					<p>I had just installed 10.03 and accidentally changed the lan interface from static to dhcp.</p><p>Now i&#039;m locked out and the router doesn&#039;t respond in failsafe mode to ping, telnet, or ssh.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110378">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Protx</div>
					<div class="post-datetime">
						2 Jun 2010, 01:20					</div>
				</div>
				<div class="post-content content">
					<p>You could install a dhcp server on your pc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110379">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">davidork</div>
					<div class="post-datetime">
						2 Jun 2010, 01:50					</div>
				</div>
				<div class="post-content content">
					<p>could you explain a bit further?<br />ive tried installing a dhcp server, but how should i configure it/ how would i access the router itself?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110385">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">0xception</div>
					<div class="post-datetime">
						2 Jun 2010, 04:44					</div>
				</div>
				<div class="post-content content">
					<p>Some other options you might want to try first</p><p>1. Access the device via the WAN interface if one is setup<br />2. Rebuild the image and reinstall it.<br />3. Protx&#039;s method of using another dhcp server would work as well. However if you have another gateway or router someplace you could skip trying to setup a dhcp server on your PC and just hook your borked openWRT up behind another router/gateway and then once it obtains an IP (on either the wan or the lan) access it via that IP and reconfigure it. <br />4. Depending on the the device you may be able to get in by using the devices reset button ... some let you reboot into a &quot;flashing mode&quot; perhaps your device has something similar. but it sounds like you already tried that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110430">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">davidork</div>
					<div class="post-datetime">
						2 Jun 2010, 18:38					</div>
				</div>
				<div class="post-content content">
					<p>0xception: <br />1. Wan interface is setup and working, however it isn&#039;t configured for access via ssh/telnet/web/etc. <br />2. Can&#039;t ping the router, tftp&#039;ing would be a waste of time.&nbsp; I&#039;m trying to avoid going the rs232 way.<br />3. That is actually a very good idea, didn&#039;t think of that.&nbsp; I did setup a dhcp server and manage to get logged into it ONCE, changed the setting back to static and save/applied&nbsp; but for some reason it didn&#039;t take.<br />4. Yeah.&nbsp; I&#039;ve gotten it into failsafe a few dozen times, but the configuration for the lan interface (the only one that listens in failsafe mode) is broken.</p><p>I think I&#039;m going to go back and try #3 with a router instead of my pc being the dhcp server and getting in that way. <br />If that doesn&#039;t work i may give nmap and a few other tools a go and see if i can find a hole to pick open.</p><p>If all else fails, I&#039;ll have to get &quot;Serial&quot; with it</p><p>What&#039;s terrible about it is i was 100% finished with setting it up, and I must have caught the pull down as I was looking over everything.&nbsp; I really need to stop being lazy and just do everything via SSH, stuff like this doesn&#039;t happen when I use a terminal.</p><p>BTW is there any way you can make your own failsafe configurations?</p>											<p class="post-edited">(Last edited by <strong>davidork</strong> on 2 Jun 2010, 18:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110457">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">davidork</div>
					<div class="post-datetime">
						3 Jun 2010, 04:50					</div>
				</div>
				<div class="post-content content">
					<p>-Update- <br />after watching the router with wireshark it is in fact sending out dhcp SYN requests.&nbsp; &nbsp;However being locked out of my lan interface it ignores the dhcp ACK from my dhcp server.</p><p>Anyone think spoofing a dhcp ack with the source mac address of my router would get it up and rolling?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110464">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">0xception</div>
					<div class="post-datetime">
						3 Jun 2010, 08:53					</div>
				</div>
				<div class="post-content content">
					<p>Honestly it sounds like more is broken then just simply setting the lan to dhcp (perhaps it&#039;s due to the fact it has dnsmasq also acting as a dhcp server on the same interface?) </p><p>Either way... what type of device is it? Is it possible your device has some sort of hardware hack to reset it? For example when i used to really screw up my WRT54G&#039;s i would crack it open and short pins 15 and 16 out and it would allow me to tftp a new image up to the device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110486">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">davidork</div>
					<div class="post-datetime">
						3 Jun 2010, 17:56					</div>
				</div>
				<div class="post-content content">
					<p>It was working quite fine until i changed that setting. Its a tp-link 841nd version 3.&nbsp; <br />Don&#039;t know of anything specific to easily let me back in.<br />I think i need to get my hands on a rs232 to ttl shifter and just tftp it back to life over serial.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110503">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">sastk</div>
					<div class="post-datetime">
						4 Jun 2010, 02:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi I have the same issue. I have a TP-LINK WR1043nd</p><p>I am able to access it in Failsafe mode (Flashing led mode), but nothing I can do here.</p><p>File System is read only. <br />I tried to do: mount_root, but it doesn&#039;t help.</p><p>I don&#039;t see network file in /etc/config/ to modify<br />Here is my /etc/config/</p><p>root@(none):/etc/config# ls -lrt<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 289 Apr&nbsp; 3&nbsp; 2010 system<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 432 Apr&nbsp; 3&nbsp; 2010 webif<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32 Apr&nbsp; 3&nbsp; 2010 cron<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 615 Apr&nbsp; 3&nbsp; 2010 dhcp<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 104 Apr&nbsp; 3&nbsp; 2010 dropbear<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1896 Apr&nbsp; 3&nbsp; 2010 firewall<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 449 Apr&nbsp; 3&nbsp; 2010 ntpclient<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1352 Apr&nbsp; 3&nbsp; 2010 uhttpd<br />.</p><p>When I connect it doesn&#039;t assign IP to my PC. It doesn&#039;t matter Wire or WIfi connection.<br />If I setup IP manually on my PC I am not able to ping router.</p><p>Is there a way to restore original configuration?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110504">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">davidork</div>
					<div class="post-datetime">
						4 Jun 2010, 04:37					</div>
				</div>
				<div class="post-content content">
					<p>see if you can run sysupgrade or see if you can tftp the firmware back onto the router.</p><br /><p>i couldn&#039;t do anything in failsafe.</p>											<p class="post-edited">(Last edited by <strong>davidork</strong> on 4 Jun 2010, 05:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110768">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">strikeout</div>
					<div class="post-datetime">
						8 Jun 2010, 15:59					</div>
				</div>
				<div class="post-content content">
					<p>Hello</p><div class="quotebox"><cite>sastk wrote:</cite><blockquote><p>Hi I have the same issue. I have a TP-LINK WR1043nd</p><p>I am able to access it in Failsafe mode (Flashing led mode), but nothing I can do here.<br />Is there a way to restore original configuration?</p></blockquote></div><p>Same hardware same problem! Every firmware build with the imagebuilder &quot;locks&quot; anything. Failsavemode is working. The &quot;official sysupdate&quot; Firmware downloaded from here: <a href="http://downloads.openwrt.org/backfire/10.03/ar71xx/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin">http://downloads.openwrt.org/backfire/1 … actory.bin</a> works.</p><p>To recover from failsavemode i started a small http server (thttpd) on my debian desktop an use wget to download the file on the router.</p><p>bye<br />Arnd</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111373">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">eijk</div>
					<div class="post-datetime">
						17 Jun 2010, 13:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sastk wrote:</cite><blockquote><p>Hi I have the same issue. I have a TP-LINK WR1043nd</p><p>I am able to access it in Failsafe mode (Flashing led mode), but nothing I can do here.</p><p>File System is read only. <br />I tried to do: mount_root, but it doesn&#039;t help.</p></blockquote></div><p>Had the same problem. The mount_root script is broken. Do the following</p><p>cp /sbin/mount_root /tmp<br />vi /tmp/mount_root</p><p>go with cursors to the &quot;m&quot; in &quot;boot_run_hook mount_root&quot; (at the end)<br />press i, enter &quot;preinit_&quot;, press escape, type &quot;:wq&quot;</p><p>this should change said line to <br />boot_run_hook preinit_mount_root</p><p>then /tmp/mount_root</p><p>Then, the actual config files should be visible and modifiable.</p><p>Regards,</p><p>eijk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111374">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">eijk</div>
					<div class="post-datetime">
						17 Jun 2010, 13:19					</div>
				</div>
				<div class="post-content content">
					<p>already fixed for next release: <a href="https://dev.openwrt.org/changeset/20838">https://dev.openwrt.org/changeset/20838</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>