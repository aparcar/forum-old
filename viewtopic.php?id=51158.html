<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> IPTV and openwrt [SOLVED]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p237123">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						18 Jun 2014, 00:06					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I did a small topology for my home network, wondering what could be the way to use the same 100mbps LAN cable for my second room router and bridge my IPTV perhaps tagging it in my room router? <br />Please give me some suggestions, how can I do this, check the image... <a href="http://tinypic.com/view.php?pic=34xfkb4&amp;s=8#.U6CupXWSwy4">http://tinypic.com/view.php?pic=34xfkb4 â€¦ 6CupXWSwy4</a></p><p>thanks</p><p>A.</p>											<p class="post-edited">(Last edited by <strong>tolidtm</strong> on 21 Jun 2014, 13:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237147">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						18 Jun 2014, 03:53					</div>
				</div>
				<div class="post-content content">
					<p>You just want a basic VLAN setup</p><p>Set LAN2 on your 1043n to be any VLAN other than 0 or 1, in untagged mode<br />Add the same VLAN in tagged mode to LAN1<br />Add the same VLAN in tagged mode to LAN1 on the 841<br />Add the same VLAN in untagged mode to LAN2 on the 841.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237401">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						19 Jun 2014, 23:36					</div>
				</div>
				<div class="post-content content">
					<p>Thank you qasdfdsaq, this way I have TV in the room, but no more LAN, so my router in the room is not pingable any more.<br />What else should I do ?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237408">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						20 Jun 2014, 00:35					</div>
				</div>
				<div class="post-content content">
					<p>What exactly did you do?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237409">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						20 Jun 2014, 00:48					</div>
				</div>
				<div class="post-content content">
					<p>I created VLAN 500, with all ports OFF, but LAN1 tagged and LAN2 untagged this is in router 1. On router 2 Created VLAN 500 with LAN1 tagged and LAN2 untagged.<br />In router 2 there is only VLAN 500, but in router 1 there are VLAN1 and VLAN2. where LAN1 and LAN2 are OFF.</p><p>A.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237410">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						20 Jun 2014, 01:11					</div>
				</div>
				<div class="post-content content">
					<p>Well there&#039;s your problem, you removed your LAN VLAN from your second router, which is why it is now not pingable. You also removed it from the cable between the two routers - which defeats the point of having it in the first place.</p><p>Just reset it back to the way it was and do what I said earlier.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237415">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						20 Jun 2014, 01:59					</div>
				</div>
				<div class="post-content content">
					<p>OK so on router 1 the config of the switch is as follows:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LAN1&nbsp; LAN2<br />ID&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4&nbsp; &nbsp; &nbsp; &nbsp; 5&nbsp; &nbsp; &nbsp; &nbsp; 6<br />1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; U&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;U&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; U&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp; O<br />2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp;U&nbsp; &nbsp; &nbsp; &nbsp; U<br />500&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;U&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; T&nbsp; &nbsp; &nbsp; &nbsp;O&nbsp; &nbsp; &nbsp; &nbsp; O</p><p>Is that OK for config of router1?</p><p>thx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237416">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						20 Jun 2014, 02:08					</div>
				</div>
				<div class="post-content content">
					<p>No. You need to do the opposite.</p><div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>Set LAN2 on your 1043n to be any VLAN other than 0 or 1, in <strong>untagged</strong> mode &lt;== <span style="color: blue">You have set this to <strong>tagged</strong>. You need to set it to <strong>untagged</strong></span><br />Add the same VLAN in <strong>tagged</strong> mode to LAN1 &lt;== <span style="color: blue">You have <strong>replaced</strong> the VLAN and set it to <strong>untagged</strong>. You need <strong>add</strong> the VLAN and set it to <strong>tagged</strong></span><br />Add the same VLAN in tagged mode to LAN1 on the 841<br />Add the same VLAN in untagged mode to LAN2 on the 841.</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 20 Jun 2014, 02:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237419">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						20 Jun 2014, 02:56					</div>
				</div>
				<div class="post-content content">
					<p>Am sorry, did a mistake. I did it exactly as you told me lan1 is lan2 am wrong.</p><p>Reset the router 2 to defaults.<br />And just created vlan 500 as you told me. Tv ok lan not ok.</p><p>However, my vlan 1 on router 2 is back, just had to turn off port 1 and 2, as it says than you cannot untag lan 2 on vlan 1 and 500. Tv ok lan stll not</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237421">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						20 Jun 2014, 03:19					</div>
				</div>
				<div class="post-content content">
					<p>VLAN500 needs to be <em>untagged</em> only on the TV port of Router 2. VLAN 1 must be untagged on all other ports (sorry, my earlier instructions made this mistake - the last line should be set/replace)</p><p>That means you need VLAN 1 untagged on LAN1 of router 2, and VLAN 500 tagged on the same port. You need VLAN 500 untagged on LAN2 of router 2, and all other VLANs off on that port.<br />VLAN 1 should be left as default (untagged) on all other ports of Router 2 other than CPU, which should be left as it was default as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237422">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						20 Jun 2014, 03:20					</div>
				</div>
				<div class="post-content content">
					<p>That said, your router may also be affected by <a href="https://dev.openwrt.org/ticket/12181">https://dev.openwrt.org/ticket/12181</a> this bug. So you might have to have VLAN 1 <em>and</em> VLAN 500 tagged on LAN1 of <em>both</em> routers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237516">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						20 Jun 2014, 20:55					</div>
				</div>
				<div class="post-content content">
					<p>No way.</p><p>When untagging VLAN1 on LAN1 on both router 1 and 2. the internet works, but not the TV.</p><p>So now my configuration is VLAN500 tagged on LAN1 on both r1 and r2 - VLAN1 tagged on LAN1 on both r1 and r2.</p><p>TV OK no PING.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237518">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						20 Jun 2014, 22:14					</div>
				</div>
				<div class="post-content content">
					<p>This is my network config on router 1:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd60:1b1c:3858::/48&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.2.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option dns &#039;8.8.8.8 8.8.4.4 162.219.6.158&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option _orig_ifname &#039;eth0&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.10&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.1.1&#039;
    option dns &#039;8.8.8.8 8.8.4.4 192.168.1.1&#039;

config interface &#039;wan6&#039;
    option ifname &#039;@wan&#039;
    option proto &#039;dhcpv6&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config interface &#039;VPN_client&#039;
    option proto &#039;none&#039;
    option ifname &#039;tun0&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;3&#039;
    option vid &#039;500&#039;
    option ports &#039;3 4t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;4&#039;
    option vid &#039;1&#039;
    option ports &#039;0 1 2 4t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;5&#039;
    option ports &#039;5 6&#039;
    option vid &#039;2&#039;</code></pre></div><p>This is router2:</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.2.2&#039;
    option gateway &#039;192.168.2.1&#039;
    option dns &#039;192.168.2.1&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcp&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option vid &#039;1&#039;
    option ports &#039;1 2t 4&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;2t 3&#039;
    option vid &#039;500&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237523">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						21 Jun 2014, 00:02					</div>
				</div>
				<div class="post-content content">
					<p>Try the configs below. Router2 should then output the iptv stream on its wan port.</p><p>Router 1:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd60:1b1c:3858::/48&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth1.1&#039; # switch to tagged
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.2.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option dns &#039;8.8.8.8 8.8.4.4 162.219.6.158&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.10&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.1.1&#039;
    option dns &#039;8.8.8.8 8.8.4.4 192.168.1.1&#039;

config interface &#039;wan6&#039;
    option ifname &#039;@wan&#039;
    option proto &#039;dhcpv6&#039;

config interface &#039;iptv&#039;
    option proto &#039;none&#039;
    option type &#039;bridge&#039;
    option ifname &#039;eth0.500 eth1.500&#039; # bridge wan vid 500 with lan vid 500

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config interface &#039;VPN_client&#039;
    option proto &#039;none&#039;
    option ifname &#039;tun0&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;3&#039;
    option vid &#039;500&#039;
    option ports &#039;3t 4t&#039; # internal port 3 is the trunk port running to router2

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;4&#039;
    option vid &#039;1&#039;
    option ports &#039;0 1 2 3t 4t&#039; # port 3 tagged here too

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;5&#039;
    option ports &#039;5 6&#039;
    option vid &#039;2&#039;</code></pre></div><p>Router 2:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth1.1&#039; # use vid since traffic is tagged
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.2.2&#039;
    option gateway &#039;192.168.2.1&#039;
    option dns &#039;192.168.2.1&#039;

config interface &#039;iptv&#039;
    option type &#039;bridge&#039;
    option proto &#039;none&#039;
    option ifname &#039;eth1.500 eth0&#039; # bridge iptv vlan to wan untagged

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option vid &#039;1&#039;
    option ports &#039;1 2t 4t&#039; # cpu port must be tagged since multiple vlans are in use

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;2t 3&#039;
    option vid &#039;500&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237534">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						21 Jun 2014, 00:54					</div>
				</div>
				<div class="post-content content">
					<p>Now am even not able get dhcp from rtr1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237535">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						21 Jun 2014, 00:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Try the configs below. Router2 should then output the iptv stream on its wan port.</p><p>Router 1:<br /></p><div class="codebox"><pre><code>snip</code></pre></div></blockquote></div><p>The problem with this config is that it assumes the TV connection is coming in as a tagged VLAN 500 on the WAN port along with the internet - but according to his image it is not, it&#039;s a separate and (possibly) untagged port on the ISP router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237539">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						21 Jun 2014, 01:06					</div>
				</div>
				<div class="post-content content">
					<p>yes and now I have no more access to my router 1, I can ping it from the modem subnet, but can&#039;t access it via ssh</p><p>I will will try from vpn</p>											<p class="post-edited">(Last edited by <strong>tolidtm</strong> on 21 Jun 2014, 01:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237540">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						21 Jun 2014, 01:12					</div>
				</div>
				<div class="post-content content">
					<p>what a chance..... thanks got the vpn worked</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237560">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						21 Jun 2014, 04:29					</div>
				</div>
				<div class="post-content content">
					<p>No workaround ? No one did this before?</p><p>Thanks for your help btw</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237585">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">tolidtm</div>
					<div class="post-datetime">
						21 Jun 2014, 13:41					</div>
				</div>
				<div class="post-content content">
					<p>Don&#039;t know how come, but I decided to factory reset my router 1, and redo all the settings suggested by qasdfdsaq all seems to work as wanted, the only thing I did more is to modify the eth1 to eth1.1.</p><p>Thank you for your help</p><p>A.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>