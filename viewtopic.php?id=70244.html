<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> CPE210 v1.1 recovery</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p354352">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">hinerk</div>
					<div class="post-datetime">
						16 Mar 2017, 18:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I recently bought this router and tried to flash several images in several ways: lede, stock and openwrt, via web UI and via tftp and providing the image as recovery.bin. The router complains &quot;Incorrect file&quot;. Since it seems that I haven&#039;t any other options I decide to run the router with its stock image. Before I installed the router on the roof, I made some hardware modifications, so now I can remotely perform a factory reset and its serial console is available via a serial device server. I mention that, because it means that the device is absolutely beyond warranty with all that soldering!</p><p>This morning I give it another try and for any reason I was able to first install the current stock image to the router and then install a self built openwrt image both flashed via the routers web UI. I did not really care about the image I flashed and how it was build. And because their was no web UI anymore (I checked port 80 with netstat) I used the serial console to flash an image which I previosly copied with scp to that device. Since it is a sunny day and things works like a charm, I skipped thinking and performed sysupdate -F lede-something.bin.<br />Now when I boot the router, it outputs:</p><p>&nbsp; &nbsp; TP-LINK SafeLoader (Build time: Jun 12 2015 - 09:49:53)<br />&nbsp; &nbsp; CPU: 560MHz AHB: 225MHz DDR: 64MB<br />&nbsp; &nbsp; Performing LED check..&nbsp; PASS<br />&nbsp; &nbsp; Press CTRL+B to enter SafeLoader: 1<br />&nbsp; &nbsp; Flash Manufacturer: Unknown(0xc8)<br />&nbsp; &nbsp; Flash Device ID: Unknown(0x4017)<br />&nbsp; &nbsp; Data flash init failed.<br />&nbsp; &nbsp; open user-config failed.<br />&nbsp; &nbsp; open user-config failed.</p><p>&nbsp; &nbsp; enet0 port4 up</p><p>&nbsp; &nbsp; TFTP server address is 192.168.0.100; our address is 192.168.0.254<br />&nbsp; &nbsp; Get filename &#039;recovery.bin&#039;.</p><p>&nbsp; &nbsp; Retry count exceeded; starting again<br />&nbsp; &nbsp; enet1 port3 up</p><p>&nbsp; &nbsp; TFTP server address is 192.168.0.100; our address is 192.168.0.254<br />&nbsp; &nbsp; Get filename &#039;recovery.bin&#039;.<br />&nbsp; &nbsp; #################################################################<br />&nbsp; &nbsp; ################################<br />&nbsp; &nbsp; Done.<br />&nbsp; &nbsp; Bytes transferred = 4936747, 928 Kbytes/sec<br />&nbsp; &nbsp; Incorrect File.<br />&nbsp; &nbsp; Writting error.<br />&nbsp; &nbsp; ##Warning: File is unidentiable. Try downloading</p><p>&nbsp; &nbsp; TFTP server address is 192.168.0.100; our address is 192.168.0.254<br />&nbsp; &nbsp; Get filename &#039;vmlinuz&#039;.</p><p>&nbsp; &nbsp; Retry count exceeded; starting again</p><p>&nbsp; &nbsp; TFTP server address is 192.168.0.100; our address is 192.168.0.254<br />&nbsp; &nbsp; Get filename &#039;vmlinuz&#039;.<br />&nbsp; &nbsp; #################################################################<br />&nbsp; &nbsp; ########<br />&nbsp; &nbsp; Done.<br />&nbsp; &nbsp; Bytes transferred = 3732560, 927 Kbytes/sec<br />&nbsp; &nbsp; Skipping non LOAD program header (type 0x70000003)<br />&nbsp; &nbsp; Allocated memory for elf segment ok: addr: 0x806b3050, size 0x88df94<br />&nbsp; &nbsp; Loading .text @ 0x806b3050 (128 bytes)<br />&nbsp; &nbsp; Loading .text.error @ 0x806b30d0 (8 bytes)<br />&nbsp; &nbsp; Loading .text.malloc @ 0x806b30d8 (104 bytes)<br />&nbsp; &nbsp; Loading .text.xz_crc32 @ 0x806b3140 (68 bytes)<br />&nbsp; &nbsp; Loading .text.dec_vli @ 0x806b3184 (260 bytes)<br />&nbsp; &nbsp; Loading .text.index_update @ 0x806b3288 (96 bytes)<br />&nbsp; &nbsp; Loading .text.crc32_validate @ 0x806b32e8 (108 bytes)<br />&nbsp; &nbsp; Loading .text.lzma_len @ 0x806b3354 (588 bytes)<br />&nbsp; &nbsp; Loading .text.fill_temp @ 0x806b35a0 (156 bytes)<br />&nbsp; &nbsp; Loading .text.free.isra.0 @ 0x806b363c (44 bytes)<br />&nbsp; &nbsp; Loading .text.xz_dec_end @ 0x806b3668 (80 bytes)<br />&nbsp; &nbsp; Loading .text.dict_repeat.part.1 @ 0x806b36b8 (152 bytes)<br />&nbsp; &nbsp; Loading .text.xz_dec_reset @ 0x806b3750 (76 bytes)<br />&nbsp; &nbsp; Loading .text.lzma_main @ 0x806b379c (2944 bytes)<br />&nbsp; &nbsp; Loading .text.__stack_chk_guard_setup @ 0x806b431c (20 bytes)<br />&nbsp; &nbsp; Loading .text.__stack_chk_fail @ 0x806b4330 (8 bytes)<br />&nbsp; &nbsp; Loading .text.decompress_kernel @ 0x806b4338 (4688 bytes)<br />&nbsp; &nbsp; Loading .text.memcpy @ 0x806b5588 (44 bytes)<br />&nbsp; &nbsp; Loading .text.memset @ 0x806b55b4 (40 bytes)<br />&nbsp; &nbsp; Loading .text.memmove @ 0x806b55dc (72 bytes)<br />&nbsp; &nbsp; Loading .text.__ashldi3 @ 0x806b5624 (72 bytes)<br />&nbsp; &nbsp; Loading .text.startup.main @ 0x806b566c (8 bytes)<br />&nbsp; &nbsp; Loading .MIPS.abiflags @ 0x806b5678 (24 bytes)<br />&nbsp; &nbsp; Loading .rodata.str1.4 @ 0x806b5690 (8 bytes)<br />&nbsp; &nbsp; Loading .rodata.decompress_kernel @ 0x806b5698 (108 bytes)<br />&nbsp; &nbsp; Loading ___ksymtab+__ashldi3 @ 0x806b5704 (8 bytes)<br />&nbsp; &nbsp; Loading __ksymtab_strings+__ashldi3 @ 0x806b570c (10 bytes)<br />&nbsp; &nbsp; Loading .data @ 0x806b5720 (3708080 bytes)<br />&nbsp; &nbsp; Clearing .bss @ 0x80b3ebd0 (4202496 bytes)<br />&nbsp; &nbsp; Clearing .bss.__stack_chk_guard @ 0x80f40bd0 (4 bytes)<br />&nbsp; &nbsp; Clearing .bss.xz_crc32_table @ 0x80f40bd4 (1024 bytes)<br />&nbsp; &nbsp; Clearing .bss.malloc_count @ 0x80f40fd4 (4 bytes)<br />&nbsp; &nbsp; Clearing .bss.malloc_ptr @ 0x80f40fd8 (4 bytes)<br />&nbsp; &nbsp; Clearing .bss.free_mem_end_ptr @ 0x80f40fdc (4 bytes)<br />&nbsp; &nbsp; Clearing .bss.free_mem_ptr @ 0x80f40fe0 (4 bytes)</p><p>&nbsp; &nbsp; Starting kernel</p><p>&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Linux version 4.4.14 (hinerk@v22016124142142173.bestsrv.de) (gcc version 5.3.0 (OpenWrt GCC 5.3.0 50104) ) #4 Thu Mar 16 14:53:16 UTC 2017<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] bootconsole [early0] enabled<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] CPU0 revision is: 0001974c (MIPS 74Kc)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] SoC: Atheros AR9344 rev 2<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Determined physical RAM map:<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000]&nbsp; memory: 04000000 @ 00000000 (usable)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Initrd not found or empty - disabling initrd<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] No valid device tree found, continuing without<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Zone ranges:<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal&nbsp; &nbsp;[mem 0x0000000000000000-0x0000000003ffffff]<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Movable zone start for each node<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Early memory node ranges<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;node&nbsp; &nbsp;0: [mem 0x0000000000000000-0x0000000003ffffff]<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Initmem setup node 0 [mem 0x0000000000000000-0x0000000003ffffff]<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 16256<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Kernel command line:&nbsp; rootfstype=squashfs,jffs2 noinitrd<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Writing ErrCtl register=00000000<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Readback ErrCtl register=00000000<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Memory: 57796K/65536K available (2989K kernel code, 175K rwdata, 756K rodata, 2600K init, 200K bss, 7740K reserved, 0K cma-reserved)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] NR_IRQS:51<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] Clocks: CPU:560.000MHz, DDR:450.000MHz, AHB:225.000MHz, Ref:40.000MHz<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000000] clocksource: MIPS: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 6825930166 ns<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.000009] sched_clock: 32 bits at 280MHz, resolution 3ns, wraps every 7669584382ns<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.009052] Calibrating delay loop... 278.93 BogoMIPS (lpj=1394688)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.082153] pid_max: default: 32768 minimum: 301<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.087654] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.095347] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.106460] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.118691] NET: Registered protocol family 16<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.125443] MIPS: machine is Generic AR71XX/AR724X/AR913X based board<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.146123] clocksource: Switched to clocksource MIPS<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.153533] NET: Registered protocol family 2<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.159529] TCP established hash table entries: 1024 (order: 0, 4096 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.167693] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.175085] TCP: Hash tables configured (established 1024 bind 1024)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.182584] UDP hash table entries: 256 (order: 0, 4096 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.189419] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 0.197032] NET: Registered protocol family 1<br />&nbsp; &nbsp; [&nbsp; &nbsp; 3.221593] futex hash table entries: 256 (order: -1, 3072 bytes)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 3.243811] squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />&nbsp; &nbsp; [&nbsp; &nbsp; 3.250660] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.<br />&nbsp; &nbsp; [&nbsp; &nbsp; 3.264985] io scheduler noop registered<br />&nbsp; &nbsp; [&nbsp; &nbsp; 3.269609] io scheduler deadline registered (default)<br />&nbsp; &nbsp; [&nbsp; &nbsp; 3.275812] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled<br />&nbsp; &nbsp; [&nbsp; &nbsp; 3.283725] console [ttyS0] disabled<br />&nbsp; &nbsp; [&nbsp; &nbsp; 3.307987] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11, base_baud = 2500000) is a 16550A</p><p>Because the boot interrups in previous trials with non successfully fetching a vmlinuz image via tftp, I provide this image, I took from my build experiment. Obviously something is booting but serial console disappears and a tcpdump doesn&#039;t give me any clue how I could access the router. I rebuild the image with appending &#039;ttyS1::respawn:/bin/ash -c /bin/login&#039; to any inittab I found in the build environment, but I guess this will have no influence to the vmlinuz file.<br />Does someone have any suggestions, what I could try to bring the device in a bit more useful state? Thank you!</p><p>PS: I can skip the boot by pressing ctrl+B, which makes the router prompting for a password, I tried admin, 5up and a bunch of others but it doesn&#039;t seem to login to anything.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p354529">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Malvineous</div>
					<div class="post-datetime">
						19 Mar 2017, 03:50					</div>
				</div>
				<div class="post-content content">
					<p>Does the image you are booting have the initramfs attached, or is it just a bare kernel?</p><p>It looks like the serial console is being disabled during boot.&nbsp; Have you used a kernel command line to enable the serial console, or compiled the kernel such that it always uses ttyS0?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p354549">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hinerk</div>
					<div class="post-datetime">
						19 Mar 2017, 13:16					</div>
				</div>
				<div class="post-content content">
					<p>I thought I can see the first part of the bootlog, because the kernel starts with boot console enabled. And in the moment init continues booting the console becomes disabled because of inittab? I don&#039;t know the necessary kernel parameter to enforce serial console. Please tell me ... ok 1µs of googling and I will try console=ttyS0.</p><p>... enabling serial console did the job. Router boots, it seems that it loads my initramfs. I left some clandestine messages in /init. (By the way: I am not experienced with building images. All I do is try and error. So recommendations are appreciated. )</p><p>I can log into openwrt via ttyS0. ifconfig shows only localhost and only if I use the -a option - is this healthy? I would expect something like mtdblock in /dev but there is nothing which looks like flash memory.</p><p>Currently the router runs the initramfs and the kernel I provide. I am able to alter the kernel parameter via the kernel config. I want to flash a serious image to the routers storage, so first it might be a good idea to make the router recognize its memory. Secondly I appreciate a network connection, which will makes it a lot easier to provide the new image. I will rebuild the image from scratch to get rid of the several changes I made to the config. </p><p>Thank you Malvineous for making me rethink the serial situation</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p354598">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Malvineous</div>
					<div class="post-datetime">
						20 Mar 2017, 02:47					</div>
				</div>
				<div class="post-content content">
					<p>No worries, it confused me until I realised that there are potentially three different methods for displaying boot messages - the earliest &quot;decompressing the kernel&quot; messages can be displayed by using an API provided by the bootloader, then the &quot;early printk&quot; services take over and display the first of the kernel messages, then at the point you&#039;ve seen above enough of the kernel has started that it switches to the full serial console, if it has been told there is one with the command like parameter.&nbsp; (Then as you have mentioned, after the kernel brings up init, it hands this serial console over to getty or similar as specified in the inittab file.)</p><p>It sounds like you might be building a generic image, lacking the drivers needed for your specific hardware.&nbsp; Are you trying to add support to OpenWRT for a new device, or is there some reason why you don&#039;t want to use the precompiled image for your hardware?</p><p>If you are simply trying to recover the router from the accidental sysupdate, maybe you could bundle the files you need into the initramfs file so they are available on the router when you boot it, then through the serial console you can attempt a reflash.&nbsp; You will of course need to figure out which mtdblock driver your hardware uses and build that into the kernel, otherwise it won&#039;t be able to access the flash.</p><p>If your device is supported by OpenWRT then you should be able to find the build config somewhere with all the correct drivers enabled.&nbsp; Sorry I&#039;m not familiar enough with the project to know where however, I have just done some hardware experimenting before, just like you are doing now :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p354783">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hinerk</div>
					<div class="post-datetime">
						22 Mar 2017, 13:51					</div>
				</div>
				<div class="post-content content">
					<p>I actually want to debrick the device. I try to use the recommended recovery method from the wiki: renaming the stock image to recovery.bin and use tftp to provide it to the router. But the router won&#039;t accept this image. I tried both stock images I found, 1.0.0 and 1.3.3. Router says:</p><p>TFTP server address is 192.168.0.100; our address is 192.168.0.254<br />Get filename &#039;recovery.bin&#039;.<br />#################################################################<br />###############################<br />Done.<br />Bytes transferred = 4869486, 960 Kbytes/sec<br />Incorrect File.<br />Writting error.<br />##Warning: File is unidentiable. Try downloading</p><p>TFTP server address is 192.168.0.100; our address is 192.168.0.254<br />Get filename &#039;vmlinuz&#039;.</p><p>Because after trying to download recovery.bin, the router is requesting vmlinuz I tried several vmlinuz. Including building a new one.</p><p>I tried to feed the stock image to the router as vmlinuz too, but it didn&#039;t worked.</p><p>I built an image which boots and which provides a decent linux system but as you mentioned: no flash and no ethernet. I figured out that the size of the image should not raise above 5.5 MB otherwise the router dumps lot of extraordinary utf-8 and refuse booting.</p><p>In menuconfig, I select the CPE2150 /510 etc. as subtarget<br />in kernel_menuconfig I select CPE510. The resulting image has the name of the router. I don&#039;t now how generic it is.</p><p>Is there anywhere a configuration file, which I can use?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p354793">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Malvineous</div>
					<div class="post-datetime">
						22 Mar 2017, 17:23					</div>
				</div>
				<div class="post-content content">
					<p>I think the menuconfig options just set the architecture and show/hide certain drivers.&nbsp; You still have to know which drivers to go and enable once they become visible in the menu system.&nbsp; For example if you choose a device that has no USB ports, all the USB options will be hidden.&nbsp; But if you choose a device that does support USB it will let you see all the USB options in the menu, but you still have to know which USB chip is in use and enable the driver for it, otherwise you&#039;ll still get a kernel without USB support.&nbsp; So in your case you likely have the driver for the flash and Ethernet available, but those drivers must be configured as disabled.</p><p>Is there an OpenWRT wiki page for your device?&nbsp; I&#039;m not sure how OpenWRT build all their trunk images but they must have a collection of configuration options somewhere.</p><p>If you can&#039;t find the right config, can you find a pre-built OpenWRT image for your device?&nbsp; Maybe you can extract the kernel (and initramfs) from it, then boot that, as it should have the correct drivers built in already.&nbsp; If it works, it might be just enough to reflash the device with the sysupgrade file, to get OpenWRT running on it properly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p354856">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jimmytaker</div>
					<div class="post-datetime">
						23 Mar 2017, 14:20					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I am having a similar problem. This thread: viewtopic.php?id=68979 (CPE210(EU) V1.1 bricked failsave doesnt work) - sorry cannot post a link - describes it better (I cannot do anything from the serial console - pressing CTRL+B has no effect, nothing is displayed after this prompt). I also tried feeding it vmlinuz to no success. Please, keep posting your progress here, and if you manage to build a .bin that actually works for you, I would really like to try it with my device, as well - so can you please upload it somewhere.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p354862">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">edgar_bahi</div>
					<div class="post-datetime">
						23 Mar 2017, 15:24					</div>
				</div>
				<div class="post-content content">
					<p>I have the same problem. Was to go back to the original firmware and use &quot;mtd command&quot; and there is no way to make it work. Who is responsible has a week and I have not yet paid and lost time. The documentation is disordered and outdated for example recovery with an arduino is incomplete and outdated. For me the router is no longer useful. Thank you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358652">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">hinerk</div>
					<div class="post-datetime">
						19 May 2017, 19:53					</div>
				</div>
				<div class="post-content content">
					<p>Its been a while ...</p><p>Maybe someone can provide the /proc/config.gz file from its working device? I built a lot of kernels which I can boot on my router but I didn&#039;t figure out which are the necessary modules. There is a feature for kernel config which is called make randomconfig ... I am pretty sure, I didn&#039;t offer much more intelligence in my attemps. ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358657">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">WWTK</div>
					<div class="post-datetime">
						19 May 2017, 21:44					</div>
				</div>
				<div class="post-content content">
					<p>You are aware there is a prebuilt image for your router yes?</p><p><a href="https://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/">https://downloads.openwrt.org/snapshots … x/generic/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358705">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hinerk</div>
					<div class="post-datetime">
						20 May 2017, 22:44					</div>
				</div>
				<div class="post-content content">
					<p>Yes but they are not working. I recently provided a *-factory.bin as vmlinuz which results in this kernel panic:<br /></p><div class="codebox"><pre><code>TFTP server address is 192.168.0.100; our address is 192.168.0.254
Get filename &#039;vmlinuz&#039;.
#################################################################
################################
Done.
Bytes transferred = 4928535, 251 Kbytes/sec
Allocated memory for elf segment ok: addr: 0x80260000, size 0x4cddc0
Loading .text @ 0x80261030 (4848 bytes)
Loading .rodata.str1.4 @ 0x80262320 (212 bytes)
Loading .data @ 0x80262400 (825765 bytes)
Clearing .bss @ 0x8032bdb0 (4202512 bytes)

Starting kernel

Booting Atheros AR934x
Linux version 2.6.31 (jenkins@sohoiapbuild) (gcc version 4.3.3 (GCC) ) #1 PREEMPT Tue Jul 5 10:43:05 CST 2016
flash_size passed from bootloader = 0
CPU revision is: 0001974c (MIPS 74Kc)
ath_sys_frequency: cpu srif ddr srif cpu 560 ddr 450 ahb 225
Determined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
User-defined physical RAM map:
 memory: 04000000 @ 00000000 (usable)
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00004000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00004000
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
Kernel command line: console=ttyS0,115200 root=31:04 rootfstype=squashfs init=/init mtdparts=ath-nor0:128k(u-boot),64k(pation-table),64k(product-info),1536k(kernel),6144k(rootfs),192k(config),64k(ART) mem=64M
PID hash table entries: 256 (order: 8, 1024 bytes)
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
Memory: 62388k/65536k available (1836k kernel code, 3080k reserved, 476k data, 116k init, 0k highmem)
Hierarchical RCU implementation.
NR_IRQS:128
plat_time_init: plat time init done
Calibrating delay loop... 279.55 BogoMIPS (lpj=559104)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
bio: create slab &lt;bio-0&gt; at 0
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
net_link: create socket ok.
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
TCP: Hash tables configured (established 2048 bind 2048)
TCP reno registered
NET: Registered protocol family 1
ATH GPIOC major 0
squashfs: version 4.0 (2009/01/31) Phillip Lougher
NTFS driver 2.1.29 [Flags: R/O].
msgmni has been set to 121
alg: No test for lzma (lzma-generic)
alg: No test for stdrng (krng)
io scheduler noop registered
io scheduler anticipatory registered
io scheduler deadline registered
io scheduler cfq registered (default)
Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0xb8020000 (irq = 19) is a 16550A
console [ttyS0] enabled
PPP generic driver version 2.4.2
NET: Registered protocol family 24
7 cmdlinepart partitions found on MTD device ath-nor0
Creating 7 MTD partitions on &quot;ath-nor0&quot;:
0x000000000000-0x000000020000 : &quot;u-boot&quot;
0x000000020000-0x000000030000 : &quot;pation-table&quot;
0x000000030000-0x000000040000 : &quot;product-info&quot;
0x000000040000-0x0000001c0000 : &quot;kernel&quot;
0x0000001c0000-0x0000007c0000 : &quot;rootfs&quot;
0x0000007c0000-0x0000007f0000 : &quot;config&quot;
0x0000007f0000-0x000000800000 : &quot;ART&quot;
TCP cubic registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
athwdt_init: Registering WDT success
athwdt_timer_init: Starting WDT.
ath_otp_init: Registering OTP success
ath_clksw_init: Registering Clock Switch Interface success
List of all partitions:
1f00             128 mtdblock0 (driver?)
1f01              64 mtdblock1 (driver?)
1f02              64 mtdblock2 (driver?)
1f03            1536 mtdblock3 (driver?)
1f04            6144 mtdblock4 (driver?)
1f05             192 mtdblock5 (driver?)
1f06              64 mtdblock6 (driver?)
No filesystem could mount root, tried:  squashfs
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(31,4)

Stop feeding the WatchDog (uptime = 0.44, nowtime = 00:00:00).
Dump Current Call Trace:
[&lt;801c9fe0&gt;] dump_stack+0x8/0x34
[&lt;800062a0&gt;] tpwdt_panic_event+0xf8/0x118
[&lt;80043bb0&gt;] notifier_call_chain+0x50/0xac
[&lt;80044230&gt;] __atomic_notifier_call_chain+0x24/0x60
[&lt;80044280&gt;] atomic_notifier_call_chain+0x14/0x20
[&lt;801ca08c&gt;] panic+0x80/0x13c
[&lt;80245e30&gt;] mount_block_root+0x2c4/0x2fc
[&lt;802460a4&gt;] prepare_namespace+0x1c0/0x1f4
[&lt;80245388&gt;] kernel_init+0x11c/0x13c
[&lt;800094a4&gt;] kernel_thread_helper+0x10/0x18

Kernel panic event watchdog notification done.</code></pre></div><p>together with this message from the boot I think the flash passed out</p><div class="codebox"><pre><code>TP-LINK SafeLoader (Build time: Jun 12 2015 - 09:49:53)
CPU: 560MHz AHB: 225MHz DDR: 64MB
Performing LED check..  PASS
Press CTRL+B to enter SafeLoader: 1
Flash Manufacturer: Unknown(0xc8)
Flash Device ID: Unknown(0x4017)
Data flash init failed.
open user-config failed.
open user-config failed.</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358707">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">WWTK</div>
					<div class="post-datetime">
						20 May 2017, 23:10					</div>
				</div>
				<div class="post-content content">
					<p>overheating maybe?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358717">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Malvineous</div>
					<div class="post-datetime">
						21 May 2017, 05:02					</div>
				</div>
				<div class="post-content content">
					<p>That kernel panic says that it can&#039;t find what device the root filesystem is supposed to be on.&nbsp; There are a number of possible causes for this type of problem, here are some:<br /></p><ul><li><p>Module for the filesystem is not available to the kernel</p></li><li><p>Incorrect root= option passed to kernel</p></li><li><p>Wrong or missing mtdblock driver (probably not this in your case as it can see the mtd partition table so the mtd driver is ok)</p></li><li><p>Filesystem not actually flashed to mtdblock device (or in incorrect format) and no root= option given to tell the kernel to look elsewhere</p></li><li><p>Missing initfs packaged up with kernel (which can function as a rudimentary root filesystem)</p></li></ul><p>I&#039;m guessing here but it looks like you extracted the vmlinuz from the -factory.bin file, but ignored the root filesystem also inside the -factory.bin file, then booted the vmlinuz and got a kernel panic when it couldn&#039;t find the root filesystem?&nbsp; It looks like the kernel is working fine, you just have to figure out some way of supplying it with the root filesystem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p358763">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">hinerk</div>
					<div class="post-datetime">
						21 May 2017, 22:45					</div>
				</div>
				<div class="post-content content">
					<p>If the flash is not defective, it is definitively not in expected shape, since I tried to flash lede onto the router, which then failed and rendered the router to its current state. When it is booting, the router reject every image I serve. But then it ask for vmlinuz. I figured out, I can serve the -factory.bin as vmlinuz which the router accepts but the result is this kernel panic.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>