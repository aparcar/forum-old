<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> opkg current packge version when upgrading</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p342617">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">rami rosenbaum</div>
					<div class="post-datetime">
						31 Oct 2016, 13:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I&#039;m using opkg to manage an application, packed as a <strong>debian package</strong> (.deb).<br />I have preinst and postinst scripts which work.</p><p>I need the <strong>version of the currently installed package</strong>, in order to know what should be done.<br />I tried running </p><div class="codebox"><pre><code>opkg list | grep MY_PACKAGE</code></pre></div><p> from within my scripts, but am getting an error:<br /></p><div class="codebox"><pre><code>Collected errors:
 * opkg_lock: Could not lock /run/opkg.lock: Resource temporarily unavailable.</code></pre></div><p>What should I do?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342619">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						31 Oct 2016, 13:16					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>opkg list-installed</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342621">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">rami rosenbaum</div>
					<div class="post-datetime">
						31 Oct 2016, 13:32					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the quick reply.</p><p>Same error</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342651">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						31 Oct 2016, 20:09					</div>
				</div>
				<div class="post-content content">
					<p>- Which OpenWrt Version are you running?<br />- Which router?<br />- What&#039;s the output of those two commands:<br /></p><div class="codebox"><pre><code>df -h
mount</code></pre></div><p>- Have you tried to reboot the router? Does the problem persist?<br />- What happens, if you remove /run/opkg.lock manually?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342652">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">sera</div>
					<div class="post-datetime">
						31 Oct 2016, 20:32					</div>
				</div>
				<div class="post-content content">
					<p>Rami,</p><p>How about installing a file along the package with the needed info and read that back when uninstalling or upgrading as a workaround? I&#039;m not aware of opkg making this info available in any way.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342693">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">rami rosenbaum</div>
					<div class="post-datetime">
						1 Nov 2016, 11:19					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not working on OpenWrt, but an embedded Linux system (Atmel based), generated by Yocto.<br />The package-manager is opkg, version 0.3.0.<br /><strong>df -h</strong><br /></p><div class="codebox"><pre><code>Filesystem      Size  Used Avail Use% Mounted on
ubi0:rootfs     216M  180M   37M  84% /
devtmpfs        116M     0  116M   0% /dev
tmpfs           124M  172K  124M   1% /run
tmpfs           124M  120K  124M   1% /var/volatile</code></pre></div><p><strong>mount</strong><br /></p><div class="codebox"><pre><code>ubi0:rootfs on / type ubifs (rw,relatime)
devtmpfs on /dev type devtmpfs (rw,relatime,size=118040k,nr_inodes=29510,mode=755)
proc on /proc type proc (rw,relatime)
sysfs on /sys type sysfs (rw,relatime)
debugfs on /sys/kernel/debug type debugfs (rw,relatime)
tmpfs on /run type tmpfs (rw,nosuid,nodev,mode=755)
tmpfs on /var/volatile type tmpfs (rw,relatime)
devpts on /dev/pts type devpts (rw,relatime,gid=5,mode=620)</code></pre></div><p>I do not want to remove /run/opkg.lock manually, without knowing the consequences - I&#039;m sure it&#039;s not the opkg design.<br />A version-file will work, but I don&#039;t want to workarounds if I can avoid it.<br />Seems basic that a package-manager, where the user needs to do specific updates according to the currently installed version, will be able to give that info...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342695">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						1 Nov 2016, 11:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rami rosenbaum wrote:</cite><blockquote><p>I&#039;m not working on OpenWrt, but an embedded Linux system (Atmel based), generated by Yocto.<br />The package-manager is opkg, version 0.3.0.</p></blockquote></div><p>You might then ask the question in their forum...</p><p>Openwrt is knowingly using a really ancient version of opkg (0.1.8-git-something) due to its small size, so opkg 0.3.0 might have different behaviour regarding those aspects.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 1 Nov 2016, 11:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342700">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">rami rosenbaum</div>
					<div class="post-datetime">
						1 Nov 2016, 12:09					</div>
				</div>
				<div class="post-content content">
					<p>I was sure it was part of the OpenWrt project<br />Should have mentioned... sorry.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342701">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">sera</div>
					<div class="post-datetime">
						1 Nov 2016, 12:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rami rosenbaum wrote:</cite><blockquote><p>I do not want to remove /run/opkg.lock manually, without knowing the consequences - I&#039;m sure it&#039;s not the opkg design.</p></blockquote></div><p>A lock is acquired fully intentional. Any package manager will do that as to not corrupt the installation due to concurrent modification of the &quot;installed package set&quot; (in lack of a better term).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342703">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						1 Nov 2016, 12:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><div class="quotebox"><cite>rami rosenbaum wrote:</cite><blockquote><p>I&#039;m not working on OpenWrt, but an embedded Linux system (Atmel based), <strong>generated by Yocto.</strong><br />The package-manager is opkg, version 0.3.0.</p></blockquote></div><p>You might then ask the question in their forum...</p><p>Openwrt is knowingly using a really ancient version of opkg (0.1.8-git-something) due to its small size, so opkg 0.3.0 might have different behaviour regarding those aspects.</p></blockquote></div><div class="quotebox"><cite>rami rosenbaum wrote:</cite><blockquote><p>I was sure it was part of the OpenWrt project<br />Should have mentioned... sorry.</p></blockquote></div><p>Yep, we just use it. opkg is actually <strong>from Yocto</strong>, so it is their native tool...</p><p><a href="http://git.yoctoproject.org/cgit/cgit.cgi/opkg/">http://git.yoctoproject.org/cgit/cgit.cgi/opkg/</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 1 Nov 2016, 12:53)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>