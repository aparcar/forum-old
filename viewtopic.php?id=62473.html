<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Connection losts from accessing from outside</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Feb 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p309678">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">chackl</div>
					<div class="post-datetime">
						31 Jan 2016, 02:45					</div>
				</div>
				<div class="post-content content">
					<p>Hello dear OpenWRT Forum.</p><p>I am new here and i have now decided to cantact you in an big problem i have, that i can not get controlled.</p><p>Last year i first was introduced to OpenWRT Attitude Adjustment 12.09 - and after some days i updated to Barrier Breaker 14.07<br />My Router was a TP-Link WDR4300.</p><p>But on Barrier Breaker 14.07 i had only troubles with loosing the conection if there is some data 100MBit and more send ofer the WAN. The Rooter looses the conection to the Internet - BUT: the WAN Subnet has still internet.</p><p>So i switched back to 12.09 - and went to hyper-v with the WRT system because i feared a problem with the router. Well Hyper-V has just the problem that it emulates the traffic. But also all problems seemed to be gone.</p><p>But now i had problems with the speeds of the 100MBit Hardware-Problem from Hyper-V so i got the Hyper-V with a path for it.<br />And now i have the Same Problems with 15.05 that i had with 14.07 with my router. So i catched also my router and also updated it to 15.05 - and it has the same problem.</p><p>What is the Problem:<br />It there is much traffic going from on the WAN-Port to the LAN-Port by forwarding, the Router seemes to loose the Internetconnection. But if i monitor it with a client within the WAN i do not see a loose the Internetconnection.</p><br /><p>Still: I hade this problem not on Altitude Adjustment - Not on the Router WDR4300 - Not on Hyper-V and not on ESXi</p><p>What i did so far:<br />tried an empty 15.05 with Hyper-V - Problem exists (No alternative Packs)<br />tried an empty 12.09 with Hyper-V - Problem does not exist - But it just works with 100MBit/s<br />tried an patched 15.05 with Hyper-V - Problem exists - But it now hast 10GBit</p><br /><p>I tried also to reset the settings, also tried it with a basic setup, and invested now about 4 Hours of googeling the problem.</p><p>Anyone has an idea?<br />The problem is, that there are other systems - and if my boss does not see a result within a few days, i have to use other systems -but i do now want that XD</p><p>Kind Regards,<br />C.Hackl</p>											<p class="post-edited">(Last edited by <strong>chackl</strong> on 31 Jan 2016, 02:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309683">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">trismo</div>
					<div class="post-datetime">
						31 Jan 2016, 03:53					</div>
				</div>
				<div class="post-content content">
					<p>Try disable default fq_codel from the kernel remove this patches 662-use_fq_codel_by_default.patch 663-remove_pfifo_fast.patch 664-<br />codel_fix_3_12.patch and build you own image.</p><p>Disable openwrt firewall and try manual iptable script.</p>											<p class="post-edited">(Last edited by <strong>trismo</strong> on 31 Jan 2016, 03:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309694">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						31 Jan 2016, 09:12					</div>
				</div>
				<div class="post-content content">
					<p>Seems like router&#039;s CPU is overloaded.<br />By default kernel is nonpreemptible. If overloaded in kernel mode&nbsp; all usermode processes will hang.<br />No DNS, DHCP, hanged ssh, luci, disconnecting wifi clients (hang hostapd).<br />I always compile my own builds with preemptible kernel.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309711">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">chackl</div>
					<div class="post-datetime">
						31 Jan 2016, 11:26					</div>
				</div>
				<div class="post-content content">
					<p>Hello trismo and bolvan,<br />Thanks for Reply. Well i did not patch the image by my selfe - i took a ready one found at github - so pathing my self will be a long way XD</p><p>Bolvan: i had also your idea with CPU overload some time ago - but if i monitor it now the loads graph do not jump that much. They are always at 0.01 to 0.05 (hyper-V redirectrs a 4GHZ cpu)</p><p>But i have some new:<br />If i am runny the maschine on an Hyper-V at home i do not have any problems by going over the wan with speed.<br />At the other Hyperwisor is another Firewall in front of the WRT - a PFSense. May this help?</p><p>Kind regards,<br />C.Hackl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309714">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						31 Jan 2016, 11:58					</div>
				</div>
				<div class="post-content content">
					<p>0.01 to 0.05 are bad indicators.<br />Run &quot;top&quot; or &quot;htop&quot; in ssh to monitor cpu usage.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309716">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">chackl</div>
					<div class="post-datetime">
						31 Jan 2016, 12:46					</div>
				</div>
				<div class="post-content content">
					<p>Ok I did it at the my local machine and at the other network - the result seems to be the same:</p><p>I copied a bif file over SMB to an vm that has a portforwarding in WRT to port 445.</p><p>The Results of top ion SSH:<br />4% kworker<br />3% ksoftirqd<br />1% /sbin/netifd<br />1% /usr/sbin/odhcpd</p><p>All others were 0%</p><p>The result was the same - on my local machine i kopied with about 70Mbyte/s - And the other network srashed befor i had a chance to measure anything. If i break up copying it comes all back online after some time</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309855">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">chackl</div>
					<div class="post-datetime">
						1 Feb 2016, 14:24					</div>
				</div>
				<div class="post-content content">
					<p>Hello!</p><p>I did some more testings and conected the WAN direct to a Widnows-PC and tested SMD and RDP - And the result is the samte - connectiontimeouts with higher data-rates than 50MBIT/S</p><p>So i think there are wrong settings in the Pfsense and it is no OpenWRT-Problem</p><p>Thanks for give me some support here - it helped me to locate the problem now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards, C.Hackl</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>