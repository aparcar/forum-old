<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> kamikaze 2.6 on BCM4710 router</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 3 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p35495">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						16 Oct 2006, 15:25					</div>
				</div>
				<div class="post-content content">
					<p>Continuing from <a href="http://forum.openwrt.org/viewtopic.php?pid=35070#p35070">this</a> thread, I got a latest svn co <a href="https://svn.openwrt.org/openwrt/trunk/target/linux/brcm-2.6/">https://svn.openwrt.org/openwrt/trunk/t â€¦ /brcm-2.6/</a> against a buildroot-ng #4886 to boot just fine on a BCM4710 router.&nbsp; Here is the dmesg output:</p><div class="codebox"><pre><code>&lt;5&gt;Linux version 2.6.17 (root@saloon) (gcc version 3.4.6 (OpenWrt-2.0)) #1 Mon Oct 16 12:48:51 EEST 2006
&lt;4&gt;CPU revision is: 00024000
&lt;4&gt;Determined physical RAM map:
&lt;4&gt; memory: 01000000 @ 00000000 (usable)
&lt;7&gt;On node 0 totalpages: 4096
&lt;7&gt;  DMA zone: 4096 pages, LIFO batch:0
&lt;4&gt;Built 1 zonelists
&lt;5&gt;Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,115200
&lt;4&gt;Primary instruction cache 8kB, physically tagged, 2-way, linesize 16 bytes.
&lt;4&gt;Primary data cache 4kB, 2-way, linesize 16 bytes.
&lt;4&gt;Synthesized TLB refill handler (19 instructions).
&lt;4&gt;Synthesized TLB load handler fastpath (31 instructions).
&lt;4&gt;Synthesized TLB store handler fastpath (31 instructions).
&lt;4&gt;Synthesized TLB modify handler fastpath (30 instructions).
&lt;4&gt;PID hash table entries: 128 (order: 7, 512 bytes)
&lt;4&gt;Using 62.500 MHz high precision timer.
&lt;4&gt;Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)
&lt;4&gt;Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)
&lt;6&gt;Memory: 13820k/16384k available (1871k kernel code, 2564k reserved, 260k data, 128k init, 0k highmem)
&lt;7&gt;Calibrating delay loop... 81.92 BogoMIPS (lpj=40960)
&lt;4&gt;Mount-cache hash table entries: 512
&lt;4&gt;Checking for &#039;wait&#039; instruction...  unavailable.
&lt;6&gt;NET: Registered protocol family 16
&lt;4&gt;PCI: fixing up bridge
&lt;7&gt;PCI: Setting latency timer of device 0000:01:00.0 to 64
&lt;4&gt;PCI: Fixing up device 0000:01:00.0
&lt;6&gt;NET: Registered protocol family 2
&lt;4&gt;IP route cache hash table entries: 128 (order: -3, 512 bytes)
&lt;4&gt;TCP established hash table entries: 512 (order: -1, 2048 bytes)
&lt;4&gt;TCP bind hash table entries: 256 (order: -2, 1024 bytes)
&lt;6&gt;TCP: Hash tables configured (established 512 bind 256)
&lt;6&gt;TCP reno registered
&lt;6&gt;squashfs: version 3.0 (2006/03/15) Phillip Lougher
&lt;6&gt;devfs: 2004-01-31 Richard Gooch (rgooch@atnf.csiro.au)
&lt;6&gt;devfs: boot_options: 0x1
&lt;6&gt;JFFS2 version 2.2. (NAND) (C) 2001-2003 Red Hat, Inc.
&lt;6&gt;Initializing Cryptographic API
&lt;6&gt;io scheduler noop registered
&lt;6&gt;io scheduler deadline registered (default)
&lt;6&gt;Serial: 8250/16550 driver $Revision: 1.90 $ 2 ports, IRQ sharing disabled
&lt;6&gt;b44.c:v1.00 (Apr 7, 2006)
&lt;4&gt;PCI: Enabling device 0000:00:02.0 (0000 -&gt; 0002)
&lt;7&gt;PCI: Setting latency timer of device 0000:00:02.0 to 64
&lt;6&gt;eth0: Broadcom 47xx 10/100BaseT Ethernet 00:90:96:45:03:ee
&lt;4&gt;PCI: Enabling device 0000:00:08.0 (0000 -&gt; 0002)
&lt;7&gt;PCI: Setting latency timer of device 0000:00:08.0 to 64
&lt;6&gt;eth1: Broadcom 47xx 10/100BaseT Ethernet 00:90:96:45:03:ef
&lt;6&gt;Physically mapped flash: Found 1 x16 devices at 0x0 in 16-bit bank
&lt;4&gt; Amd/Fujitsu Extended Query Table at 0x0040
&lt;5&gt;number of CFI chips: 1
&lt;5&gt;cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
&lt;5&gt;Flash device: 0x400000 at 0x1fc00000
&lt;5&gt;bootloader size: 262144
&lt;5&gt;Creating 4 MTD partitions on &quot;Physically mapped flash&quot;:
&lt;5&gt;0x00000000-0x00040000 : &quot;cfe&quot;
&lt;5&gt;0x00040000-0x003f0000 : &quot;linux&quot;
&lt;5&gt;0x000f0000-0x003f0000 : &quot;rootfs&quot;
&lt;5&gt;0x003f0000-0x00400000 : &quot;nvram&quot;
&lt;4&gt;ip_conntrack version 2.4 (128 buckets, 1024 max) - 236 bytes per conntrack
&lt;4&gt;ip_tables: (C) 2000-2006 Netfilter Core Team
&lt;6&gt;TCP vegas registered
&lt;6&gt;NET: Registered protocol family 1
&lt;6&gt;NET: Registered protocol family 17
&lt;6&gt;802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
&lt;6&gt;All bugs added by David S. Miller &lt;davem@redhat.com&gt;
&lt;4&gt;VFS: Mounted root (jffs2 filesystem) readonly.
&lt;6&gt;Mounted devfs on /dev
&lt;6&gt;Freeing unused kernel memory: 128k freed
&lt;4&gt;Warning: unable to open an initial console.
&lt;4&gt;Algorithmics/MIPS FPU Emulator v1.5
&lt;6&gt;b44: eth0: Link is up at 100 Mbps, full duplex.
&lt;6&gt;b44: eth0: Flow control is off for TX and off for RX.</code></pre></div><p>The ping -s 2000 192.168.1.1 problem remains though.&nbsp; I&#039;ve opened a ticket about this issue <a href="https://dev.openwrt.org/ticket/851">here</a>. I am also investigating at which trunk pass #4886 the BCM4710 compatibility broke since I am unable to get a ping at 192.168.1.1 after a boot with latest svn chekouts.&nbsp; The hardware I am using is a toshiba wrc-1000 with an atheros cm9 wifi miniPCI. I&#039;ll get back on this.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35496">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						16 Oct 2006, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s not enabling the cache workarounds. Looking into it now...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35500">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						16 Oct 2006, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>Should be fixed now. Confirmed working on my ASUS WL-500G (also BCM4710) - network comes up normally as well...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35504">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						16 Oct 2006, 18:34					</div>
				</div>
				<div class="post-content content">
					<p>Here is some more feedback on the wrc-1000, a BCM4710 router.&nbsp; </p><div class="codebox"><pre><code>svn co https://svn.openwrt.org/openwrt/trunk/ -r 4899
svn co https://svn.openwrt.org/openwrt/trunk/target/linux/generic-2.6/ -r 5160
svn co https://svn.openwrt.org/openwrt/trunk/target/linux/brcm-2.6/ -r 5160</code></pre></div><p>we have a go, the ping -s 2000 192.168.1.1 issue remains though, here is the dmesg output:</p><div class="codebox"><pre><code>&lt;5&gt;Linux version 2.6.17 (root@saloon) (gcc version 3.4.6 (OpenWrt-2.0)) #1 Mon Oct 16 18:10:47 EEST 2006
&lt;4&gt;CPU revision is: 00024000
&lt;4&gt;Determined physical RAM map:
&lt;4&gt; memory: 01000000 @ 00000000 (usable)
&lt;7&gt;On node 0 totalpages: 4096
&lt;7&gt;  DMA zone: 4096 pages, LIFO batch:0
&lt;4&gt;Built 1 zonelists
&lt;5&gt;Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,115200
&lt;4&gt;Enabling BCM4710A0 cache workarounds.
&lt;4&gt;Primary instruction cache 8kB, physically tagged, 2-way, linesize 16 bytes.
&lt;4&gt;Primary data cache 4kB, 2-way, linesize 16 bytes.
&lt;4&gt;Synthesized TLB refill handler (20 instructions).
&lt;4&gt;Synthesized TLB load handler fastpath (31 instructions).
&lt;4&gt;Synthesized TLB store handler fastpath (31 instructions).
&lt;4&gt;Synthesized TLB modify handler fastpath (30 instructions).
&lt;4&gt;PID hash table entries: 128 (order: 7, 512 bytes)
&lt;4&gt;Using 62.400 MHz high precision timer.
&lt;4&gt;Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)
&lt;4&gt;Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)
&lt;6&gt;Memory: 13820k/16384k available (1872k kernel code, 2564k reserved, 260k data, 128k init, 0k highmem)
&lt;7&gt;Calibrating delay loop... 81.92 BogoMIPS (lpj=40960)
&lt;4&gt;Mount-cache hash table entries: 512
&lt;4&gt;Checking for &#039;wait&#039; instruction...  unavailable.
&lt;6&gt;NET: Registered protocol family 16
&lt;4&gt;PCI: fixing up bridge
&lt;7&gt;PCI: Setting latency timer of device 0000:01:00.0 to 64
&lt;4&gt;PCI: Fixing up device 0000:01:00.0
&lt;6&gt;NET: Registered protocol family 2
&lt;4&gt;IP route cache hash table entries: 128 (order: -3, 512 bytes)
&lt;4&gt;TCP established hash table entries: 512 (order: -1, 2048 bytes)
&lt;4&gt;TCP bind hash table entries: 256 (order: -2, 1024 bytes)
&lt;6&gt;TCP: Hash tables configured (established 512 bind 256)
&lt;6&gt;TCP reno registered
&lt;6&gt;squashfs: version 3.0 (2006/03/15) Phillip Lougher
&lt;6&gt;devfs: 2004-01-31 Richard Gooch (rgooch@atnf.csiro.au)
&lt;6&gt;devfs: boot_options: 0x1
&lt;6&gt;JFFS2 version 2.2. (NAND) (C) 2001-2003 Red Hat, Inc.
&lt;6&gt;Initializing Cryptographic API
&lt;6&gt;io scheduler noop registered
&lt;6&gt;io scheduler deadline registered (default)
&lt;6&gt;Serial: 8250/16550 driver $Revision: 1.90 $ 2 ports, IRQ sharing disabled
&lt;6&gt;b44.c:v1.00 (Apr 7, 2006)
&lt;4&gt;PCI: Enabling device 0000:00:02.0 (0000 -&gt; 0002)
&lt;7&gt;PCI: Setting latency timer of device 0000:00:02.0 to 64
&lt;6&gt;eth0: Broadcom 47xx 10/100BaseT Ethernet 00:90:96:45:03:ee
&lt;4&gt;PCI: Enabling device 0000:00:08.0 (0000 -&gt; 0002)
&lt;7&gt;PCI: Setting latency timer of device 0000:00:08.0 to 64
&lt;6&gt;eth1: Broadcom 47xx 10/100BaseT Ethernet 00:90:96:45:03:ef
&lt;6&gt;Physically mapped flash: Found 1 x16 devices at 0x0 in 16-bit bank
&lt;4&gt; Amd/Fujitsu Extended Query Table at 0x0040
&lt;5&gt;number of CFI chips: 1
&lt;5&gt;cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
&lt;5&gt;Flash device: 0x400000 at 0x1fc00000
&lt;5&gt;bootloader size: 262144
&lt;6&gt;Physically mapped flash: Filesystem type: jffs2
&lt;4&gt;Updating TRX offsets and length:
&lt;4&gt;old trx = [0x0000001c, 0x000008ec, 0x000b0000], len=0x001c1000 crc32=0x20f84c88
&lt;4&gt;new trx = [0x0000001c, 0x000008ec, 0x000b0000], len=0x000b0000 crc32=0xf2a71dc0
&lt;4&gt;Done
&lt;5&gt;Creating 4 MTD partitions on &quot;Physically mapped flash&quot;:
&lt;5&gt;0x00000000-0x00040000 : &quot;cfe&quot;
&lt;5&gt;0x00040000-0x003f0000 : &quot;linux&quot;
&lt;5&gt;0x000f0000-0x003f0000 : &quot;rootfs&quot;
&lt;5&gt;0x003f0000-0x00400000 : &quot;nvram&quot;
&lt;4&gt;ip_conntrack version 2.4 (128 buckets, 1024 max) - 236 bytes per conntrack
&lt;4&gt;ip_tables: (C) 2000-2006 Netfilter Core Team
&lt;6&gt;TCP vegas registered
&lt;6&gt;NET: Registered protocol family 1
&lt;6&gt;NET: Registered protocol family 17
&lt;6&gt;802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
&lt;6&gt;All bugs added by David S. Miller &lt;davem@redhat.com&gt;
&lt;4&gt;jffs2_scan_eraseblock(): End of filesystem marker found at 0x110000
&lt;4&gt;jffs2_build_filesystem(): unlocking the mtd device... done.
&lt;4&gt;jffs2_build_filesystem(): erasing all blocks after the end marker... done.
&lt;4&gt;VFS: Mounted root (jffs2 filesystem) readonly.
&lt;6&gt;Mounted devfs on /dev
&lt;6&gt;Freeing unused kernel memory: 128k freed
&lt;4&gt;Warning: unable to open an initial console.
&lt;4&gt;Algorithmics/MIPS FPU Emulator v1.5
&lt;6&gt;b44: eth0: Link is up at 100 Mbps, full duplex.
&lt;6&gt;b44: eth0: Flow control is off for TX and off for RX.
&lt;4&gt;Probing device eth0: No Robo switch in managed mode found
&lt;4&gt;Probing device eth1: No Robo switch in managed mode found
&lt;4&gt;Probing device eth2: No such device
&lt;4&gt;Probing device eth3: No such device
&lt;4&gt;BFL_ENETADM not set in boardflags. Use force=1 to ignore.</code></pre></div><p>I am still unable to get a ping with a latest svn, will keep looking on the trunks to find what change broke the wrc-1000 network and when.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35505">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						16 Oct 2006, 19:10					</div>
				</div>
				<div class="post-content content">
					<p>Ok, when i watch the thing with tcpdump, i occasionally get data corruption in some packets. Seems like it&#039;s the CPU data cache again</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35506">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						16 Oct 2006, 20:12					</div>
				</div>
				<div class="post-content content">
					<p>Fixed in r5163</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35507">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						16 Oct 2006, 20:40					</div>
				</div>
				<div class="post-content content">
					<p>svn #4899 is a go while on the svn #4900 the network does not respond on the wrc-1000.&nbsp; The responsible change is on the target/Config.in with the &quot;move BIG_ENDIAN selection to arch configs&quot; update.&nbsp; Here is a diff:</p><div class="codebox"><pre><code>diff -Nur trunk-4899/target/Config.in trunk-4900/target/Config.in
--- trunk-4899/target/Config.in 2006-10-16 19:53:53.000000000 +0300
+++ trunk-4900/target/Config.in 2006-10-16 19:54:52.000000000 +0300
@@ -19,7 +19,6 @@
        select LINUX_2_6
        select PCI_SUPPORT
        select USB_SUPPORT
-       select BIG_ENDIAN
        select USES_JFFS2
        help
           Build firmware images for Aruba boards
@@ -29,7 +28,6 @@
        depends BROKEN
        select mips
        select LINUX_2_4
-       select BIG_ENDIAN
        select USES_JFFS2
        help
          Build firmware images for Atheros AR531x based boards
@@ -82,7 +80,6 @@
        bool &quot;Intel XScale [2.6]&quot;
        select armeb
        select LINUX_2_6
-       select BIG_ENDIAN
        select PCI_SUPPORT
        select USB_SUPPORT
        select USES_JFFS2
@@ -91,7 +88,6 @@
        bool &quot;Magicbox [2.6]&quot;
        select powerpc
        select LINUX_2_6
-       select BIG_ENDIAN
        select PCI_SUPPORT
        select USES_JFFS2

@@ -169,7 +165,6 @@
        bool &quot;UNSUPPORTED big-endian sh3 platform&quot;
        depends BROKEN
        select LINUX_2_6
-       select BIG_ENDIAN
        select sh3eb

 config LINUX_2_6_SH4
@@ -182,14 +177,12 @@
        bool &quot;UNSUPPORTED big-endian sh4 platform&quot;
        depends BROKEN
        select LINUX_2_6
-       select BIG_ENDIAN
        select sh4eb

 config LINUX_2_6_SPARC
        bool &quot;UNSUPPORTED sparc platform&quot;
        depends BROKEN
        select LINUX_2_6
-       select BIG_ENDIAN
        select sparc

 endif
@@ -229,6 +222,7 @@
        bool

 config mips
+       select BIG_ENDIAN
        bool

 config mipsel
@@ -238,6 +232,7 @@
        bool

 config armeb
+       select BIG_ENDIAN
        bool

 config cris
@@ -247,21 +242,25 @@
        bool

 config powerpc
+       select BIG_ENDIAN
        bool

 config sh3
        bool

 config sh3eb
+       select BIG_ENDIAN
        bool

 config sh4
        bool

 config sh4eb
+       select BIG_ENDIAN
        bool

 config sparc
+       select BIG_ENDIAN
        bool

 config ARCH</code></pre></div><p>I will check the latest brcm-2.6 patches and get back to you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35510">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						16 Oct 2006, 21:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nbd wrote:</cite><blockquote><p>Fixed in r5163</p></blockquote></div><p>confirmed the fix.&nbsp; ping -s 65507 192.168.1.1 works like a charm !!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35511">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						16 Oct 2006, 22:48					</div>
				</div>
				<div class="post-content content">
					<p>The above changeset can&#039;t be responsible for the problem. That doesn&#039;t make any sense</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35552">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						17 Oct 2006, 16:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nbd wrote:</cite><blockquote><p>The above changeset can&#039;t be responsible for the problem. That doesn&#039;t make any sense</p></blockquote></div><p>my bad, a confusion with patches.&nbsp; digging little more into this I was able to get a latest svn work on the wrc-1000 by reverting the package/base-files/Makefile file from version #4914 to an earlier version #4855.&nbsp; I did this couple of times just to make sure this is not a hoax.&nbsp; here is the diff of that Makefile:<br /></p><div class="codebox"><pre><code>diff -Nur --exclude=&#039;\.svn&#039; trunk-4913/package/base-files/Makefile trunk-4914/package/base-files/Makefile
--- trunk-4913/package/base-files/Makefile      2006-10-17 15:26:11.000000000 +0300
+++ trunk-4914/package/base-files/Makefile      2006-10-17 15:28:45.000000000 +0300
@@ -4,7 +4,7 @@
 # This is free software, licensed under the GNU General Public License v2.
 # See /LICENSE for more information.
 #
-# $Id: Makefile 4855 2006-09-24 20:49:31Z nico $
+# $Id: Makefile 4914 2006-10-04 20:03:26Z nbd $

 include $(TOPDIR)/rules.mk
 include $(INCLUDE_DIR)/kernel.mk
@@ -142,7 +142,6 @@
 endef

 define Package/base-files$(TARGET)/install
-  $(call Package/base-files$(TARGET)/install-$(BOARD),$(1))
        $(CP) ./default/* $(1)/
        if [ -d $(BOARD)-$(KERNEL) ]; then \
                $(CP) $(BOARD)-$(KERNEL)/* $(1)/; \
@@ -164,6 +163,7 @@
        rm -f $(1)/var
        ln -sf /tmp $(1)/var
        mkdir -p $(1)/etc
+$(call Package/base-files$(TARGET)/install-$(BOARD),$(1))
 endef

 define Package/libgcc/install</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35554">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						17 Oct 2006, 16:53					</div>
				</div>
				<div class="post-content content">
					<p>OK. That makes more sense. After that changeset it doesn&#039;t use the static /etc/config/network but the dynamically generated one that uses nvram for hardware detection.<br />Please give me an nvram dump of your device so that I can fix the hardware detection.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35568">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						17 Oct 2006, 19:55					</div>
				</div>
				<div class="post-content content">
					<p>had to boot a kamikaze 2.4 kernel on wrc-1000 since there is no /dev/nvram device on the 2.6 branch. here is the nvram dump:</p><div class="codebox"><pre><code>strings /dev/nvram  | sort

%et0macaddr=00:90:96:00:00:01
%et1macaddr=00:90:96:00:00:02
BridgeFlag=0
IEEE1x_force_auth=1
IEEE1x_key_change_period=15
IEEE1x_key_dis_en=0
IEEE1x_key_dis_len=5
IEEE1x_mode=0
IEEE1x_rs1_en=0
IEEE1x_rs1_host=0.0.0.0
IEEE1x_rs1_port=1812
IEEE1x_rs1_ss=
IEEE1x_rs1_timeout=5
IEEE1x_rs2_en=0
IEEE1x_rs2_host=0.0.0.0
IEEE1x_rs2_port=1812
IEEE1x_rs2_ss=
IEEE1x_rs2_timeout=5
IEEE1x_rs3_en=0
IEEE1x_rs3_host=0.0.0.0
IEEE1x_rs3_port=1812
IEEE1x_rs3_ss=
IEEE1x_rs3_timeout=5
IEEE1x_rs4_en=0
IEEE1x_rs4_port=1812
IEEE1x_rs4_ss=
IEEE1x_rs4_timeout=5
NatFlag=1
WLAN_AUTHENTICATION_MODE=open
WLAN_BEACON_INTERVAL=100
WLAN_CHANNEL_ID=10
WLAN_FRAGMENTATION_THRESHOLD=2346
WLAN_MAC_ACCESS_CONTROL=0
WLAN_MAC_ALLOW_LIST=
WLAN_MAX_POLLINGS=10
WLAN_NAME=WRC-1000_AP
WLAN_RTS_THRESHOLD=2346
WLAN_SSID=WRC_Network
WLAN_SUPPORT_RATE=0f
WLAN_WEP_DROP_UNENCRYPTED=0
WLAN_WEP_FORMAT=ascii
WLAN_WEP_KEY1=
WLAN_WEP_KEY2=
WLAN_WEP_KEY3=
WLAN_WEP_KEY4=
WLAN_WEP_KEY_ID=1
WLAN_WEP_MODE=0
aip_finder_en=0
boardtype=bcm94710r4
boot_flash_addr=bfc00000
boot_wait=on
burnin=0
clkfreq=125
console_loglevel=1
count_lan_emac_loopback_ok=2
d11b_bcn=100
d11b_channel=11
d11b_dtim=3
d11b_frag=1536
d11b_rate=0
d11b_rateset=default
def_et1macaddr=00:90:96:45:03:EF
default_dhcp_end=192.168.10.150
default_dhcp_start=192.168.10.100
default_lan_dhcp_client_br=0
default_lan_dhcp_client_nat=0
default_lan_gateway=192.168.10.1
default_lan_ipaddr=192.168.10.1
default_lan_netmask=255.255.255.0
default_lan_proto_br=static
default_lan_proto_nat=dhcp
default_policy=0
dhcp_end=192.168.10.150
dhcp_lease=72
dhcp_start=192.168.10.100
dl_ram_addr=a0001000
dmz_ipaddr=
dos_enable=1
et0macaddr=00:90:96:45:03:EE
et0mdcport=0
et0phyaddr=30
et1defaultmac=00:90:96:00:00:02
et1macaddr=00:90:96:45:03:EF
et1mdcport=1
filter_enable=1
firewall_enable=1
fw_reset=0
fwt=
fwu=
http_lanport=80
http_passwd=password
http_username=admin
http_wan_enable=0
http_wanport=80
i6fw_en=1
i6fw_fuji_en=1
i6fw_il=
i6fw_ip_filt=0
i6fw_mac_filt=0
i6fw_ml=
i6fw_pos=0
i6fw_tcp_filt=0
i6fw_tl=
i6fw_udp_filt=0
i6fw_ul=
i6fw_wan_en=1
i6fw_wan_il=
i6fw_wan_ip_filt=0
i6fw_wan_tl=
i6fw_wan_udp_filt=0
i6fw_wan_ul=
i6fw_wping_en=0
i6fw_wprot_en=1
ip_filter=0
ipv6_enable=0
ipv6_if_id=
ipv6_lan_ipaddr=
ipv6_lan_prefix=
ipv6_lan_prelen=64
ipv6_mode=ipv4tunneling
ipv6_radv_enable=1
ipv6_radv_prefix=
ipv6_wan_gateway=
ipv6_wan_if_id=
ipv6_wan_ipaddr=
ipv6_wan_prefix=
ipv6_wan_prelen=64
ipv6_wan_tunneling_end_ip=
kernel_mods=et wlan
lan_dhcp_client=0
lan_dns=
lan_gateway=192.168.10.1
lan_hwaddr=00:90:96:45:03:EE
lan_hwnames=et0 il0 wl0 wl1
lan_ifname=br0
lan_ifnames=eth0 wlan0
lan_ipaddr=192.168.10.1
lan_netmask=255.255.255.0
lan_proto=static
lan_stp=0
log_level=0
log_tftp=0
log_tftp_server=0.0.0.0
m_lan_gateway=192.168.10.1
m_lan_ipaddr=192.168.10.1
m_lan_netmask=255.255.255.0
m_wan_dns=
m_wan_domain=
m_wan_gateway=0.0.0.0
m_wan_hostname=
m_wan_ipaddr=0.0.0.0
m_wan_netmask=0.0.0.0
m_wan_wins=
mac_filter=0
netbios_enable=0
ntp_enable=0
ntp_server=0.0.0.0
ntp_sync_interval=24
ntp_timezone=0
os_flash_addr=bfc40000
os_name=linux
os_ram_addr=80001000
os_server=
os_version=1.07.03a-C024a
pmon_ver=1.03.00
pppoe_auth_mode=auto
pppoe_demand=0
pppoe_idletime=300
pppoe_idletime_min=5
pppoe_ifname=eth1
pppoe_keepalive=0
pppoe_mode=0
pppoe_mru=1454
pppoe_mtu=1454
pppoe_passwd=
pppoe_username=
restore_defaults=0
scratch=a0180000
sdram_config=0x0000
sdram_init=0x0419
sdram_ncdl=0x00000000
sdram_refresh=0x8040
static_route=
stats_server=
tcp_filter=0
time_zone=PST8PDT
timer_interval=3600
udp_filter=0
upnp_enable=1
upnp_uuid=f81f
user_conf_ver=1.01
user_time_dd=01
user_time_hr=00
user_time_mn=00
user_time_mo=01
user_time_update=0
user_time_yr=1970
wan_device=vlan1
wan_dns=
wan_domain=
wan_gateway=0.0.0.0
wan_hostname=
wan_hwaddr=00:90:96:45:03:EF
wan_hwname=et1
wan_ifname=eth1
wan_ifnames=
wan_ipaddr=0.0.0.0
wan_lease=864000
wan_netmask=0.0.0.0
wan_ping=0
wan_proto=none
wan_wins=
wl0_infra=1
wl0_mode=ap
wl0_radio=1
wl0_ssid=OpenWrt
wl_auth=0
wl_country=USA
wl_key1=
wl_key2=
wl_key3=
wl_key4=
wl_key=1
wl_mac=
wl_ssid=Broadcom
wl_wep=off</code></pre></div>											<p class="post-edited">(Last edited by <strong>acoul</strong> on 17 Oct 2006, 19:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35570">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						17 Oct 2006, 20:07					</div>
				</div>
				<div class="post-content content">
					<p>Please try r5192</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35575">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						17 Oct 2006, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>No go :-(<br /></p><div class="codebox"><pre><code>svn co https://svn.openwrt.org/openwrt/trunk/
cd trunk
rm -r build_mipsel/linux*  
make menuconfig
make V=99</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35576">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						17 Oct 2006, 21:29					</div>
				</div>
				<div class="post-content content">
					<p>did you do make package/base-files-clean? or was it a fresh checkout?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35585">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						17 Oct 2006, 22:30					</div>
				</div>
				<div class="post-content content">
					<p>the make package/base-files-clean didn&#039;t do the trick either.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35692">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						19 Oct 2006, 13:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nbd wrote:</cite><blockquote><p>OK. That makes more sense. After that changeset it doesn&#039;t use the static /etc/config/network but the dynamically generated one that uses nvram for hardware detection.<br />Please give me an nvram dump of your device so that I can fix the hardware detection.</p></blockquote></div><p>does this change mean that NVRAM will not be completely abandoned for the kamikaze branch as stated <a href="http://wiki.openwrt.org/OpenWrtDocs/KamikazeConfiguration?highlight=%28kamikaze%29">here</a>:<br /></p><div class="quotebox"><blockquote><p>In the early days of OpenWRT, the only target platforms were the WRT54G and similar Broadcom based routers. This platform had an NVRAM (much like high end, commercial routers) to store configuration information. Up until White Russian, OpenWRT used NVRAM for configuration. As OpenWRT expanded to new platforms without NVRAM, NVRAM was abandoned in favor of configuration files in /etc/config. This configuration method presents related information in the same area and is much like existing *nix configuration files.</p></blockquote></div><p>why was this change necessary ? Building a clean latest kamikaze svn, wrc-1000 is unable to respond to the 192.168.1.1.&nbsp; Using a package/base-files/Makefile from the #4913 trunk solves this problem as mentioned above.</p><p>the only thing that comes to mind when looking at the paste of the openwrt trac updates from nbd is the folowing: you are a machine !!</p><p>this is the dmesg output when going from an unsuccessful svn flash to a successful one with the above hack:<br /></p><div class="codebox"><pre><code>&lt;5&gt;Linux version 2.6.17 (root@saloon) (gcc version 3.4.6 (OpenWrt-2.0)) #1 Thu Oct 19 13:18:35 EEST 2006
&lt;4&gt;CPU revision is: 00024000
&lt;4&gt;Determined physical RAM map:
&lt;4&gt; memory: 01000000 @ 00000000 (usable)
&lt;7&gt;On node 0 totalpages: 4096
&lt;7&gt;  DMA zone: 4096 pages, LIFO batch:0
&lt;4&gt;Built 1 zonelists
&lt;5&gt;Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,115200
&lt;4&gt;Enabling BCM4710A0 cache workarounds.
&lt;4&gt;Primary instruction cache 8kB, physically tagged, 2-way, linesize 16 bytes.
&lt;4&gt;Primary data cache 4kB, 2-way, linesize 16 bytes.
&lt;4&gt;Synthesized TLB refill handler (20 instructions).
&lt;4&gt;Synthesized TLB load handler fastpath (31 instructions).
&lt;4&gt;Synthesized TLB store handler fastpath (31 instructions).
&lt;4&gt;Synthesized TLB modify handler fastpath (30 instructions).
&lt;4&gt;PID hash table entries: 128 (order: 7, 512 bytes)
&lt;4&gt;Using 62.400 MHz high precision timer.
&lt;4&gt;Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)
&lt;4&gt;Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)
&lt;6&gt;Memory: 13748k/16384k available (1923k kernel code, 2636k reserved, 264k data, 128k init, 0k highmem)
&lt;7&gt;Calibrating delay loop... 81.66 BogoMIPS (lpj=40832)
&lt;4&gt;Mount-cache hash table entries: 512
&lt;4&gt;Checking for &#039;wait&#039; instruction...  unavailable.
&lt;6&gt;NET: Registered protocol family 16
&lt;4&gt;PCI: fixing up bridge
&lt;7&gt;PCI: Setting latency timer of device 0000:01:00.0 to 64
&lt;4&gt;PCI: Fixing up device 0000:01:00.0
&lt;6&gt;NET: Registered protocol family 2
&lt;4&gt;IP route cache hash table entries: 128 (order: -3, 512 bytes)
&lt;4&gt;TCP established hash table entries: 512 (order: -1, 2048 bytes)
&lt;4&gt;TCP bind hash table entries: 256 (order: -2, 1024 bytes)
&lt;6&gt;TCP: Hash tables configured (established 512 bind 256)
&lt;6&gt;TCP reno registered
&lt;6&gt;squashfs: version 3.0 (2006/03/15) Phillip Lougher
&lt;6&gt;devfs: 2004-01-31 Richard Gooch (rgooch@atnf.csiro.au)
&lt;6&gt;devfs: boot_options: 0x1
&lt;6&gt;JFFS2 version 2.2. (NAND) (C) 2001-2003 Red Hat, Inc.
&lt;6&gt;Initializing Cryptographic API
&lt;6&gt;io scheduler noop registered
&lt;6&gt;io scheduler deadline registered (default)
&lt;6&gt;Serial: 8250/16550 driver $Revision: 1.90 $ 2 ports, IRQ sharing disabled
&lt;6&gt;b44.c:v1.00 (Apr 7, 2006)
&lt;4&gt;PCI: Enabling device 0000:00:02.0 (0000 -&gt; 0002)
&lt;7&gt;PCI: Setting latency timer of device 0000:00:02.0 to 64
&lt;6&gt;eth0: Broadcom 47xx 10/100BaseT Ethernet 00:90:96:45:03:ee
&lt;4&gt;PCI: Enabling device 0000:00:08.0 (0000 -&gt; 0002)
&lt;7&gt;PCI: Setting latency timer of device 0000:00:08.0 to 64
&lt;6&gt;eth1: Broadcom 47xx 10/100BaseT Ethernet 00:90:96:45:03:ef
&lt;6&gt;Physically mapped flash: Found 1 x16 devices at 0x0 in 16-bit bank
&lt;4&gt; Amd/Fujitsu Extended Query Table at 0x0040
&lt;5&gt;number of CFI chips: 1
&lt;5&gt;cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
&lt;5&gt;Flash device: 0x400000 at 0x1fc00000
&lt;5&gt;bootloader size: 262144
&lt;6&gt;Physically mapped flash: Filesystem type: jffs2
&lt;4&gt;Updating TRX offsets and length:
&lt;4&gt;old trx = [0x0000001c, 0x000008ec, 0x000b0000], len=0x001c1000 crc32=0xd5dd5b23
&lt;4&gt;new trx = [0x0000001c, 0x000008ec, 0x000b0000], len=0x000b0000 crc32=0x60ae7d85
&lt;4&gt;Done
&lt;5&gt;Creating 4 MTD partitions on &quot;Physically mapped flash&quot;:
&lt;5&gt;0x00000000-0x00040000 : &quot;cfe&quot;
&lt;5&gt;0x00040000-0x003f0000 : &quot;linux&quot;
&lt;5&gt;0x000f0000-0x003f0000 : &quot;rootfs&quot;
&lt;5&gt;0x003f0000-0x00400000 : &quot;nvram&quot;
&lt;4&gt;ip_conntrack version 2.4 (128 buckets, 1024 max) - 236 bytes per conntrack
&lt;4&gt;ip_tables: (C) 2000-2006 Netfilter Core Team
&lt;6&gt;TCP vegas registered
&lt;6&gt;NET: Registered protocol family 1
&lt;6&gt;NET: Registered protocol family 17
&lt;6&gt;802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
&lt;6&gt;All bugs added by David S. Miller &lt;davem@redhat.com&gt;
&lt;4&gt;jffs2_scan_eraseblock(): End of filesystem marker found at 0x110000
&lt;4&gt;jffs2_build_filesystem(): unlocking the mtd device... done.
&lt;4&gt;jffs2_build_filesystem(): erasing all blocks after the end marker... done.
&lt;4&gt;VFS: Mounted root (jffs2 filesystem) readonly.
&lt;6&gt;Mounted devfs on /dev
&lt;6&gt;Freeing unused kernel memory: 128k freed
&lt;4&gt;Warning: unable to open an initial console.
&lt;4&gt;Algorithmics/MIPS FPU Emulator v1.5
&lt;6&gt;b44: eth0: Link is up at 100 Mbps, full duplex.
&lt;6&gt;b44: eth0: Flow control is off for TX and off for RX.</code></pre></div>											<p class="post-edited">(Last edited by <strong>acoul</strong> on 19 Oct 2006, 14:00)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>