<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Which file to use to restore router-station to openwrt defaults</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p152107">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">perazim</div>
					<div class="post-datetime">
						26 Dec 2011, 16:16					</div>
				</div>
				<div class="post-content content">
					<p>I have an ubiquiti router-station that was running an image I build from branch. Then I added https support to luci and rebuilt and used the web method to do an upgrade. Could no longer get http or https access. Tried a number of other things after that with no joy.</p><p>Now I am trying to get the router-station back to a known state. I have rolled back the config and rebuilt. Part of my confusion deals with exactly which image to use and the proper method to get the jffs part of the flash reset now that I have no web access.</p><p>My backfire/bin/ar71xx/ looks like:</p><p>[root@travelmate ar71xx]# ls -l<br />total 147428<br />-rw-r--r--. 1 yossi yossi&nbsp; &nbsp; &nbsp;1305 Dec 26 12:58 md5sums<br />-rw-r--r--. 1 yossi yossi&nbsp; 5039626 Dec 26 12:57 openwrt-ar71xx-rootfs.tar.gz<br />-rw-r--r--. 1 yossi yossi&nbsp; 6684672 Dec 26 12:57 openwrt-ar71xx-root.jffs2-128k<br />-rw-r--r--. 1 yossi yossi&nbsp; 6553600 Dec 26 12:57 openwrt-ar71xx-root.jffs2-64k<br />-rw-r--r--. 1 yossi yossi&nbsp; 4194304 Dec 26 12:57 openwrt-ar71xx-root.squashfs<br />-rw-r--r--. 1 yossi yossi&nbsp; 4071428 Dec 26 12:57 openwrt-ar71xx-root.squashfs-4k<br />-rw-r--r--. 1 yossi yossi&nbsp; 7471512 Dec 26 12:57 openwrt-ar71xx-ubnt-rs-jffs2-factory.bin<br />-rw-r--r--. 1 yossi yossi&nbsp; 7536640 Dec 26 12:57 openwrt-ar71xx-ubnt-rs-jffs2-sysupgrade.bin<br />-rw-r--r--. 1 yossi yossi&nbsp; 5112216 Dec 26 12:58 openwrt-ar71xx-ubnt-rs-squashfs-factory.bin<br />-rw-r--r--. 1 yossi yossi&nbsp; 5177344 Dec 26 12:58 openwrt-ar71xx-ubnt-rs-squashfs-sysupgrade.bin<br />-rw-r--r--. 1 yossi yossi&nbsp; 1199609 Dec 26 12:57 openwrt-ar71xx-uImage-gzip.bin<br />-rw-r--r--. 1 yossi yossi&nbsp; &nbsp;864246 Dec 26 12:57 openwrt-ar71xx-uImage-lzma.bin<br />-rwxr-xr-x. 1 yossi yossi&nbsp; 2660668 Dec 26 12:57 openwrt-ar71xx-vmlinux.bin<br />-rwxr-xr-x. 1 yossi yossi&nbsp; 2727060 Dec 26 12:57 openwrt-ar71xx-vmlinux.elf<br />-rw-r--r--. 1 yossi yossi&nbsp; 1245184 Dec 26 12:57 openwrt-ar71xx-vmlinux.gz<br />-rw-r--r--. 1 yossi yossi&nbsp; &nbsp;917504 Dec 26 12:57 openwrt-ar71xx-vmlinux.lzma<br />-rw-r--r--. 1 yossi yossi 38512613 Dec 16 21:08 OpenWrt-ImageBuilder-ar71xx-for-Linux-i686.tar.bz2<br />-rw-r--r--. 1 yossi yossi 37440691 Dec 16 21:07 OpenWrt-SDK-ar71xx-for-Linux-i686-gcc-4.3.3+cs_uClibc-0.9.30.1.tar.bz2<br />-rw-r--r--. 1 yossi yossi 13551494 Dec 16 21:09 OpenWrt-Toolchain-ar71xx-for-mips_r2-gcc-4.3.3+cs_uClibc-0.9.30.1.tar.bz2<br />drwxr-xr-x. 2 yossi yossi&nbsp; &nbsp; 12288 Dec 26 12:55 packages<br />[root@travelmate ar71xx]# </p><p>Thanks in advance.</p><p>Perazim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152113">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						26 Dec 2011, 17:16					</div>
				</div>
				<div class="post-content content">
					<p>mtd -r erase rootfs_data</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152114">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">perazim</div>
					<div class="post-datetime">
						26 Dec 2011, 17:29					</div>
				</div>
				<div class="post-content content">
					<p>root@OpenWrt:~# mtd -r erase rootfs_data<br />Could not open mtd device: rootfs_data<br />Could not open mtd device: rootfs_data<br />root@OpenWrt:~# </p><br /><p>Do I need to unlock the device before erasing?</p><p>Thanks,</p><p>Perazim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152116">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						26 Dec 2011, 17:41					</div>
				</div>
				<div class="post-content content">
					<p>In this case you&#039;re out of luck since you most likely installed a JFFS2 image. You can only reflash from here on.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152118">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">perazim</div>
					<div class="post-datetime">
						26 Dec 2011, 18:20					</div>
				</div>
				<div class="post-content content">
					<p>OK.</p><p>Thanks for reply.</p><p>Can you please explain the difference between these four files and their purposes in the scheme&nbsp; of openwrt things? I Have read the articles about flash layout and the different filesystems used. I am having trouble understanding when to use what firmware file:</p><p>-rw-r--r--. 1 yossi yossi&nbsp; 7471512 Dec 26 12:57 openwrt-ar71xx-ubnt-rs-jffs2-factory.bin<br />-rw-r--r--. 1 yossi yossi&nbsp; 7536640 Dec 26 12:57 openwrt-ar71xx-ubnt-rs-jffs2-sysupgrade.bin<br />-rw-r--r--. 1 yossi yossi&nbsp; 5112216 Dec 26 12:58 openwrt-ar71xx-ubnt-rs-squashfs-factory.bin<br />-rw-r--r--. 1 yossi yossi&nbsp; 5177344 Dec 26 12:58 openwrt-ar71xx-ubnt-rs-squashfs-sysupgrade.bin</p><br /><p>Thanks,</p><p>Perazim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152120">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						26 Dec 2011, 19:06					</div>
				</div>
				<div class="post-content content">
					<p>You always want squashfs images. Factory is for the bootloader, sysupgrade is for OpenWrt updates.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152126">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">perazim</div>
					<div class="post-datetime">
						26 Dec 2011, 20:56					</div>
				</div>
				<div class="post-content content">
					<p>Do I correctly understand that the first time openwrt is installed on a device that still has the original factory firmware installed that the &quot;factory&quot; variant should be used (because the original bootloader is replaced?) and that all subsequent updates should use &quot;updates&quot; ?</p><p>Thanks,</p><p>Perazim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152153">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">perazim</div>
					<div class="post-datetime">
						27 Dec 2011, 10:58					</div>
				</div>
				<div class="post-content content">
					<p>When trying to rollback to earlier firmware, I get this error:</p><p>[yossi@travelmate ar71xx]$ tftp 192.168.1.20 -m binary -c put openwrt-ar71xx-ubnt-rs-squashfs-sysupgrade.bin<br />Error code 2: Invalid firmware file<br />[yossi@travelmate ar71xx]$ </p><p>Thanks,</p><p>Perazim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152168">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">rolf2</div>
					<div class="post-datetime">
						27 Dec 2011, 14:52					</div>
				</div>
				<div class="post-content content">
					<p>sysupgrade is for web flash , factory - for tftp .</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152169">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">robrob</div>
					<div class="post-datetime">
						27 Dec 2011, 14:59					</div>
				</div>
				<div class="post-content content">
					<p>perazim, can you get the routerstation into failsafe upload mode by:</p><br /><p>Hold reset switch for 12 seconds while powering on router, RF led should light.<br />Use tftp to transfer, the commands are as follows:</p><p>in Windows: (Control Panel/Programs/Enable Windows features/tftp client)<br />&nbsp; &nbsp; cd&nbsp; Desktop (put file to be uploaded on your desktop)<br />&nbsp; &nbsp; tftp -i 192.168.1.8 put openwrt-ar71xx-generic-ubnt-rspro-squashfs-factory.bin<br />&nbsp; &nbsp; <br />on a Linux pc: (install tftp-hpa client)<br />&nbsp; &nbsp; user@box:$ cd /var/tftpd (place file in this directory)<br />&nbsp; &nbsp; user@box:$ tftp 192.168.1.8<br />&nbsp; &nbsp; &gt; mode binary<br />&nbsp; &nbsp; &gt; put openwrt-ar71xx-generic-ubnt-rspro-squashfs-factory.bin<br />&nbsp; &nbsp; &gt;ctrl-z to end</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152240">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">perazim</div>
					<div class="post-datetime">
						28 Dec 2011, 12:06					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the help. Now that I understand which file to use, I can reflash with tftp OK. </p><p>After reboot just to make sure previous configs were gone I did:</p><p>mtd -r erase rootfs_data</p><p>After second reboot, I set the passwd and logged out and tried to access with ssh but access was denied due to passwd.</p><p>I remember that when you first set passwd you must wait a little bit so that ssh is set up. I did this but still cannot login with ssh.</p><p>I also cannot get http access to luci.</p><p>Update: This problem started during the development of a configuration for router-station where I was changing one feature at a time in menuconfig and rebuilding. I have now flashed the most recent backfire-10.03.1 from openwrt web site and eveything is fine with this firmware (but it doesn&#039;t have the features I need).</p><p>This means that either I have done something wrong in the configuring/building process OR there is some kind of bug that manifests when one uses stepwise development methods.</p><p>Here is what is done:</p><p>svn checkout svn://svn.openwrt.org/openwrt/branches/backfire</p><p>cd backfire</p><p>./scripts/feeds update -a</p><p>./scripts/feeds install -a</p><p>make menuconfig<br />(set target)</p><p>To correct little endian error in atheros builds on fedora systems:<br />HOST_LIB_PATH_bfd=/lib: make</p><p>Each time I add or change something using menuconfig, I then run HOST_LIB_PATH_bfd=/lib: make again.</p><p>It was when I enabled luci https access that things stopped working. When I rolled back this change, things still did not work to my surprise.</p><br /><p>Perazim</p>											<p class="post-edited">(Last edited by <strong>perazim</strong> on 28 Dec 2011, 12:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152244">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						28 Dec 2011, 12:38					</div>
				</div>
				<div class="post-content content">
					<p>Make sure busybox shadow password support is enabled in your trunk builds.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152250">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">perazim</div>
					<div class="post-datetime">
						28 Dec 2011, 14:00					</div>
				</div>
				<div class="post-content content">
					<p>busybox shadow password support was not set so I set it and rebuilt. Note this was not a trunk build but a backfire build. This time when I attempt to change the root passwd I get:</p><p>root@OpenWrt:/# passwd&nbsp; <br />passwd: no record of root in /etc/shadow, using /etc/passwd<br />Changing password for root<br />New password:<br />Bad password: too weak<br />Retype password:<br />passwd: cannot update password file /etc/shadow<br />root@OpenWrt:/# </p><br /><p>Perazim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152251">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">perazim</div>
					<div class="post-datetime">
						28 Dec 2011, 14:05					</div>
				</div>
				<div class="post-content content">
					<p>This problem is starting to have the subtle feeling of a build tool malfunction. I am using a fedora 14 system. I have already encountered a endian problem that requires the fix of: HOST_LIB_PATH_bfd=/lib: make. </p><p>Does anybody here think that it might be worth the time to try this on a debian system, assuming that it is debian that is used at openwrt?</p><p>Thanks,</p><p>Perazim</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>