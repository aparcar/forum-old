<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Choosing the DNS with a VPN (DHCP)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 12 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p224349">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">pepmater</div>
					<div class="post-datetime">
						2 Feb 2014, 16:30					</div>
				</div>
				<div class="post-content content">
					<p>Hello there,</p><p>I would like to specify a DNS for my WAN interface only, which gets an address in DHCP, and I cannot get it to work properly.<br />I have googled quite a lot, but I am getting really confused with all the different config files and what does what.</p><p>Here is a quick summary of my network:</p><p>ISP modem → (ethernet, DHCP) → openwrt router → (wireless AP, DHCP) → clients<br />There is only one ethernet port on my router, and I configured it as WAN.</p><p>There are two DNS defined on my openwrt router:</p><p>1) The WAN is using the ISP DNS, so the router can resolve the domain of the VPN to create the tunnel.<br />2) The LAN is using DNS accessible only within the VPN.<br />I have configured the LAN by editing the /etc/config/dhcp file which has defined the &quot;DNS forwarding&quot; section of the WEB gui.<br />I have changed the last three lines of the secion &#039;config dnsmasq&#039;<br />(/etc/config/dhcp : <a href="http://0bin.net/paste/GDKDBoxB5IvBa27l#zzEqqWADqlQfVjYBuiLb09pMBjBs/9r1//W/nS888CE=">http://0bin.net/paste/GDKDBoxB5IvBa27l# … W/nS888CE=</a> )</p><p>From a Client on the LAN, the DNS requests are going through the VPN (i.e. any traceroute, and websites that were censored before), so that is good.</p><p>→ Why, once I have ssh&#039;ed into the router, the traceroute shows that it goes through the VPN as well when I would expect it to go through the ISP&#039;s DNS?</p><p>→ How do I define static DNS for the WAN so that during the first initialisation of the VPN, I am sure that the domain can be resolved (I am not sure that every ISP I will use the router with will allow it). I have tried to add &quot;option dns &#039;194.132.32.32&#039;&quot; to the /etc/config/network but ended up with no domain resolving from the VPN.</p><p>Potential clue: the tests at <a href="http://dnsleaktest.com/">http://dnsleaktest.com/</a> do not work anymore from the clients: it just stays stuck on &quot;test in progress&quot;.</p><p>Any clue is welcome <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224386">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">pepmater</div>
					<div class="post-datetime">
						3 Feb 2014, 00:07					</div>
				</div>
				<div class="post-content content">
					<p>Well, thank you for that information <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> good to know, i was a bit lost with all the re-routing etc.</p><p>Just have to sort out the DNS for the initial connection, and i&#039;m good to go <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>