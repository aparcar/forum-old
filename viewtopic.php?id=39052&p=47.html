<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 47 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=45.html">45</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=46.html">46</a></li><li class="pagination-current"><span>47</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=48.html">48</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=49.html">49</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p265418">
				<div class="post-metadata">
					<div class="post-num">Post #1151</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						13 Feb 2015, 19:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>because of changing interface metrics dns request are no longer tunnelled but go directly through wan interface, i&#039;ve read wiki and there are possible solutions mentioned. <br />how to configure Option 3: Create user rules for traffic destined to &quot;private&quot; DNS servers to only exit the correct interface. ?</p><p>with dns set on client devices all is fine except that i need dns ad filtering on router</p></blockquote></div><p><a href="http://wiki.openwrt.org/doc/howto/mwan3#rule_configuration">http://wiki.openwrt.org/doc/howto/mwan3 … figuration</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p265452">
				<div class="post-metadata">
					<div class="post-num">Post #1152</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						14 Feb 2015, 00:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>mwan rules are configured and working. if i set dns 208.67.222.222 on my notebook dns requests go through l2tp tunnel, but if i set dns to 192.168.1.1 dns request go through wan</p><p>i need dnsmasq to forward dns requests through l2tp tunnel not through wan interface. maybe &quot;user rules&quot; reffer to iptables? or dnsmasq configuration?</p></blockquote></div><p>No it refers to mwan3 rules which is why I linked you the instructions on creating mwan3 rules.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p265472">
				<div class="post-metadata">
					<div class="post-num">Post #1153</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						14 Feb 2015, 12:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>mwan rules are configured and working. if i set dns 208.67.222.222 on my notebook dns requests go through l2tp tunnel, but if i set dns to 192.168.1.1 dns request go through wan</p><p>i need dnsmasq to forward dns requests through l2tp tunnel not through wan interface. maybe &quot;user rules&quot; reffer to iptables? or dnsmasq configuration?</p></blockquote></div><p>mwan3 rules also apply to router generated traffic. If you create a mwan3 rule for 208.67.222.222, it should work for lan clients as well as the router itself. If it does not work in your situation, we need to figure out why.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p265486">
				<div class="post-metadata">
					<div class="post-num">Post #1154</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						14 Feb 2015, 14:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>dns requests are sent from 10.2.0.75 regardless of wlan interface i&#039;m connected to</p></blockquote></div><p>The solution is a two parter. The first part is simple. First create a mwan3 rule for dns. If you add this dns rule below your current mwan3 rules your router will use all the l2tp interfaces for dns lookup.</p><div class="codebox"><pre><code>config rule &#039;dns&#039;
    option dest_ip &#039;208.67.222.222,208.67.220.220&#039;
    option proto &#039;all&#039;
    option use_policy &#039;balanced&#039;</code></pre></div><p>However mwan3 has no control over which source address is going to be used on the packets. That is completely in hands of kernel or application. You may need to nat this for this to work.</p><p>But i can suggest an alternative. I will assume here that all three l2tp connection traverse over your wwan interface. If you remove the option gateway form wwan interface and replace it with just a simple static routes to the xxx.xxx.xxx.xxx server(s), all your dns request from the router will now have the source ip address of the interface with the lowest gateway metric (in your case l2tp).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266160">
				<div class="post-metadata">
					<div class="post-num">Post #1155</div>
					<div class="post-author">miliford</div>
					<div class="post-datetime">
						19 Feb 2015, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>hello i hope someone can point me on what to do here:</p><p>current setup is openwrt with three wan </p><p>wan1 adsl line with metric 10 <br />wan2 wifi line with metric 20</p><p>i have this working with mwan loadbalancing fine</p><p>now to this i added my usb dongle as interface wwan where i can&#039;t set metric because it uses some weird qmi protocol i can use ip route and remove default route and add metric but that&#039;s beside the point because</p><p>i don&#039;t want to pass traffic on the wwan0 (usb-dongle)&nbsp; i want to run a openvpn tunnel over wwan0 and then loadbalance that tunnel<br /> i defined a tun0 interface as wan3 and set the openvpn client config with metric 30 </p><p>so currently wan adsl&nbsp; metric 10 <br />wan2 wifi metric 20<br />wan3 tun0 interface metric 30</p><br /><p>how to make the openvpn tunnel run only on the wwan0 interface ? the tunnel has to be on the wwan0 interface not the other interface </p><p>the routing table two default router from the&nbsp; </p><p>default 192.168.0.1 10 eth1<br />default&nbsp; 192.168.2.1 20 wlan0 <br />default&nbsp; *.*.*.*.*&nbsp; wwan0&nbsp; (can&#039;t set metric in luci or and network config it uses a qmi protocol from qualcom)</p><p>so my question is how to make the tunnel interface send the openvpn connect on tcp protocol only on the wwan0 interface and setup a tunnel endpoint i already set the config to set the appropirate metric of the tunnel interface and the ip in the client config i want to know how to send the tcp connection only on a specific interface&nbsp; with the routing table above</p>											<p class="post-edited">(Last edited by <strong>miliford</strong> on 19 Feb 2015, 21:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266161">
				<div class="post-metadata">
					<div class="post-num">Post #1156</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						19 Feb 2015, 21:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi miliford,</p><p>Your solution sounds perfectly doable. Just go ahead and if you run into something i will try to help. Basically you do what you already said yourself. Create the 4 interfaces in network config: adsl, wifi, usb-dongle and openvpn. Create a static route to openvpn gateway over usb-dongle. Create three default routes for adsl, wifi and openvpn. Create mwan3 interfaces for those default routes and you are good to go.</p><p>Good luck!</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 19 Feb 2015, 21:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266164">
				<div class="post-metadata">
					<div class="post-num">Post #1157</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						19 Feb 2015, 21:21					</div>
				</div>
				<div class="post-content content">
					<p>Lets assume here that your openvpn gateway has ip address 1.1.1.1. What i would do is remove default route from usb-dongle (wwan0) and add a static route: 1.1.1.1/32 via wwan0. Then the tunnel will always be setup over wwan0.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 19 Feb 2015, 21:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266166">
				<div class="post-metadata">
					<div class="post-num">Post #1158</div>
					<div class="post-author">miliford</div>
					<div class="post-datetime">
						19 Feb 2015, 21:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Lets assume here that your openvpn gateway has ip address 1.1.1.1. What i would do is remove default route from usb-dongle (wwan0) and add a static route: 1.1.1.1/32 via wwan0. Then the tunnel will always be setup over wwan0.</p></blockquote></div><p>will try it out thanks for your reply </p><p>just for kicks i am doing this because i noticed that the 4g provider that i&#039;m using allows udp 53 and 9201 to be unfiltered and unmetered&nbsp; the unfiltered part is interesting because i am not registered to any plans or have any balance&nbsp; and still there firewall allows a udp packet to any host in the internet so a udp tunnel with openvpn protocol is free 4g internet&nbsp; </p><p>udp 9201 is used by the old wap protocol so that is also left unfiltered but they do filter protocol so openvpn does not work&nbsp; other ssl-vpn like softether&nbsp; over udp 9201 or even another transport entirely like <a href="http://en.wikipedia.org/wiki/Datagram_Congestion_Control_Protocol">http://en.wikipedia.org/wiki/Datagram_C … l_Protocol</a> works provided you can find a protocol that uses that transport, pdproxy uses a custom one also not a custom transport</p>											<p class="post-edited">(Last edited by <strong>miliford</strong> on 19 Feb 2015, 21:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266167">
				<div class="post-metadata">
					<div class="post-num">Post #1159</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						19 Feb 2015, 21:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>miliford wrote:</cite><blockquote><p>just for kicks i am doing this because i noticed that the 4g provider that i&#039;m using allows udp 53 and 9201 to be unfiltered and unmetered&nbsp; the unfiltered part is interesting because i am not registered to any plans or have any balance&nbsp; and still there firewall allows a udp packet to any host in the internet so a udp tunnel with openvpn protocol is free 4g internet&nbsp; </p><p>udp 9201 is used by the old wap protocol so that is also left unfiltered but they do filter protocol so openvpn does not work&nbsp; other ssl-vpn like softether&nbsp; over udp 9201 or even another transport entirely like <a href="http://en.wikipedia.org/wiki/Datagram_Congestion_Control_Protocol">http://en.wikipedia.org/wiki/Datagram_C … l_Protocol</a> works provided you can find a protocol that uses that transport, pdproxy uses a custom one also not a custom transport</p></blockquote></div><p>Nice <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />. Would you mind sharing which provider that is? And while udp9201 does not work, does OpenVPN over udp53 work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266170">
				<div class="post-metadata">
					<div class="post-num">Post #1160</div>
					<div class="post-author">miliford</div>
					<div class="post-datetime">
						19 Feb 2015, 21:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>miliford wrote:</cite><blockquote><p>just for kicks i am doing this because i noticed that the 4g provider that i&#039;m using allows udp 53 and 9201 to be unfiltered and unmetered&nbsp; the unfiltered part is interesting because i am not registered to any plans or have any balance&nbsp; and still there firewall allows a udp packet to any host in the internet so a udp tunnel with openvpn protocol is free 4g internet&nbsp; </p><p>udp 9201 is used by the old wap protocol so that is also left unfiltered but they do filter protocol so openvpn does not work&nbsp; other ssl-vpn like softether&nbsp; over udp 9201 or even another transport entirely like <a href="http://en.wikipedia.org/wiki/Datagram_Congestion_Control_Protocol">http://en.wikipedia.org/wiki/Datagram_C … l_Protocol</a> works provided you can find a protocol that uses that transport, pdproxy uses a custom one also not a custom transport</p></blockquote></div><p>Nice <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />. Would you mind sharing which provider that is? And while udp9201 does not work, does OpenVPN over udp53 work?</p></blockquote></div><p>udp 53 has the most chance of working because the idiot network admins who set the firewall ,i think face a conflict they have to allow dns resolution to the providers page to notify them to reacharge, they could just configure the firewall to only allow udp packet to there dns servers and none of the outside ones but i guess none of the admins thought that was a bad idea., instead i noticed most opting for a protocol filter over the these open ports this is also a horrible idea because you can even create a tunnel with dns over 53 using the iodined tool which works both in relay (using the providers namerserver) or directly use a nameserver that you provide . in relay mode (talking to the isp nameservers speed with null queries is crap 20 kb at max) but if your lucky like me and can access any server on the internet your talking maximum speeds&nbsp; of the endpoint in the tunnel </p><p>the provider is asian a one&nbsp; if you live in&nbsp; asia (middle-east)&nbsp; tell me i can pm you (hoping for it to last lol)</p><p>the iodined tool <a href="http://code.kryo.se/iodine/README.html">http://code.kryo.se/iodine/README.html</a></p>											<p class="post-edited">(Last edited by <strong>miliford</strong> on 19 Feb 2015, 21:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266260">
				<div class="post-metadata">
					<div class="post-num">Post #1161</div>
					<div class="post-author">miliford</div>
					<div class="post-datetime">
						20 Feb 2015, 13:26					</div>
				</div>
				<div class="post-content content">
					<p>hey so i set it up correctly with two interface the wan and wwan ---tun0 tunnel&nbsp; and can ping fine but am not able to loadbalance</p><p>the mwan3 luci page show wan2 (tun0) down because it can&#039;t ping the gateway it&#039;s a point to point link&nbsp; but like i said i can ping through tun0 the tracking ip and anything on the internet both interface are pingable</p><p>is there anything special to do with mwan3 if one of the wan is virtual tun0 point to point link there </p><div class="codebox"><pre><code>tun0      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  
          inet addr:10.8.0.6  P-t-P:10.8.0.5  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:10 errors:0 dropped:0 overruns:0 frame:0
          TX packets:23 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100 
          RX bytes:840 (840.0 B)  TX bytes:1932 (1.8 KiB)</code></pre></div><p>i don&#039;t know how exactly point to point links work the openvpn server gateway is 10.0.0.1 but&nbsp; all the routes are for 10.0.0.5 and it works&nbsp; all traffic goes fine through the tun0 interface&nbsp; just want to make it load balance</p><div class="codebox"><pre><code>root@OpenWrt:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         10.8.0.5        128.0.0.0       UG    20     0        0 tun0
default         192.168.0.1     0.0.0.0         UG    10     0        0 eth1
10.8.0.1        10.8.0.5        255.255.255.255 UGH   0      0        0 tun0
10.8.0.5        *               255.255.255.255 UH    0      0        0 tun0
vpspublicip   wwan0gateway   255.255.255.255 UGH   0      0        0 wwan0
128.0.0.0       10.8.0.5        128.0.0.0       UG    0      0        0 tun0
wwan0ip   *               255.255.255.224 U     0      0        0 wwan0
192.168.0.0     *               255.255.255.0   U     10     0        0 eth1
192.168.1.0     *               255.255.255.0   U     0      0        0 br-lan</code></pre></div><p>mwan3 is left unchanged </p><p>wan is eth1 <br />wan2 is tun0</p><p>and mwan is default for wan and wan2</p><p>i have to mention this is how openvpn configures the tun0 adapter i only assigned metrics&nbsp; for whats it worth i can&#039;t ping 10.0.0.5 because there server is 10.0.0.1 again this is something that has to do with&nbsp; point to point connection ?</p>											<p class="post-edited">(Last edited by <strong>miliford</strong> on 20 Feb 2015, 13:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266295">
				<div class="post-metadata">
					<div class="post-num">Post #1162</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Feb 2015, 18:21					</div>
				</div>
				<div class="post-content content">
					<p>You have to remove the two more specific openvpn routes:</p><div class="codebox"><pre><code>default         10.8.0.5        128.0.0.0       UG    20     0        0 tun0
128.0.0.0       10.8.0.5        128.0.0.0       UG    0      0        0 tun0</code></pre></div><p>And replace them with a real default route. There is more info on this in this thread.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266604">
				<div class="post-metadata">
					<div class="post-num">Post #1163</div>
					<div class="post-author">thelovemyth</div>
					<div class="post-datetime">
						23 Feb 2015, 11:19					</div>
				</div>
				<div class="post-content content">
					<p>Hello everybody,<br />I have 2 wireless which i need combining to speed up (download). So i get 2 routers, one is Wzr-hp-ag300H(R1) and one is TL-MR3420(R2) with openWrt firmware.</p><p>At R2, i config it as a Client of a wireless and R2 is a client of another. Then, I install Mwan3 on R2, and it worked fine. But, when i acess speedtest.net to test this combination, it&#039;s not fine. The total speed is very slow, not equal each line.<br /><span class="postimg"><img src="http://i301.photobucket.com/albums/nn70/thelovemyth/wireless-interference.jpg" alt="http://i301.photobucket.com/albums/nn70/thelovemyth/wireless-interference.jpg" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266608">
				<div class="post-metadata">
					<div class="post-num">Post #1164</div>
					<div class="post-author">thelovemyth</div>
					<div class="post-datetime">
						23 Feb 2015, 11:53					</div>
				</div>
				<div class="post-content content">
					<p>This is MWAN Detailed Status<br /></p><div class="codebox"><pre><code>Interface status:
Interface wan is online (tracking active)
Interface wan2 is online (tracking active)

Policy balanced:
 wan2 (40%)
 wan (60%)

Policy wan2_only:
 wan2 (100%)

Policy wan2_wan:
 wan2 (100%)

Policy wan_only:
 wan (100%)

Policy wan_wan2:
 wan (100%)

Known networks:
destination        policy             hits     
-----------------------------------------------
127.0.0.0/8        default            0        
224.0.0.0/3        default            0        
192.168.1.0/24     default            11213    
192.168.3.0/24     default            19457    
192.168.6.0/24     default            954      
127.0.0.0          default            0        
127.0.0.0/8        default            0        
127.0.0.1          default            0        
127.255.255.255    default            0        
192.168.1.0        default            0        
192.168.1.54       default            11211    
192.168.1.255      default            0        
192.168.3.0        default            0        
192.168.3.214      default            19403    
192.168.3.255      default            0        
192.168.6.0        default            0        
192.168.6.1        default            430      
192.168.6.255      default            0        

Active rules:
source             destination        proto  src-port      dest-port     policy          hits     
--------------------------------------------------------------------------------------------------
0.0.0.0/0.0.0.1    0.0.0.0/0          tcp    0:65535       443           wan_wan2        0        
0.0.0.1/0.0.0.1    0.0.0.0/0          tcp    0:65535       443           wan2_wan        2        
0.0.0.0/0          0.0.0.0/0          all                                balanced        281</code></pre></div><p>This is combination: This time maybe lucky, last time the download only 500kBps<br /><span class="postimg"><img src="http://www.speedtest.net/result/4164266128.png" alt="http://www.speedtest.net/result/4164266128.png" /></span></p><p>This is R1<br /><span class="postimg"><img src="http://www.speedtest.net/result/4164252922.png" alt="http://www.speedtest.net/result/4164252922.png" /></span></p><p>This is W2<br /><span class="postimg"><img src="http://www.speedtest.net/result/4164248630.png" alt="http://www.speedtest.net/result/4164248630.png" /></span></p>											<p class="post-edited">(Last edited by <strong>thelovemyth</strong> on 23 Feb 2015, 11:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266609">
				<div class="post-metadata">
					<div class="post-num">Post #1165</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						23 Feb 2015, 11:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>thelovemyth wrote:</cite><blockquote><p>But, when i acess speedtest.net to test this combination, it&#039;s not fine. The total speed is very slow, not equal each line.</p></blockquote></div><p>Please read the wiki:<br /><a href="http://wiki.openwrt.org/doc/howto/mwan3#how_mwan3_load-balancing_works">http://wiki.openwrt.org/doc/howto/mwan3 … cing_works</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266620">
				<div class="post-metadata">
					<div class="post-num">Post #1166</div>
					<div class="post-author">thelovemyth</div>
					<div class="post-datetime">
						23 Feb 2015, 13:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>thelovemyth wrote:</cite><blockquote><p>But, when i acess speedtest.net to test this combination, it&#039;s not fine. The total speed is very slow, not equal each line.</p></blockquote></div><p>Please read the wiki:<br /><a href="http://wiki.openwrt.org/doc/howto/mwan3#how_mwan3_load-balancing_works">http://wiki.openwrt.org/doc/howto/mwan3 … cing_works</a></p></blockquote></div><p>Thanks arfett, i read it. But i saw on youtube, people test Loadbancing by speedtest.net like me!</p><p><a href="https://www.youtube.com/watch?v=4wGJAby6dmM">https://www.youtube.com/watch?v=4wGJAby6dmM</a></p><p> Sometimes the combination have slower than single connection. Or if i use 2 wireless card and software Connectify Dispatch, i will have better result.</p><p>This is i use Connectify Dispatch.<br /><span class="postimg"><img src="http://www.speedtest.net/result/4164381524.png" alt="http://www.speedtest.net/result/4164381524.png" /></span></p><p>I saw the different between 2 way, is it right ?</p>											<p class="post-edited">(Last edited by <strong>thelovemyth</strong> on 23 Feb 2015, 13:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266642">
				<div class="post-metadata">
					<div class="post-num">Post #1167</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						23 Feb 2015, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>The total speed of combined interfaces when using mwan3 with speedtest may vary. Some test servers use multiple concurrent connections, where you will see an increase in down- and upload speeds. Some test servers only use one connection. In this last case your max speed will be that of one interface.</p><p>The fact that you sometimes see 500kb or less, would suggest other problems. Like interference, speed-duplex issues or connection tracking issues. Try to find the problem by rule out factors.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 23 Feb 2015, 16:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266662">
				<div class="post-metadata">
					<div class="post-num">Post #1168</div>
					<div class="post-author">thelovemyth</div>
					<div class="post-datetime">
						23 Feb 2015, 18:50					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Adze, now I think I saw the problem, but i dont know why.</p><p>When I connect directly wireless, I have maximum speed. If i use a router (have Openwrt fw inside) as Client, and i connect this router by wire, i will have slower speed. And if i connect wireless of this router, the speed slow slower...</p><p>If I have another router connect with the first router. Anyway, by wire or wireless, the speed will slower than First router&#039;s wire.</p><p><span class="postimg"><img src="http://i301.photobucket.com/albums/nn70/thelovemyth/wireless-interference-1.jpg" alt="http://i301.photobucket.com/albums/nn70/thelovemyth/wireless-interference-1.jpg" /></span></p><p>Anyone know why?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266676">
				<div class="post-metadata">
					<div class="post-num">Post #1169</div>
					<div class="post-author">miliford</div>
					<div class="post-datetime">
						23 Feb 2015, 22:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>thelovemyth wrote:</cite><blockquote><p>Thanks Adze, now I think I saw the problem, but i dont know why.</p><p>When I connect directly wireless, I have maximum speed. If i use a router (have Openwrt fw inside) as Client, and i connect this router by wire, i will have slower speed. And if i connect wireless of this router, the speed slow slower...</p><p>If I have another router connect with the first router. Anyway, by wire or wireless, the speed will slower than First router&#039;s wire.<br />Anyone know why?</p></blockquote></div><br /><p>from the above pictures you have shown and based on the hardware you outlined&nbsp; both being single radio routers where openwrt runs the the radio in&nbsp; repeater mode ap+client on one radio reduces bandwith by a huge amount&nbsp; if you still one want a repeated wifi signal from both the ap i suggest you plug two wifi adapter on the usb port of each router. if a repeated signal of both wifi is not required , a single wifi adapter on the loadbalancing router would work. also set the channels appropriately to avoid interference.</p>											<p class="post-edited">(Last edited by <strong>miliford</strong> on 23 Feb 2015, 22:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266705">
				<div class="post-metadata">
					<div class="post-num">Post #1170</div>
					<div class="post-author">thelovemyth</div>
					<div class="post-datetime">
						24 Feb 2015, 06:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>miliford wrote:</cite><blockquote><p>from the above pictures you have shown and based on the hardware you outlined&nbsp; both being single radio routers where openwrt runs the the radio in&nbsp; repeater mode ap+client on one radio reduces bandwith by a huge amount&nbsp; if you still one want a repeated wifi signal from both the ap i suggest you plug two wifi adapter on the usb port of each router. if a repeated signal of both wifi is not required , a single wifi adapter on the loadbalancing router would work. also set the channels appropriately to avoid interference.</p></blockquote></div><p>Thanks miliford,<br />My English is not good enough, But i understand :</p><p>I take a router have usb port and usb wifi, I connect W1 by this usbwifi and set usbport as Wan port. After that, i get wireless W2 as Client on my router. After all, i will use mwan3 to load banlancing two this wireless (W1 and W2)</p><p>Is it right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267030">
				<div class="post-metadata">
					<div class="post-num">Post #1171</div>
					<div class="post-author">miliford</div>
					<div class="post-datetime">
						27 Feb 2015, 04:43					</div>
				</div>
				<div class="post-content content">
					<p>using a usb wifi to connect to the first isp and the built in wifi radio of the router to the second isp and then you can load balance those two interfaces and get the combined throughput over Ethernet lan </p><p>if you require your own wifi then install another wifi router&nbsp; and connect to the lan port of the loadbalancing router </p><p>my point to all this is using a radio in repeater mode reduces bandwidth by a huge amount so independent radio links is&nbsp; a good idea for the best throughput</p>											<p class="post-edited">(Last edited by <strong>miliford</strong> on 27 Feb 2015, 04:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267434">
				<div class="post-metadata">
					<div class="post-num">Post #1172</div>
					<div class="post-author">jmarlin</div>
					<div class="post-datetime">
						2 Mar 2015, 23:39					</div>
				</div>
				<div class="post-content content">
					<p>Cool utility guys! I&#039;m trying to get this working with two aircards plugged into a Ubiquiti Airrouter, actually. The aircards both work - I can ping on each interface, here are cleaned ping results:</p><div class="codebox"><pre><code># ping 8.8.8.8 -c 1 -I 3g-umts0
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=246 time=114.748 ms
1 packets transmitted, 1 packets received, 0% packet loss

# ping 8.8.8.8 -c 1 -I eth2
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=243 time=218.783 ms
1 packets transmitted, 1 packets received, 0% packet loss</code></pre></div><p>The two cards are an ATT 340U and a Sprint 341U. </p><p>Here are relevant interfaces from /etc/config/network<br /></p><div class="codebox"><pre><code>config interface &#039;wwan1&#039;
    option auto 0
    option ifname &#039;eth2&#039;
    option proto &#039;dhcp&#039;
    option device &#039;/dev/sprint1&#039;
    
config interface &#039;umts0&#039;
    option auto 0
    option ifname &#039;ppp0&#039;
    option proto &#039;3g&#039;
    option service &#039;umts&#039;
    option apn &#039;isp.cingular&#039;
    option device &#039;/dev/att2&#039;</code></pre></div><p>Here is relevant information for the ATT (PPP) card:<br /></p><div class="codebox"><pre><code>daemon.notice pppd[27492]: Connect: 3g-umts0 &lt;--&gt; /dev/att2
daemon.warn pppd[27492]: Could not determine remote IP address: defaulting to 10.64.64.64
daemon.notice pppd[27492]: local  IP address 166.217.128.137
daemon.notice pppd[27492]: remote IP address 10.64.64.64
daemon.notice pppd[27492]: primary   DNS address 209.183.33.23
daemon.notice pppd[27492]: secondary DNS address 209.183.35.23</code></pre></div><p>My problem lies in the failover process. mwan3 successfully notices when I remove a card, and attempts to failover to a different card. However, there is no default route added for the interface after failover. </p><p>I dont&#039;t think I can manually add a default route, because I don&#039;t know the gateway. The gateway is generally obtained via DHCP from the carrier (Sprint, ATT, etc). </p><p>Here&#039;s an illustration of the problem:</p><p>route -n with only the ATT card<br /></p><div class="codebox"><pre><code>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.64.64.64     0.0.0.0         UG    0      0        0 3g-umts0
10.64.64.64     0.0.0.0         255.255.255.255 UH    0      0        0 3g-umts0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.200.0   0.0.0.0         255.255.255.0   U     0      0        0 eth1</code></pre></div><p>route -n with sprint card added after ATT card has been added<br /></p><div class="codebox"><pre><code>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         173.152.1.97    0.0.0.0         UG    0      0        0 eth2
10.64.64.64     0.0.0.0         255.255.255.255 UH    0      0        0 3g-umts0
173.152.1.96    0.0.0.0         255.255.255.248 U     0      0        0 eth2
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.200.0   0.0.0.0         255.255.255.0   U     0      0        0 eth1</code></pre></div><p>route -n with the sprint card removed again... notice no default route. mwan3 correctly trying to use umts0, but not succeeding. <br /></p><div class="codebox"><pre><code>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.64.64.64     0.0.0.0         255.255.255.255 UH    0      0        0 3g-umts0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.200.0   0.0.0.0         255.255.255.0   U     0      0        0 eth1</code></pre></div><p>Is there a normal way to handle this problem? Any ideas? Thanks so much.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267436">
				<div class="post-metadata">
					<div class="post-num">Post #1173</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						2 Mar 2015, 23:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi jmarlin,</p><p>Configure metrics for each of your wan interfaces. See the wiki for more info.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 2 Mar 2015, 23:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267441">
				<div class="post-metadata">
					<div class="post-num">Post #1174</div>
					<div class="post-author">jmarlin</div>
					<div class="post-datetime">
						3 Mar 2015, 00:32					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Adze! I missed that because I thought it was referring to the &quot;metric&quot; options I defined in the members in the mwan3 configuration file... sorry about the mistake!</p><p>I will add a &quot;metric&quot; to my UCI interface configurations in /etc/config/network. </p><p>The wiki also refers to enabling &quot;Use default gateway&quot; in LuCI. Do you happen to know the UCI setting that that option sets? Is it &quot;defaultroute&quot;?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267443">
				<div class="post-metadata">
					<div class="post-num">Post #1175</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						3 Mar 2015, 01:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmarlin wrote:</cite><blockquote><p>Thanks Adze! I missed that because I thought it was referring to the &quot;metric&quot; options I defined in the members in the mwan3 configuration file... sorry about the mistake!</p><p>I will add a &quot;metric&quot; to my UCI interface configurations in /etc/config/network. </p><p>The wiki also refers to enabling &quot;Use default gateway&quot; in LuCI. Do you happen to know the UCI setting that that option sets? Is it &quot;defaultroute&quot;?</p></blockquote></div><p>You shouldn&#039;t neet to set anything in UCI as that is the default AFAIK.</p><p>That box is checked for me and this is my config:</p><div class="codebox"><pre><code>config interface &#039;wan&#039;
    option ifname &#039;eth1&#039;
    option proto &#039;dhcp&#039;
    option peerdns &#039;0&#039;
    option dns &#039;8.8.8.8 8.8.4.4&#039;
    option metric &#039;10&#039;</code></pre></div>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 1176 to 1175 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 47 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=45.html">45</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=46.html">46</a></li><li class="pagination-current"><span>47</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=48.html">48</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=49.html">49</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>