<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> microcontroller communication through serial using usb2serial</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p211398">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">shushil.np</div>
					<div class="post-datetime">
						1 Sep 2013, 23:40					</div>
				</div>
				<div class="post-content content">
					<p>I wanted to interface with a microcontroller using serial communication from openwrt. I prepared a setup as below<br />1. I download and flahsed the trunk snapshot firmware for D-LINK DIR 505 from the openwrt website.<br />2. Then i compiled my own openwrt image from the trunk source. This time i selected some of the usb drivers (usb-acm) and network drivers.<br />3. I upgrade my router with this new image through sysupgrade.<br />4. The image comes up and everything works fine.<br />My micrcontroller board has a usb to serial converter that uses an STM32F chip. This is detected as an acm device. So i <br />already had installed the kmod-usb-acm module.&nbsp; When i plug my microcontroller board to the routers usb, In the dmesg<br />i see that its detected as an acm device and i seee an /dev/ttyACM0.<br />[ 2430.460000] usb 1-1: new full-speed USB device number 4 using ehci-platform<br />[ 2430.630000] cdc_acm 1-1:1.0: This device cannot do calls on its own. It is not a modem.<br />[ 2430.630000] cdc_acm 1-1:1.0: ttyACM0: USB ACM device<br />I wrote a small code for openwrt which opens the given serial port (here /dev/ttyACMO) waits on a select (system call) on read/write events for the serial ports fd. whenever a read events occurs i dump the message into stdout.<br />I made the micrcontroller send some predifined message every 2 second on the serial link.<br />Now when i run my code&nbsp; in openwrt to print the serial message, i am able to see the message coming from the microcontroller.<br />the problem is after few minutes the serial drops dead. There is no more read events on the serial interface. <br />Restting the micrcontroller also doesnot help. The only way to make it work again is to completely remove the microcontroller board from<br />the usb and start again.<br />The same setup works perfectly fine on my ubuntu box. I use the same driver interface i.e usb-acm (in /dev/ttyACM0). here the system keeps running forever without the serial hangup.<br />Any idea or suggestion on whats happening.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211482">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						3 Sep 2013, 07:58					</div>
				</div>
				<div class="post-content content">
					<p>Check <a href="https://forum.openwrt.org/viewtopic.php?id=39956">https://forum.openwrt.org/viewtopic.php?id=39956</a></p><p>This is for AR9331, but this may apply.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211553">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">shushil.np</div>
					<div class="post-datetime">
						4 Sep 2013, 06:51					</div>
				</div>
				<div class="post-content content">
					<p>Thanks. It is exactly the problem i was facing.</p><p>Dlink DIR-505 uses AR9331 chipset.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>