<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Issue about BRCM4709 kernel boot, Is BRCM4709 support on schedule ?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 3 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p250314">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">polejo</div>
					<div class="post-datetime">
						13 Oct 2014, 05:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi&nbsp; all, I checked out trunk version, and found that BRCM 4708(netgear R6250) had been added, which is the same series with BRCM4709.</p><p>So I&nbsp; did a test on my board(Xiaomi R1D router), Follow the scripts below for a vmlinux.trx which is needed by broadcom CFE loader.</p><div class="codebox"><pre><code>arm-brcm-linux-uclibcgnueabi-objcopy -O binary -R .note -R .note.gnu.build-id -R .comment -S vmlinux piggy
./lzma_4k e piggy vmlinuz
./trx -o ow-vmlinuz.trx vmlinuz</code></pre></div><p>The result is fail.<br /></p><div class="quotebox"><blockquote><p>Starting program at 0x00008000</p></blockquote></div><p>and then kernel did not show anything.</p><p>Xiaomi router&#039;s offcial kernel version is 2.6.36, and kernel of openwrt trunk support brcm-arm is ver 3.14.</p><p>Do anyone know how to boot kernel 3.14 on BRCM4709?&nbsp; Is BRCM4709 support on schedule ?<br />Help would be appreciated.</p>											<p class="post-edited">(Last edited by <strong>polejo</strong> on 13 Oct 2014, 05:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250323">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						13 Oct 2014, 08:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>polejo wrote:</cite><blockquote><p>Follow the scripts below for a vmlinux.trx which is needed by broadcom CFE loader.</p><div class="codebox"><pre><code>arm-brcm-linux-uclibcgnueabi-objcopy -O binary -R .note -R .note.gnu.build-id -R .comment -S vmlinux piggy
./lzma_4k e piggy vmlinuz
./trx -o ow-vmlinuz.trx vmlinuz</code></pre></div></blockquote></div><p>So it sounds like you found some trick to get OpenWrt kernel booting.</p><div class="quotebox"><cite>polejo wrote:</cite><blockquote><p>The result is fail.<br /></p><div class="quotebox"><blockquote><p>Starting program at 0x00008000</p></blockquote></div><p>and then kernel did not show anything.</p></blockquote></div><p>But... it fails? So what&#039;s the point of above commands?</p><p>Did you try booting standard OpenWrt trx?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250329">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">polejo</div>
					<div class="post-datetime">
						13 Oct 2014, 09:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Zajec wrote:</cite><blockquote><div class="quotebox"><cite>polejo wrote:</cite><blockquote><p>Follow the scripts below for a vmlinux.trx which is needed by broadcom CFE loader.</p><div class="codebox"><pre><code>arm-brcm-linux-uclibcgnueabi-objcopy -O binary -R .note -R .note.gnu.build-id -R .comment -S vmlinux piggy
./lzma_4k e piggy vmlinuz
./trx -o ow-vmlinuz.trx vmlinuz</code></pre></div></blockquote></div><p>So it sounds like you found some trick to get OpenWrt kernel booting.</p><div class="quotebox"><cite>polejo wrote:</cite><blockquote><p>The result is fail.<br /></p><div class="quotebox"><blockquote><p>Starting program at 0x00008000</p></blockquote></div><p>and then kernel did not show anything.</p></blockquote></div><p>But... it fails? So what&#039;s the point of above commands?</p><p>Did you try booting standard OpenWrt trx?</p></blockquote></div><p>========================================================<br />Hi Zajec<br /><strong>The script I extract from broadcom sdk is a BRCM method to generate 2.6 kernel.trx and rootfs.squash, which can boot 2.6 kernel normally.<br />So I use this method to the openwrt 3.14 kernel.trx, and it was fail.<br />openwrt standard trx was fail too.</strong></p>											<p class="post-edited">(Last edited by <strong>polejo</strong> on 13 Oct 2014, 09:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250499">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						14 Oct 2014, 11:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>polejo wrote:</cite><blockquote><p>openwrt standard trx was fail too</p></blockquote></div><p>I&#039;ve commited two important fixes:<br /><a href="https://dev.openwrt.org/changeset/42894/">https://dev.openwrt.org/changeset/42894/</a><br /><a href="https://dev.openwrt.org/changeset/42895/">https://dev.openwrt.org/changeset/42895/</a></p><p>Please try to build &amp; boot recent OpenWrt version (from trunk).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252160">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">klirichek</div>
					<div class="post-datetime">
						27 Oct 2014, 10:46					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve tried several attempts during last month.<br />All without success, unfortunately...<br />The system either &#039;stuck&#039; without a message, either flow raw binary data into serial, which is however can&#039;t be managed by &#039;earlyprintk&#039; parameters (just flow always).</p><p>2.6 kernel provided for xiaomi router on github contains some precompiled binaries. I&#039;ve tried to sequentally attach all the difference between vanila 2.6 kernel and xiaomi one - and apply it to 3.14 kernel. Finally it was compiled, but no success in run!</p><p>also, 2.6 kernel can be successfully built by openwrt toolchain.</p><p>Loader (CFE) needs the image compressed by lzma (both &#039;lzma -1f &lt;img&gt;&#039; and openwrt&#039;s &#039;lzma e &lt;img&gt; &lt;img.lzma&gt; -1d&#039; works ok).</p><p>Pure 3.14 kernel just stuck.<br />Kernel+dts compressed by lzma also stuck, but flow mass of garbage into console before.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252604">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">klirichek</div>
					<div class="post-datetime">
						31 Oct 2014, 08:40					</div>
				</div>
				<div class="post-content content">
					<p>You can&#039;t &#039;just load&#039; 3-rd kernel (i.e. vmlinux or vmlinuz) into Xiaomi router, since it has a little different structure then 2.36.<br />If you look carefully you can found that now the &#039;bootable kernel&#039; consist from the kernel itself and also small blob of defice definitions (device binary tree). That is made in order to not recompile the whole kernel just to add a new model with &#039;standard&#039; (i.e. no revolutional) characteristics.</p><p>So, &#039;pure kernel&#039; - yes, it fails. If you build it with &#039;early_printk&quot; support, It will show that the machine id is unknown to the kernel.</p><p>You can try any ready lzma images which is built for 53xx arch. Say, Netgear 6300.<br />Or you can do yourself try - just cat the kernel and .dtb of platform into one blob, then compress it with lzma -1f, and try to load into miwifi.</p><p>The default try, however, doesn&#039;t work. It seems that router just has some timer different than defined in any customized dtb (and it&#039;s frequency is not known to the kernel, it thinks that it is different). So, the loading at one moment reconfigure UART according to wrong guessed frequencty, and from the moment the garbage flows into console (which continue to work at 115200 bod).</p><p>So, it is necessary to write custom .dts for the router. May be sources of 2.36 kernel on github may help.<br />For now (with quite fixed serial driver) it loads in 1 core up to initrd, then stuck because can&#039;t find rootfs. However it is already beter than nothing <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>klirichek</strong> on 31 Oct 2014, 08:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252607">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						31 Oct 2014, 09:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>klirichek wrote:</cite><blockquote><p>Kernel+dts compressed by lzma also stuck, but flow mass of garbage into console before.</p></blockquote></div><p>This is probably the way to go. You have to fix some console speed probably (see DTS files).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252761">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">klirichek</div>
					<div class="post-datetime">
						1 Nov 2014, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>The next state. I&#039;ve set the clocks in dts.<br />Now the bootlog shows this state:</p><p>xiaomi&gt; boot -raw -z -addr=0x8000 -max=0xef8000 192.168.1.227:zImage-bcm4708-miwifi-r1d.lzma<br />Loader:raw Filesys:tftp Dev:eth0 File:192.168.1.227:zImage-bcm4708-miwifi-r1d.lzma Options:(null)<br />Loading: ... 1767073 bytes read<br />Entry at 0x00008000<br />Closing network.<br />Starting program at 0x00008000<br />Uncompressing Linux... done, booting the kernel.<br />[&nbsp; &nbsp; 0.000000] Booting Linux on physical CPU 0x0<br />[&nbsp; &nbsp; 0.000000] Linux version 3.14.18 (alexey@ubuntu64) (gcc version 4.9.2 (OpenWrt/Linaro GCC 4.9-2014.10 r43052) ) #40 SMP PREEMPT Sat Nov 1 16:47:00 NOVT 2014<br />[&nbsp; &nbsp; 0.000000] CPU: ARMv7 Processor [413fc090] revision 0 (ARMv7), cr=10c53c7d<br />[&nbsp; &nbsp; 0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache<br />[&nbsp; &nbsp; 0.000000] Machine model: Northstar Prototype<br />[&nbsp; &nbsp; 0.000000] Memory policy: Data cache writealloc<br />[&nbsp; &nbsp; 0.000000] PERCPU: Embedded 7 pages/cpu @c7ee4000 s6848 r8192 d13632 u32768<br />[&nbsp; &nbsp; 0.000000] Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 32512<br />[&nbsp; &nbsp; 0.000000] Kernel command line: root=/dev/sda1 console=ttyS0,115200 libata.force=3.0Gbps<br />[&nbsp; &nbsp; 0.000000] PID hash table entries: 512 (order: -1, 2048 bytes)<br />[&nbsp; &nbsp; 0.000000] Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)<br />[&nbsp; &nbsp; 0.000000] Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)<br />[&nbsp; &nbsp; 0.000000] Memory: 124640K/131072K available (3647K kernel code, 125K rwdata, 1028K rodata, 158K init, 223K bss, 6432K reserved, 0K highmem)<br />[&nbsp; &nbsp; 0.000000] Virtual kernel memory layout:<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;vector&nbsp; : 0xffff0000 - 0xffff1000&nbsp; &nbsp;(&nbsp; &nbsp;4 kB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;fixmap&nbsp; : 0xfff00000 - 0xfffe0000&nbsp; &nbsp;( 896 kB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;vmalloc : 0xc8800000 - 0xff000000&nbsp; &nbsp;( 872 MB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;lowmem&nbsp; : 0xc0000000 - 0xc8000000&nbsp; &nbsp;( 128 MB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;pkmap&nbsp; &nbsp;: 0xbfe00000 - 0xc0000000&nbsp; &nbsp;(&nbsp; &nbsp;2 MB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;modules : 0xbf000000 - 0xbfe00000&nbsp; &nbsp;(&nbsp; 14 MB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp; &nbsp;.text : 0xc0008000 - 0xc0498e3c&nbsp; &nbsp;(4676 kB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp; &nbsp;.init : 0xc0499000 - 0xc04c0ac0&nbsp; &nbsp;( 159 kB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp; &nbsp;.data : 0xc04c2000 - 0xc04e1714&nbsp; &nbsp;( 126 kB)<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp; &nbsp; .bss : 0xc04e1714 - 0xc05196e0&nbsp; &nbsp;( 224 kB)<br />[&nbsp; &nbsp; 0.000000] Preemptible hierarchical RCU implementation.<br />[&nbsp; &nbsp; 0.000000] NR_IRQS:16 nr_irqs:16 16<br />[&nbsp; &nbsp; 0.000014] sched_clock: 64 bits at 500MHz, resolution 2ns, wraps every 2199023255552ns<br />[&nbsp; &nbsp; 0.000278] Calibrating delay loop... 1987.37 BogoMIPS (lpj=9936896)<br />[&nbsp; &nbsp; 0.060160] pid_max: default: 32768 minimum: 301<br />[&nbsp; &nbsp; 0.060327] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.060345] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.061725] CPU: Testing write buffer coherency: ok<br />[&nbsp; &nbsp; 0.062053] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000<br />[&nbsp; &nbsp; 0.062111] Setting up static identity map for 0x12a18 - 0x12a4c<br />[&nbsp; &nbsp; 0.120670] CPU1: failed to boot: -38<br />[&nbsp; &nbsp; 0.120717] Brought up 1 CPUs<br />[&nbsp; &nbsp; 0.120728] SMP: Total of 1 processors activated.<br />[&nbsp; &nbsp; 0.120735] CPU: All CPU(s) started in SVC mode.<br />[&nbsp; &nbsp; 0.128129] NET: Registered protocol family 16<br />[&nbsp; &nbsp; 0.128780] DMA: preallocated 256 KiB pool for atomic coherent allocations<br />[&nbsp; &nbsp; 0.131091] L310 cache controller enabled<br />[&nbsp; &nbsp; 0.131109] l2x0: 16 ways, CACHE_ID 0x410000c8, AUX_CTRL 0x0a130000, Cache size: 256 kB<br />[&nbsp; &nbsp; 0.145057] bio: create slab &lt;bio-0&gt; at 0<br />[&nbsp; &nbsp; 0.146101] SCSI subsystem initialized<br />[&nbsp; &nbsp; 0.147254] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 0.147395] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 0.147559] usbcore: registered new device driver usb<br />[&nbsp; &nbsp; 0.148492] Switched to clocksource arm_global_timer<br />[&nbsp; &nbsp; 0.150623] NET: Registered protocol family 2<br />[&nbsp; &nbsp; 0.151261] TCP established hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.151284] TCP bind hash table entries: 1024 (order: 1, 8192 bytes)<br />[&nbsp; &nbsp; 0.151304] TCP: Hash tables configured (established 1024 bind 1024)<br />[&nbsp; &nbsp; 0.151354] TCP: reno registered<br />[&nbsp; &nbsp; 0.151370] UDP hash table entries: 256 (order: 1, 8192 bytes)<br />[&nbsp; &nbsp; 0.151402] UDP-Lite hash table entries: 256 (order: 1, 8192 bytes)<br />[&nbsp; &nbsp; 0.151603] NET: Registered protocol family 1<br />[&nbsp; &nbsp; 0.151945] RPC: Registered named UNIX socket transport module.<br />[&nbsp; &nbsp; 0.151956] RPC: Registered udp transport module.<br />[&nbsp; &nbsp; 0.151962] RPC: Registered tcp transport module.<br />[&nbsp; &nbsp; 0.151968] RPC: Registered tcp NFSv4.1 backchannel transport module.<br />[&nbsp; &nbsp; 0.153847] futex hash table entries: 512 (order: 3, 32768 bytes)<br />[&nbsp; &nbsp; 0.154358] VFS: Disk quotas dquot_6.5.2<br />[&nbsp; &nbsp; 0.154458] Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.154710] squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />[&nbsp; &nbsp; 0.154917] NFS: Registering the id_resolver key type<br />[&nbsp; &nbsp; 0.154963] Key type id_resolver registered<br />[&nbsp; &nbsp; 0.154971] Key type id_legacy registered<br />[&nbsp; &nbsp; 0.155004] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.<br />[&nbsp; &nbsp; 0.155355] fuse init (API version 7.22)<br />[&nbsp; &nbsp; 0.155566] msgmni has been set to 243<br />[&nbsp; &nbsp; 0.156002] io scheduler noop registered<br />[&nbsp; &nbsp; 0.156011] io scheduler deadline registered (default)<br />[&nbsp; &nbsp; 0.156342] Serial: 8250/16550 driver, 2 ports, IRQ sharing disabled<br />[&nbsp; &nbsp; 0.157247] 18000300.serial: ttyS0 at MMIO 0x18000300 (irq = 117, base_baud = 7812500) is a 16550<br />[&nbsp; &nbsp; 0.587264] console [ttyS0] enabled<br />[&nbsp; &nbsp; 0.598497] brd: module loaded<br />[&nbsp; &nbsp; 0.605828] loop: module loaded<br />[&nbsp; &nbsp; 0.656608] no nvram found<br />[&nbsp; &nbsp; 0.659680] Unsupported SPROM revision 0 detected. Will extract v1<br />[&nbsp; &nbsp; 0.667843] tun: Universal TUN/TAP device driver, 1.6<br />[&nbsp; &nbsp; 0.673104] tun: (C) 1999-2004 Max Krasnyansky &lt;maxk@qualcomm.com&gt;<br />[&nbsp; &nbsp; 0.679575] bgmac: Broadcom 47xx GBit MAC driver loaded<br />[&nbsp; &nbsp; 0.684863] PPP generic driver version 2.4.2<br />[&nbsp; &nbsp; 0.689653] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp; 0.696254] ehci-pci: EHCI PCI platform driver<br />[&nbsp; &nbsp; 0.700894] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />[&nbsp; &nbsp; 0.707374] usbcore: registered new interface driver cdc_acm<br />[&nbsp; &nbsp; 0.713098] cdc_acm: USB Abstract Control Model driver for USB modems and ISDN adapters<br />[&nbsp; &nbsp; 0.721270] usbcore: registered new interface driver usb-storage<br />[&nbsp; &nbsp; 0.727586] usbcore: registered new interface driver usbserial<br />[&nbsp; &nbsp; 0.733734] usbcore: registered new interface driver usbserial_generic<br />[&nbsp; &nbsp; 0.740436] usbserial: USB Serial support registered for generic<br />[&nbsp; &nbsp; 0.746538] bcma: bus0: Found chip with id 53010, rev 0x00 and package 0x00<br />[&nbsp; &nbsp; 0.753617] bcma: bus0: Core 0 found: ChipCommon (manuf 0x4BF, id 0x800, rev 0x2A, class 0x0)<br />[&nbsp; &nbsp; 0.762291] bcma: bus0: Core 1 found: Chipcommon B (manuf 0x4BF, id 0x50B, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.771094] bcma: bus0: Core 2 found: DMA (manuf 0x4BF, id 0x502, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.779089] bcma: bus0: Core 3 found: GBit MAC (manuf 0x4BF, id 0x82D, rev 0x05, class 0x0)<br />[&nbsp; &nbsp; 0.787542] bcma: bus0: Core 4 found: GBit MAC (manuf 0x4BF, id 0x82D, rev 0x05, class 0x0)<br />[&nbsp; &nbsp; 0.796034] bcma: bus0: Core 5 found: GBit MAC (manuf 0x4BF, id 0x82D, rev 0x05, class 0x0)<br />[&nbsp; &nbsp; 0.804492] bcma: bus0: Core 6 found: GBit MAC (manuf 0x4BF, id 0x82D, rev 0x05, class 0x0)<br />[&nbsp; &nbsp; 0.812922] bcma: bus0: Core 7 found: PCIe Gen 2 (manuf 0x4BF, id 0x501, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.821537] bcma: bus0: Core 8 found: PCIe Gen 2 (manuf 0x4BF, id 0x501, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.830121] bcma: bus0: Core 9 found: PCIe Gen 2 (manuf 0x4BF, id 0x501, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.838751] bcma: bus0: Core 10 found: ARM Cortex A9 core (ihost) (manuf 0x4BF, id 0x510, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.848845] bcma: bus0: Core 11 found: USB 2.0 (manuf 0x4BF, id 0x504, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.857281] bcma: bus0: Core 12 found: USB 3.0 (manuf 0x4BF, id 0x505, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.865726] bcma: bus0: Core 13 found: SDIO3 (manuf 0x4BF, id 0x503, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.874005] bcma: bus0: Core 14 found: I2S (manuf 0x4BF, id 0x834, rev 0x03, class 0x0)<br />[&nbsp; &nbsp; 0.882097] bcma: bus0: Core 15 found: ARM Cortex A9 JTAG (manuf 0x4BF, id 0x506, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.891495] bcma: bus0: Core 16 found: Denali DDR2/DDR3 memory controller (manuf 0x4BF, id 0x507, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.902279] bcma: bus0: Core 17 found: ROM (manuf 0x4BF, id 0x508, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.910379] bcma: bus0: Core 18 found: NAND flash controller (manuf 0x4BF, id 0x509, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.920030] bcma: bus0: Core 19 found: SPI flash controller (manuf 0x4BF, id 0x50A, rev 0x01, class 0x0)<br />[&nbsp; &nbsp; 0.930369] bcm53xxspiflash spi32766.0: mx25l12805d (16384 Kbytes)<br />[&nbsp; &nbsp; 1.425938] 5 bcm47xxpart partitions found on MTD device spi32766.0<br />[&nbsp; &nbsp; 1.432239] Creating 5 MTD partitions on &quot;spi32766.0&quot;:<br />[&nbsp; &nbsp; 1.437391] 0x000000000000-0x000000040000 : &quot;boot&quot;<br />[&nbsp; &nbsp; 1.443191] 0x000000040000-0x000000ff0000 : &quot;firmware&quot;<br />[&nbsp; &nbsp; 1.449244] 0x00000004001c-0x000000040000 : &quot;linux&quot;<br />[&nbsp; &nbsp; 1.454215] mtd: partition &quot;linux&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only<br />[&nbsp; &nbsp; 1.467634] 0x000000040000-0x000000ff0000 : &quot;rootfs&quot;<br />[&nbsp; &nbsp; 1.473582] 0x000000ff0000-0x000001000000 : &quot;nvram&quot;<br />[&nbsp; &nbsp; 1.479430] bcma: bus0: Found sprom from device tree provider<br />[&nbsp; &nbsp; 1.485603] bgmac bcma0:3: Invalid MAC addr: 00:00:00:00:00:00<br />[&nbsp; &nbsp; 1.491594] bgmac bcma0:3: Using random MAC: 9e:41:e3:88:28:6b<br />[&nbsp; &nbsp; 1.497501] bgmac bcma0:3: Found PHY addr: 0<br />[&nbsp; &nbsp; 1.504084] libphy: bgmac mii bus: probed<br />[&nbsp; &nbsp; 1.581483] b53_common: found switch: BCM53012, rev 5<br />[&nbsp; &nbsp; 1.587492] bgmac bcma0:4: Invalid MAC addr: 00:00:00:00:00:00<br />[&nbsp; &nbsp; 1.593430] bgmac bcma0:4: Using random MAC: d2:b8:6e:c5:af:3d<br />[&nbsp; &nbsp; 1.599341] bgmac bcma0:4: Found PHY addr: 0<br />[&nbsp; &nbsp; 1.605935] libphy: bgmac mii bus: probed<br />[&nbsp; &nbsp; 1.681098] bgmac: Unsupported core_unit 2<br />[&nbsp; &nbsp; 1.685215] bgmac: probe of bcma0:5 failed with error -524<br />[&nbsp; &nbsp; 1.690934] bgmac: Unsupported core_unit 3<br />[&nbsp; &nbsp; 1.695049] bgmac: probe of bcma0:6 failed with error -524<br />[&nbsp; &nbsp; 1.700746] pcie2_bcma bcma0:7: scanning bus<br />[&nbsp; &nbsp; 1.954207] pcie2_bcma bcma0:7: switching to GEN2<br />[&nbsp; &nbsp; 2.207962] pcie2_bcma bcma0:7: PCI host bridge to bus 0000:00<br />[&nbsp; &nbsp; 2.213871] pci_bus 0000:00: root bus resource [mem 0x08000000-0x0fffffff]<br />[&nbsp; &nbsp; 2.220792] pci_bus 0000:00: root bus resource [io&nbsp; 0x8000000-0xfffffff]<br />[&nbsp; &nbsp; 2.227514] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]<br />[&nbsp; &nbsp; 2.235802] PCI: bus0: Fast back to back transfers disabled<br />[&nbsp; &nbsp; 2.242020] PCI: bus1: Fast back to back transfers disabled<br />[&nbsp; &nbsp; 2.247672] pci 0000:00:00.0: BAR 8: assigned [mem 0x08000000-0x080fffff]<br />[&nbsp; &nbsp; 2.254543] pci 0000:01:00.0: BAR 0: assigned [mem 0x08000000-0x08007fff 64bit]<br />[&nbsp; &nbsp; 2.261910] pci 0000:00:00.0: PCI bridge to [bus 01]<br />[&nbsp; &nbsp; 2.266892] pci 0000:00:00.0:&nbsp; &nbsp;bridge window [mem 0x08000000-0x080fffff]<br />[&nbsp; &nbsp; 2.273968] pcie2_bcma bcma0:8: scanning bus<br />[&nbsp; &nbsp; 2.527410] pcie2_bcma bcma0:8: switching to GEN2<br />[&nbsp; &nbsp; 2.781178] pcie2_bcma bcma0:8: PCI host bridge to bus 0001:00<br />[&nbsp; &nbsp; 2.787033] pci_bus 0001:00: root bus resource [mem 0x40000000-0x47ffffff]<br />[&nbsp; &nbsp; 2.793978] pci_bus 0001:00: root bus resource [io&nbsp; 0x40000000-0x47ffffff]<br />[&nbsp; &nbsp; 2.800894] pci_bus 0001:00: No busn resource found for root bus, will use [bus 00-ff]<br />[&nbsp; &nbsp; 2.809139] PCI: bus0: Fast back to back transfers disabled<br />[&nbsp; &nbsp; 2.815351] PCI: bus1: Fast back to back transfers disabled<br />[&nbsp; &nbsp; 2.821067] pci 0001:00:00.0: BAR 8: assigned [mem 0x40000000-0x400fffff]<br />[&nbsp; &nbsp; 2.827874] pci 0001:01:00.0: BAR 0: assigned [mem 0x40000000-0x40007fff 64bit]<br />[&nbsp; &nbsp; 2.835243] pci 0001:00:00.0: PCI bridge to [bus 01]<br />[&nbsp; &nbsp; 2.840244] pci 0001:00:00.0:&nbsp; &nbsp;bridge window [mem 0x40000000-0x400fffff]<br />[&nbsp; &nbsp; 2.847142] PCI: enabling device 0001:00:00.0 (0140 -&gt; 0143)<br />[&nbsp; &nbsp; 2.852850] PCI: enabling device 0001:01:00.0 (0140 -&gt; 0142)<br />[&nbsp; &nbsp; 2.858554] bcma: bus0: Found chip with id 43217, rev 0x00 and package 0x08<br />[&nbsp; &nbsp; 2.865616] bcma: bus1: Core 0 found: ChipCommon (manuf 0x4BF, id 0x800, rev 0x27, class 0x0)<br />[&nbsp; &nbsp; 2.874208] bcma: bus1: Core 1 found: IEEE 802.11 (manuf 0x4BF, id 0x812, rev 0x1E, class 0x0)<br />[&nbsp; &nbsp; 2.882898] bcma: bus1: Core 2 found: PCIe (manuf 0x4BF, id 0x820, rev 0x14, class 0x0)<br />[&nbsp; &nbsp; 2.891037] bcma: bus1: Using fallback SPROM failed (err -2)<br />[&nbsp; &nbsp; 2.896707] bcma: bus1: No SPROM available<br />[&nbsp; &nbsp; 2.940484] bcma: bus1: Bus registered<br />[&nbsp; &nbsp; 2.944414] pcie2_bcma bcma0:9: scanning bus<br />[&nbsp; &nbsp; 3.198172] pcie2_bcma bcma0:9: switching to GEN2<br />[&nbsp; &nbsp; 3.451907] pcie2_bcma bcma0:9: PCI host bridge to bus 0002:00<br />[&nbsp; &nbsp; 3.457765] pci_bus 0002:00: root bus resource [mem 0x48000000-0x4fffffff]<br />[&nbsp; &nbsp; 3.464713] pci_bus 0002:00: root bus resource [io&nbsp; 0x48000000-0x4fffffff]<br />[&nbsp; &nbsp; 3.471634] pci_bus 0002:00: No busn resource found for root bus, will use [bus 00-ff]<br />[&nbsp; &nbsp; 3.479899] PCI: bus0: Fast back to back transfers disabled<br />[&nbsp; &nbsp; 3.486124] PCI: bus1: Fast back to back transfers disabled<br />[&nbsp; &nbsp; 3.491848] pci 0002:00:00.0: BAR 8: assigned [mem 0x48000000-0x480fffff]<br />[&nbsp; &nbsp; 3.498658] pci 0002:01:00.0: BAR 5: assigned [mem 0x48000000-0x480001ff]<br />[&nbsp; &nbsp; 3.505496] pci 0002:01:00.0: BAR 4: can&#039;t assign io (size 0x10)<br />[&nbsp; &nbsp; 3.511537] pci 0002:01:00.0: BAR 0: can&#039;t assign io (size 0x8)<br />[&nbsp; &nbsp; 3.517471] pci 0002:01:00.0: BAR 2: can&#039;t assign io (size 0x8)<br />[&nbsp; &nbsp; 3.523428] pci 0002:01:00.0: BAR 1: can&#039;t assign io (size 0x4)<br />[&nbsp; &nbsp; 3.529361] pci 0002:01:00.0: BAR 3: can&#039;t assign io (size 0x4)<br />[&nbsp; &nbsp; 3.535343] pci 0002:00:00.0: PCI bridge to [bus 01]<br />[&nbsp; &nbsp; 3.540344] pci 0002:00:00.0:&nbsp; &nbsp;bridge window [mem 0x48000000-0x480fffff]<br />[&nbsp; &nbsp; 3.547260] PCI: enabling device 0002:00:00.0 (0140 -&gt; 0143)<br />[&nbsp; &nbsp; 3.552968] PCI: enabling device 0002:01:00.0 (0140 -&gt; 0142)<br />[&nbsp; &nbsp; 3.558711] ahci 0002:01:00.0: SSS flag set, parallel bus scan disabled<br />[&nbsp; &nbsp; 3.565422] ahci 0002:01:00.0: AHCI 0001.0200 32 slots 2 ports 6 Gbps 0x3 impl IDE mode<br />[&nbsp; &nbsp; 3.573475] ahci 0002:01:00.0: flags: 64bit ncq sntf stag led clo pmp pio slum part ccc sxs <br />[&nbsp; &nbsp; 3.583712] scsi0 : ahci<br />[&nbsp; &nbsp; 3.586756] scsi1 : ahci<br />[&nbsp; &nbsp; 3.589645] ata1: FORCE: PHY spd limit set to 3.0Gbps<br />[&nbsp; &nbsp; 3.594785] ata1: SATA max UDMA/133 abar m512@0x48000000 port 0x48000100 irq 175<br />[&nbsp; &nbsp; 3.602228] ata2: FORCE: PHY spd limit set to 3.0Gbps<br />[&nbsp; &nbsp; 3.607294] ata2: SATA max UDMA/133 abar m512@0x48000000 port 0x48000180 irq 175<br />[&nbsp; &nbsp; 3.616278] bcma: bus0: Bus registered<br />[&nbsp; &nbsp; 3.620428] TCP: cubic registered<br />[&nbsp; &nbsp; 3.623755] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 3.628304] 8021q: 802.1Q VLAN Support v1.8<br />[&nbsp; &nbsp; 3.632623] Key type dns_resolver registered<br />[&nbsp; &nbsp; 3.638105] ### dt-test ### No testcase data in device tree; not running tests<br />[&nbsp; &nbsp; 6.260156] ata1: SATA link up 3.0 Gbps (SStatus 123 SControl 320)<br />[&nbsp; &nbsp; 6.272509] ata1.00: ATA-8: ST1000LM024 HN-M101MBB, 2BA30001, max UDMA/133<br />[&nbsp; &nbsp; 6.279408] ata1.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32)<br />[&nbsp; &nbsp; 6.292375] ata1.00: configured for UDMA/133<br />[&nbsp; &nbsp; 6.310504] scsi 0:0:0:0: Direct-Access&nbsp; &nbsp; &nbsp;ATA&nbsp; &nbsp; &nbsp; ST1000LM024 HN-M 2BA3 PQ: 0 ANSI: 5<br />[&nbsp; &nbsp; 6.319528] sd 0:0:0:0: [sda] 1953525168 512-byte logical blocks: (1.00 TB/931 GiB)<br />[&nbsp; &nbsp; 6.327540] sd 0:0:0:0: [sda] 4096-byte physical blocks<br />[&nbsp; &nbsp; 6.333014] sd 0:0:0:0: [sda] Write Protect is off<br />[&nbsp; &nbsp; 6.337898] sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn&#039;t support DPO or FUA<br />[&nbsp; &nbsp; 6.353559]&nbsp; sda: sda1 sda2 sda3 sda4<br />[&nbsp; &nbsp; 6.358722] sd 0:0:0:0: [sda] Attached SCSI disk<br />[&nbsp; &nbsp; 6.670158] ata2: SATA link down (SStatus 0 SControl 320)<br />[&nbsp; &nbsp; 6.690636] EXT4-fs (sda1): couldn&#039;t mount as ext3 due to feature incompatibilities<br />[&nbsp; &nbsp; 6.698713] EXT4-fs (sda1): couldn&#039;t mount as ext2 due to feature incompatibilities<br />[&nbsp; &nbsp; 6.717652] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)<br />[&nbsp; &nbsp; 6.725421] VFS: Mounted root (ext4 filesystem) readonly on device 8:1.<br />[&nbsp; &nbsp; 6.732239] Freeing unused kernel memory: 156K (c0499000 - c04c0000)<br />[&nbsp; &nbsp; 6.787995] External imprecise Data abort at addr=0xb6f1e008, fsr=0x1c06 ignored.<br />[&nbsp; &nbsp; 6.795799] Kernel panic - not syncing: Attempted to kill init! exitcode=0x00000004</p><br /><p>Three obvious problems are here.</p><p>1. It sees only 128M of RAM (the board has 256). I suspect that I need to set &#039;SPARSEMEMORY=yes&#039; in the config. But it also implies the custom board header and NEED_MACH_MEMORY_H=yes also. Do I have to add the new platform just because of it?<br />Since mach-bcm doesn&#039;t contain anything about it.</p><p>2. It sees only one core of CPU. Obviously need to look into the sources for the initialization of the second one.</p><p>3. It sees wrong template of mtd. May be put the partitions also into dts?</p><p>Also, may be somebody know if this &#039;northstar prototype&#039; works on any firmware like dd-wrt and uses devices binary tree to work with periph?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252762">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						1 Nov 2014, 17:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>klirichek wrote:</cite><blockquote><p>3. It sees wrong template of mtd. May be put the partitions also into dts?</p></blockquote></div><p>What&#039;s wrong there?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252814">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">klirichek</div>
					<div class="post-datetime">
						2 Nov 2014, 10:08					</div>
				</div>
				<div class="post-content content">
					<p>The right template (from 2.36 kernel from github) looks this way:</p><p>Creating 9 MTD partitions on &quot;bcmsflash&quot;:<br />0x000000000000-0x000000040000 : &quot;boot&quot;<br />0x000000040000-0x000000340000 : &quot;os&quot;<br />0x000000340000-0x000000640000 : &quot;os1&quot;<br />0x000000640000-0x000000ed0000 : &quot;squashfs&quot;<br />0x000000ed0000-0x000000ee0000 : &quot;crash&quot;<br />0x000000ee0000-0x000000fe0000 : &quot;overlay&quot;<br />0x000000fe0000-0x000000ff0000 : &quot;board_data&quot;<br />0x000000ff0000-0x000001000000 : &quot;nvram&quot;<br />0x000000000000-0x000000fe0000 : &quot;firmware&quot;</p><p>&#039;boot&#039; contains CFE boot. Then &#039;os&#039; and &#039;os1&#039; contains identical copies of the kernel (with embedded ramdisk) (an nvram variable defines which exact one is used for the boot).<br />&#039;squashfs&#039; is RO root, &#039;crash&#039; is used to write crash logs, overlay is RW part of rootfs,&nbsp; That all is also united into &#039;firmware&#039;. And the rest contains variables - &#039;board_data&#039; and &#039;nvram&#039;.</p><p>3-rd kernel tries to determine all the things itself, and it goes wrong (for reference):<br />[&nbsp; &nbsp; 0.973419] bcm53xxspiflash spi32766.0: mx25l12805d (16384 Kbytes)<br />[&nbsp; &nbsp; 1.590590] 5 bcm47xxpart partitions found on MTD device spi32766.0<br />[&nbsp; &nbsp; 1.598451] Creating 5 MTD partitions on &quot;spi32766.0&quot;:<br />[&nbsp; &nbsp; 1.604906] 0x000000000000-0x000000040000 : &quot;boot&quot;<br />[&nbsp; &nbsp; 1.612059] 0x000000040000-0x000000ff0000 : &quot;firmware&quot;<br />[&nbsp; &nbsp; 1.619505] 0x00000004001c-0x000000040000 : &quot;linux&quot;<br />[&nbsp; &nbsp; 1.625670] mtd: partition &quot;linux&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only<br />[&nbsp; &nbsp; 1.642312] 0x000000040000-0x000000ff0000 : &quot;rootfs&quot;<br />[&nbsp; &nbsp; 1.649498] mtd: device 3 (rootfs) set to be root filesystem<br />[&nbsp; &nbsp; 1.656816] mtdsplit: no squashfs found in &quot;rootfs&quot;<br />[&nbsp; &nbsp; 1.663103] mtdsplit: no squashfs found in &quot;spi32766.0&quot;<br />[&nbsp; &nbsp; 1.669654] 0x000000ff0000-0x000001000000 : &quot;nvram&quot;</p><p>I think the simpliest way is to just write all the right template into dts. KISS <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252816">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						2 Nov 2014, 10:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>klirichek wrote:</cite><blockquote><p>The right template (from 2.36 kernel from github) looks this way:</p><p>Creating 9 MTD partitions on &quot;bcmsflash&quot;:<br />0x000000000000-0x000000040000 : &quot;boot&quot;<br />0x000000040000-0x000000340000 : &quot;os&quot;<br />0x000000340000-0x000000640000 : &quot;os1&quot;<br />0x000000640000-0x000000ed0000 : &quot;squashfs&quot;<br />0x000000ed0000-0x000000ee0000 : &quot;crash&quot;<br />0x000000ee0000-0x000000fe0000 : &quot;overlay&quot;<br />0x000000fe0000-0x000000ff0000 : &quot;board_data&quot;<br />0x000000ff0000-0x000001000000 : &quot;nvram&quot;<br />0x000000000000-0x000000fe0000 : &quot;firmware&quot;</p></blockquote></div><p>That log comes from the Xiaomi R1D. Do you use the same device? This is quite weird OpenWrt didn&#039;t detect &quot;squashfs&quot; and &quot;board_data&quot; partitions.</p><p>Not to mention it&#039;s damn stupid to flash bootloader every time you want to flash the new kernel + user space. I can&#039;t believe some company was so crazy to design it like that.</p><p>I&#039;ll need a dump of the whole serial flash to be able to see what&#039;s going on wrong in bcm47xxpart. Can you dump content of serial flash of Xiaomi R1D? A simple &quot;cat /dev/mtdblockX &gt; /usb/sflash.bin&quot; (use the last mtdblock, as it&#039;s going to match &quot;firmware&quot;) should be OK. This won&#039;t include nvram, but I can live without that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252875">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">klirichek</div>
					<div class="post-datetime">
						2 Nov 2014, 20:01					</div>
				</div>
				<div class="post-content content">
					<p>Zajec, here is the dump: <a href="https://yadi.sk/d/7WcMxx3ycTRnZ">https://yadi.sk/d/7WcMxx3ycTRnZ</a><br />Yes, this is Xiaomi R1D. The dump is taken from serial port (not yet published, but easy to investigate).<br />And the kernel is not stock, but from <a href="https://github.com/comcat/miwifi">https://github.com/comcat/miwifi</a> (look into english README, since README.md is in chinese there). In the dump the module &#039;bcmsflash&#039; - published with sources there.<br />This project is based on 2.6.36.4, and also uses several binary modules inside. And also, the project is debian-based (i.e., it suggests to use &#039;apt-get install&#039; instead of &#039;ipkg install&#039;).<br />I want to run it with &#039;vanilla&#039; openwrt, barrier-breaker.<br />And for now I am in some troubles with it. Since even using &#039;SPARSEMEM&#039; assumes relatively essential changes, so I can&#039;t guess right way, if I have to make new machine, or even new platform for it.</p>											<p class="post-edited">(Last edited by <strong>klirichek</strong> on 3 Nov 2014, 06:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253364">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">klirichek</div>
					<div class="post-datetime">
						6 Nov 2014, 13:29					</div>
				</div>
				<div class="post-content content">
					<p>Today I&#039;ve successfully booted with trunk bleeding edge on 3.18-rc2 kernel.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253594">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">bubbl3</div>
					<div class="post-datetime">
						8 Nov 2014, 11:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>klirichek wrote:</cite><blockquote><p>Today I&#039;ve successfully booted with trunk bleeding edge on 3.18-rc2 kernel.</p></blockquote></div><p>Great! What works and what doesn&#039;t?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254075">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">klirichek</div>
					<div class="post-datetime">
						12 Nov 2014, 19:30					</div>
				</div>
				<div class="post-content content">
					<p>Networking doesn&#039;t work (at all!).<br />Only 1 cpu core is seen.<br />Only 128Mb of RAM is seen.<br />Wrong flash layout is seen (think till that Zajec will see it and possibly fix).</p><p>However it seems that I have to add new machine (or may be even new platform).<br />ethernet and wifi drivers I can pick from existing releases (btw they are propriate. But they works, however).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257855">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						16 Dec 2014, 09:45					</div>
				</div>
				<div class="post-content content">
					<p>klirichek: sorry, I really forgot about this topic.</p><p>Following partitions can&#039;t be detected by OpenWrt because they seem to be empty:</p><div class="codebox"><pre><code>0x000000ed0000-0x000000ee0000 : &quot;crash&quot;
0x000000ee0000-0x000000fe0000 : &quot;overlay&quot;</code></pre></div><p>but this should be fine, as they are for Xiaomi/miwifi specific behavior. OpenWrt doesn&#039;t use &quot;crash&quot; partition and handles overlay differently.</p><p>What worries me right now is that OpenWrt can&#039;t detect this:</p><div class="codebox"><pre><code>0x000000fe0000-0x000000ff0000 : &quot;board_data&quot;</code></pre></div><p>. Could you provide me dump of this partition, please? Using original firmware it should be available as /dev/mtdblock6 if I count correctly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p263118">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">halfu</div>
					<div class="post-datetime">
						27 Jan 2015, 16:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Zajec wrote:</cite><blockquote><p>klirichek: sorry, I really forgot about this topic.</p><p>Following partitions can&#039;t be detected by OpenWrt because they seem to be empty:</p><div class="codebox"><pre><code>0x000000ed0000-0x000000ee0000 : &quot;crash&quot;
0x000000ee0000-0x000000fe0000 : &quot;overlay&quot;</code></pre></div><p>but this should be fine, as they are for Xiaomi/miwifi specific behavior. OpenWrt doesn&#039;t use &quot;crash&quot; partition and handles overlay differently.</p><p>What worries me right now is that OpenWrt can&#039;t detect this:</p><div class="codebox"><pre><code>0x000000fe0000-0x000000ff0000 : &quot;board_data&quot;</code></pre></div><p>. Could you provide me dump of this partition, please? Using original firmware it should be available as /dev/mtdblock6 if I count correctly.</p></blockquote></div><p>Here is my R1D dump.<br /><a href="http://filebin.ca/1par0gmIbWZ9/board_data.bin">http://filebin.ca/1par0gmIbWZ9/board_data.bin</a><br />It contains router MAC and SN and many information, hope it helps.<br />If further information needed, pls let me know.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p263217">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						28 Jan 2015, 10:31					</div>
				</div>
				<div class="post-content content">
					<p>halfu: can you boot <a href="https://dev.openwrt.org/changeset/44157/">44157</a> or newer, please? It should detect your partitions.</p><p>I&#039;ve analyzed firmware format of file available at <a href="http://bigota.miwifi.com/xiaoqiang/download/r1d.bin">http://bigota.miwifi.com/xiaoqiang/download/r1d.bin</a> . Looks a bit tricky <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>It&#039;s a TRX image version 2 (with 4 partitions, not just 3), see <a href="http://wiki.openwrt.org/doc/techref/header">http://wiki.openwrt.org/doc/techref/header</a> for details.<br />Partition 1: kernel I guess<br />Partition 2: SquashFS<br />Partition 3: another TRX image!<br />Parittion 4: points the same TRX image as above (two offsets in the main TRX file are equal)</p><p>I&#039;ve also analyzed this internal (embedded) TRX image. It&#039;s a version 1 (up to 3 partitions):<br />Partition 1: kernel I guess<br />Parittion 2: empty<br />Parittion 3: empty</p><p>So I guess our standard TRX files should work well, there just won&#039;t be any backup kernel bootloader could boot in case of emergency.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p268143">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						9 Mar 2015, 10:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>polejo wrote:</cite><blockquote><p>Hi&nbsp; all, I checked out trunk version, and found that BRCM 4708(netgear R6250) had been added, which is the same series with BRCM4709.</p><p>So I&nbsp; did a test on my board(Xiaomi R1D router), Follow the scripts below for a vmlinux.trx which is needed by broadcom CFE loader.</p><div class="codebox"><pre><code>arm-brcm-linux-uclibcgnueabi-objcopy -O binary -R .note -R .note.gnu.build-id -R .comment -S vmlinux piggy
./lzma_4k e piggy vmlinuz
./trx -o ow-vmlinuz.trx vmlinuz</code></pre></div><p>The result is fail.<br /></p><div class="quotebox"><blockquote><p>Starting program at 0x00008000</p></blockquote></div><p>and then kernel did not show anything.</p><br /><p>Xiaomi router&#039;s offcial kernel version is 2.6.36, and kernel of openwrt trunk support brcm-arm is ver 3.14.</p><p>Do anyone know how to boot kernel 3.14 on BRCM4709?&nbsp; Is BRCM4709 support on schedule ?<br />Help would be appreciated.</p></blockquote></div><br /><br /><p>below is my issue: my cpu is BCM958522ER which is the same series with 4708 as well, 32MB spi-nor flash, <br />###my dts file is :<br />/*<br /> * Broadcom BCM470X / BCM5301X ARM platform code.<br /> * DTS for xxxx-xxxx<br /> *<br /> * Copyright (C) 2014 xxxx &lt;xxxx@gmail.com&gt;<br /> *<br /> * Licensed under the GNU/GPL. See COPYING for details.<br /> */</p><p>/dts-v1/;</p><p>#include &quot;bcm4708.dtsi&quot;</p><p>/ {<br />&nbsp; &nbsp; compatible = &quot;xxx,xxx8883&quot;, &quot;brcm,bcm4708&quot;;<br />&nbsp; &nbsp; model = &quot;888 Networking Technology 8883 (BCM4708)&quot;;</p><p>&nbsp; &nbsp; chosen {<br />&nbsp; &nbsp; &nbsp; &nbsp; bootargs = &quot;console=ttyS0,115200 earlyprintk&quot;;<br />&nbsp; &nbsp; };</p><p>&nbsp; &nbsp; memory {<br />&nbsp; &nbsp; &nbsp; &nbsp; reg = &lt;0x00000000 0x08000000<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 0x88000000 0x18000000&gt;; /* 128MB + 128MB = 256MB */<br />&nbsp; &nbsp; };</p><p>&nbsp; &nbsp; chipcommonA {<br />&nbsp; &nbsp; &nbsp; &nbsp; uart0: serial@0300 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = &quot;okay&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; };</p><p>&nbsp; &nbsp; &nbsp; &nbsp; uart1: serial@0400 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = &quot;okay&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; };</p><p>};</p><br /><br /><br /><br /><br /><br /><br /><br /><p>###boot log: (I updated the xxx-squashfs.trx to the flash)</p><p>Hit any key to stop autoboot:&nbsp; 0 <br />Checking TRX Image at addr 1e200000 ...<br />&nbsp; &nbsp;Uncompressing&nbsp; ... Primary TRX image OK<br />kernel args : console=ttyS0,115200 ubi.mtd=5 root=ubi0:rootfs ro rootflags=sync rootfstype=ubifs user_debug=31<br />Booting from Primary Partition<br />kernel_args console=ttyS0,115200 ubi.mtd=5 root=ubi0:rootfs ro rootflags=sync rootfstype=ubifs user_debug=31<br />Start addr 00008000 machid 127f Parmameter addr 00100000 ...</p><p>Starting kernel ...<br />Uncompressing Linux...</p><p>XZ-compressed data is corrupt</p><p>-- System halted</p><br /><br /><br /><p>I want to know why this error arise, please help me!<br />any hints will be appreciated.</p>											<p class="post-edited">(Last edited by <strong>banglang.huang</strong> on 10 Mar 2015, 03:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277840">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">xanadunwh</div>
					<div class="post-datetime">
						28 May 2015, 11:31					</div>
				</div>
				<div class="post-content content">
					<p>is any progress about this issue?<br />does the rom works well on the r1d router ?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>