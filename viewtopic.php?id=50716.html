<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Bad Gateway message when editing Wifi in LuCi</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p233996">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ppj</div>
					<div class="post-datetime">
						20 May 2014, 18:33					</div>
				</div>
				<div class="post-content content">
					<p>I have installed the trunk version in a TP-Link WR842ND-v2 and when I try to access the Wifi in the LuCi web interface I get:<br /><strong><br />Bad Gateway</strong></p><p><strong>The process did not produce any response: </strong></p><p>List of installed packages<br /></p><div class="codebox"><pre><code>base-files - 152-r40772
boost-chrono - 1_51_0-1
boost-system - 1_51_0-1
boost-thread - 1_51_0-1
busybox - 1.19.4-7
confuse - 2.6-2
ddns-scripts - 1.0.0-22
dnsmasq - 2.70-1
dropbear - 2014.63-1
firewall - 2-59
fstools - 2014-04-17-fe222812cc12d37647fbb8667851eb005ea95331
hostapd-common - 2014-04-24-1
iptables - 1.4.21-1
iw - 3.14-1
jshn - 2014-05-05-f32a53f92b377fa92dbafd2ce3d2df93fffb314d
kernel - 3.10.36-1-611dbc08f2c0e4ba1323efb15e62b02d
kmod-ath - 3.10.36+2014-03-31-1
kmod-ath9k - 3.10.36+2014-03-31-1
kmod-ath9k-common - 3.10.36+2014-03-31-1
kmod-cfg80211 - 3.10.36+2014-03-31-1
kmod-crypto-aes - 3.10.36-1
kmod-crypto-arc4 - 3.10.36-1
kmod-crypto-core - 3.10.36-1
kmod-gpio-button-hotplug - 3.10.36-1
kmod-ipt-conntrack - 3.10.36-1
kmod-ipt-core - 3.10.36-1
kmod-ipt-nat - 3.10.36-1
kmod-ipt-nathelper - 3.10.36-1
kmod-ledtrig-usbdev - 3.10.36-1
kmod-lib-crc-ccitt - 3.10.36-1
kmod-mac80211 - 3.10.36+2014-03-31-1
kmod-nls-base - 3.10.36-1
kmod-ppp - 3.10.36-1
kmod-pppoe - 3.10.36-1
kmod-pppox - 3.10.36-1
kmod-slhc - 3.10.36-1
kmod-usb-core - 3.10.36-1
kmod-usb2 - 3.10.36-1
libblobmsg-json - 2014-05-05-f32a53f92b377fa92dbafd2ce3d2df93fffb314d
libc - 0.9.33.2-1
libgcc - 4.8-linaro-1
libip4tc - 1.4.21-1
libip6tc - 1.4.21-1
libiwinfo - 39
libiwinfo-lua - 39
libjson-c - 0.11-2
libjson-script - 2014-05-05-f32a53f92b377fa92dbafd2ce3d2df93fffb314d
liblua - 5.1.5-1
libnl-tiny - 0.1-3
libopenssl - 1.0.1g-1
libprotobuf-c - 0.15-1
libpthread - 0.9.33.2-1
librt - 0.9.33.2-1
libstdcpp - 4.8-linaro-1
libubox - 2014-05-05-f32a53f92b377fa92dbafd2ce3d2df93fffb314d
libubus - 2014-05-06-9fda19140e65457d967ff6fe424e420f656c06c9
libubus-lua - 2013-03-17-47b38c98ae1690c3a4430b7850f207a4b9294896
libuci - 2014-04-11.1-1
libuci-lua - 2013-01-04.1-1
libxtables - 1.4.21-1
lua - 5.1.5-1
luci - svn-r9941-1
luci-app-ddns - svn-r10233-1
luci-app-firewall - svn-r9941-1
luci-i18n-english - svn-r10233-1
luci-i18n-portuguese-brazilian - svn-r10233-1
luci-lib-core - svn-r9941-1
luci-lib-ipkg - svn-r9941-1
luci-lib-nixio - svn-r9941-1
luci-lib-sys - svn-r9941-1
luci-lib-web - svn-r9941-1
luci-mod-admin-core - svn-r9941-1
luci-mod-admin-full - svn-r9941-1
luci-proto-core - svn-r9941-1
luci-proto-ppp - svn-r9941-1
luci-sgi-cgi - svn-r9941-1
luci-theme-base - svn-r10233-1
luci-theme-bootstrap - svn-r10233-1
mtd - 20
netifd - 2014-05-15-e784303c4ca8ee86e57521a00ef5f9d0e98617f8
odhcpd - 2014-04-24-d3cc614ef3120d504f2029a8e9494dccafdc14dd
opkg - 9c97d5ecd795709c8584e972bfdf3aee3a5b846d-7
ppp - 2.4.5-10
ppp-mod-pppoe - 2.4.5-10
procd - 2014-03-18-7a9cbcd88b6cf3c0cbee6d4f76c2adaedc54058d
protobuf - 2.4.1-1
squid - 2.7.STABLE9-2
swconfig - 10
uboot-envtools - 2013.10-3
ubox - 2014-03-27-1d9d2e6ae99c9ba72d1bc40e554d5f422c9b9196
ubus - 2014-05-06-9fda19140e65457d967ff6fe424e420f656c06c9
ubusd - 2014-05-06-9fda19140e65457d967ff6fe424e420f656c06c9
uci - 2014-04-11.1-1
uhttpd - 2013-03-15-3675d407ecf4908a231eb6bde6bb6408f20a9e81
uhttpd-mod-ubus - 2013-03-15-3675d407ecf4908a231eb6bde6bb6408f20a9e81
wpad-mini - 2014-04-24-1
zlib - 1.2.8-1</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234016">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ppj</div>
					<div class="post-datetime">
						20 May 2014, 21:48					</div>
				</div>
				<div class="post-content content">
					<p>It seems the luci process is generating a SEGFAULT</p><p>I used the default test process of creating a /var/cgi-bin/luci.dbg with +x permission as below</p><div class="codebox"><pre><code>#!/usr/bin/lua

require &quot;nixio&quot;

dbg = io.open(&quot;/tmp/luci.req&quot;, &quot;w&quot;)

for k, v in pairs(nixio.getenv()) do
        dbg:write(string.format(&quot;export %s=%q\n&quot;, k, v))
end

dbg:write(&quot;/www/cgi-bin/luci\n&quot;)
dbg:close()

nixio.exec(&quot;/www/cgi-bin/luci&quot;)</code></pre></div><p>Then I executed the generated file and got a segfault.<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# cat /tmp/luci.req
export HTTP_ACCEPT=&quot;*/*&quot;
export SCRIPT_NAME=&quot;/cgi-bin/luci.dbg&quot;
export QUERY_STRING=&quot;status=1&amp;_=0.1391877850983292&quot;
export HTTP_ACCEPT_ENCODING=&quot;gzip, deflate&quot;
export SERVER_ADDR=&quot;192.168.0.1&quot;
export GATEWAY_INTERFACE=&quot;CGI/1.1&quot;
export HTTP_AUTHORIZATION=&quot;&quot;
export CONTENT_LENGTH=&quot;&quot;
export SERVER_PORT=&quot;80&quot;
export REMOTE_PORT=&quot;50327&quot;
export SCRIPT_FILENAME=&quot;/www/cgi-bin/luci.dbg&quot;
export REQUEST_URI=&quot;/cgi-bin/luci.dbg/;stok=23c5206b606199ca8397d9bb4251af44?status=1&amp;_=0.1391877850983292&quot;
export SERVER_PROTOCOL=&quot;HTTP/1.1&quot;
export HTTP_ACCEPT_CHARSET=&quot;&quot;
export REMOTE_HOST=&quot;192.168.0.130&quot;
export REMOTE_ADDR=&quot;192.168.0.130&quot;
export SERVER_NAME=&quot;192.168.0.1&quot;
export HTTP_CONNECTION=&quot;keep-alive&quot;
export REDIRECT_STATUS=&quot;200&quot;
export PATH=&quot;/sbin:/usr/sbin:/bin:/usr/bin&quot;
export HTTP_REFERER=&quot;http://192.168.0.1/cgi-bin/luci.dbg&quot;
export SERVER_SOFTWARE=&quot;uhttpd&quot;
export HTTP_COOKIE=&quot;sysauth=afd7481fff8170a14fe9a2f8d3c2ac41&quot;
export HTTP_HOST=&quot;192.168.0.1&quot;
export DOCUMENT_ROOT=&quot;/www&quot;
export CONTENT_TYPE=&quot;&quot;
export PATH_INFO=&quot;/;stok=23c5206b606199ca8397d9bb4251af44&quot;
export HTTP_USER_AGENT=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/537.75.14&quot;
export HTTP_ACCEPT_LANGUAGE=&quot;pt-br&quot;
export REQUEST_METHOD=&quot;GET&quot;
/www/cgi-bin/luci
root@OpenWrt:~# sh /tmp/luci.req
Segmentation fault</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234024">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ppj</div>
					<div class="post-datetime">
						20 May 2014, 22:55					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://dev.openwrt.org/ticket/16557">https://dev.openwrt.org/ticket/16557</a> is the bug in the issue tracker</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234025">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						20 May 2014, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>I am unable to reproduce the problem. Please make the luci.dbg command crash again after setting &quot;ulimit -c unlimited&quot; in the shell. Mail me the resulting core-dump and a zipped copy of build_dir/target-mips_34kc_uClibc-0.9.33.2/libiwinfo/ in your buildroot to jow-at-openwrt-dot-org.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234027">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">ppj</div>
					<div class="post-datetime">
						20 May 2014, 23:07					</div>
				</div>
				<div class="post-content content">
					<p>I have sent the files.</p>											<p class="post-edited">(Last edited by <strong>ppj</strong> on 20 May 2014, 23:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234029">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						20 May 2014, 23:31					</div>
				</div>
				<div class="post-content content">
					<p>Didn&#039;t help unfortunately. scp the core file somewhere to your pc, e.g. /tmp. Navigate to your buildroot and run</p><div class="codebox"><pre><code>./scripts/remote-gdb /tmp/luci.1726.11.1400616094.core \
  build_dir/target-mips_34kc_uClibc-0.9.33.2/lua-5.1.5/src/lua</code></pre></div><p>Once in the gdb shell, enter &quot;bt full&quot; and post the output here.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234083">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ppj</div>
					<div class="post-datetime">
						21 May 2014, 17:45					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately or fortunately when I upgraded to r40804 and executed a:</p><div class="codebox"><pre><code>make dirclean
make menuconfig
make</code></pre></div><p>The problem vanished.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>