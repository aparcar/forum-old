<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> (TL-WR703n / GPIO / Misc) AR9331 pinouts?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Oct 2014 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=36471&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=36471&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=6.html">6</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p172843">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">NutBolt</div>
					<div class="post-datetime">
						20 Jul 2012, 15:45					</div>
				</div>
				<div class="post-content content">
					<p>Okay, you guys asked for it. I removed the SoC - will that help identify more GPIO?<br /><span class="postimg"><img src="http://nut-bolt.nl/assets/wr703n-soc-removed.jpg" alt="http://nut-bolt.nl/assets/wr703n-soc-removed.jpg" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172845">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						20 Jul 2012, 16:02					</div>
				</div>
				<div class="post-content content">
					<p>A small update: I have removed resistors and soldered wires to GPIOs 0, 7, 9, 10, 14, 29. I have wired access to ground, 3.3 and 5 volts. And the unit still boots and is accessible. I did try and solder to GPIO15, but managed to rip the whole trace off the board! <br />To get this far, I am indebted to so many of you and other on the net. My crib sheet photos (shamelessly stolen and in one case edited - sorry to the originators) are here: <a href="http://imgur.com/a/vlVYr">http://imgur.com/a/vlVYr</a><br />Next up is connecting all the wires to a header and trying some GPIO access.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172846">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						20 Jul 2012, 16:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>imperfect wrote:</cite><blockquote><p>If someone else wants to try, here is my notes:<br />1) GPIOs 1 and 2 are connected to the group of resistances at the bottom of the board (R2 R14). Not sure if they are usable, they can be nesassary for the DRAM initialization<br />2) The contact group near R57 R60 and R62 is SPI. 10.1KOhm pull-ups are used for SPI lines, so need to check if i2c will work with the same pull-up. <br />3) GPIO6 is connected to the voltage regulator U6 (R110, R107). Not sure about it&#039;s functions, but changing it&#039;s state doesn&#039;t affect USB functionality. Maybe it&#039;s an overcurrent interrupt?</p></blockquote></div><p>imperfect, can you elaborate on the SPI contacts? </p><p>love your work btw.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172918">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">bertc3p0</div>
					<div class="post-datetime">
						22 Jul 2012, 02:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robthebrew wrote:</cite><blockquote><p>imperfect, can you elaborate on the SPI contacts? </p><p>love your work btw.</p></blockquote></div><p>IMHO the flash is connected through SPI (MOSI,MISO,CLK,CS0). CS1 is shared with GPIO_0.<br />Should be all you need to connect another SPI device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173134">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						24 Jul 2012, 14:49					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll worry about SPI later. Here are short notes on what I have so far tested:</p><p>Testing output control via LEDs:<br />9,10 always dimly lit (from boot on): need to check voltage on these. I think I&#039;ve seen there might be a problem controlling these without disabling the serial interface.<br />7 is lit at boot (all others bar&nbsp; the 9,10 are unlit), but thereafter can be controlled. <br />0,14,29 behave as expected.</p><p>Update:</p><p>configured as inputs and supplying 3v3 via a 10K resistor shows that 0,7,9,14,29 are working. 10 is high irrespective of voltage applied.</p><p>Note though, that I haven&#039;t disabled the serial port, so this may well be the source of the issues with 9 and 10.</p>											<p class="post-edited">(Last edited by <strong>robthebrew</strong> on 25 Jul 2012, 10:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173145">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						24 Jul 2012, 17:50					</div>
				</div>
				<div class="post-content content">
					<p>hey how to find gpio pins on a router with a multimeter i want to find gpio pins another tplink router i have played gpioctl and found i could control over 4 gpio pins in my router now it is time to find then how should i use the test probes from the multimeter</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173193">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						25 Jul 2012, 08:45					</div>
				</div>
				<div class="post-content content">
					<p>Others will know more than me, but:<br />1. find ground (like that on the USB port)<br />2. look for traces coming from the SoC via just one resistor (10K?) and linked to ground: these are most likely unused GPIOs<br />3. put your multimeter between gnd and the resister (try both sides)<br />4. try this until you get a reading (change):<br />(this is for GPIO0)<br />echo 0 &gt; /sys/class/gpio/export<br />echo out &gt; /sys/class/gpio/gpio0/direction<br />echo 0 &gt; /sys/devices/virtual/gpio/gpio0/value<br />echo 1 &gt; /sys/devices/virtual/gpio/gpio0/value</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173440">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						27 Jul 2012, 17:10					</div>
				</div>
				<div class="post-content content">
					<p>Further update: I now have w1 interface on any of the fully functional pins (ie not 9,10 which I am leaving a serial access in case I screw up).<br />I have r32878 installed so had to --force-depends to get the w1 kmods installed, but I am now reading temps via a dallas sensor.<br />I followed this to get running:<br /><a href="http://www.instructables.com/files/orig/F1E/MZR7/H4AGKOCR/F1EMZR7H4AGKOCR.txt">http://www.instructables.com/files/orig … AGKOCR.txt</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173729">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						31 Jul 2012, 00:34					</div>
				</div>
				<div class="post-content content">
					<p>I am not sure, but it looks like that J1 (bottom edge of the PCB in the above picture) is a shunt directly on the antenna path, or am I wrong?</p><p>If this is the case, this may be a more convenient place (by removing it!) to solder an external SMA cable like this:<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=152457#p152457">https://forum.openwrt.org/viewtopic.php … 57#p152457</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173730">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						31 Jul 2012, 00:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>NutBolt wrote:</cite><blockquote><p>Okay, you guys asked for it. I removed the SoC - will that help identify more GPIO?</p></blockquote></div><p>I don&#039;t know if this will help to find more GPIOs, but thank you!</p><p>What would be very interesting would be to unsolder all the big chips (Flash, SDRAM, crystal, transformer, maybe connectors) and take some hi-res pictures, so people can work on reverse-engineering the full schematic: it really looks like the board is only 2-layer (maybe more, but not very complex)...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173769">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						31 Jul 2012, 15:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>I am not sure, but it looks like that J1 (bottom edge of the PCB in the above picture) is a shunt directly on the antenna path, or am I wrong?</p><p>If this is the case, this may be a more convenient place (by removing it!) to solder an external SMA cable like this:<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=152457#p152457">https://forum.openwrt.org/viewtopic.php … 57#p152457</a></p></blockquote></div><p>That is possible. How best to check? Measure continuity between the shunt and the visible antenna underneath? <br />Presumably you would have to find a solderable gnd on the top side for the shield?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173772">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						31 Jul 2012, 15:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robthebrew wrote:</cite><blockquote><p>That is possible. How best to check? Measure continuity between the shunt and the visible antenna underneath? <br />Presumably you would have to find a solderable gnd on the top side for the shield?</p></blockquote></div><p>The round pad just above it looks like a good ground to me! I&#039;ll try to check!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174105">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						5 Aug 2012, 15:17					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>This post is an attempt to understand the purpose of each and every component on the TP-Link TL-WR703N Wireless router PCB, Rev. 1:1, as pictured in the <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n#internal.images">OpenWRT Wiki page</a> related to this product:</p><p><a href="http://wiki.openwrt.org/_detail/toh/tp-link/tl-wr703n_top.jpg?id=toh%3Atp-link%3Atl-wr703n"><span class="postimg"><img src="http://wiki.openwrt.org/_media/toh/tp-link/tl-wr703n_top.jpg?w=600" alt="http://wiki.openwrt.org/_media/toh/tp-link/tl-wr703n_top.jpg?w=600" /></span></a><a href="http://wiki.openwrt.org/_detail/toh/tp-link/tl-wr703n_bottom.jpg?id=toh%3Atp-link%3Atl-wr703n"><span class="postimg"><img src="http://wiki.openwrt.org/_media/toh/tp-link/tl-wr703n_bottom.jpg?w=600" alt="http://wiki.openwrt.org/_media/toh/tp-link/tl-wr703n_bottom.jpg?w=600" /></span></a></p><p>Having no access to the board schematic nor to the Atheros AR9331 SoC datasheet and although I am personally an experienced electronic engineer, this work is solely based on observation of the above pictures and experimentation on my own board. For this reason, this work cannot be certified to be 100% accurate or correct, and may well contain errors or mistakes. If you spot some, please report!</p><p>We don’t know for sure, but this board looks like it is only double-sided (or only contains a few not very complex internal layers), so studying the above picture should prove good enough to understand the board’s internals. Hopefully someone will take pictures of the bare PCB, so this assertion can be verified!</p><p>In order to make it easier to follow on the pictures without jumping back and forth, I decided to explore the picture sequentially (top, then bottom picture), and in a zigzag starting from the top left corner.</p><p><span style="color: #FF0000"><strong><span class="bbu">PCB Top Side</span></strong></span></p><p><strong><span class="bbu">RESET Switch</span></strong><br /><strong>SW2</strong> is a R/A SMT tactile momentary switch. The nearby <strong>R91</strong>/<strong>R92</strong> and <strong>C62</strong> components are probably used to implement a low-pass filter for filtering out spurious glitches.</p><p><strong><span class="bbu">MicroUSB Power Connector</span></strong><br /><strong>USB1</strong> is a R/A SMT MicroUSB socket, out of which only VBUS and GND pins are used to power the device.</p><p>The D+/D- and ID remaining pins are unused and can thus be repurposed for another usage, like the D+/D- signals coming out of an USB/TTL UART converter connected to the serial console. Note however that this setup prevents access to the early bootloader character interrupt of the boot sequence, as in this case pluging the USB cable would power the device and not let a user have a chance to type in a character quickly because of the lengthy USB enumeration process.</p><p>Please note that the connector shield and GND are not connected together directly, so taking the ground on any connector shield is not a good idea!</p><p><strong><span class="bbu">Ethernet Connector</span></strong><br /><strong>J3</strong> is a low-profile passive Ethernet RJ45 socket. It is located into a board cut-out to minimize its overall height. This connector does not contain any LED, nor transformers or EMC filters.</p><p>The differential RX/TX signals can be clearly identified, as they are routed away from any other traces with controlled impedance.</p><p><strong>C37</strong> is used to connect the Ethernet connector shield to GND.</p><p><strong><span class="bbu">LED</span></strong><br /><strong>LED1</strong>/<strong>LED2</strong> is a dual footprint blue LED, but it looks like the 3 mm through-hole <strong>LED2</strong> is never mounted. <strong>R83</strong> is the associated current-limiting resistor for the LED.</p><p>Note that the round copper pad is not a pad or a test point: it is a “fiducial mark” used for calibrating the component’s pick &amp; place machine during assembly. There are 4 of them on the top side of the board, and 2 (1 is tinned!) on the bottom side.</p><p><strong><span class="bbu">Ethernet Transformer</span></strong><br /><strong>T1</strong> is an <a href="http://www.cptc.com.tw/product/doc/Single%20Port/H1601CG.pdf">H1601CG</a> 10/100baseT Single-Port Ethernet Transformer. This device contains both the dual 1:1 isolation transformer with mid-point connection (1 for each RX and TX pair), and the dual common-mode filter (again, 1 for each pair). The purpose of this component is both to provide a galvanic isolation between the internal circuitry and the Ethernet cable pairs, and to filter common-mode noise that may flow on these wires.</p><p>The solution to use a separate Ethernet transformer instead of the common integrated “MagJack™” socket is probably economic, but this also provide a better overall isolation because of the increased distance to nearby components.</p><p>The resistor/capacitor groups <strong>C52</strong>/<strong>R78</strong>/<strong>R79</strong>/<strong>C48</strong>/<strong>C49</strong> on one side, and <strong>R76</strong>/<strong>R77</strong>/<strong>C50</strong>/<strong>C51</strong>/<strong>C53</strong> on the other side, are 2 sets of common PI filters required for the Ethernet differential signals.</p><p><strong><span class="bbu">USB Connector</span></strong><br /><strong>USB2</strong> is a R/A SMT USB-A socket providing an USB host connector. The original purpose is for hooking up a 3G USB dongle, but it can be used for numerous other things.</p><p><strong>C113</strong>/<strong>C115</strong> are used to connect the shield to the GND. 2 parallel capacitors of different values are used, in order to provide a higher band-pass filtering by the overlapping 2 filter poles.</p><p><strong>D1</strong> (and <strong>D2</strong> on the opposite PCB side) is a dual clamping diode providing ESD (Electro-Static Discharge) protection by limiting the incoming voltages on D+/D- signals to both GND and VBUS.</p><p><strong>R101</strong>/<strong>R102</strong>/<strong>R103</strong>/<strong>R104</strong> are USB impedance-matching resistors, in series with both D+ and D- signals. These are required to meet the USB specification, including the famous “eye-diagram”. The use of 2 sets of resistors is rather unusual.</p><p>The D+/D- signals can be clearly identified, as they are routed in parallel and away from other signals to provide controlled impedance.</p><p><strong><span class="bbu">First &amp; Second Undefined Resistor Groups</span></strong><br />There are 2 groups of resistors <strong>R57</strong>/<strong>R60</strong>/<strong>R62</strong>/<strong>R63</strong> and <strong>R15</strong>/<strong>R16</strong>/<strong>R17</strong>/<strong>R18</strong> that have no clear purpose. They look like pull-down resistors for a variety of signals.</p><p>A guess would be they are used for POR (Power-On Reset) identification/function selection, but this is infirmed by the fact that <strong>R15</strong> has been identified by imperfect as being a pull-down resistor for the GPIO7 signal, and <strong>R17</strong> for the GPIO29 signal.</p><p>Another guess is that the AR9331 SoC having “diversity” antenna capabilities (i.e. it can use 2 antennas and switch to the best one) and probably also external PA (Power Amplifier) drive capabilities, there may be some GPIO pins in this area that could be used for control purpose. As the TL-WR703N has only a single antenna and no external PA, they are thus unused and pulled down to GND by these resistors.</p><p><strong><span class="bbu">AR9331 CPU + Integrated Wifi Chipset</span></strong><br /><strong>U1</strong> is the main AR9331 CPU and Integrated Wifi Chipset from Atheros. Unfortunately, its datasheet is not publicly available, so we can only guess its pinout.</p><p>Note that strangely, this chip has 2 concentric rows of pins, as can be observed on NutBolt’s <a href="https://forum.openwrt.org/viewtopic.php?pid=172843#p172843">picture</a> of the PCB with unsoldered <strong>U1</strong>.</p><p><strong>C52</strong> looks like a decoupling capacitor for <strong>U1</strong>, as well as <strong>C35</strong>/<strong>C36</strong>, along with the <strong>L11</strong> filter choke.</p><p><strong><span class="bbu">DDR SDRAM</span></strong><br /><strong>U2</strong> is a 16Mbit x 16bit (16Mibit*16=256 mebibit. 256 mebibit/8=32MiByte) 400MHz chip Zentel <a href="http://wiki.openwrt.org/_media/toh/d-link/d-link.dir-615e4-a3s56d3040etp.pdf">A3S56D40FTP</a> DDR1 SDRAM chip, providing 32MB of volatile memory.</p><p>This chip can be upgraded to any pin-to-pin compatible 32Mbit x 16bit 400 MHz (or even 333 MHz) DDR1 SDRAM chip to double the RAM capacity.</p><p>All the resistors <strong>R21</strong>/<strong>R23</strong>/<strong>R25</strong>/<strong>R27</strong>/<strong>R29</strong>/<strong>R31</strong>/<strong>R33</strong>/<strong>R35</strong>/<strong>R50</strong>/<strong>R52</strong>, as probably <strong>R54</strong>/<strong>R56</strong> are impedance-matching series resistors for the DDR address/control/data signals.</p><p><strong>C103</strong> is a large decoupling capacitor for the DDR SDRAM chip.</p><p><strong>Q2</strong> looks like a general-purpose BC849C PNP transistor. Its purpose, as well as the related parts <strong>C92</strong>/<strong>R98</strong> (not mounted)/<strong>R106</strong> is unknown, but may be related to the SDRAM chip or the nearby LED.</p><p>Note there is a TPDDR test point in the vicinity.</p><p><strong><span class="bbu">Console UART</span></strong><br /><strong>R82</strong> is a pull-up resistor for the incoming TP_IN UART RxD signal, and 2 unmounted capacitors <strong>C55</strong>/<strong>C57</strong> can be used for filtering the TP_IN/TP_OUT signals.</p><p>These signals seems to be LVTTL (3.3 V) compatible. In order to be usable on a PC, an RS232 level translator or USB/UART converter must be used.</p><p><strong><span class="bbu">Third Undefined Resistor Group</span></strong><br /><strong>R4</strong>/<strong>R11</strong>/<strong>R12</strong> form an unidentified resistor group, although <strong>R4</strong> has been identified by imperfect as a pull-down resistor for the GPIO0 signal.</p><p><strong><span class="bbu">Crystal</span></strong><br /><strong>Y1</strong> is a 25 MHz SMT crystal, with the corresponding <strong>C60</strong>/<strong>C61</strong> bank capacitors.</p><p>This crystal frequency is used to feed PLLs inside the AR9331 SoC to generate all the required system frequencies (400 MHz for the CPU and SDRAM, 200 MHz for the AHB bus).</p><p><strong><span class="bbu">Antenna Matching Network</span></strong><br />Several RF filter networks can be identified: <strong>C33</strong>/<strong>C34</strong>/<strong>L6</strong>/<strong>L7</strong>/<strong>L8</strong>/<strong>L9</strong>, in parallel to <strong>C19</strong>/<strong>C22</strong>/<strong>C23</strong>/<strong>C25</strong>/<strong>L2</strong>/<strong>L4</strong>, followed by <strong>C7</strong>/<strong>C20</strong>/<strong>C21</strong>/<strong>C26</strong>/<strong>C27</strong>/<strong>C28</strong>/<strong>C30</strong>/<strong>L3</strong>/<strong>L7</strong>.</p><p><strong>J1</strong> is a 0 ohm resistor shunt that provides a convenient way to disconnect the printed antenna on the other side of the PCB from the chip. Its pad closest to the <strong>U1</strong> chip and the large GND pad on its right can then be used to solder an external antenna.</p><p><span style="color: #FF0000"><strong><span class="bbu">PCB Bottom Side</span></strong></span></p><p><strong><span class="bbu">Ethernet Connector</span></strong><br />The bottom of the <strong>J3</strong> Ethernet connector is located into a PCB cut-out. <strong>C45</strong> provides the ESD 2kV protection for the Ethernet, and <strong>R64</strong>/<strong>R65</strong>/<strong>R68</strong>/<strong>R71</strong> are the Ethernet cable impedance-matching resistors.</p><p><strong><span class="bbu">First-Level Power Supplies</span></strong><br />Right below the <strong>USB1</strong> MicroUSB connector is located <strong>U6</strong>, an unidentified LDO (Low Drop-Out) linear voltage regulator, with its related <strong>C119</strong> filter capacitor. The output voltage is unknown (TBD).</p><p><strong>R113</strong> (not mounted) is probably a placeholder for a shunt 0 ohm resistor to be mounted as an alternative to <strong>U6</strong>.</p><p>The purpose of the <strong>R107</strong>/<strong>R108</strong>/<strong>R109</strong>/<strong>R110</strong>/<strong>R111</strong>/<strong>R112</strong> resistor group is unknown, although some kind of resistor dividers for generating miscellaneous voltage references is suspected.</p><p><strong>C107</strong>/<strong>C108</strong> are used to connect the MicroUSB connector shield to GND.</p><p><strong>U5</strong> is the main unidentified step-down 3.3 V switching voltage regulator, along with the <strong>L14</strong> ferrite-core self, <strong>C112</strong> input filter ceramic capacitor, <strong>C109</strong> output filter ceramic capacitor and feedback circuit <strong>R99</strong>/<strong>R100</strong>/<strong>C106</strong>.</p><p>2 test points TPGND and T3V3 are available, and 2 capacitors <strong>C110</strong> (not mouted)/<strong>C111</strong> are used to connect the GND to the RF antenna GND.</p><p><strong><span class="bbu">USB Connector</span></strong><br />Below the <strong>USB2</strong> connector is the capacitor <strong>C114</strong> to connect the USB connector shield to GND, and the <strong>D2</strong> dual clamping diode (see description on top PCB side).</p><p><strong><span class="bbu">Unidentified Transistor</span></strong><br /><strong>Q1</strong> looks like a BC849C PNP transistor, but its purpose, along with the related components <strong>R93</strong> (not mounted)/<strong>C70</strong>/<strong>C84</strong>/<strong>C47</strong>/<strong>C38</strong>/<strong>C46</strong> is unsure.</p><p>However, the TP2V0 test point nearby suggests that this circuit might be used for controlling the Ethernet analog voltage at 2.0 V.</p><p><strong><span class="bbu">DDR SDRAM</span></strong><br />Below the <strong>U2</strong> DDR1 SDRAM chip are located some additional impedance-matching series resistors for the DDR address/control/data signals <strong>R37</strong>/<strong>R39</strong>/<strong>R41</strong>/<strong>R43</strong>/<strong>R45</strong>/<strong>R47</strong>/<strong>R48</strong>/<strong>R49</strong>/<strong>R51</strong>/<strong>R53</strong>, <strong>R22</strong>/<strong>R24</strong>/<strong>R26</strong>/<strong>R28</strong>/<strong>R42</strong>, <strong>R40</strong>/<strong>R32</strong>/<strong>R34</strong>/<strong>R36</strong>/<strong>R38</strong>/<strong>R40</strong>/<strong>R44</strong>/<strong>R46</strong> and <strong>R55</strong>/<strong>R59</strong>/<strong>R61</strong>.</p><p>There are also some decoupling capacitors <strong>C9</strong>/<strong>C10</strong>/<strong>C11</strong>/<strong>C12</strong>/<strong>C13</strong>/<strong>C14</strong>/<strong>C15</strong>/<strong>C16</strong>/<strong>C17</strong> sprinkled all around.</p><p>Please note the serpentine traces for the impedance and length-matched signal between the CPU and the DDR SDRAM chip.</p><p><strong><span class="bbu">AR9331 CPU + Integrated Wifi Chipset</span></strong><br />Below the <strong>U1</strong> chip are located a lot of decoupling capacitors <strong>C1</strong>/<strong>C2</strong>/<strong>C3</strong>/<strong>C4</strong>/<strong>C5</strong>/<strong>C63</strong>/<strong>C64</strong>/<strong>C65</strong>/<strong>C66</strong>/<strong>C67</strong>/<strong>C71</strong>/<strong>C72</strong>/<strong>C73</strong>/<strong>C74</strong>/<strong>C75</strong>/<strong>C76</strong>/<strong>C77</strong>/<strong>C78</strong>/<strong>C79</strong>/<strong>C80</strong>/<strong>C81</strong>/<strong>C82</strong>/<strong>C83</strong>/<strong>C86</strong>/<strong>C87</strong>/<strong>C88</strong>/<strong>C89</strong>/<strong>C90</strong>/<strong>C91</strong>/<strong>C93</strong>/<strong>C94</strong>/<strong>C96</strong>/<strong>C97</strong>/<strong>C99</strong>/<strong>C100</strong>/<strong>C105</strong>, 2 self <strong>L1</strong> and <strong>L13</strong> (this one probably for the Ethernet power supply) and a 0 ohm shunt resistor <strong>R94</strong>.</p><p>Please note the strange central hole below the <strong>U1</strong> chip.</p><p><strong><span class="bbu">Second-Level Power Supplies</span></strong><br />It looks like <strong>U1</strong> is integrating several LDO voltage regulators, as there are several power supply-related test points TP2V0 (seen above, suspected to provide supply for analog Ethernet), TP2V5 (for supplying the <strong>U2</strong> DDR1 SDRAM chip) and TP1V2 (for the core voltage supply).</p><p><strong><span class="bbu">SPI Flash</span></strong><br /><strong>U3</strong> is a Spansion <a href="http://www.spansion.com/Support/Datasheets/S25FL032P_00.pdf">S25FL032P</a> 32Mbit 104-MHz SPI Flash memory in SO8 package. This chip provides 4MB of Flash memory for permanent storage.</p><p>This chip can be upgraded to a 64 Mbit pin-to-pin compatible chip (like the Eon EN25Q64 chip) to provide 8MB of Flash memory.</p><p><strong>C18</strong>/<strong>C24</strong>/<strong>C85</strong> are probably decoupling capacitors related to the Flash memory chip <strong>U3</strong> or the main CPU chip <strong>U1</strong>.</p><p>The role of the 2 resistors <strong>R84</strong> and <strong>R95</strong> is unclear, although <strong>R95</strong> is large enough to be a possible removable option.</p><p><strong><span class="bbu">Fourth &amp; Fifth Undefined Resistor Groups</span></strong><br /><strong>R7</strong>/<strong>R96</strong>/<strong>R97</strong> and <strong>R2</strong>/<strong>R3</strong>/<strong>R13</strong>/<strong>R14</strong> are undefined resistors whose purpose is unknown.</p><p><strong><span class="bbu">Antenna</span></strong><br /><strong>AN1</strong> is the PCB antenna, and <strong>C29</strong>/<strong>C31</strong>/<strong>C32</strong> (not mounted) are the antenna matching capacitive divider network.</p><p>That&#039;s all folks!</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 5 Aug 2012, 17:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174112">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">Bombyx</div>
					<div class="post-datetime">
						5 Aug 2012, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>Nice work! I am impressed. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Thank you very much, Squonk.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174121">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						5 Aug 2012, 18:23					</div>
				</div>
				<div class="post-content content">
					<p>Thanks! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I added it to the <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n_pcb">Wiki</a>, so it can be searched by section.</p><p>I added a link to the main <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n">TP-Link TL-WR703N product Wiki page</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174240">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						7 Aug 2012, 09:39					</div>
				</div>
				<div class="post-content content">
					<p>Outstanding work Squonk!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174266">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">strby</div>
					<div class="post-datetime">
						7 Aug 2012, 16:05					</div>
				</div>
				<div class="post-content content">
					<p>well done squonk, i&#039;m looking forward to breaking down the power supply part. I would like to use this router in a car (14.4V) ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174268">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						7 Aug 2012, 16:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>strby wrote:</cite><blockquote><p>well done squonk, i&#039;m looking forward to breaking down the power supply part. I would like to use this router in a car (14.4V) ;-)</p></blockquote></div><p>I suggest you to use a cheap KIS-3R33 module that you can find at &lt; $2 on eBay, for example:<br /><a href="http://www.ebay.com/itm/270953393121">http://www.ebay.com/itm/270953393121</a></p><p>4.75-23V input voltage, output voltage adjustable from 0.925V to 20V, 3A (4A peak) current, 95% efficiency, 21mm x 21mmx 7mm.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174302">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">strby</div>
					<div class="post-datetime">
						7 Aug 2012, 22:11					</div>
				</div>
				<div class="post-content content">
					<p>Thanks a lot, that&#039;s nice and cheap solution :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174858">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">v8rush</div>
					<div class="post-datetime">
						14 Aug 2012, 11:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>imperfect wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Anyone knows if there are pins to connect a second USB port ?</p></blockquote></div><p>No, only single USB port. You need to use usb hub</p><p>For those who really wants to use their wr703n in some homemade electronic projects.<br />I&#039;ve managed to control another 2 gpios, located just near gpio0. It&#039;s 2 pads with resistors R11 and R12 on them (gpio14 and gpio15 according to kernel).<br />However, it required me to modify kernel sources and set some values on the GPIO_FUNCTION register of the AR9331. And it was not possible without a datasheet, of course <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />If there is some interest in it, I can try to prepare patches (never did it before).<br />As for other functionality, AR9331 has I2S support, GPIO edge/level interrupt support, 4 general purpose timers, subscriber line interface card (SLIC) support<br />Most of it is not implemented in the current kernel</p></blockquote></div><p>Did you do this? Even just &quot;svn diff&quot; would get us somewhere <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.&nbsp; On a more general note, how does the AR9331 handle PIO muxing - is the GPIO_FUNCTION register a centralised pin-function register, or are they spread over the subsystems (eg ethernet, RF...). If the former, then I guess there&#039;s the possibility of freeing up even more GPIOs quite easily.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174868">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						14 Aug 2012, 14:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>v8rush wrote:</cite><blockquote><div class="quotebox"><cite>imperfect wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Anyone knows if there are pins to connect a second USB port ?</p></blockquote></div><p>No, only single USB port. You need to use usb hub</p><p>For those who really wants to use their wr703n in some homemade electronic projects.<br />I&#039;ve managed to control another 2 gpios, located just near gpio0. It&#039;s 2 pads with resistors R11 and R12 on them (gpio14 and gpio15 according to kernel).<br />However, it required me to modify kernel sources and set some values on the GPIO_FUNCTION register of the AR9331. And it was not possible without a datasheet, of course <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />If there is some interest in it, I can try to prepare patches (never did it before).<br />As for other functionality, AR9331 has I2S support, GPIO edge/level interrupt support, 4 general purpose timers, subscriber line interface card (SLIC) support<br />Most of it is not implemented in the current kernel</p></blockquote></div><p>Did you do this? Even just &quot;svn diff&quot; would get us somewhere <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.&nbsp; On a more general note, how does the AR9331 handle PIO muxing - is the GPIO_FUNCTION register a centralised pin-function register, or are they spread over the subsystems (eg ethernet, RF...). If the former, then I guess there&#039;s the possibility of freeing up even more GPIOs quite easily.</p></blockquote></div><p>I too would love to see a patch from imperfect</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174871">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						14 Aug 2012, 15:21					</div>
				</div>
				<div class="post-content content">
					<p>@imperfect: I understand that if you never prepared patches before, the task may looks like daunting... Don&#039;t worry, it is not that difficult.</p><p>Here is a small receipe:<br /> - get the latest snapshot from svn using the usual methods<br /> - only modified the required files for your modification to work: avoid changing unrelated stuff, spaces/tabs/indents, etc., as these would also be part of the patch<br /> -&nbsp; go into the top level directory containing the snapshot and issue a &quot;svn diff &gt; my_first.patch&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174905">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">yumbrad</div>
					<div class="post-datetime">
						14 Aug 2012, 22:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>v8rush wrote:</cite><blockquote><p>On a more general note, how does the AR9331 handle PIO muxing - is the GPIO_FUNCTION register a centralised pin-function register, or are they spread over the subsystems (eg ethernet, RF...). If the former, then I guess there&#039;s the possibility of freeing up even more GPIOs quite easily.</p></blockquote></div><p>Check out <br /><a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel/linux/arch/mips/ar7240/gpio.c">http://gpl.back2roots.org/source/fritzb … 240/gpio.c</a> <br /><a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel/linux/arch/mips/include/asm/mach-ar7240/ar7240.h">http://gpl.back2roots.org/source/fritzb … 0/ar7240.h</a><br /><a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel/linux/arch/mips/include/asm/mach-ar7240/ar933x.h">http://gpl.back2roots.org/source/fritzb … 0/ar933x.h</a> <br />... some of these german gateway devices (Fritzbox) seems to have utilized more of the ar71xx functionality, and their GPL release has some stuff I haven&#039;t seen in other places.</p><p>You can grab the whole kernel too: <a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel.tar.gz">http://gpl.back2roots.org/source/fritzb … nel.tar.gz</a></p><p>There seems to be one register at GPIO_BASE (0x18040000) that selects a pin as input or output, then several function select/mux registers that are rather complicated at GPIO_BASE + 0x28 - 0x40. Some examples of how certain functions get set up are in the above gpio.c file within ar7240_gpio_setup_pin_mode. This could be useful for enabling more GPIOs, but also for using some of the other functions (JTAG, I2S, SPI)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174924">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						15 Aug 2012, 07:05					</div>
				</div>
				<div class="post-content content">
					<p>great job</p><p>direct use gpio control,the idea is cool</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174935">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">v8rush</div>
					<div class="post-datetime">
						15 Aug 2012, 10:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>yumbrad wrote:</cite><blockquote><div class="quotebox"><cite>v8rush wrote:</cite><blockquote><p>On a more general note, how does the AR9331 handle PIO muxing - is the GPIO_FUNCTION register a centralised pin-function register, or are they spread over the subsystems (eg ethernet, RF...). If the former, then I guess there&#039;s the possibility of freeing up even more GPIOs quite easily.</p></blockquote></div><p>Check out <br /><a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel/linux/arch/mips/ar7240/gpio.c">http://gpl.back2roots.org/source/fritzb … 240/gpio.c</a> <br /><a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel/linux/arch/mips/include/asm/mach-ar7240/ar7240.h">http://gpl.back2roots.org/source/fritzb … 0/ar7240.h</a><br /><a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel/linux/arch/mips/include/asm/mach-ar7240/ar933x.h">http://gpl.back2roots.org/source/fritzb … 0/ar933x.h</a> <br />... some of these german gateway devices (Fritzbox) seems to have utilized more of the ar71xx functionality, and their GPL release has some stuff I haven&#039;t seen in other places.</p><p>You can grab the whole kernel too: <a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel.tar.gz">http://gpl.back2roots.org/source/fritzb … nel.tar.gz</a></p><p>There seems to be one register at GPIO_BASE (0x18040000) that selects a pin as input or output, then several function select/mux registers that are rather complicated at GPIO_BASE + 0x28 - 0x40. Some examples of how certain functions get set up are in the above gpio.c file within ar7240_gpio_setup_pin_mode. This could be useful for enabling more GPIOs, but also for using some of the other functions (JTAG, I2S, SPI)</p></blockquote></div><p>Thanks for that. I browsed through the U-boot and OpenWRT sources, and decided much the same. The GPIO_FUNC register is just a bitmask of &#039;features&#039;, and doesn&#039;t have a direct mapping to PIO ids. The fritzbox stuff is interesting though, as I&#039;d not seen how to control the chip selects for SPI (though on OpenWRT, you can use GPIOs directly), and they&#039;re probably just remapped GPIOs anyway.</p><p>Next thing to do is try modifying the startup code to see if we can free up more GPIOs (I&#039;m guessing this is what imperfect did) by removing them from &#039;special function&#039; duties. Top of the list to try is the 4 &quot;ethernet switch&quot; LEDs, and if that boots (edit: it did), it&#039;s multimeter time to find them...</p>											<p class="post-edited">(Last edited by <strong>v8rush</strong> on 15 Aug 2012, 11:11)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=36471&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=36471&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=6.html">6</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>