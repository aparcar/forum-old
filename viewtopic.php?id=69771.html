<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN Client for Hide.me</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p351526">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ravenlost2</div>
					<div class="post-datetime">
						9 Feb 2017, 19:31					</div>
				</div>
				<div class="post-content content">
					<p>Hello ! Im trying to setup OpenVPN on a OpenWRT/DGN3500 router to use as a client vpn to connect to Hideme. </p><p>I followed a tutorial entitled &quot;OpenVPN with OpenWrt&quot; on the Hide.me community forum exactly as is (<a href="http://community.hide.me/tutorials/openvpn-with-openwrt.38/">community.hide.me/tutorials/openvpn-with-openwrt.38/</a>), but it just doesn&#039;t work and I don&#039;t get any error in my log.</p><p>If anyone would be so kind to give me a hand to try and find out what&#039;s going on ??</p><p>My respective config files....</p><p>/etc/config/openvpn: <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ls -la /etc/config/openvpn
-rw-r--r--    1 root     root           402 Feb  9 16:04 /etc/config/openvpn

root@OpenWrt:~# cat /etc/config/openvpn
## PROY ADDED
config openvpn &#039;Hide_me&#039;
    option dev &#039;tun314&#039;
    option proto &#039;udp&#039;
    option dev_type &#039;tun&#039;
    option nobind &#039;1&#039;
    option client &#039;1&#039;
    option reneg_sec &#039;0&#039;
    option remote &#039;nl.hide.me&#039;
    option persist_tun &#039;1&#039;
    option persist_key &#039;1&#039;
    option port &#039;3478&#039;
    option verb &#039;3&#039;
    option ca &#039;/etc/openvpn/Hideme.cert.pem&#039;
    list auth_user_pass &#039;/etc/openvpn/Hideme.login.auth&#039;
    option cipher &#039;AES-128-CBC&#039;</code></pre></div><p>Certificate: <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ls -la /etc/openvpn/Hideme.cert.pem
-rw-r--r--    1 root     root          1338 Feb  9 16:43 /etc/openvpn/Hideme.cert.pem

root@OpenWrt:~# cat /etc/openvpn/Hideme.cert.pem
-----BEGIN CERTIFICATE-----
MIIDrzCCApegAwIBAgIQCDvgVpBCRrGhdWrJWZHHSjANBgkqhkiG9w0BAQUFADBh
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD
QTAeFw0wNjExMTAwMDAwMDBaFw0zMTExMTAwMDAwMDBaMGExCzAJBgNVBAYTAlVT
MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5j
b20xIDAeBgNVBAMTF0RpZ2lDZXJ0IEdsb2JhbCBSb290IENBMIIBIjANBgkqhkiG
9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4jvhEXLeqKTTo1eqUKKPC3eQyaKl7hLOllsB
CSDMAZOnTjC3U/dDxGkAV53ijSLdhwZAAIEJzs4bg7/fzTtxRuLWZscFs3YnFo97
nh6Vfe63SKMI2tavegw5BmV/Sl0fvBf4q77uKNd0f3p4mVmFaG5cIzJLv07A6Fpt
43C/dxC//AH2hdmoRBBYMql1GNXRor5H4idq9Joz+EkIYIvUX7Q6hL+hqkpMfT7P
T19sdl6gSzeRntwi5m3OFBqOasv+zbMUZBfHWymeMr/y7vrTC0LUq7dBMtoM1O/4
gdW7jVg/tRvoSSiicNoxBN33shbyTApOB6jtSj1etX+jkMOvJwIDAQABo2MwYTAO
BgNVHQ8BAf8EBAMCAYYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUA95QNVbR
TLtm8KPiGxvDl7I90VUwHwYDVR0jBBgwFoAUA95QNVbRTLtm8KPiGxvDl7I90VUw
DQYJKoZIhvcNAQEFBQADggEBAMucN6pIExIK+t1EnE9SsPTfrgT1eXkIoyQY/Esr
hMAtudXH/vTBH1jLuG2cenTnmCmrEbXjcKChzUyImZOMkXDiqw8cvpOp/2PV5Adg
06O/nVsJ8dWO41P0jmP6P6fbtGbfYmbW0W5BjfIttep3Sp+dWOIrWcBAI+0tKIJF
PnlUkiaY4IBIqDfv8NZ5YBberOgOzW6sRBc4L0na4UU+Krk2U886UAb3LujEV0ls
YSEY1QSteDwsOoBrp+uvFRTp2InBuThs4pFsiv9kuXclVzDAGySj4dzp30d8tbQk
CAUw7C29C79Fv1C5qfPrmAESrciIxpg0X40KPMbp1ZWVbd4=
-----END CERTIFICATE-----</code></pre></div><p>User authentification file : <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ls -la /etc/openvpn/Hideme.login.auth
-rw-r--r--    1 root     root            19 Feb  9 15:13 /etc/openvpn/Hideme.login.auth

root@OpenWrt:~# cat /etc/openvpn/Hideme.login.auth
USERNAME
PASSWORD</code></pre></div><p>Network Configs: <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ls -la /etc/config/network
-rw-r--r--    1 root     root          1086 Feb  9 15:53 /etc/config/network

root@OpenWrt:~# cat /etc/config/network

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fdbf:da22:9d3e::/48&#039;

config interface &#039;lan&#039;
    option force_link &#039;1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ifname &#039;eth0.1&#039;
    option dns &#039;208.67.220.220 208.67.222.222&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;3 2 1 0 5t&#039;

config atm-bridge &#039;atm&#039;
    option encaps &#039;llc&#039;
    option payload &#039;bridged&#039;
    option vci &#039;35&#039;
    option vpi &#039;8&#039;

config interface &#039;wan&#039;
    option ifname &#039;nas0&#039;
    option proto &#039;pppoe&#039;
    option ipv6 &#039;1&#039;
    option username &#039;INET_USERNAME&#039;
    option password &#039;INET_PASSWORD&#039;

config interface &#039;wan6&#039;
    option ifname &#039;@wan&#039;
    option proto &#039;dhcpv6&#039;

config adsl &#039;dsl&#039;
    option annex &#039;mm&#039;
    option firmware &#039;/lib/firmware/adsl.bin&#039;

config interface &#039;Hide_me&#039;
    option proto &#039;none&#039;
    option ifname &#039;tun314&#039;</code></pre></div><p>Firewall Configs: <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ls -la /etc/config/firewall
-rw-r--r--    1 root     root          3585 Feb  9 16:08 /etc/config/firewall

root@OpenWrt:~# tail -n 8 /etc/config/firewall
config zone
    option name &#039;hide_me&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;Hide_me&#039;</code></pre></div><br /><p>So, when I hit the &quot;Start&quot; in the Hide_me VPN instance in Luci, it just does nothing. Keeping an eye on &#039;logread -f&#039; in my console doesn&#039;t show me any errors either. And just to make sure, I&#039;ve also tried by first turning off the firewall with &#039;/etc/init.d/firewall stop&#039;; and still, nothing. I would of thought I would of had an interface named &quot;tun***&quot; in my ifconfig output, but nada! </p><p>I also tried putting in logging configs in my openvpn config as follows, but the log file wont even get created!<br /></p><div class="codebox"><pre><code>option log         /var/log/openvpn.log                               
option log_append  /var/log/openvpn.log                               
option verb 9</code></pre></div><br /><p>After running &#039;/etc/init.d/openvpn start&#039;, I get no errors, nothing, and&nbsp; &#039;ps | grep openvpn&#039; doesnt show openvpn running... Im very confused here. This is what I had previously installed :</p><div class="codebox"><pre><code>root@OpenWrt:~# opkg list-installed | grep openvpn
luci-app-openvpn - git-16.018.33482-3201903-1
openvpn-easy-rsa - 2013-01-30-2
openvpn-openssl - 2.3.6-5</code></pre></div><p>Any help with this would be very much appreciated!! Thanks a lot. </p><br /><p>Regards, Pat</p>											<p class="post-edited">(Last edited by <strong>ravenlost2</strong> on 9 Feb 2017, 19:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351533">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						9 Feb 2017, 20:40					</div>
				</div>
				<div class="post-content content">
					<p>I have not looked at the link, but believe that there should be more than just a zone configured in your firewall.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351539">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ravenlost2</div>
					<div class="post-datetime">
						9 Feb 2017, 22:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>I have not looked at the link, but believe that there should be more than just a zone configured in your firewall.</p></blockquote></div><p>But then again, I tried turning off the FW completely and still it wouldnt work... So I doubt that&#039;s the problem ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351541">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						9 Feb 2017, 23:12					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>option enabled &#039;1&#039;</code></pre></div><p>Why &#039;list&#039; instead of &#039;option&#039; with auth file?<br />But initially I recommend you to run openvpn from command line directly with natural config file, not with uci-based config. You can also see my manual concerning airvpn: <a href="https://airvpn.org/topic/20303-airvpn-configuration-on-openwrt-preventing-traffic-leakage-outside-tunnel/">https://airvpn.org/topic/20303-airvpn-c … de-tunnel/</a></p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 9 Feb 2017, 23:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351553">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Bluenote</div>
					<div class="post-datetime">
						10 Feb 2017, 01:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ulmwind wrote:</cite><blockquote><div class="codebox"><pre><code>option enabled &#039;1&#039;</code></pre></div><p>Why &#039;list&#039; instead of &#039;option&#039; with auth file?<br />But initially I recommend you to run openvpn from command line directly with natural config file, not with uci-based config. You can also see my manual concerning airvpn: <a href="https://airvpn.org/topic/20303-airvpn-configuration-on-openwrt-preventing-traffic-leakage-outside-tunnel/">https://airvpn.org/topic/20303-airvpn-c … de-tunnel/</a></p></blockquote></div><p>Sorry to hijack! That is a fairly indepth guide.&nbsp; Could you comment on how I might go about forwarding DSCP (let&#039;s say DSCP 9, I can&#039;t remember what I&#039;m using) tagged traffic to tun0 , if openvpn is not set up to pull a default route.&nbsp; ie; not all traffic goes through the openvpn, only certain DSCP tags?&nbsp; &nbsp;Even some pointers would be good because I am stuck right now. <br />thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351565">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">marktomlinson32</div>
					<div class="post-datetime">
						10 Feb 2017, 07:39					</div>
				</div>
				<div class="post-content content">
					<p>Ravenlost2 i also run hide.me tunnels from mt openwrt router with none of these issues you are showing.,<br />and i followed their guide with no issue.</p><p>so from what you are saying the openvpn process is not even showing that it is attempting to run.. failure or not.?<br />silly question.. but it is enabled yeah? when installing mine you have to enable and start it..</p><p>also i see you have renamed the trustedroot.pem to another name with two full stops in the filename.. again probably nothing but i am using trustedroot.pem and login.auth and i have no issues.</p><p>what i am trying to do is run two hide.me connections from my router.. one to america and one to amsterdam..&nbsp; and route specific machine on my internal network through the desired routes. <br />if you need any help pm me and i will share my setup info etc..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351566">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">marktomlinson32</div>
					<div class="post-datetime">
						10 Feb 2017, 07:40					</div>
				</div>
				<div class="post-content content">
					<p>also in a shell session when you start openvpn run logread -f then try and start your tunnel.. <br />see what ( if anything ) you get in the log then.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351577">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						10 Feb 2017, 09:54					</div>
				</div>
				<div class="post-content content">
					<p>For testing purposes change the verb &#039;3&#039; to verb &#039;9&#039; in /etc/config/openvpn and add a log file to see whats happening.<br /></p><div class="codebox"><pre><code>    option verb &#039;9&#039;
    option log &#039;/tmp/openvpn.log&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351736">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">ravenlost2</div>
					<div class="post-datetime">
						12 Feb 2017, 17:46					</div>
				</div>
				<div class="post-content content">
					<p>It seems I had a few things wrong. Not sure if this changed anything, but I started of by renaming my &quot;Hideme.login.auth&quot; and &quot;Hideme.cert.pem&quot; so they would only a single dot in the names. Then I added the option enabled &#039;1&#039; (which I was sure I had tried before), and a few other renames to make it more clear (i.e. renamed the FW zone &quot;hide_me&quot; to &quot;vpn&quot;, etc). </p><p>All that being said, everything started BUT I now kept getting an AUTH_FAILED in my log. I contacted the hide.me website about it, and it seems they are telling me I&#039;m trying to connect using a protocol you normaly need to pay for...&nbsp; Their msgs :</p><div class="quotebox"><blockquote><p>Hello,<br />it seems that you are trying to connect your device using a protocol reserved for our Plus and Premium members only. You can choose a different protocol in the &quot;Step 2&quot; of the easy setup. I would recommend that you try IKEv1, IKEv2, SSTP or PPTP native client.<br />Let me know if this helps.</p></blockquote></div><p>They tell me this, eventhough they didn&#039;t write on their tutorial that is was for paying customers <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />(</p><p>That&#039;s a real freakin bummer ! </p><p>Apparently, you can use their free service if you use IPSec IVEk2..&nbsp; This brings me to my next question and I dont know if I should start a new post or continu on this one. Think I&#039;ll start a new one, since I can&#039;t find a simple ipsec /&nbsp; openwrt tutorial for a client connection.. I&#039;ve been trying to follow this guide from the VPN service hideme : community.hide.me/tutorials/ipsec-ikev2-with-strongswan-non-gui-method.43/ but so far, no luck....</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>