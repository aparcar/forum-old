<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> HAME MPR-A1 - Small and cheap router with built-in battery</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 12 May 2015 and 2 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 28</div><nav><ul><li><a href="viewtopic.php%3Fid=37002&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=37002&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=37002&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=37002&amp;p=28.html">28</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p185815">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						12 Dec 2012, 10:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>perazim wrote:</cite><blockquote><p>I am waiting for a supplier to build one of these with a built-in 3G modem.</p><p>And while they are at it, an on-board SLIC ATA interface too.</p><p>Perazim</p></blockquote></div><p>Great!</p><p>It would be nice to have more Flash and SDRAM capacity, too...</p><p>Let us know if this become available!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185951">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">arpunk</div>
					<div class="post-datetime">
						13 Dec 2012, 21:56					</div>
				</div>
				<div class="post-content content">
					<p>@Squonk I managed to enable the GPIO 7 in my board def. as you suggested and USB is working now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>I haven&#039;t been able to test it fully due to some squashfs errors when I try to use LuCI or when using the console (serial) at random times.</p><p>The flash type I&#039;m using is &quot;m25p32-nonjedec&quot;. Official firmware outputs: AT25DF321 (1f 47000000) (4096 Kbytes). Full output:</p><div class="codebox"><pre><code>AT25DF321(1f 47000000) (4096 Kbytes)
mtd .name = raspi, .size = 0x00400000 (4M) .erasesize = 0x00010000 (64K) .numeraseregions = 0
Creating 7 MTD partitions on &quot;raspi&quot;:
0x00000000-0x00400000 : &quot;ALL&quot; 
0x00000000-0x00030000 : &quot;Bootloader&quot; 
0x00030000-0x00040000 : &quot;Config&quot; 
0x00040000-0x00050000 : &quot;Factory&quot; 
0x00050000-0x0015a6aa : &quot;Kernel&quot; 
mtd: partition &quot;Kernel&quot; doesn&#039;t end on an erase block -- force read-only
0x0015a6aa-0x01000000 : &quot;RootFS&quot; 
mtd: partition &quot;RootFS&quot; extends beyond the end of device &quot;raspi&quot; -- size truncated to 0x2a5956
mtd: partition &quot;RootFS&quot; doesn&#039;t start on an erase block boundary -- force read-only
0x00050000-0x01000000 : &quot;Kernel_RootFS&quot; 
mtd: partition &quot;Kernel_RootFS&quot; extends beyond the end of device &quot;raspi&quot; -- size truncated to 0x3b0000</code></pre></div><p>I have another rt5350 board but with different flash:</p><div class="codebox"><pre><code>EN25Q64(1c 30171c30) (8192 Kbytes)
mtd .name = raspi, .size = 0x00800000 (8M) .erasesize = 0x00010000 (64K) .numeraseregions = 0
Creating 7 MTD partitions on &quot;raspi&quot;:
0x00000000-0x00800000 : &quot;ALL&quot; 
0x00000000-0x00030000 : &quot;Bootloader&quot; 
0x00030000-0x00040000 : &quot;Config&quot; 
0x00040000-0x00050000 : &quot;Factory&quot; 
0x00050000-0x0015a734 : &quot;Kernel&quot; 
mtd: partition &quot;Kernel&quot; doesn&#039;t end on an erase block -- force read-only
0x0015a734-0x01000000 : &quot;RootFS&quot; 
mtd: partition &quot;RootFS&quot; extends beyond the end of device &quot;raspi&quot; -- size truncated to 0x6a58cc
mtd: partition &quot;RootFS&quot; doesn&#039;t start on an erase block boundary -- force read-only
0x00050000-0x01000000 : &quot;Kernel_RootFS&quot; 
mtd: partition &quot;Kernel_RootFS&quot; extends beyond the end of device &quot;raspi&quot; -- size truncated to 0x7b0000</code></pre></div><p>However, when I try to boot OpenWRT on the 8Mb flash ralink the kernel freezes at:</p><div class="codebox"><pre><code>[    0.000000] Linux version 3.6.10 (arpunk@bela) (gcc version 4.6.4 20121106 (prerelease) (Linaro GCC 42
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001964c (MIPS 24KEc)
[    0.000000] Ralink RT5350 id:1 rev:3 running at 360.00 MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x01ffffff]</code></pre></div><p>These are the sdram:</p><p>- M12L128168A (4mb ralink)<br/>- EM639165TS-6G (8mb ralink)</p><p>Any hints on where I should look at?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185962">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						13 Dec 2012, 23:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arpunk wrote:</cite><blockquote><p>@Squonk I managed to enable the GPIO 7 in my board def. as you suggested and USB is working now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p></blockquote></div><p>Great! I&#039;m glad it worked as expected!</p><div class="quotebox"><cite>arpunk wrote:</cite><blockquote><p>However, when I try to boot OpenWRT on the 8Mb flash ralink the kernel freezes at:</p><div class="codebox"><pre><code>[    0.000000] Linux version 3.6.10 (arpunk@bela) (gcc version 4.6.4 20121106 (prerelease) (Linaro GCC 42
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001964c (MIPS 24KEc)
[    0.000000] Ralink RT5350 id:1 rev:3 running at 360.00 MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x01ffffff]</code></pre></div><p>These are the sdram:</p><p>- M12L128168A (4mb ralink)<br/>- EM639165TS-6G (8mb ralink)</p><p>Any hints on where I should look at?</p></blockquote></div><p>There is something wrong here: the kernel reports 32MB (0x02000000), but the EM639165TS-6G is a 8Mbit x16bit, so only 16MB... See <a href="http://www.netcheif.com/Reviews/VigorFly200/PDF/EM639165_rev1.pdf">datasheet</a>.</p><p>However, I don&#039;t know where the kernel is getting this size? In the cmdline args? You may try to locate the &quot;Determined physical RAM map:&quot; message in the sources and see how this is computed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186007">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">p1vo</div>
					<div class="post-datetime">
						14 Dec 2012, 10:57					</div>
				</div>
				<div class="post-content content">
					<p>New Revision of Hame A1 -&nbsp; v1.4 vs v.2.1</p><p><a href="http://www.pivo.neostrada.pl/20121213_172148.jpg"><span class="postimg"><img src="http://www.pivo.neostrada.pl/20121213_172148small.jpg" alt="http://www.pivo.neostrada.pl/20121213_172148small.jpg"/></span></a></p><p>And guys pls try <a href="http://www.pivo.neostrada.pl/openwrt-ramips-rt305x-mpr-a1-squashfs-sysupgrade.bin">http://www.pivo.neostrada.pl/openwrt-ra … pgrade.bin</a><br/>and let me know is it stable or not.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186012">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">p1vo</div>
					<div class="post-datetime">
						14 Dec 2012, 11:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>There is something wrong here: the kernel reports 32MB (0x02000000), but the EM639165TS-6G is a 8Mbit x16bit, so only 16MB... See <a href="http://www.netcheif.com/Reviews/VigorFly200/PDF/EM639165_rev1.pdf">datasheet</a>.</p></blockquote></div><p>Look for the EM63A165TS-6G (16Mx16bitx1MB). </p><p>Regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186014">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						14 Dec 2012, 11:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>p1vo wrote:</cite><blockquote><p>And guys pls try <a href="http://www.pivo.neostrada.pl/openwrt-ramips-rt305x-mpr-a1-squashfs-sysupgrade.bin">http://www.pivo.neostrada.pl/openwrt-ra … pgrade.bin</a><br/>and let me know is it stable or not.</p></blockquote></div><p>It looks like it doesn&#039;t work as is on my MPR-L8 board <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad"/></p><p>Can you post the patches so I can try to figure out what is going on?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186017">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">studystep0</div>
					<div class="post-datetime">
						14 Dec 2012, 11:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>p1vo wrote:</cite><blockquote><p>New Revision of Hame A1 -&nbsp; v1.4 vs v.2.1</p><p><a href="http://www.pivo.neostrada.pl/20121213_172148.jpg"><span class="postimg"><img src="http://www.pivo.neostrada.pl/20121213_172148small.jpg" alt="http://www.pivo.neostrada.pl/20121213_172148small.jpg"/></span></a></p><p>And guys pls try <a href="http://www.pivo.neostrada.pl/openwrt-ramips-rt305x-mpr-a1-squashfs-sysupgrade.bin">http://www.pivo.neostrada.pl/openwrt-ra … pgrade.bin</a><br/>and let me know is it stable or not.</p></blockquote></div><p>I try it , it works except the ethernet. My board isn&#039;t the Hame A1 . I guess maybe switch wrong.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186104">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">studystep0</div>
					<div class="post-datetime">
						15 Dec 2012, 05:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>p1vo wrote:</cite><blockquote><p>New Revision of Hame A1 -&nbsp; v1.4 vs v.2.1</p><p><a href="http://www.pivo.neostrada.pl/20121213_172148.jpg"><span class="postimg"><img src="http://www.pivo.neostrada.pl/20121213_172148small.jpg" alt="http://www.pivo.neostrada.pl/20121213_172148small.jpg"/></span></a></p><p>And guys pls try <a href="http://www.pivo.neostrada.pl/openwrt-ramips-rt305x-mpr-a1-squashfs-sysupgrade.bin">http://www.pivo.neostrada.pl/openwrt-ra … pgrade.bin</a><br/>and let me know is it stable or not.</p></blockquote></div><p>Can you share your patches in somewhere?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186163">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						15 Dec 2012, 19:53					</div>
				</div>
				<div class="post-content content">
					<p>I start porting to rt5350 based router (dlink dir-320b1). Switch, usb,wifi work. Images for test <a href="http://narod.ru/disk/64520696001.3f679d7aae2da7725f717d3edf01428d/rt5350-flash8M-mem32M-sysupgrage.bin.html">rt5350-flash8M-mem32M-sysupgrage.bin</a> or <a href="http://narod.ru/disk/64520649001.dc171f6de037b98833b65d0c71dd5d45/rt5350-flash8M-mem16M-sysupgrage.bin.html">rt5350-flash8M-mem16M-sysupgrage.bin</a>. Memory size autodetect don&#039;t work (kernel crash) so two files. Wifi work is configured for 20MHz clock generator.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186164">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Heffer</div>
					<div class="post-datetime">
						15 Dec 2012, 19:55					</div>
				</div>
				<div class="post-content content">
					<p>Would be great if you shared your patches somewhere.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186168">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">arpunk</div>
					<div class="post-datetime">
						15 Dec 2012, 21:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>123serge123 wrote:</cite><blockquote><p>I start porting to rt5350 based router (dlink dir-320b1). Switch, usb,wifi work. Images for test <a href="http://narod.ru/disk/64520696001.3f679d7aae2da7725f717d3edf01428d/rt5350-flash8M-mem32M-sysupgrage.bin.html">rt5350-flash8M-mem32M-sysupgrage.bin</a> or <a href="http://narod.ru/disk/64520649001.dc171f6de037b98833b65d0c71dd5d45/rt5350-flash8M-mem16M-sysupgrage.bin.html">rt5350-flash8M-mem16M-sysupgrage.bin</a>. Memory size autodetect don&#039;t work (kernel crash) so two files. Wifi work is configured for 20MHz clock generator.</p></blockquote></div><p>Is the USB wired to GPIO 7? does the ethernet switch work out of the box with OpenWRT?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186171">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						15 Dec 2012, 22:31					</div>
				</div>
				<div class="post-content content">
					<p>Please SHARE your patches!</p><p>Posting binaries is useless!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186173">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">arpunk</div>
					<div class="post-datetime">
						15 Dec 2012, 22:52					</div>
				</div>
				<div class="post-content content">
					<p>@Squonk I specified the correct memory size (mem=16M) but I don&#039;t have ethernet working on that board. USB also does not work even if I wire up the GPIO 7.</p><p>So my plan is to add the correct flash type (AT25DF321) to the board I have ethernet working. I currently hit a lot of squashfs errors (<a href="http://pastebin.com/EVpb1D4Y">http://pastebin.com/EVpb1D4Y</a>) probably because I&#039;m using m25p32-nonjedec as flash type.</p><p>The original ralink SDK specifies the SPI flash as:</p><div class="codebox"><pre><code>{ &quot;AT25DF321&quot;,          0x1f, 0x47000000, 64 * 1024, 64,  0 },</code></pre></div>											<p class="post-edited">(Last edited by <strong>arpunk</strong> on 15 Dec 2012, 22:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186174">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">arpunk</div>
					<div class="post-datetime">
						15 Dec 2012, 23:01					</div>
				</div>
				<div class="post-content content">
					<p>@Squonk also, one board I have reports a EN25Q64 (8MB) flash but OpenWRT does not recognize that ID and instead it falls back to EN25Q32B (4MB):</p><div class="codebox"><pre><code>[    0.390000] ramips-spi ramips-spi.0: master is unqueued, this is deprecated
[    0.410000] m25p80 spi0.0: found en25q32b, expected en25q64
[    0.420000] m25p80 spi0.0: en25q32b (4096 Kbytes)
[    0.430000] 6 cmdlinepart partitions found on MTD device spi0.0
[    0.440000] Creating 6 MTD partitions on &quot;spi0.0&quot;:
[    0.450000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    0.460000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    0.480000] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    0.490000] 0x000000050000-0x000000130000 : &quot;kernel&quot;
[    0.510000] 0x000000130000-0x000000400000 : &quot;rootfs&quot;
[    0.520000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    0.530000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=370000, len=90000 
[    0.550000] 0x000000370000-0x000000400000 : &quot;rootfs_data&quot;
[    0.560000] 0x000000050000-0x000000400000 : &quot;firmware&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186177">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						15 Dec 2012, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>Could you tell us how exactly you proceed?</p><p>Are you starting from trunk?</p><p>Which patches&nbsp; do you apply?</p><p>How many boards do you have, and what are their characteristics?</p><p>Can you make a short status on each one, I am lost!</p><p>Can you take pictures of the PCB, as it looks like there are numerous variants.</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186180">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">arpunk</div>
					<div class="post-datetime">
						15 Dec 2012, 23:52					</div>
				</div>
				<div class="post-content content">
					<p>@Squonk sure, let me sum it up.</p><p>I have 5 ralink rt5350 boards but 3 of them are different. They are all boot OpenWRT (trunk) but only one of them has working USB, ethernet switch and I got WiFi working on r34270 (compat-wireless-2012-09-07) with a patch Daniel Golle sent me a few weeks back on that board.</p><p>The board I have ethernet and USB working has a 4MB FLASH (AT25DF321 (1f 47000000) (4096 Kbytes)) and 16MB RAM (M12L128168A).</p><p>The original flash layout is as follows:</p><div class="codebox"><pre><code># cat /proc/mtd 
dev:    size   erasesize  name
mtd0: 00400000 00010000 &quot;ALL&quot; 
mtd1: 00030000 00010000 &quot;Bootloader&quot; 
mtd2: 00010000 00010000 &quot;Config&quot; 
mtd3: 00010000 00010000 &quot;Factory&quot; 
mtd4: 0010a6aa 00010000 &quot;Kernel&quot; 
mtd5: 002a5956 00010000 &quot;RootFS&quot; 
mtd6: 003b0000 00010000 &quot;Kernel_RootFS&quot; 
#</code></pre></div><p>And stock firmware reports this SPI flash:</p><div class="codebox"><pre><code>AT25DF321(1f 47000000) (4096 Kbytes)
mtd .name = raspi, .size = 0x00400000 (4M) .erasesize = 0x00010000 (64K) .numeraseregions = 0
Creating 7 MTD partitions on &quot;raspi&quot;:
0x00000000-0x00400000 : &quot;ALL&quot; 
0x00000000-0x00030000 : &quot;Bootloader&quot; 
0x00030000-0x00040000 : &quot;Config&quot; 
0x00040000-0x00050000 : &quot;Factory&quot; 
0x00050000-0x0015a6aa : &quot;Kernel&quot; 
mtd: partition &quot;Kernel&quot; doesn&#039;t end on an erase block -- force read-only
0x0015a6aa-0x01000000 : &quot;RootFS&quot; 
mtd: partition &quot;RootFS&quot; extends beyond the end of device &quot;raspi&quot; -- size truncated to 0x2a5956
mtd: partition &quot;RootFS&quot; doesn&#039;t start on an erase block boundary -- force read-only
0x00050000-0x01000000 : &quot;Kernel_RootFS&quot; 
mtd: partition &quot;Kernel_RootFS&quot; extends beyond the end of device &quot;raspi&quot; -- size truncated to 0x3b0000</code></pre></div><p>Currently I get squashfs errors on the working board, that&#039;s why I haven&#039;t been able to use it further (check this reply: <a href="https://forum.openwrt.org/viewtopic.php?pid=186173#p186173)">https://forum.openwrt.org/viewtopic.php … 3#p186173)</a></p><p>With the help of PaulFertser in IRC I managed to get it working in OpenWRT using m25p32-nonjedec as flash type in my board definition. The red and blue leds I got them with your help posting the info of the polish forum (as well as working USB).</p><p>The other ralink boards I have (with serial attached) have different flash and ram chips, as well as a sightly different PCB layout. I don&#039;t have high-res pictures at the moment, I&#039;ll post them later. This is the board that doesn&#039;t have USB nor ethernet working: <a href="http://imgur.com/f86vU">http://imgur.com/f86vU</a></p><p>To make them work, I passed the memory size as kernel parameter since it seems the bootloader reports a wrong size, freezing the kernel at boot.</p><p>USB and ethernet does not work on them atm and I haven&#039;t tried all the GPIO ports yet. Those boards also randomly reboot themselfs.</p><p>The device shows the ethernet ports but it just doesn&#039;t respond.</p><div class="codebox"><pre><code>[   23.120000] device eth0.1 entered promiscuous mode
[   23.130000] device eth0 entered promiscuous mode
[   23.160000] br-lan: port 1(eth0.1) entered forwarding state
[   23.170000] br-lan: port 1(eth0.1) entered forwarding state
[   25.170000] br-lan: port 1(eth0.1) entered forwarding state</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# ifconfig
br-lan    Link encap:Ethernet  HWaddr 00:11:22:33:44:55  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

eth0      Link encap:Ethernet  HWaddr 00:11:22:33:44:55  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:1191 (1.1 KiB)
          Interrupt:5 

eth0.1    Link encap:Ethernet  HWaddr 00:11:22:33:44:55  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

eth0.2    Link encap:Ethernet  HWaddr 00:11:22:33:44:55  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:1179 (1.1 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

root@OpenWrt:/#</code></pre></div><p>So:</p><p>- ralink board with AT25DF321 flash: USB, Ethernet and WiFi (reverting to r34270 and Daniel&#039;s patch) work, no random reboots, squashfs errors (and different PCB than the other ralinks).</p><p>- ralink boards with EN25Q64 flash: USB, Ethernet and WiFi does not work, random reboots, flash does not get recognized.</p><p>Also, check my last 2 posts regarding the flash chip.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186183">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						16 Dec 2012, 01:56					</div>
				</div>
				<div class="post-content content">
					<p>OK, thank you!</p><p>What I would be interesting for others to know in details is what you did to make it work:<br/></p><ul><li><p>trunk revision used</p></li><li><p>exact target/subtarget/profile chosen</p></li><li><p>patches that have been applied and where to find them</p></li><li><p>&quot;mach-*&quot; file that has been used, containing what has been added to the board setup</p></li><li><p>network config, including wireless driver and maybe also binary firmware used</p></li></ul><p>We should try to put everything together to get things working faster, Instead of doing each our of experiments at random...</p><p>This should start by finding a way to describe all the boards that we have and highlight their common features and differences, then list precisely the method we used to get such and such things working, not throwing unidentified binary firmwares that are likely not working in every situation, given the multiple differences we have seen so far in the hardware.</p><p>Particularly, there seems to be a lot of remaining problem with Flash/SDRAM, and now a little bit less with USB, wireless and Ethernet.</p><p>If we share our knowledge, we have better chances to find out what is going on.</p><p>My board is an <a href="http://www.geekbuying.com/item/3-In-1-3G-150Mbps-Mobile-Wireless-Roster-Router-Broadband-Power-WIFI-Hotspot-Mini-AP-Triple-307247.html">MPR-L8</a> which look very similar to the HAME-A1:<br/><span class="postimg"><img src="http://imageshack.us/a/img441/6029/mprl8pcbtop.png" alt="http://imageshack.us/a/img441/6029/mprl8pcbtop.png"/></span><br/><span class="postimg"><img src="http://imageshack.us/a/img821/9373/mprl8pcbbottom.png" alt="http://imageshack.us/a/img821/9373/mprl8pcbbottom.png"/></span></p><p>It has an EtronTech EM639165TS-6G 8Mbitx16bit 16MB SDRAM and a Winbond W25Q32BV 32Mbitx8bit 4MB Flash, but unlike other boards, it has only a very limited busybox msh shell with only a few useless commands available, even using the serial console <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad"/>.</p><p>What I want to do first is to backup everything using U-Boot, then start to play with a custom firmware... But as my flash map is not exactly the same as a HAME, I will have to tweak it a bit! Same for GPIOs, LEDs, etc.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 16 Dec 2012, 01:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186188">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						16 Dec 2012, 06:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arpunk wrote:</cite><blockquote><p>Is the USB wired to GPIO 7? does the ethernet switch work out of the box with OpenWRT?</p></blockquote></div><p>1. USB works out of the box so I don&#039;t think that GPIO7 used.<br/>2. Memsize was corrected with kernel parameter.<br/>3. Switch start working after corrected reset_fe (see devices.c) - legacy driver reset frame engine and switch together. Symptom: swconfig show received packets in active port but no interrupts in /proc/interrupts from enet.<br/>4. WLAN support was added based on dlink gpl <a href="ftp://ftp.dlink.ru/pub/Router/DIR-320_NRU/Source/gpl_DIR_320NRU.tar.gz">ftp://ftp.dlink.ru/pub/Router/DIR-320_N … NRU.tar.gz</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186189">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						16 Dec 2012, 06:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>Please SHARE your patches!</p><p>Posting binaries is useless!</p></blockquote></div><p>Keep patience. Tests and patches refreshing upto current trunk need more time <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186194">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						16 Dec 2012, 12:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>123serge123 wrote:</cite><blockquote><div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>Please SHARE your patches!</p><p>Posting binaries is useless!</p></blockquote></div><p>Keep patience. Tests and patches refreshing upto current trunk need more time <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p></blockquote></div><p>I am not asking for clean, polished patches that you just need to pull from trunk, but at least to share the pieces of code that makes something work.</p><p>The fact that nobody is sharing the &quot;mach-*&#039; board support file is significant of a deliberate attempt to retain information for unknown reasons: I have seldom seen such a low level of sharing knowledge for a new OpenWrt-based platform, thus my lack of patience...</p><p>What individual developers should realize though, is that we are facing here is a reference design made by Ralink, that has been adapted and modified more or less by several unnamed Chinese manufacturer. So this is not like you try to port OpenWrt to a new router by a single manufacturer as usual.</p><p>There will be some common features and some variants among manufacturers, but also differences among different revisions from the same manufacturer: the quite radical changes for the Hame A1 -&nbsp; v1.4 vs v.2.1 is a good example.</p><p>The only way to make these boards work quickly and reliably with OpenWrt is by sharing our experience as a community, not by doing our stuff alone. This doesn&#039;t prevent some commercial developments, and actually I think that this could help them, as this could accelerate the time to market.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186298">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">arpunk</div>
					<div class="post-datetime">
						17 Dec 2012, 18:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>123serge123 wrote:</cite><blockquote><div class="quotebox"><cite>arpunk wrote:</cite><blockquote><p>Is the USB wired to GPIO 7? does the ethernet switch work out of the box with OpenWRT?</p></blockquote></div><p>1. USB works out of the box so I don&#039;t think that GPIO7 used.<br/>2. Memsize was corrected with kernel parameter.<br/>3. Switch start working after corrected reset_fe (see devices.c) - legacy driver reset frame engine and switch together. Symptom: swconfig show received packets in active port but no interrupts in /proc/interrupts from enet.<br/>4. WLAN support was added based on dlink gpl <a href="ftp://ftp.dlink.ru/pub/Router/DIR-320_NRU/Source/gpl_DIR_320NRU.tar.gz">ftp://ftp.dlink.ru/pub/Router/DIR-320_N … NRU.tar.gz</a></p></blockquote></div><p>Could you share at least what bits did you add for WLAN to work? How did you corrected reset_fe?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186303">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">arpunk</div>
					<div class="post-datetime">
						17 Dec 2012, 19:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>OK, thank you!</p><p>What I would be interesting for others to know in details is what you did to make it work:<br/></p><ul><li><p>trunk revision used</p></li><li><p>exact target/subtarget/profile chosen</p></li><li><p>patches that have been applied and where to find them</p></li><li><p>&quot;mach-*&quot; file that has been used, containing what has been added to the board setup</p></li><li><p>network config, including wireless driver and maybe also binary firmware used</p></li></ul><p>We should try to put everything together to get things working faster, Instead of doing each our of experiments at random...</p><p>This should start by finding a way to describe all the boards that we have and highlight their common features and differences, then list precisely the method we used to get such and such things working, not throwing unidentified binary firmwares that are likely not working in every situation, given the multiple differences we have seen so far in the hardware.</p><p>Particularly, there seems to be a lot of remaining problem with Flash/SDRAM, and now a little bit less with USB, wireless and Ethernet.</p><p>If we share our knowledge, we have better chances to find out what is going on.</p><p>My board is an <a href="http://www.geekbuying.com/item/3-In-1-3G-150Mbps-Mobile-Wireless-Roster-Router-Broadband-Power-WIFI-Hotspot-Mini-AP-Triple-307247.html">MPR-L8</a> which look very similar to the HAME-A1:<br/>...</p><p>It has an EtronTech EM639165TS-6G 8Mbitx16bit 16MB SDRAM and a Winbond W25Q32BV 32Mbitx8bit 4MB Flash, but unlike other boards, it has only a very limited busybox msh shell with only a few useless commands available, even using the serial console <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad"/>.</p><p>What I want to do first is to backup everything using U-Boot, then start to play with a custom firmware... But as my flash map is not exactly the same as a HAME, I will have to tweak it a bit! Same for GPIOs, LEDs, etc.</p></blockquote></div><p>Hi Squonk,</p><p>1. I used from r34270 to latest trunk with the following mach-*.c: <a href="http://pastebin.com/qR6QSxg8">http://pastebin.com/qR6QSxg8</a> (I used pocketap4 as identifier because I do not know the board name, revision or manufacturer.)</p><p>2. I choosed: </p><p>- Target system: Ralink RT288x/RT3xxx<br/>- Subtarget: RT305x based boards<br/>- Profile: default profile.</p><p>3. The patches that I applied to trunk for WLAN: <a href="http://pastebin.com/AAfwdS5Z">http://pastebin.com/AAfwdS5Z</a> (this applies to trunk but does not activate the wireless)</p><p>4. The patches that I applied to r34270 for WLAN: <a href="http://pastebin.com/hc8NxHbL">http://pastebin.com/hc8NxHbL</a> (this applies to r34270, older compat-wireless-2012-09-07)</p><p>My board images are here: <a href="http://imgur.com/CDKyH,QvRNt,Y3ByQ,iOJyc#0">http://imgur.com/CDKyH,QvRNt,Y3ByQ,iOJyc#0</a> (the boards named Embedsys are the ones on which ethernet and USB does not work.)</p><p>6. By network config, what do you mean exactly? I have only used the compat-wireless work that comes with OpenWRT. By binary drivers you mean the ones that come with the stock firmware?</p>											<p class="post-edited">(Last edited by <strong>arpunk</strong> on 17 Dec 2012, 22:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186314">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">arpunk</div>
					<div class="post-datetime">
						17 Dec 2012, 21:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>My board is an <a href="http://www.geekbuying.com/item/3-In-1-3G-150Mbps-Mobile-Wireless-Roster-Router-Broadband-Power-WIFI-Hotspot-Mini-AP-Triple-307247.html">MPR-L8</a> which look very similar to the HAME-A1:<br/>...</p><p>It has an EtronTech EM639165TS-6G 8Mbitx16bit 16MB SDRAM and a Winbond W25Q32BV 32Mbitx8bit 4MB Flash, but unlike other boards, it has only a very limited busybox msh shell with only a few useless commands available, even using the serial console <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad"/>.</p><p>What I want to do first is to backup everything using U-Boot, then start to play with a custom firmware... But as my flash map is not exactly the same as a HAME, I will have to tweak it a bit! Same for GPIOs, LEDs, etc.</p></blockquote></div><p>The boad I have working is exactly the same layout as yours but with different flash (AT25DF321 <a href="http://www.soselectronic.com/a_info/resource/c/Atmel/AT25DF321.pdf">http://www.soselectronic.com/a_info/res … 5DF321.pdf</a> ) and SDRAM (ESMT m12l128168a&nbsp; <a href="http://www.esmt.com.tw/DB/manager/upload/M12L128168A.pdf)">www.esmt.com.tw/DB/manager/upload/M12L128168A.pdf)</a>.</p><p>Mine didn&#039;t come with a msh shell. I had a full working terminal. I have a working bootloader for that board (ralink U-Boot 3.6.0.0)</p><p>What flash map do you have?</p>											<p class="post-edited">(Last edited by <strong>arpunk</strong> on 17 Dec 2012, 22:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186320">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						17 Dec 2012, 22:38					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for sharing your detailed config!</p><p>Here is my flash map:<br/></p><div class="codebox"><pre><code>0x00000000-0x00030000 : &quot;Bootloader&quot;
0x00030000-0x00040000 : &quot;Config&quot;
0x00040000-0x00050000 : &quot;Factory&quot;
0x00050000-0x00150000 : &quot;Kernel&quot;
0x00150000-0x00400000 : &quot;RootFS&quot;
0x00050000-0x00400000 : &quot;Firmware&quot;</code></pre></div><p>In the meantime, I replaced it with firmware from p1vo: LAN, USB, blue LED is GPIO20 defined as a led, red LED is GPIO17 (active low GPIO only, no LED def) are working, I have a wlan0 but can&#039;t connect to any SSID, no RF packet sent/received.</p><p>If I export GPIO7, I am able to toggle USB power of an attached device on/off and when on, it enumerates correctly, so I guess USB is working ok. It looks like your board having the USB not working by default is just because of lack of init in the bootloader.</p><p>No problem with Flash (except &quot;m25p80 spi0.0: found w25q32, expected pm25lq032&quot;) or SDRAM (I only have 16MB, though...).</p><p>I will try to roll my own image based on your config, but I will define a separate MPR-A1 config instead of using default.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 17 Dec 2012, 23:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186327">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						17 Dec 2012, 23:49					</div>
				</div>
				<div class="post-content content">
					<p>OK, I created my own image to replace p1vo&#039;s one, and it is almost working the same, except that I provide the patch is available below <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p><p>I created an &quot;MPR-A1&quot; profile, so I compile using (I had to flush &quot;tmp&quot;):<br/></p><ul><li><p>Target system: Ralink RT288x/RT3xxx</p></li><li><p>Subtarget: RT305x based boards</p></li><li><p>Profile: HAME MPR-A1.</p></li></ul><p>Here is the patch to trunk (revision 34735): <a href="http://pastebin.com/jESjc2nH">http://pastebin.com/jESjc2nH</a></p><p>I also used mac80211 patch from <a href="http://heffer.fedorapeople.org/openwrt/packages/mac80211/patches/630-rt2x00-support-rt5350.patch">http://heffer.fedorapeople.org/openwrt/ … 5350.patch</a></p><p>Ethernet and USB are working, GPIO7 is pre-declared as &quot;USB power&quot; and working as expected, but wireless doesn&#039;t work as with p1vo&#039;s firmware <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad"/></p><p>I also have an issue with LEDs: both are on but not full brightness, and nothing in &quot;/sys/cless/leds&quot;:<br/></p><div class="codebox"><pre><code>- preinit -
[    5.130000] leds-gpio: probe of leds-gpio failed with error -16
Press the [f] key and hit [enter] to enter failsafe mode</code></pre></div><p>and</p><div class="codebox"><pre><code>root@OpenWrt:/sys/class/leds# ls
rt2800pci-phy0::assoc    rt2800pci-phy0::quality  rt2800pci-phy0::radio
root@OpenWrt:/sys/class/leds# cd /sys/class/gpio/
root@OpenWrt:/sys/class/gpio# ls
export      gpio7       gpiochip0   gpiochip24  gpiochip40  unexport</code></pre></div>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 28</div><nav><ul><li><a href="viewtopic.php%3Fid=37002&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=37002&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=37002&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=37002&amp;p=28.html">28</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>